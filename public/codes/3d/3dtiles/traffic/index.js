let map, groupLayer;
const symbols = [
  {
      url: 'cube',
      scaleX : 40,
      scaleY : 60,
      scaleZ : 40,
      translationZ: 50,
      shadow: true,
      uniforms: {
          polygonFill: [0.8, 0.2, 0.4, 1.0]
      }
  },
  {
      url: 'cube',
      scaleX : 35,
      scaleY : 65,
      scaleZ : 35,
      shadow: true,
      translationZ: 50,
      uniforms: {
          polygonFill: [0.4, 0.2, 0.8, 1.0]
      }
  },
  {
      url: 'cube',
      scaleX : 40,
      scaleY : 55,
      scaleZ : 30,
      shadow: true,
      translationZ: 50,
      uniforms: {
          polygonFill: [0.5, 0.7, 0.4, 1.0]
      }
  },
  {
      url: 'cube',
      scaleX : 30,
      scaleY : 60,
      scaleZ : 30,
      translationZ: 50,
      shadow: true,
      uniforms: {
          polygonFill: [0.3, 0.6, 0.9, 1.0]
      }
  },
  {
      url: 'cube',
      scaleX : 40,
      scaleY : 62,
      scaleZ : 30,
      translationZ: 50,
      shadow: true,
      uniforms: {
          polygonFill: [0.4, 0.33, 0.73, 1.0]
      }
  }
];
const roads = [
  [
    [114.2830898989456, 30.626939772308475],
    [114.26342122696815, 30.62004768732956],
    [114.24367865143927, 30.614240289904245],
    [114.22814605019062, 30.60818908453868],
    [114.22230482605153, 30.600549538269917],
    [114.22452399088957, 30.589743567621127],
    [114.21975050660183, 30.58229635980186],
    [114.21490601484584, 30.580056548061663],
    [114.20333067504544, 30.5607721308414],
    [114.19118208479586, 30.540537208416566],
    [114.21987061485186, 30.529631967722906],
    [114.24749889328768, 30.516225424011026],
    [114.27849079327359, 30.494149144702334],
    [114.31280536483746, 30.489978960558886],
    [114.3331472396876, 30.48928089949399],
    [114.34400947599897, 30.512529907515358],
    [114.35126064826716, 30.537971866522156],
    [114.34828146872928, 30.54213120763299],
    [114.34814397628293, 30.548344596026794],
    [114.35246928542756, 30.5527835304662],
    [114.35651151394268, 30.563651289612523],
    [114.37237732966469, 30.585270381678384],
    [114.35245166791378, 30.61992163243528],
    [114.32538222307642, 30.639356642126614],
    [114.2830801568158, 30.626937322678913]
  ],
  [
    [114.30843848845791, 30.71696115784229],
    [114.30208681291901, 30.700612107008197],
    [114.2880722156599, 30.64915288251504],
    [114.2797632036403, 30.63633736278834],
    [114.28497069778405, 30.625129807022375],
    [114.32650923385893, 30.60076866315856],
    [114.3555576875633, 30.57916084571829],
    [114.37613129890315, 30.574488013431818]
  ],
  [
    [114.23555576521437, 30.685202607010382],
    [114.23995620640267, 30.676564034758513],
    [114.24017910297925, 30.656920160039903],
    [114.26680538849075, 30.617206435901807],
    [114.26321171822542, 30.60936216252466],
    [114.27762164365618, 30.573317689496292],
    [114.27645284751384, 30.567163705418665],
    [114.28048200825253, 30.563969194215105],
    [114.27914779891614, 30.55814163599345],
    [114.2625734564682, 30.530687973888888],
    [114.23565536550552, 30.502185039151556],
    [114.23067545896276, 30.501729137465787],
    [114.22347747597018, 30.484137860379718],
    [114.20132770003056, 30.46088707790213]
  ],
  [
    [114.22633277014074, 30.667134370855848],
    [114.22919117616038, 30.661429068923866],
    [114.22414298713818, 30.64041361328995],
    [114.24953184026583, 30.609157616554768],
    [114.24554428248393, 30.592176204932656],
    [114.24575649121778, 30.57145252585238],
    [114.23292592564621, 30.548831315098226],
    [114.18844568075326, 30.48853246353653]
  ],
  [
    [114.1709977673288, 30.61508819115747],
    [114.22186699932274, 30.608475169928596],
    [114.25087703517806, 30.60067944999733],
    [114.26685812703874, 30.607258262897204],
    [114.27742963860487, 30.602196086507746],
    [114.28778702006502, 30.596556459192385],
    [114.29026237390622, 30.58655368158523],
    [114.31359725355355, 30.576183781662877],
    [114.33821271659644, 30.558226222234822],
    [114.34403154257188, 30.554716151036047],
    [114.36080668844727, 30.552806310689647]
  ],
  [
    [114.16246488875458, 30.612489820239347],
    [114.17130568555649, 30.61013926408154],
    [114.21372494738137, 30.587553018685725],
    [114.2287753882024, 30.578664816259817],
    [114.24147694338671, 30.57757895357352],
    [114.24908795975489, 30.58049220520448],
    [114.26167315219834, 30.581936325771125],
    [114.27902687077358, 30.587725793298972],
    [114.30778821587569, 30.61899905573378],
    [114.32578193034783, 30.646594365352797],
    [114.34189220215637, 30.693296943907086]
  ],
  [
    [114.15111303691538, 30.57844948318089],
    [114.1603942963435, 30.578793166276483],
    [114.16658849731027, 30.57639601370451],
    [114.17243027917766, 30.578170100535914],
    [114.18910724982777, 30.577718887351665],
    [114.21860833463893, 30.57083337454216],
    [114.23568137494271, 30.564598466075182],
    [114.25586072567694, 30.553880169084977],
    [114.2728790210125, 30.557099115669956],
    [114.292122517812, 30.548052420589244],
    [114.30150755011539, 30.54252510873775],
    [114.31411870951831, 30.542037497131076],
    [114.3568864457402, 30.526161979739385],
    [114.36493173198915, 30.520435448342965],
    [114.38190163602962, 30.51708295513211],
    [114.3935932434606, 30.507969089552688]
  ],
  [
    [114.15014286795622, 30.56163690392097],
    [114.16239082228867, 30.56685064881256],
    [114.17206054198823, 30.565838732245453],
    [114.17910567063814, 30.558460039575692],
    [114.18670780841853, 30.5609467728203],
    [114.21582259372394, 30.557765402543538],
    [114.23981967891814, 30.55054878443613],
    [114.24563843593182, 30.541174530812697],
    [114.26417071645062, 30.540376330501402],
    [114.28882192535661, 30.527439568652454],
    [114.2967609978997, 30.529141329434168],
    [114.30796912293522, 30.526479205697484],
    [114.33019436424524, 30.517791019004477],
    [114.33596136214965, 30.513091720852486],
    [114.35623148769128, 30.51210381978902],
    [114.37542241726896, 30.50719860867119],
    [114.38712457531005, 30.500321757765988]
  ],
  [
    [114.21969216082152, 30.495084182758063],
    [114.25787670749719, 30.54411034744058],
    [114.26153282951338, 30.54535403359725],
    [114.26020768565422, 30.558566334152857],
    [114.26395794966345, 30.57915450620581],
    [114.25695954834373, 30.59383166700931],
    [114.25751417052652, 30.606001685511586],
    [114.24873475144432, 30.624057447627564]
  ],
  [
    [114.26555248203181, 30.475810584735854],
    [114.29269044136902, 30.51044383890948],
    [114.29541469186734, 30.522059815912456],
    [114.30365138722209, 30.523302993802787],
    [114.30949740119331, 30.529608948603624],
    [114.31384561362688, 30.546784756805636],
    [114.31181611437728, 30.568485123440524],
    [114.34947512071835, 30.603829160124036],
    [114.38131346869704, 30.621983154559672],
    [114.43196133043546, 30.620464162623847]
  ],
  [
    [114.42714819566686, 30.601090358821835],
    [114.39840944523291, 30.601266082569026],
    [114.36179239927071, 30.58578291733997],
    [114.3408155007645, 30.5620431656495],
    [114.32561927888514, 30.535392422586455],
    [114.32881549477895, 30.534289287559005],
    [114.31985448225953, 30.512587148679103],
    [114.31845466745187, 30.470023302210194]
  ],
  [
    [114.26750255967784, 30.626657270123275],
    [114.2810235775379, 30.606928311125927],
    [114.29449623684002, 30.601789858331898],
    [114.30605920850428, 30.597160575592596],
    [114.32193925198226, 30.5937596034523],
    [114.33933244643003, 30.581890935437258],
    [114.36216387719071, 30.564372531379917]
  ]
];
/**start**/
fetch('{res}/msd/map.json').then(function(response){
  return response.json();
}).then(function(data){
  map = maptalks.Map.fromJSON('map', data);
  map.setCenter([114.26, 30.558]);
  map.setZoom(14);
  groupLayer = map.getLayer('group');
  scene = new TRAFFIC.Scene();
  scene.setSymbols(symbols);
  scene.carsNumber = 100;
  scene.addTo(groupLayer);
  scene.generateTraffic(roads);
  scene.run();
});

const gui = new mt.GUI();
gui
  .add({
    type: "button",
    label: "开始模拟",
    role: "play",
  })
  .onClick(() => {
    scene.run();
  });

gui
  .add({
    type: "button",
    label: "停止模拟",
    role: "pause",
  })
  .onClick(() => {
    scene.stop();
  });

gui
  .add({
    type: "slider",
    label: "数量",
    value: 100,
    min: 10,
    max: 500,
    step: 1
  })
  .onChange((value) => {
    scene.carsNumber = value;
  });

gui
  .add({
    type: "button",
    label: "移除",
    role: "pause",
  })
  .onClick(() => {
    scene.remove();
  });
/**end**/
