/*!
 * @maptalks/gl-layers v0.18.5
 * LICENSE : MIT
 * (c) 2016-2023 maptalks.com
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).maptalks=global.maptalks||{},global.maptalks)}(this,(function(exports,t$2){"use strict";function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(k){if("default"!==k){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:!0,get:function(){return e[k]}})}})),n.default=e,Object.freeze(n)}var t__namespace=_interopNamespace(t$2),regl_min=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self,{exports:{}});!function(module,exports){module.exports=function(){function W(a,b){this.id=Db++,this.type=a,this.data=b}function Z(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-1);if(1<a.length&&b===c&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return Z(a.substr(0,b.index)).concat(Z(b[1])).concat(Z(a.substr(b.index+b[0].length)));if(1===(b=a.split(".")).length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(a=[],c=0;c<b.length;++c)a=a.concat(Z(b[c]));return a}function cb(a){return"["+Z(a).join("][")+"]"}function db(a,b){return"function"==typeof a?new W(0,a):"number"==typeof a||"boolean"==typeof a?new W(5,a):Array.isArray(a)?new W(6,a.map((function(a,d){return db(a)}))):a instanceof W?a:void 0}function Eb(){var a={"":0},b=[""];return{id:function(c){var d=a[c];return d||(d=a[c]=b.length,b.push(c),d)},str:function(a){return b[a]}}}function Fb(a,b,c){function d(){var b=window.innerWidth,d=window.innerHeight;a!==document.body&&(b=(d=a.getBoundingClientRect()).right-d.left,d=d.bottom-d.top),f.width=c*b,f.height=c*d,K(f.style,{width:b+"px",height:d+"px"})}var e,f=document.createElement("canvas");return K(f.style,{border:0,margin:0,padding:0,top:0,left:0}),a.appendChild(f),a===document.body&&(f.style.position="absolute",K(a.style,{margin:0,padding:0})),a!==document.body&&"function"==typeof ResizeObserver?(e=new ResizeObserver((function(){setTimeout(d)}))).observe(a):window.addEventListener("resize",d,!1),d(),{canvas:f,onDestroy:function(){e?e.disconnect():window.removeEventListener("resize",d),a.removeChild(f)}}}function Gb(a,b){function c(c){try{return a.getContext(c,b)}catch(f){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function eb(a){return"string"==typeof a?a.split():a}function fb(a){return"string"==typeof a?document.querySelector(a):a}function Hb(a){var c,d,f,e,b=a||{};a={};var k=[],p=[],u="undefined"==typeof window?1:window.devicePixelRatio,l=!1,v=function(a){},r=function(){};if("string"==typeof b?c=document.querySelector(b):"object"==typeof b&&("string"==typeof b.nodeName&&"function"==typeof b.appendChild&&"function"==typeof b.getBoundingClientRect?c=b:"function"==typeof b.drawArrays||"function"==typeof b.drawElements?f=(e=b).canvas:("gl"in b?e=b.gl:"canvas"in b?f=fb(b.canvas):"container"in b&&(d=fb(b.container)),"attributes"in b&&(a=b.attributes),"extensions"in b&&(k=eb(b.extensions)),"optionalExtensions"in b&&(p=eb(b.optionalExtensions)),"onDone"in b&&(v=b.onDone),"profile"in b&&(l=!!b.profile),"pixelRatio"in b&&(u=+b.pixelRatio))),c&&("canvas"===c.nodeName.toLowerCase()?f=c:d=c),!e){if(!f){if(!(c=Fb(d||document.body,v,u)))return null;f=c.canvas,r=c.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),e=Gb(f,a)}return e?{gl:e,canvas:f,container:d,extensions:k,optionalExtensions:p,pixelRatio:u,profile:l,onDone:v,onDestroy:r}:(r(),v("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ib(a,b){function c(b){var c;b=b.toLowerCase();try{c=d[b]=a.getExtension(b)}catch(f){}return!!c}for(var d={},f=0;f<b.extensions.length;++f){var e=b.extensions[f];if(!c(e))return b.onDestroy(),b.onDone('"'+e+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return b.optionalExtensions.forEach(c),{extensions:d,restore:function(){Object.keys(d).forEach((function(a){if(d[a]&&!c(a))throw Error("(regl): error restoring extension "+a)}))}}}function S(a,b){for(var c=Array(a),d=0;d<a;++d)c[d]=b(d);return c}function gb(a){var b,c;return b=(65535<a)<<4,b|=c=(255<(a>>>=b))<<3,(b|=c=(15<(a>>>=c))<<2)|(c=(3<(a>>>=c))<<1)|a>>>c>>1}function hb(){function a(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}return 0<(b=c[gb(a)>>2]).length?b.pop():new ArrayBuffer(a)}function b(a){c[gb(a.byteLength)>>2].push(a)}var c=S(8,(function(){return[]}));return{alloc:a,free:b,allocType:function(b,c){var e=null;switch(b){case 5120:e=new Int8Array(a(c),0,c);break;case 5121:e=new Uint8Array(a(c),0,c);break;case 5122:e=new Int16Array(a(2*c),0,c);break;case 5123:e=new Uint16Array(a(2*c),0,c);break;case 5124:e=new Int32Array(a(4*c),0,c);break;case 5125:e=new Uint32Array(a(4*c),0,c);break;case 5126:e=new Float32Array(a(4*c),0,c);break;default:return null}return e.length!==c?e.subarray(0,c):e},freeType:function(a){b(a.buffer)}}}function ja(a){return!!a&&"object"==typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"==typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||P(a.data))}function ib(a,b,c,d,f,e){for(var k=0;k<b;++k)for(var p=a[k],u=0;u<c;++u)for(var l=p[u],v=0;v<d;++v)f[e++]=l[v]}function jb(a,b,c,d,f){for(var e=1,k=c+1;k<b.length;++k)e*=b[k];var p=b[c];if(4==b.length-c){var u=b[c+1],l=b[c+2];for(b=b[c+3],k=0;k<p;++k)ib(a[k],u,l,b,d,f),f+=e}else for(k=0;k<p;++k)jb(a[k],b,c+1,d,f),f+=e}function Ha(a){return 0|Ia[Object.prototype.toString.call(a)]}function kb(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function lb(a,b,c,d,f,e,k){for(var p=0,u=0;u<c;++u)for(var l=0;l<d;++l)a[p++]=b[f*u+e*l+k]}function Jb(a,b,c,d){function f(b){this.id=u++,this.buffer=a.createBuffer(),this.type=b,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,c.profile&&(this.stats={size:0})}function e(b,c,m){b.byteLength=c.byteLength,a.bufferData(b.type,c,m)}function k(a,b,c,h,g,d){if(a.usage=c,Array.isArray(b)){if(a.dtype=h||5126,0<b.length)if(Array.isArray(b[0])){g=mb(b);for(var n=h=1;n<g.length;++n)h*=g[n];a.dimension=h,e(a,b=Ua(b,g,a.dtype),c),d?a.persistentData=b:D.freeType(b)}else"number"==typeof b[0]?(a.dimension=g,kb(g=D.allocType(a.dtype,b.length),b),e(a,g,c),d?a.persistentData=g:D.freeType(g)):P(b[0])&&(a.dimension=b[0].length,a.dtype=h||Ha(b[0])||5126,e(a,b=Ua(b,[b.length,b[0].length],a.dtype),c),d?a.persistentData=b:D.freeType(b))}else if(P(b))a.dtype=h||Ha(b),a.dimension=g,e(a,b,c),d&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(ja(b)){var f=b.stride,q=(n=b.offset,0),na=0,l=0,p=0;1===(g=b.shape).length?(q=g[0],na=1,l=f[0],p=0):2===g.length&&(q=g[0],na=g[1],l=f[0],p=f[1]),a.dtype=h||Ha(b.data)||5126,a.dimension=na,lb(g=D.allocType(a.dtype,q*na),b.data,q,na,l,p,n),e(a,g,c),d?a.persistentData=g:D.freeType(g)}else b instanceof ArrayBuffer&&(a.dtype=5121,a.dimension=g,e(a,b,c),d&&(a.persistentData=new Uint8Array(new Uint8Array(b))))}function p(c){b.bufferCount--,d(c),a.deleteBuffer(c.buffer),c.buffer=null,delete l[c.id]}var u=0,l={};f.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)},f.prototype.destroy=function(){p(this)};var v=[];return c.profile&&(b.getTotalBufferSize=function(){var a=0;return Object.keys(l).forEach((function(b){a+=l[b].stats.size})),a}),{create:function(r,d,e,h){function g(b){var r=35044,q=null,d=0,e=0,f=1;return Array.isArray(b)||P(b)||ja(b)||b instanceof ArrayBuffer?q=b:"number"==typeof b?d=0|b:b&&("data"in b&&(q=b.data),"usage"in b&&(r=nb[b.usage]),"type"in b&&(e=Ja[b.type]),"dimension"in b&&(f=0|b.dimension),"length"in b&&(d=0|b.length)),t.bind(),q?k(t,q,r,e,f,h):(d&&a.bufferData(t.type,d,r),t.dtype=e||5121,t.usage=r,t.dimension=f,t.byteLength=d),c.profile&&(t.stats.size=t.byteLength*ka[t.dtype]),g}b.bufferCount++;var t=new f(d);return l[t.id]=t,e||g(r),g._reglType="buffer",g._buffer=t,g.subdata=function(b,c){var d,q=0|(c||0);if(t.bind(),P(b)||b instanceof ArrayBuffer)a.bufferSubData(t.type,q,b);else if(Array.isArray(b)){if(0<b.length)if("number"==typeof b[0]){var r=D.allocType(t.dtype,b.length);kb(r,b),a.bufferSubData(t.type,q,r),D.freeType(r)}else(Array.isArray(b[0])||P(b[0]))&&(d=mb(b),r=Ua(b,d,t.dtype),a.bufferSubData(t.type,q,r),D.freeType(r))}else if(ja(b)){var e=b.stride,h=r=0,f=0,E=0;1===(d=b.shape).length?(r=d[0],h=1,f=e[0],E=0):2===d.length&&(r=d[0],h=d[1],f=e[0],E=e[1]),d=Array.isArray(b.data)?t.dtype:Ha(b.data),lb(d=D.allocType(d,r*h),b.data,r,h,f,E,b.offset),a.bufferSubData(t.type,q,d),D.freeType(d)}return g},c.profile&&(g.stats=t.stats),g.destroy=function(){p(t)},g},createStream:function(a,b){var c=v.pop();return c||(c=new f(a)),c.bind(),k(c,b,35040,0,1,!1),c},destroyStream:function(a){v.push(a)},clear:function(){J(l).forEach(p),v.forEach(p)},getBuffer:function(a){return a&&a._buffer instanceof f?a._buffer:null},restore:function(){J(l).forEach((function(b){b.buffer=a.createBuffer(),a.bindBuffer(b.type,b.buffer),a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)}))},_initBuffer:k}}function Kb(a,b,c,d){function f(a){this.id=u++,p[this.id]=this,this.buffer=a,this.primType=4,this.type=this.vertCount=0}function e(d,e,f,h,g,t,n){var l;if(d.buffer.bind(),e?((l=n)||P(e)&&(!ja(e)||P(e.data))||(l=b.oes_element_index_uint?5125:5123),c._initBuffer(d.buffer,e,f,l,3)):(a.bufferData(34963,t,f),d.buffer.dtype=l||5121,d.buffer.usage=f,d.buffer.dimension=3,d.buffer.byteLength=t),l=n,!n){switch(d.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;break;case 5125:case 5124:l=5125}d.buffer.dtype=l}d.type=l,0>(e=g)&&(e=d.buffer.byteLength,5123===l?e>>=1:5125===l&&(e>>=2)),d.vertCount=e,e=h,0>h&&(e=4,1===(h=d.buffer.dimension)&&(e=0),2===h&&(e=1),3===h&&(e=4)),d.primType=e}function k(a){d.elementsCount--,delete p[a.id],a.buffer.destroy(),a.buffer=null}var p={},u=0,l={uint8:5121,uint16:5123};b.oes_element_index_uint&&(l.uint32=5125),f.prototype.bind=function(){this.buffer.bind()};var v=[];return{create:function(a,b){function m(a){if(a)if("number"==typeof a)h(a),g.primType=4,g.vertCount=0|a,g.type=5121;else{var b=null,c=35044,d=-1,f=-1,r=0,p=0;Array.isArray(a)||P(a)||ja(a)?b=a:("data"in a&&(b=a.data),"usage"in a&&(c=nb[a.usage]),"primitive"in a&&(d=Ka[a.primitive]),"count"in a&&(f=0|a.count),"type"in a&&(p=l[a.type]),"length"in a?r=0|a.length:(r=f,5123===p||5122===p?r*=2:5125!==p&&5124!==p||(r*=4))),e(g,b,c,d,f,r,p)}else h(),g.primType=4,g.vertCount=0,g.type=5121;return m}var h=c.create(null,34963,!0),g=new f(h._buffer);return d.elementsCount++,m(a),m._reglType="elements",m._elements=g,m.subdata=function(a,b){return h.subdata(a,b),m},m.destroy=function(){k(g)},m},createStream:function(a){var b=v.pop();return b||(b=new f(c.create(null,34963,!0,!1)._buffer)),e(b,a,35040,-1,-1,0,0),b},destroyStream:function(a){v.push(a)},getElements:function(a){return"function"==typeof a&&a._elements instanceof f?a._elements:null},clear:function(){J(p).forEach(k)}}}function ob(a){for(var b=D.allocType(5123,a.length),c=0;c<a.length;++c)if(isNaN(a[c]))b[c]=65535;else if(1/0===a[c])b[c]=31744;else if(-1/0===a[c])b[c]=64512;else{pb[0]=a[c];var f=(d=Lb[0])>>>31<<15,e=(d<<1>>>24)-127,d=d>>13&1023;b[c]=-24>e?f:-14>e?f+(d+1024>>-14-e):15<e?f+31744:f+(e+15<<10)+d}return b}function ra(a){return Array.isArray(a)||P(a)}function sa(a){return"[object "+a+"]"}function qb(a){return Array.isArray(a)&&(0===a.length||"number"==typeof a[0])}function rb(a){return!(!Array.isArray(a)||0===a.length||!ra(a[0]))}function la(a){return Object.prototype.toString.call(a)}function Va(a){if(!a)return!1;var b=la(a);return 0<=Mb.indexOf(b)||qb(a)||rb(a)||ja(a)}function sb(a,b){36193===a.type?(a.data=ob(b),D.freeType(b)):a.data=b}function La(a,b,c,d,f,e){if(a=void 0!==G[a]?G[a]:T[a]*ta[b],e&&(a*=6),f){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}function Nb(a,b,c,d,f,e,k){function p(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function u(a,b){a.internalformat=b.internalformat,a.format=b.format,a.type=b.type,a.compressed=b.compressed,a.premultiplyAlpha=b.premultiplyAlpha,a.flipY=b.flipY,a.unpackAlignment=b.unpackAlignment,a.colorSpace=b.colorSpace,a.width=b.width,a.height=b.height,a.channels=b.channels}function l(a,b){if("object"==typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha),"flipY"in b&&(a.flipY=b.flipY),"alignment"in b&&(a.unpackAlignment=b.alignment),"colorSpace"in b&&(a.colorSpace=Ob[b.colorSpace]),"type"in b&&(a.type=N[b.type]);var c=a.width,d=a.height,e=a.channels,g=!1;"shape"in b?(c=b.shape[0],d=b.shape[1],3===b.shape.length&&(e=b.shape[2],g=!0)):("radius"in b&&(c=d=b.radius),"width"in b&&(c=b.width),"height"in b&&(d=b.height),"channels"in b&&(e=b.channels,g=!0)),a.width=0|c,a.height=0|d,a.channels=0|e,c=!1,"format"in b&&(d=a.internalformat=F[c=b.format],a.format=U[d],c in N&&!("type"in b)&&(a.type=N[c]),c in ga&&(a.compressed=!0),c=!0),!g&&c?a.channels=T[a.format]:g&&!c&&a.channels!==Oa[a.format]&&(a.format=a.internalformat=Oa[a.channels])}}function v(b){a.pixelStorei(37440,b.flipY),a.pixelStorei(37441,b.premultiplyAlpha),a.pixelStorei(37443,b.colorSpace),a.pixelStorei(3317,b.unpackAlignment)}function r(){p.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function w(a,b){var c=null;if(Va(b)?c=b:b&&(l(a,b),"x"in b&&(a.xOffset=0|b.x),"y"in b&&(a.yOffset=0|b.y),Va(b.data)&&(c=b.data)),b.copy){var d=f.viewportWidth,e=f.viewportHeight;a.width=a.width||d-a.xOffset,a.height=a.height||e-a.yOffset,a.needsCopy=!0}else if(c){if(P(c))a.channels=a.channels||4,a.data=c,"type"in b||5121!==a.type||(a.type=0|Ia[Object.prototype.toString.call(c)]);else if(qb(c)){switch(a.channels=a.channels||4,e=(d=c).length,a.type){case 5121:case 5123:case 5125:case 5126:(e=D.allocType(a.type,e)).set(d),a.data=e;break;case 36193:a.data=ob(d)}a.alignment=1,a.needsFree=!0}else if(ja(c)){d=c.data,Array.isArray(d)||5121!==a.type||(a.type=0|Ia[Object.prototype.toString.call(d)]);var q,E,h,n,g=c.stride;3===(e=c.shape).length?(h=e[2],n=g[2]):n=h=1,q=e[0],E=e[1],e=g[0],g=g[1],a.alignment=1,a.width=q,a.height=E,a.channels=h,a.format=a.internalformat=Oa[h],a.needsFree=!0,q=n,c=c.offset;for(var x=D.allocType(36193===a.type?5126:a.type,(h=a.width)*(n=a.height)*(E=a.channels)),O=0,ha=0;ha<n;++ha)for(var oa=0;oa<h;++oa)for(var Wa=0;Wa<E;++Wa)x[O++]=d[e*oa+g*ha+q*Wa+c];sb(a,x)}else if(la(c)===Xa||la(c)===Ya||la(c)===ub)a.element=la(c)===Xa||la(c)===Ya?c:c.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if(la(c)===vb)a.element=c,a.width=c.width,a.height=c.height,a.channels=4;else if(la(c)===wb)a.element=c,a.width=c.naturalWidth,a.height=c.naturalHeight,a.channels=4;else if(la(c)===xb)a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.channels=4;else if(rb(c)){for(d=a.width||c[0].length,e=a.height||c.length,g=a.channels,g=ra(c[0][0])?g||c[0][0].length:g||1,q=Qa.shape(c),h=1,n=0;n<q.length;++n)h*=q[n];h=D.allocType(36193===a.type?5126:a.type,h),Qa.flatten(c,q,"",h),sb(a,h),a.alignment=1,a.width=d,a.height=e,a.channels=g,a.format=a.internalformat=Oa[g],a.needsFree=!0}}else a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4}function m(b,c,e,g,h){var q=b.element,n=b.data,E=b.internalformat,f=b.format,l=b.type,x=b.width,O=b.height;v(b),q?a.texSubImage2D(c,h,e,g,f,l,q):b.compressed?a.compressedTexSubImage2D(c,h,e,g,E,x,O,n):b.needsCopy?(d(),a.copyTexSubImage2D(c,h,e,g,b.xOffset,b.yOffset,x,O)):a.texSubImage2D(c,h,e,g,x,O,f,l,n)}function h(){return S.pop()||new r}function g(a){a.needsFree&&D.freeType(a.data),r.call(a),S.push(a)}function t(){p.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function n(a,b,c){var d=a.images[0]=h();a.mipmask=1,d.width=a.width=b,d.height=a.height=c,d.channels=a.channels=4}function C(a,b){var c=null;if(Va(b))u(c=a.images[0]=h(),a),w(c,b),a.mipmask=1;else if(l(a,b),Array.isArray(b.mipmap))for(var d=b.mipmap,e=0;e<d.length;++e)u(c=a.images[e]=h(),a),c.width>>=e,c.height>>=e,w(c,d[e]),a.mipmask|=1<<e;else u(c=a.images[0]=h(),a),w(c,b),a.mipmask=1;u(a,a.images[0])}function q(b,c){for(var e=b.images,g=0;g<e.length&&e[g];++g){var h=e[g],q=c,n=g,E=h.element,f=h.data,l=h.internalformat,x=h.format,O=h.type,ha=h.width,oa=h.height;v(h),E?a.texImage2D(q,n,x,x,O,E):h.compressed?a.compressedTexImage2D(q,n,l,ha,oa,0,f):h.needsCopy?(d(),a.copyTexImage2D(q,n,x,h.xOffset,h.yOffset,ha,oa,0)):a.texImage2D(q,n,x,ha,oa,0,x,O,f||null)}}function na(){var a=Y.pop()||new t;p.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function za(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&g(b[c]),b[c]=null;Y.push(a)}function B(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function I(a,b){"min"in b&&(a.minFilter=Aa[b.min],0<=Pb.indexOf(a.minFilter)&&!("faces"in b)&&(a.genMipmaps=!0)),"mag"in b&&(a.magFilter=Q[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var e=b.wrap;"string"==typeof e?c=d=ia[e]:Array.isArray(e)&&(c=ia[e[0]],d=ia[e[1]])}else"wrapS"in b&&(c=ia[b.wrapS]),"wrapT"in b&&(d=ia[b.wrapT]);if(a.wrapS=c,a.wrapT=d,"anisotropic"in b&&(a.anisotropic=b.anisotropic),"mipmap"in b){switch(c=!1,typeof b.mipmap){case"string":a.mipmapHint=A[b.mipmap],c=a.genMipmaps=!0;break;case"boolean":c=a.genMipmaps=b.mipmap;break;case"object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function M(c,d){a.texParameteri(d,10241,c.minFilter),a.texParameteri(d,10240,c.magFilter),a.texParameteri(d,10242,c.wrapS),a.texParameteri(d,10243,c.wrapT),b.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,c.anisotropic),c.genMipmaps&&(a.hint(33170,c.mipmapHint),a.generateMipmap(d))}function E(b){p.call(this),this.mipmask=0,this.internalformat=6408,this.id=R++,this.refCount=1,this.target=b,this.texture=a.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new B,k.profile&&(this.stats={size:0})}function ba(b){a.activeTexture(33984),a.bindTexture(b.target,b.texture)}function Ba(){var b=V[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function z(b){var c=b.texture,d=b.unit,g=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(g,null),V[d]=null),a.deleteTexture(c),b.texture=null,b.params=null,b.pixels=null,b.refCount=0,delete ea[b.id],e.textureCount--}var A={"don't care":4352,"dont care":4352,nice:4354,fast:4353},ia={repeat:10497,clamp:33071,mirror:33648},Q={nearest:9728,linear:9729},Aa=K({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},Q),Ob={none:0,browser:37444},N={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},F={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ga={};b.ext_srgb&&(F.srgb=35904,F.srgba=35906),b.oes_texture_float&&(N.float32=N.float=5126),b.oes_texture_half_float&&(N.float16=N["half float"]=36193),b.webgl_depth_texture&&(K(F,{depth:6402,"depth stencil":34041}),K(N,{uint16:5123,uint32:5125,"depth stencil":34042})),b.webgl_compressed_texture_s3tc&&K(ga,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),b.webgl_compressed_texture_atc&&K(ga,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),b.webgl_compressed_texture_pvrtc&&K(ga,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),b.webgl_compressed_texture_etc1&&(ga["rgb etc1"]=36196);var H=Array.prototype.slice.call(a.getParameter(34467));Object.keys(ga).forEach((function(a){var b=ga[a];0<=H.indexOf(b)&&(F[a]=b)}));var G=Object.keys(F);c.textureFormats=G;var ca=[];Object.keys(F).forEach((function(a){ca[F[a]]=a}));var L=[];Object.keys(N).forEach((function(a){L[N[a]]=a}));var ma=[];Object.keys(Q).forEach((function(a){ma[Q[a]]=a}));var pa=[];Object.keys(Aa).forEach((function(a){pa[Aa[a]]=a}));var qa=[];Object.keys(ia).forEach((function(a){qa[ia[a]]=a}));var U=G.reduce((function(a,c){var d=F[c];return a[d]=6409===d||6406===d||6409===d||6410===d||6402===d||34041===d||b.ext_srgb&&(35904===d||35906===d)?d:32855===d||0<=c.indexOf("rgba")?6408:6407,a}),{}),S=[],Y=[],R=0,ea={},fa=c.maxTextureUnits,V=Array(fa).map((function(){return null}));return K(E.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<fa;++c){var d=V[c];if(d){if(0<d.bindCount)continue;d.unit=-1}V[c]=this,b=c;break}k.profile&&e.maxTextureUnits<b+1&&(e.maxTextureUnits=b+1),this.unit=b,a.activeTexture(33984+b),a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&z(this)}}),k.profile&&(e.getTotalTextureSize=function(){var a=0;return Object.keys(ea).forEach((function(b){a+=ea[b].stats.size})),a}),{create2D:function(b,c){function d(a,b){var c=f.texInfo;B.call(c);var e=na();return"number"==typeof a?n(e,0|a,"number"==typeof b?0|b:0|a):a?(I(c,a),C(e,a)):n(e,1,1),c.genMipmaps&&(e.mipmask=(e.width<<1)-1),f.mipmask=e.mipmask,u(f,e),f.internalformat=e.internalformat,d.width=e.width,d.height=e.height,ba(f),q(e,3553),M(c,3553),Ba(),za(e),k.profile&&(f.stats.size=La(f.internalformat,f.type,e.width,e.height,c.genMipmaps,!1)),d.format=ca[f.internalformat],d.type=L[f.type],d.mag=ma[c.magFilter],d.min=pa[c.minFilter],d.wrapS=qa[c.wrapS],d.wrapT=qa[c.wrapT],d}var f=new E(3553);return ea[f.id]=f,e.textureCount++,d(b,c),d.subimage=function(a,b,c,e){b|=0,c|=0,e|=0;var q=h();return u(q,f),q.width=0,q.height=0,w(q,a),q.width=q.width||(f.width>>e)-b,q.height=q.height||(f.height>>e)-c,ba(f),m(q,3553,b,c,e),Ba(),g(q),d},d.resize=function(b,c){var e=0|b,g=0|c||e;if(e===f.width&&g===f.height)return d;d.width=f.width=e,d.height=f.height=g,ba(f);for(var h=0;f.mipmask>>h;++h){var q=e>>h,x=g>>h;if(!q||!x)break;a.texImage2D(3553,h,f.format,q,x,0,f.format,f.type,null)}return Ba(),k.profile&&(f.stats.size=La(f.internalformat,f.type,e,g,!1,!1)),d},d._reglType="texture2d",d._texture=f,k.profile&&(d.stats=f.stats),d.destroy=function(){f.decRef()},d},createCube:function(b,c,d,f,r,p){function A(a,b,c,d,e,f){var g,da=z.texInfo;for(B.call(da),g=0;6>g;++g)t[g]=na();if("number"!=typeof a&&a){if("object"==typeof a)if(b)C(t[0],a),C(t[1],b),C(t[2],c),C(t[3],d),C(t[4],e),C(t[5],f);else if(I(da,a),l(z,a),"faces"in a)for(a=a.faces,g=0;6>g;++g)u(t[g],z),C(t[g],a[g]);else for(g=0;6>g;++g)C(t[g],a)}else for(a=0|a||1,g=0;6>g;++g)n(t[g],a,a);for(u(z,t[0]),z.mipmask=da.genMipmaps?(t[0].width<<1)-1:t[0].mipmask,z.internalformat=t[0].internalformat,A.width=t[0].width,A.height=t[0].height,ba(z),g=0;6>g;++g)q(t[g],34069+g);for(M(da,34067),Ba(),k.profile&&(z.stats.size=La(z.internalformat,z.type,A.width,A.height,da.genMipmaps,!0)),A.format=ca[z.internalformat],A.type=L[z.type],A.mag=ma[da.magFilter],A.min=pa[da.minFilter],A.wrapS=qa[da.wrapS],A.wrapT=qa[da.wrapT],g=0;6>g;++g)za(t[g]);return A}var z=new E(34067);ea[z.id]=z,e.cubeCount++;var t=Array(6);return A(b,c,d,f,r,p),A.subimage=function(a,b,c,d,e){c|=0,d|=0,e|=0;var f=h();return u(f,z),f.width=0,f.height=0,w(f,b),f.width=f.width||(z.width>>e)-c,f.height=f.height||(z.height>>e)-d,ba(z),m(f,34069+a,c,d,e),Ba(),g(f),A},A.resize=function(b){if((b|=0)!==z.width){A.width=z.width=b,A.height=z.height=b,ba(z);for(var c=0;6>c;++c)for(var d=0;z.mipmask>>d;++d)a.texImage2D(34069+c,d,z.format,b>>d,b>>d,0,z.format,z.type,null);return Ba(),k.profile&&(z.stats.size=La(z.internalformat,z.type,A.width,A.height,!1,!0)),A}},A._reglType="textureCube",A._texture=z,k.profile&&(A.stats=z.stats),A.destroy=function(){z.decRef()},A},clear:function(){for(var b=0;b<fa;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),V[b]=null;J(ea).forEach(z),e.cubeCount=0,e.textureCount=0},getTexture:function(a){return null},restore:function(){for(var b=0;b<fa;++b){var c=V[b];c&&(c.bindCount=0,c.unit=-1,V[b]=null)}J(ea).forEach((function(b){b.texture=a.createTexture(),a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!=(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var d=0;6>d;++d)a.texImage2D(34069+d,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);M(b.texInfo,b.target)}))},refresh:function(){for(var b=0;b<fa;++b){var c=V[b];c&&(c.bindCount=0,c.unit=-1,V[b]=null),a.activeTexture(33984+b),a.bindTexture(3553,null),a.bindTexture(34067,null)}}}}function Qb(a,b,c,d,f,e){function k(a,b,c){this.target=a,this.texture=b,this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height),this.width=a,this.height=d}function p(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function u(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function l(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer))}function v(a){var b=3553,c=null,d=null,e=a;return"object"==typeof a&&(e=a.data,"target"in a&&(b=0|a.target)),"texture2d"===(a=e._reglType)||"textureCube"===a?c=e:"renderbuffer"===a&&(d=e,b=36161),new k(b,c,d)}function r(a,b,c,e,g){return c?((a=d.create2D({width:a,height:b,format:e,type:g}))._texture.refCount=0,new k(3553,a,null)):((a=f.create({width:a,height:b,format:e}))._renderbuffer.refCount=0,new k(36161,null,a))}function w(a){return a&&(a.texture||a.renderbuffer)}function m(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c),a.width=b,a.height=c)}function h(){this.id=I++,M[this.id]=this,this.framebuffer=a.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function g(a){a.colorAttachments.forEach(p),p(a.depthAttachment),p(a.stencilAttachment),p(a.depthStencilAttachment)}function t(b){a.deleteFramebuffer(b.framebuffer),b.framebuffer=null,e.framebufferCount--,delete M[b.id]}function n(b){var d;a.bindFramebuffer(36160,b.framebuffer);var e=b.colorAttachments;for(d=0;d<e.length;++d)l(36064+d,e[d]);for(d=e.length;d<c.maxColorAttachments;++d)a.framebufferTexture2D(36160,36064+d,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0),a.framebufferTexture2D(36160,36096,3553,null,0),a.framebufferTexture2D(36160,36128,3553,null,0),l(36096,b.depthAttachment),l(36128,b.stencilAttachment),l(33306,b.depthStencilAttachment),a.checkFramebufferStatus(36160),a.isContextLost(),a.bindFramebuffer(36160,q.next?q.next.framebuffer:null),q.cur=q.next,a.getError()}function C(b,c){function d(a,b){var c,e=0,h=0,q=!0,l=!0;c=null;var t=!0,m="rgba",p="uint8",k=1,C=null,E=null,pa=null,M=!1;"number"==typeof a?(e=0|a,h=0|b||e):a?("shape"in a?(e=(h=a.shape)[0],h=h[1]):("radius"in a&&(e=h=a.radius),"width"in a&&(e=a.width),"height"in a&&(h=a.height)),("color"in a||"colors"in a)&&(c=a.color||a.colors),c||("colorCount"in a&&(k=0|a.colorCount),"colorTexture"in a&&(t=!!a.colorTexture,m="rgba4"),"colorType"in a&&(p=a.colorType,!t)&&("half float"===p||"float16"===p?m="rgba16f":"float"!==p&&"float32"!==p||(m="rgba32f")),"colorFormat"in a&&(0<=na.indexOf(m=a.colorFormat)?t=!0:0<=za.indexOf(m)&&(t=!1))),("depthTexture"in a||"depthStencilTexture"in a)&&(M=!(!a.depthTexture&&!a.depthStencilTexture)),"depth"in a&&("boolean"==typeof a.depth?q=a.depth:(C=a.depth,l=!1)),"stencil"in a&&("boolean"==typeof a.stencil?l=a.stencil:(E=a.stencil,q=!1)),"depthStencil"in a&&("boolean"==typeof a.depthStencil?q=l=a.depthStencil:(pa=a.depthStencil,l=q=!1))):e=h=1;var U=null,I=null,ba=null,B=null;if(Array.isArray(c))U=c.map(v);else if(c)U=[v(c)];else for(U=Array(k),c=0;c<k;++c)U[c]=r(e,h,t,m,p);for(e=e||U[0].width,h=h||U[0].height,C?I=v(C):q&&!l&&(I=r(e,h,M,"depth","uint32")),E?ba=v(E):l&&!q&&(ba=r(e,h,!1,"stencil","uint8")),pa?B=v(pa):!C&&!E&&l&&q&&(B=r(e,h,M,"depth stencil","depth stencil")),q=null,c=0;c<U.length;++c)u(U[c]),U[c]&&U[c].texture&&(l=Za[U[c].texture._texture.format]*Ra[U[c].texture._texture.type],null===q&&(q=l));return u(I),u(ba),u(B),g(f),f.width=e,f.height=h,f.colorAttachments=U,f.depthAttachment=I,f.stencilAttachment=ba,f.depthStencilAttachment=B,d.color=U.map(w),d.depth=w(I),d.stencil=w(ba),d.depthStencil=w(B),d.width=f.width,d.height=f.height,n(f),d}var f=new h;return e.framebufferCount++,d(b,c),K(d,{resize:function(a,b){var c=Math.max(0|a,1),e=Math.max(0|b||c,1);if(c===f.width&&e===f.height)return d;for(var g=f.colorAttachments,h=0;h<g.length;++h)m(g[h],c,e);return m(f.depthAttachment,c,e),m(f.stencilAttachment,c,e),m(f.depthStencilAttachment,c,e),f.width=d.width=c,f.height=d.height=e,n(f),d},blit:function(b,c,d){a.bindFramebuffer(36008,b._framebuffer.framebuffer),a.bindFramebuffer(36009,f.framebuffer),c||(c=16384),a.blitFramebuffer(0,0,b.width,b.height,0,0,f.width,f.height,c,"linear"===d?9729:9728),a.bindFramebuffer(36008,null),a.bindFramebuffer(36009,null)},_reglType:"framebuffer",_framebuffer:f,destroy:function(){t(f),g(f)},use:function(a){q.setFBO({framebuffer:d},a)}})}var q={cur:null,next:null,dirty:!1,setFBO:null},na=["rgba"],za=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&za.push("srgba"),b.ext_color_buffer_half_float&&za.push("rgba16f","rgb16f"),b.webgl_color_buffer_float&&za.push("rgba32f");var B=["uint8"];b.oes_texture_half_float&&B.push("half float","float16"),b.oes_texture_float&&B.push("float","float32");var I=0,M={};return K(q,{getFramebuffer:function(a){return"function"==typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer)instanceof h?a:null},create:C,createCube:function(a){function b(a){var e,f={color:null},g=0,h=null;e="rgba";var q="uint8",n=1;if("number"==typeof a?g=0|a:a?("shape"in a?g=a.shape[0]:("radius"in a&&(g=0|a.radius),"width"in a?g=0|a.width:"height"in a&&(g=0|a.height)),("color"in a||"colors"in a)&&(h=a.color||a.colors),h||("colorCount"in a&&(n=0|a.colorCount),"colorType"in a&&(q=a.colorType),"colorFormat"in a&&(e=a.colorFormat)),"depth"in a&&(f.depth=a.depth),"stencil"in a&&(f.stencil=a.stencil),"depthStencil"in a&&(f.depthStencil=a.depthStencil)):g=1,h)if(Array.isArray(h))for(a=[],e=0;e<h.length;++e)a[e]=h[e];else a=[h];else for(a=Array(n),h={radius:g,format:e,type:q},e=0;e<n;++e)a[e]=d.createCube(h);for(f.color=Array(a.length),e=0;e<a.length;++e)n=a[e],g=g||n.width,f.color[e]={target:34069,data:a[e]};for(e=0;6>e;++e){for(n=0;n<a.length;++n)f.color[n].target=34069+e;0<e&&(f.depth=c[0].depth,f.stencil=c[0].stencil,f.depthStencil=c[0].depthStencil),c[e]?c[e](f):c[e]=C(f)}return K(b,{width:g,height:g,color:a})}var c=Array(6);return b(a),K(b,{faces:c,resize:function(a){var d=0|a;if(d===b.width)return b;var e=b.color;for(a=0;a<e.length;++a)e[a].resize(d);for(a=0;6>a;++a)c[a].resize(d);return b.width=b.height=d,b},_reglType:"framebufferCube",destroy:function(){c.forEach((function(a){a.destroy()}))}})},clear:function(){J(M).forEach(t)},restore:function(){q.cur=null,q.next=null,q.dirty=!0,J(M).forEach((function(b){b.framebuffer=a.createFramebuffer(),n(b)}))}})}function $a(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function Rb(a,b,c,d,f,e,k){function p(a){if(a!==t.currentVAO){var c=b.oes_vertex_array_object;c.bindVertexArrayOES(a?a.vao:null),t.currentVAO=a}}function u(c){if(c!==t.currentVAO){if(c)c.bindAttrs();else{for(var d=b.angle_instanced_arrays,e=0;e<m.length;++e){var f=m[e];f.buffer?(a.enableVertexAttribArray(e),f.buffer.bind(),a.vertexAttribPointer(e,f.size,f.type,f.normalized,f.stride,f.offfset),d&&f.divisor&&d.vertexAttribDivisorANGLE(e,f.divisor)):(a.disableVertexAttribArray(e),a.vertexAttrib4f(e,f.x,f.y,f.z,f.w))}a.bindBuffer(34963,k.elements?k.elements.buffer.buffer:null)}t.currentVAO=c}}function l(){J(g).forEach((function(a){a.destroy()}))}function v(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.offset=this.count=0,this.instances=-1,this.primitive=4;var a=b.oes_vertex_array_object;this.vao=a?a.createVertexArrayOES():null,g[this.id]=this,this.buffers=[]}function r(){b.oes_vertex_array_object&&J(g).forEach((function(a){a.refresh()}))}var w=c.maxAttributes,m=Array(w);for(c=0;c<w;++c)m[c]=new $a;var h=0,g={},t={Record:$a,scope:{},state:m,currentVAO:null,targetVAO:null,restore:b.oes_vertex_array_object?r:function(){},createVAO:function(a){function b(a){var d;Array.isArray(a)?(d=a,c.elements&&c.ownsElements&&c.elements.destroy(),c.elements=null,c.ownsElements=!1,c.offset=0,c.count=0,c.instances=-1,c.primitive=4):(a.elements?(d=a.elements,c.ownsElements?("function"==typeof d&&"elements"===d._reglType?c.elements.destroy():c.elements(d),c.ownsElements=!1):e.getElements(a.elements)?(c.elements=a.elements,c.ownsElements=!1):(c.elements=e.create(a.elements),c.ownsElements=!0)):(c.elements=null,c.ownsElements=!1),d=a.attributes,c.offset=0,c.count=-1,c.instances=-1,c.primitive=4,c.elements&&(c.count=c.elements._elements.vertCount,c.primitive=c.elements._elements.primType),"offset"in a&&(c.offset=0|a.offset),"count"in a&&(c.count=0|a.count),"instances"in a&&(c.instances=0|a.instances),"primitive"in a&&(c.primitive=Ka[a.primitive])),a={};var g=c.attributes;g.length=d.length;for(var h=0;h<d.length;++h){var m,n=d[h],l=g[h]=new $a,t=n.data||n;Array.isArray(t)||P(t)||ja(t)?(c.buffers[h]&&(m=c.buffers[h],P(t)&&m._buffer.byteLength>=t.byteLength?m.subdata(t):(m.destroy(),c.buffers[h]=null)),c.buffers[h]||(m=c.buffers[h]=f.create(n,34962,!1,!0)),l.buffer=f.getBuffer(m),l.size=0|l.buffer.dimension,l.normalized=!1,l.type=l.buffer.dtype,l.offset=0,l.stride=0,l.divisor=0,l.state=1,a[h]=1):f.getBuffer(n)?(l.buffer=f.getBuffer(n),l.size=0|l.buffer.dimension,l.normalized=!1,l.type=l.buffer.dtype,l.offset=0,l.stride=0,l.divisor=0,l.state=1):f.getBuffer(n.buffer)?(l.buffer=f.getBuffer(n.buffer),l.size=0|(+n.size||l.buffer.dimension),l.normalized=!!n.normalized||!1,l.type="type"in n?Ja[n.type]:l.buffer.dtype,l.offset=0|(n.offset||0),l.stride=0|(n.stride||0),l.divisor=0|(n.divisor||0),l.state=1):"x"in n&&(l.x=+n.x||0,l.y=+n.y||0,l.z=+n.z||0,l.w=+n.w||0,l.state=2)}for(m=0;m<c.buffers.length;++m)!a[m]&&c.buffers[m]&&(c.buffers[m].destroy(),c.buffers[m]=null);return c.refresh(),b}var c=new v;return d.vaoCount+=1,b.destroy=function(){for(var a=0;a<c.buffers.length;++a)c.buffers[a]&&c.buffers[a].destroy();c.buffers.length=0,c.ownsElements&&(c.elements.destroy(),c.elements=null,c.ownsElements=!1),c.destroy()},b._vao=c,b._reglType="vao",b(a)},getVAO:function(a){return"function"==typeof a&&a._vao?a._vao:null},destroyBuffer:function(b){for(var c=0;c<m.length;++c){var d=m[c];d.buffer===b&&(a.disableVertexAttribArray(c),d.buffer=null)}},setVAO:b.oes_vertex_array_object?p:u,clear:b.oes_vertex_array_object?l:function(){}};return v.prototype.bindAttrs=function(){for(var c=b.angle_instanced_arrays,d=this.attributes,f=0;f<d.length;++f){var g=d[f];g.buffer?(a.enableVertexAttribArray(f),a.bindBuffer(34962,g.buffer.buffer),a.vertexAttribPointer(f,g.size,g.type,g.normalized,g.stride,g.offset),c&&g.divisor&&c.vertexAttribDivisorANGLE(f,g.divisor)):(a.disableVertexAttribArray(f),a.vertexAttrib4f(f,g.x,g.y,g.z,g.w))}for(c=d.length;c<w;++c)a.disableVertexAttribArray(c);(c=e.getElements(this.elements))?a.bindBuffer(34963,c.buffer.buffer):a.bindBuffer(34963,null)},v.prototype.refresh=function(){var a=b.oes_vertex_array_object;a&&(a.bindVertexArrayOES(this.vao),this.bindAttrs(),t.currentVAO=null,a.bindVertexArrayOES(null))},v.prototype.destroy=function(){if(this.vao){var a=b.oes_vertex_array_object;this===t.currentVAO&&(t.currentVAO=null,a.bindVertexArrayOES(null)),a.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),g[this.id]&&(delete g[this.id],--d.vaoCount)},t}function Sb(a,b,c,d){function f(a,b,c,d){this.name=a,this.id=b,this.location=c,this.info=d}function e(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id)return void(a[c].location=b.location);a.push(b)}function k(c,d,e){if(!(f=(e=35632===c?l:v)[d])){var m=b.str(d),f=a.createShader(c);a.shaderSource(f,m),a.compileShader(f),e[d]=f}return f}function p(a,b){this.id=m++,this.fragId=a,this.vertId=b,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,d.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(c,g,l){var m;m=k(35632,c.fragId);var p=k(35633,c.vertId);if(g=c.program=a.createProgram(),a.attachShader(g,m),a.attachShader(g,p),l)for(m=0;m<l.length;++m)a.bindAttribLocation(g,(p=l[m])[0],p[1]);a.linkProgram(g),p=a.getProgramParameter(g,35718),d.profile&&(c.stats.uniformsCount=p);var r=c.uniforms;for(m=0;m<p;++m)if(l=a.getActiveUniform(g,m)){if(1<l.size)for(var u=0;u<l.size;++u){var v=l.name.replace("[0]","["+u+"]");e(r,new f(v,b.id(v),a.getUniformLocation(g,v),l))}u=l.name,1<l.size&&(u=u.replace("[0]","")),e(r,new f(u,b.id(u),a.getUniformLocation(g,u),l))}for(p=a.getProgramParameter(g,35721),d.profile&&(c.stats.attributesCount=p),c=c.attributes,m=0;m<p;++m)(l=a.getActiveAttrib(g,m))&&e(c,new f(l.name,b.id(l.name),a.getAttribLocation(g,l.name),l))}var l={},v={},r={},w=[],m=0;return d.profile&&(c.getMaxUniformsCount=function(){var a=0;return w.forEach((function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)})),a},c.getMaxAttributesCount=function(){var a=0;return w.forEach((function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)})),a}),{clear:function(){var b=a.deleteShader.bind(a);J(l).forEach(b),l={},J(v).forEach(b),v={},w.forEach((function(b){a.deleteProgram(b.program)})),w.length=0,r={},c.shaderCount=0},program:function(b,d,e,f){var m=r[d];m||(m=r[d]={});var q=m[b];if(q&&(q.refCount++,!f))return q;var k=new p(d,b);return c.shaderCount++,u(k,e,f),q||(m[b]=k),w.push(k),K(k,{destroy:function(){if(k.refCount--,0>=k.refCount){a.deleteProgram(k.program);var b=w.indexOf(k);w.splice(b,1),c.shaderCount--}0>=m[k.vertId].refCount&&(a.deleteShader(v[k.vertId]),delete v[k.vertId],delete r[k.fragId][k.vertId]),Object.keys(r[k.fragId]).length||(a.deleteShader(l[k.fragId]),delete l[k.fragId],delete r[k.fragId])}})},restore:function(){l={},v={};for(var a=0;a<w.length;++a)u(w[a],null,w[a].attributes.map((function(a){return[a.location,a.name]})))},shader:k,frag:-1,vert:-1}}function Tb(a,b,c,d,f,e,k){function p(e){var f;f=null===b.next?5121:b.next.colorAttachments[0].texture._texture.type;var p=0,k=0,m=d.framebufferWidth,h=d.framebufferHeight,g=null;return P(e)?g=e:e&&(p=0|e.x,k=0|e.y,m=0|(e.width||d.framebufferWidth-p),h=0|(e.height||d.framebufferHeight-k),g=e.data||null),c(),e=m*h*4,g||(5121===f?g=new Uint8Array(e):5126===f&&(g=g||new Float32Array(e))),a.pixelStorei(3333,4),a.readPixels(p,k,m,h,6408,f,g),g}function u(a){var c;return b.setFBO({framebuffer:a.framebuffer},(function(){c=p(a)})),c}return function(a){return a&&"framebuffer"in a?u(a):p(a)}}function Ca(a){return Array.prototype.slice.call(a)}function Da(a){return Ca(a).join("")}function Ub(){function a(){var a=[],b=[];return K((function(){a.push.apply(a,Ca(arguments))}),{def:function(){var d="v"+c++;return b.push(d),0<arguments.length&&(a.push(d,"="),a.push.apply(a,Ca(arguments)),a.push(";")),d},toString:function(){return Da([0<b.length?"var "+b.join(",")+";":"",Da(a)])}})}function b(){function b(a,e){d(a,e,"=",c.def(a,e),";")}var c=a(),d=a(),e=c.toString,f=d.toString;return K((function(){c.apply(c,Ca(arguments))}),{def:c.def,entry:c,exit:d,save:b,set:function(a,d,e){b(a,d),c(a,d,"=",e,";")},toString:function(){return e()+f()}})}var c=0,d=[],f=[],e=a(),k={};return{global:e,link:function(a){for(var b=0;b<f.length;++b)if(f[b]===a)return d[b];return b="g"+c++,d.push(b),f.push(a),b},block:a,proc:function(a,c){function d(){var a="a"+e.length;return e.push(a),a}var e=[];c=c||0;for(var f=0;f<c;++f)d();var w=(f=b()).toString;return k[a]=K(f,{arg:d,toString:function(){return Da(["function(",e.join(),"){",w(),"}"])}})},scope:b,cond:function(){var a=Da(arguments),c=b(),d=b(),e=c.toString,f=d.toString;return K(c,{then:function(){return c.apply(c,Ca(arguments)),this},else:function(){return d.apply(d,Ca(arguments)),this},toString:function(){var b=f();return b&&(b="else{"+b+"}"),Da(["if(",a,"){",e(),"}",b])}})},compile:function(){var a=['"use strict";',e,"return {"];Object.keys(k).forEach((function(b){a.push('"',b,'":',k[b].toString(),",")})),a.push("}");var b=Da(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,d.concat(b)).apply(null,f)}}}function Sa(a){return Array.isArray(a)||P(a)||ja(a)}function yb(a){return a.sort((function(a,c){return"viewport"===a?-1:"viewport"===c?1:a<c?-1:1}))}function H(a,b,c,d){this.thisDep=a,this.contextDep=b,this.propDep=c,this.append=d}function xa(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function B(a){return new H(!1,!1,!1,a)}function L(a,b){var c=a.type;if(0===c)return new H(!0,1<=(c=a.data.length),2<=c,b);if(4===c)return new H((c=a.data).thisDep,c.contextDep,c.propDep,b);if(5===c)return new H(!1,!1,!1,b);if(6===c){for(var d=c=!1,f=!1,e=0;e<a.data.length;++e){var k=a.data[e];1===k.type?f=!0:2===k.type?d=!0:3===k.type?c=!0:0===k.type?(c=!0,1<=(k=k.data)&&(d=!0),2<=k&&(f=!0)):4===k.type&&(c=c||k.data.thisDep,d=d||k.data.contextDep,f=f||k.data.propDep)}return new H(c,d,f,b)}return new H(3===c,2===c,1===c,b)}function Vb(a,b,c,d,f,e,k,p,u,l,v,r,w,m,h){function g(a){return a.replace(".","_")}function t(a,b,c){var d=g(a);Na.push(a),Fa[d]=ua[d]=!!c,va[d]=b}function n(a,b,c){var d=g(a);Na.push(a),Array.isArray(c)?(ua[d]=c.slice(),Fa[d]=c.slice()):ua[d]=Fa[d]=c,wa[d]=b}function C(){var a=Ub(),c=a.link,d=a.global;a.id=ta++,a.batchId="0";var e=c(tb),f=a.shared={props:"a0"};Object.keys(tb).forEach((function(a){f[a]=d.def(e,".",a)}));var g=a.next={},da=a.current={};Object.keys(wa).forEach((function(a){Array.isArray(ua[a])&&(g[a]=d.def(f.next,".",a),da[a]=d.def(f.current,".",a))}));var y=a.constants={};Object.keys(Pa).forEach((function(a){y[a]=d.def(JSON.stringify(Pa[a]))})),a.invoke=function(b,d){switch(d.type){case 0:var e=["this",f.context,f.props,a.batchId];return b.def(c(d.data),".call(",e.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(f.props,d.data);case 2:return b.def(f.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref;case 5:return d.data.toString();case 6:return d.data.map((function(c){return a.invoke(b,c)}))}},a.attribCache={};var aa={};return a.scopeAttrib=function(a){if((a=b.id(a))in aa)return aa[a];var d=l.scope[a];return d||(d=l.scope[a]=new ea),aa[a]=c(d)},a}function q(a){var c,b=a.static;if(a=a.dynamic,"profile"in b){var d=!!b.profile;(c=B((function(a,b){return d}))).enable=d}else if("profile"in a){var e=a.profile;c=L(e,(function(a,b){return a.invoke(b,e)}))}return c}function D(a,b){var c=a.static,d=a.dynamic;if("framebuffer"in c){var e=c.framebuffer;return e?(e=p.getFramebuffer(e),B((function(a,b){var c=a.link(e),d=a.shared;return b.set(d.framebuffer,".next",c),b.set(d=d.context,".framebufferWidth",c+".width"),b.set(d,".framebufferHeight",c+".height"),c}))):B((function(a,b){var c=a.shared;return b.set(c.framebuffer,".next","null"),b.set(c=c.context,".framebufferWidth",c+".drawingBufferWidth"),b.set(c,".framebufferHeight",c+".drawingBufferHeight"),"null"}))}if("framebuffer"in d){var f=d.framebuffer;return L(f,(function(a,b){var c=a.invoke(b,f),d=a.shared,e=d.framebuffer;return c=b.def(e,".getFramebuffer(",c,")"),b.set(e,".next",c),b.set(d=d.context,".framebufferWidth",c+"?"+c+".width:"+d+".drawingBufferWidth"),b.set(d,".framebufferHeight",c+"?"+c+".height:"+d+".drawingBufferHeight"),c}))}return null}function G(a,b,c){function d(a){if(a in e){var c=e[a];a=!0;var h,da,x=0|c.x,g=0|c.y;return"width"in c?h=0|c.width:a=!1,"height"in c?da=0|c.height:a=!1,new H(!a&&b&&b.thisDep,!a&&b&&b.contextDep,!a&&b&&b.propDep,(function(a,b){var d=a.shared.context,e=h;"width"in c||(e=b.def(d,".","framebufferWidth","-",x));var f=da;return"height"in c||(f=b.def(d,".","framebufferHeight","-",g)),[x,g,e,f]}))}if(a in f){var ha=f[a];return a=L(ha,(function(a,b){var c=a.invoke(b,ha),d=a.shared.context,e=b.def(c,".x|0"),f=b.def(c,".y|0");return[e,f,b.def('"width" in ',c,"?",c,".width|0:","(",d,".","framebufferWidth","-",e,")"),c=b.def('"height" in ',c,"?",c,".height|0:","(",d,".","framebufferHeight","-",f,")")]})),b&&(a.thisDep=a.thisDep||b.thisDep,a.contextDep=a.contextDep||b.contextDep,a.propDep=a.propDep||b.propDep),a}return b?new H(b.thisDep,b.contextDep,b.propDep,(function(a,b){var c=a.shared.context;return[0,0,b.def(c,".","framebufferWidth"),b.def(c,".","framebufferHeight")]})):null}var e=a.static,f=a.dynamic;if(a=d("viewport")){var g=a;a=new H(a.thisDep,a.contextDep,a.propDep,(function(a,b){var c=g.append(a,b),d=a.shared.context;return b.set(d,".viewportWidth",c[2]),b.set(d,".viewportHeight",c[3]),c}))}return{viewport:a,scissor_box:d("scissor.box")}}function P(a,b){if("string"==typeof(c=a.static).frag&&"string"==typeof c.vert){if(0<Object.keys(b.dynamic).length)return null;var c=b.static,d=Object.keys(c);if(0<d.length&&"number"==typeof c[d[0]]){for(var e=[],f=0;f<d.length;++f)e.push([0|c[d[f]],d[f]]);return e}}return null}function I(a,c,d){function e(a){if(a in f){var c=b.id(f[a]);return(a=B((function(){return c}))).id=c,a}if(a in g){var d=g[a];return L(d,(function(a,b){var c=a.invoke(b,d);return b.def(a.shared.strings,".id(",c,")")}))}return null}var f=a.static,g=a.dynamic,h=e("frag"),y=e("vert"),aa=null;return xa(h)&&xa(y)?(aa=v.program(y.id,h.id,null,d),a=B((function(a,b){return a.link(aa)}))):a=new H(h&&h.thisDep||y&&y.thisDep,h&&h.contextDep||y&&y.contextDep,h&&h.propDep||y&&y.propDep,(function(a,b){var d,e,c=a.shared.shader;return d=h?h.append(a,b):b.def(c,".","frag"),e=y?y.append(a,b):b.def(c,".","vert"),b.def(c+".program("+e+","+d+")")})),{frag:h,vert:y,progVar:a,program:aa}}function M(a,b){function c(a,b){if(a in d){var e=0|d[a];return b?g.offset=e:g.instances=e,B((function(a,c){return b&&(a.OFFSET=e),e}))}if(a in f){var x=f[a];return L(x,(function(a,c){var d=a.invoke(c,x);return b&&(a.OFFSET=d),d}))}if(b){if(aa)return B((function(a,b){return a.OFFSET=0}));if(h)return new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.offset:0")}))}else if(h)return new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.instances:-1")}));return null}var d=a.static,f=a.dynamic,g={},h=!1,y=function(){if("vao"in d){var a=d.vao;return null!==a&&null===l.getVAO(a)&&(a=l.createVAO(a)),h=!0,g.vao=a,B((function(b){var c=l.getVAO(a);return c?b.link(c):"null"}))}if("vao"in f){h=!0;var b=f.vao;return L(b,(function(a,c){var d=a.invoke(c,b);return c.def(a.shared.vao+".getVAO("+d+")")}))}return null}(),aa=!1,X=function(){if("elements"in d){if(g.elements=a=d.elements,Sa(a)){var b=g.elements=e.create(a,!0),a=e.getElements(b);aa=!0}else a&&(a=e.getElements(a),aa=!0);return b=B((function(b,c){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null})),b.value=a,b}if("elements"in f){aa=!0;var c=f.elements;return L(c,(function(a,b){var e=(d=a.shared).isBufferArgs,d=d.elements,f=a.invoke(b,c),x=b.def("null");return e=b.def(e,"(",f,")"),f=a.cond(e).then(x,"=",d,".createStream(",f,");").else(x,"=",d,".getElements(",f,");"),b.entry(f),b.exit(a.cond(e).then(d,".destroyStream(",x,");")),a.ELEMENTS=x}))}return h?new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.elements+".getElements("+a.shared.vao+".currentVAO.elements):null")})):null}(),ya=c("offset",!0),m=function(){if("primitive"in d){var a=d.primitive;return g.primitive=a,B((function(b,c){return Ka[a]}))}if("primitive"in f){var b=f.primitive;return L(b,(function(a,c){var d=a.constants.primTypes,e=a.invoke(c,b);return c.def(d,"[",e,"]")}))}return aa?xa(X)?B(X.value?function(a,b){return b.def(a.ELEMENTS,".primType")}:function(){return 4}):new H(X.thisDep,X.contextDep,X.propDep,(function(a,b){var c=a.ELEMENTS;return b.def(c,"?",c,".primType:",4)})):h?new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.primitive:4")})):null}(),n=function(){if("count"in d){var a=0|d.count;return g.count=a,B((function(){return a}))}if("count"in f){var b=f.count;return L(b,(function(a,c){return a.invoke(c,b)}))}return aa?xa(X)?X?ya?new H(ya.thisDep,ya.contextDep,ya.propDep,(function(a,b){return b.def(a.ELEMENTS,".vertCount-",a.OFFSET)})):B((function(a,b){return b.def(a.ELEMENTS,".vertCount")})):B((function(){return-1})):new H(X.thisDep||ya.thisDep,X.contextDep||ya.contextDep,X.propDep||ya.propDep,(function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")})):h?new H(y.thisDep,y.contextDep,y.propDep,(function(a,b){return b.def(a.shared.vao,".currentVAO?",a.shared.vao,".currentVAO.count:-1")})):null}(),k=c("instances",!1);return{elements:X,primitive:m,count:n,instances:k,offset:ya,vao:y,vaoActive:h,elementsActive:aa,static:g}}function E(a,b){var c=a.static,d=a.dynamic,e={};return Na.forEach((function(a){function b(x,g){if(a in c){var O=x(c[a]);e[f]=B((function(){return O}))}else if(a in d){var h=d[a];e[f]=L(h,(function(a,b){return g(a,b,a.invoke(b,h))}))}}var f=g(a);switch(a){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":case"lineWidth":return b((function(a){return a}),(function(a,b,c){return c}));case"depth.func":return b((function(a){return ab[a]}),(function(a,b,c){return b.def(a.constants.compareFuncs,"[",c,"]")}));case"depth.range":return b((function(a){return a}),(function(a,b,c){return[b.def("+",c,"[0]"),b=b.def("+",c,"[1]")]}));case"blend.func":return b((function(a){return[Ga["srcRGB"in a?a.srcRGB:a.src],Ga["dstRGB"in a?a.dstRGB:a.dst],Ga["srcAlpha"in a?a.srcAlpha:a.src],Ga["dstAlpha"in a?a.dstAlpha:a.dst]]}),(function(a,b,c){function d(a,e){return b.def('"',a,e,'" in ',c,"?",c,".",a,e,":",c,".",a)}a=a.constants.blendFuncs;var e=d("src","RGB"),f=d("dst","RGB"),x=(e=b.def(a,"[",e,"]"),b.def(a,"[",d("src","Alpha"),"]"));return[e,f=b.def(a,"[",f,"]"),x,a=b.def(a,"[",d("dst","Alpha"),"]")]}));case"blend.equation":return b((function(a){return"string"==typeof a?[fa[a],fa[a]]:"object"==typeof a?[fa[a.rgb],fa[a.alpha]]:void 0}),(function(a,b,c){var d=a.constants.blendEquations,e=b.def(),f=b.def();return(a=a.cond("typeof ",c,'==="string"')).then(e,"=",f,"=",d,"[",c,"];"),a.else(e,"=",d,"[",c,".rgb];",f,"=",d,"[",c,".alpha];"),b(a),[e,f]}));case"blend.color":return b((function(a){return S(4,(function(b){return+a[b]}))}),(function(a,b,c){return S(4,(function(a){return b.def("+",c,"[",a,"]")}))}));case"stencil.mask":return b((function(a){return 0|a}),(function(a,b,c){return b.def(c,"|0")}));case"stencil.func":return b((function(a){return[ab[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]}),(function(a,b,c){return[a=b.def('"cmp" in ',c,"?",a.constants.compareFuncs,"[",c,".cmp]",":",7680),b.def(c,".ref|0"),b=b.def('"mask" in ',c,"?",c,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return b((function(b){return["stencil.opBack"===a?1029:1028,Ta[b.fail||"keep"],Ta[b.zfail||"keep"],Ta[b.zpass||"keep"]]}),(function(b,c,d){function e(a){return c.def('"',a,'" in ',d,"?",f,"[",d,".",a,"]:",7680)}var f=b.constants.stencilOps;return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]}));case"polygonOffset.offset":return b((function(a){return[0|a.factor,0|a.units]}),(function(a,b,c){return[b.def(c,".factor|0"),b=b.def(c,".units|0")]}));case"cull.face":return b((function(a){var b=0;return"front"===a?b=1028:"back"===a&&(b=1029),b}),(function(a,b,c){return b.def(c,'==="front"?',1028,":",1029)}));case"frontFace":return b((function(a){return zb[a]}),(function(a,b,c){return b.def(c+'==="cw"?2304:2305')}));case"colorMask":return b((function(a){return a.map((function(a){return!!a}))}),(function(a,b,c){return S(4,(function(a){return"!!"+c+"["+a+"]"}))}));case"sample.coverage":return b((function(a){return["value"in a?a.value:1,!!a.invert]}),(function(a,b,c){return[b.def('"value" in ',c,"?+",c,".value:1"),b=b.def("!!",c,".invert")]}))}})),e}function ba(a,b){var c=a.static,d=a.dynamic,e={};return Object.keys(c).forEach((function(a){var d,b=c[a];if("number"==typeof b||"boolean"==typeof b)d=B((function(){return b}));else if("function"==typeof b){var f=b._reglType;"texture2d"===f||"textureCube"===f?d=B((function(a){return a.link(b)})):"framebuffer"!==f&&"framebufferCube"!==f||(d=B((function(a){return a.link(b.color[0])})))}else ra(b)&&(d=B((function(a){return a.global.def("[",S(b.length,(function(a){return b[a]})),"]")})));d.value=b,e[a]=d})),Object.keys(d).forEach((function(a){var b=d[a];e[a]=L(b,(function(a,c){return a.invoke(c,b)}))})),e}function R(a,c){var d=a.static,e=a.dynamic,g={};return Object.keys(d).forEach((function(a){var c=d[a],e=b.id(a),x=new ea;if(Sa(c))x.state=1,x.buffer=f.getBuffer(f.create(c,34962,!1,!0)),x.type=0;else if(h=f.getBuffer(c))x.state=1,x.buffer=h,x.type=0;else if("constant"in c){var O=c.constant;x.buffer="null",x.state=2,"number"==typeof O?x.x=O:Ea.forEach((function(a,b){b<O.length&&(x[a]=O[b])}))}else{var h=Sa(c.buffer)?f.getBuffer(f.create(c.buffer,34962,!1,!0)):f.getBuffer(c.buffer),l=0|c.offset,m=0|c.stride,n=0|c.size,k=!!c.normalized,oa=0;"type"in c&&(oa=Ja[c.type]),c=0|c.divisor,x.buffer=h,x.state=1,x.size=n,x.normalized=k,x.type=oa||h.dtype,x.offset=l,x.stride=m,x.divisor=c}g[a]=B((function(a,b){var c=a.attribCache;if(e in c)return c[e];var d={isStream:!1};return Object.keys(x).forEach((function(a){d[a]=x[a]})),x.buffer&&(d.buffer=a.link(x.buffer),d.type=d.type||d.buffer+".dtype"),c[e]=d}))})),Object.keys(e).forEach((function(a){var b=e[a];g[a]=L(b,(function(a,c){function d(a){c(h[a],"=",e,".",a,"|0;")}var e=a.invoke(c,b),x=a.constants,g=(f=a.shared).isBufferArgs,f=f.buffer,h={isStream:c.def(!1)},O=new ea;O.state=1,Object.keys(O).forEach((function(a){h[a]=c.def(""+O[a])}));var l=h.buffer,m=h.type;return c("if(",g,"(",e,")){",h.isStream,"=true;",l,"=",f,".createStream(",34962,",",e,");",m,"=",l,".dtype;","}else{",l,"=",f,".getBuffer(",e,");","if(",l,"){",m,"=",l,".dtype;",'}else if("constant" in ',e,"){",h.state,"=",2,";","if(typeof "+e+'.constant === "number"){',h[Ea[0]],"=",e,".constant;",Ea.slice(1).map((function(a){return h[a]})).join("="),"=0;","}else{",Ea.map((function(a,b){return h[a]+"="+e+".constant.length>"+b+"?"+e+".constant["+b+"]:0;"})).join(""),"}}else{","if(",g,"(",e,".buffer)){",l,"=",f,".createStream(",34962,",",e,".buffer);","}else{",l,"=",f,".getBuffer(",e,".buffer);","}",m,'="type" in ',e,"?",x.glTypes,"[",e,".type]:",l,".dtype;",h.normalized,"=!!",e,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),c("}}"),c.exit("if(",h.isStream,"){",f,".destroyStream(",l,");","}"),h}))})),g}function z(a){var b=a.static,c=a.dynamic,d={};return Object.keys(b).forEach((function(a){var c=b[a];d[a]=B((function(a,b){return"number"==typeof c||"boolean"==typeof c?""+c:a.link(c)}))})),Object.keys(c).forEach((function(a){var b=c[a];d[a]=L(b,(function(a,c){return a.invoke(c,b)}))})),d}function A(a,b,d,e,f){function h(a){var b=n[a];b&&(k[a]=b)}var m=P(a,b),n=G(a,y=D(a)),X=M(a),k=E(a),p=I(a,f,m);h("viewport"),h(g("scissor.box"));var y,r=0<Object.keys(k).length;if((y={framebuffer:y,draw:X,shader:p,state:k,dirty:r,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=q(a),y.uniforms=ba(d),y.drawVAO=y.scopeVAO=X.vao,!y.drawVAO&&p.program&&!m&&c.angle_instanced_arrays&&X.static.elements){var t=!0;if(a=p.program.attributes.map((function(a){return a=b.static[a],t=t&&!!a,a})),t&&0<a.length){var v=l.getVAO(l.createVAO({attributes:a,elements:X.static.elements}));y.drawVAO=new H(null,null,null,(function(a,b){return a.link(v)})),y.useVAO=!0}}return m?y.useVAO=!0:y.attributes=R(b),y.context=z(e),y}function ia(a,b,c){var d=a.shared.context,e=a.scope();Object.keys(c).forEach((function(f){b.save(d,"."+f);var g=c[f].append(a,b);Array.isArray(g)?e(d,".",f,"=[",g.join(),"];"):e(d,".",f,"=",g,";")})),b(e)}function Q(a,b,c,d){var h,f=(e=a.shared).gl,g=e.framebuffer;Ma&&(h=b.def(e.extensions,".webgl_draw_buffers"));var e=(l=a.constants).drawBuffer,l=l.backBuffer;a=c?c.append(a,b):b.def(g,".next"),d||b("if(",a,"!==",g,".cur){"),b("if(",a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);"),Ma&&b(h,".drawBuffersWEBGL(",e,"[",a,".colorAttachments.length]);"),b("}else{",f,".bindFramebuffer(",36160,",null);"),Ma&&b(h,".drawBuffersWEBGL(",l,");"),b("}",g,".cur=",a,";"),d||b("}")}function Aa(a,b,c){var d=a.shared,e=d.gl,f=a.current,h=a.next,l=d.current,m=d.next,k=a.cond(l,".dirty");Na.forEach((function(b){var d,O;if(!((b=g(b))in c.state))if(b in h){d=h[b],O=f[b];var n=S(ua[b].length,(function(a){return k.def(d,"[",a,"]")}));k(a.cond(n.map((function(a,b){return a+"!=="+O+"["+b+"]"})).join("||")).then(e,".",wa[b],"(",n,");",n.map((function(a,b){return O+"["+b+"]="+a})).join(";"),";"))}else d=k.def(m,".",b),n=a.cond(d,"!==",l,".",b),k(n),b in va?n(a.cond(d).then(e,".enable(",va[b],");").else(e,".disable(",va[b],");"),l,".",b,"=",d,";"):n(e,".",wa[b],"(",d,");",l,".",b,"=",d,";")})),0===Object.keys(c.state).length&&k(l,".dirty=false;"),b(k)}function J(a,b,c,d){var e=a.shared,f=a.current,g=e.current,h=e.gl;yb(Object.keys(c)).forEach((function(e){var l=c[e];if(!d||d(l)){var m=l.append(a,b);if(va[e]){var k=va[e];xa(l)?b(h,m?".enable(":".disable(",k,");"):b(a.cond(m).then(h,".enable(",k,");").else(h,".disable(",k,");")),b(g,".",e,"=",m,";")}else if(ra(m)){var n=f[e];b(h,".",wa[e],"(",m,");",m.map((function(a,b){return n+"["+b+"]="+a})).join(";"),";")}else b(h,".",wa[e],"(",m,");",g,".",e,"=",m,";")}}))}function N(a,b){V&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function F(a,b,c,d,e){function f(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function g(a){a(q=b.def(),"=",f(),";"),"string"==typeof e?a(n,".count+=",e,";"):a(n,".count++;"),m&&(d?a(t=b.def(),"=",r,".getNumPendingQueries();"):a(r,".beginQuery(",n,");"))}function h(a){a(n,".cpuTime+=",f(),"-",q,";"),m&&(d?a(r,".pushScopeStats(",t,",",r,".getNumPendingQueries(),",n,");"):a(r,".endQuery();"))}function l(a){var c=b.def(p,".profile");b(p,".profile=",a,";"),b.exit(p,".profile=",c,";")}var q,t,k=a.shared,n=a.stats,p=k.current,r=k.timer;if(c=c.profile){if(xa(c))return void(c.enable?(g(b),h(b.exit),l("true")):l("false"));l(c=c.append(a,b))}else c=b.def(p,".profile");g(k=a.block()),b("if(",c,"){",k,"}"),h(a=a.block()),b.exit("if(",c,"){",a,"}")}function ga(a,b,c,d,e){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(c,d,e){function f(){b(m,".enableVertexAttribArray(",k,");");var g,c=e.type;g=e.size?b.def(e.size,"||",d):d,b(m,".bindBuffer(",34962,",",p,".buffer);",m,".vertexAttribPointer(",[k,g,c,e.normalized,e.stride,e.offset],");",n,".type=",c,";",n,".size=",g,";",ha.map((function(a){return n+"."+a+"="+e[a]+";"})).join("")),V&&b("if(",n,".divisor!==",c=e.divisor,"){",a.instancing,".vertexAttribDivisorANGLE(",[k,c],");",n,".divisor=",c,";}")}function l(){b("if(",n,".buffer){",m,".disableVertexAttribArray(",k,");",n,".buffer=null;","}if(",Ea.map((function(a,b){return n+"."+a+"!=="+r[b]})).join("||"),"){",m,".vertexAttrib4f(",k,",",r,");",Ea.map((function(a,b){return n+"."+a+"="+r[b]+";"})).join(""),"}")}var m=h.gl,k=b.def(c,".location"),n=b.def(h.attributes,"[",k,"]"),p=e.buffer,r=[e.x,e.y,e.z,e.w],ha=["buffer","normalized","offset","stride"];1===(c=e.state)?f():2===c?l():(b("if(",c,"===",1,"){"),f(),b("}else{"),l(),b("}"))}var h=a.shared;d.forEach((function(d){var m,h=d.name,l=c.attributes[h];if(l){if(!e(l))return;m=l.append(a,b)}else{if(!e(Ab))return;var k=a.scopeAttrib(h);m={},Object.keys(new ea).forEach((function(a){m[a]=b.def(k,".",a)}))}g(a.link(d),f(d.info.type),m)}))}function T(a,c,d,e,f,g){for(var k,h=a.shared,l=h.gl,m={},n=0;n<e.length;++n){var r=(p=e[n]).name,q=p.info.type,v=d.uniforms[r];if(1<(t=p.info.size)){if(!v)continue;var u=r.replace("[0]","");if(m[u])continue;m[u]=1}var w,p=a.link(p)+".location";if(v){if(!f(v))continue;if(xa(v)){if(r=v.value,35678===q||35680===q)c(l,".uniform1i(",p,",",(q=a.link(r._texture||r.color[0]._texture))+".bind());"),c.exit(q,".unbind();");else if(35674===q||35675===q||35676===q)t=a.global.def("new Float32Array(["+Array.prototype.slice.call(r)+"])"),r=2,35675===q?r=3:35676===q&&(r=4),c(l,".uniformMatrix",r,"fv(",p,",false,",t,");");else{switch(q){case 5126:k="1f";break;case 35664:k="2f";break;case 35665:k="3f";break;case 35666:k="4f";break;case 35670:case 5124:k="1i";break;case 35671:case 35667:k="2i";break;case 35672:case 35668:k="3i";break;case 35673:case 35669:k="4i"}1<t?(k+="v",r=a.global.def("["+Array.prototype.slice.call(r)+"]")):r=ra(r)?Array.prototype.slice.call(r):r,c(l,".uniform",k,"(",p,",",r,");")}continue}w=v.append(a,c)}else{if(!f(Ab))continue;w=c.def(h.uniforms,"[",b.id(r),"]")}switch(35678===q?c("if(",w,"&&",w,'._reglType==="framebuffer"){',w,"=",w,".color[0];","}"):35680===q&&c("if(",w,"&&",w,'._reglType==="framebufferCube"){',w,"=",w,".color[0];","}"),r=1,q){case 35678:case 35680:q=c.def(w,"._texture"),c(l,".uniform1i(",p,",",q,".bind());"),c.exit(q,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2i",r=2;break;case 35668:case 35672:k="3i",r=3;break;case 35669:case 35673:k="4i",r=4;break;case 5126:k="1f";break;case 35664:k="2f",r=2;break;case 35665:k="3f",r=3;break;case 35666:k="4f",r=4;break;case 35674:k="Matrix2fv";break;case 35675:k="Matrix3fv";break;case 35676:k="Matrix4fv"}if(-1===k.indexOf("Matrix")&&1<t&&(k+="v",r=1),"M"===k.charAt(0)){c(l,".uniform",k,"(",p,","),p=Math.pow(q-35674+2,2);var C=a.global.def("new Float32Array(",p,")");Array.isArray(w)?c("false,(",S(p,(function(a){return C+"["+a+"]="+w[a]})),",",C,")"):c("false,(Array.isArray(",w,")||",w," instanceof Float32Array)?",w,":(",S(p,(function(a){return C+"["+a+"]="+w+"["+a+"]"})),",",C,")"),c(");")}else{if(1<r){q=[];for(var ma=[],t=0;t<r;++t)Array.isArray(w)?ma.push(w[t]):ma.push(c.def(w+"["+t+"]")),g&&q.push(c.def());g&&c("if(!",a.batchId,"||",q.map((function(a,b){return a+"!=="+ma[b]})).join("||"),"){",q.map((function(a,b){return a+"="+ma[b]+";"})).join("")),c(l,".uniform",k,"(",p,",",ma.join(","),");")}else g&&(q=c.def(),c("if(!",a.batchId,"||",q,"!==",w,"){",q,"=",w,";")),c(l,".uniform",k,"(",p,",",w,");");g&&c("}")}}}function W(a,b,c,d){function e(f){var g=m[f];return g?g.append(a,g.contextDep&&d.contextDynamic||g.propDep?c:b):b.def(k,".",f)}function f(){function a(){c(v,".drawElementsInstancedANGLE(",[r,q,w,p+"<<(("+w+"-5121)>>1)",t],");")}function b(){c(v,".drawArraysInstancedANGLE(",[r,p,q,t],");")}n&&"null"!==n?u?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}function g(){function a(){c(l+".drawElements("+[r,q,w,p+"<<(("+w+"-5121)>>1)"]+");")}function b(){c(l+".drawArrays("+[r,p,q]+");")}n&&"null"!==n?u?a():(c("if(",n,"){"),a(),c("}else{"),b(),c("}")):b()}var t,v,h=a.shared,l=h.gl,k=h.draw,m=d.draw,n=function(){var e=m.elements,f=b;return e?((e.contextDep&&d.contextDynamic||e.propDep)&&(f=c),e=e.append(a,f),m.elementsActive&&f("if("+e+")"+l+".bindBuffer(34963,"+e+".buffer.buffer);")):(e=f.def(),f(e,"=",k,".","elements",";","if(",e,"){",l,".bindBuffer(",34963,",",e,".buffer.buffer);}","else if(",h.vao,".currentVAO){",e,"=",a.shared.elements+".getElements("+h.vao,".currentVAO.elements);",sa?"":"if("+e+")"+l+".bindBuffer(34963,"+e+".buffer.buffer);","}")),e}(),r=e("primitive"),p=e("offset"),q=function(){var e=m.count,f=b;return e?((e.contextDep&&d.contextDynamic||e.propDep)&&(f=c),e=e.append(a,f)):e=f.def(k,".","count"),e}();if("number"==typeof q){if(0===q)return}else c("if(",q,"){"),c.exit("}");V&&(t=e("instances"),v=a.instancing);var w=n+".type",u=m.elements&&xa(m.elements)&&!m.vaoActive;V&&("number"!=typeof t||0<=t)?"string"==typeof t?(c("if(",t,">0){"),f(),c("}else if(",t,"<0){"),g(),c("}")):f():g()}function ca(a,b,c,d,e){return e=(b=C()).proc("body",e),V&&(b.instancing=e.def(b.shared.extensions,".angle_instanced_arrays")),a(b,e,c,d),b.compile().body}function Z(a,b,c,d){N(a,b),c.useVAO?c.drawVAO?b(a.shared.vao,".setVAO(",c.drawVAO.append(a,b),");"):b(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(b(a.shared.vao,".setVAO(null);"),ga(a,b,c,d.attributes,(function(){return!0}))),T(a,b,c,d.uniforms,(function(){return!0}),!1),W(a,b,b,c)}function ma(a,b){var c=a.proc("draw",1);N(a,c),ia(a,c,b.context),Q(a,c,b.framebuffer),Aa(a,c,b),J(a,c,b.state),F(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);if(c(a.shared.gl,".useProgram(",d,".program);"),b.shader.program)Z(a,c,b,b.shader.program);else{c(a.shared.vao,".setVAO(null);");var e=a.global.def("{}"),f=c.def(d,".id"),g=c.def(e,"[",f,"]");c(a.cond(g).then(g,".call(this,a0);").else(g,"=",e,"[",f,"]=",a.link((function(c){return ca(Z,a,b,c,1)})),"(",d,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;"),a.shared.vao&&c(a.shared.vao,".setVAO(null);")}function pa(a,b,c,d){function e(){return!0}a.batchId="a1",N(a,b),ga(a,b,c,d.attributes,e),T(a,b,c,d.uniforms,e,!1),W(a,b,b,c)}function qa(a,b,c,d){function e(a){return a.contextDep&&g||a.propDep}function f(a){return!e(a)}N(a,b);var g=c.contextDep,h=b.def(),l=b.def();a.shared.props=l,a.batchId=h;var m=a.scope(),k=a.scope();b(m.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",l,"=","a0","[",h,"];",k,"}",m.exit),c.needsContext&&ia(a,k,c.context),c.needsFramebuffer&&Q(a,k,c.framebuffer),J(a,k,c.state,e),c.profile&&e(c.profile)&&F(a,k,c,!1,!0),d?(c.useVAO?c.drawVAO?e(c.drawVAO)?k(a.shared.vao,".setVAO(",c.drawVAO.append(a,k),");"):m(a.shared.vao,".setVAO(",c.drawVAO.append(a,m),");"):m(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(m(a.shared.vao,".setVAO(null);"),ga(a,m,c,d.attributes,f),ga(a,k,c,d.attributes,e)),T(a,m,c,d.uniforms,f,!1),T(a,k,c,d.uniforms,e,!0),W(a,m,k,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,k),l=k.def(d,".id"),m=k.def(b,"[",l,"]"),k(a.shared.gl,".useProgram(",d,".program);","if(!",m,"){",m,"=",b,"[",l,"]=",a.link((function(b){return ca(pa,a,c,b,2)})),"(",d,");}",m,".call(this,a0[",h,"],",h,");"))}function U(a,b){function c(a){return a.contextDep&&e||a.propDep}var d=a.proc("batch",2);a.batchId="0",N(a,d);var e=!1,f=!0;Object.keys(b.context).forEach((function(a){e=e||b.context[a].propDep})),e||(ia(a,d,b.context),f=!1);var h=!1;if((g=b.framebuffer)?(g.propDep?e=h=!0:g.contextDep&&e&&(h=!0),h||Q(a,d,g)):Q(a,d,null),b.state.viewport&&b.state.viewport.propDep&&(e=!0),Aa(a,d,b),J(a,d,b.state,(function(a){return!c(a)})),b.profile&&c(b.profile)||F(a,d,b,!1,"a1"),b.contextDep=e,b.needsContext=f,b.needsFramebuffer=h,(f=b.shader.progVar).contextDep&&e||f.propDep)qa(a,d,b,null);else if(f=f.append(a,d),d(a.shared.gl,".useProgram(",f,".program);"),b.shader.program)qa(a,d,b,b.shader.program);else{d(a.shared.vao,".setVAO(null);");var g=a.global.def("{}"),l=(h=d.def(f,".id"),d.def(g,"[",h,"]"));d(a.cond(l).then(l,".call(this,a0,a1);").else(l,"=",g,"[",h,"]=",a.link((function(c){return ca(qa,a,b,c,2)})),"(",f,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;"),a.shared.vao&&d(a.shared.vao,".setVAO(null);")}function ja(a,c){function d(b){var g=c.shader[b];g&&e.set(f.shader,"."+b,g.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;ia(a,e,c.context),c.framebuffer&&c.framebuffer.append(a,e),yb(Object.keys(c.state)).forEach((function(b){var d=c.state[b].append(a,e);ra(d)?d.forEach((function(c,d){e.set(a.next[b],"["+d+"]",c)})):e.set(f.next,"."+b,d)})),F(a,e,c,!0,!0),["elements","offset","count","instances","primitive"].forEach((function(b){var d=c.draw[b];d&&e.set(f.draw,"."+b,""+d.append(a,e))})),Object.keys(c.uniforms).forEach((function(d){var g=c.uniforms[d].append(a,e);Array.isArray(g)&&(g="["+g.join()+"]"),e.set(f.uniforms,"["+b.id(d)+"]",g)})),Object.keys(c.attributes).forEach((function(b){var d=c.attributes[b].append(a,e),f=a.scopeAttrib(b);Object.keys(new ea).forEach((function(a){e.set(f,"."+a,d[a])}))})),c.scopeVAO&&e.set(f.vao,".targetVAO",c.scopeVAO.append(a,e)),d("vert"),d("frag"),0<Object.keys(c.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;")),e("a1(",a.shared.context,",a0,",a.batchId,");")}function la(a){if("object"==typeof a&&!ra(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(Y.isDynamic(a[b[c]]))return!0;return!1}}function ka(a,b,c){function d(a,b){g.forEach((function(c){var d=e[c];Y.isDynamic(d)&&(d=a.invoke(b,d),b(k,".",c,"=",d,";"))}))}var e=b.static[c];if(e&&la(e)){var f=a.global,g=Object.keys(e),h=!1,l=!1,m=!1,k=a.global.def("{}");g.forEach((function(b){var c=e[b];if(Y.isDynamic(c))"function"==typeof c&&(c=e[b]=Y.unbox(c)),b=L(c,null),h=h||b.thisDep,m=m||b.propDep,l=l||b.contextDep;else{switch(f(k,".",b,"="),typeof c){case"number":f(c);break;case"string":f('"',c,'"');break;case"object":Array.isArray(c)&&f("[",c.join(),"]");break;default:f(a.link(c))}f(";")}})),b.dynamic[c]=new Y.DynamicVariable(4,{thisDep:h,contextDep:l,propDep:m,ref:k,append:d}),delete b.static[c]}}var ea=l.Record,fa={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(fa.min=32775,fa.max=32776);var V=c.angle_instanced_arrays,Ma=c.webgl_draw_buffers,sa=c.oes_vertex_array_object,ua={dirty:!0,profile:h.profile},Fa={},Na=[],va={},wa={};t("dither",3024),t("blend.enable",3042),n("blend.color","blendColor",[0,0,0,0]),n("blend.equation","blendEquationSeparate",[32774,32774]),n("blend.func","blendFuncSeparate",[1,0,1,0]),t("depth.enable",2929,!0),n("depth.func","depthFunc",513),n("depth.range","depthRange",[0,1]),n("depth.mask","depthMask",!0),n("colorMask","colorMask",[!0,!0,!0,!0]),t("cull.enable",2884),n("cull.face","cullFace",1029),n("frontFace","frontFace",2305),n("lineWidth","lineWidth",1),t("polygonOffset.enable",32823),n("polygonOffset.offset","polygonOffset",[0,0]),t("sample.alpha",32926),t("sample.enable",32928),n("sample.coverage","sampleCoverage",[1,!1]),t("stencil.enable",2960),n("stencil.mask","stencilMask",-1),n("stencil.func","stencilFunc",[519,0,-1]),n("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),n("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),t("scissor.enable",3089),n("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]),n("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var tb={gl:a,context:w,strings:b,next:Fa,current:ua,draw:r,elements:e,buffer:f,shader:v,attributes:l.state,vao:l,uniforms:u,framebuffer:p,extensions:c,timer:m,isBufferArgs:Sa},Pa={primTypes:Ka,compareFuncs:ab,blendFuncs:Ga,blendEquations:fa,stencilOps:Ta,glTypes:Ja,orientationType:zb};Ma&&(Pa.backBuffer=[1029],Pa.drawBuffer=S(d.maxDrawbuffers,(function(a){return 0===a?[0]:S(a,(function(a){return 36064+a}))})));var ta=0;return{next:Fa,current:ua,procs:function(){var a=C(),b=a.proc("poll"),e=a.proc("refresh"),f=a.block();b(f),e(f);var k,g=a.shared,h=g.gl,l=g.next,m=g.current;f(m,".dirty=false;"),Q(a,b),Q(a,e,null,!0),V&&(k=a.link(V)),c.oes_vertex_array_object&&e(a.link(c.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var n=0;n<d.maxAttributes;++n){var r=e.def(g.attributes,"[",n,"]"),q=a.cond(r,".buffer");q.then(h,".enableVertexAttribArray(",n,");",h,".bindBuffer(",34962,",",r,".buffer.buffer);",h,".vertexAttribPointer(",n,",",r,".size,",r,".type,",r,".normalized,",r,".stride,",r,".offset);").else(h,".disableVertexAttribArray(",n,");",h,".vertexAttrib4f(",n,",",r,".x,",r,".y,",r,".z,",r,".w);",r,".buffer=null;"),e(q),V&&e(k,".vertexAttribDivisorANGLE(",n,",",r,".divisor);")}return e(a.shared.vao,".currentVAO=null;",a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"),Object.keys(va).forEach((function(c){var d=va[c],g=f.def(l,".",c),k=a.block();k("if(",g,"){",h,".enable(",d,")}else{",h,".disable(",d,")}",m,".",c,"=",g,";"),e(k),b("if(",g,"!==",m,".",c,"){",k,"}")})),Object.keys(wa).forEach((function(c){var k,n,d=wa[c],g=ua[c],r=a.block();r(h,".",d,"("),ra(g)?(d=g.length,k=a.global.def(l,".",c),n=a.global.def(m,".",c),r(S(d,(function(a){return k+"["+a+"]"})),");",S(d,(function(a){return n+"["+a+"]="+k+"["+a+"];"})).join("")),b("if(",S(d,(function(a){return k+"["+a+"]!=="+n+"["+a+"]"})).join("||"),"){",r,"}")):(k=f.def(l,".",c),n=f.def(m,".",c),r(k,");",m,".",c,"=",k,";"),b("if(",k,"!==",n,"){",r,"}")),e(r)})),a.compile()}(),compile:function(a,b,c,d,e){var f=C();f.stats=f.link(e),Object.keys(b.static).forEach((function(a){ka(f,b,a)})),Wb.forEach((function(b){ka(f,a,b)}));var g=A(a,b,c,d,f);return ma(f,g),ja(f,g),U(f,g),K(f.compile(),{destroy:function(){g.shader.program.destroy()}})}}}function Bb(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var K=function(a,b){for(var c=Object.keys(b),d=0;d<c.length;++d)a[c[d]]=b[c[d]];return a},Db=0,Y={DynamicVariable:W,define:function(a,b){return new W(a,cb(b+""))},isDynamic:function(a){return"function"==typeof a&&!a._reglType||a instanceof W},unbox:db,accessor:cb},bb={next:"function"==typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"==typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Cb="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},D=hb();D.zero=hb();var Xb=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var d=1,f=1;b.webgl_draw_buffers&&(d=a.getParameter(34852),f=a.getParameter(36063));var e=!!b.oes_texture_float;if(e){e=a.createTexture(),a.bindTexture(3553,e),a.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var k=a.createFramebuffer();if(a.bindFramebuffer(36160,k),a.framebufferTexture2D(36160,36064,3553,e,0),a.bindTexture(3553,null),36053!==a.checkFramebufferStatus(36160))e=!1;else{a.viewport(0,0,1,1),a.clearColor(1,0,0,1),a.clear(16384);var p=D.allocType(5126,4);a.readPixels(0,0,1,1,6408,5126,p),a.getError()?e=!1:(a.deleteFramebuffer(k),a.deleteTexture(e),e=1===p[0]),D.freeType(p)}}return p=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(p=a.createTexture(),k=D.allocType(5121,36),a.activeTexture(33984),a.bindTexture(34067,p),a.texImage2D(34069,0,6408,3,3,0,6408,5121,k),D.freeType(k),a.bindTexture(34067,null),a.deleteTexture(p),p=!a.getError()),{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter((function(a){return!!b[a]})),maxAnisotropic:c,maxDrawbuffers:d,maxColorAttachments:f,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938),readFloat:e,npotTextureCube:p}},P=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},J=function(a){return Object.keys(a).map((function(b){return a[b]}))},Qa={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,d){var f=1;if(b.length)for(var e=0;e<b.length;++e)f*=b[e];else f=0;switch(c=d||D.allocType(c,f),b.length){case 0:break;case 1:for(d=b[0],b=0;b<d;++b)c[b]=a[b];break;case 2:for(d=b[0],b=b[1],e=f=0;e<d;++e)for(var k=a[e],p=0;p<b;++p)c[f++]=k[p];break;case 3:ib(a,b[0],b[1],b[2],c,0);break;default:jb(a,b,0,c,0)}return c}},Ia={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ja={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},nb={dynamic:35048,stream:35040,static:35044},Ua=Qa.flatten,mb=Qa.shape,ka=[];ka[5120]=1,ka[5122]=2,ka[5124]=4,ka[5121]=1,ka[5123]=2,ka[5125]=4,ka[5126]=4;var Ka={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},pb=new Float32Array(1),Lb=new Uint32Array(pb.buffer),Pb=[9984,9986,9985,9987],Oa=[0,6409,6410,6407,6408],T={};T[6409]=T[6406]=T[6402]=1,T[34041]=T[6410]=2,T[6407]=T[35904]=3,T[6408]=T[35906]=4;var Xa=sa("HTMLCanvasElement"),Ya=sa("OffscreenCanvas"),ub=sa("CanvasRenderingContext2D"),vb=sa("ImageBitmap"),wb=sa("HTMLImageElement"),xb=sa("HTMLVideoElement"),Mb=Object.keys(Ia).concat([Xa,Ya,ub,vb,wb,xb]),ta=[];ta[5121]=1,ta[5126]=4,ta[36193]=2,ta[5123]=2,ta[5125]=4;var G=[];G[32854]=2,G[32855]=2,G[36194]=2,G[34041]=4,G[33776]=.5,G[33777]=.5,G[33778]=1,G[33779]=1,G[35986]=.5,G[35987]=1,G[34798]=1,G[35840]=.5,G[35841]=.25,G[35842]=.5,G[35843]=.25,G[36196]=.5;var R=[];R[32854]=2,R[32855]=2,R[36194]=2,R[33189]=2,R[36168]=1,R[34041]=4,R[35056]=4,R[35907]=4,R[34836]=16,R[34842]=8,R[34843]=6;var Yb=function(a,b,c,d,f){function e(a){this.id=l++,this.refCount=1,this.renderbuffer=a,this.format=32854,this.height=this.width=0,f.profile&&(this.stats={size:0})}function k(b){var c=b.renderbuffer;a.bindRenderbuffer(36161,null),a.deleteRenderbuffer(c),b.renderbuffer=null,b.refCount=0,delete v[b.id],d.renderbufferCount--}var p={rgba4:32854,rgba8:32856,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041,"depth24 stencil8":35056};b.ext_srgb&&(p.srgba=35907),b.ext_color_buffer_half_float&&(p.rgba16f=34842,p.rgb16f=34843),b.webgl_color_buffer_float&&(p.rgba32f=34836);var u=[];Object.keys(p).forEach((function(a){u[p[a]]=a}));var l=0,v={};return e.prototype.decRef=function(){0>=--this.refCount&&k(this)},f.profile&&(d.getTotalRenderbufferSize=function(){var a=0;return Object.keys(v).forEach((function(b){a+=v[b].stats.size})),a}),{create:function(b,c){function k(b,c){var d=0,e=0,l=32854,r=0;if("object"==typeof b&&b?("shape"in b?(d=0|(e=b.shape)[0],e=0|e[1]):("radius"in b&&(d=e=0|b.radius),"width"in b&&(d=0|b.width),"height"in b&&(e=0|b.height)),"format"in b&&(l=p[b.format]),"samples"in b&&(r=b.samples)):"number"==typeof b?(d=0|b,e="number"==typeof c?0|c:d):b||(d=e=1),d!==h.width||e!==h.height||l!==h.format)return k.width=h.width=d,k.height=h.height=e,k.samples=r,h.format=l,h.samples=r,a.bindRenderbuffer(36161,h.renderbuffer),r&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,r,l,d,e):a.renderbufferStorage(36161,l,d,e),f.profile&&(h.stats.size=R[h.format]*h.width*h.height),k.format=u[h.format],k}var h=new e(a.createRenderbuffer());return v[h.id]=h,d.renderbufferCount++,k(b,c),k.resize=function(b,c){var d=0|b,e=0|c||d;if(d===h.width&&e===h.height)return k;k.width=h.width=d,k.height=h.height=e;var l=k.samples;return a.bindRenderbuffer(36161,h.renderbuffer),l&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,l,h.format,d,e):a.renderbufferStorage(36161,h.format,d,e),f.profile&&(h.stats.size=R[h.format]*h.width*h.height),k},k._reglType="renderbuffer",k._renderbuffer=h,f.profile&&(k.stats=h.stats),k.destroy=function(){h.decRef()},k},clear:function(){J(v).forEach(k)},restore:function(){J(v).forEach((function(b){b.renderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,b.renderbuffer),b.samples&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,b.samples,b.format,b.width,b.height):a.renderbufferStorage(36161,b.format,b.width,b.height)})),a.bindRenderbuffer(36161,null)}}},Za=[];Za[6408]=4,Za[6407]=3;var Ra=[];Ra[5121]=1,Ra[5126]=4,Ra[36193]=2;var Ea=["x","y","z","w"],Wb="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Ga={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ab={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ta={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},zb={cw:2304,ccw:2305},Ab=new H(!1,!1,!1,(function(){})),Zb=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function d(a,b,d){var e=k.pop()||new c;e.startQueryIndex=a,e.endQueryIndex=b,e.sum=0,e.stats=d,p.push(e)}if(!b.ext_disjoint_timer_query)return null;var f=[],e=[],k=[],p=[],u=[],l=[];return{beginQuery:function(a){var c=f.pop()||b.ext_disjoint_timer_query.createQueryEXT();b.ext_disjoint_timer_query.beginQueryEXT(35007,c),e.push(c),d(e.length-1,e.length,a)},endQuery:function(){b.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:d,update:function(){var a,c;if(0!==(a=e.length)){l.length=Math.max(l.length,a+1),u.length=Math.max(u.length,a+1),u[0]=0;var d=l[0]=0;for(c=a=0;c<e.length;++c)b.ext_disjoint_timer_query.getQueryObjectEXT(m=e[c],34919)?(d+=b.ext_disjoint_timer_query.getQueryObjectEXT(m,34918),f.push(m)):e[a++]=m,u[c+1]=d,l[c+1]=a;for(e.length=a,c=a=0;c<p.length;++c){var m,h=(d=p[c]).startQueryIndex;d.sum+=u[m=d.endQueryIndex]-u[h],(m=l[m])===(h=l[h])?(d.stats.gpuTime+=d.sum/1e6,k.push(d)):(d.startQueryIndex=h,d.endQueryIndex=m,p[a++]=d)}p.length=a}},getNumPendingQueries:function(){return e.length},clear:function(){f.push.apply(f,e);for(var a=0;a<f.length;a++)b.ext_disjoint_timer_query.deleteQueryEXT(f[a]);e.length=0,f.length=0},restore:function(){e.length=0,f.length=0}}};return function(a){function b(){if(0===F.length)q&&q.update(),ca=null;else{ca=bb.next(b),v();for(var a=F.length-1;0<=a;--a){var c=F[a];c&&c(I,null,0)}m.flush(),q&&q.update()}}function c(){!ca&&0<F.length&&(ca=bb.next(b))}function d(){ca&&(bb.cancel(b),ca=null)}function f(a){a.preventDefault(),d(),S.forEach((function(a){a()}))}function e(a){m.getError(),g.restore(),z.restore(),E.restore(),A.restore(),P.restore(),Q.restore(),L.restore(),q&&q.restore(),J.procs.refresh(),c(),T.forEach((function(a){a()}))}function k(a){function b(a,c){var d={},e={};return Object.keys(a).forEach((function(b){var f=a[b];if(Y.isDynamic(f))e[b]=Y.unbox(f,b);else{if(c&&Array.isArray(f))for(var g=0;g<f.length;++g)if(Y.isDynamic(f[g]))return void(e[b]=Y.unbox(f,b));d[b]=f}})),{dynamic:e,static:d}}function c(a){for(;n.length<a;)n.push(null);return n}var d=b(a.context||{},!0),e=b(a.uniforms||{},!0),f=b(a.attributes||{},!1);a=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a],Object.keys(d).forEach((function(b){c[a+"."+b]=d[b]}))}}var c=K({},a);return delete c.uniforms,delete c.attributes,delete c.context,delete c.vao,"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op),b("blend"),b("depth"),b("cull"),b("stencil"),b("polygonOffset"),b("scissor"),b("sample"),"vao"in a&&(c.vao=a.vao),c}(a),!1);var g={gpuTime:0,cpuTime:0,count:0},h=J.compile(a,f,e,d,g),k=h.draw,l=h.batch,m=h.scope,n=[];return K((function(a,b){var d;if("function"==typeof a)return m.call(this,null,a,0);if("function"==typeof b)if("number"==typeof a)for(d=0;d<a;++d)m.call(this,null,b,d);else{if(!Array.isArray(a))return m.call(this,a,b,0);for(d=0;d<a.length;++d)m.call(this,a[d],b,d)}else if("number"==typeof a){if(0<a)return l.call(this,c(0|a),0|a)}else{if(!Array.isArray(a))return k.call(this,a);if(a.length)return l.call(this,a,a.length)}}),{stats:g,destroy:function(){h.destroy()}})}function p(a,b){var c=0;J.procs.poll();var d=b.color;d&&(m.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384),"depth"in b&&(m.clearDepth(+b.depth),c|=256),"stencil"in b&&(m.clearStencil(0|b.stencil),c|=1024),m.clear(c)}function u(a){return F.push(a),c(),{cancel:function(){function b(){var a=Bb(F,b);F[a]=F[F.length-1],--F.length,0>=F.length&&d()}var c=Bb(F,a);F[c]=b}}}function l(){var a=R.viewport,b=R.scissor_box;a[0]=a[1]=b[0]=b[1]=0,I.viewportWidth=I.framebufferWidth=I.drawingBufferWidth=a[2]=b[2]=m.drawingBufferWidth,I.viewportHeight=I.framebufferHeight=I.drawingBufferHeight=a[3]=b[3]=m.drawingBufferHeight}function v(){I.tick+=1,I.time=w(),l(),J.procs.poll()}function r(){A.refresh(),l(),J.procs.refresh(),q&&q.update()}function w(){return(Cb()-B)/1e3}if(!(a=Hb(a)))return null;var m=a.gl,h=m.getContextAttributes();m.isContextLost();var g=Ib(m,a);if(!g)return null;var t=Eb(),n={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},C=g.extensions,q=Zb(m,C),B=Cb(),G=m.drawingBufferHeight,I={tick:0,time:0,viewportWidth:D=m.drawingBufferWidth,viewportHeight:G,framebufferWidth:D,framebufferHeight:G,drawingBufferWidth:D,drawingBufferHeight:G,pixelRatio:a.pixelRatio},D={elements:null,primitive:4,count:-1,offset:0,instances:-1},M=Xb(m,C),E=Jb(m,n,a,(function(a){return L.destroyBuffer(a)})),H=Kb(m,C,E,n),L=Rb(m,C,M,n,E,H,D),z=Sb(m,t,n,a),A=Nb(m,C,M,(function(){J.procs.poll()}),I,n,a),P=Yb(m,C,M,n,a),Q=Qb(m,C,M,A,P,n),J=Vb(m,t,C,M,E,H,A,Q,{},L,z,D,I,q,a),R=(t=Tb(m,Q,J.procs.poll,I),J.next),N=m.canvas,F=[],S=[],T=[],W=[a.onDestroy],ca=null;N&&(N.addEventListener("webglcontextlost",f,!1),N.addEventListener("webglcontextrestored",e,!1));var Z=Q.setFBO=k({framebuffer:Y.define.call(null,1,"framebuffer")});return r(),h=K(k,{clear:function(a){if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)Z(K({framebuffer:a.framebuffer.faces[b]},a),p);else Z(a,p);else p(null,a)},prop:Y.define.bind(null,1),context:Y.define.bind(null,2),this:Y.define.bind(null,3),draw:k({}),buffer:function(a){return E.create(a,34962,!1,!1)},elements:function(a){return H.create(a,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:P.create,framebuffer:Q.create,framebufferCube:Q.createCube,vao:L.createVAO,attributes:h,frame:u,on:function(a,b){var c;switch(a){case"frame":return u(b);case"lost":c=S;break;case"restore":c=T;break;case"destroy":c=W}return c.push(b),{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1],c.pop();break}}}},limits:M,hasExtension:function(a){return 0<=M.extensions.indexOf(a.toLowerCase())},read:t,destroy:function(){F.length=0,d(),N&&(N.removeEventListener("webglcontextlost",f),N.removeEventListener("webglcontextrestored",e)),z.clear(),Q.clear(),P.clear(),L.clear(),A.clear(),H.clear(),E.clear(),q&&q.clear(),W.forEach((function(a){a()}))},_gl:m,_refresh:r,poll:function(){v(),q&&q.update()},now:w,stats:n,blit:Q.blit}),a.onDone(null,h),h}}()}(regl_min);var h$1=regl_min.exports,EPSILON=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,RANDOM=Math.random;var degree=Math.PI/180;var common=Object.freeze({__proto__:null,EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE},RANDOM,setMatrixArrayType:function(type){ARRAY_TYPE=type},toRadian:function(a){return a*degree},equals:function(a,b){return Math.abs(a-b)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(b))}});function set$8(out,m00,m01,m10,m11){return out[0]=m00,out[1]=m01,out[2]=m10,out[3]=m11,out}function multiply$8(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=a0*b0+a2*b1,out[1]=a1*b0+a3*b1,out[2]=a0*b2+a2*b3,out[3]=a1*b2+a3*b3,out}function fromRotation$4(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=-s,out[3]=c,out}function subtract$6(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out}var mat2=Object.freeze({__proto__:null,create:function(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0),out[0]=1,out[3]=1,out},clone:function(a){var out=new ARRAY_TYPE(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out},fromValues:function(m00,m01,m10,m11){var out=new ARRAY_TYPE(4);return out[0]=m00,out[1]=m01,out[2]=m10,out[3]=m11,out},set:set$8,transpose:function(out,a){if(out===a){var a1=a[1];out[1]=a[2],out[2]=a1}else out[0]=a[0],out[1]=a[2],out[2]=a[1],out[3]=a[3];return out},invert:function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;return det?(out[0]=a3*(det=1/det),out[1]=-a1*det,out[2]=-a2*det,out[3]=a0*det,out):null},adjoint:function(out,a){var a0=a[0];return out[0]=a[3],out[1]=-a[1],out[2]=-a[2],out[3]=a0,out},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:multiply$8,rotate:function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);return out[0]=a0*c+a2*s,out[1]=a1*c+a3*s,out[2]=a0*-s+a2*c,out[3]=a1*-s+a3*c,out},scale:function(out,a,v){var a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];return out[0]=a[0]*v0,out[1]=a1*v0,out[2]=a2*v1,out[3]=a3*v1,out},fromRotation:fromRotation$4,fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=v[1],out},str:function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},LDU:function(L,D,U,a){return L[2]=a[2]/a[0],U[0]=a[0],U[1]=a[1],U[3]=a[3]-L[2]*U[1],[L,D,U]},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out},subtract:subtract$6,exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))},multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out},mul:multiply$8,sub:subtract$6});function multiply$7(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return out[0]=a0*b0+a2*b1,out[1]=a1*b0+a3*b1,out[2]=a0*b2+a2*b3,out[3]=a1*b2+a3*b3,out[4]=a0*b4+a2*b5+a4,out[5]=a1*b4+a3*b5+a5,out}function subtract$5(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out}var mat2d=Object.freeze({__proto__:null,create:function(){var out=new ARRAY_TYPE(6);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[4]=0,out[5]=0),out[0]=1,out[3]=1,out},clone:function(a){var out=new ARRAY_TYPE(6);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out[4]=0,out[5]=0,out},fromValues:function(a,b,c,d,tx,ty){var out=new ARRAY_TYPE(6);return out[0]=a,out[1]=b,out[2]=c,out[3]=d,out[4]=tx,out[5]=ty,out},set:function(out,a,b,c,d,tx,ty){return out[0]=a,out[1]=b,out[2]=c,out[3]=d,out[4]=tx,out[5]=ty,out},invert:function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5],det=aa*ad-ab*ac;return det?(out[0]=ad*(det=1/det),out[1]=-ab*det,out[2]=-ac*det,out[3]=aa*det,out[4]=(ac*aty-ad*atx)*det,out[5]=(ab*atx-aa*aty)*det,out):null},determinant:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:multiply$7,rotate:function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],s=Math.sin(rad),c=Math.cos(rad);return out[0]=a0*c+a2*s,out[1]=a1*c+a3*s,out[2]=a0*-s+a2*c,out[3]=a1*-s+a3*c,out[4]=a4,out[5]=a5,out},scale:function(out,a,v){var a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];return out[0]=a[0]*v0,out[1]=a1*v0,out[2]=a2*v1,out[3]=a3*v1,out[4]=a4,out[5]=a5,out},translate:function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];return out[0]=a0,out[1]=a1,out[2]=a2,out[3]=a3,out[4]=a0*v0+a2*v1+a4,out[5]=a1*v0+a3*v1+a5,out},fromRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=-s,out[3]=c,out[4]=0,out[5]=0,out},fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=v[1],out[4]=0,out[5]=0,out},fromTranslation:function(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out[4]=v[0],out[5]=v[1],out},str:function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out},subtract:subtract$5,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))},mul:multiply$7,sub:subtract$5});function create$6(){var out=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[5]=0,out[6]=0,out[7]=0),out[0]=1,out[4]=1,out[8]=1,out}function fromMat4$1(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[4],out[4]=a[5],out[5]=a[6],out[6]=a[8],out[7]=a[9],out[8]=a[10],out}function set$6(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m10,out[4]=m11,out[5]=m12,out[6]=m20,out[7]=m21,out[8]=m22,out}function transpose$1(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3],out[2]=a[6],out[3]=a01,out[5]=a[7],out[6]=a02,out[7]=a12}else out[0]=a[0],out[1]=a[3],out[2]=a[6],out[3]=a[1],out[4]=a[4],out[5]=a[7],out[6]=a[2],out[7]=a[5],out[8]=a[8];return out}function invert$3(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;return det?(out[0]=b01*(det=1/det),out[1]=(-a22*a01+a02*a21)*det,out[2]=(a12*a01-a02*a11)*det,out[3]=b11*det,out[4]=(a22*a00-a02*a20)*det,out[5]=(-a12*a00+a02*a10)*det,out[6]=b21*det,out[7]=(-a21*a00+a01*a20)*det,out[8]=(a11*a00-a01*a10)*det,out):null}function multiply$6(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];return out[0]=b00*a00+b01*a10+b02*a20,out[1]=b00*a01+b01*a11+b02*a21,out[2]=b00*a02+b01*a12+b02*a22,out[3]=b10*a00+b11*a10+b12*a20,out[4]=b10*a01+b11*a11+b12*a21,out[5]=b10*a02+b11*a12+b12*a22,out[6]=b20*a00+b21*a10+b22*a20,out[7]=b20*a01+b21*a11+b22*a21,out[8]=b20*a02+b21*a12+b22*a22,out}function fromRotation$2(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=0,out[3]=-s,out[4]=c,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out}function fromQuat$1(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-yy-zz,out[3]=yx-wz,out[6]=zx+wy,out[1]=yx+wz,out[4]=1-xx-zz,out[7]=zy-wx,out[2]=zx-wy,out[5]=zy+wx,out[8]=1-xx-yy,out}function subtract$4(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out[6]=a[6]-b[6],out[7]=a[7]-b[7],out[8]=a[8]-b[8],out}var mat3=Object.freeze({__proto__:null,create:create$6,fromMat4:fromMat4$1,clone:function(a){var out=new ARRAY_TYPE(9);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},fromValues:function(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new ARRAY_TYPE(9);return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m10,out[4]=m11,out[5]=m12,out[6]=m20,out[7]=m21,out[8]=m22,out},set:set$6,identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out},transpose:transpose$1,invert:invert$3,adjoint:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return out[0]=a11*a22-a12*a21,out[1]=a02*a21-a01*a22,out[2]=a01*a12-a02*a11,out[3]=a12*a20-a10*a22,out[4]=a00*a22-a02*a20,out[5]=a02*a10-a00*a12,out[6]=a10*a21-a11*a20,out[7]=a01*a20-a00*a21,out[8]=a00*a11-a01*a10,out},determinant:function(a){var a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a[0]*(a22*a11-a12*a21)+a[1]*(-a22*a10+a12*a20)+a[2]*(a21*a10-a11*a20)},multiply:multiply$6,translate:function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];return out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a10,out[4]=a11,out[5]=a12,out[6]=x*a00+y*a10+a20,out[7]=x*a01+y*a11+a21,out[8]=x*a02+y*a12+a22,out},rotate:function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);return out[0]=c*a00+s*a10,out[1]=c*a01+s*a11,out[2]=c*a02+s*a12,out[3]=c*a10-s*a00,out[4]=c*a11-s*a01,out[5]=c*a12-s*a02,out[6]=a20,out[7]=a21,out[8]=a22,out},scale:function(out,a,v){var x=v[0],y=v[1];return out[0]=x*a[0],out[1]=x*a[1],out[2]=x*a[2],out[3]=y*a[3],out[4]=y*a[4],out[5]=y*a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},fromTranslation:function(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=v[0],out[7]=v[1],out[8]=1,out},fromRotation:fromRotation$2,fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=0,out[4]=v[1],out[5]=0,out[6]=0,out[7]=0,out[8]=1,out},fromMat2d:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=0,out[3]=a[2],out[4]=a[3],out[5]=0,out[6]=a[4],out[7]=a[5],out[8]=1,out},fromQuat:fromQuat$1,normalFromMat4:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return det?(out[0]=(a11*b11-a12*b10+a13*b09)*(det=1/det),out[1]=(a12*b08-a10*b11-a13*b07)*det,out[2]=(a10*b10-a11*b08+a13*b06)*det,out[3]=(a02*b10-a01*b11-a03*b09)*det,out[4]=(a00*b11-a02*b08+a03*b07)*det,out[5]=(a01*b08-a00*b10-a03*b06)*det,out[6]=(a31*b05-a32*b04+a33*b03)*det,out[7]=(a32*b02-a30*b05-a33*b01)*det,out[8]=(a30*b04-a31*b02+a33*b00)*det,out):null},projection:function(out,width,height){return out[0]=2/width,out[1]=0,out[2]=0,out[3]=0,out[4]=-2/height,out[5]=0,out[6]=-1,out[7]=1,out[8]=1,out},str:function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out[8]=a[8]+b[8],out},subtract:subtract$4,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out[8]=a[8]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out[6]=a[6]+b[6]*scale,out[7]=a[7]+b[7]*scale,out[8]=a[8]+b[8]*scale,out},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))},mul:multiply$6,sub:subtract$4});function create$5(){var out=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=0,out[12]=0,out[13]=0,out[14]=0),out[0]=1,out[5]=1,out[10]=1,out[15]=1,out}function copy$5(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function identity$2(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a01,out[6]=a[9],out[7]=a[13],out[8]=a02,out[9]=a12,out[11]=a[14],out[12]=a03,out[13]=a13,out[14]=a23}else out[0]=a[0],out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a[1],out[5]=a[5],out[6]=a[9],out[7]=a[13],out[8]=a[2],out[9]=a[6],out[10]=a[10],out[11]=a[14],out[12]=a[3],out[13]=a[7],out[14]=a[11],out[15]=a[15];return out}function invert$2(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return det?(out[0]=(a11*b11-a12*b10+a13*b09)*(det=1/det),out[1]=(a02*b10-a01*b11-a03*b09)*det,out[2]=(a31*b05-a32*b04+a33*b03)*det,out[3]=(a22*b04-a21*b05-a23*b03)*det,out[4]=(a12*b08-a10*b11-a13*b07)*det,out[5]=(a00*b11-a02*b08+a03*b07)*det,out[6]=(a32*b02-a30*b05-a33*b01)*det,out[7]=(a20*b05-a22*b02+a23*b01)*det,out[8]=(a10*b10-a11*b08+a13*b06)*det,out[9]=(a01*b08-a00*b10-a03*b06)*det,out[10]=(a30*b04-a31*b02+a33*b00)*det,out[11]=(a21*b02-a20*b04-a23*b00)*det,out[12]=(a11*b07-a10*b09-a12*b06)*det,out[13]=(a00*b09-a01*b07+a02*b06)*det,out[14]=(a31*b01-a30*b03-a32*b00)*det,out[15]=(a20*b03-a21*b01+a22*b00)*det,out):null}function multiply$5(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,out[4]=(b0=b[4])*a00+(b1=b[5])*a10+(b2=b[6])*a20+(b3=b[7])*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,out[8]=(b0=b[8])*a00+(b1=b[9])*a10+(b2=b[10])*a20+(b3=b[11])*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,out[12]=(b0=b[12])*a00+(b1=b[13])*a10+(b2=b[14])*a20+(b3=b[15])*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out}function translate$1(out,a,v){var x=v[0],y=v[1],z=v[2],a00=void 0,a01=void 0,a02=void 0,a03=void 0,a10=void 0,a11=void 0,a12=void 0,a13=void 0,a20=void 0,a21=void 0,a22=void 0,a23=void 0;return a===out?(out[12]=a[0]*x+a[4]*y+a[8]*z+a[12],out[13]=a[1]*x+a[5]*y+a[9]*z+a[13],out[14]=a[2]*x+a[6]*y+a[10]*z+a[14],out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]):(a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],out[0]=a00=a[0],out[1]=a01,out[2]=a02,out[3]=a03,out[4]=a10,out[5]=a11,out[6]=a12,out[7]=a13,out[8]=a20,out[9]=a21,out[10]=a22,out[11]=a23,out[12]=a00*x+a10*y+a20*z+a[12],out[13]=a01*x+a11*y+a21*z+a[13],out[14]=a02*x+a12*y+a22*z+a[14],out[15]=a03*x+a13*y+a23*z+a[15]),out}function scale$5(out,a,v){var x=v[0],y=v[1],z=v[2];return out[0]=a[0]*x,out[1]=a[1]*x,out[2]=a[2]*x,out[3]=a[3]*x,out[4]=a[4]*y,out[5]=a[5]*y,out[6]=a[6]*y,out[7]=a[7]*y,out[8]=a[8]*z,out[9]=a[9]*z,out[10]=a[10]*z,out[11]=a[11]*z,out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function rotate$1(out,a,rad,axis){var s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22,x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z);return len<EPSILON?null:(x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),c=Math.cos(rad),a01=a[1],a02=a[2],a03=a[3],a11=a[5],a12=a[6],a13=a[7],a21=a[9],a22=a[10],a23=a[11],b10=x*y*(t=1-c)-z*s,b11=y*y*t+c,b12=z*y*t+x*s,b20=x*z*t+y*s,b21=y*z*t-x*s,b22=z*z*t+c,out[0]=(a00=a[0])*(b00=x*x*t+c)+(a10=a[4])*(b01=y*x*t+z*s)+(a20=a[8])*(b02=z*x*t-y*s),out[1]=a01*b00+a11*b01+a21*b02,out[2]=a02*b00+a12*b01+a22*b02,out[3]=a03*b00+a13*b01+a23*b02,out[4]=a00*b10+a10*b11+a20*b12,out[5]=a01*b10+a11*b11+a21*b12,out[6]=a02*b10+a12*b11+a22*b12,out[7]=a03*b10+a13*b11+a23*b12,out[8]=a00*b20+a10*b21+a20*b22,out[9]=a01*b20+a11*b21+a21*b22,out[10]=a02*b20+a12*b21+a22*b22,out[11]=a03*b20+a13*b21+a23*b22,a!==out&&(out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out)}function fromTranslation$1(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromScaling(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=v[1],out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=v[2],out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function fromRotation$1(out,rad,axis){var s,c,t,x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z);return len<EPSILON?null:(x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),c=Math.cos(rad),out[0]=x*x*(t=1-c)+c,out[1]=y*x*t+z*s,out[2]=z*x*t-y*s,out[3]=0,out[4]=x*y*t-z*s,out[5]=y*y*t+c,out[6]=z*y*t+x*s,out[7]=0,out[8]=x*z*t+y*s,out[9]=y*z*t-x*s,out[10]=z*z*t+c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out)}function fromRotationTranslation$1(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-(yy+zz),out[1]=xy+wz,out[2]=xz-wy,out[3]=0,out[4]=xy-wz,out[5]=1-(xx+zz),out[6]=yz+wx,out[7]=0,out[8]=xz+wy,out[9]=yz-wx,out[10]=1-(xx+yy),out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function getTranslation$1(out,mat){return out[0]=mat[12],out[1]=mat[13],out[2]=mat[14],out}function getScaling(out,mat){var m11=mat[0],m12=mat[1],m13=mat[2],m21=mat[4],m22=mat[5],m23=mat[6],m31=mat[8],m32=mat[9],m33=mat[10];return out[0]=Math.sqrt(m11*m11+m12*m12+m13*m13),out[1]=Math.sqrt(m21*m21+m22*m22+m23*m23),out[2]=Math.sqrt(m31*m31+m32*m32+m33*m33),out}function getRotation(out,mat){var trace=mat[0]+mat[5]+mat[10],S=0;return trace>0?(S=2*Math.sqrt(trace+1),out[3]=.25*S,out[0]=(mat[6]-mat[9])/S,out[1]=(mat[8]-mat[2])/S,out[2]=(mat[1]-mat[4])/S):mat[0]>mat[5]&&mat[0]>mat[10]?(S=2*Math.sqrt(1+mat[0]-mat[5]-mat[10]),out[3]=(mat[6]-mat[9])/S,out[0]=.25*S,out[1]=(mat[1]+mat[4])/S,out[2]=(mat[8]+mat[2])/S):mat[5]>mat[10]?(S=2*Math.sqrt(1+mat[5]-mat[0]-mat[10]),out[3]=(mat[8]-mat[2])/S,out[0]=(mat[1]+mat[4])/S,out[1]=.25*S,out[2]=(mat[6]+mat[9])/S):(S=2*Math.sqrt(1+mat[10]-mat[0]-mat[5]),out[3]=(mat[1]-mat[4])/S,out[0]=(mat[8]+mat[2])/S,out[1]=(mat[6]+mat[9])/S,out[2]=.25*S),out}function fromRotationTranslationScale(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2];return out[0]=(1-(yy+zz))*sx,out[1]=(xy+wz)*sx,out[2]=(xz-wy)*sx,out[3]=0,out[4]=(xy-wz)*sy,out[5]=(1-(xx+zz))*sy,out[6]=(yz+wx)*sy,out[7]=0,out[8]=(xz+wy)*sz,out[9]=(yz-wx)*sz,out[10]=(1-(xx+yy))*sz,out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-yy-zz,out[1]=yx+wz,out[2]=zx-wy,out[3]=0,out[4]=yx-wz,out[5]=1-xx-zz,out[6]=zy+wx,out[7]=0,out[8]=zx+wy,out[9]=zy-wx,out[10]=1-xx-yy,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=void 0;return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=-1,out[12]=0,out[13]=0,out[15]=0,null!=far&&far!==1/0?(out[10]=(far+near)*(nf=1/(near-far)),out[14]=2*far*near*nf):(out[10]=-1,out[14]=-2*near),out}function ortho(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);return out[0]=-2*lr,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=-2*bt,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=2*nf,out[11]=0,out[12]=(left+right)*lr,out[13]=(top+bottom)*bt,out[14]=(far+near)*nf,out[15]=1,out}function lookAt(out,eye,center,up){var x0=void 0,x1=void 0,x2=void 0,y0=void 0,y1=void 0,y2=void 0,z0=void 0,z1=void 0,z2=void 0,len=void 0,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];return Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON?identity$2(out):(z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,x0=upy*(z2*=len=1/Math.sqrt(z0*z0+z1*z1+z2*z2))-upz*(z1*=len),x1=upz*(z0*=len)-upx*z2,x2=upx*z1-upy*z0,(len=Math.sqrt(x0*x0+x1*x1+x2*x2))?(x0*=len=1/len,x1*=len,x2*=len):(x0=0,x1=0,x2=0),y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,(len=Math.sqrt(y0*y0+y1*y1+y2*y2))?(y0*=len=1/len,y1*=len,y2*=len):(y0=0,y1=0,y2=0),out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out)}function subtract$3(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out[6]=a[6]-b[6],out[7]=a[7]-b[7],out[8]=a[8]-b[8],out[9]=a[9]-b[9],out[10]=a[10]-b[10],out[11]=a[11]-b[11],out[12]=a[12]-b[12],out[13]=a[13]-b[13],out[14]=a[14]-b[14],out[15]=a[15]-b[15],out}function exactEquals$5(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}var mul$5=multiply$5,mat4=Object.freeze({__proto__:null,create:create$5,clone:function(a){var out=new ARRAY_TYPE(16);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out},copy:copy$5,fromValues:function(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new ARRAY_TYPE(16);return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m03,out[4]=m10,out[5]=m11,out[6]=m12,out[7]=m13,out[8]=m20,out[9]=m21,out[10]=m22,out[11]=m23,out[12]=m30,out[13]=m31,out[14]=m32,out[15]=m33,out},set:function(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m03,out[4]=m10,out[5]=m11,out[6]=m12,out[7]=m13,out[8]=m20,out[9]=m21,out[10]=m22,out[11]=m23,out[12]=m30,out[13]=m31,out[14]=m32,out[15]=m33,out},identity:identity$2,transpose,invert:invert$2,adjoint:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22),out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22)),out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12),out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12)),out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22)),out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22),out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12)),out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12),out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21),out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21)),out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11),out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11)),out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21)),out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21),out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11)),out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11),out},determinant:function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return(a00*a11-a01*a10)*(a22*a33-a23*a32)-(a00*a12-a02*a10)*(a21*a33-a23*a31)+(a00*a13-a03*a10)*(a21*a32-a22*a31)+(a01*a12-a02*a11)*(a20*a33-a23*a30)-(a01*a13-a03*a11)*(a20*a32-a22*a30)+(a02*a13-a03*a12)*(a20*a31-a21*a30)},multiply:multiply$5,translate:translate$1,scale:scale$5,rotate:rotate$1,rotateX:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[4]=a10*c+a20*s,out[5]=a11*c+a21*s,out[6]=a12*c+a22*s,out[7]=a13*c+a23*s,out[8]=a20*c-a10*s,out[9]=a21*c-a11*s,out[10]=a22*c-a12*s,out[11]=a23*c-a13*s,out},rotateY:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c-a20*s,out[1]=a01*c-a21*s,out[2]=a02*c-a22*s,out[3]=a03*c-a23*s,out[8]=a00*s+a20*c,out[9]=a01*s+a21*c,out[10]=a02*s+a22*c,out[11]=a03*s+a23*c,out},rotateZ:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];return a!==out&&(out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c+a10*s,out[1]=a01*c+a11*s,out[2]=a02*c+a12*s,out[3]=a03*c+a13*s,out[4]=a10*c-a00*s,out[5]=a11*c-a01*s,out[6]=a12*c-a02*s,out[7]=a13*c-a03*s,out},fromTranslation:fromTranslation$1,fromScaling,fromRotation:fromRotation$1,fromXRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=c,out[6]=s,out[7]=0,out[8]=0,out[9]=-s,out[10]=c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromYRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=0,out[2]=-s,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=s,out[9]=0,out[10]=c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromZRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=0,out[3]=0,out[4]=-s,out[5]=c,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromRotationTranslation:fromRotationTranslation$1,fromQuat2:function(out,a){var translation=new ARRAY_TYPE(3),bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],magnitude=bx*bx+by*by+bz*bz+bw*bw;return magnitude>0?(translation[0]=2*(ax*bw+aw*bx+ay*bz-az*by)/magnitude,translation[1]=2*(ay*bw+aw*by+az*bx-ax*bz)/magnitude,translation[2]=2*(az*bw+aw*bz+ax*by-ay*bx)/magnitude):(translation[0]=2*(ax*bw+aw*bx+ay*bz-az*by),translation[1]=2*(ay*bw+aw*by+az*bx-ax*bz),translation[2]=2*(az*bw+aw*bz+ax*by-ay*bx)),fromRotationTranslation$1(out,a,translation),out},getTranslation:getTranslation$1,getScaling,getRotation,fromRotationTranslationScale,fromRotationTranslationScaleOrigin:function(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2],ox=o[0],oy=o[1],oz=o[2],out0=(1-(yy+zz))*sx,out1=(xy+wz)*sx,out2=(xz-wy)*sx,out4=(xy-wz)*sy,out5=(1-(xx+zz))*sy,out6=(yz+wx)*sy,out8=(xz+wy)*sz,out9=(yz-wx)*sz,out10=(1-(xx+yy))*sz;return out[0]=out0,out[1]=out1,out[2]=out2,out[3]=0,out[4]=out4,out[5]=out5,out[6]=out6,out[7]=0,out[8]=out8,out[9]=out9,out[10]=out10,out[11]=0,out[12]=v[0]+ox-(out0*ox+out4*oy+out8*oz),out[13]=v[1]+oy-(out1*ox+out5*oy+out9*oz),out[14]=v[2]+oz-(out2*ox+out6*oy+out10*oz),out[15]=1,out},fromQuat,frustum:function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);return out[0]=2*near*rl,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=2*near*tb,out[6]=0,out[7]=0,out[8]=(right+left)*rl,out[9]=(top+bottom)*tb,out[10]=(far+near)*nf,out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near*2*nf,out[15]=0,out},perspective,perspectiveFromFieldOfView:function(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);return out[0]=xScale,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=yScale,out[6]=0,out[7]=0,out[8]=-(leftTan-rightTan)*xScale*.5,out[9]=(upTan-downTan)*yScale*.5,out[10]=far/(near-far),out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near/(near-far),out[15]=0,out},ortho,lookAt,targetTo:function(out,eye,target,up){var eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],z0=eyex-target[0],z1=eyey-target[1],z2=eyez-target[2],len=z0*z0+z1*z1+z2*z2;len>0&&(z0*=len=1/Math.sqrt(len),z1*=len,z2*=len);var x0=upy*z2-upz*z1,x1=upz*z0-upx*z2,x2=upx*z1-upy*z0;return(len=x0*x0+x1*x1+x2*x2)>0&&(x0*=len=1/Math.sqrt(len),x1*=len,x2*=len),out[0]=x0,out[1]=x1,out[2]=x2,out[3]=0,out[4]=z1*x2-z2*x1,out[5]=z2*x0-z0*x2,out[6]=z0*x1-z1*x0,out[7]=0,out[8]=z0,out[9]=z1,out[10]=z2,out[11]=0,out[12]=eyex,out[13]=eyey,out[14]=eyez,out[15]=1,out},str:function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out[8]=a[8]+b[8],out[9]=a[9]+b[9],out[10]=a[10]+b[10],out[11]=a[11]+b[11],out[12]=a[12]+b[12],out[13]=a[13]+b[13],out[14]=a[14]+b[14],out[15]=a[15]+b[15],out},subtract:subtract$3,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out[8]=a[8]*b,out[9]=a[9]*b,out[10]=a[10]*b,out[11]=a[11]*b,out[12]=a[12]*b,out[13]=a[13]*b,out[14]=a[14]*b,out[15]=a[15]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out[6]=a[6]+b[6]*scale,out[7]=a[7]+b[7]*scale,out[8]=a[8]+b[8]*scale,out[9]=a[9]+b[9]*scale,out[10]=a[10]+b[10]*scale,out[11]=a[11]+b[11]*scale,out[12]=a[12]+b[12]*scale,out[13]=a[13]+b[13]*scale,out[14]=a[14]+b[14]*scale,out[15]=a[15]+b[15]*scale,out},exactEquals:exactEquals$5,equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],a9=a[9],a10=a[10],a11=a[11],a12=a[12],a13=a[13],a14=a[14],a15=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))},mul:mul$5,sub:subtract$3});function create$4(){var out=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0),out}function length$4(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)}function fromValues$4(x,y,z){var out=new ARRAY_TYPE(3);return out[0]=x,out[1]=y,out[2]=z,out}function copy$4(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out}function set$4(out,x,y,z){return out[0]=x,out[1]=y,out[2]=z,out}function add$4(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out}function subtract$2(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out}function multiply$4(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out}function divide$2(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out}function scale$4(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out}function scaleAndAdd$2(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out}function distance$2(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)}function squaredDistance$2(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z}function squaredLength$4(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z}function normalize$4(out,a){var x=a[0],y=a[1],z=a[2],len=x*x+y*y+z*z;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len,out[2]=a[2]*len),out}function dot$4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cross$1(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];return out[0]=ay*bz-az*by,out[1]=az*bx-ax*bz,out[2]=ax*by-ay*bx,out}function transformMat4$2(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];return out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/(w=w||1),out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w,out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w,out}function angle$1(a,b){var tempA=fromValues$4(a[0],a[1],a[2]),tempB=fromValues$4(b[0],b[1],b[2]);normalize$4(tempA,tempA),normalize$4(tempB,tempB);var cosine=dot$4(tempA,tempB);return cosine>1?0:cosine<-1?Math.PI:Math.acos(cosine)}function equals$5(a,b){var a0=a[0],a1=a[1],a2=a[2],b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))}var vec,sub$2=subtract$2,mul$4=multiply$4,div$2=divide$2,dist$2=distance$2,sqrDist$2=squaredDistance$2,len$4=length$4,sqrLen$4=squaredLength$4,forEach$2=(vec=create$4(),function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=3),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2];return a}),vec3=Object.freeze({__proto__:null,create:create$4,clone:function(a){var out=new ARRAY_TYPE(3);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out},length:length$4,fromValues:fromValues$4,copy:copy$4,set:set$4,add:add$4,subtract:subtract$2,multiply:multiply$4,divide:divide$2,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out[2]=Math.ceil(a[2]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out[2]=Math.floor(a[2]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out[2]=Math.round(a[2]),out},scale:scale$4,scaleAndAdd:scaleAndAdd$2,distance:distance$2,squaredDistance:squaredDistance$2,squaredLength:squaredLength$4,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out[2]=1/a[2],out},normalize:normalize$4,dot:dot$4,cross:cross$1,lerp:function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out},hermite:function(out,a,b,c,d,t){var factorTimes2=t*t,factor1=factorTimes2*(2*t-3)+1,factor2=factorTimes2*(t-2)+t,factor3=factorTimes2*(t-1),factor4=factorTimes2*(3-2*t);return out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4,out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4,out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4,out},bezier:function(out,a,b,c,d,t){var inverseFactor=1-t,inverseFactorTimesTwo=inverseFactor*inverseFactor,factorTimes2=t*t,factor1=inverseFactorTimesTwo*inverseFactor,factor2=3*t*inverseFactorTimesTwo,factor3=3*factorTimes2*inverseFactor,factor4=factorTimes2*t;return out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4,out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4,out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4,out},random:function(out,scale){scale=scale||1;var r=2*RANDOM()*Math.PI,z=2*RANDOM()-1,zScale=Math.sqrt(1-z*z)*scale;return out[0]=Math.cos(r)*zScale,out[1]=Math.sin(r)*zScale,out[2]=z*scale,out},transformMat4:transformMat4$2,transformMat3:function(out,a,m){var x=a[0],y=a[1],z=a[2];return out[0]=x*m[0]+y*m[3]+z*m[6],out[1]=x*m[1]+y*m[4]+z*m[7],out[2]=x*m[2]+y*m[5]+z*m[8],out},transformQuat:function(out,a,q){var qx=q[0],qy=q[1],qz=q[2],x=a[0],y=a[1],z=a[2],uvx=qy*z-qz*y,uvy=qz*x-qx*z,uvz=qx*y-qy*x,uuvx=qy*uvz-qz*uvy,uuvy=qz*uvx-qx*uvz,uuvz=qx*uvy-qy*uvx,w2=2*q[3];return uvy*=w2,uvz*=w2,uuvy*=2,uuvz*=2,out[0]=x+(uvx*=w2)+(uuvx*=2),out[1]=y+uvy+uuvy,out[2]=z+uvz+uuvz,out},rotateX:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[0],r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c),r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c),out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},rotateY:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c),r[1]=p[1],r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c),out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},rotateZ:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c),r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c),r[2]=p[2],out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},angle:angle$1,str:function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},equals:equals$5,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2});function create$3(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0,out[3]=0),out}function clone$3(a){var out=new ARRAY_TYPE(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out}function fromValues$3(x,y,z,w){var out=new ARRAY_TYPE(4);return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out}function copy$3(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out}function set$3(out,x,y,z,w){return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out}function add$3(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out}function subtract$1(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out}function multiply$3(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out[3]=a[3]*b[3],out}function divide$1(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out[3]=a[3]/b[3],out}function scale$3(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out}function distance$1(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}function squaredDistance$1(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w}function length$3(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}function squaredLength$3(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w}function normalize$3(out,a){var x=a[0],y=a[1],z=a[2],w=a[3],len=x*x+y*y+z*z+w*w;return len>0&&(len=1/Math.sqrt(len),out[0]=x*len,out[1]=y*len,out[2]=z*len,out[3]=w*len),out}function dot$3(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function lerp$3(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out[3]=aw+t*(b[3]-aw),out}function transformMat4$1(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];return out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w,out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w,out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w,out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w,out}function exactEquals$3(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}function equals$4(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))}var sub$1=subtract$1,mul$3=multiply$3,div$1=divide$1,dist$1=distance$1,sqrDist$1=squaredDistance$1,len$3=length$3,sqrLen$3=squaredLength$3,forEach$1=function(){var vec=create$3();return function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=4),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],vec[3]=a[i+3],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2],a[i+3]=vec[3];return a}}(),vec4=Object.freeze({__proto__:null,create:create$3,clone:clone$3,fromValues:fromValues$3,copy:copy$3,set:set$3,add:add$3,subtract:subtract$1,multiply:multiply$3,divide:divide$1,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out[2]=Math.ceil(a[2]),out[3]=Math.ceil(a[3]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out[2]=Math.floor(a[2]),out[3]=Math.floor(a[3]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out[3]=Math.min(a[3],b[3]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out[3]=Math.max(a[3],b[3]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out[2]=Math.round(a[2]),out[3]=Math.round(a[3]),out},scale:scale$3,scaleAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out},distance:distance$1,squaredDistance:squaredDistance$1,length:length$3,squaredLength:squaredLength$3,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=-a[3],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out[2]=1/a[2],out[3]=1/a[3],out},normalize:normalize$3,dot:dot$3,lerp:lerp$3,random:function(out,scale){var v1,v2,v3,v4,s1,s2;scale=scale||1;do{s1=(v1=2*RANDOM()-1)*v1+(v2=2*RANDOM()-1)*v2}while(s1>=1);do{s2=(v3=2*RANDOM()-1)*v3+(v4=2*RANDOM()-1)*v4}while(s2>=1);var d=Math.sqrt((1-s1)/s2);return out[0]=scale*v1,out[1]=scale*v2,out[2]=scale*v3*d,out[3]=scale*v4*d,out},transformMat4:transformMat4$1,transformQuat:function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy,out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz,out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx,out[3]=a[3],out},str:function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},exactEquals:exactEquals$3,equals:equals$4,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1});function create$2(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0),out[3]=1,out}function identity$1(out){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out}function setAxisAngle(out,axis,rad){rad*=.5;var s=Math.sin(rad);return out[0]=s*axis[0],out[1]=s*axis[1],out[2]=s*axis[2],out[3]=Math.cos(rad),out}function multiply$2(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];return out[0]=ax*bw+aw*bx+ay*bz-az*by,out[1]=ay*bw+aw*by+az*bx-ax*bz,out[2]=az*bw+aw*bz+ax*by-ay*bx,out[3]=aw*bw-ax*bx-ay*by-az*bz,out}function rotateX$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw+aw*bx,out[1]=ay*bw+az*bx,out[2]=az*bw-ay*bx,out[3]=aw*bw-ax*bx,out}function rotateY$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw-az*by,out[1]=ay*bw+aw*by,out[2]=az*bw+ax*by,out[3]=aw*bw-ay*by,out}function rotateZ$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw+ay*bz,out[1]=ay*bw-ax*bz,out[2]=az*bw+aw*bz,out[3]=aw*bw-az*bz,out}function slerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3],omega=void 0,cosom=void 0,sinom=void 0,scale0=void 0,scale1=void 0;return(cosom=ax*bx+ay*by+az*bz+aw*bw)<0&&(cosom=-cosom,bx=-bx,by=-by,bz=-bz,bw=-bw),1-cosom>EPSILON?(omega=Math.acos(cosom),sinom=Math.sin(omega),scale0=Math.sin((1-t)*omega)/sinom,scale1=Math.sin(t*omega)/sinom):(scale0=1-t,scale1=t),out[0]=scale0*ax+scale1*bx,out[1]=scale0*ay+scale1*by,out[2]=scale0*az+scale1*bz,out[3]=scale0*aw+scale1*bw,out}function fromMat3(out,m){var fTrace=m[0]+m[4]+m[8],fRoot=void 0;if(fTrace>0)fRoot=Math.sqrt(fTrace+1),out[3]=.5*fRoot,out[0]=(m[5]-m[7])*(fRoot=.5/fRoot),out[1]=(m[6]-m[2])*fRoot,out[2]=(m[1]-m[3])*fRoot;else{var i=0;m[4]>m[0]&&(i=1),m[8]>m[3*i+i]&&(i=2);var j=(i+1)%3,k=(i+2)%3;fRoot=Math.sqrt(m[3*i+i]-m[3*j+j]-m[3*k+k]+1),out[i]=.5*fRoot,out[3]=(m[3*j+k]-m[3*k+j])*(fRoot=.5/fRoot),out[j]=(m[3*j+i]+m[3*i+j])*fRoot,out[k]=(m[3*k+i]+m[3*i+k])*fRoot}return out}function fromEuler(out,x,y,z){var halfToRad=.5*Math.PI/180;x*=halfToRad,y*=halfToRad,z*=halfToRad;var sx=Math.sin(x),cx=Math.cos(x),sy=Math.sin(y),cy=Math.cos(y),sz=Math.sin(z),cz=Math.cos(z);return out[0]=sx*cy*cz-cx*sy*sz,out[1]=cx*sy*cz+sx*cy*sz,out[2]=cx*cy*sz-sx*sy*cz,out[3]=cx*cy*cz+sx*sy*sz,out}var tmpvec3,xUnitVec3,yUnitVec3,temp1,temp2,matr,clone$2=clone$3,fromValues$2=fromValues$3,copy$2=copy$3,set$2=set$3,add$2=add$3,mul$2=multiply$2,scale$2=scale$3,dot$2=dot$3,lerp$2=lerp$3,length$2=length$3,len$2=length$2,squaredLength$2=squaredLength$3,sqrLen$2=squaredLength$2,normalize$2=normalize$3,exactEquals$2=exactEquals$3,equals$3=equals$4,rotationTo=(tmpvec3=create$4(),xUnitVec3=fromValues$4(1,0,0),yUnitVec3=fromValues$4(0,1,0),function(out,a,b){var dot=dot$4(a,b);return dot<-.999999?(cross$1(tmpvec3,xUnitVec3,a),len$4(tmpvec3)<1e-6&&cross$1(tmpvec3,yUnitVec3,a),normalize$4(tmpvec3,tmpvec3),setAxisAngle(out,tmpvec3,Math.PI),out):dot>.999999?(out[0]=0,out[1]=0,out[2]=0,out[3]=1,out):(cross$1(tmpvec3,a,b),out[0]=tmpvec3[0],out[1]=tmpvec3[1],out[2]=tmpvec3[2],out[3]=1+dot,normalize$2(out,out))}),sqlerp=(temp1=create$2(),temp2=create$2(),function(out,a,b,c,d,t){return slerp(temp1,a,d,t),slerp(temp2,b,c,t),slerp(out,temp1,temp2,2*t*(1-t)),out}),setAxes=(matr=create$6(),function(out,view,right,up){return matr[0]=right[0],matr[3]=right[1],matr[6]=right[2],matr[1]=up[0],matr[4]=up[1],matr[7]=up[2],matr[2]=-view[0],matr[5]=-view[1],matr[8]=-view[2],normalize$2(out,fromMat3(out,matr))}),quat=Object.freeze({__proto__:null,create:create$2,identity:identity$1,setAxisAngle,getAxisAngle:function(out_axis,q){var rad=2*Math.acos(q[3]),s=Math.sin(rad/2);return s>EPSILON?(out_axis[0]=q[0]/s,out_axis[1]=q[1]/s,out_axis[2]=q[2]/s):(out_axis[0]=1,out_axis[1]=0,out_axis[2]=0),rad},multiply:multiply$2,rotateX:rotateX$1,rotateY:rotateY$1,rotateZ:rotateZ$1,calculateW:function(out,a){var x=a[0],y=a[1],z=a[2];return out[0]=x,out[1]=y,out[2]=z,out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z)),out},slerp,random:function(out){var u1=RANDOM(),u2=RANDOM(),u3=RANDOM(),sqrt1MinusU1=Math.sqrt(1-u1),sqrtU1=Math.sqrt(u1);return out[0]=sqrt1MinusU1*Math.sin(2*Math.PI*u2),out[1]=sqrt1MinusU1*Math.cos(2*Math.PI*u2),out[2]=sqrtU1*Math.sin(2*Math.PI*u3),out[3]=sqrtU1*Math.cos(2*Math.PI*u3),out},invert:function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;return out[0]=-a0*invDot,out[1]=-a1*invDot,out[2]=-a2*invDot,out[3]=a3*invDot,out},conjugate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=a[3],out},fromMat3,fromEuler,str:function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$3,rotationTo,sqlerp,setAxes});function fromRotationTranslation(out,q,t){var ax=.5*t[0],ay=.5*t[1],az=.5*t[2],bx=q[0],by=q[1],bz=q[2],bw=q[3];return out[0]=bx,out[1]=by,out[2]=bz,out[3]=bw,out[4]=ax*bw+ay*bz-az*by,out[5]=ay*bw+az*bx-ax*bz,out[6]=az*bw+ax*by-ay*bx,out[7]=-ax*bx-ay*by-az*bz,out}function copy$1(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out}function multiply$1(out,a,b){var ax0=a[0],ay0=a[1],az0=a[2],aw0=a[3],bx1=b[4],by1=b[5],bz1=b[6],bw1=b[7],ax1=a[4],ay1=a[5],az1=a[6],aw1=a[7],bx0=b[0],by0=b[1],bz0=b[2],bw0=b[3];return out[0]=ax0*bw0+aw0*bx0+ay0*bz0-az0*by0,out[1]=ay0*bw0+aw0*by0+az0*bx0-ax0*bz0,out[2]=az0*bw0+aw0*bz0+ax0*by0-ay0*bx0,out[3]=aw0*bw0-ax0*bx0-ay0*by0-az0*bz0,out[4]=ax0*bw1+aw0*bx1+ay0*bz1-az0*by1+ax1*bw0+aw1*bx0+ay1*bz0-az1*by0,out[5]=ay0*bw1+aw0*by1+az0*bx1-ax0*bz1+ay1*bw0+aw1*by0+az1*bx0-ax1*bz0,out[6]=az0*bw1+aw0*bz1+ax0*by1-ay0*bx1+az1*bw0+aw1*bz0+ax1*by0-ay1*bx0,out[7]=aw0*bw1-ax0*bx1-ay0*by1-az0*bz1+aw1*bw0-ax1*bx0-ay1*by0-az1*bz0,out}var dot$1=dot$2;var squaredLength$1=squaredLength$2;var quat2=Object.freeze({__proto__:null,create:function(){var dq=new ARRAY_TYPE(8);return ARRAY_TYPE!=Float32Array&&(dq[0]=0,dq[1]=0,dq[2]=0,dq[4]=0,dq[5]=0,dq[6]=0,dq[7]=0),dq[3]=1,dq},clone:function(a){var dq=new ARRAY_TYPE(8);return dq[0]=a[0],dq[1]=a[1],dq[2]=a[2],dq[3]=a[3],dq[4]=a[4],dq[5]=a[5],dq[6]=a[6],dq[7]=a[7],dq},fromValues:function(x1,y1,z1,w1,x2,y2,z2,w2){var dq=new ARRAY_TYPE(8);return dq[0]=x1,dq[1]=y1,dq[2]=z1,dq[3]=w1,dq[4]=x2,dq[5]=y2,dq[6]=z2,dq[7]=w2,dq},fromRotationTranslationValues:function(x1,y1,z1,w1,x2,y2,z2){var dq=new ARRAY_TYPE(8);dq[0]=x1,dq[1]=y1,dq[2]=z1,dq[3]=w1;var ax=.5*x2,ay=.5*y2,az=.5*z2;return dq[4]=ax*w1+ay*z1-az*y1,dq[5]=ay*w1+az*x1-ax*z1,dq[6]=az*w1+ax*y1-ay*x1,dq[7]=-ax*x1-ay*y1-az*z1,dq},fromRotationTranslation,fromTranslation:function(out,t){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out[4]=.5*t[0],out[5]=.5*t[1],out[6]=.5*t[2],out[7]=0,out},fromRotation:function(out,q){return out[0]=q[0],out[1]=q[1],out[2]=q[2],out[3]=q[3],out[4]=0,out[5]=0,out[6]=0,out[7]=0,out},fromMat4:function(out,a){var outer=create$2();getRotation(outer,a);var t=new ARRAY_TYPE(3);return getTranslation$1(t,a),fromRotationTranslation(out,outer,t),out},copy:copy$1,identity:function(out){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out[4]=0,out[5]=0,out[6]=0,out[7]=0,out},set:function(out,x1,y1,z1,w1,x2,y2,z2,w2){return out[0]=x1,out[1]=y1,out[2]=z1,out[3]=w1,out[4]=x2,out[5]=y2,out[6]=z2,out[7]=w2,out},getReal:copy$2,getDual:function(out,a){return out[0]=a[4],out[1]=a[5],out[2]=a[6],out[3]=a[7],out},setReal:copy$2,setDual:function(out,q){return out[4]=q[0],out[5]=q[1],out[6]=q[2],out[7]=q[3],out},getTranslation:function(out,a){var ax=a[4],ay=a[5],az=a[6],aw=a[7],bx=-a[0],by=-a[1],bz=-a[2],bw=a[3];return out[0]=2*(ax*bw+aw*bx+ay*bz-az*by),out[1]=2*(ay*bw+aw*by+az*bx-ax*bz),out[2]=2*(az*bw+aw*bz+ax*by-ay*bx),out},translate:function(out,a,v){var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3],bx1=.5*v[0],by1=.5*v[1],bz1=.5*v[2],ax2=a[4],ay2=a[5],az2=a[6],aw2=a[7];return out[0]=ax1,out[1]=ay1,out[2]=az1,out[3]=aw1,out[4]=aw1*bx1+ay1*bz1-az1*by1+ax2,out[5]=aw1*by1+az1*bx1-ax1*bz1+ay2,out[6]=aw1*bz1+ax1*by1-ay1*bx1+az2,out[7]=-ax1*bx1-ay1*by1-az1*bz1+aw2,out},rotateX:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateX$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateY:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateY$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateZ:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateZ$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateByQuatAppend:function(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],ax=a[0],ay=a[1],az=a[2],aw=a[3];return out[0]=ax*qw+aw*qx+ay*qz-az*qy,out[1]=ay*qw+aw*qy+az*qx-ax*qz,out[2]=az*qw+aw*qz+ax*qy-ay*qx,out[3]=aw*qw-ax*qx-ay*qy-az*qz,out[4]=(ax=a[4])*qw+(aw=a[7])*qx+(ay=a[5])*qz-(az=a[6])*qy,out[5]=ay*qw+aw*qy+az*qx-ax*qz,out[6]=az*qw+aw*qz+ax*qy-ay*qx,out[7]=aw*qw-ax*qx-ay*qy-az*qz,out},rotateByQuatPrepend:function(out,q,a){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],bx=a[0],by=a[1],bz=a[2],bw=a[3];return out[0]=qx*bw+qw*bx+qy*bz-qz*by,out[1]=qy*bw+qw*by+qz*bx-qx*bz,out[2]=qz*bw+qw*bz+qx*by-qy*bx,out[3]=qw*bw-qx*bx-qy*by-qz*bz,out[4]=qx*(bw=a[7])+qw*(bx=a[4])+qy*(bz=a[6])-qz*(by=a[5]),out[5]=qy*bw+qw*by+qz*bx-qx*bz,out[6]=qz*bw+qw*bz+qx*by-qy*bx,out[7]=qw*bw-qx*bx-qy*by-qz*bz,out},rotateAroundAxis:function(out,a,axis,rad){if(Math.abs(rad)<EPSILON)return copy$1(out,a);var axisLength=Math.sqrt(axis[0]*axis[0]+axis[1]*axis[1]+axis[2]*axis[2]);rad*=.5;var s=Math.sin(rad),bx=s*axis[0]/axisLength,by=s*axis[1]/axisLength,bz=s*axis[2]/axisLength,bw=Math.cos(rad),ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3];out[0]=ax1*bw+aw1*bx+ay1*bz-az1*by,out[1]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[2]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[3]=aw1*bw-ax1*bx-ay1*by-az1*bz;var ax=a[4],ay=a[5],az=a[6],aw=a[7];return out[4]=ax*bw+aw*bx+ay*bz-az*by,out[5]=ay*bw+aw*by+az*bx-ax*bz,out[6]=az*bw+aw*bz+ax*by-ay*bx,out[7]=aw*bw-ax*bx-ay*by-az*bz,out},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out},multiply:multiply$1,mul:multiply$1,scale:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out},dot:dot$1,lerp:function(out,a,b,t){var mt=1-t;return dot$1(a,b)<0&&(t=-t),out[0]=a[0]*mt+b[0]*t,out[1]=a[1]*mt+b[1]*t,out[2]=a[2]*mt+b[2]*t,out[3]=a[3]*mt+b[3]*t,out[4]=a[4]*mt+b[4]*t,out[5]=a[5]*mt+b[5]*t,out[6]=a[6]*mt+b[6]*t,out[7]=a[7]*mt+b[7]*t,out},invert:function(out,a){var sqlen=squaredLength$1(a);return out[0]=-a[0]/sqlen,out[1]=-a[1]/sqlen,out[2]=-a[2]/sqlen,out[3]=a[3]/sqlen,out[4]=-a[4]/sqlen,out[5]=-a[5]/sqlen,out[6]=-a[6]/sqlen,out[7]=a[7]/sqlen,out},conjugate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=a[3],out[4]=-a[4],out[5]=-a[5],out[6]=-a[6],out[7]=a[7],out},length:length$2,len:length$2,squaredLength:squaredLength$1,sqrLen:squaredLength$1,normalize:function(out,a){var magnitude=squaredLength$1(a);if(magnitude>0){magnitude=Math.sqrt(magnitude);var a0=a[0]/magnitude,a1=a[1]/magnitude,a2=a[2]/magnitude,a3=a[3]/magnitude,b0=a[4],b1=a[5],b2=a[6],b3=a[7],a_dot_b=a0*b0+a1*b1+a2*b2+a3*b3;out[0]=a0,out[1]=a1,out[2]=a2,out[3]=a3,out[4]=(b0-a0*a_dot_b)/magnitude,out[5]=(b1-a1*a_dot_b)/magnitude,out[6]=(b2-a2*a_dot_b)/magnitude,out[7]=(b3-a3*a_dot_b)/magnitude}return out},str:function(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))}});function create(){var out=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0),out}function set(out,x,y){return out[0]=x,out[1]=y,out}function add(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out}function subtract(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out}function multiply(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out}function divide(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out}function scale(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out}function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)}function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y}function length(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)}function squaredLength(a){var x=a[0],y=a[1];return x*x+y*y}function transformMat2(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[2]*y,out[1]=m[1]*x+m[3]*y,out}var len=length,sub=subtract,mul=multiply,div=divide,dist=distance,sqrDist=squaredDistance,sqrLen=squaredLength,forEach=function(){var vec=create();return function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=2),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1];return a}}(),vec2=Object.freeze({__proto__:null,create,clone:function(a){var out=new ARRAY_TYPE(2);return out[0]=a[0],out[1]=a[1],out},fromValues:function(x,y){var out=new ARRAY_TYPE(2);return out[0]=x,out[1]=y,out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out},set,add,subtract,multiply,divide,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out},scale,scaleAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out},distance,squaredDistance,length,squaredLength,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out},normalize:function(out,a){var x=a[0],y=a[1],len=x*x+y*y;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len),out},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},cross:function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];return out[0]=out[1]=0,out[2]=z,out},lerp:function(out,a,b,t){var ax=a[0],ay=a[1];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out},random:function(out,scale){scale=scale||1;var r=2*RANDOM()*Math.PI;return out[0]=Math.cos(r)*scale,out[1]=Math.sin(r)*scale,out},transformMat2,transformMat2d:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[2]*y+m[4],out[1]=m[1]*x+m[3]*y+m[5],out},transformMat3:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[3]*y+m[6],out[1]=m[1]*x+m[4]*y+m[7],out},transformMat4:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[4]*y+m[12],out[1]=m[1]*x+m[5]*y+m[13],out},rotate:function(out,a,b,c){var p0=a[0]-b[0],p1=a[1]-b[1],sinC=Math.sin(c),cosC=Math.cos(c);return out[0]=p0*cosC-p1*sinC+b[0],out[1]=p0*sinC+p1*cosC+b[1],out},angle:function(a,b){var x1=a[0],y1=a[1],x2=b[0],y2=b[1],len1=x1*x1+y1*y1;len1>0&&(len1=1/Math.sqrt(len1));var len2=x2*x2+y2*y2;len2>0&&(len2=1/Math.sqrt(len2));var cosine=(x1*x2+y1*y2)*len1*len2;return cosine>1?0:cosine<-1?Math.PI:Math.acos(cosine)},str:function(a){return"vec2("+a[0]+", "+a[1]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]},equals:function(a,b){var a0=a[0],a1=a[1],b0=b[0],b1=b[1];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))},len,sub,mul,div,dist,sqrDist,sqrLen,forEach});
/*!
	 * @maptalks/gltf-loader v0.27.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2022 maptalks.org
	 */
let n=0;function i$3(e){return null==e}function a(e){return!i$3(e)}function o(e){for(let t=1;t<arguments.length;t++){const s=arguments[t];for(const t in s)e[t]=s[t]}return e}function f$3(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+e)}function u$4(e){return 0===e.indexOf("data:")&&e.indexOf("base64,")>0}function h(e){const t=function(e){return"undefined"!=typeof self?self.atob(e):window.atob(e)}(e.substring(e.indexOf(",")+1)),s=t.length,r=new Uint8Array(s);for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return r.buffer}const c$1=[],l$1=[],d$4=[],m$6=[0,0,0],g$4=identity$1([]),p$7=[1,1,1];function b$7(e,t,s,r,n,i,a){const o=f$3(a);if((0===n||n===r*o.BYTES_PER_ELEMENT)&&i%o.BYTES_PER_ELEMENT==0){const n=new o(t,i,s*r);return e.set(n),e}0===n&&(n=r*o.BYTES_PER_ELEMENT);const u=new Uint8Array(r*o.BYTES_PER_ELEMENT);for(let a=0;a<s;a++){let s=null;const f=new Uint8Array(t,n*a+i,r*o.BYTES_PER_ELEMENT);u.set(f),s=new o(u.buffer,0,r);for(let t=0;t<r;t++)e[a*r+t]=s[t]}return e}const y$6="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function _$7(e,t,s){const r=new Uint8Array(e,t,s);return y$6.decode(r)}const w$8={get:function(e,t={}){t||(t={});const s=new AbortController,r=s.signal,n=o({},t);n.signal=r,n.method||(n.method="GET");const i=fetch(e,n).then((e=>{const s=this._parseResponse(e,t.responseType);return s.message?s:s.then((s=>"arraybuffer"===t.responseType?{data:s,cacheControl:e.headers.get("Cache-Control"),expires:e.headers.get("Expires"),contentType:e.headers.get("Content-Type")}:s)).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}))})).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}));return i.xhr=s,i},_parseResponse:(e,t)=>200!==e.status?{status:e.status,statusText:e.statusText,message:`incorrect http request with status code(${e.status}): ${e.statusText}`}:"arraybuffer"===t?e.arrayBuffer():"json"===t?e.json():e.text(),getArrayBuffer:(e,t={})=>(t||(t={}),t.responseType="arraybuffer",w$8.get(e,t)),getJSON:function(e,t={}){return t&&t.jsonp?w$8.jsonp(e):((t=t||{}).responseType="json",w$8.get(e,t))},jsonp:function(e){const t="_maptalks_jsonp_"+n++;e.match(/\?/)?e+="&callback="+t:e+="?callback="+t;let s=document.createElement("script");return s.type="text/javascript",s.src=e,new Promise((e=>{window[t]=function(r){document.getElementsByTagName("head")[0].removeChild(s),s=null,delete window[t],e(r)},document.getElementsByTagName("head")[0].appendChild(s)}))}};class x$7{constructor(e,t,s){this._requestImage=e,this.decoders=t,this._supportedFormats=s,this.images={},this._imgRequests={}}requestImageFromBufferURI(e,t,s){if(this.buffers[e.id]){const n=this._createDataView(t,this.buffers[e.id]);return this.getImageByBuffer(n,s)}if(this._imgRequests[e.id])return this._imgRequests[e.id].then((()=>{const n=this._createDataView(t,this.buffers[e.id]);return this.getImageByBuffer(n,s)}));if(u$4(e.uri)){const r=this.buffers[e.id]=h(e.uri),n=this._createDataView(t,r);return this.getImageByBuffer(n,s)}return this._imgRequests[e.id]=w$8.getArrayBuffer(e.uri,null).then((r=>{const n=this.buffers[e.id]=r.data,i=this._createDataView(t,n);return this.getImageByBuffer(i,s)}))}getImageByBuffer(e,t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const s=this.decoders;if(s[t.mimeType])return s[t.mimeType](e,{supportedFormats:this._supportedFormats});if("image/crn"===t.mimeType||"image/ktx2"===t.mimeType||"image/cttf"===t.mimeType)return console.warn("missing transcoder for "+t.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null);{const s=new Blob([e],{type:t.mimeType}),r=URL.createObjectURL(s);return this._getImageInfo(t.id,r)}}requestExternalImage(e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const t=0===e.uri.indexOf("data:image/")?e.uri:this.rootPath+"/"+e.uri;return this._imgRequests[e.id]?this._imgRequests[e.id].then((()=>this.images[e.id])):this._imgRequests[e.id]=this._getImageInfo(e.id,t)}_getImageInfo(e,t){return new Promise(((s,r)=>{this._requestImage(t,((n,i)=>{n?r(n):(URL.revokeObjectURL(t),this.images[e]=i,s(this.images[e]))}))}))}}const T$9=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16];class E$7{constructor(e,t,s){this.rootPath=e,this.gltf=t,this._enableInterleave=!1,this.glbBuffer=s,this.buffers={},this.requests={},this.accessors={},this._compareAccessor()}_requestData(e,t){const s=this.gltf,r=s.accessors[t];if(void 0===r.bufferView)return this.accessors[r.id]=this._toBufferData(e,t,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);return this._requestBufferOfBufferView(s.bufferViews[r.bufferView]).then((s=>{const{buffer:n,byteOffset:i}=s;return this.accessors[r.id]=this._toBufferData(e,t,n,i)}))}_requestBufferOfBufferView(e){const t=this.gltf.buffers[e.buffer];if(this.buffers[t.id]){return Promise.resolve({buffer:this.buffers[t.id],byteOffset:0})}if(this.requests[t.id])return this.requests[t.id].then((()=>Promise.resolve({buffer:this.buffers[t.id],byteOffset:0})));if("binary_glTF"!==e.buffer&&"KHR_binary_glTF"!==e.buffer&&t.uri){if(u$4(t.uri)){const e=this.buffers[t.id]=h(t.uri);return Promise.resolve({buffer:e,byteOffset:0})}let e;const s=t.uri.indexOf("blob:")>=0;return e=t.uri.indexOf("://")>0||s?t.uri:this.rootPath+"/"+t.uri,this.requests[t.id]=w$8.getArrayBuffer(e,null).then((r=>(s&&URL.revokeObjectURL(e),{buffer:this.buffers[t.id]=r.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_toBufferData(e,t,s,r=0){const n=this.gltf,i=n.accessors[t],a=void 0!==i.bufferView?n.bufferViews[i.bufferView]:{},o=(a.byteOffset||0)+r,u=this._getTypeItemSize(i.type),h=f$3(i.componentType),c=a.byteStride||0,l={array:void 0,name:e,accessorName:t,byteLength:i.count*u*h.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:u};if(i.min&&(l.min=i.min),i.max&&(l.max=i.max),s)if(this._enableInterleave)l.byteStride=c,l.byteOffset=o+(i.byteOffset||0),!c||c===u*h.BYTES_PER_ELEMENT||"indices"===e||"input"===e||"output"===e||e.indexOf("morph")>=0?(l.array=this._typedArray(s,i.count,u,o+(i.byteOffset||0),h),l.array.buffer.byteLength===l.byteLength&&(l.byteOffset=0)):l.array=new Uint8Array(s,o,a.byteLength);else if(i.interleaved){l.byteStride=0,l.byteOffset=0;const e=new h(i.count*u);l.array=b$7(e,s,i.count,u,c,o+(i.byteOffset||0),i.componentType)}else l.byteStride=0,l.array=this._typedArray(s,i.count,u,o+(i.byteOffset||0),h),l.byteOffset=l.array.byteOffset;else{l.array=new h(i.count);const e=l.min||l.max;e&&(l.array[0]=e[0],l.array[1]=e[1],l.array[2]=e[2])}return l}_compareAccessor(){const e=this.gltf.accessors;if(Array.isArray(e))for(let t=0;t<e.length;t++)for(let s=0;s<e.length;s++)t!==s&&e[t].bufferView===e[s].bufferView&&(e[t].interleaved=e[s].interleaved=!0);else for(const t in e)for(const s in e)t!==s&&e[t].bufferView===e[s].bufferView&&(e[t].interleaved=e[s].interleaved=!0)}_typedArray(e,t,s,r,n){return r%n.BYTES_PER_ELEMENT!=0&&(e=e.slice(r,r+t*s*n.BYTES_PER_ELEMENT),r=0),new n(e,r,s*t)}_getTypeItemSize(e){const t=T$9.indexOf(e);return T$9[t+1]}requestKHRTechniquesWebgl(e){const{shaders:t}=e,s=t.map((e=>{if(void 0!==e.bufferView){const t=this.gltf.bufferViews[e.bufferView],{byteLength:s}=t;return this._requestBufferOfBufferView(t).then((r=>{const{buffer:n,byteOffset:i}=r,a=_$7(n,i+(t.byteOffset||0),s);return e.content=a,e}))}if(e.uri){if(u$4(e.uri)){const t=h(e.uri),s=_$7(t,0,t.byteLength);return e.content=s,Promise.resolve(e)}return w$8.get(this.rootPath+"/"+e.uri).then((t=>(e.content=t,e)))}return Promise.resolve(e)}));return Promise.all(s).then((()=>e))}}class I$7 extends x$7{constructor(e,t,s,r,n,i){super(r,n,i),this.rootPath=e,this.gltf=t,this.requests={},this.buffers={},this.glbBuffer=s,this.accessor=new E$7(e,t,s)}iterate(e,t){const s=this.gltf[t];if(!s)return;let r=0;for(const t in s)e(t,s[t],r++)}createNode(e){const s={};if(a(e.name)&&(s.name=e.name),a(e.children)&&(s.children=e.children),a(e.jointName)&&(s.jointName=e.jointName),a(e.matrix)&&(s.matrix=e.matrix),a(e.rotation)&&(s.rotation=e.rotation),a(e.scale)&&(s.scale=e.scale),a(e.translation)&&(s.translation=e.translation),a(e.extras)&&(s.extras=e.extras),a(e.meshes)&&(s.mesh=e.meshes[0]),s.translation||s.rotation||s.scale){const e=function(e,s){if(s.matrix)return s.matrix;if(s.translation||s.scale||s.rotation){const r=fromTranslation$1(c$1,s.translation||m$6),n=fromQuat(l$1,s.rotation||g$4),i=fromScaling(d$4,s.scale||p$7);return multiply$5(i,n,i),multiply$5(e,r,i)}return identity$2(e)}([],s);delete s.translation,delete s.rotation,delete s.scale,s.matrix=e}return s}_loadMaterials(e){const t={};for(const s in e){const r=e[s];let n,i;r.instanceTechnique&&r.instanceTechnique.values?(n=r.instanceTechnique,i=n.values.diffuse):(n=r,i=n.values.tex||n.values.diffuseTex||n.values.diffuse);const a={baseColorTexture:{index:i}};r.name&&(a.name=r.name),r.extensions&&(a.extensions=r.extensions),r.extras&&(a.extras=r.extras),t[s]=a}return t}_loadImage(e){if(e.bufferView||e.extensions&&(e.extensions.KHR_binary_glTF||e.extensions.binary_glTF)){const t=e.bufferView?e:e.extensions.KHR_binary_glTF||e.extensions.binary_glTF;e.extensions&&(e.mimeType=t.mimeType,e.width=t.width,e.height=t.height);const s=this.gltf.bufferViews[t.bufferView],i=this.buffers[t.bufferView]=new Uint8Array(this.glbBuffer.buffer,(s.byteOffset||0)+this.glbBuffer.byteOffset,s.byteLength);return this.getImageByBuffer(i,e)}return this.requestExternalImage(e)}_getTexture(e){const t=this.gltf.textures[e];if(!t)return null;const s=this.gltf.images[t.source];return this._loadImage(s).then((e=>({image:{array:e.data,width:e.width,height:e.height,index:t.source,mimeType:s.mimeType,name:s.name,extras:s.extras},sampler:this.gltf.samplers[t.sampler]})))}getBaseColorTexture(e){const t=this.gltf.materials[e];let s,r;if(t.instanceTechnique&&t.instanceTechnique.values?(s=t.instanceTechnique,r=s.values.diffuse):(s=t,r=s.values.tex||s.values.diffuseTex||s.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const n=this.gltf.textures[r];if(!n)return null;return{format:n.format||6408,internalFormat:n.internalFormat||6408,type:n.type||5121,sampler:this.gltf.samplers[n.sampler],source:this.gltf.images[n.source]}}getMaterial(){return null}getAnimations(){return null}}class O$8 extends x$7{constructor(e,t,s,r,n,i){super(r,n,i),this.rootPath=e,this.gltf=t,this.glbBuffer=s,this.buffers={},this.requests={},this.accessor=new E$7(e,t,s)}iterate(e,t){const s=this.gltf[t];if(s)for(let t=0;t<s.length;t++)e(t,s[t],t)}createNode(e){const t={};return o(t,e),!a(e.weights)&&this.gltf.meshes&&a(t.mesh)?t.weights=this.gltf.meshes[t.mesh].weights:e.weights&&(t.weights=e.weights),t}_getTexture(e){const t=this.gltf.textures[e];if(!t)return null;const s=this.gltf.images[t.source];return this._loadImage(s).then((e=>{if(!e)return null;const r={image:{array:e.data,mipmap:e.mipmap,width:e.width,height:e.height,index:t.source,mimeType:s.mimeType,name:s.name,extensions:s.extensions,extras:s.extras}};o(r,t);const n=a(t.sampler)?this.gltf.samplers[t.sampler]:void 0;return n&&(r.sampler=n),e.format&&(r.format=e.format),r}))}_loadImage(e){if(!a(e.bufferView))return this.requestExternalImage(e);{const t=this.gltf.bufferViews[e.bufferView],s=this.gltf.buffers[t.buffer];if(s.uri)return this.requestImageFromBufferURI(s,t,e);if(this.glbBuffer)return this._requestFromGlbBuffer(t,e)}return null}_requestFromGlbBuffer(e,t){const s=this._createDataView(e,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(s,t)}_createDataView(e,t,s){s=s||0;return new Uint8Array(t,e.byteOffset+s,e.byteLength)}_transformArrayBufferToBase64(e,t){const s=new Array(e.byteLength);for(let t=0;t<e.byteLength;t++)s[t]=String.fromCharCode(e[t]);return s.join(""),"data:"+(t=t||"image/png")+";base64,"+function(e){return"undefined"!=typeof self?self.btoa(e):window.btoa(e)}(unescape(encodeURIComponent(s)))}getAnimations(e){const t=[];return e.forEach((e=>{t.push(this.getSamplers(e.samplers))})),Promise.all(t).then((t=>{for(let s=0;s<t.length;s++)e[s].samplers=t[s];return e}))}getSamplers(e){const t=[];for(let s=0;s<e.length;s++)(a(e[s].input)||a(e[s].output))&&(t.push(this.accessor._requestData("input",e[s].input)),t.push(this.accessor._requestData("output",e[s].output)));return Promise.all(t).then((t=>{for(let s=0;s<t.length/2;s++)e[s].input=t[2*s],e[s].output=t[2*s+1],e[s].interpolation||(e[s].interpolation="LINEAR");return e}))}}const R$9="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class A$6{static read(e,t=0,s=0){s||(s=e.byteLength);const r=new DataView(e,t,s),n=r.getUint32(4,!0);if(1===n)return A$6.readV1(r,t);if(2===n)return A$6.readV2(e,t);throw new Error("Unsupported glb version : "+n)}static readV1(e,t){const s=e.getUint32(8,!0),r=e.getUint32(12,!0);if(s!==e.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const n=P$8(e.buffer,20+t,r);return{json:JSON.parse(n),glbBuffer:{byteOffset:20+t+r,buffer:e.buffer,byteLength:s}}}static readV2(e,t){let s,r,n;const i=new DataView(e,t+12);let a=0;for(;a<i.byteLength;){const o=i.getUint32(a,!0);a+=4;const f=i.getUint32(a,!0);if(a+=4,1313821514===f)s=P$8(e,t+12+a,o);else if(5130562===f){n=t+12+a,r=o;break}a+=o}return{json:JSON.parse(s),glbBuffer:{byteOffset:n,buffer:e,byteLength:r}}}}function P$8(e,t,s){if(R$9){const r=new Uint8Array(e,t,s);return R$9.decode(r)}return function(e){const t=e.length;let s="";for(let r=0;r<t;){let n=e[r++];if(128&n){let s=S$8[n>>3&7];if(!(64&n)||!s||r+s>t)return null;for(n&=63>>s;s>0;s-=1){const t=e[r++];if(128!=(192&t))return null;n=n<<6|63&t}}s+=String.fromCharCode(n)}return s}(new Uint8Array(e,t,s))}const S$8=[1,1,1,1,2,2,3,0],q$8=[0,0,0],v$7=[0,0,0,1],V$9=[1,1,1],M$8={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},L$9={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},U$8={_getTRSW(t,r,n,i,o,f,u,h){const c=a(t)?r.animations:[r.animations[0]],l={};for(let r=0;r<c.length;r++){const d=c[r],m=d.name||r;if(a(t)&&m!==t)continue;const g=d.channelsMap[n];if(g)for(let t=0;t<g.length;t++){const r=g[t];"translation"===r.target.path?(this._getAnimateData(o,d.samplers[r.sampler],i,1),l.translation=copy$4(q$8,o)):"rotation"===r.target.path?(this._getQuaternion(f,d.samplers[r.sampler],i,1),l.rotation=copy$2(v$7,f)):"scale"===r.target.path?(this._getAnimateData(u,d.samplers[r.sampler],i,1),l.scale=copy$4(V$9,u)):"weights"===r.target.path&&h&&(this._getAnimateData(h,d.samplers[r.sampler],i,h.length),l.weights=h)}}return l},_getAnimateData(e,t,s,r){switch(t.interpolation){case"LINEAR":{const n=this._getPreNext(L$9,t,s,1*r);n&&(e=function(e,t,s,r){for(let n=0;n<e.length;n++)e[n]=t[n]+r*(s[n]-t[n]);return e}(e,n.PREVIOUS,n.NEXT,n.INTERPOLATION));break}case"STEP":{const n=this._getPreNext(L$9,t,s,1*r);n&&(e=function(e,t){for(let s=0;s<e.length;s++)e[s]=t[s];return e}(e,...n.PREVIOUS));break}case"CUBICSPLINE":{const n=this._getPreNext(L$9,t,s,3*r);n&&(e=this._getCubicSpline(e,n,t.input.array,3*r));break}}return e},_getQuaternion(t,s,n){switch(s.interpolation){case"LINEAR":{const r=this._getPreNext(L$9,s,n,1);r&&slerp(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const e=this._getPreNext(L$9,s,n,1);e&&(t=set$3(t,...e.PREVIOUS));break}case"CUBICSPLINE":{const e=this._getPreNext(L$9,s,n,3);if(e){for(let t=0;t<e.PREVIOUS.length;t++)e.PREVIOUS[t]=Math.acos(e.PREVIOUS[t]),e.NEXT[t]=Math.acos(e.NEXT[t]);t=this._getCubicSpline(t,e,s.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},_search(e,t){const s=e.length;let r,n,i,a=0,o=s-1,f=Math.floor((a+o)/2);for(;a<=s-1&&o>=0;){if(a===o)return null;if(e[f]<=t&&t<=e[f+1]){const s=e[f];return r=f,n=f+1,i=(t-s)/(e[f+1]-s),{preIndx:r,nextIndex:n,interpolation:i}}t<e[f]?(o=f,f=Math.floor((a+o)/2)):e[f+1]<t&&(a=f,f=Math.floor((a+o)/2))}return null},_getPreNext(e,t,s,r){const n=t.input.array,i=t.output.array,a=t.output.itemSize;(s<n[0]||s>n[n.length-1])&&(s=Math.max(n[0],Math.min(n[n.length-1],s))),s===n[n.length-1]&&(s=n[0]);const o=this._search(n,s);if(!o||!o.nextIndex)return null;const{preIndx:f,nextIndex:u,interpolation:h}=o;e.PREINDEX=f,e.NEXTINDEX=u,e.INTERPOLATION=h;const c=a*r;return e.PREVIOUS=i.subarray(e.PREINDEX*c,(e.PREINDEX+1)*c),e.NEXT=i.subarray(e.NEXTINDEX*c,(e.NEXTINDEX+1)*c),e},_getCubicSpline(e,t,s,r){const n=t.INTERPOLATION,i=s[t.PREINDEX],a=s[t.NEXTINDEX];for(let s=0;s<3;s++){const o=t.PREVIOUS[r+s],f=(a-i)*t.PREVIOUS[2*r+s],u=t.NEXT[3+s],h=(a-i)*t.NEXT[s],c=(2*Math.pow(n,3)-3*Math.pow(n,2)+1)*o+(Math.pow(n,3)-2*Math.pow(n,2)+n)*f+(2*-Math.pow(n,3)+3*Math.pow(n,2))*u+(Math.pow(n,3)-Math.pow(n,2))*h;e[s]=c}return e},getAnimationClip(e,t,n,i){const a=e.nodes[t]&&e.nodes[t].weights;return set$4(q$8,...M$8.TRANSLATION),set$3(v$7,...M$8.ROTATION),set$4(V$9,...M$8.SCALE),this._getTRSW(i,e,t,n,q$8,v$7,V$9,a)},getTimeSpan(e){if(!e.animations)return null;if(e.timeSpan)return e.timeSpan;const t=e.animations;return e.timeSpan={},t.forEach(((t,s)=>{let r=-1/0,n=1/0;const i=t.channels;for(let e=0;e<i.length;e++){const a=t.samplers[i[e].sampler].input.array;a[a.length-1]>r&&(r=a[a.length-1]),a[0]<n&&(n=a[0])}e.timeSpan[t.name||s]={max:r,min:n}})),e.timeSpan},getTimeSpanByName(e,t){const s=this.getTimeSpan(e);return s?a(t)?s[t]:s[Object.keys(s)[0]]:null}};let D$8=!1;if("undefined"!=typeof OffscreenCanvas){let e;try{e=new OffscreenCanvas(2,2).getContext("2d")}catch(e){}e&&"undefined"!=typeof createImageBitmap&&(D$8=!0)}const C$7="undefined"==typeof document?null:document.createElement("canvas");class k$8{constructor(e,t,s){if(this.options=s||{},this.options.decoders||(this.options.decoders={}),t.buffer instanceof ArrayBuffer){const{json:s,glbBuffer:r}=A$6.read(t.buffer,t.byteOffset,t.byteLength);this._init(e,s,r)}else this._init(e,t);this._accessor=new E$7(this.rootPath,this.gltf,this.glbBuffer),this._checkExtensions()}_checkExtensions(){const e=this.gltf.extensionsRequired;if(e){if(e.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(e.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}_loadExtensions(){const e=this.gltf.extensions;return e&&e.KHR_techniques_webgl?this._accessor.requestKHRTechniquesWebgl(e.KHR_techniques_webgl).then((t=>(e.KHR_techniques_webgl=t,e))):Promise.resolve(e)}load(e){const t=this._loadScene(e=e||{}),s=this._loadAnimations(),r=this._loadTextures(),n=this._loadExtensions();return Promise.all([t,s,r,n]).then((e=>(e[0].animations=e[1],e[0].textures=e[2],e[0].extensions=e[3],e[0].transferables=this.transferables||[],this.createChannelsMap(e[0]),e[0])))}createChannelsMap(e){const t=e.animations;if(t)for(let e=0;e<t.length;e++){const s=t[e];s.channelsMap={};for(let e=0;e<s.channels.length;e++){const t=s.channels[e];s.channelsMap[t.target.node]||(s.channelsMap[t.target.node]=[]),s.channelsMap[t.target.node].push(t)}}}getExternalResources(){const e=[];if(this.gltf){const{buffers:t,images:s}=this.gltf;for(let s=0;s<t.length;s++)t[s].uri&&t[s].uri.indexOf("data:application/octet-stream;base64")<0&&e.push({type:"buffer",uri:t[s].uri});for(let t=0;t<s.length;t++)s[t].uri&&s[t].uri.indexOf("data:image/")<0&&e.push({type:"image",uri:s[t].uri})}return e}static getAnimationClip(e,t,s,r){return U$8.getAnimationClip(e,t,s,r)}static getAnimationTimeSpan(e,t){return U$8.getTimeSpanByName(e,t)}static getTypedArrayCtor(e){return f$3(e)}static readInterleavedArray(e,t,s,r,n,i,a){return b$7(e,t,s,r,n,i,a)}_init(e,t,s){this.gltf=t,this.glbBuffer=s,this.version=t.asset?+t.asset.version:1,this.rootPath=e,this.buffers={},this.requests={},this.options.requestImage=D$8?H$9.bind(this):this.options.requestImage||X$8,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new O$8(e,t,s,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((e,t,s)=>{t.id="buffer_"+s}),"buffers"),this.adapter.iterate(((e,t,s)=>{t.id="image_"+s}),"images"),this.adapter.iterate(((e,t,s)=>{t.id="accessor_"+s}),"accessors")):(this.adapter=new I$7(e,t,s,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((e,t,s)=>{t.id="accessor_"+s}),"accessors"),this.adapter.iterate(((e,t,s)=>{t.id="image_"+s}),"images"))}_parseNodes(e,t){if(e.children&&e.children.length>0){if(!("number"==typeof(s=e.children[0])&&isFinite(s)||function(e){return!i$3(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}(e.children[0])))return e;const r=e.children.map((e=>{const s=t[e];return s.nodeIndex=e,this._parseNodes(s,t)}));e.children=r}var s;return e}_loadScene(e){return this._loadNodes(e).then((e=>{const t=this.scenes=[];let s;for(const t in e)e[t]=this._parseNodes(e[t],e),e[t].nodeIndex=Number(t)?Number(t):t;this.adapter.iterate(((r,n,i)=>{const a={};n.name&&(a.name=n.name),n.nodes&&(a.nodes=n.nodes.map((t=>e[t]))),this.gltf.scene===r&&(s=i),t.push(a)}),"scenes");const r={asset:this.gltf.asset,scene:s,scenes:t,nodes:e,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const e=this.adapter._loadMaterials(this.gltf.materials);r.materials=e}return r}))}_loadNodes(e){return this._loadMeshes(e).then((()=>{const e=this.nodes={};return this.adapter.iterate(((t,s)=>{const r=this.adapter.createNode(s,this.meshes,this.skins);e[t]=r}),"nodes"),e}))}_loadSkins(){this.skins=[];const e=[];return this.adapter.iterate(((t,s,r)=>{e.push(this._loadSkin(s).then((e=>{e.index=r,this.skins.push(e)})))}),"skins"),e}_loadSkin(e){return this.adapter.accessor._requestData("inverseBindMatrices",e.inverseBindMatrices).then((t=>(e.inverseBindMatrices=t,t&&t.buffer&&this.transferables&&this.transferables.indexOf(t.buffer)<0&&this.transferables.push(t.buffer),e)))}_loadAnimations(){const e=this.gltf.animations;return a(e)?this.adapter.getAnimations(e):null}_loadMeshes(e){this.meshes={};let t=[];return this.adapter.iterate(((s,r,n)=>{t.push(this._loadMesh(r,e).then((e=>{e.index=n,this.meshes[s]=e})))}),"meshes"),t=t.concat(this._loadSkins()),Promise.all(t)}_loadMesh(e,t){const s=e.primitives.map((e=>this._loadPrimitive(e,t))).filter((e=>!!e));return Promise.all(s).then((t=>{const s={};return o(s,e),s.primitives=t,s}))}_loadTextures(){const e=this.gltf.textures;if(!e)return null;const t=[];for(const s in e)t.push(this.adapter._getTexture(s));return Promise.all(t).then((t=>{if(this.transferables)for(let e=0;e<t.length;e++){const s=t[e].image.array;if(t[e]&&s){let e;e=s instanceof ImageBitmap?s:s.buffer,e&&this.transferables.indexOf(e)<0&&this.transferables.push(e)}}if(!Array.isArray(e)){const s={},r=Object.keys(e);for(let e=0;e<t.length;e++)t[e]&&(s[r[e]]=t[e]);return s}return t}))}_loadPrimitive(e,t){let r;const n=[],i=e.extensions;if(a(e.targets))for(let t=0;t<e.targets.length;t++){const s=e.targets[t];for(const e in s){const r=this.adapter.accessor._requestData(`morphTargets_${e}_${t}`,s[e]);r&&n.push(r)}}if(i&&i.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const e=this.options.decoders.draco,{bufferView:s,attributes:a}=i.KHR_draco_mesh_compression,o=this.gltf.bufferViews[s],f=this._accessor._requestBufferOfBufferView(o).then((s=>{const{buffer:r,byteOffset:n}=s;let{byteOffset:i,byteLength:f}=o;i||(i=0);const u=new DataView(r,n+i,f);return e(u,{attributes:a,useUniqueIDs:!1,skipAttributeTransform:t.skipAttributeTransform}).then((e=>{const t=Object.values(e.attributes);return e.indices&&t.push(e.indices),t}))}));n.push(f),r=Promise.all(n)}else{const t=e.attributes;for(const e in t){const s=this.adapter.accessor._requestData(e,t[e]);s&&n.push(s)}if(a(e.indices)){const t=this.adapter.accessor._requestData("indices",e.indices);t&&n.push(t)}r=Promise.all(n)}return r.then((t=>{if(i&&i.KHR_draco_mesh_compression){const s=e.targets?e.targets.length:0;t[s]=t[s].concat(t.slice(0,s)),t=t[s]}let r,n;const o={attributes:t.reduce(((e,t)=>{if("indices"===t.name)r=t;else if(t.name.indexOf("morphTargets_")>-1)n=n||{},n[t.name.slice(13)]=t;else{if(!("POSITION"!==t.name||t.min&&t.max)){const e=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0],{itemSize:n,array:i}=t,a=i.length/n;for(let t=0;t<a;t++)for(let s=0;s<n;s++){const a=t*n+s;i[a]<e[s]&&(e[s]=i[a]),i[a]>r[s]&&(r[s]=i[a])}if(t.quantization){const n=t.quantization,i=n.range/(1<<n.quantizationBits),a=n.minValues;scale$4(e,e,i),add$4(e,e,a),scale$4(r,r,i),add$4(r,r,a)}t.min=e,t.max=r}e[t.name]=t}return this.transferables&&t.array.buffer&&this.transferables.indexOf(t.array.buffer)<0&&this.transferables.push(t.array.buffer),e}),{}),material:e.material};return r&&(o.indices=r),n&&(o.morphTargets=n),o.mode=a(e.mode)?e.mode:4,a(e.extras)&&(o.extras=e.extras),o}))}}function X$8(e,t){const s=new Image;s.crossOrigin="",s.onload=()=>{if(!C$7)return void t(new Error("There is no canvas to draw image!"));C$7.width=s.width,C$7.height=s.height;const e=C$7.getContext("2d",{willReadFrequently:!0});e.drawImage(s,0,0,s.width,s.height);const r=e.getImageData(0,0,s.width,s.height),n={width:s.width,height:s.height,data:new Uint8Array(r.data)};t(null,n)},s.onerror=function(e){t(e)},s.src=e}let j$8,F$8;function H$9(e,t){j$8||(j$8=new OffscreenCanvas(2,2),F$8=j$8.getContext("2d",{willReadFrequently:!0})),fetch(e).then((e=>e.arrayBuffer())).then((e=>{const t=new Blob([new Uint8Array(e)]);return createImageBitmap(t)})).then((e=>{let{width:s,height:r}=e;K$8(s)||(s=z$7(s)),K$8(r)||(r=z$7(r));const n=this.options.maxTextureSize;n&&(s=Math.min(n,s),r=Math.min(n,r)),j$8.width=s,j$8.height=r,F$8.drawImage(e,0,0,s,r),e.close();const i=F$8.getImageData(0,0,s,r);t(null,{width:s,height:r,data:new Uint8Array(i.data)})})).catch((e=>{console.warn(e),t(e)}))}function K$8(e){return 0==(e&e-1)&&0!==e}function z$7(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}class Vertex{constructor(vertices,index){this.position=vertices,this.index=index,this.faces=[],this.neighbors=[]}addUniqueNeighbor(vertex){-1===this.neighbors.indexOf(vertex)&&this.neighbors.push(vertex)}}class Triangle{constructor(v1,v2,v3,face){this.a=face.a,this.b=face.b,this.c=face.c,this.v1=v1,this.v2=v2,this.v3=v3,this.normal=[],this.computeNormal(),v1.faces.push(this),v1.addUniqueNeighbor(v2),v1.addUniqueNeighbor(v3),v2.faces.push(this),v2.addUniqueNeighbor(v1),v2.addUniqueNeighbor(v3),v3.faces.push(this),v3.addUniqueNeighbor(v1),v3.addUniqueNeighbor(v2)}computeNormal(){const vA=this.v1.position,vB=this.v2.position,cross=cross$1([],sub$2([],this.v3.position,vB),sub$2([],vA,vB));normalize$4(this.normal,cross)}hasVertex(v){return v===this.v1||v===this.v2||v===this.v3}}
/*!
	 * Contains code from google filament
	 * https://github.com/google/filament/
	 * License Apache-2.0
	 */const MAT0=[],TMP0=[],TMP1=[],TMP2=[];function packTangentFrame(q,n,t){const c=cross$1(TMP0,n,t);q=fromMat3(q,function(out,c00,c01,c02,c10,c11,c12,c20,c21,c22){return out[0]=c00,out[1]=c01,out[2]=c02,out[3]=c10,out[4]=c11,out[5]=c12,out[6]=c20,out[7]=c21,out[8]=c22,out}(MAT0,t[0],t[1],t[2],...c,...n));const bias=1/32767;if((q=function(q){return q[3]<0?scale$2(q,q,-1):q}(q=normalize$2(q,q)))[3]<bias){q[3]=bias;const factor=Math.sqrt(1-bias*bias);q[0]*=factor,q[1]*=factor,q[2]*=factor}const b=t[3]>0?cross$1(TMP1,t,n):cross$1(TMP1,n,t);return dot$4(cross$1(TMP2,t,n),b)<0&&scale$2(q,q,-1),q}function fromArray3(out,array,offset){return out[0]=array[offset],out[1]=array[offset+1],out[2]=array[offset+2],out}function fromArray2(out,array,offset){return out[0]=array[offset],out[1]=array[offset+1],out}
/*!
	 * @maptalks/reshader.gl v0.81.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.com
	 */function c(t){return!u$2(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function u$2(t){return null==t}function f$2(t){return!u$2(t)}function d$3(t){return!u$2(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}const m$5="function"==typeof Object.assign;function g$3(t){if(m$5)Object.assign.apply(Object,arguments);else for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function p$6(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)null!=n[e]&&(t[e]=n[e])}return t}function _$6(t){return"number"==typeof t&&!isNaN(t)}function v$6(t,e,n){return t*(1-n)+e*n}function y$5(t){return Array.isArray(t)||t instanceof Uint8Array||t instanceof Int8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Uint32Array||t instanceof Int32Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t instanceof Float64Array}function x$6(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:Float32Array}function b$6(t,e,n){return Math.min(n,Math.max(e,t))}function w$7(t){return t&&t.hasExtension("oes_vertex_array_object")}function C$6(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function M$7(t){if(t.data){if(t.data.BYTES_PER_ELEMENT)return t.data.length*t.data.BYTES_PER_ELEMENT;if(t.data.length)return 4*t.data.length}else{if(t.BYTES_PER_ELEMENT)return t.length*t.BYTES_PER_ELEMENT;if(t.length)return 4*t.length;if(t.buffer&&t.buffer.destroy)return t.buffer._buffer.byteLength}return 0}function T$8(t){return t.width*t.height*P$7(t.format)*S$7(t.type)*("textureCube"===t._reglType?6:1)}function S$7(t){return"uint8"===t?1:"uint16"===t||"float16"===t||"half float"===t?2:"uint32"===t||"float"===t||"float32"===t?4:0}function P$7(t){return"depth"===t||"alpha"===t||"luminance"===t?1:"luminance alpha"===t||"depth stencil"===t?2:"srgba"===t||"rgb5 a1"===t||"rgba"===t.substring(0,4)?4:"srgb"===t||"rgb"===t.substring(0,3)?3:1}function A$5(e){if(!e.componentType)return!1;const n=k$8.getTypedArrayCtor(e.componentType);return e.byteStride>0&&e.byteStride!==e.itemSize*n.BYTES_PER_ELEMENT}function E$6(t){return t&&(t.stride>0||A$5(t))}function O$7(t){let e=0;const n=t&&t.length||0;if(!n)return e;let i;for(let r=0;r<n;r++)i=t.charCodeAt(r),e=(e<<5)-e+i,e&=e;return e}function R$8(t){return 0==(t&t-1)&&0!==t}function I$6(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var k$7=Object.freeze({__proto__:null,isString:c,isNil:u$2,defined:f$2,isFunction:d$3,extend:g$3,extend1:p$6,extend2:function(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)void 0===t[e]&&(t[e]=n[e])}return t},isNumber:_$6,log2:function(t){if(Math.log2)return Math.log2(t);const e=Math.log(t)*Math.LOG2E,n=Math.round(e);return Math.abs(n-e)<1e-14?n:e},normalize:function(t,e){let n=0;for(let t=0,i=e.length;t<i;t++)n+=e[t];for(let i=0,r=e.length;i<r;i++)t[i]=e[i]/n;return t},interpolate:v$6,isArray:y$5,lerp:function(t,e,n,i){for(let r=0;r<t.length;r++)t[r]=e[r]+i*(n[r]-e[r]);return t},set:function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t},getPosArrayType:x$6,clamp:b$6,isSupportVAO:w$7,hasOwn:C$6,getBufferSize:M$7,getTexMemorySize:T$8,getTextureByteWidth:S$7,getTextureChannels:P$7,isInStride:A$5,isInterleaved:E$6,getSupportedFormats:function(t){return{etc:!!t.getExtension("WEBGL_compressed_texture_etc"),etc1:!!t.getExtension("WEBGL_compressed_texture_etc1"),s3tc:!!t.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:!!t.getExtension("WEBGL_compressed_texture_pvrtc"),astc:!!t.getExtension("WEBGL_compressed_texture_astc"),bc7:!!t.getExtension("EXT_texture_compression_bptc")}},hashCode:O$7,isPowerOfTwo:R$8,floorPowerOfTwo:I$6});const D$7=t=>class extends t{on(t,e){return this._events||(this._events={type:[e]}),this._events[t]=this._events[t]||[],this._events[t].push(e),this}once(t,e){return this.on(t,this._wrapOnce(t,e))}off(t,e){return this._events&&this._events[t]?(this._events[t].splice(this._events[t].indexOf(e),1),this):this}fire(t,e={}){if(!this._events||!this._events[t])return this;e.target||(e.target=this);const n=this._events[t].slice(0);for(const t of n)t(e);return this}_wrapOnce(t,e){const n=this;let i=!1;return function r(o){i||(i=!0,e(o),n.off(t,r))}}},L$8="__reshader_disposed";var z$6=Object.freeze({__proto__:null,KEY_DISPOSED:L$8,WEBGL_EXTENSIONS:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],WEBGL_OPTIONAL_EXTENSIONS:["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_texture_filter_anisotropic"]}),F$7=D$7(class{constructor(t,e){if(d$3(t)){this._texture=t,t=this.config={};for(const e in this._texture)C$6(this._texture,e)&&(d$3(this._texture[e])||(t[e]=this._texture[e]))}else if(this.config=t||{},this.resLoader=e,!t.url&&!t.promise||t.data)t.data&&this._needPowerOf2()&&(t.data instanceof Image&&(t.data=j$7(t.data),t.width=t.data.width,t.height=t.data.height),t.hdr||!y$5(t.data)||R$8(t.width)&&R$8(t.height)||(t.data=function(t,e,n){let i=e,r=n;R$8(e)||(i=I$6(e)),R$8(n)||(r=I$6(n));const o=new ImageData(new Uint8ClampedArray(t),e,n),s=document.createElement("canvas");s.width=e,s.height=n,s.getContext("2d").putImageData(o,0,0);const a=document.createElement("canvas");return a.width=i,a.height=r,a.getContext("2d").drawImage(s,0,0,i,r),console.warn(`Texture's size is not power of two, resize from (${e}, ${n}) to (${i}, ${r})`),a}(t.data,t.width,t.height),t.width=t.data.width,t.height=t.data.height));else{this._loading=!0;const n=this;let i;if(t.promise)i=t.promise;else{let n;n=t.arrayBuffer?e.getArrayBuffer:e.get,i=n.call(e,t.url)}t.data=e.getDefaultTexture(t.url),this.promise=i,i.then((t=>(delete this.promise,n._loading=!1,n.config?(t.data instanceof Image&&this._needPowerOf2()&&(t.data=j$7(t.data)),n.onLoad(t),Array.isArray(t)||(t=[t]),n.fire("complete",{target:this,resources:t}),t):t))).catch((t=>{console.error("error when loading texture image.",t),n.fire("error",{target:this,error:t})}))}}isReady(){return!this._loading}set(t,e){return this.config[t]=e,this.dirty=!0,this}get(t){return this.config[t]}getREGLTexture(t){return this._texture||(this._texture=this.createREGLTexture(t),this.config.persistent||(this.config.data&&(this.config.data instanceof ImageBitmap&&this.config.data.close(),this.config.data=[]),this.config.faces&&(this.config.faces=[]),this.config.image&&(this.config.image.array=[]),this.config.mipmap&&delete this.config.mipmap)),this.dirty&&this._updateREGL(),this._texture}getMemorySize(){if(!this.config)return 0;const{width:t,height:e,type:n,format:i}=this.config,r=S$7(n||"uint8"),o=P$7(i||"rgba");return this.config.faces?t*e*r*o*6:t*e*r*o}_updateREGL(){this._texture&&!this._texture[L$8]&&this._texture(this.config),this.dirty=!1}dispose(){this.config&&this.config.url&&(URL.revokeObjectURL(this.config.url),this.resLoader.disposeRes(this.config.url)),this._texture&&!this._texture[L$8]&&(this._texture._reshader_refCount&&this._texture._reshader_refCount--,this._texture._reshader_refCount||(this._texture.destroy(),this._texture[L$8]=!0,delete this._texture)),delete this.resLoader;const t=this.config&&this.config.url;delete this.config,t&&this.fire("disposed",{target:this,url:t})}_needPowerOf2(){const t=this.config;return t.wrap&&"clamp"!==t.wrap||t.wrapS&&"clamp"!==t.wrapS||t.wrapT&&"clamp"!==t.wrapT||t.min&&"nearest"!==t.min&&"linear"!==t.min}});function j$7(t){if(R$8(t.width)&&R$8(t.height))return t;let e=t.width,n=t.height;R$8(e)||(e=I$6(e)),R$8(n)||(n=I$6(n));const i=document.createElement("canvas");i.width=e,i.height=n,i.getContext("2d").drawImage(t,0,0,e,n);const r=t.src,o=r.lastIndexOf("/")+1,s=r.substring(o);return console.warn(`Texture(${s})'s size is not power of two, resize from (${t.width}, ${t.height}) to (${e}, ${n})`),i}const H$8={};class N$8{constructor(t){this.regl=t}render(t,e,n,i){t.setUniforms(e||H$8),t.setFramebuffer(i);let r=0;if(n){const{opaques:e,transparents:i}=n.getSortedMeshes();r+=t.draw(this.regl,e),r+=t.draw(this.regl,i)}else r+=t.draw(this.regl);return r}clear(t){this.regl.clear(t)}}const G$7=[],V$8=identity$2([]),W$7={min:[],max:[]};class U$7{constructor(t,e){this.min=t||[1/0,1/0,1/0],this.max=e||[-1/0,-1/0,-1/0],this.updateVertex()}static copy(t,e){copy$4(t.min,e.min),copy$4(t.max,e.max);for(let i=0;i<e.vertex.length;i++)copy$4(t.vertex[i],e.vertex[i]);return t}combine(t){return t?(Array.isArray(t)&&(copy$4(W$7.min,t[0]),copy$4(W$7.max,t[1]),t=W$7),t.min[0]<this.min[0]&&(this.min[0]=t.min[0],this._dirty=!0),t.min[1]<this.min[1]&&(this.min[1]=t.min[1],this._dirty=!0),t.min[2]<this.min[2]&&(this.min[2]=t.min[2],this._dirty=!0),t.max[0]>this.max[0]&&(this.max[0]=t.max[0],this._dirty=!0),t.max[1]>this.max[1]&&(this.max[1]=t.max[1],this._dirty=!0),t.max[2]>this.max[2]&&(this.max[2]=t.max[2],this._dirty=!0),this):this}dirty(){return this._dirty=!0,this}getCenter(){return this.center||(this.center=[],this._dirty=!0),this._dirty&&(add$4(this.center,this.min,this.max),scale$4(this.center,this.center,.5)),this._dirty=!1,this.center}containPoint(t){const e=this.min,n=this.max;return e[0]<=t[0]&&e[1]<=t[1]&&e[2]<=t[2]&&n[0]>=t[0]&&n[1]>=t[1]&&n[2]>=t[2]}isFinite(){const t=this.min,e=this.max;return isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])&&isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])}updateVertex(){if(!this.vertex){this.vertex=[];for(let t=0;t<8;t++)this.vertex.push([])}return this.vertex[0][0]=this.min[0],this.vertex[0][1]=this.min[1],this.vertex[0][2]=this.min[2],this.vertex[1][0]=this.min[0],this.vertex[1][1]=this.min[1],this.vertex[1][2]=this.max[2],this.vertex[2][0]=this.min[0],this.vertex[2][1]=this.max[1],this.vertex[2][2]=this.max[2],this.vertex[3][0]=this.min[0],this.vertex[3][1]=this.max[1],this.vertex[3][2]=this.min[2],this.vertex[4][0]=this.max[0],this.vertex[4][1]=this.min[1],this.vertex[4][2]=this.min[2],this.vertex[5][0]=this.max[0],this.vertex[5][1]=this.min[1],this.vertex[5][2]=this.max[2],this.vertex[6][0]=this.max[0],this.vertex[6][1]=this.max[1],this.vertex[6][2]=this.max[2],this.vertex[7][0]=this.max[0],this.vertex[7][1]=this.max[1],this.vertex[7][2]=this.min[2],this.vertex}copy(){return new U$7(this.min.slice(),this.max.slice())}equals(t){if(!equals$5(this.min,t.min)||!equals$5(this.max,t.max))return!1;const e=t.vertex;for(let t=0;t<this.vertex.length;t++)if(!equals$5(e[t],this.vertex[t]))return!1;return!0}transform(t,i){if(t=t||V$8,(i=i||V$8)[1]||i[2]||i[4]||i[6]||i[8]||i[9]){const r=this.vertex,o=multiply$5(G$7,i,t);for(let t=0;t<r.length;t++)transformMat4$2(this.vertex[t],this.vertex[t],o);const s=this.vertex.map((t=>t[0])),a=this.vertex.map((t=>t[1])),h=this.vertex.map((t=>t[2])),l=Math.min(...s),c=Math.max(...s),u=Math.min(...a),f=Math.max(...a),d=Math.min(...h),m=Math.max(...h);set$4(this.min,l,u,d),set$4(this.max,c,f,m)}else{const r=multiply$5(G$7,i,t);transformMat4$2(this.min,this.min,r),transformMat4$2(this.max,this.max,r)}return this}}const Z$7=[],X$7={5120:"int8",5122:"int16",5124:"int32",5121:"uint8",5123:"uint16",5125:"uint32",5126:"float"},J$7={5120:1,5122:2,5124:4,5121:1,5123:2,5125:4,5126:4},q$7={positionSize:3,primitive:"triangles",positionAttribute:"aPosition",normalAttribute:"aNormal",uv0Attribute:"aTexCoord",uv1Attribute:"aTexCoord1",color0Attribute:"aColor0",tangentAttribute:"aTangent",pickingIdAttribute:"aPickingId",textureCoordMatrixAttribute:"aTextureCoordMatrix"};let Y$6=1;const K$7="_reshader_refCount";class Q$7{constructor(t,e,n,i){this._version=0,this.data=t,this.elements=e,this.desc=g$3({},q$7,i);const r=t[this.desc.positionAttribute];n||(e?n=$$7(e):r&&r.length?n=r.length/this.desc.positionSize:r&&r.interleavedArray?n=r.interleavedArray.length/this.desc.positionSize:r&&r.array&&(n=r.array.length/this.desc.positionSize)),this.count=n,this.elements||(this.elements=n),this.properties={},this._buffers={},this._vao={},this.getVertexCount(),this._prepareData(),this.updateBoundingBox()}set version(t){throw new Error("Geometry.version is read only.")}get version(){return this._version}_prepareData(){if(!this.data)return;const t=this._buffers||{};for(const e in this.data){const n=this.data[e];if(n)if(n.buffer&&n.buffer.destroy){const t=n.buffer;t[K$7]||(t[K$7]=0),t[K$7]++}else if(n&&n.array)if(A$5(n)){let i=n.array.buffer.__id;i||(i=n.array.buffer.__id=Y$6++),this.data[e]={buffer:i,offset:n.byteOffset,stride:n.byteStride,type:X$7[n.componentType],size:n.itemSize,count:n.count,componentType:n.componentType},t[i]||(t[i]={data:n.array.buffer})}else this.data[e]=n.array}this._buffers=t;const e=this.elements;e&&e.array&&(this.elements=this.elements.array)}getAttrData(t){const e=t.key,n=!this._reglData||!this._reglData[e];if(this._reglData||(this._reglData={}),n){const t=this._reglData[e]={},n=this.data,{positionAttribute:i,normalAttribute:r,uv0Attribute:o,uv1Attribute:s,tangentAttribute:a,color0Attribute:h,pickingIdAttribute:l,textureCoordMatrixAttribute:c}=this.desc;g$3(t,this.data),t.aPosition=n[i],n[r]&&(t.aNormal=n[r]),n[o]&&(t.aTexCoord=n[o]),n[s]&&(t.aTexCoord1=n[s]),n[a]&&(t.aTangent=n[a]),n[h]&&(t.aColor0=n[h]),n[l]&&(t.aPickingId=n[l]),n[c]&&(t.aTextureCoordMatrix=n[c])}return this._reglData[e]}getREGLData(t,e,n){this.getAttrData(e);const i=!this._reglData||!this._reglData[e.key];if(w$7(t)&&!n){const n=e&&e.key||"default";if(!this._vao[n]||i||this._elementsUpdated){const i=this._reglData[e.key],r=this._vertexCount,o=[];for(let t=0;t<e.length;t++){const n=e[t].name,s=i[n]&&i[n].buffer;if(s&&s.destroy)o.push(void 0!==i[n].stride?i[n]:s);else{const t=i[n];if(!t){o.push(this.desc.fillEmptyDataInMissingAttribute?new Uint8Array(4*r):Z$7);continue}const e=(t.data&&y$5(t.data)?t.data.length:t.length)/r;t.data?(t.dimension=e,o.push(t)):o.push({data:t,dimension:e})}}const s={attributes:o,primitive:this.getPrimitive()};if(this.elements&&!_$6(this.elements))if(this.elements.destroy)s.elements=this.elements;else{s.elements={primitive:this.getPrimitive(),data:this.elements};const t=this.getElementsType(this.elements);t&&(s.elements.type=t)}this._vao[n]?this._vao[n].vao(s):this._vao[n]={vao:t.vao(s)},delete this._elementsUpdated}return this._vao[n]}return this._reglData[e.key]}_isAttrChanged(t){if(t===this._activeAttributes)return!1;if(t.length!==this._activeAttributes.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==this._activeAttributes[e])return!0;return!1}generateBuffers(t){const e=this._buffers;for(const n in e)e[n].buffer||(e[n].buffer=t.buffer(e[n].data)),delete e[n].data;const n=this.desc.positionAttribute,i=this.desc.altitudeAttribute,r=this.data,o=this._vertexCount,s={};for(const a in r)if(r[a]){if(void 0===r[a].buffer||r[a].buffer instanceof ArrayBuffer){const e=r[a].data?r[a]:{data:r[a]};e.dimension=(r[a].data?r[a].data:r[a]).length/o;const h=t.buffer(e);h[K$7]=1,s[a]={buffer:h},a!==n&&a!==i||(s[a].array=r[a])}else r[a].buffer.destroy?s[a]=r[a]:e[r[a].buffer]&&(s[a]=g$3({},r[a]),s[a].buffer=e[r[a].buffer].buffer);a!==n&&delete r[a].array}if(this.data=s,delete this._reglData,this.elements&&!_$6(this.elements)){const e={primitive:this.getPrimitive(),data:this.elements},n=this.getElementsType(this.elements);if(n&&(e.type=n),!this.elements.destroy){this.indices=new Uint16Array(this.elements.length);for(let t=0;t<this.elements.length;t++)this.indices[t]=this.elements[t]}this.elements=this.elements.destroy?this.elements:t.elements(e);const i=this.elements;i[K$7]||(i[K$7]=0),i[K$7]++}}getVertexCount(){const{positionAttribute:t,positionSize:e,color0Attribute:n}=this.desc;let i=this.data[t];i.data&&(i=i.data),i.array&&(i=i.array),y$5(i)?this._vertexCount=Math.ceil(i.length/e):i&&void 0!==i.count&&(this._vertexCount=i.count);const r=n;if(this.data[r]){const t=this.data[r].data||this.data[r].array||this.data[r];Array.isArray(t)?this._color0Size=t.length/this._vertexCount:t&&t.count?this._color0Size=t.count/this._vertexCount:this.data[r].buffer&&this.data[r].buffer.destroy&&(this._color0Size=this.data[r].buffer._buffer.dimension)}return this._vertexCount}getColor0Size(){return this._color0Size||0}addBuffer(t,e){return this._buffers[t]={data:e},delete this._reglData,this._deleteVAO(),this}updateBuffer(t,e){if(!this._buffers[t])throw new Error(`invalid buffer ${t} in geometry`);return this._buffers[t].buffer?this._buffers[t].buffer.subdata(e):this._buffers[t].data=e,delete this._reglData,this._deleteVAO(),this}updateData(t,e){const n=this.data[t];if(!n)return this;let i;this._incrVersion(),this.data[t]=e,n.buffer&&n.buffer.destroy&&(i=n);const r=this._vertexCount;t===this.desc.positionAttribute&&this.updateBoundingBox();const o=this.getVertexCount();return i&&(o<=r?i.buffer.subdata(e):i.buffer(e),this.data[t]=i),this._prepareData(),this.desc.positionAttribute===t&&(this._posDirty=!0),delete this._reglData,this}updateSubData(t,e,n){const i=this.data[t];if(!i)return this;let r;if(this._incrVersion(),i.buffer&&i.buffer.destroy&&(r=i),t===this.desc.positionAttribute&&this._updateSubBoundingBox(e),r){const t=J$7[r.buffer._buffer.dtype];e.BYTES_PER_ELEMENT!==t&&(e=new(function(t,e){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Uint8ClampedArray?1===e?Uint8Array:2===e?Uint16Array:Uint32Array:t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array?1===e?Int8Array:2===e?Int16Array:Int32Array:t instanceof Float32Array||t instanceof Float64Array?4===e?Float32Array:Float64Array:void 0}(e,t))(e)),r.buffer.subdata(e,n*t)}else{const i=this.data[t].data?this.data[t].data:this.data[t];for(let t=0;t<e.length;t++)i[n+t]=e[t]}return this._prepareData(),this.desc.positionAttribute===t&&(this._posDirty=!0),delete this._reglData,this}getPrimitive(){return this.desc.primitive}getElements(){return this.elements}setElements(t,e){if(!t)throw new Error("elements data is invalid");this._incrVersion();const n=this.elements;return this.count=void 0===e?$$7(t):e,this.elements=t&&t.destroy?t:n.destroy?n(t):t,this._elementsUpdated=!0,this}setDrawCount(t){return this._incrVersion(),this.count1=t,this}getDrawCount(){return this.count1||this.count}setDrawOffset(t){return this._incrVersion(),this.offset=t,this}getDrawOffset(){return this.offset||0}dispose(){this._deleteVAO(),this._forEachBuffer((t=>{if(!t[L$8]){let e=t[K$7];e&&e--,e<=0?(t[L$8]=!0,t.destroy()):t[K$7]=e}})),this.data={},this._buffers={},delete this._reglData,delete this._attributes,this.count=0,this.elements=[],delete this._tempPosArray,this._disposed=!0}isDisposed(){return!!this._disposed}updateBoundingBox(){let t=this.boundingBox;t||(t=this.boundingBox=new U$7);let e,i,r=this.data[this.desc.positionAttribute];if(y$5(r)||(r.data?r=r.data:E$6(r)?r=this._getAttributeData(this.desc.positionAttribute):r.array&&(e=r.min,i=r.max,r=r.array)),r&&r.length){const o=t.min,s=t.max;if(e&&i)set$4(o,...e),set$4(s,...i);else{set$4(o,r[0],r[1],r[2]),set$4(s,r[0],r[1],r[2]);for(let t=3;t<r.length;){const e=r[t++],n=r[t++],i=r[t++];e<o[0]&&(o[0]=e),n<o[1]&&(o[1]=n),i<o[2]&&(o[2]=i),e>s[0]&&(s[0]=e),n>s[1]&&(s[1]=n),i>s[2]&&(s[2]=i)}}t.updateVertex(),t.dirty()}}_updateSubBoundingBox(t){const e=this.boundingBox,n=e.min,i=e.max,r=this.desc.positionSize;for(let e=0;e<t.length;){const o=t[e++],s=t[e++];let a=0;3===r&&(a=t[e++]),o<n[0]&&(n[0]=o),s<n[1]&&(n[1]=s),a<n[2]&&(n[2]=a),o>i[0]&&(i[0]=o),s>i[1]&&(i[1]=s),a>i[2]&&(i[2]=a)}e.updateVertex(),e.dirty()}_getAttributeData(e){const n=this.data[e],i=n.buffer;if(E$6(n)){const r=this._buffers[i]?this._buffers[i].data:n.array,{count:o,size:s,stride:a,offset:h,componentType:l}=n,c=k$8.getTypedArrayCtor(l);if((0===a||a===s*c.BYTES_PER_ELEMENT)&&h%c.BYTES_PER_ELEMENT==0)return new c(r,h,o*s);if(e===this.desc.positionAttribute)return!this._tempPosArray||this._tempPosArray&&this._tempPosArray.length<s*o?(this._tempPosArray=new c(s*o),k$8.readInterleavedArray(this._tempPosArray,r,o,s,a,h,l)):this._posDirty?(this._posDirty=!1,k$8.readInterleavedArray(this._tempPosArray,r,o,s,a,h,l)):this._tempPosArray;{const e=new c(s*o);return k$8.readInterleavedArray(e,r,o,s,a,h,l)}}return n}createTangent(t="aTangent"){this._incrVersion();const{normalAttribute:e,positionAttribute:r,uv0Attribute:o}=this.desc,s=this._getAttributeData(e),c=
/*!
	 * Contains code from THREE.JS
	 * https://github.com/mrdoob/three.js/
	 * License MIT
	 * 
	 * Generate tangents per vertex.
	 */
function(positions,normals,uvs,indices){const nVertices=positions.length/3,tangents=new Array(4*nVertices),tan1=[],tan2=[];for(let i=0;i<nVertices;i++)tan1[i]=[0,0,0],tan2[i]=[0,0,0];const vA=[0,0,0],vB=[0,0,0],vC=[0,0,0],uvA=[0,0],uvB=[0,0],uvC=[0,0],sdir=[0,0,0],tdir=[0,0,0];function handleTriangle(a,b,c){fromArray3(vA,positions,3*a),fromArray3(vB,positions,3*b),fromArray3(vC,positions,3*c),fromArray2(uvA,uvs,2*a),fromArray2(uvB,uvs,2*b),fromArray2(uvC,uvs,2*c);const x1=vB[0]-vA[0],x2=vC[0]-vA[0],y1=vB[1]-vA[1],y2=vC[1]-vA[1],z1=vB[2]-vA[2],z2=vC[2]-vA[2],s1=uvB[0]-uvA[0],s2=uvC[0]-uvA[0],t1=uvB[1]-uvA[1],t2=uvC[1]-uvA[1],r=1/(s1*t2-s2*t1);set$4(sdir,(t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r),set$4(tdir,(s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r),add$4(tan1[a],tan1[a],sdir),add$4(tan1[b],tan1[b],sdir),add$4(tan1[c],tan1[c],sdir),add$4(tan2[a],tan2[a],tdir),add$4(tan2[b],tan2[b],tdir),add$4(tan2[c],tan2[c],tdir)}for(let j=0,jl=indices.length;j<jl;j+=3)handleTriangle(indices[j+0],indices[j+1],indices[j+2]);const tmp=[],tmp2=[],n=[],n2=[];let w,t,test;function handleVertex(v){fromArray3(n,normals,3*v),copy$4(n2,n),t=tan1[v],copy$4(tmp,t),sub$2(tmp,tmp,scale$4(n,n,dot$4(n,t))),normalize$4(tmp,tmp),cross$1(tmp2,n2,t),test=dot$4(tmp2,tan2[v]),w=test<0?-1:1,tangents[4*v]=tmp[0],tangents[4*v+1]=tmp[1],tangents[4*v+2]=tmp[2],tangents[4*v+3]=w}for(let j=0,jl=indices.length;j<jl;j+=3)handleVertex(indices[j+0]),handleVertex(indices[j+1]),handleVertex(indices[j+2]);return tangents}(this._getAttributeData(r),s,this.data[o],this.elements),u=this.data[t]=new Float32Array(c.length),f=[],d=[],m=[];for(let t=0;t<c.length;t+=4){const e=t/4*3;set$4(d,s[e],s[e+1],s[e+2]),set$3(f,c[t],c[t+1],c[t+2],c[t+3]),packTangentFrame(m,d,f),copy$3(u.subarray(t,t+4),m)}delete this._reglData}createNormal(t="aNormal"){this._incrVersion();const e=this._getAttributeData(this.desc.positionAttribute);this.data[t]=function(positions,indices){const vertexes=[],normals=[];let i=0;for(i=0;i<positions.length;i+=3){const vertex=new Vertex([positions[i],positions[i+1],positions[i+2]],i/3);vertexes.push(vertex)}if(!indices.length){const len=indices;indices=[];for(let i=0;i<len;i++)indices.push(i)}for(i=0;i<indices.length/3;i++){const face={a:indices[3*i],b:indices[3*i+1],c:indices[3*i+2]};new Triangle(vertexes[face.a],vertexes[face.b],vertexes[face.c],face)}const divide=[],normal=[0,0,0];for(i=0;i<vertexes.length;i++){const vertex=vertexes[i],vIndex=vertex.index;set$4(normal,0,0,0);let len=vertex.faces.length;for(let j=0;j<len;j++)add$4(normal,normal,vertex.faces[j].normal);len=len||1,set$4(divide,len,len,len),divide$2(normal,normal,divide),normals[3*vIndex]=normal[0],normals[3*vIndex+1]=normal[1],normals[3*vIndex+2]=normal[2]}return normals}(e.array||e,this.elements),delete this._reglData}createBarycentric(t="aBarycentric"){if("triangles"!==this.desc.primitive)throw new Error("Primitive must be triangles to create bary centric data");this._incrVersion();const e=new Uint8Array(3*this._vertexCount);for(let t=0,n=this.elements.length;t<n;)for(let n=0;n<3;n++)e[3*this.elements[t++]+n]=1;this.data[t]=e,delete this._reglData}buildUniqueVertex(){this._incrVersion();const t=this.data,e=this.elements;if(!y$5(e))throw new Error("elements must be array to build unique vertex.");const n=Object.keys(t),i={};let r=t[this.desc.positionAttribute];if(r=r.length?r:r.array,!y$5(r))throw new Error(this.desc.positionAttribute+" must be array to build unique vertex.");const o=this._vertexCount,s=e.length;for(let e=0;e<n.length;e++){const r=n[e],a=y$5(t[r])?t[r]:t[r].array,h=a.length/o;if(!y$5(a))throw new Error(r+" must be array to build unique vertex.");i[r]=a,i[r].size=h,t[r]=new a.constructor(s*h)}let a=0;for(let r=0;r<s;r++){const o=e[r];for(let e=0;e<n.length;e++){const r=n[e],s=t[r],h=i[r].size;for(let t=0;t<h;t++)s[a*h+t]=i[r][o*h+t]}e[r]=a++}delete this._reglData}getMemorySize(){let t=0;for(const e in this.data)C$6(this.data,e)&&(t+=M$7(this.data[e]));if(this.elements){const e=this.elements;e.destroy?t+=e._elements.buffer.byteLength:e.BYTES_PER_ELEMENT?t+=e.length*e.BYTES_PER_ELEMENT:e.length&&(t+=4*e.length)}return t}_deleteVAO(){for(const t in this._vao)this._vao[t].vao.destroy();this._vao={}}_forEachBuffer(t){this.elements&&this.elements.destroy&&t(this.elements);for(const e in this.data)C$6(this.data,e)&&this.data[e]&&this.data[e].buffer&&this.data[e].buffer.destroy&&t(this.data[e].buffer);for(const e in this._buffers)C$6(this._buffers,e)&&this._buffers[e]&&this._buffers[e].buffer&&this._buffers[e].buffer.destroy&&t(this._buffers[e].buffer)}getElementsType(t){return t instanceof Uint8Array?"uint8":t instanceof Uint16Array?"uint16":t instanceof Uint32Array?"uint32":void 0}_incrVersion(){this._version++}}function $$7(t){if(_$6(t))return t;if(void 0!==t.count)return t.count;if(t.destroy)return t._elements.vertCount;if(void 0!==t.length)return t.length;if(t.data)return t.data.length;throw new Error("invalid elements length")}var tt$6=D$7(class{constructor(t={},e){this._version=0,this.uniforms=p$6({},e||{},t);for(const e in t){const n=Object.getOwnPropertyDescriptor(t,e).get;n&&Object.defineProperty(this.uniforms,e,{get:n})}this._reglUniforms={},this.refCount=0,this._bindedOnTextureComplete=this._onTextureComplete.bind(this),this._genUniformKeys(),this._checkTextures()}set version(t){throw new Error("Material.version is read only.")}get version(){return this._version}isReady(){return this._loadingCount<=0}set(t,e){const n=u$2(this.uniforms[t])&&!u$2(e)||!u$2(this.uniforms[t])&&u$2(e);return this.uniforms[t]&&this.isTexture(t)&&this.uniforms[t].dispose(),u$2(e)?u$2(this.uniforms[t])||delete this.uniforms[t]:this.uniforms[t]=e,this._dirtyUniforms=!0,this.isTexture(t)&&this._checkTextures(),n&&(this._genUniformKeys(),this._incrVersion()),this}get(t){return this.uniforms[t]}isDirty(){return this._uniformVer!==this.version}appendDefines(t){const e=this.uniforms;return e.jointTexture&&(t.HAS_SKIN=1),e.morphWeights1&&(t.HAS_MORPH=1),(e.khr_offset||e.khr_rotation||e.khr_scale)&&(t.HAS_KHR_TEXTURE_TRANSFORM=1),t}hasSkinAnimation(){return this.uniforms&&this.uniforms.jointTexture&&this.uniforms.skinAnimation}getUniforms(t){if(this._reglUniforms&&!this.isDirty())return this._reglUniforms;const e=this.uniforms,n={};for(const i in e)this.isTexture(i)?Object.defineProperty(n,i,{enumerable:!0,configurable:!0,get:function(){return e[i].getREGLTexture(t)}}):Object.defineProperty(n,i,{enumerable:!0,configurable:!0,get:function(){return e[i]}});return this._reglUniforms=n,this._uniformVer=this.version,n}isTexture(t){return this.uniforms[t]instanceof F$7}dispose(){for(const t in this.uniforms){const e=this.uniforms[t];e&&(e.dispose?e.dispose():e.destroy&&!e[L$8]&&(e.destroy(),e[L$8]=!0))}delete this.uniforms,delete this._reglUniforms,this._disposed=!0}isDisposed(){return!!this._disposed}_checkTextures(){this._loadingCount=0;for(const t in this.uniforms)if(this.isTexture(t)){const e=this.uniforms[t];e.isReady()||(this._loadingCount++,e.on("complete",this._bindedOnTextureComplete))}}_onTextureComplete(){this._loadingCount--,this._incrVersion(),this._loadingCount<=0&&(this._disposed||this.fire("complete"))}getUniformKeys(){return this._uniformKeys}_genUniformKeys(){const t=[];for(const e in this.uniforms)C$6(this.uniforms,e)&&!u$2(this.uniforms[e])&&t.push(e);this._uniformKeys=t.join()}_incrVersion(){this._version++}getMemorySize(){const t=this.uniforms;let e=0;for(const n in t)this.isTexture(n)?e+=t[n].getMemorySize():this.uniforms[n].destroy&&(e+=T$8(this.uniforms[n]));return e}});const et$6={time:0,seeThrough:!0,thickness:.03,fill:[1,.5137254902,.98,1],stroke:[.7019607843,.9333333333,.2274509804,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,insideAltColor:!1,squeeze:!1,squeezeMin:.5,squeezeMax:1,dualStroke:!1,secondThickness:.05,opacity:1,noiseEnable:!1};class nt$6 extends tt$6{constructor(t){super(t,et$6)}}const it$6={baseColorFactor:[1,1,1,1],materialShininess:32,environmentExposure:1,specularStrength:32,opacity:1,extrusionOpacity:0,extrusionOpacityRange:[0,1.8],baseColorTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null,uvScale:[1,1],uvOffset:[0,0]};class rt$6 extends tt$6{constructor(t){super(t,it$6)}static convertFrom(t){const e={};for(const n in it$6)e[n]=t.get(n);return new rt$6(e)}appendDefines(t,e){super.appendDefines(t,e);const n=this.uniforms;return n.extrusionOpacity&&(t.HAS_EXTRUSION_OPACITY=1),e.data[e.desc.colorAttribute]&&(t.HAS_COLOR=1),e.data[e.desc.color0Attribute]&&(t.HAS_COLOR0=1,t.COLOR0_SIZE=e.getColor0Size()),e.data[e.desc.uv0Attribute]?(n.baseColorTexture&&(t.HAS_BASECOLOR_MAP=1),n.occlusionTexture&&(t.HAS_AO_MAP=1),n.emissiveTexture&&(t.HAS_EMISSIVE_MAP=1),n.normalTexture&&(t.HAS_NORMAL_MAP=1),(t.HAS_BASECOLOR_MAP||t.HAS_AO_MAP||t.HAS_EMISSIVE_MAP||t.HAS_NORMAL_MAP)&&(t.HAS_MAP=1),t):t}}const ot$6={toons:4,specularToons:2};const at$6={diffuseFactor:[1,1,1,1],specularFactor:[1,1,1],glossinessFactor:1,diffuseTexture:null,specularGlossinessTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null},ht$6=t=>class extends t{constructor(t){super(t=g$3({},at$6,t||{}))}appendDefines(t,e){if(super.appendDefines(t,e),t.SHADING_MODEL_SPECULAR_GLOSSINESS=1,!e.data[e.desc.uv0Attribute])return t;const n=this.uniforms;return n.diffuseTexture&&(t.HAS_DIFFUSE_MAP=1),n.specularGlossinessTexture&&(t.HAS_SPECULARGLOSSINESS_MAP=1),(t.HAS_SPECULARGLOSSINESS_MAP||t.HAS_DIFFUSE_MAP)&&(t.HAS_MAP=1),t}};class lt$6 extends(ht$6(rt$6)){}const ct$6=[];let ut$6=0;class ft$6{constructor(t,n,i={}){this._version=0,this._geometry=t,this._material=n,this.transparent=!!i.transparent,this.bloom=!!i.bloom,this.ssr=!!i.ssr,this.castShadow=u$2(i.castShadow)||i.castShadow,this.picking=!!i.picking,this.disableVAO=!!i.disableVAO,this.uniforms={},this._localTransform=identity$2(new Array(16)),this._positionMatrix=identity$2(new Array(16)),this.properties={},this._dirtyUniforms=!0,this._dirtyGeometry=!0,Object.defineProperty(this,"uuid",{value:ut$6++}),ut$6>Number.MAX_VALUE-10&&(ut$6=0)}set material(t){this._material!==t&&this.setMaterial(t)}get material(){return this._material}set version(t){throw new Error("Mesh.version is read only.")}get version(){return this._version}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._incrVersion(),this._dirtyGeometry=!0),this._geometry=t}set localTransform(t){this._prevTMat||(this._prevTMat=[]),Array.isArray(t)&&!exactEquals$5(this._prevTMat,t)&&(this._incrVersion(),this._prevTMat=copy$5(this._prevTMat,t)),this._localTransform=t}get localTransform(){return this._localTransform}set positionMatrix(t){this._prevPMat||(this._prevPMat=[]),Array.isArray(t)&&!exactEquals$5(this._prevPMat,t)&&(this._incrVersion(),this._prevPMat=copy$5(this._prevPMat,t)),this._positionMatrix=t}get positionMatrix(){return this._positionMatrix}get config(){return this._cfg||(this._cfg={}),this._cfg.transparent=this.transparent,this._cfg.castShadow=this.castShadow,this._cfg.bloom=this.bloom,this._cfg.ssr=this.ssr,this._cfg.picking=this.picking,this._cfg}get defines(){return this._getDefines()}set defines(t){this.setDefines(t)}setMaterial(t){return this._material=t,this._dirtyUniforms=!0,delete this._materialVer,this.dirtyDefines=!0,this}setParent(t){return this.parent=t,this}setLocalTransform(t){return this.localTransform=t,this}setPositionMatrix(t){this.positionMatrix=t}setUniform(t,e){return void 0===this.uniforms[t]&&(this._dirtyUniforms=!0),this.uniforms[t]=e,this}getUniform(t){return this.uniforms[t]}getDefines(){const t={};return g$3(t,this._getDefines()),this._material&&this._geometry&&this._material.appendDefines(t,this._geometry),t}_getDefines(){this._defines||(this._defines={});const t=this._geometry,e=t.data[t.desc.positionAttribute],n=t.data[t.desc.uv0Attribute],i=t.data[t.desc.normalAttribute];return e&&e.quantization&&(this._defines.HAS_DECODE_POSITION=1),n&&n.quantization&&(this._defines.HAS_DECODE_TEXCOORD=1),i&&i.quantization&&(this._defines.HAS_DECODE_NORMAL=1),this._defines}setDefines(t){const e=this._bakDefines;return this._defines=t,this.dirtyDefines=this.dirtyDefines||!!e!=!!t||!function(t,e){if(!t&&!e)return!0;const n=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(e);if(n.length!==i.length)return!1;for(let i=0;i<n.length;i++)if(t[n[i]]!==e[n[i]])return!1;return!0}(e,t),this.dirtyDefines&&(this._bakDefines=g$3({},t)),this}hasSkinAnimation(){return this._material&&this._material.hasSkinAnimation()}_getDefinesKey(){return this.dirtyDefines=!1,this._createDefinesKey(this.getDefines())}getCommandKey(){if(!this._commandKey||this.dirtyDefines||this._material&&this._materialKeys!==this._material.getUniformKeys()){let t=this._getDefinesKey();t+="_"+(_$6(this.getElements())?"count":"elements"),t+="_"+ +!!this.disableVAO,this._commandKey=t,this._material&&(this._materialKeys=this._material.getUniformKeys())}return this._commandKey}getUniforms(t){if(this._dirtyUniforms||this._dirtyGeometry||this._material&&this._materialVer!==this._material.version){if(this._realUniforms={},this._getUniformsForDraco(),this._material){const e=this._material.getUniforms(t);for(const t in e)C$6(e,t)&&Object.defineProperty(this._realUniforms,t,{enumerable:!0,configurable:!0,get:function(){return e[t]}})}const e=this.uniforms;for(const t in this.uniforms)C$6(this.uniforms,t)&&Object.defineProperty(this._realUniforms,t,{enumerable:!0,configurable:!0,get:function(){return e[t]}});this._dirtyUniforms=!1,this._dirtyGeometry=!1,this._materialVer=this._material&&this._material.version}return this._realUniforms.modelMatrix=d$3(this._localTransform)?this._localTransform():this._localTransform,this._realUniforms.positionMatrix=d$3(this._positionMatrix)?this._positionMatrix():this._positionMatrix,this._realUniforms}_getUniformsForDraco(){const t=this._geometry,e=t.data[t.desc.positionAttribute],n=t.data[t.desc.uv0Attribute],i=t.data[t.desc.normalAttribute];if(e&&e.quantization){const t=e.quantization,n=t.range/(1<<t.quantizationBits);this._defineUniformsProperty(this._realUniforms,"minValues_pos",t.minValues),this._defineUniformsProperty(this._realUniforms,"gltf_u_dec_position_normConstant",n)}if(n&&n.quantization){const t=n.quantization;this._defineUniformsProperty(this._realUniforms,"minValues_tex",t.minValues),this._defineUniformsProperty(this._realUniforms,"gltf_u_dec_texcoord_0_normConstant",t.range/(1<<t.quantizationBits))}i&&i.quantization&&this._defineUniformsProperty(this._realUniforms,"gltf_u_dec_normal_rangeConstant",(1<<i.quantization.quantizationBits)-1)}_defineUniformsProperty(t,e,n){f$2(t[e])||Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return n}})}getMaterial(){return this._material}getElements(){return this._geometry.getElements()}_getREGLAttrData(t,e){return this._geometry.getREGLData(t,e,this.disableVAO)}getREGLProps(t,e){const n=this.getUniforms(t);return g$3(n,this._getREGLAttrData(t,e)),w$7(t)&&!this.disableVAO||(n.elements=this._geometry.getElements()),n.meshProperties=this.properties,n.meshConfig=this.config,n.count=this._geometry.getDrawCount(),n.offset=this._geometry.getDrawOffset(),n.primitive=this._geometry.getPrimitive(),n}dispose(){const t=this.properties.oldElementsBeforeHighlight;return t&&!t[L$8]&&t!==this._geometry.elements&&t.destroy&&(t.destroy(),t[L$8]=!0),delete this.properties.oldElementsBeforeHighlight,delete this.properties.hasInvisible,delete this._geometry,delete this._material,this.uniforms={},this}isValid(){return this._geometry&&!this._geometry.isDisposed()&&(!this._material||!this._material.isDisposed())}getBoundingBox(){return this._bbox||this.updateBoundingBox(),multiply$5(ct$6,this._localTransform,this._positionMatrix),exactEquals$5(ct$6,this._currentTransform)&&this._geometry.boundingBox.equals(this._geoBox)||this.updateBoundingBox(),this._bboxArr}updateBoundingBox(){const t=this._geometry.boundingBox;this._bbox||(this._bbox=new U$7),this._bboxArr||(this._bboxArr=[[],[]]),this._geoBox||(this._geoBox=new U$7),U$7.copy(this._bbox,t),this._bbox.updateVertex(),"InstancedMesh"===this.constructor.name?(this._bbox.transform(this._localTransform,this._positionMatrix),this._currentTransform=multiply$5(this._currentTransform||[],this._positionMatrix,this._localTransform)):(this._bbox.transform(this._positionMatrix,this._localTransform),this._currentTransform=multiply$5(this._currentTransform||[],this._localTransform,this._positionMatrix)),U$7.copy(this._geoBox,t),copy$4(this._bboxArr[0],this._bbox.min),copy$4(this._bboxArr[1],this._bbox.max)}_createDefinesKey(t){const e=[];for(const n in t)e.push(n,t[n]);return e.join(",")}_incrVersion(){this._version++}getMemorySize(){return(this.geometry&&this.geometry.getMemorySize()||0)+(this.material&&this.material.getMemorySize()||0)}}ft$6.prototype.getWorldTransform=function(){const t=[];return function(){const n=this.parent;return n?multiply$5(t,n.getWorldTransform(),this._localTransform):this._localTransform}}();class dt$6 extends ft$6{constructor(t,e,n,i,r={}){super(n,i,r),this._instanceCount=e,this.instancedData=t||{},this._checkInstancedProp(),this._vao={}}get instanceCount(){return this._instanceCount}set instanceCount(t){this._incrVersion(),this._instanceCount=t}getMemorySize(){return super.getMemorySize()+this._getInstanceMemorySize()}_getInstanceMemorySize(){let t=0;for(const e in this.instancedData)C$6(this.instancedData,e)&&(t+=M$7(this.instancedData[e]));return t}_checkInstancedProp(){for(const t in this.instancedData)if(this.geometry.data[t])throw new Error(`Duplicate attribute ${t} defined in geometry and instanced data`)}_getREGLAttrData(t,e){const n=this.geometry.getAttrData(e);if(w$7(t)){const i=e.key;if(!this._vao[i]||this._instanceDataUpdated){const r=e.map((t=>t.name)),o=[];for(let t=0;t<r.length;t++){const e=n[r[t]];o.push(e&&e.buffer?e.buffer:this.instancedData[r[t]])}const s={attributes:o,primitive:this.geometry.getPrimitive()};this._vao[i]?this._vao[i].vao(s):this._vao[i]={vao:t.vao(s)},delete this._instanceDataUpdated}return this._vao[i]}return n}getDefines(){const t=super.getDefines();return t.HAS_INSTANCE=1,t}getCommandKey(t){return"i_"+super.getCommandKey(t)}updateInstancedData(t,e){const n=this.instancedData[t];return n?(this._incrVersion(),this.instancedData[t]=e,n.buffer&&n.buffer.destroy&&n.buffer.destroy(),this._instanceDataUpdated=!0,this):this}generateInstancedBuffers(t){const e=this.instancedData,n={};for(const i in e)e[i]&&(void 0!==e[i].buffer&&e[i].buffer.destroy?(n[i]=e[i],n[i].divisor&&(n[i].divisor=1)):n[i]=e[i].destroy?{buffer:e[i],divisor:1}:{buffer:t.buffer({data:e[i],dimension:e[i].length/this._instanceCount}),divisor:1});return this.instancedData=n,this}getREGLProps(t,e){const n=super.getREGLProps(t,e);return w$7(t)||g$3(n,this.instancedData),n.elements=this.geometry.getElements(),n.instances=this._instanceCount,n}disposeInstanceData(){const t=this.instancedData;if(t)for(const e in t)t[e]&&t[e].destroy&&!t[e][L$8]&&(t[e][L$8]=1,t[e].destroy());this.instancedData={};for(const t in this._vao)this._vao[t].vao.destroy();this._vao={}}_getBytesPerElement(t){switch(t){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4}throw new Error("unsupported data type: "+t)}}const mt$6={getArrayBuffer:(t,e)=>mt$6.get(t,{responseType:"arraybuffer"},e),get:function(t,e,n){const i=mt$6._getClient(n);if(i.open("GET",t,!0),e){for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);i.withCredentials="include"===e.credentials,e.responseType&&(i.responseType=e.responseType)}return i.send(null),i},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){let e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=mt$6._wrapCallback(e,t),e}};var gt$6=D$7(class{constructor(t){this.defaultTexture=t,this.defaultCubeTexture=new Array(6),this.resources={}}get(t){return Array.isArray(t)?this._loadImages(t):this._loadImage(t)}getArrayBuffer(t){if(Array.isArray(t)){const e=t.map((t=>this.getArrayBuffer(t)));return Promise.all(e)}return new Promise(((e,n)=>{mt$6.getArrayBuffer(t,((i,r)=>{i?n(i):e({url:t,data:r})}))}))}disposeRes(t){return Array.isArray(t)?t.forEach((t=>this._disposeOne(t))):this._disposeOne(t),this}isLoading(){return this._count&&this._count>0}getDefaultTexture(t){return Array.isArray(t)?this._getBlankTextures(t.length):this.defaultTexture}_disposeOne(t){const e=this.resources;e[t]&&(e[t].count--,e[t].count<=0&&delete e[t])}_loadImage(t){const e=this.resources;return e[t]?Promise.resolve({url:t,data:e[t].image}):new Promise(((n,i)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=function(){e[t]={image:r,count:1},n({url:t,data:r})},r.onerror=function(t){i(t)},r.onabort=function(){i(`image(${t}) loading aborted.`)},r.src=t}))}_loadImages(t){const e=t.map((t=>this._loadImage(t,!0)));return Promise.all(e)}_getBlankTextures(t){const e=new Array(t);for(let t=0;t<6;t++)e.push(this.defaultTexture);return e}});const pt$6=[],_t$6=[];let vt$5=0;class yt$6{constructor(t){this._id=vt$5++,this.sortedMeshes={},this.setMeshes(t),this._compareBinded=this._compare.bind(this),this.dirty()}setMeshes(t){if(this.clear(),!t||Array.isArray(t)&&!t.length||t===this.meshes)return this;t=Array.isArray(t)?t:[t],this.meshes=[];for(let e=0;e<t.length;e++){const n=t[e];n&&(n._scenes=n._scenes||{},n._scenes[this._id]=1,this.meshes.push(n))}return this.dirty(),this}addMesh(t){return!t||Array.isArray(t)&&!t.length||(Array.isArray(t)?t.forEach((t=>{t._scenes=t._scenes||{},t._scenes[this._id]||(t._scenes[this._id]=1,this.meshes.push(t),this.dirty())})):(t._scenes=t._scenes||{},t._scenes[this._id]||(t._scenes[this._id]=1,this.meshes.push(t),this.dirty()))),this}removeMesh(t){if(!t||Array.isArray(t)&&!t.length)return this;if(Array.isArray(t)){let e=!1;for(let n=0;n<t.length;n++)t[n]._scenes&&t[n]._scenes[this._id]&&(e=!0,this.dirty(),delete t[n]._scenes[this._id]);e&&(this.meshes=this.meshes.filter((e=>t.indexOf(e)<0)))}else{if(!t._scenes||!t._scenes[this._id])return this;const e=this.meshes.indexOf(t);e>=0&&this.meshes.splice(e,1),delete t._scenes[this._id],this.dirty()}return this}getMeshes(){return this.meshes}clear(){if(this.meshes)for(let t=0;t<this.meshes.length;t++)delete this.meshes[t]._scenes[this._id];return this.meshes=[],this.sortedMeshes.opaques=[],this.sortedMeshes.transparents=[],this}dirty(){return this._dirty=!0,this}sortMeshes(t){const e=this.meshes;this.sortFunction&&e.sort(this.sortFunction);let n=this.sortedMeshes.transparents;if(this._dirty){const t=this.sortedMeshes.opaques=[];n=this.sortedMeshes.transparents=[];for(let i=0,r=e.length;i<r;i++)e[i].transparent?n.push(e[i]):t.push(e[i])}t&&n.length>1&&(this._cameraPosition=t,n.sort(this._compareBinded),delete this._cameraPosition),this._dirty=!1}getSortedMeshes(){return this._dirty&&this.sortMeshes(),this.sortedMeshes}_compare(t,e){return transformMat4$2(pt$6,t.geometry.boundingBox.getCenter(),t.localTransform),transformMat4$2(_t$6,e.geometry.boundingBox.getCenter(),e.localTransform),dist$2(_t$6,this._cameraPosition)-dist$2(pt$6,this._cameraPosition)}}var xt$6=String.fromCharCode;function bt$6(t,e,n,i){if(t[3]>0){var r=Math.pow(2,t[3]-128-8+i);e[n+0]=t[0]*r,e[n+1]=t[1]*r,e[n+2]=t[2]*r}else e[n+0]=0,e[n+1]=0,e[n+2]=0;return e[n+3]=1,e}function wt$6(t,e,n){let i=t[e]/n,r=t[e+1]/n,o=t[e+2]/n,s=b$6(Math.max(Math.max(i,r),Math.max(o,1e-6)),0,1);s=Math.ceil(255*s)/255,t[e]=Math.min(255,i/s*255),t[e+1]=Math.min(255,r/s*255),t[e+2]=Math.min(255,o/s*255),t[e+3]=Math.min(255,255*s)}function Ct$5(t,e,n,i){for(var r,o,s=0,a=0,h=i;h>0;)if(t[a][0]=e[n++],t[a][1]=e[n++],t[a][2]=e[n++],t[a][3]=e[n++],1===t[a][0]&&1===t[a][1]&&1===t[a][2]){for(var l=t[a][3]<<s>>>0;l>0;l--)(o=t[a])[0]=(r=t[a-1])[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],a++,h--;s+=8}else a++,h--,s=0;return n}function Mt$5(t,e,n,i){if(i<8|i>32767)return Ct$5(t,e,n,i);var r=e[n++];if(2!==r)return Ct$5(t,e,n-1,i);if(t[0][1]=e[n++],t[0][2]=e[n++],r=e[n++],(t[0][2]<<8>>>0|r)>>>0!==i)return null;for(let r=0;r<4;r++)for(let a=0;a<i;){var o=e[n++];if(o>128){o=(127&o)>>>0;for(var s=e[n++];o--;)t[a++][r]=s}else for(;o--;)t[a++][r]=e[n++]}return n}function Tt$5(t,e=0,n=9){var i=new Uint8Array(t),r=i.length;if("#?"!==function(t,e,n){for(var i="",r=0;r<2;r++)i+=xt$6(t[r]);return i}(i))return null;for(var o=2;o<r&&("\n"!==xt$6(i[o])||"\n"!==xt$6(i[o+1]));o++);if(o>=r)return null;o+=2;for(var s="";o<r;o++){var a=xt$6(i[o]);if("\n"===a)break;s+=a}var h=s.split(" "),l=parseInt(h[1]),c=parseInt(h[3]);if(!c||!l)return null;for(var u=o+1,f=[],d=0;d<c;d++){f[d]=[];for(var m=0;m<4;m++)f[d][m]=0}var g=0,p=new Array(c*l*4),_=0;for(let t=0;t<l;t++){if(!(u=Mt$5(f,i,u,c)))return null;for(let t=0;t<c;t++)bt$6(f[t],p,_,e),g=Math.max(g,p[_],p[_+1],p[_+2],p[_+3]),_+=4}g=Math.min(g,n),_=0;for(let t=0;t<l;t++)for(let t=0;t<c;t++)wt$6(p,_,g),_+=4;return{width:c,height:l,pixels:p,rgbmRange:g}}const St$5=["points","lines","line strip","line loop","triangles","triangle strip","triangle fan"];function Pt$5(t){return St$5[t]}const At$5={5121:"uint8",5123:"uint16",5125:"uint32",5126:"float",36193:"half float"};function Et$5(t){return At$5[t]}const Ot$5={6406:"alpha",6407:"rgb",6408:"rgba",6409:"luminance",6410:"luminance alpha",33776:"rgb s3tc dxt1",33777:"rgba s3tc dxt1",33778:"rgba s3tc dxt3",33779:"rgba s3tc dxt5",35840:"rgb pvrtc 4bppv1",35841:"rgb pvrtc 2bppv1",35842:"rgba pvrtc 4bppv1",35843:"rgba pvrtc 2bppv1",35986:"rgb atc",35987:"rgba atc explicit alpha",34798:"rgba atc interpolated alpha",36196:"rgb etc1"};function Rt$5(t){return Ot$5[t]}const It$5={9729:"linear",9728:"nearest"};function kt$5(t){return It$5[t]}const Dt$5={9729:"linear",9728:"nearest",9984:"nearest mipmap nearest",9985:"linear mipmap nearest",9986:"nearest mipmap linear",9987:"linear mipmap linear"};function Lt$5(t){return Dt$5[t]}const zt$5={10497:"repeat",33071:"clamp",33648:"mirror"};function Ft$5(t){return zt$5[t]}const jt$5="__reshader_webgl_buffer",Ht$5="__reshader_webgl_tex";function Nt$5(t,e,n){let i;if(y$5(e)?e.buffer&&void 0!==e.byteOffset&&(i=e):e.array&&e.array.buffer&&void 0!==e.array.byteOffset&&(i=e.array),!i)return null;const r=i.buffer,o=i.byteOffset;r[jt$5]||(r[jt$5]={});let s=r[jt$5][o];if(!s){const e={};n&&g$3(e,n),e.data=i,s=t.buffer(e),r[jt$5][o]=s}return s}function Bt$5(t,e){const n=e.data;if(!n||!n.buffer)return t.texture(e);const i=n.buffer,r=n.byteOffset;i[Ht$5]||(i[Ht$5]={});let o=i[Ht$5][r];return o||(o=t.texture(e),i[Ht$5][r]=o),o}var Gt$5=Object.freeze({__proto__:null,getPrimitive:Pt$5,getMaterialType:Et$5,getMaterialFormat:Rt$5,getTextureMagFilter:kt$5,getTextureMinFilter:Lt$5,getTextureWrap:Ft$5,getUniqueREGLBuffer:Nt$5,getUniqueTexture:Bt$5});class Vt$5 extends F$7{onLoad({data:t}){const e=this.config;if(e){if(e.hdr){if(!(t=Tt$5(t.data,0,e.maxRange)))throw new Error("Invalid hdr data"+(e.url?":"+e.url:""));this.rgbmRange=t.rgbmRange,e.data=t.pixels}else e.data=t;e.width=e.width||t.width,e.height=e.height||t.height,this._updateREGL()}}createREGLTexture(t){if(y$5(this.config.data)||y$5(this.config.mipmap)){const e=Bt$5(t,this.config);return e._reshader_refCount||(e._reshader_refCount=0),e._reshader_refCount++,e}return t.texture(this.config)}}class Ut$5 extends Q$7{constructor(t){super({aPosition:new(x$6(t=t||0))([-1,-1,t,1,-1,t,-1,1,t,1,1,t]),aNormal:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1])},new Uint16Array([0,1,3,3,2,0]))}}const Zt$5={vsm_shadow_vert:"\nuniform mat4 shadow_lightProjViewModelMatrix;\nvarying vec4 shadow_vLightSpacePos;\nvoid shadow_computeShadowPars(vec4 position) {\n    shadow_vLightSpacePos = shadow_lightProjViewModelMatrix * position;\n}",vsm_shadow_frag:"\nuniform sampler2D shadow_shadowMap;\nuniform float shadow_opacity;\nuniform vec3 shadow_color;\n#if defined(USE_ESM)\n    uniform float esm_shadow_threshold;\n#endif\nvarying vec4 shadow_vLightSpacePos;\n#ifdef PACK_FLOAT\n    #include <common_pack_float>\n#endif\n#if defined(USE_ESM)\nfloat esm(vec3 projCoords, vec4 shadowTexel) {\n    float compare = projCoords.z;\n    float c = 120.0;\n    #ifdef PACK_FLOAT\n        float depth = common_decodeDepth(shadowTexel);\n        if (depth >= 1.0 - 1E-6 || compare <= depth) {\n            return 1.0;\n        }\n    #else\n        float depth = shadowTexel.r;\n    #endif\n    depth = exp(-c * min(compare - depth, 0.05));\n    return clamp(depth, esm_shadow_threshold, 1.0);\n}\n#endif\n#if defined(USE_VSM)\nfloat vsm_shadow_chebyshevUpperBound(vec3 projCoords, vec4 shadowTexel){\n    vec2 moments = shadowTexel.rg;\n    float distance = projCoords.z;\n    if (distance >= 1.0 || distance <= moments.x)\n        return 1.0 ;\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.00002);\n    float d = distance - moments.x;\n    float p_max = variance / (variance + d * d);\n    return p_max;\n}\n#endif\nfloat shadow_computeShadow_coeff(sampler2D shadowMap, vec3 projCoords) {\n    vec2 uv = projCoords.xy;\n    vec4 shadowTexel = texture2D(shadowMap, uv);\n    #if defined(USE_ESM)\n        float esm_coeff = esm(projCoords, shadowTexel);\n        float coeff = esm_coeff * esm_coeff;\n    #endif\n    #if defined(USE_VSM)\n        float vsm_coeff = vsm_shadow_chebyshevUpperBound(projCoords, shadowTexel);\n        float coeff = vsm_coeff;\n    #endif\n    return 1.0 - (1.0 - coeff) * shadow_opacity;\n}\nfloat shadow_computeShadow() {\n    vec3 projCoords = shadow_vLightSpacePos.xyz / shadow_vLightSpacePos.w;\n    projCoords = projCoords * 0.5 + 0.5;\n    if(projCoords.z >= 1.0 || projCoords.x < 0.0 || projCoords.x > 1.0 || projCoords.y < 0.0 || projCoords.y > 1.0) return 1.0;\n    return shadow_computeShadow_coeff(shadow_shadowMap, projCoords);\n}\nvec3 shadow_blend(vec3 color, float coeff) {\n    color = color * coeff + shadow_color * shadow_opacity * (1.0 - coeff);\n    return color;\n}",fbo_picking_vert:"\n#ifdef ENABLE_PICKING\n#if HAS_PICKING_ID == 1\nattribute float aPickingId;\n#elif HAS_PICKING_ID == 2\nuniform float uPickingId;\n#endif\nvarying float vPickingId;\nvarying float vFbo_picking_viewZ;\nvarying float vFbo_picking_visible;\n#endif\nvarying float vFbo_picking_fragDepth;\nvoid fbo_picking_setData(float viewPosZ, bool visible) {\n    #ifdef ENABLE_PICKING\n    #if HAS_PICKING_ID == 1\n       vPickingId = aPickingId;\n    #elif HAS_PICKING_ID == 2\n        vPickingId = uPickingId;\n    #endif\n        vFbo_picking_viewZ = viewPosZ;\n    #endif\n    vFbo_picking_visible = visible ? 1.0 : 0.0;\n    vFbo_picking_fragDepth = viewPosZ + 1.0;\n}",common_pack_float:"const float COMMON_FLOAT_MAX =  1.70141184e38;\nconst float COMMON_FLOAT_MIN = 1.17549435e-38;\nfloat common_packFloat(vec4 val){\n    vec4 scl = floor(255.0 * val + 0.5);\n    float sgn = (scl.a < 128.0) ? 1.0 : -1.0;\n    float exn = mod(scl.a * 2.0, 256.0) + floor(scl.b / 128.0) - 127.0;\n    float man = 1.0 +\n        (scl.r / 8388608.0) +\n        (scl.g / 32768.0) +\n        mod(scl.b, 128.0) / 128.0;\n    return sgn * man * pow(2.0, exn);\n}\nvec4 common_unpackFloat(highp float v) {\n    highp float av = abs(v);\n    if(av < COMMON_FLOAT_MIN) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > COMMON_FLOAT_MAX) {\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n    } else if(v < -COMMON_FLOAT_MAX) {\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n    }\n    highp vec4 c = vec4(0,0,0,0);\n    highp float e = floor(log2(av));\n    highp float m = av * pow(2.0, -e) - 1.0;\n    c[1] = floor(128.0 * m);\n    m -= c[1] / 128.0;\n    c[2] = floor(32768.0 * m);\n    m -= c[2] / 32768.0;\n    c[3] = floor(8388608.0 * m);\n    highp float ebias = e + 127.0;\n    c[0] = floor(ebias / 2.0);\n    ebias -= c[0] * 2.0;\n    c[1] += floor(ebias) * 128.0;\n    c[0] += 128.0 * step(0.0, -v);\n    return c / 255.0;\n}\nvec4 common_encodeDepth(const in float depth) {\n    float alpha = 1.0;\n    vec4 pack = vec4(0.0);\n    pack.a = alpha;\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n    pack.rgb = vec3(code * depth);\n    pack.gb = fract(pack.gb);\n    pack.rg -= pack.gb * (1.0 / 256.0);\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n    return pack;\n}\nfloat common_decodeDepth(const in vec4 pack) {\n    return pack.r + pack.g / 255.0;\n}",invert_matrix:"mat4 invert_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return inverse(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a00 = vector1.x, a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a10 = vector2.x, a11 = vector2.y, a12 = vector2.z, a13 = vector2.w;\n        float a20 = vector3.x, a21 = vector3.y, a22 = vector3.z, a23 = vector3.w;\n        float a30 = vector4.x, a31 = vector4.y, a32 = vector4.z, a33 = vector4.w;\n        float b00 = a00 * a11 - a01 * a10;\n        float b01 = a00 * a12 - a02 * a10;\n        float b02 = a00 * a13 - a03 * a10;\n        float b03 = a01 * a12 - a02 * a11;\n        float b04 = a01 * a13 - a03 * a11;\n        float b05 = a02 * a13 - a03 * a12;\n        float b06 = a20 * a31 - a21 * a30;\n        float b07 = a20 * a32 - a22 * a30;\n        float b08 = a20 * a33 - a23 * a30;\n        float b09 = a21 * a32 - a22 * a31;\n        float b10 = a21 * a33 - a23 * a31;\n        float b11 = a22 * a33 - a23 * a32;\n        float det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        det = 1.0 / det;\n        mat4 m = mat4(\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\n            (a20 * b03 - a21 * b01 + a22 * b00) * det\n        );\n        return m;\n    #endif\n}\nmat4 transpose_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return transpose(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a12 = vector2.z, a13 = vector2.w;\n        float a23 = vector3.w;\n        mat4 m = mat4(\n            vector1.x,\n            vector2.x,\n            vector3.x,\n            vector4.x,\n            a01,\n            vector2.y,\n            vector3.y,\n            vector4.y,\n            a02,\n            a12,\n            vector3.z,\n            vector4.z,\n            a03,\n            a13,\n            a23,\n            vector4.w\n        );\n        return m;\n    #endif\n}",get_output:"#include <invert_matrix>\n#include <draco_decode_vert>\n#ifdef HAS_INSTANCE\n    #include <instance_vert>\n    #ifdef HAS_INSTANCE_COLOR\n        varying vec4 vInstanceColor;\n    #endif\n#endif\n#ifdef HAS_SKIN\n    uniform int skinAnimation;\n    #include <skin_vert>\n#endif\n#include <mask_vert>\n#ifdef HAS_MORPH\n    attribute vec3 POSITION0;\n    attribute vec3 POSITION1;\n    attribute vec3 POSITION2;\n    attribute vec3 POSITION3;\n    attribute vec3 POSITION4;\n    attribute vec3 POSITION5;\n    attribute vec3 POSITION6;\n    attribute vec3 POSITION7;\n    #ifdef HAS_MORPHNORMALS\n        attribute vec3 NORMAL0;\n        attribute vec3 NORMAL1;\n        attribute vec3 NORMAL2;\n        attribute vec3 NORMAL3;\n    #endif\n    uniform vec4 morphWeights1;\n    uniform vec4 morphWeights2;\n#endif\nmat4 getPositionMatrix() {\n    mat4 worldMatrix;\n    #ifdef HAS_INSTANCE\n        #ifdef HAS_INSTANCE_COLOR\n            vInstanceColor = instance_getInstanceColor();\n        #endif\n        mat4 attributeMatrix = instance_getAttributeMatrix();\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = attributeMatrix * positionMatrix * skin_getSkinMatrix();\n            } else {\n                worldMatrix = attributeMatrix * positionMatrix;\n            }\n        #else\n            worldMatrix = attributeMatrix * positionMatrix;\n        #endif\n    #else\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = skin_getSkinMatrix() * positionMatrix;\n            } else {\n                worldMatrix = positionMatrix;\n            }\n        #else\n            worldMatrix = positionMatrix;\n        #endif\n    #endif\n    return worldMatrix;\n}\nvec4 getPosition(vec3 aPosition) {\n    vec3 position = getPositionAsDraco(aPosition);\n    #ifdef HAS_MORPH\n        vec4 POSITION = vec4(position + morphWeights1[0] * POSITION0 + morphWeights1[1] * POSITION1 + morphWeights1[2] * POSITION2 + morphWeights1[3] * POSITION3\n        + morphWeights2[0] * POSITION4 + morphWeights2[1] * POSITION5 + morphWeights2[2] * POSITION6 + morphWeights2[3] * POSITION7\n        , 1.0);\n    #else\n        vec4 POSITION = vec4(position, 1.0);\n    #endif\n    return POSITION;\n}\nvec3 appendMorphNormal(vec3 NORMAL) {\n    #ifdef HAS_MORPHNORMALS\n        vec3 normal = NORMAL + morphWeights1[0] * NORMAL0 + morphWeights1[1] * NORMAL1 + morphWeights1[2] * NORMAL2 + morphWeights1[3] * NORMAL3;\n    #else\n        vec3 normal = NORMAL;\n    #endif\n    return normal;\n}",instance_vert:"attribute vec4 instance_vectorA;\nattribute vec4 instance_vectorB;\nattribute vec4 instance_vectorC;\nmat4 instance_getAttributeMatrix() {\n    mat4 mat =  mat4(\n        instance_vectorA.x, instance_vectorB.x, instance_vectorC.x, 0.0,\n        instance_vectorA.y, instance_vectorB.y, instance_vectorC.y, 0.0,\n        instance_vectorA.z, instance_vectorB.z, instance_vectorC.z, 0.0,\n        instance_vectorA.w, instance_vectorB.w, instance_vectorC.w, 1.0\n    );\n    return mat;\n}\n#ifdef HAS_INSTANCE_COLOR\n    attribute vec4 instance_color;\n    vec4 instance_getInstanceColor() {\n        return instance_color;\n    }\n#endif",skin_vert:"attribute vec4 WEIGHTS_0;\nattribute vec4 JOINTS_0;\nuniform sampler2D jointTexture;\nuniform vec2 jointTextureSize;\nuniform float numJoints;\n#define ROW0_U ((0.5 + 0.0) / 4.)\n#define ROW1_U ((0.5 + 1.0) / 4.)\n#define ROW2_U ((0.5 + 2.0) / 4.)\n#define ROW3_U ((0.5 + 3.0) / 4.)\nmat4 skin_getBoneMatrix(float jointNdx) {\n    float v = (jointNdx + 0.5) / numJoints;\n    return mat4(\n        texture2D(jointTexture, vec2(ROW0_U, v)),\n        texture2D(jointTexture, vec2(ROW1_U, v)),\n        texture2D(jointTexture, vec2(ROW2_U, v)),\n        texture2D(jointTexture, vec2(ROW3_U, v)));\n}\nmat4 skin_getSkinMatrix() {\n        mat4 skinMatrix = skin_getBoneMatrix(JOINTS_0[0]) * WEIGHTS_0[0] +\n                        skin_getBoneMatrix(JOINTS_0[1]) * WEIGHTS_0[1] +\n                        skin_getBoneMatrix(JOINTS_0[2]) * WEIGHTS_0[2] +\n                        skin_getBoneMatrix(JOINTS_0[3]) * WEIGHTS_0[3];\n        return skinMatrix;\n}",heatmap_render_vert:"#ifdef HAS_HEATMAP\nvarying vec2 heatmap_vTexCoord;\nvoid heatmap_compute(mat4 matrix, vec3 position) {\n    vec4 pos = matrix * vec4(position.xy, 0., 1.);\n    heatmap_vTexCoord = (1. + pos.xy / pos.w) / 2.;\n}\n#endif",heatmap_render_frag:"#ifdef HAS_HEATMAP\nuniform sampler2D heatmap_inputTexture;\nuniform sampler2D heatmap_colorRamp;\nuniform float heatmap_heatmapOpacity;\nvarying vec2 heatmap_vTexCoord;\nvec4 heatmap_getColor(vec4 color) {\n    float t = texture2D(heatmap_inputTexture, heatmap_vTexCoord).r;\n    vec4 heatmapColor = texture2D(heatmap_colorRamp, vec2(t, 0.5)) * heatmap_heatmapOpacity;\n    return color * (1.0 - heatmapColor.a) + heatmapColor * heatmapColor.a;\n}\n#endif",line_extrusion_vert:"#ifdef IS_LINE_EXTRUSION\n    #define ALTITUDE_SCALE 32767.0;\n    #define EXTRUDE_SCALE 63.0;\n    attribute vec2 aExtrude;\n    #ifdef HAS_LINE_WIDTH\n        attribute float aLineWidth;\n    #else\n        uniform float lineWidth;\n    #endif\n    #ifdef HAS_LINE_HEIGHT\n        attribute float aLineHeight;\n    #else\n        uniform float lineHeight;\n    #endif\n    uniform float linePixelScale;\n    vec3 getLineExtrudePosition(vec3 position) {\n        #ifdef HAS_LINE_WIDTH\n            float lineWidth = aLineWidth / 2.0;\n        #endif\n        #ifdef HAS_LINE_HEIGHT\n            float lineHeight = aLineHeight / 10.0;\n        #endif\n        float halfwidth = lineWidth / 2.0;\n        float outset = halfwidth;\n        vec2 dist = outset * aExtrude / EXTRUDE_SCALE;\n        position.z *= lineHeight / ALTITUDE_SCALE;\n        return position + vec3(dist, 0.0) * linePixelScale;\n    }\n#endif",gl2_vert:"#if __VERSION__ == 300\n    #define texture2D texture\n    #define varying out\n    #define attribute in\n#endif",gl2_frag:"#if __VERSION__ == 300\n    #define varying in\n    #define gl_FragDepthEXT gl_FragDepth\n    #define texture2D texture\n    #define textureCube texture\n    #define texture2DProj textureProj\n    #define texture2DLodEXT textureLod\n    #define texture2DProjLodEXT textureProjLod\n    #define textureCubeLodEXT textureLod\n    #define texture2DGradEXT textureGrad\n    #define texture2DProjGradEXT textureProjGrad\n    #define textureCubeGradEXT textureGrad\n    #define texture2D texture\n    out vec4 glFragColor;\n#else\n    vec4 glFragColor;\n#endif",hsv_frag:"\nconst mediump vec4 HSV_K0 = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nconst mediump vec4 HSV_K1 = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nconst mediump float HSV_E = 1.0e-10;\nvec3 hsv_rgb2hsv(vec3 c) {\n    vec4 K = HSV_K0;\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n    float d = q.x - min(q.w, q.y);\n    float e = HSV_E;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv_hsv2rgb(vec3 c) {\n    vec4 K = HSV_K1;\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 hsv_apply(vec4 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return vec4(hsv_hsv2rgb(hsv), c.a);\n}\nvec3 hsv_apply(vec3 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return hsv_hsv2rgb(hsv);\n}\nmat4 contrastMatrix(float contrast)\n{\n    float t = (1.0 - contrast) / 2.0;\n    return mat4(\n        contrast, 0., 0., 0.,\n        0., contrast, 0., 0.,\n        0., 0., contrast, 0.,\n        t, t, t, 1\n    );\n}",snow_frag:"#ifdef HAS_SNOW\n    float lerp(float a, float b, float w) {\n        return a + w * (b - a);\n    }\n    vec3 snow(vec4 sceneColor, vec3 normalColor, float height) {\n        float snowIntense = normalColor.b;\n        vec3 fixedC = vec3(1.0, 1.0, 1.0);\n        if (height < 1.0) {\n            float r = lerp(0.5, fixedC.x, snowIntense);\n            float g = lerp(0.5, fixedC.y, snowIntense);\n            float b = lerp(0.5, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        } else {\n            float r = lerp(sceneColor.r, fixedC.x, snowIntense);\n            float g = lerp(sceneColor.g, fixedC.y, snowIntense);\n            float b = lerp(sceneColor.b, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        }\n    }\n#endif",draco_decode_vert:"#if defined(HAS_TANGENT)\n    attribute vec4 aTangent;\n#elif defined(HAS_NORMAL)\n    #ifdef HAS_DECODE_NORMAL\n        attribute vec2 aNormal;\n        uniform float gltf_u_dec_normal_rangeConstant;\n    #else\n        attribute vec3 aNormal;\n    #endif\n#endif\n#ifdef HAS_DECODE_POSITION\n    uniform float gltf_u_dec_position_normConstant;\n    uniform vec3 minValues_pos;\n    vec3 decodeDracoPosition(vec3 aPosition) {\n        return minValues_pos + aPosition * gltf_u_dec_position_normConstant;\n    }\n#endif\n#ifdef HAS_DECODE_TEXCOORD\n    uniform vec2 minValues_tex;\n    uniform float gltf_u_dec_texcoord_0_normConstant;\n    vec2 decodeDracoTexcoord(vec2 aTexCoord) {\n        return minValues_tex + aTexCoord * gltf_u_dec_texcoord_0_normConstant;\n    }\n#endif\n#ifdef HAS_DECODE_NORMAL\n    float czm_signNotZero(float value) {\n        return value >= 0.0 ? 1.0 : -1.0;\n    }\n    vec2 czm_signNotZero(vec2 value) {\n        return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n    }\n    vec3 decodeDracoNormal(vec2 encoded, float range)\n    {\n        if (encoded.x == 0.0 && encoded.y == 0.0) {\n            return vec3(0.0, 0.0, 0.0);\n        }\n        encoded = encoded / range * 2.0 - 1.0;\n        vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n        if (v.z < 0.0) {\n            v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n        }\n        return normalize(v);\n    }\n    vec3 getNormal(vec2 aNormal) {\n        return decodeDracoNormal(aNormal, gltf_u_dec_normal_rangeConstant).zxy;\n    }\n#endif\nvec3 getPositionAsDraco(vec3 aPosition) {\n    #ifdef HAS_DECODE_POSITION\n        return decodeDracoPosition(aPosition);\n    #else\n        return aPosition;\n    #endif\n}\nvec2 getTexcoord(vec2 aTexCoord) {\n    #ifdef HAS_DECODE_TEXCOORD\n        return decodeDracoTexcoord(aTexCoord);\n    #else\n        return aTexCoord;\n    #endif\n}",highlight_vert:"#if defined(HAS_HIGHLIGHT_COLOR)\n    attribute vec4 aHighlightColor;\n    varying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    attribute float aHighlightOpacity;\n    varying float vHighlightOpacity;\n#endif\nvoid highlight_setVarying() {\n    #if defined(HAS_HIGHLIGHT_COLOR)\n        vHighlightColor = aHighlightColor / 255.0;\n    #endif\n    #if defined(HAS_HIGHLIGHT_OPACITY)\n        vHighlightOpacity = aHighlightOpacity / 255.0;\n    #endif\n}",highlight_frag:"#if defined(HAS_HIGHLIGHT_COLOR)\n\tvarying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    varying float vHighlightOpacity;\n#endif\nvec4 highlight_blendColor(vec4 color) {\n\tvec4 outColor;\n\t#if defined(HAS_HIGHLIGHT_COLOR)\n\t\tcolor.rgb = color.rgb * (1.0 - vHighlightColor.a) + vHighlightColor.rgb * vHighlightColor.a;\n\t\t#ifndef HAS_HIGHLIGHT_COLOR_POINT\n        \tcolor.a = color.a * (1.0 - vHighlightColor.a) + vHighlightColor.a;\n        #endif\n        outColor = color;\n\t#else\n\t\toutColor = color;\n\t#endif\n\t#if defined(HAS_HIGHLIGHT_OPACITY)\n\t\toutColor *= vHighlightOpacity;\n\t#endif\n\treturn outColor;\n}",mask_vert:"#ifdef HAS_MASK_EXTENT\n    uniform vec4 mask_extent;\n    uniform sampler2D mask_colorExtent;\n    uniform sampler2D mask_modeExtent;\n    uniform float mask_maskMode;\n    uniform float mask_hasFlatOut;\n    uniform mat4 viewMatrix;\n    uniform float mask_heightRatio;\n    uniform float mask_heightOffset;\n    varying vec4 vWorldPosition;\n    varying vec2 vUVInExtent;\n    varying float vHeightRatio;\n    varying float vHeightOffset;\n    float random (vec2 st) {\n        return fract(sin(dot(st.xy,vec2(12.9898,78.233)))*43758.5453123) * 0.1;\n    }\n    bool isInExtent(vec4 color) {\n        if (color.r > 0.0 || color.g > 0.0 || color.b > 0.0 || color.a > 0.0) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n    vec4 getMaskPosition(vec4 position, mat4 modelMatrix) {\n        vWorldPosition = modelMatrix * position;\n        float w = mask_extent.z - mask_extent.x;\n        float h = mask_extent.y - mask_extent.w;\n        vec2 uvInExtent = vec2((vWorldPosition.x - mask_extent.x) / w, 1.0 - (vWorldPosition.y - mask_extent.w) / h);\n        vec4 extentColor = texture2D(mask_colorExtent, uvInExtent);\n        vec3 maskOptionColor = texture2D(mask_modeExtent, uvInExtent).rgb;\n        float maskMode = maskOptionColor.r;\n        float flatHeight = maskOptionColor.g / mask_heightRatio + mask_heightOffset;\n        float height = flatHeight + random(uvInExtent);\n        vec4 wPosition = vec4(vWorldPosition.x, vWorldPosition.y, height, vWorldPosition.w);\n        vUVInExtent = uvInExtent;\n        vHeightRatio = mask_heightRatio;\n        vHeightOffset = mask_heightOffset;\n        if (maskMode <= 0.4 && maskMode > 0.3) {\n            return viewMatrix * modelMatrix * position;\n        } else if (mask_hasFlatOut == 1.0) {\n            return viewMatrix * wPosition;\n        }\n        if (isInExtent(extentColor) == true && maskMode <= 0.3 && maskMode > 0.2) {\n            return viewMatrix * wPosition;\n        } else {\n            return viewMatrix * modelMatrix * position;\n        }\n    }\n#endif",mask_frag:"#ifdef HAS_MASK_EXTENT\n    uniform sampler2D mask_colorExtent;\n    uniform sampler2D mask_modeExtent;\n    uniform float mask_hasClipOut;\n    varying float vHeightRatio;\n    varying float vHeightOffset;\n    varying vec2 vUVInExtent;\n    varying vec4 vWorldPosition;\n    bool isInExtent(vec4 color) {\n        if (color.r > 0.0 || color.g > 0.0 || color.b > 0.0) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n    \n    vec4 setMask(vec4 glFragColor) {\n        vec4 extentColor = texture2D(mask_colorExtent, vUVInExtent);\n        vec4 modeColor = texture2D(mask_modeExtent, vUVInExtent);\n        float maskMode = modeColor.r;\n        float minHeight = modeColor.b / vHeightRatio + vHeightOffset;\n        float maxHeight = modeColor.a / vHeightRatio + vHeightOffset;\n        if (maskMode > 0.1 && maskMode <= 0.2) {\n            return glFragColor;\n        } else if (mask_hasClipOut == 1.0) {\n            discard;\n        }\n        if (isInExtent(extentColor) == true && maskMode > 0.0 && maskMode <= 0.1) {\n            discard;\n        } else if (isInExtent(extentColor) == true && maskMode <= 0.5 && maskMode > 0.4) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\n            }\n        }\n        return glFragColor;\n    }\n#endif",computeTexcoord_frag:"#ifdef HAS_KHR_TEXTURE_TRANSFORM\n    uniform vec2 khr_offset;\n    uniform float khr_rotation;\n    uniform vec2 khr_scale;\n    vec2 khr_tex_transformTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) {\n        rotation = -rotation;\n        mat3 transform = mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, offset.x, offset.y, 1.0);\n        vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy;\n        return transformedTexCoords;\n    }\n#endif\nvarying highp vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\n    varying vec4 vUvRegion;\n#endif\nvec2 computeTexCoord() {\n    #ifdef HAS_I3S_UVREGION\n        vec2 atlasScale = vUvRegion.zw - vUvRegion.xy;\n        vec2 uvAtlas = fract(vTexCoord) * atlasScale + vUvRegion.xy;\n        return uvAtlas;\n    #elif defined(HAS_KHR_TEXTURE_TRANSFORM)\n        return khr_tex_transformTexCoord(vTexCoord, khr_offset, khr_rotation, khr_scale);\n    #else\n        return vTexCoord;;\n    #endif\n}"};var Xt$5={register(t,e){if(Zt$5[t])throw new Error(`Key of ${t} is already registered in ShaderLib.`);Zt$5[t]=e},compile:t=>qt$5(t)};const Jt$5=/^[ \t]*#include +<([\w\d.]+)>/gm;function qt$5(t){return t.replace(Jt$5,Yt$5)}function Yt$5(t,e){const n=Zt$5[e];if(!n)throw new Error("Can not resolve #include <"+e+">");return qt$5(n)}let $t$5=0;const te$5={};class ee$5{constructor({vert:t,frag:e,uniforms:n,defines:i,extraCommandProps:r}){this.vert=t,this.frag=e;const o=$t$5++;Object.defineProperty(this,"uid",{enumerable:!0,configurable:!1,get:()=>o}),this.shaderDefines=i&&g$3({},i)||{},n=this.uniforms=(n||[]).slice(),this.contextDesc={};for(let t=0,e=n.length;t<e;t++){const e=n[t];if(c(e))if(e.indexOf("[")>0){const{name:t,len:n}=ne$5(e);this.contextDesc[t]={name:t,type:"array",length:n}}else this.contextDesc[e]=null;else if(e.name.indexOf("[")>0){const{name:t,len:n}=ne$5(e.name);this.contextDesc[t]={name:t,type:"array",length:n,fn:e.fn}}else this.contextDesc[e.name]=e}this.extraCommandProps=r&&g$3({},r)||{},this.commands={},this._compileSource()}set shaderDefines(t){this._shaderDefines=t,this.dkey=Object.keys(this._shaderDefines).join()}get shaderDefines(){return this._shaderDefines||{}}setDefines(t){this.shaderDefines=t}setFramebuffer(t){return this.context.framebuffer=t,this}appendDescUniforms(t,e){const n=e,i=this.contextDesc;for(const r in i)if(i[r])if("array"===i[r].type){const o=r,s=i[r].length;let a=e[r];if(i[r].fn&&(a=i[r].fn(null,e)),!a)continue;if(a.length!==s)throw new Error(`${o} uniform's length is not ${s}`);n[o]=n[o]||{};for(let e=0;e<s;e++)n[o][""+e]=a[e].getREGLTexture?a[e].getREGLTexture(t):a[e]}else"function"===i[r].type&&(Object.getOwnPropertyDescriptor(n,r)||Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:function(){return i[r].fn(null,e)}}));return n}setUniforms(t){if(t.modelMatrix||t.positionMatrix)throw new Error("modelMatrix or positionMatrix is reserved uniform name for Mesh, please change to another name");return this.contextKeys=t?Object.keys(t).join():null,this.context=t,this}getVersion(t,e){return"#version"===e.substring(0,8)?"":0===t.limits.version.indexOf("WebGL 2.0")&&300===this.version?"#version 300 es\n":"#version 100\n"}getActiveVars(t,e,n,i){const r=i;if(te$5[r])return te$5[r];const o=t._gl,s=o.createProgram(),a=o.createShader(35633);o.shaderSource(a,e),o.compileShader(a);const h=o.createShader(35632);o.shaderSource(h,n),o.compileShader(h),o.attachShader(s,h),o.attachShader(s,a),o.linkProgram(s);const l=o.getProgramParameter(s,35721),c=[];for(let t=0;t<l;++t){const e=o.getActiveAttrib(s,t);e&&c.push({name:e.name,type:e.type})}const u=o.getProgramParameter(s,35718),f=[];for(let t=0;t<u;++t){const e=o.getActiveUniform(s,t);let n=e.name;e.name.indexOf("[")>0&&(n=n.replace("[0]","")),f.push(n)}return o.deleteProgram(s),o.deleteShader(a),o.deleteShader(h),te$5[r]={activeUniforms:f,activeAttributes:c},te$5[r]}createREGLCommand(t,e,n,i,r){const o=w$7(t)&&!r,s=g$3({},this.shaderDefines||{},e||{}),a=this._insertDefines(this.vert,s),h=this.getVersion(t,a)+a,l=this._insertDefines(this.frag,s),c=this.getVersion(t,l)+l,u=O$7(h)+"_"+O$7(c),{activeAttributes:f,activeUniforms:d}=this.getActiveVars(t,h,c,u),m={};f.forEach(((e,n)=>{const i=e.name;m[i]=o?n:t.prop(i)}));const p={};d.forEach((e=>{p[e]=t.prop(e)}));const v=this.contextDesc;for(const e in v)if(v[e]&&"function"===v[e].type)p[e]=v[e].fn;else if(v[e]&&"array"===v[e].type){const n=v[e].name,i=v[e].length;for(let e=0;e<i;e++){const i=`${n}[${e}]`;p[i]=t.prop(i)}}else p[e]=t.prop(e);const y={vert:h,frag:c,uniforms:p,attributes:m};o&&(y.vao=t.prop("vao")),o&&!i||!n||_$6(n)||(y.elements=t.prop("elements")),y.count=t.prop("count"),y.offset=t.prop("offset"),y.primitive=t.prop("primitive"),y.framebuffer=t.prop("framebuffer"),i&&(y.instances=t.prop("instances")),g$3(y,this.extraCommandProps);const x=t(y);return f.key=f.map((t=>t.name)).join(),x.activeAttributes=f,x}dispose(){for(const t in this.commands){const e=this.commands[t];e&&e.destroy&&!e[L$8]&&(e[L$8]=!0,e.destroy())}this.commands={},delete this.vert,delete this.frag}_insertDefines(t,e){const n=[];for(const t in e)C$6(e,t)&&!d$3(e[t])&&n.push(`#define ${t} ${e[t]}\n`);return n.join("")+t}_compileSource(){this.vert=Xt$5.compile(this.vert),this.frag=Xt$5.compile(this.frag)}}function ne$5(t){const e=t.indexOf("["),n=t.indexOf("]");return{name:t.substring(0,e),len:+t.substring(e+1,n)}}class ie$5 extends ee$5{draw(t,e){if(!e||!e.length)return 0;const n=[];let i,r=0;for(let o=0,s=e.length;o<s;o++){if(!e[o].isValid()){o===s-1&&i&&n.length&&i(n);continue}if(!e[o].geometry.getDrawCount()||!this._runFilter(e[o])){o===s-1&&i&&n.length&&i(n);continue}const a=this.getMeshCommand(t,e[o]);n.length&&i!==a&&(i(n),n.length=0);const h=e[o].getREGLProps(t,a.activeAttributes);this._ensureContextDefines(h),h.shaderContext=this.context,this.appendDescUniforms(t,h),n.push(h),r++,o<s-1?i=a:o===s-1&&a(n)}return r}_ensureContextDefines(t){if(this.context&&(t.contextKeys||(t.contextKeys={}),t.contextKeys[this.uid]!==this.contextKeys)){for(const e in this.context)Object.getOwnPropertyDescriptor(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:function(){return this.shaderContext&&this.shaderContext[e]}});t.contextKeys[this.uid]=this.contextKeys}}_runFilter(t){const e=this.filter;if(!e)return!0;if(Array.isArray(e)){for(let n=0;n<e.length;n++)if(!e[n](t))return!1;return!0}return e(t)}getMeshCommand(t,e){this._cmdKeys||(this._cmdKeys={});const n=this.dkey||"default";let i=this._cmdKeys[n];i||(i=this._cmdKeys[n]={});const r=e.getCommandKey(t);i[r]||(i[r]=n+"_"+e.getCommandKey(t));const o=i[r];let s=this.commands[o];if(!s){const n=e.getDefines(),i=e.getMaterial();i&&i.doubleSided&&this.extraCommandProps&&this.extraCommandProps.cull&&(this.extraCommandProps.cull.enable=!1),s=this.commands[o]=this.createREGLCommand(t,n,e.getElements(),e instanceof dt$6,e.disableVAO)}return s}}var oe$5="precision mediump float;\n#include <gl2_frag>\nuniform vec4 baseColorFactor;\nuniform float materialShininess;\nuniform float environmentExposure;\nuniform float specularStrength;\nuniform vec3 light0_viewDirection;\nuniform vec3 ambientColor;\nuniform vec4 light0_diffuse;\nuniform vec3 lightSpecular;\nuniform vec3 cameraPosition;\n#ifdef HAS_TOON\nuniform float toons;\nuniform float specularToons;\n#endif\n#ifdef HAS_TANGENT\nvarying vec4 vTangent;\n#endif\n#ifdef HAS_MAP\n#include <computeTexcoord_frag>\n#endif\nvarying vec3 vNormal;\nvarying vec3 vFragPos;\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef HAS_BASECOLOR_MAP\nuniform sampler2D baseColorTexture;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nuniform vec2 extrusionOpacityRange;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_OCCLUSION_MAP\nuniform sampler2D occlusionTexture;\n#endif\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D normalTexture;\n#endif\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D emissiveTexture;\n#endif\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D diffuseTexture;\n#endif\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\n#include <heatmap_render_frag>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#include <mask_frag>\nvec3 c() {\n  \n#if defined(HAS_NORMAL_MAP)\nvec3 d = normalize(vNormal);\n  vec3 e = texture2D(normalTexture, computeTexCoord()).xyz * 2. - 1.;\n#if defined(HAS_TANGENT)\nvec3 t = normalize(vTangent.xyz);\n  vec3 b = normalize(cross(d, t) * sign(vTangent.w));\n  mat3 f = mat3(t, b, d);\n  return normalize(f * e);\n#else\nreturn normalize(e);\n#endif\n#else\nreturn normalize(vNormal);\n#endif\n}\nvec4 h(const in vec4 i) {\n  return vec4(i.r < .0031308 ? i.r * 12.92 : 1.055 * pow(i.r, 1. / 2.4) - .055, i.g < .0031308 ? i.g * 12.92 : 1.055 * pow(i.g, 1. / 2.4) - .055, i.b < .0031308 ? i.b * 12.92 : 1.055 * pow(i.b, 1. / 2.4) - .055, i.a);\n}\nvec4 j() {\n  \n#if defined(HAS_BASECOLOR_MAP)\nreturn texture2D(baseColorTexture, computeTexCoord());\n#elif defined(HAS_DIFFUSE_MAP)\nreturn texture2D(diffuseTexture, computeTexCoord());\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn diffuseFactor;\n#else\nreturn baseColorFactor;\n#endif\n}\nvec3 k() {\n  \n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nreturn texture2D(specularGlossinessTexture, computeTexCoord()).rgb;\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn specularFactor;\n#else\nreturn vec3(1.);\n#endif\n}\nvoid main() {\n  vec4 l = j();\n  vec3 m = environmentExposure * ambientColor * l.rgb;\n#ifdef HAS_INSTANCE_COLOR\nm *= vInstanceColor.rgb;\n#endif\nvec3 o = c();\n  vec3 u = normalize(-light0_viewDirection);\n  float v = max(dot(o, u), .0);\n#ifdef HAS_TOON\nfloat A = floor(v * toons);\n  v = A / toons;\n#endif\nvec3 B = light0_diffuse.rgb * v * l.rgb;\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvec3 i = vColor.rgb;\n#elif defined(IS_LINE_EXTRUSION)\nvec3 i = lineColor.rgb;\n#else\nvec3 i = polygonFill.rgb;\n#endif\n#ifdef HAS_INSTANCE_COLOR\ni *= vInstanceColor.rgb;\n#endif\nm *= i.rgb;\n  B *= i.rgb;\n  vec3 C = normalize(cameraPosition - vFragPos);\n  vec3 D = normalize(u + C);\n  float E = pow(max(dot(o, D), .0), materialShininess);\n#ifdef HAS_TOON\nfloat F = floor(E * specularToons);\n  E = F / specularToons;\n#endif\nvec3 G = specularStrength * lightSpecular * E * k();\n#ifdef HAS_OCCLUSION_MAP\nfloat H = texture2D(occlusionTexture, computeTexCoord()).r;\n  m *= H;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat I = shadow_computeShadow();\n  B = shadow_blend(B, I).rgb;\n  G = shadow_blend(G, I).rgb;\n#endif\nvec3 J = m + B + G;\n#ifdef HAS_EMISSIVE_MAP\nvec3 K = texture2D(emissiveTexture, computeTexCoord()).rgb;\n  J += K;\n#endif\n#ifdef IS_LINE_EXTRUSION\nglFragColor = vec4(J, lineOpacity);\n#else\nglFragColor = vec4(J, polygonOpacity);\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nfloat L = vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nfloat L = lineColor.a;\n#else\nfloat L = polygonFill.a;\n#endif\nglFragColor *= L;\n#ifdef HAS_EXTRUSION_OPACITY\nfloat M = extrusionOpacityRange.x;\n  float N = extrusionOpacityRange.y;\n  float O = M + vExtrusionOpacity * (N - M);\n  O = clamp(O, .0, 1.);\n  glFragColor *= O;\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",se$5="#include <gl2_vert>\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\n#ifdef HAS_MAP\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\n#else\nattribute vec4 aColor0;\n#endif\nvarying vec4 vColor;\n#endif\nvarying vec3 vFragPos;\nvarying vec3 vNormal;\nuniform mat4 projMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\nuniform mat4 projViewMatrix;\n#include <highlight_vert>\n#include <get_output>\n#include <heatmap_render_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nattribute float aExtrusionOpacity;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_TANGENT)\nvarying vec4 vTangent;\n#endif\nvoid c(const highp vec4 q, out highp vec3 d) {\n  d = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid c(const highp vec4 q, out highp vec3 d, out highp vec3 t) {\n  c(q, d);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nvoid main() {\n  \n#ifdef IS_LINE_EXTRUSION\nvec4 e = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 e = getPosition(aPosition);\n#endif\nmat4 f = getPositionMatrix();\n  vFragPos = vec3(modelMatrix * f * e);\n#if defined(HAS_NORMAL) || defined(HAS_TANGENT)\nmat3 h = modelNormalMatrix * mat3(f);\n  vec3 i;\n#if defined(HAS_TANGENT)\nvec3 t;\n  c(aTangent, i, t);\n  vTangent = vec4(h * t, aTangent.w);\n#else\n#ifdef HAS_DECODE_NORMAL\ni = getNormal(aNormal);\n#else\ni = aNormal;\n#endif\n#endif\nvec3 j = appendMorphNormal(i);\n  vNormal = normalize(h * j);\n#else\nvNormal = vec3(.0);\n#endif\nmat4 k = projMatrix;\n  k[2].xy += halton.xy / outSize.xy;\n#ifdef HAS_MASK_EXTENT\ngl_Position = k * getMaskPosition(f * e, modelMatrix);\n#else\ngl_Position = k * modelViewMatrix * f * e;\n#endif\n#ifdef HAS_MAP\nvec2 l = getTexcoord(aTexCoord);\n  vTexCoord = l * uvScale + uvOffset;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nvExtrusionOpacity = aExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvColor = vec4(aColor0 / 255., 1.);\n#else\nvColor = aColor0 / 255.;\n#endif\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(f * e);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * f, e);\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\nhighlight_setVarying();\n}";class ae$5 extends ie$5{constructor(t={}){const n=[],i=[],o=t.uniforms,s=[{name:"modelNormalMatrix",type:"function",fn:function(t,e){return fromMat4$1(n,e.modelMatrix)}},{name:"modelViewMatrix",type:"function",fn:function(t,n){return multiply$5(i,n.viewMatrix,n.modelMatrix)}}];o&&s.push(...o),super({vert:t.vert||se$5,frag:t.frag||oe$5,uniforms:s,defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}}),this.version=300}getGeometryDefines(t){const e={};return t.data[t.desc.tangentAttribute]?e.HAS_TANGENT=1:t.data[t.desc.normalAttribute]&&(e.HAS_NORMAL=1),e}}var ce$5="#if __VERSION__ == 300\n#define attribute in\n#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}";const ue$5=new Int8Array([-1,1,-1,-1,1,1,1,1,-1,-1,1,-1]),fe$5=new Uint8Array([0,1,0,0,1,1,1,1,0,0,1,0]);class de$5 extends ie$5{constructor(t){t.vert=t.vert||ce$5,t.extraCommandProps=t.extraCommandProps||{},t.extraCommandProps.depth||(t.extraCommandProps.depth={enable:!1,mask:!1}),t.extraCommandProps.stencil||(t.extraCommandProps.stencil={enable:!1}),super(t)}draw(t){return this._quadMesh||this._createQuadMesh(t),super.draw(t,this._quadMesh)}getMeshCommand(t){const e=this.dkey||"";return this.commands[e+"_quad"]||(this.commands[e+"_quad"]=this.createREGLCommand(t,null,this._quadMesh[0].getElements())),this.commands[e+"_quad"]}_createQuadMesh(t){const e=new Q$7({aPosition:ue$5,aTexCoord:fe$5},null,ue$5.length/2,{positionSize:2,primitive:"triangles"});e.generateBuffers(t),this._quadMesh=[new ft$6(e)]}dispose(){if(this._quadMesh){const t=this._quadMesh[0];t.geometry.dispose(),t.dispose()}return delete this._quadMesh,super.dispose()}}class me$4 extends de$5{constructor(){super({vert:ce$5,frag:"#define SHADER_NAME FXAA\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision mediump float;\nvarying vec2 vTexCoord;\nuniform float enableFXAA;\nuniform float enableToneMapping;\nuniform float enableSharpen;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\n#ifdef HAS_TAA_TEX\nuniform sampler2D taaTextureSource;\n#ifdef HAS_FXAA_TEX\nuniform sampler2D fxaaTextureSource;\n#endif\n#endif\nuniform float pixelRatio;\nuniform float sharpFactor;\n#ifdef HAS_OUTLINE_TEX\nuniform sampler2D textureOutline;\nuniform float enableOutline;\nuniform float highlightFactor;\nuniform float outlineFactor;\nuniform float outlineWidth;\nuniform vec3 outlineColor;\n#endif\nvec2 c;\nvec4 d(vec2 e) {\n  \n#ifdef HAS_TAA_TEX\nvec4 f = texture2D(textureSource, e);\n  vec4 taa = texture2D(taaTextureSource, e);\n#ifdef HAS_FXAA_TEX\nvec4 h = texture2D(fxaaTextureSource, e);\n#else\nvec4 h = vec4(.0);\n#endif\nvec4 i = taa + f * (1. - taa.a);\n  return h + i * (1. - h.a);\n#else\nreturn texture2D(textureSource, e);\n#endif\n}\nvec4 j(vec2 k) {\n  vec4 l;\n  mediump vec2 m = vec2(1. / resolution.x, 1. / resolution.y);\n  vec3 n = d((k + vec2(-1., -1.)) * m).xyz;\n  vec3 o = d((k + vec2(1., -1.)) * m).xyz;\n  vec3 u = d((k + vec2(-1., 1.)) * m).xyz;\n  vec3 v = d((k + vec2(1.)) * m).xyz;\n  vec4 A = d(k * m);\n  vec3 B = A.xyz;\n  vec3 C = vec3(.299, .587, .114);\n  float D = dot(n, C);\n  float E = dot(o, C);\n  float F = dot(u, C);\n  float G = dot(v, C);\n  float H = dot(B, C);\n  float I = min(H, min(min(D, E), min(F, G)));\n  float J = max(H, max(max(D, E), max(F, G)));\n  mediump vec2 K;\n  K.x = -((D + E) - (F + G));\n  K.y = (D + F) - (E + G);\n  float L = max((D + E + F + G) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float M = 1. / (min(abs(K.x), abs(K.y)) + L);\n  K = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), K * M)) * m;\n  vec4 N = .5 * (d(k * m + K * (1. / 3. - .5)) + d(k * m + K * (2. / 3. - .5)));\n  vec4 O = N * .5 + .25 * (d(k * m + K * -.5) + d(k * m + K * .5));\n  float P = dot(O.xyz, C);\n  if(P < I || P > J)\n    l = N;\n  else\n    l = O;\n  return l;\n}\nvec3 Q(const in vec3 l, const float R) {\n  vec2 S = pixelRatio / resolution.xy;\n  float T = .0;\n  vec4 n = texture2D(textureSource, c + S * vec2(-1., -1.));\n  n.rgb = mix(vec3(.0), n.rgb, sign(n.a));\n  T += mix(.0, 1., sign(n.a));\n  vec4 v = texture2D(textureSource, c + S * vec2(1.));\n  v.rgb = mix(vec3(.0), v.rgb, sign(v.a));\n  T += mix(.0, 1., sign(v.a));\n  vec4 o = texture2D(textureSource, c + S * vec2(1., -1.));\n  o.rgb = mix(vec3(.0), o.rgb, sign(o.a));\n  T += mix(.0, 1., sign(o.a));\n  vec4 u = texture2D(textureSource, c + S * vec2(-1., 1.));\n  u.rgb = mix(vec3(.0), u.rgb, sign(u.a));\n  T += mix(.0, 1., sign(u.a));\n  return l + R * (T * l - n.rgb - o.rgb - u.rgb - v.rgb);\n}\nvec4 U(const in vec4 l) {\n  return vec4(Q(l.rgb, sharpFactor), l.a);\n}\nvec3 V(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float W = 2.43;\n  const float X = .59;\n  const float Y = .14;\n  return (x * (a * x + b)) / (x * (W * x + X) + Y);\n}\nvec3 Z(vec3 l) {\n  l = l / (l + vec3(1.));\n  return l = pow(l, vec3(1. / 2.2));\n}\n#ifdef HAS_OUTLINE_TEX\nvec4 ba() {\n  float bb = 2.;\n  float bc = 1.;\n  float bd = pixelRatio / resolution[0] * outlineWidth;\n  float be = pixelRatio / resolution[1] * outlineWidth;\n  vec4 bf = (texture2D(textureOutline, c + vec2(bd, be)));\n  vec4 bg = (texture2D(textureOutline, c + vec2(bd, .0)));\n  vec4 bh = (texture2D(textureOutline, c + vec2(bd, -be)));\n  vec4 bi = (texture2D(textureOutline, c + vec2(.0, -be)));\n  vec4 bj = (texture2D(textureOutline, c + vec2(-bd, -be)));\n  vec4 bk = (texture2D(textureOutline, c + vec2(-bd, .0)));\n  vec4 bl = (texture2D(textureOutline, c + vec2(-bd, be)));\n  vec4 bm = (texture2D(textureOutline, c + vec2(.0, be)));\n  vec4 bn = -bb * bk + bb * bg + -bc * bl + bc * bf + -bc * bj + bc * bh;\n  vec4 bo = -bb * bi + bb * bm + -bc * bj + bc * bl + -bc * bh + bc * bf;\n  float bp = sqrt(dot(bo, bo) + dot(bn, bn));\n  bool bq = bp < 1. / 65025.;\n  vec3 br = (texture2D(textureOutline, c)).r * outlineColor;\n  if(br == vec3(.0) || (highlightFactor == .0 && bq)) {\n    return vec4(.0);\n  }\n  float bs = bq ? highlightFactor : min(1., sqrt(bp) * outlineFactor);\n  return bs * vec4(br, 1.);\n}\nvec4 bt(const in vec4 l) {\n  vec4 ba = ba();\n  return ba + vec4(l) * (1. - ba.a);\n}\n#endif\nvoid main() {\n  c = vTexCoord;\n  vec4 l;\n  if(enableFXAA == 1.) {\n    l = j(c * resolution);\n  } else {\n    l = d(vTexCoord);\n  }\n  if(enableSharpen == 1.) {\n    l = U(l);\n  }\n#if defined(HAS_NOAA_TEX) || defined(HAS_POINT_TEX)\nvec4 bu = vec4(.0);\n  vec4 bv = vec4(.0);\n#ifdef HAS_POINT_TEX\nbu = texture2D(pointTextureSource, vTexCoord);\n#endif\n#ifdef HAS_NOAA_TEX\nbv = texture2D(noAaTextureSource, vTexCoord);\n#endif\nvec4 bw = bu + bv * (1. - bu.a);\n  l = bw + l * (1. - bw.a);\n#endif\nif(enableToneMapping == 1.) {\n    l.rgb = Z(l.rgb);\n  }\n#ifdef HAS_OUTLINE_TEX\nl = bt(l);\n#endif\ngl_FragColor = l;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}})}getMeshCommand(t,e){const n=this.dkey||"";return this.commands[n+"_fxaa"]||(this.commands[n+"_fxaa"]=this.createREGLCommand(t,null,e.getElements())),this.commands[n+"_fxaa"]}}class pe$5 extends de$5{constructor(){super({vert:ce$5,frag:"precision mediump float;\n#define SHADER_NAME SSAO_BLUR\nstruct MaterialParams {\n  float farPlaneOverEdgeDistance;\n  vec2 axis;\n  vec2 resolution;\n};\nuniform sampler2D materialParams_ssao;\nuniform sampler2D TextureInput;\nuniform MaterialParams materialParams;\nvarying vec2 vTexCoord;\nconst int c = 6;\nfloat d[8];\nvoid e() {\n  d[0] = .099736;\n  d[1] = .096667;\n  d[2] = .088016;\n  d[3] = .075284;\n  d[4] = .060493;\n  d[5] = .045662;\n}\nfloat f(vec2 h) {\n  return (h.x * (256. / 257.) + h.y * (1. / 257.));\n}\nvoid tap(inout float i, inout float j, float k, float h, vec2 l) {\n  vec3 m = texture2D(materialParams_ssao, l).rgb;\n  float n = k;\n  i += m.r * n;\n  j += n;\n}\nvoid main() {\n  e();\n  highp vec2 o = vTexCoord;\n  vec3 m = texture2D(materialParams_ssao, o).rgb;\n  if(m.g * m.b == 1.) {\n    if(materialParams.axis.y > .0) {\n      vec4 u = texture2D(TextureInput, o);\n      gl_FragColor = u;\n    } else {\n      gl_FragColor = vec4(m, 1.);\n    }\n    return;\n  }\n  float h = f(m.gb);\n  float j = d[0];\n  float i = m.r * j;\n  vec2 v = materialParams.axis / materialParams.resolution;\n  vec2 A = v;\n  for(int B = 1; B < c; B++) {\n    float k = d[B];\n    tap(i, j, k, h, o + A);\n    tap(i, j, k, h, o - A);\n    A += v;\n  }\n  float C = i * (1. / j);\n  vec2 gb = m.gb;\n  if(materialParams.axis.y > .0) {\n    vec4 u = texture2D(TextureInput, o);\n    gl_FragColor = vec4(u.rgb * C, u.a);\n  } else {\n    gl_FragColor = vec4(C, gb, 1.);\n  }\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.outputSize[0],height:(t,e)=>e.outputSize[1]}}})}getMeshCommand(t,e){return this.commands.ssao_blur||(this.commands.ssao_blur=this.createREGLCommand(t,null,e.getElements())),this.commands.ssao_blur}}const _e$4=[-2e-6,0,2e-6,-.095089,.004589,-.031253,.01518,-.025586,.003765,.073426,.021802,.002778,.094587,.043218,.089148,-.009509,.051369,.019673,.139973,-.101685,.10857,-.103804,.219853,-.043016,.004841,-.033988,.094187,.028011,.058466,-.25711,-.051031,.074993,.259843,.118822,-.186537,-.134192,.063949,-.094894,-.072683,.108176,.327108,-.254058,-.04718,.21918,.263895,-.407709,.240834,-.200352];class ve$4 extends de$5{constructor(){super({vert:ce$5,frag:"#if __VERSION__ == 100\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision highp float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#define saturate(x)        clamp(x, 0.0, 1.0)\n#define SHADER_NAME SSAO_EXTRACT\n#define PI 3.14159265359\nconst float c = .0625;\nstruct MaterialParams {\n  mat4 projMatrix;\n  mat4 invProjMatrix;\n  vec4 resolution;\n  float radius;\n  float bias;\n  float power;\n  vec2 cameraNearFar;\n};\nuniform MaterialParams materialParams;\nuniform sampler2D materialParams_depth;\n#define NOISE_NONE      0\n#define NOISE_PATTERN   1\n#define NOISE_RANDOM    2\n#define NOISE_TYPE      NOISE_PATTERN\nconst int d = 16;\nuniform vec3 kSphereSamples[16];\nvec3 e(const int x) {\n  if(x == 0) {\n    return vec3(-.078247, -.749924, -.656880);\n  } else if(x == 1) {\n    return vec3(-.572319, -.102379, -.813615);\n  } else if(x == 2) {\n    return vec3(.048653, -.380791, .923380);\n  } else if(x == 3) {\n    return vec3(.281202, -.656664, -.699799);\n  } else if(x == 4) {\n    return vec3(.711911, -.235841, -.661485);\n  } else if(x == 5) {\n    return vec3(-.445893, .611063, .654050);\n  } else if(x == 6) {\n    return vec3(-.703598, .674837, .222587);\n  } else if(x == 7) {\n    return vec3(.768236, .507457, .390257);\n  } else if(x == 8) {\n    return vec3(-.670286, -.470387, .573980);\n  } else if(x == 9) {\n    return vec3(.199235, .849336, -.488808);\n  } else if(x == 10) {\n    return vec3(-.768068, -.583633, -.263520);\n  } else if(x == 11) {\n    return vec3(-.897330, .328853, .294372);\n  } else if(x == 12) {\n    return vec3(-.570930, -.531056, -.626114);\n  } else if(x == 13) {\n    return vec3(.699014, .063283, -.712303);\n  } else if(x == 14) {\n    return vec3(.207495, .976129, -.064172);\n  } else if(x == 15) {\n    return vec3(-.060901, -.869738, -.489742);\n  } else {\n    return vec3(.0);\n  }\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n}\nvec2 f(highp float h) {\n  highp float z = clamp(h * 1. / -materialParams.cameraNearFar.y, .0, 1.);\n  highp float t = floor(256. * z);\n  mediump float i = t * (1. / 256.);\n  mediump float j = 256. * z - t;\n  return vec2(i, j);\n}\nfloat k(highp vec2 l) {\n  l = fract(l * vec2(5.3987, 5.4421));\n  l += dot(l.yx, l.xy + vec2(21.5351, 14.3137));\n  highp float xy = l.x * l.y;\n  return fract(xy * 95.4307) + fract(xy * 75.04961) * .5;\n}\nvec3 m(const vec2 o) {\n  \n#if NOISE_TYPE == NOISE_RANDOM\nreturn normalize(2. * vec3(k(o), k(o * 2.), k(o * 4.)) - vec3(1.));\n#elif NOISE_TYPE == NOISE_PATTERN\nvec2 xy = floor(gl_FragCoord.xy);\n  float u = mod(xy.x, 4.);\n  float v = mod(xy.y, 4.);\n  return e(int(u + v * 4.));\n#else\nreturn vec3(.0);\n#endif\n}\nhighp mat4 A() {\n  return materialParams.projMatrix;\n}\nhighp mat4 B() {\n  return materialParams.invProjMatrix;\n}\nhighp float C(const vec2 o) {\n  return texture2D(materialParams_depth, o).r;\n}\nhighp float D(highp float h) {\n  highp mat4 E = A();\n  highp float z = h * 2. - 1.;\n  return -E[3].z / (z + E[2].z);\n}\nhighp float F(const vec2 o) {\n  return D(texture2D(materialParams_depth, o).r);\n}\nhighp vec3 G(in vec2 p, highp float H) {\n  p = p * 2. - 1.;\n  highp mat4 I = B();\n  p.x *= I[0].x;\n  p.y *= I[1].y;\n  return vec3(p * -H, H);\n}\nhighp vec3 J(const highp vec3 K) {\n  highp vec3 L = dFdx(K);\n  highp vec3 M = dFdy(K);\n  return cross(L, M);\n}\nhighp vec3 J(const highp vec3 K, const vec2 o) {\n  vec2 N = o + vec2(materialParams.resolution.z, .0);\n  vec2 O = o + vec2(.0, materialParams.resolution.w);\n  highp vec3 px = G(N, F(N));\n  highp vec3 py = G(O, F(O));\n  highp vec3 L = px - K;\n  highp vec3 M = py - K;\n  return cross(L, M);\n}\nfloat P(const highp vec3 Q, const highp float R, mat3 S, const vec3 T, const vec3 U) {\n  highp mat4 E = A();\n  float V = materialParams.radius;\n  float W = materialParams.bias;\n  highp vec3 X = S * U;\n  float Y = dot(X, T);\n  X = sign(Y) * X;\n  X = Q + X * V;\n  highp vec4 Z = E * vec4(X, 1.);\n  Z.xy = Z.xy * (.5 / Z.w) + .5;\n  highp float ba = C(Z.xy);\n  ba = D(ba);\n  float t = saturate(V / abs(R - ba));\n  float bb = t * t * (3. - 2. * t);\n  return (ba >= X.z + W ? bb : .0);\n}\nvoid main() {\n  highp vec2 o = vTexCoord;\n  highp float h = C(o);\n  highp float bc = D(h);\n  highp vec3 Q = G(o, bc);\n  highp vec3 T = J(Q, o);\n  T = normalize(T);\n  vec3 bd = m(o);\n  vec3 be = bd.xyz;\n  vec3 bf = normalize(be - T * dot(be, T));\n  vec3 bg = cross(T, bf);\n  mat3 S = mat3(bf, bg, T);\n  float bh = .0;\n  for(int bi = 0; bi < d; bi++) {\n    bh += P(Q, bc, S, T, kSphereSamples[bi]);\n  }\n  float bj = 1. - bh / float(d);\n  bj = mix(bj, bj * bj, materialParams.power);\n  glFragColor = vec4(bj, f(Q.z), 1.);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"kSphereSamples",type:"function",fn:function(){return _e$4}}],extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.outputSize[0],height:(t,e)=>e.outputSize[1]}}}),this.version=300}getMeshCommand(t,e){return this.commands.ssao_extract||(this.commands.ssao_extract=this.createREGLCommand(t,null,e.getElements())),this.commands.ssao_extract}}const ye$4=[];class xe$4{constructor(t){this._renderer=t}render(t,e,n){const{width:i,height:r}=n;return this._initShaders(),this._extractFBO||this._createTextures(n),this._extract(t,i,r,n),this._blurAndCombine(e,t.cameraFar,i,r)}_blurAndCombine(t,e,n,i){const r=Math.floor(n/2),o=Math.floor(i/2);this._blurHTex.width===r&&this._blurHTex.height===o||(this._blurHFBO.resize(r,o),this._blurVFBO.resize(n,i));const s=[n,i],a=[1,0];return this._renderer.render(this._ssaoBlurShader,{TextureInput:t,materialParams_ssao:this._extractTex,materialParams:{axis:a,farPlaneOverEdgeDistance:-e/.0625,resolution:s},outputSize:[r,o]},null,this._blurHFBO),a[0]=0,a[1]=1,this._renderer.render(this._ssaoBlurShader,{TextureInput:t,materialParams_ssao:this._blurHTex,materialParams:{axis:a,farPlaneOverEdgeDistance:-e/.0625,resolution:s},outputSize:[n,i]},null,this._blurVFBO),this._blurVTex}_extract(t,n,i,r){const o=Math.floor(n/2),s=Math.floor(i/2);this._extractFBO.width===o&&this._extractFBO.height===s||this._extractFBO.resize(o,s);const{projMatrix:a}=t,h=invert$2(ye$4,a);this._renderer.render(this._ssaoExtractShader,{materialParams_depth:r,materialParams:{projMatrix:a,invProjMatrix:h,resolution:[o,s,1/o,1/s],radius:t.radius,bias:t.bias,power:t.power||1,cameraNearFar:[t.cameraNear,t.cameraFar]},outputSize:[o,s]},null,this._extractFBO)}_createTextures(t){const e=Math.floor(t.width/2),n=Math.floor(t.height/2);this._extractTex=this._createTex(e,n,"uint8"),this._extractFBO=this._createFBO(this._extractTex),this._blurHTex=this._createTex(e,n,"uint8"),this._blurHFBO=this._createFBO(this._blurHTex),this._blurVTex=this._createTex(t.width,t.height,"uint8"),this._blurVFBO=this._createFBO(this._blurVTex)}_createTex(t,e,n){return this._renderer.regl.texture({min:"linear",mag:"linear",wrap:"clamp",type:n,width:t,height:e})}_createFBO(t){return this._renderer.regl.framebuffer({width:t.width,height:t.height,colors:[t],depth:!1,stencil:!1})}dispose(){this._extractFBO&&(this._extractFBO.destroy(),delete this._extractFBO,this._blurVFBO.destroy(),this._blurHFBO.destroy(),this._ssaoExtractShader.dispose(),this._ssaoBlurShader.dispose(),delete this._ssaoExtractShader)}_initShaders(){this._ssaoExtractShader||(this._ssaoExtractShader=new ve$4,this._ssaoBlurShader=new pe$5)}}class be$4 extends de$5{constructor(){super({vert:ce$5,frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\nuniform float enableVignette;\nuniform float enableGrain;\nuniform float enableLut;\nuniform float timeGrain;\nuniform float grainFactor;\nuniform vec2 lensRadius;\nuniform float frameMod;\nuniform sampler2D lookupTable;\nfloat c(const in vec2 d) {\n  vec3 e = fract(vec3(d.xyx) * .1031);\n  e += dot(e, e.yzx + 19.19);\n  return fract((e.x + e.y) * e.z);\n}\nfloat f() {\n  float h = c(gl_FragCoord.xy + 1000.0 * fract(timeGrain));\n  float i = h * 2. - 1.;\n  h = i * inversesqrt(abs(i));\n  h = max(-1., h);\n  h = h - sign(i) + .5;\n  return (h + .5) * .5;\n}\nvec4 j(const in vec4 k) {\n  float l = f();\n  return vec4(mix(k.rgb, k.rgb * (k.rgb + (1. - k.rgb) * 2. * l), grainFactor), k.a);\n}\nfloat m(const in float k) {\n  return k < .0031308 ? k * 12.92 : 1.055 * pow(k, 1. / 2.4) - .055;\n}\nvec3 m(const in vec3 k) {\n  return vec3(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055);\n}\nvec4 m(const in vec4 k) {\n  return vec4(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055, k.a);\n}\nfloat n(const in float k) {\n  return k < .04045 ? k * (1. / 12.92) : pow((k + .055) * (1. / 1.055), 2.4);\n}\nvec3 n(const in vec3 k) {\n  return vec3(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4));\n}\nvec4 n(const in vec4 k) {\n  return vec4(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4), k.a);\n}\nfloat o(const in vec2 d, const in float u) {\n  vec3 v = vec3(.06711056, .00583715, 52.9829189);\n  return fract(v.z * fract(dot(d.xy + u * vec2(47., 17.) * .695, v.xy)));\n}\nfloat A() {\n  vec2 B = lensRadius;\n  B.y = min(B.y, B.x - 1e-4);\n  float C = o(gl_FragCoord.xy, frameMod);\n  C = (B.x - B.y) * (B.x + B.y) * .07 * (C - .5);\n  return smoothstep(B.x, B.y, C + distance(vTexCoord, vec2(.5)));\n}\nvec4 D(const in vec4 k) {\n  float l = A();\n  return vec4(m(n(k.rgb) * l), clamp(k.a + (1. - l), .0, 1.));\n}\nvec4 E(in vec4 F, in sampler2D G) {\n  mediump float H = F.b * 63.;\n  mediump vec2 I;\n  I.y = floor(floor(H) / 8.);\n  I.x = floor(H) - I.y * 8.;\n  mediump vec2 J;\n  J.y = floor(ceil(H) / 8.);\n  J.x = ceil(H) - J.y * 8.;\n  highp vec2 K;\n  K.x = I.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  K.y = I.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nK.y = 1. - K.y;\n#endif\nhighp vec2 L;\n  L.x = J.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  L.y = J.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nL.y = 1. - L.y;\n#endif\nlowp vec4 M = texture2D(G, K);\n  lowp vec4 N = texture2D(G, L);\n  lowp vec4 O = mix(M, N, fract(H));\n  return O;\n}\nvoid main() {\n  vec4 k = texture2D(textureSource, vTexCoord);\n  if(enableLut == 1.) {\n    k = E(k, lookupTable);\n  }\n  if(enableVignette == 1.) {\n    k = D(k);\n  }\n  if(enableGrain == 1.) {\n    k = j(k);\n  }\n  gl_FragColor = k;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}})}getMeshCommand(t,e){return this.commands.postprocess||(this.commands.postprocess=this.createREGLCommand(t,null,e.getElements())),this.commands.postprocess}}class we$4 extends de$5{constructor(){super({vert:ce$5,frag:"#define SHADER_NAME TAA\nprecision mediump float;\n#define saturate(x)        clamp(x, 0.0, 1.0)\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\n#define TEXTURE_SPACE_UP    -1\n#define TEXTURE_SPACE_DN     1\n#else\n#define TEXTURE_SPACE_UP     1\n#define TEXTURE_SPACE_DN    -1\n#endif\n#define BOX_TYPE_AABB           0\n#define BOX_TYPE_VARIANCE       1\n#define BOX_TYPE_AABB_VARIANCE  2\n#define VARIANCE_GAMMA          1.0\n#define BOX_CLIPPING_ACCURATE   0\n#define BOX_CLIPPING_CLAMP      1\n#define BOX_CLIPPING_NONE       2\n#if defined(TARGET_MOBILE)\n#define BOX_CLIPPING            BOX_CLIPPING_ACCURATE\n#define BOX_TYPE                BOX_TYPE_VARIANCE\n#define USE_YCoCg               0\n#define FILTER_INPUT            1\n#define FILTER_HISTORY          0\n#else\n#define BOX_CLIPPING            BOX_CLIPPING_ACCURATE\n#define BOX_TYPE                BOX_TYPE_AABB_VARIANCE\n#define USE_YCoCg               0\n#define FILTER_INPUT            0\n#define FILTER_HISTORY          0\n#endif\n#define HISTORY_REPROJECTION    1\n#define PREVENT_FLICKERING      0\nstruct MaterialParams {\n  float alpha;\n  mat4 reprojection;\n};\nuniform sampler2D materialParams_color;\nuniform sampler2D materialParams_history;\nuniform vec2 materialParams_history_size;\nuniform vec2 textureOutputSize;\nuniform sampler2D materialParams_depth;\nuniform MaterialParams materialParams;\nfloat c(const vec3 d) {\n  return dot(d, vec3(.2126, .7152, .0722));\n}\nfloat e(const vec3 f) {\n  \n#if USE_YCoCg\nreturn f.x;\n#else\nreturn c(f);\n#endif\n}\nvec3 h(const vec3 i) {\n  float j = dot(i.rgb, vec3(1, 2, 1) * .25);\n  float k = dot(i.rgb, vec3(2, 0, -2) * .25);\n  float l = dot(i.rgb, vec3(-1, 2, -1) * .25);\n  return vec3(j, k, l);\n}\nvec3 m(const vec3 i) {\n  float j = i.x;\n  float k = i.y;\n  float l = i.z;\n  float r = j + k - l;\n  float g = j + l;\n  float b = j - k - l;\n  return vec3(r, g, b);\n}\nvec4 n(const int o, const vec3 u, const vec3 v, const vec4 i, const vec4 A) {\n  const float B = .0001;\n  if(o == BOX_CLIPPING_ACCURATE) {\n    vec4 r = i - A;\n    vec3 C = 1. / (B + r.rgb);\n    vec3 D = (v - A.rgb) * C;\n    vec3 E = (u - A.rgb) * C;\n    vec3 F = min(D, E);\n    return A + r * saturate(max(max(F.x, F.y), F.z));\n  } else if(o == BOX_CLIPPING_CLAMP) {\n    return vec4(clamp(A.rgb, u, v), A.a);\n  }\n  return A;\n}\nvec4 G(const sampler2D H, const highp vec2 I, const highp vec2 J) {\n  highp vec2 K = I * J;\n  highp vec2 L = floor(K - .5) + .5;\n  highp vec2 M = K - L;\n  highp vec2 N = M * M;\n  highp vec2 O = N * M;\n  vec2 P = N - .5 * (O + M);\n  vec2 Q = 1.5 * O - 2.5 * N + 1.;\n  vec2 R = .5 * (O - N);\n  vec2 S = 1. - P - Q - R;\n  vec2 T = Q + S;\n  highp vec2 U = L - vec2(1.);\n  highp vec2 V = L + vec2(2.);\n  highp vec2 W = L + S / T;\n  highp vec2 X = 1. / J;\n  U *= X;\n  V *= X;\n  W *= X;\n  float Z = T.x * P.y;\n  float ba = P.x * T.y;\n  float bb = T.x * T.y;\n  float bc = R.x * T.y;\n  float bd = T.x * R.y;\n  vec4 be = texture2D(H, vec2(W.x, U.y)) * Z + texture2D(H, vec2(U.x, W.y)) * ba + texture2D(H, vec2(W.x, W.y)) * bb + texture2D(H, vec2(V.x, W.y)) * bc + texture2D(H, vec2(W.x, V.y)) * bd;\n  be *= 1. / (Z + ba + bb + bc + bd);\n  return be;\n}\nvec4 bf(sampler2D H, vec2 I, float bg, ivec2 bh) {\n  return texture2D(H, I + vec2(bh));\n}\nvoid main() {\n  highp vec4 I = (gl_FragCoord.xy / textureOutputSize.xy).xyxy;\n  float bi = texture2D(materialParams_depth, I.xy).r;\n#if HISTORY_REPROJECTION\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\nI.w = 1. - I.w;\n#endif\nhighp vec4 q = materialParams.reprojection * vec4(I.zw, bi, 1.);\n  I.zw = (q.xy * (1. / q.w)) * .5 + .5;\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\nI.w = 1. - I.w;\n#endif\n#endif\nvec4 f = bf(materialParams_color, I.xy, .0, ivec2(0));\n#if FILTER_HISTORY\nvec4 bj = G(materialParams_history, I.zw, materialParams_history_size);\n#else\nvec4 bj = texture2D(materialParams_history, I.zw);\n#endif\n#if USE_YCoCg\nbj.rgb = h(bj.rgb);\n#endif\nvec3 s[9];\n  s[0] = bf(materialParams_color, I.xy, .0, ivec2(-1, TEXTURE_SPACE_DN)).rgb;\n  s[1] = bf(materialParams_color, I.xy, .0, ivec2(0, TEXTURE_SPACE_DN)).rgb;\n  s[2] = bf(materialParams_color, I.xy, .0, ivec2(1, TEXTURE_SPACE_DN)).rgb;\n  s[3] = bf(materialParams_color, I.xy, .0, ivec2(-1, 0)).rgb;\n  s[4] = f.rgb;\n  s[5] = bf(materialParams_color, I.xy, .0, ivec2(1, 0)).rgb;\n  s[6] = bf(materialParams_color, I.xy, .0, ivec2(-1, TEXTURE_SPACE_UP)).rgb;\n  s[7] = bf(materialParams_color, I.xy, .0, ivec2(0, TEXTURE_SPACE_UP)).rgb;\n  s[8] = bf(materialParams_color, I.xy, .0, ivec2(1, TEXTURE_SPACE_UP)).rgb;\n#if USE_YCoCg\nfor(int bk = 0; bk < 9; bk++) {\n    s[bk] = h(s[bk]);\n  }\n  f.rgb = s[4].rgb;\n#endif\n#if FILTER_INPUT\n#else\nvec4 bl = f;\n#endif\n#if BOX_TYPE == BOX_TYPE_AABB || BOX_TYPE == BOX_TYPE_AABB_VARIANCE\nvec3 u = min(s[4], min(min(s[1], s[3]), min(s[5], s[7])));\n  vec3 v = max(s[4], max(max(s[1], s[3]), max(s[5], s[7])));\n  vec3 bm = min(u, min(min(s[0], s[2]), min(s[6], s[8])));\n  vec3 bn = max(v, max(max(s[0], s[2]), max(s[6], s[8])));\n  u = (u + bm) * .5;\n  v = (v + bn) * .5;\n#endif\n#if BOX_TYPE == BOX_TYPE_VARIANCE || BOX_TYPE == BOX_TYPE_AABB_VARIANCE\nvec3 bo = s[4];\n  vec3 bp = s[4] * s[4];\n  for(int bk = 1; bk < 9; bk += 2) {\n    bo += s[bk];\n    bp += s[bk] * s[bk];\n  }\n  vec3 bq = bo * (1. / 5.);\n  vec3 br = bp * (1. / 5.);\n  vec3 bs = sqrt(br - bq * bq);\n#if BOX_TYPE == BOX_TYPE_VARIANCE\nvec3 u = bq - VARIANCE_GAMMA * bs;\n  vec3 v = bq + VARIANCE_GAMMA * bs;\n#else\nu = min(u, bq - VARIANCE_GAMMA * bs);\n  v = max(v, bq + VARIANCE_GAMMA * bs);\n#endif\n#endif\nfloat bt = e(bl.rgb);\n  float bu = e(bj.rgb);\n  float bv = materialParams.alpha;\n#if PREVENT_FLICKERING\nfloat bw = 1. - abs(bt - bu) / (.001 + max(bt, bu));\n  bv *= bw * bw;\n#endif\nbl.rgb *= 1. / (1. + bt);\n  bj.rgb *= 1. / (1. + bu);\n  vec4 be = mix(bj, bl, bv);\n  be.rgb *= 1. / (1. - e(be.rgb));\n#if USE_YCoCg\nbe.rgb = m(be.rgb);\n#endif\nbe = max(vec4(0), be);\n  gl_FragColor = be;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.materialParams_color.width,height:(t,e)=>e.materialParams_color.height},blend:{enable:!1}}})}getMeshCommand(t,e){return this.commands.taa||(this.commands.taa=this.createREGLCommand(t,null,e.getElements())),this.commands.taa}}const Ce$4=[2,0,0,0,0,2,0,0,0,0,-2,0,-1,-1,1,1];class Me$4{constructor(t,e){this._jitter=e,this._renderer=t,this._halton=[],this._counter=0}needToRedraw(){return this._counter<this._jitter.getSampleCount()}render(t,n,i,r){const s=this._jitter;this._initShaders(),this._createTextures(t),r&&(this._counter=0),this._counter++;const a=s.getSampleCount();if(this._counter>=a)return this._prevTex;this._fbo.width===t.width&&this._fbo.height===t.height||this._fbo.resize(t.width,t.height);const h=this._outputTex,l=this._prevTex,c=this._uniforms||{materialParams_history_size:[l.width,l.height],textureOutputSize:[],materialParams:{alpha:1,reprojection:[],filterWeights:[]}};c.materialParams.alpha=1/this._counter;const u=c.materialParams.reprojection;multiply$5(u,this._prevProjMatrix||i,invert$2(u,i)),multiply$5(u,u,Ce$4),set(c.materialParams_history_size,l.width,l.height),set(c.textureOutputSize,t.width,t.height),c.materialParams_depth=n,c.materialParams_color=t,c.materialParams_history=l,this._renderer.render(this._shader,c,null,this._fbo);const f=this._outputTex,d=this._fbo;return this._outputTex=this._prevTex,this._fbo=this._prevFbo,this._prevTex=f,this._prevFbo=d,this._prevProjMatrix=copy$5(this._prevProjMatrix||[],i),h}dispose(){this._shader&&(this._shader.dispose(),delete this._shader),this._fbo&&this._fbo.destroy(),this._prevFbo&&this._prevFbo.destroy(),delete this._uniforms}_createTextures(t){if(this._outputTex)return;const e=this._renderer.regl;this._outputTex=this._createColorTex(t),this._fbo=e.framebuffer({width:t.width,height:t.height,colors:[this._outputTex],depth:!1,stencil:!1}),this._prevTex=this._createColorTex(t),this._prevFbo=e.framebuffer({width:t.width,height:t.height,colors:[this._prevTex],depth:!1,stencil:!1})}_createColorTex(t){return this._renderer.regl.texture({min:"linear",mag:"linear",type:"uint8",width:t.width,height:t.height})}_initShaders(){this._shader||(this._shader=new we$4)}}const Te$4=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],Se$4=Te$4.length,Pe$4=[0,0];for(let t=0;t<Te$4.length;t++)Pe$4[0]+=Te$4[t][0],Pe$4[1]+=Te$4[t][1];Pe$4[0]/=Se$4,Pe$4[1]/=Se$4;class Ae$4{constructor(t){this._frameNum=0,this._ratio=t||.05,this._avg=[Pe$4[0]*this._ratio,Pe$4[1]*this._ratio]}getRatio(){return this._ratio}setRatio(t){this._ratio!==t&&(this._ratio=t,this.reset()),this._avg=[Pe$4[0]*this._ratio,Pe$4[1]*this._ratio]}getAverage(){return this._avg}reset(){this._frameNum=0}getJitter(t){const e=this._frameNum%Se$4,n=this._ratio;return set(t,Te$4[e][0]*n,Te$4[e][1]*n),t}frame(){this._frameNum++,this._frameNum%Se$4==0&&(this._frameNum=0)}getSampleCount(){return Se$4}}class Ee$4{constructor(t,e,n=5){this._regl=t,this._renderer=new N$8(t),this._inputRGBM=e,this._level=n}render(t,e){this._initShaders(),this._createTextures(t),this._blur(t,e||0);const n={blurTex0:this._blur01Tex,blurTex1:this._blur11Tex,blurTex2:this._blur21Tex,blurTex3:this._blur31Tex,blurTex4:this._blur41Tex};return this._level>5&&(n.blurTex5=this._blur51Tex,n.blurTex6=this._blur61Tex),n}_blur(t,e){let n=this._blurUniforms;n||(n=this._blurUniforms={rgbmRange:7,blurDir:[0,0],outSize:[0,0],pixelRatio:[1,1],outputSize:[0,0]}),set(n.outSize,t.width,t.height),this._blurOnce(this._blur0Shader,t,this._blur00FBO,this._blur01FBO,.5,e),this._blurOnce(this._blur1Shader,this._blur01FBO.color[0],this._blur10FBO,this._blur11FBO,.5),this._blurOnce(this._blur2Shader,this._blur11FBO.color[0],this._blur20FBO,this._blur21FBO,.5),this._blurOnce(this._blur3Shader,this._blur21FBO.color[0],this._blur30FBO,this._blur31FBO,.5),this._blurOnce(this._blur4Shader,this._blur31FBO.color[0],this._blur40FBO,this._blur41FBO,.5),this._level>5&&(this._blurOnce(this._blur5Shader,this._blur41FBO.color[0],this._blur50FBO,this._blur51FBO,.5),this._blurOnce(this._blur6Shader,this._blur51FBO.color[0],this._blur60FBO,this._blur51FBO,.5))}_blurOnce(t,e,n,i,r,s){const a=Math.ceil(r*e.width),h=Math.ceil(r*e.height);n.width===a&&n.height===h||n.resize(a,h),i.width===a&&i.height===h||i.resize(a,h);const l=this._blurUniforms;l.luminThreshold=s,l.TextureBlurInput=e,l.inputRGBM=+this._inputRGBM,set(l.blurDir,0,1),set(l.outputSize,n.width,n.height),this._renderer.render(t,l,null,n),l.luminThreshold=0,l.inputRGBM=1,set(l.blurDir,1,0),l.TextureBlurInput=n.color[0],this._renderer.render(t,l,null,i)}dispose(){this._blur0Shader&&(this._blur0Shader.dispose(),delete this._blur0Shader,this._blur1Shader.dispose(),this._blur2Shader.dispose(),this._blur3Shader.dispose(),this._blur4Shader.dispose(),this._blur5Shader&&(this._blur5Shader.dispose(),this._blur6Shader.dispose(),delete this._blur5Shader)),this._blur00Tex&&(delete this._blur00Tex,this._blur00FBO.destroy(),this._blur01FBO.destroy(),this._blur10FBO.destroy(),this._blur11FBO.destroy(),this._blur20FBO.destroy(),this._blur21FBO.destroy(),this._blur30FBO.destroy(),this._blur31FBO.destroy(),this._blur40FBO.destroy(),this._blur41FBO.destroy(),this._blur50FBO&&(this._blur50FBO.destroy(),this._blur51FBO.destroy(),this._blur60FBO.destroy(),this._blur61FBO.destroy()))}_createTextures(t){if(this._blur00Tex)return;let e=t.width,n=t.height;this._blur00Tex=this._createColorTex(t,e,n),this._blur00FBO=this._createBlurFBO(this._blur00Tex),this._blur01Tex=this._createColorTex(t),this._blur01FBO=this._createBlurFBO(this._blur01Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur10Tex=this._createColorTex(t,e,n),this._blur10FBO=this._createBlurFBO(this._blur10Tex),this._blur11Tex=this._createColorTex(t,e,n),this._blur11FBO=this._createBlurFBO(this._blur11Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur20Tex=this._createColorTex(t,e,n),this._blur20FBO=this._createBlurFBO(this._blur20Tex),this._blur21Tex=this._createColorTex(t,e,n),this._blur21FBO=this._createBlurFBO(this._blur21Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur30Tex=this._createColorTex(t,e,n),this._blur30FBO=this._createBlurFBO(this._blur30Tex),this._blur31Tex=this._createColorTex(t,e,n),this._blur31FBO=this._createBlurFBO(this._blur31Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur40Tex=this._createColorTex(t,e,n),this._blur40FBO=this._createBlurFBO(this._blur40Tex),this._blur41Tex=this._createColorTex(t,e,n),this._blur41FBO=this._createBlurFBO(this._blur41Tex),this._level>5&&(e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur50Tex=this._createColorTex(t,e,n),this._blur50FBO=this._createBlurFBO(this._blur50Tex),this._blur51Tex=this._createColorTex(t,e,n),this._blur51FBO=this._createBlurFBO(this._blur51Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur60Tex=this._createColorTex(t,e,n),this._blur60FBO=this._createBlurFBO(this._blur60Tex),this._blur61Tex=this._createColorTex(t,e,n),this._blur61FBO=this._createBlurFBO(this._blur61Tex))}_createColorTex(t,e,n){return this._regl.texture({min:"linear",mag:"linear",type:"uint8",width:e||t.width,height:n||t.height})}_createBlurFBO(t){return this._regl.framebuffer({width:t.width,height:t.height,colors:[t],depth:!1,stencil:!1})}_initShaders(){if(!this._blur0Shader){const t={vert:ce$5,extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.outputSize[0],height:(t,e)=>e.outputSize[1]}},frag:"#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\nuniform float inputRGBM;\nuniform float luminThreshold;\n#define SHADER_NAME GAUSSIAN_BLUR0\nconst vec3 c = vec3(.2126, .7152, .0722);\nfloat d(const in vec3 e) {\n  return dot(e, c);\n}\nvec4 f(vec4 e) {\n  float h = max(sign(d(e.rgb) - luminThreshold), .0);\n  return e * h;\n}\nvec2 i;\nvec4 j(const in vec3 e, const in float k) {\n  vec4 l;\n  vec3 m = e / k;\n  l.a = clamp(max(max(m.r, m.g), max(m.b, 1e-6)), .0, 1.);\n  l.a = ceil(l.a * 255.) / 255.;\n  l.rgb = m / l.a;\n  return l;\n}\nvec3 n(const in vec4 e, const in float k) {\n  if(inputRGBM == .0)\n    return e.rgb;\n  return k * e.rgb * e.a;\n}\nvec4 o() {\n  vec3 u = .375 * (f(vec4(n(texture2D(TextureBlurInput, i.xy), rgbmRange), 1.))).rgb;\n  vec2 v;\n  vec2 A = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  v = A * 1.2;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy + v.xy), rgbmRange), 1.))).rgb;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy - v.xy), rgbmRange), 1.))).rgb;\n  return vec4(u, 1.);\n}\nvoid main(void) {\n  i = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = o();\n  e = j(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}"};this._blur0Shader=new de$5(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR1\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .3125 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.2857142857142858;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur1Shader=new de$5(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR2\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2734375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3333333333333333;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.111111111111111;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur2Shader=new de$5(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR3\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .24609375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3636363636363635;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.1818181818181817;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur3Shader=new de$5(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR4\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2255859375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3846153846153846;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.230769230769231;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.076923076923077;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur4Shader=new de$5(t),this._level>5&&(t.frag="precision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR5\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .20947265625 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.4;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2666666666666666;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.133333333333334;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur5Shader=new de$5(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR6\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .196380615234375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.411764705882353;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2941176470588234;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.176470588235294;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur6Shader=new de$5(t))}}}class Oe$4{constructor(t){this._regl=t,this._renderer=new N$8(t)}render(t,e,n,i,r,o,s,a,h){this._initShaders(),this._createTextures(t);const l=this._blurPass.render(e,n);return this._combine(t,l,e,i,r,o,s,a,h)}_combine(t,e,n,i,r,s,a,h,l){l||this._combineTex.width===t.width&&this._combineTex.height===t.height||this._combineFBO.resize(t.width,t.height);let c=this._combineUniforms;const{blurTex0:u,blurTex1:f,blurTex2:d,blurTex3:m,blurTex4:g}=e;c||(c=this._combineUniforms={bloomFactor:0,bloomRadius:0,rgbmRange:7,TextureBloomBlur1:u,TextureBloomBlur2:f,TextureBloomBlur3:d,TextureBloomBlur4:m,TextureBloomBlur5:g,TextureInput:null,TextureSource:null,outputSize:[0,0]}),c.noAaTextureSource=s,c.pointTextureSource=a,c.enableAA=h,c.bloomFactor=i,c.bloomRadius=r,c.TextureInput=n,c.TextureSource=t,set(c.outputSize,t.width,t.height);const p={};return s?p.HAS_NOAA_TEX=1:delete p.HAS_NOAA_TEX,a?p.HAS_POINT_TEX=1:delete p.HAS_POINT_TEX,this._combineShader.setDefines(p),this._renderer.render(this._combineShader,c,null,l?null:this._combineFBO),l?null:this._combineTex}dispose(){this._combineFBO&&(this._combineFBO.destroy(),delete this._combineFBO),this._blurPass&&(this._blurPass.dispose(),delete this._blurPass),delete this._uniforms}_createTextures(t){this._combineTex||(this._combineTex=this._createColorTex(t,t.width,t.height,"uint8"),this._combineFBO=this._createBlurFBO(this._combineTex))}_createColorTex(t,e,n,i){const r=this._renderer.regl,o=i||(r.hasExtension("OES_texture_half_float")?"float16":"float");return r.texture({min:"linear",mag:"linear",type:o,width:e||t.width,height:n||t.height})}_createBlurFBO(t){return this._renderer.regl.framebuffer({width:t.width,height:t.height,colors:[t],depth:!1,stencil:!1})}_initShaders(){if(!this._combineShader){const t={x:0,y:0,width:(t,e)=>e.outputSize[0],height:(t,e)=>e.outputSize[1]};this._blurPass=new Ee$4(this._regl,!1),this._combineShader=new de$5({vert:ce$5,frag:"#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision highp float;\nuniform float bloomFactor;\nuniform float bloomRadius;\nuniform float rgbmRange;\nuniform sampler2D TextureBloomBlur1;\nuniform sampler2D TextureBloomBlur2;\nuniform sampler2D TextureBloomBlur3;\nuniform sampler2D TextureBloomBlur4;\nuniform sampler2D TextureBloomBlur5;\nuniform sampler2D TextureInput;\nuniform sampler2D TextureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\nuniform float enableAA;\nuniform vec2 outputSize;\n#define SHADER_NAME bloomCombine\nvec2 c;\nvec3 d(const in vec3 e) {\n  return vec3(e.r < .0031308 ? e.r * 12.92 : 1.055 * pow(e.r, 1. / 2.4) - .055, e.g < .0031308 ? e.g * 12.92 : 1.055 * pow(e.g, 1. / 2.4) - .055, e.b < .0031308 ? e.b * 12.92 : 1.055 * pow(e.b, 1. / 2.4) - .055);\n}\nvec3 f(const in vec4 e, const in float h) {\n  if(h <= .0)\n    return e.rgb;\n  return h * e.rgb * e.a;\n}\nfloat i(const float j, const float k) {\n  return mix(j, k * 2. - j, bloomRadius);\n}\nvec4 l(sampler2D m, vec2 n) {\n  vec4 e;\n  mediump vec2 o = vec2(1. / outputSize.x, 1. / outputSize.y);\n  vec3 u = texture2D(m, (n + vec2(-1., -1.)) * o).xyz;\n  vec3 v = texture2D(m, (n + vec2(1., -1.)) * o).xyz;\n  vec3 A = texture2D(m, (n + vec2(-1., 1.)) * o).xyz;\n  vec3 B = texture2D(m, (n + vec2(1.)) * o).xyz;\n  vec4 C = texture2D(m, n * o);\n  vec3 D = C.xyz;\n  vec3 E = vec3(.299, .587, .114);\n  float F = dot(u, E);\n  float G = dot(v, E);\n  float H = dot(A, E);\n  float I = dot(B, E);\n  float J = dot(D, E);\n  float K = min(J, min(min(F, G), min(H, I)));\n  float L = max(J, max(max(F, G), max(H, I)));\n  mediump vec2 M;\n  M.x = -((F + G) - (H + I));\n  M.y = (F + H) - (G + I);\n  float N = max((F + G + H + I) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float O = 1. / (min(abs(M.x), abs(M.y)) + N);\n  M = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), M * O)) * o;\n  vec4 P = .5 * (texture2D(m, n * o + M * (1. / 3. - .5)) + texture2D(m, n * o + M * (2. / 3. - .5)));\n  vec4 Q = P * .5 + .25 * (texture2D(m, n * o + M * -.5) + texture2D(m, n * o + M * .5));\n  float R = dot(Q.xyz, E);\n  if(R < K || R > L)\n    e = P;\n  else\n    e = Q;\n  return e;\n}\nvec4 S() {\n  vec3 T = vec3(.0);\n  const float U = .6;\n  const float V = 1.1;\n  const float W = .9;\n  const float X = .6;\n  const float Y = .3;\n  const float Z = .1;\n  T += (vec4(f(texture2D(TextureBloomBlur1, c), rgbmRange), 1.)).rgb * i(V, U);\n  T += (vec4(f(texture2D(TextureBloomBlur2, c), rgbmRange), 1.)).rgb * i(W, U);\n  T += (vec4(f(texture2D(TextureBloomBlur3, c), rgbmRange), 1.)).rgb * i(X, U);\n  T += (vec4(f(texture2D(TextureBloomBlur4, c), rgbmRange), 1.)).rgb * i(Y, U);\n  T += (vec4(f(texture2D(TextureBloomBlur5, c), rgbmRange), 1.)).rgb * i(Z, U);\n  vec4 ba;\n  if(enableAA == 1.) {\n    ba = l(TextureInput, gl_FragCoord.xy);\n  } else {\n    ba = texture2D(TextureInput, c);\n  }\n  ba.rgb = mix(vec3(.0), ba.rgb, sign(ba.a));\n  vec4 bb = texture2D(TextureSource, c);\n#ifdef HAS_NOAA_TEX\nvec4 bc = texture2D(noAaTextureSource, c);\n  bb = bc + bb * (1. - bc.a);\n#endif\nvec4 bd = vec4(.0);\n#ifdef HAS_POINT_TEX\nbd = texture2D(pointTextureSource, c);\n#endif\nfloat be = sqrt((T.r + T.g + T.b) / 3.);\n  vec4 bf = vec4(d(T * bloomFactor), be);\n  return bd + (ba + bb * (1. - ba.a)) * (1. - bd.a) + bf;\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = S();\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:t}})}}}class Re$4 extends de$5{constructor(){const t=[];super({vert:ce$5,frag:"precision highp float;\n#include <gl2_frag>\n#define SHADER_NAME COPY_DEPTH\nuniform sampler2D TextureDepth;\nuniform vec2 textureSize;\n#include <common_pack_float>\nvoid main(void) {\n  vec2 c = gl_FragCoord.xy / textureSize.xy;\n  float d = texture2D(TextureDepth, c).r;\n  glFragColor = common_encodeDepth(d);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"textureSize",type:"function",fn:(e,n)=>(t[0]=n.TextureDepth.width,t[1]=n.TextureDepth.height,t)}],extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.TextureDepth.width,height:(t,e)=>e.TextureDepth.height}}}),this.version=300}getMeshCommand(t,e){return this.commands.copy_depth||(this.commands.copy_depth=this.createREGLCommand(t,null,e.getElements())),this.commands.copy_depth}}class Ie$4{static getUniformDeclares(){const t=[[0,0,0,0],[0,0,0,0]],n=new Array(16);return[{name:"invProjMatrix",type:"function",fn:(t,i)=>invert$2(n,i.projMatrix)},{name:"outputFovInfo",type:"array",length:2,fn:function(e,n){const r=Math.tan(.5*n.fov),o=n.outSize[0]/n.outSize[1]*r;return set$3(t[0],o,r,o,-r),set$3(t[1],-o,r,-o,-r),t}},{name:"reprojViewProjMatrix",type:"function",fn:(t,n)=>multiply$5([],n.prevProjViewMatrix,n.cameraWorldMatrix)}]}static getDefines(){return{HAS_SSR:1}}constructor(t){this._regl=t,this._renderer=new N$8(t),this._inputRGBM=0}setup(t){this._initShaders(),this._createTextures(t)}getSSRUniforms(t,e,n){if(!this._depthCopy)return null;const i=this._depthCopy;return{TextureDepth:i,TextureReflected:this.getMipmapTexture(),ssrFactor:e||1,ssrQuality:n||2,outSize:[i.width,i.height],fov:t.getFov()*Math.PI/180,prevProjViewMatrix:this._projViewMatrix||t.projViewMatrix,cameraWorldMatrix:t.cameraWorldMatrix}}genMipMap(t,n,i){return this.setup(t),this._mipmap(t),this.copyDepthTex(n),this._projViewMatrix||(this._projViewMatrix=[]),copy$5(this._projViewMatrix,i),delete this._depthCopied,this._outputTex}getPrevProjViewMatrix(){return this._projViewMatrix}copyDepthTex(t){return this._depthCopied?null:(this.setup(t),this._depthCopy?t.width===this._depthCopy.width&&t.height===this._depthCopy.height||this._depthCopyFBO.resize(t.width,t.height):(this._depthCopy=this._regl.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"uint8",width:t.width,height:t.height}),this._depthCopyFBO=this._regl.framebuffer({width:t.width,height:t.height,colors:[this._depthCopy],colorFormat:"rgba"})),this._renderer.render(this._copyDepthShader,{TextureDepth:t},null,this._depthCopyFBO),this._depthCopied=!0,this._depthCopy)}_mipmap(t){const e=this._targetFBO,n=Math.ceil(.5*t.width),i=Math.ceil(.5*t.height);e.width===n&&e.height===i||e.resize(n,i);let r=this._blurUniforms;r||(r=this._blurUniforms={rgbmRange:7,outputSize:[0,0]}),r.TextureInput=t,r.inputRGBM=+this._inputRGBM,set(r.outputSize,e.width,e.height),this._renderer.render(this._ssrQuadShader,r,null,e)}getMipmapTexture(){return this._outputTex||(this._outputTex=this._renderer.regl.texture({type:"uint8",width:2,height:2})),this._outputTex}dispose(){this._copyDepthShader&&(this._ssrQuadShader.dispose(),this._copyDepthShader.dispose(),this._targetFBO.destroy(),delete this._copyDepthShader),this._depthCopy&&(this._depthCopyFBO.destroy(),delete this._depthCopy,delete this._depthCopyFBO)}_initShaders(){this._copyDepthShader||(this._copyDepthShader=new Re$4,this._ssrQuadShader=new de$5({vert:ce$5,frag:"#version 100\nprecision mediump float;\nuniform sampler2D TextureInput;\nuniform vec2 outputSize;\n#define SHADER_NAME QUAD\nvec2 c;\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 d = texture2D(TextureInput, c.xy);\n  gl_FragColor = d;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.outputSize[0],height:(t,e)=>e.outputSize[1]}}}))}_createTextures(t){if(!this._targetFBO){const e=this._regl;this._outputTex&&this._outputTex.destroy(),this._outputTex=e.texture({min:"linear",mag:"linear",type:"uint8",width:t.width,height:t.height}),this._targetFBO=e.framebuffer({width:t.width,height:t.height,colors:[this._outputTex],depth:!1,stencil:!1})}}}class ke$4 extends ie$5{constructor(t){const n=[];super({vert:"#define SHADER_NAME HEATMAP\nfloat c(const vec2 d, const float t) {\n  return mix(d[0], d[1], t);\n}\nuniform mat4 projViewModelMatrix;\nuniform float extrudeScale;\nuniform float heatmapIntensity;\nattribute vec3 aPosition;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nuniform lowp float heatmapWeightT;\nattribute highp vec2 aWeight;\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\nuniform mediump float heatmapRadius;\nconst highp float e = 1. / 255. / 16.;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n  \n#ifdef HAS_HEAT_WEIGHT\nweight = c(aWeight, heatmapWeightT);\n#else\nhighp float f = heatmapWeight;\n#endif\nmediump float h = heatmapRadius;\n  vec2 i = vec2(mod(aPosition.xy, 2.) * 2. - 1.);\n  float j = sqrt(-2. * log(e / f / heatmapIntensity / GAUSS_COEF)) / 3.;\n  vExtrude = j * i;\n  vec2 k = vExtrude * h * extrudeScale;\n  vec4 l = vec4(floor(aPosition.xy * .5) + k, aPosition.z, 1);\n  gl_Position = projViewModelMatrix * l;\n}",frag:"#define SHADER_NAME HEATMAP\nprecision mediump float;\nuniform highp float heatmapIntensity;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n  \n#ifndef HAS_HEAT_WEIGHT\nhighp float c = heatmapWeight;\n#endif\nfloat d = -.5 * 3. * 3. * dot(vExtrude, vExtrude);\n  float e = c * heatmapIntensity * GAUSS_COEF * exp(d);\n  gl_FragColor = vec4(e, 1., 1., 1.);\n}",uniforms:[{name:"extrudeScale",type:"function",fn:function(t,e){return e.resolution/e.dataResolution*e.tileRatio}},{name:"projViewModelMatrix",type:"function",fn:function(t,i){return multiply$5(n,i.projViewMatrix,i.modelMatrix)}}],extraCommandProps:g$3({},t&&t.extraCommandProps||{},{blend:{enable:!0,func:{src:"one",dst:"one"},equation:"add"}})})}}var De$4=[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],Le$4="#define SHADER_NAME SKYBOX\n#if __VERSION__ == 100\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\nprecision highp float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\nvarying vec3 vWorldPos;\n#ifdef USE_AMBIENT\nuniform vec3 diffuseSPH[9];\n#else\nuniform samplerCube cubeMap;\nuniform float bias;\nuniform float size;\n#endif\nuniform float environmentExposure;\n#if defined(INPUT_RGBM) || defined(ENC_RGBM)\nuniform float rgbmRange;\n#endif\nvec4 c(const in vec3 d, const in float e) {\n  if(e <= .0)\n    return vec4(d, 1.);\n  vec4 f;\n  vec3 h = d / e;\n  f.a = clamp(max(max(h.r, h.g), max(h.b, 1e-6)), .0, 1.);\n  f.a = ceil(f.a * 255.) / 255.;\n  f.rgb = h / f.a;\n  return f;\n}\nvec3 i(const in vec4 d, const in float e) {\n  if(e <= .0)\n    return d.rgb;\n  return e * d.rgb * d.a;\n}\nvec4 j(const in samplerCube k, const in vec3 l, const in float m, const in float n) {\n  vec3 o = l;\n  return textureCubeLod(k, o, n);\n}\nvec3 u(const in vec3 v, const in vec3 A[9]) {\n  float x = v.x;\n  float y = v.y;\n  float z = v.z;\n  vec3 B = (A[0] + A[1] * x + A[2] * y + A[3] * z + A[4] * z * x + A[5] * y * z + A[6] * y * x + A[7] * (3. * z * z - 1.) + A[8] * (x * x - y * y));\n  return max(B, vec3(.0));\n}\nfloat C(const in vec2 D) {\n  vec3 E = fract(vec3(D.xyx) * .1031);\n  E += dot(E, E.yzx + 19.19);\n  return fract((E.x + E.y) * E.z);\n}\nvoid main() {\n  vec4 F;\n#ifdef USE_AMBIENT\nvec3 v = normalize(vWorldPos + mix(-.5 / 255., .5 / 255., C(gl_FragCoord.xy)) * 2.);\n  F = vec4(u(v, diffuseSPH), 1.);\n  if(length(hsv) > .0) {\n    F.rgb = hsv_apply(F.rgb, hsv);\n  }\n#else\nF = j(cubeMap, vWorldPos, size, bias);\n#endif\nF.rgb *= environmentExposure;\n#ifdef ENC_RGBM\n#if !defined(USE_AMBIENT) && defined(INPUT_RGBM)\nif(length(hsv) > .0) {\n    F.rgb = hsv_apply(i(F, rgbmRange).rgb, hsv);\n    F = c(F.rgb, rgbmRange);\n  }\n#else\nF = c(F.rgb, rgbmRange);\n#endif\nglFragColor = F;\n#elif !defined(USE_AMBIENT) && defined(INPUT_RGBM)\nglFragColor = vec4(i(F, rgbmRange), 1.);\n  if(length(hsv) > .0) {\n    glFragColor.rgb = hsv_apply(clamp(glFragColor.rgb, .0, 1.), hsv);\n  }\n#else\nif(length(hsv) > .0) {\n    F.rgb = hsv_apply(F.rgb, hsv);\n  }\n  glFragColor = F;\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}";class ze$4 extends ie$5{constructor(){super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 transformMatrix;\nvarying vec3 vWorldPos;\nvoid main() {\n  vWorldPos = aPosition;\n  mat4 c = mat4(mat3(viewMatrix) * transformMatrix);\n  vec4 d = projMatrix * c * vec4(vWorldPos, 1.);\n  gl_Position = d.xyww;\n}",frag:Le$4,extraCommandProps:{depth:{enable:!0,range:[1,1],func:"lequal"},viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}}),this.version=300}setMode(t,e,n){const i={};return t&&(i.INPUT_RGBM=1),e&&(i.ENC_RGBM=1),0===n&&(i.USE_AMBIENT=1),this._skyboxMesh?this._skyboxMesh[0].setDefines(i):this._meshDefines=i,this}draw(t){return this._skyboxMesh||this._createSkyboxMesh(t),super.draw(t,this._skyboxMesh)}_createSkyboxMesh(t){const e=new Q$7({aPosition:new Int8Array(De$4)},null,De$4.length/3);e.generateBuffers(t),this._skyboxMesh=[new ft$6(e)],this._meshDefines&&(this._skyboxMesh[0].setDefines(this._meshDefines),delete this._meshDefines)}dispose(){if(this._skyboxMesh){const t=this._skyboxMesh[0];t.geometry.dispose(),t.dispose()}return delete this._skyboxMesh,super.dispose()}}class Fe$4 extends ie$5{constructor(t,n){const i={blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},viewport:t};n&&n.extraCommandProps&&g$3(i,n.extraCommandProps);const r=[];super({vert:"#define SHADER_NAME HEATMAP_DISPLAY\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nvoid main() {\n  gl_Position = projViewModelMatrix * vec4(aPosition, 1.);\n}",frag:"#define SHADER_NAME HEATMAP_DISPLAY\nprecision mediump float;\nuniform sampler2D inputTexture;\nuniform sampler2D colorRamp;\nuniform vec2 textureOutputSize;\nuniform float heatmapOpacity;\nvoid main() {\n  vec2 c = gl_FragCoord.xy / textureOutputSize.xy;\n  float t = texture2D(inputTexture, c).r;\n  vec4 d = texture2D(colorRamp, vec2(t, .5));\n  gl_FragColor = d * heatmapOpacity;\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,n){return multiply$5(r,n.projViewMatrix,n.modelMatrix)}}],extraCommandProps:i})}}class He$4 extends de$5{constructor(){super({vert:ce$5,frag:"precision highp float;\nuniform sampler2D texture;\nuniform vec2 size;\nuniform float enableSharpen;\nuniform float sharpFactor;\nuniform float pixelRatio;\nvec2 c;\nvec3 d(const in vec3 e, const float f) {\n  vec2 h = pixelRatio / size.xy;\n  float i = .0;\n  vec4 j = texture2D(texture, c + h * vec2(-1., -1.));\n  j.rgb = mix(vec3(.0), j.rgb, sign(j.a));\n  i += mix(.0, 1., sign(j.a));\n  vec4 k = texture2D(texture, c + h * vec2(1.));\n  k.rgb = mix(vec3(.0), k.rgb, sign(k.a));\n  i += mix(.0, 1., sign(k.a));\n  vec4 l = texture2D(texture, c + h * vec2(1., -1.));\n  l.rgb = mix(vec3(.0), l.rgb, sign(l.a));\n  i += mix(.0, 1., sign(l.a));\n  vec4 m = texture2D(texture, c + h * vec2(-1., 1.));\n  m.rgb = mix(vec3(.0), m.rgb, sign(m.a));\n  i += mix(.0, 1., sign(m.a));\n  return e + f * (i * e - j.rgb - l.rgb - m.rgb - k.rgb);\n}\nvoid main() {\n  c = gl_FragCoord.xy / size;\n  vec4 e = texture2D(texture, c);\n  if(enableSharpen == 1.) {\n    e.rgb = d(e.rgb, sharpFactor);\n  }\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.size[0],height:(t,e)=>e.size[1]}}})}getMeshCommand(t,e){return this.commands.copy||(this.commands.copy=this.createREGLCommand(t,null,e.getElements())),this.commands.copy}}const Ne$4=[];class Be$4{constructor(t,e){this._regl=t,this._viewport=e,this._init()}_init(){this._shader=new ie$5({vert:"attribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nvarying vec4 vWorldPosition;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  vec4 e = modelMatrix * d * c;\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n  vWorldPosition = e;\n}",frag:"precision mediump float;\nvarying vec4 vWorldPosition;\nuniform vec2 fogDist;\nuniform vec3 cameraPosition;\nvoid main() {\n  vec3 c = vec3(vWorldPosition[0] - cameraPosition[0], vWorldPosition[1] - cameraPosition[1], vWorldPosition[2] - cameraPosition[2]);\n  float d = length(c);\n  float e = clamp(1. - (d - fogDist.x) / (fogDist.y - fogDist.x), .0, 1.);\n  if(vWorldPosition[2] < .01) {\n    gl_FragColor = vec4(e, .0, .0, 1.);\n  } else {\n    gl_FragColor = vec4(e, 1., .0, 1.);\n  }\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,n){return multiply$5(Ne$4,n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}}),this._fbo=this._regl.framebuffer({color:this._regl.texture({width:this._viewport.width(),height:this._viewport.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._scene=new yt$6,this.renderer=new N$8(this._regl)}render(t,e){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._scene.setMeshes(t),this.renderer.render(this._shader,{projMatrix:e.projMatrix,viewMatrix:e.viewMatrix,cameraPosition:e.cameraPosition,fogDist:e.fogDist},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const t=d$3(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,e=d$3(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===t&&this._fbo.height===e||this._fbo.resize(t,e)}}class Ge$4 extends de$5{constructor(){super({vert:ce$5,frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_RAIN\nuniform sampler2D ripplesMap;\n#endif\n#ifdef HAS_SNOW\nuniform sampler2D normalMap;\n#endif\n#ifdef HAS_FOG\nuniform vec3 fogColor;\n#endif\nuniform sampler2D sceneMap;\nuniform sampler2D mixFactorMap;\nuniform float time;\nuniform vec2 resolution;\nfloat c(float a, float b, float w) {\n  return a + w * (b - a);\n}\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\n#define HASHSCALE4 vec3(.1031, .1030, .0973, .1099)\nfloat d = .1;\nfloat e = .2;\nfloat f = .5;\nfloat h = 10.;\nfloat i(float p) {\n  vec3 j = fract(vec3(p) * HASHSCALE1);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.x + j.y) * j.z);\n}\nvec2 k(vec2 p) {\n  vec3 j = fract(vec3(p.xyx) * HASHSCALE3);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.xx + j.yz) * j.zy);\n}\nvec2 l(vec2 m) {\n  float x = fract(sin(dot(m.xy, vec2(122.9898, 783.233))) * 43758.5453);\n  float y = fract(sin(dot(m.xy, vec2(457.6537, 537.2793))) * 37573.5913);\n  return vec2(x, y);\n}\nvec3 n(vec2 o, float u) {\n  vec3 v = vec3(.0);\n  o = o * (2. + u);\n  float A = o.y * (((i(u) * 2. - 1.) * .5 + 1.) * e);\n  float B = (f * time);\n  o += vec2(A, B);\n  vec2 C = k(floor(o) + 31.1759 * u);\n  o = fract(o);\n  o -= (C * 2. - 1.) * .35;\n  o -= .5;\n  float r = length(o);\n  float D = .05 * (1. + .3 * sin(time * d));\n  float E = smoothstep(D, -D, r);\n  vec3 F = vec3(E) * C.x;\n  return F;\n}\nvec3 G() {\n  vec3 v = vec3(0);\n  vec2 o = gl_FragCoord.xy / resolution.xy;\n  o *= vec2(resolution.x / resolution.y, 1.);\n  for(float H = 0.; H < h; H++) {\n    v += n(o, H);\n  }\n  return v;\n}\nvec3 I(vec4 J, vec4 K, float L) {\n  float M = K.b;\n  vec3 N = vec3(1.);\n  if(L < 1.) {\n    float r = c(.5, N.x, M);\n    float g = c(.5, N.y, M);\n    float b = c(.5, N.z, M);\n    return vec3(r, g, b);\n  } else {\n    float r = c(J.r, N.x, M);\n    float g = c(J.g, N.y, M);\n    float b = c(J.b, N.z, M);\n    return vec3(r, g, b);\n  }\n}\nvoid main() {\n  vec4 J = texture2D(sceneMap, vTexCoord);\n  glFragColor = J;\n  vec4 O = texture2D(mixFactorMap, vTexCoord);\n#ifdef HAS_RAIN\nvec4 P = texture2D(ripplesMap, vTexCoord);\n  if(O.g < 1.) {\n    J = mix(J, P, .4);\n  }\n  glFragColor = J;\n#endif\n#ifdef HAS_SNOW\nvec3 Q = G();\n  glFragColor = vec4(J.rgb + Q, J.a);\n#endif\n#ifdef HAS_FOG\nfloat R = O.r;\n  vec3 S = mix(fogColor, glFragColor.rgb, R);\n  glFragColor = vec4(S, J.a);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}})}}const Ve$4=[],We$4=[.03,.03,.03],Ue$4=[],Ze$4=[],Xe$4=[],Je$4=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class qe$4{constructor(t,e){this._regl=t,this._viewport=e,this._init()}_init(){this._shader=new ie$5({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nvarying vec2 vTexCoord;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\nuniform float rippleRadius;\nuniform float density;\nuniform float time;\nvec3 c(vec2 p) {\n  vec3 q = vec3(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)), dot(p, vec2(419.2, 371.9)));\n  return fract(sin(q) * 43758.5453);\n}\nfloat d(in vec2 x) {\n  vec2 e = x * density / 4000.0;\n  vec2 p = floor(e);\n  vec2 f = fract(e);\n  float h = .0;\n  for(int i = -4; i <= 4; i++)\n    for(int k = -4; k <= 4; k++) {\n      vec2 g = vec2(float(k), float(i));\n      vec3 l = c(p + g);\n      vec2 r = g - f + l.xy;\n      float m = sqrt(dot(r, r));\n      float n = max(mix(smoothstep(.99, .999, max(cos(m - time * 2. + (l.x + l.y) * 5.), 0.)), 0., m), 0.);\n      h += n;\n    }\n  return h;\n}\nvoid main() {\n  vec2 u = vTexCoord;\n  float A = 24. / (rippleRadius * .01);\n  float f = d(A * u) * smoothstep(.0, .4, sin(u.x * 3.151592) * sin(u.y * 3.141592));\n  vec3 B = vec3(-dFdx(f), -dFdy(f), -dFdy(f));\n  glFragColor = vec4(B, 1.);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,n){return multiply$5(Ve$4,n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}}),this._shader.version=300,this._fbo=this._regl.framebuffer({color:this._regl.texture({width:this._viewport.width(),height:this._viewport.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._scene=new yt$6,this.renderer=new N$8(this._regl)}_transformRipples(t){const i=t.coordinateToPointAtRes(t.getCenter(),t.getGLRes());let r=t.getGLScale()/t.getGLScale(this._fixZoom);const o=set$4(Ze$4,r,r,r),a=multiply$4(o,We$4,o),h=identity$2(Xe$4);fromRotationTranslationScale(h,fromEuler(Ue$4,0,0,0),[i.x,i.y,0],a),multiply$5(h,h,Je$4),this._mesh.setLocalTransform(h)}_createRipplesMask(t){this._fixZoom=t.getZoom();const e=800*Math.pow(2,16.685648411389433-this._fixZoom),n={};n.POSITION=[-e,0,-e,e,0,-e,-e,0,e,e,0,e],n.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],n.TEXCOORD_0=[0,0,1,0,0,1,1,1];const i=new Q$7(n,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});i.generateBuffers(this._regl);const r=new tt$6;return new ft$6(i,r)}render(t,e){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._mesh=this._mesh||this._createRipplesMask(t),this._scene.setMeshes(this._mesh),this._transformRipples(t),this.renderer.render(this._shader,{projMatrix:e.projMatrix,viewMatrix:e.viewMatrix,time:e.time,rippleRadius:e.rippleRadius,density:e.density},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const t=d$3(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,e=d$3(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===t&&this._fbo.height===e||this._fbo.resize(t,e)}}var Ye$4,Ke$4="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Qe$4={exports:{}};Ye$4=Qe$4,function(t){var e,n,i="fulfilled",r="undefined",o=function(){var e=[],i=0;function o(){for(;e.length-i;){try{e[i]()}catch(e){t.console&&t.console.error(e)}e[i++]=n,1024==i&&(e.splice(0,1024),i=0)}}var s=function(){if(typeof MutationObserver===r)return typeof process!==r&&"function"==typeof process.nextTick?function(){process.nextTick(o)}:typeof setImmediate!==r?function(){setImmediate(o)}:function(){setTimeout(o,0)};var t=document.createElement("div");return new MutationObserver(o).observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}}();return function(t){e.push(t),e.length-i==1&&s()}}();function s(t){if(!(this instanceof s))throw new TypeError("Zousan must be created with the new keyword");if("function"==typeof t){var e=this;try{t((function(t){e.resolve(t)}),(function(t){e.reject(t)}))}catch(t){e.reject(t)}}else if(0<arguments.length)throw new TypeError("Zousan resolver "+t+" is not a function")}function a(t,e){if("function"==typeof t.y)try{var i=t.y.call(n,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.resolve(e)}function h(t,e){if("function"==typeof t.n)try{var i=t.n.call(n,e);t.p.resolve(i)}catch(e){t.p.reject(e)}else t.p.reject(e)}s.prototype={resolve:function(t){if(this.state===e){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var n=this;if(t&&("function"==typeof t||"object"==typeof t))try{var r=!0,s=t.then;if("function"==typeof s)return void s.call(t,(function(t){r&&(r=!1,n.resolve(t))}),(function(t){r&&(r=!1,n.reject(t))}))}catch(s){return void(r&&this.reject(s))}this.state=i,this.v=t,n.c&&o((function(){for(var e=0,i=n.c.length;e<i;e++)a(n.c[e],t)}))}},reject:function(n){if(this.state===e){var i=this;this.state="rejected",this.v=n;var r=this.c;o(r?function(){for(var t=0,e=r.length;t<e;t++)h(r[t],n)}:function(){i.handled||!s.suppressUncaughtRejectionError&&t.console&&s.warn("You upset Zousan. Please catch rejections: ",n,n?n.stack:null)})}},then:function(t,n){var r=new s,l={y:t,n,p:r};if(this.state===e)this.c?this.c.push(l):this.c=[l];else{var c=this.state,u=this.v;this.handled=!0,o((function(){c===i?a(l,u):h(l,u)}))}return r},catch:function(t){return this.then(null,t)},finally:function(t){return this.then(t,t)},timeout:function(t,e){e=e||"Timeout";var n=this;return new s((function(i,r){setTimeout((function(){r(Error(e))}),t),n.then((function(t){i(t)}),(function(t){r(t)}))}))}},s.resolve=function(t){var e=new s;return e.resolve(t),e},s.reject=function(t){var e=new s;return e.c=[],e.reject(t),e},s.all=function(t){var e=[],n=0,i=new s;function r(r,o){r&&"function"==typeof r.then||(r=s.resolve(r)),r.then((function(r){e[o]=r,++n==t.length&&i.resolve(e)}),(function(t){i.reject(t)}))}for(var o=0;o<t.length;o++)r(t[o],o);return t.length||i.resolve(e),i},s.warn=console.warn,Ye$4.exports&&(Ye$4.exports=s),t.define&&t.define.amd&&t.define([],(function(){return s})),(t.Zousan=s).soon=o}(Ke$4);var $e$4=Qe$4.exports,tn$4={exports:{}},en$4={exports:{}};en$4.exports=function(){function t(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function e(t,e){return t<e?-1:t>e?1:0}return function(n,i,r,o,s){!function e(n,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,h=i-r+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1);e(n,i,Math.max(r,Math.floor(i-h*c/a+u)),Math.min(o,Math.floor(i+(a-h)*c/a+u)),s)}var m=n[i],g=r,p=o;for(t(n,r,i),s(n[o],m)>0&&t(n,r,o);g<p;){for(t(n,g,p),g++,p--;s(n[g],m)<0;)g++;for(;s(n[p],m)>0;)p--}0===s(n[r],m)?t(n,r,p):t(n,++p,o),p<=i&&(r=p+1),i<=p&&(o=p-1)}}(n,i,r||0,o||n.length-1,s||e)}}(),tn$4.exports=rn$4,tn$4.exports.default=rn$4;var nn$4=en$4.exports;function rn$4(t,e){if(!(this instanceof rn$4))return new rn$4(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function on$4(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function sn$4(t,e){an$4(t,0,t.children.length,e,t)}function an$4(t,e,n,i,r){r||(r=gn$3(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],hn$3(r,t.leaf?i(o):o);return r}function hn$3(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function ln$3(t,e){return t.minX-e.minX}function cn$3(t,e){return t.minY-e.minY}function un$3(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function fn$3(t){return t.maxX-t.minX+(t.maxY-t.minY)}function dn$3(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function mn$3(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function gn$3(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function pn$3(t,e,n,i,r){for(var o,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=i||(o=e+Math.ceil((n-e)/i/2)*i,nn$4(t,o,e,n,r),s.push(e,o,o,n))}rn$4.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],i=this.toBBox;if(!mn$3(t,e))return n;for(var r,o,s,a,h=[];e;){for(r=0,o=e.children.length;r<o;r++)s=e.children[r],mn$3(t,a=e.leaf?i(s):s)&&(e.leaf?n.push(s):dn$3(t,a)?this._all(s,n):h.push(s));e=h.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!mn$3(t,e))return!1;for(var i,r,o,s,a=[];e;){for(i=0,r=e.children.length;i<r;i++)if(o=e.children[i],mn$3(t,s=e.leaf?n(o):o)){if(e.leaf||dn$3(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=gn$3([]),this},remove:function(t,e){if(!t)return this;for(var n,i,r,o,s=this.data,a=this.toBBox(t),h=[],l=[];s||h.length;){if(s||(s=h.pop(),i=h[h.length-1],n=l.pop(),o=!0),s.leaf&&-1!==(r=on$4(t,s.children,e)))return s.children.splice(r,1),h.push(s),this._condense(h),this;o||s.leaf||!dn$3(s,a)?i?(n++,s=i.children[n],o=!1):s=null:(h.push(s),l.push(n),n=0,i=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:ln$3,compareMinY:cn$3,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,i){var r,o=n-e+1,s=this._maxEntries;if(o<=s)return sn$4(r=gn$3(t.slice(e,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),(r=gn$3([])).leaf=!1,r.height=i;var a,h,l,c,u=Math.ceil(o/s),f=u*Math.ceil(Math.sqrt(s));for(pn$3(t,e,n,f,this.compareMinX),a=e;a<=n;a+=f)for(pn$3(t,a,l=Math.min(a+f-1,n),u,this.compareMinY),h=a;h<=l;h+=u)c=Math.min(h+u-1,l),r.children.push(this._build(t,h,c,i-1));return sn$4(r,this.toBBox),r},_chooseSubtree:function(t,e,n,i){for(var r,o,s,a,h,l,c,u,f,d;i.push(e),!e.leaf&&i.length-1!==n;){for(c=u=1/0,r=0,o=e.children.length;r<o;r++)h=un$3(s=e.children[r]),f=t,d=s,(l=(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-h)<u?(u=l,c=h<c?h:c,a=s):l===u&&h<c&&(c=h,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var i=n?t:(0,this.toBBox)(t),r=[],o=this._chooseSubtree(i,this.data,e,r);for(o.children.push(t),hn$3(o,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)},_split:function(t,e){var n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var o=this._chooseSplitIndex(n,r,i),s=gn$3(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,sn$4(n,this.toBBox),sn$4(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=gn$3([t,e]),this.data.height=t.height+1,this.data.leaf=!1,sn$4(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var i,r,o,s,a,h,l,c,u,f,d,m,g,p;for(h=l=1/0,i=e;i<=n-e;i++)u=r=an$4(t,0,i,this.toBBox),f=o=an$4(t,i,n,this.toBBox),void 0,void 0,void 0,void 0,d=Math.max(u.minX,f.minX),m=Math.max(u.minY,f.minY),g=Math.min(u.maxX,f.maxX),p=Math.min(u.maxY,f.maxY),s=Math.max(0,g-d)*Math.max(0,p-m),a=un$3(r)+un$3(o),s<h?(h=s,c=i,l=a<l?a:l):s===h&&a<l&&(l=a,c=i);return c},_chooseSplitAxis:function(t,e,n){var i=t.leaf?this.compareMinX:ln$3,r=t.leaf?this.compareMinY:cn$3;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)},_allDistMargin:function(t,e,n,i){t.children.sort(i);var r,o,s=this.toBBox,a=an$4(t,0,e,s),h=an$4(t,n-e,n,s),l=fn$3(a)+fn$3(h);for(r=e;r<n-e;r++)o=t.children[r],hn$3(a,t.leaf?s(o):o),l+=fn$3(a);for(r=n-e-1;r>=e;r--)o=t.children[r],hn$3(h,t.leaf?s(o):o),l+=fn$3(h);return l},_adjustParentBBoxes:function(t,e,n){for(var i=n;i>=0;i--)hn$3(e[i],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():sn$4(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var _n$3=tn$4.exports,vn$3={exports:{}};!function(t){!function(){function e(t,e,n){var i=e.x,r=e.y,o=n.x-i,s=n.y-r;if(0!==o||0!==s){var a=((t.x-i)*o+(t.y-r)*s)/(o*o+s*s);a>1?(i=n.x,r=n.y):a>0&&(i+=o*a,r+=s*a)}return(o=t.x-i)*o+(s=t.y-r)*s}function n(t,n){var i=t.length-1,r=[t[0]];return function t(n,i,r,o,s){for(var a,h=o,l=i+1;l<r;l++){var c=e(n[l],n[i],n[r]);c>h&&(a=l,h=c)}h>o&&(a-i>1&&t(n,i,a,o,s),s.push(n[a]),r-a>1&&t(n,a,r,o,s))}(t,0,i,n,r),r.push(t[i]),r}function i(t,e,i){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return n(t=i?t:function(t,e){for(var n,i,r,o,s,a=t[0],h=[a],l=1,c=t.length;l<c;l++)void 0,void 0,(o=(i=n=t[l]).x-(r=a).x)*o+(s=i.y-r.y)*s>e&&(h.push(n),a=n);return a!==n&&h.push(n),h}(t,r),r)}t.exports=i,t.exports.default=i}()}(vn$3);for(var yn$3=vn$3.exports,xn$3=[],bn$3=0
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/;bn$3<6;bn$3++)xn$3[bn$3]=[];var wn$3=[];function Cn$3(t,e,n){var i,r,o,s,a,h,l,c,u,f,d,m,g,p,_,v,y;o=(i=t)[1],s=i[2],l=i[5],c=i[6],d=i[9],m=i[10],_=i[13],v=i[14],Mn$3(xn$3[0],(a=i[3])-(r=i[0]),(u=i[7])-(h=i[4]),(g=i[11])-(f=i[8]),(y=i[15])-(p=i[12])),Mn$3(xn$3[1],a+r,u+h,g+f,y+p),Mn$3(xn$3[2],a+o,u+l,g+d,y+_),Mn$3(xn$3[3],a-o,u-l,g-d,y-_),Mn$3(xn$3[4],a-s,u-c,g-m,y-v),Mn$3(xn$3[5],a+s,u+c,g+m,y+v);for(var x=0;x<6;x++)if(!n||"0"!==n.charAt(x)){var b=xn$3[x];if(wn$3[0]=b[0]>0?e[1][0]:e[0][0],wn$3[1]=b[1]>0?e[1][1]:e[0][1],wn$3[2]=b[2]>0?e[1][2]:e[0][2],Tn$3(b,wn$3)<0)return!1}return!0}function Mn$3(t,e,n,i,r){return t[0]=e*(1/6),t[1]=n*(1/6),t[2]=i*(1/6),t[3]=r*(1/6),t}function Tn$3(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}
/*!
	 * maptalks v1.0.0-rc.18
	 * LICENSE : BSD-3-Clause
	 * (c) 2016-2023 maptalks.org
	 */var Sn$3=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],Pn$3=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(Sn$3),An$4=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],En$3=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],On$3={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},Rn$3=["lineColor","polygonFill","markerFill","markerLineColor","textFill"];function In$3(){return Date.now()}function kn$3(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function Dn$3(t){return null==t}function Ln$3(t){return"number"==typeof t&&!isNaN(t)}function zn$3(t){return(0|t)===t}function Fn$3(t){return"object"==typeof t&&!!t}function jn$3(t){return!Dn$3(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function Hn$3(t){return!Dn$3(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}var Nn$3=Object.prototype.hasOwnProperty;function Bn$3(t,e){return Nn$3.call(t,e)}var Gn$3=Math.PI/180;function Vn$3(t){return t*Gn$3}function Wn$3(t){return t/Gn$3}var Un$3="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"],Zn$3={},Xn$3={};function Jn$3(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!Un$3){var qn$3=navigator.userAgent.toLowerCase(),Yn$3=document.documentElement,Kn$3="ActiveXObject"in window,Qn$3=-1!==qn$3.indexOf("webkit"),$n$3=-1!==qn$3.indexOf("phantom"),ti$4=-1!==qn$3.search("android [23]"),ei$4=-1!==qn$3.indexOf("chrome"),ni$4=-1!==qn$3.indexOf("gecko")&&!Qn$3&&!window.opera&&!Kn$3,ii$4=/iphone/i.test(qn$3)&&/micromessenger/i.test(qn$3),ri$4="undefined"!=typeof orientation||-1!==qn$3.indexOf("mobile"),oi$4=!window.PointerEvent&&window.MSPointerEvent,si$4=window.PointerEvent&&navigator.pointerEnabled||oi$4,ai$4=Kn$3&&"transition"in Yn$3.style,hi$4="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ti$4,li$4="MozPerspective"in Yn$3.style,ci$4="OTransition"in Yn$3.style,ui$4=(ai$4||hi$4||li$4)&&!ci$4&&!$n$3,fi$4="undefined"!=typeof window&&Hn$3(window.createImageBitmap),di$4="undefined"!=typeof window&&Hn$3(window.ResizeObserver),mi$4="undefined"!=typeof window&&Hn$3(window.btoa),gi$4="undefined"!=typeof window&&Hn$3(window.Proxy),pi$4=0;ei$4&&(pi$4=qn$3.match(/chrome\/([\d.]+)/)[1]);var _i$4=!$n$3&&(si$4||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),vi$4="undefined"!=typeof window&&"WebGLRenderingContext"in window,yi$4=Jn$3(),xi$4=!1;try{new OffscreenCanvas(2,2).getContext("2d"),xi$4=!0}catch(t){xi$4=!1}var bi$4=!1;try{window.addEventListener("testPassive",(function(){}),{get passive(){bi$4=!0}})}catch(t){}if(Zn$3={ie:Kn$3,ielt9:Kn$3&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:Qn$3,gecko:ni$4,android:-1!==qn$3.indexOf("android"),android23:ti$4,chrome:ei$4,chromeVersion:pi$4,safari:!ei$4&&-1!==qn$3.indexOf("safari"),phantomjs:$n$3,ie3d:ai$4,webkit3d:hi$4,gecko3d:li$4,opera12:ci$4,any3d:ui$4,iosWeixin:ii$4,mobile:ri$4,mobileWebkit:ri$4&&Qn$3,mobileWebkit3d:ri$4&&hi$4,mobileOpera:ri$4&&window.opera,mobileGecko:ri$4&&ni$4,touch:!!_i$4,msPointer:!!oi$4,pointer:!!si$4,retina:yi$4>1,devicePixelRatio:yi$4,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:Kn$3&&9===document.documentMode,ie10:Kn$3&&10===document.documentMode,webgl:vi$4,imageBitMap:fi$4,resizeObserver:di$4,btoa:mi$4,decodeImageInWorker:xi$4,monitorDPRChange:!0,supportsPassive:bi$4,proxy:gi$4,removeDPRListening:function(t){t&&delete Xn$3[t.id]},checkDevicePixelRatio:function(){if("undefined"!=typeof window&&Zn$3.monitorDPRChange){var t=Jn$3(),e=t!==Zn$3.devicePixelRatio;return e&&(Zn$3.devicePixelRatio=t),e}return!1},addDPRListening:function(t){t&&(Xn$3[t.id]=t)}},"undefined"!=typeof window&&window.matchMedia)for(var wi$4=1;wi$4<500;wi$4++){var Ci$4=(.01*wi$4).toFixed(2),Mi$4=window.matchMedia("screen and (resolution: "+Ci$4+"dppx)");Mi$4&&(Mi$4.addEventListener?Mi$4.addEventListener("change",Zn$3.checkDevicePixelRatio):Mi$4.addListener&&Mi$4.addListener(Zn$3.checkDevicePixelRatio))}if(Zn$3.devicePixelRatio){var Ti$4=Zn$3.devicePixelRatio;Object.defineProperty(Zn$3,"devicePixelRatio",{get:function(){return Ti$4},set:function(t){if(t!==Ti$4&&(Ti$4=t,Zn$3.monitorDPRChange))for(var e in Xn$3){var n=Xn$3[e];n&&n.options&&!n.options.devicePixelRatio&&n.checkSize&&n.getRenderer&&n.getRenderer()&&n.checkSize(!0)}}})}}var Si$4=Zn$3;function Pi$4(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Ai$4(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var Ei$4,Oi$4,Ri$4=function(){function t(t,e,n){if(Dn$3(t)||Dn$3(e)?Dn$3(t.x)||Dn$3(t.y)?Array.isArray(t)&&(this.x=+t[0],this.y=+t[1],this.z=t[2]):(this.x=+t.x,this.y=+t.y,this.z=t.z):(this.x=+t,this.y=+e,this.z=n),this._isNaN())throw new Error("Position is NaN")}var e=t.prototype;return e.set=function(t,e,n){return this.x=t,this.y=e,this.z=n||0,this},e.abs=function(){return new this.constructor(Math.abs(this.x),Math.abs(this.y))},e._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.round=function(){return new this.constructor(Math.round(this.x),Math.round(this.y))},e._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.ceil=function(){return new this.constructor(Math.ceil(this.x),Math.ceil(this.y))},e.distanceTo=function(t){var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},e.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.floor=function(){return new this.constructor(Math.floor(this.x),Math.floor(this.y))},e.copy=function(){return new this.constructor(this.x,this.y,this.z)},e._add=function(t,e){return Dn$3(t.x)?Dn$3(t[0])?(this.x+=t,this.y+=e):(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},e.add=function(t,e){var n,i;return Dn$3(t.x)?Dn$3(t[0])?(n=this.x+t,i=this.y+e):(n=this.x+t[0],i=this.y+t[1]):(n=this.x+t.x,i=this.y+t.y),new this.constructor(n,i)},e._sub=function(t,e){return Dn$3(t.x)?Dn$3(t[0])?(this.x-=t,this.y-=e):(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(t,e){var n,i;return Dn$3(t.x)?Dn$3(t[0])?(n=this.x-t,i=this.y-e):(n=this.x-t[0],i=this.y-t[1]):(n=this.x-t.x,i=this.y-t.y),new this.constructor(n,i)},e.substract=function(){return this.sub.apply(this,arguments)},e.multi=function(t){return new this.constructor(this.x*t,this.y*t)},e._multi=function(t){return this.x*=t,this.y*=t,this},e.div=function(t){return this.multi(1/t)},e._div=function(t){return this._multi(1/t)},e.equals=function(t){return t instanceof this.constructor&&this.x===t.x&&this.y===t.y&&this.z===t.z},e._isNaN=function(){return isNaN(this.x)||isNaN(this.y)},e.isZero=function(){return 0===this.x&&0===this.y},e.toArray=function(){return Ln$3(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},e.toFixed=function(t){return new this.constructor(this.x.toFixed(t),this.y.toFixed(t))},e.toJSON=function(){return{x:this.x,y:this.y}},t}(),Ii$4=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},n.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.unit=function(){return this.copy()._unit()},n._unit=function(){return this._div(this.mag()),this},n.perp=function(){return this.copy()._perp()},n._perp=function(){var t=this.y;return this.y=this.x,this.x=-t,this},n.angleWith=function(t){return this.angleWithSep(t.x,t.y)},n.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},n._rotate=function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},n.rotate=function(t){return this.copy()._rotate(t)},e}(Ri$4);function ki$4(t){return t.length>4&&".svg"===t.slice(-4)?1:"data:image/svg+xml"===t.slice(0,"data:image/svg+xml".length)?2:0}function Di$4(t,e){Un$3&&Di$4.node?Di$4.node(t,e):t.src=e[0]}!function(){if(Un$3)return Ei$4=function(t){return setTimeout(t,16)},void(Oi$4=clearTimeout);var t,e;function n(t){return setTimeout(t,1e3/30)}function i(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}"undefined"!=typeof window?(t=window.requestAnimationFrame||i("RequestAnimationFrame")||n,e=window.cancelAnimationFrame||i("CancelAnimationFrame")||i("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(t=n,e=clearTimeout),Ei$4=function(e){return t(e)},Oi$4=function(t){t&&e(t)}}();var Li$4=0;function zi$4(){return Li$4++}var Fi$4=zi$4;function ji$4(t){return t&&jn$3(t)?JSON.parse(t):t}function Hi$4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];if(n)for(var i=0,r=n.length;i<r;i++)t.push(n[i])}return t.length}function Ni$4(t,e){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function Bi$4(t,e,n){if(!Array.isArray(t))return n?e.call(n,t):e(t);for(var i,r,o=[],s=0,a=t.length;s<a;s++)Dn$3(i=t[s])?o.push(null):Array.isArray(i)?o.push(Bi$4(i,e,n)):(r=n?e.call(n,i):e(i),o.push(r));return o}function Gi$4(t,e){return void 0===t?e:t}function Vi$4(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}function Wi$4(t){if(Math.log2)return Math.log2(t);var e=Math.log(t)*Math.LOG2E,n=Math.round(e);return Math.abs(n-e)<1e-14?n:e}function Ui$4(t,e,n){return t*(1-n)+e*n}function Zi$4(t,e,n){if(t===n||t===e)return t;var i=n-e;return((t-e)%i+i)%i+e}function Xi$4(t,e,n){return Math.min(n,Math.max(e,t))}function Ji$4(t){return Array.isArray(t)&&t.length>0}var qi$4=/^([a-z][a-z\d+\-.]*:)?\/\//i,Yi$4=/^url\((['"])(.+)\1\)$/i,Ki$4=/^url\(([^'"].*[^'"])\)$/i;function Qi$4(t){return jn$3(t)?Ki$4.test(t)?1:Yi$4.test(t)?2:3:0}function $i$4(t){var e=Qi$4(t);return 3===e?t:1===e?Ki$4.exec(t)[1]:2===e?Yi$4.exec(t)[2]:t}function tr$4(t){if(Si$4.btoa)return window.btoa(t);for(var e,n,i=String(t),r="",o=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.charAt(0|o)||(s="=",o%1);r+=s.charAt(63&e>>8-o%1*8)){if((n=i.charCodeAt(o+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|n}return r}function er$4(t,e){for(var n=atob(t),i=new ArrayBuffer(n.length),r=new Uint8Array(i),o=0;o<n.length;o++)r[o]=255&n.charCodeAt(o);return new Blob([i],{type:e})}function nr$4(t,e,n,i){return Math.atan2(i-e,n-t)}var ir$4="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function rr$4(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;for(var n in t)if("center"===n){if(!e[n]||!or$4(t[n][0],e[n][0])||!or$4(t[n][1],e[n][1]))return!1}else if(t[n]!==e[n])return!1;return!0}function or$4(t,e,n){return null==n&&(n=1e-6),t>=e-n&&t<=e+n}function sr$4(t,e,n,i){t||(t=100),e||(e=4);var r=this,o=this.isVisible();return e*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout((function s(){if(0===e)return o?r.show():r.hide(),void(n&&(i?n.call(i):n()));e%2==0?r.hide():r.show(),e--,r._flashTimeout=setTimeout(s,t)}),t),this}function ar$4(t,e){void 0===t&&(t=[]),void 0===e&&(e="_pt");for(var n=[],i=0,r=t.length;i<r;i++){var o=t[i];if(o){o[e]||(o[e]=new Ii$4(0,0));var s=o[e];s.x=0,s.y=0,n.push(s)}else n.push(null)}return n}function hr$4(t,e){e(t.data)}function lr$4(t){if(t&&0===t.indexOf("http://")||0===t.indexOf("https://"))return t;var e=document.createElement("a");return e.href=t,t=e.href,e=null,t}var cr$4,ur$4={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function fr$4(t,e){void 0===e&&(e=1);var n=t.width,i=t.height;return ur$4.cssWidth=n+"px",ur$4.cssHeight=i+"px",ur$4.width=Math.round(n*e),ur$4.height=Math.round(i*e),ur$4}var dr$4={width:100,height:10};var gr$4,pr$4=function(){function t(t,e){if(void 0===e&&(e={}),Array.isArray(t))if(t.length<2)console.error("colors.length should >1");else{this.colors=t;for(var n=1/0,i=-1/0,r=0,o=t.length;r<o;r++){var s=t[r][0];n=Math.min(s,n),i=Math.max(s,i)}this.min=n,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},dr$4,e),this._initImgData()}else console.error("colors is not array")}var e=t.prototype;return e.getImageData=function(){return this.imgData},e._initImgData=function(){var t=function(){if(!cr$4){var t=dr$4.width,e=dr$4.height;OffscreenCanvas?cr$4=new OffscreenCanvas(t,e):((cr$4=document.createElement("canvas")).width=t,cr$4.height=e)}return cr$4}(),e=this.options,n=e.height;t.width=e.width,t.height=n;var i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);for(var r=i.createLinearGradient(0,0,t.width,0),o=this.colors,s=this.valueOffset,a=0,h=o.length;a<h;a++){var l=o[a];r.addColorStop((l[0]-this.min)/s,l[1])}i.fillStyle=r,i.fillRect(0,0,t.width,t.height),this.imgData=i.getImageData(0,0,t.width,t.height)},e.getColor=function(t){t=Math.max(this.min,t),t=Math.min(t,this.max);var e=Math.round((t-this.min)/this.valueOffset*this.imgData.width),n=4*(e=Math.min(e,this.imgData.width-1));return[this.imgData.data[n],this.imgData.data[n+1],this.imgData.data[n+2],this.imgData.data[n+3]]},t}();function _r$4(t,e){for(var n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.default}function vr$4(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function yr$4(t,e){for(var n=void 0!==t.base?t.base:1,i=0;!(i>=t.stops.length||e<=t.stops[i][0]);)i++;return 0===i?t.stops[i][1]:i===t.stops.length?t.stops[i-1][1]:function t(e,n,i,r,o,s){return"function"==typeof o?function(){var a=o.apply(void 0,arguments),h=s.apply(void 0,arguments);return t(e,n,i,r,a,h)}:o.length?function(t,e,n,i,r,o){for(var s=[],a=0;a<r.length;a++)s[a]=Cr$4(t,e,n,i,r[a],o[a]);return s}(e,n,i,r,o,s):Cr$4(e,n,i,r,o,s)}(e,n,t.stops[i-1][0],t.stops[i][0],t.stops[i-1][1],t.stops[i][1])}"function"==typeof Map&&(gr$4=new Map);var xr$4={width:100,height:1};function br$4(t,e){var n=t.stops;if(n&&n.length>1){var i;if(gr$4){var r=JSON.stringify(n);if(!gr$4.has(r)){var o=new pr$4(n,xr$4);gr$4.set(r,o)}i=gr$4.get(r)}else i=new pr$4(n,xr$4);var s=i.getColor(e);return[s[0]/255,s[1]/255,s[2]/255,s[3]/255]}return n&&1===n.length?n[0][1]:null}function wr$4(t,e){return i=t.default,void 0!==(n=e)?n:void 0!==i?i:null;var n,i}function Cr$4(t,e,n,i,r,o){var s,a=i-n,h=t-n;return r*(1-(s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)))+o*s}function Mr$4(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function Tr$4(t){for(var e in t)if(Mr$4(t[e]))return!0;return!1}function Sr$4(t){return function t(e,n){if(!Mr$4(e))return function(){return e};var i=!0,r=!0,o=(e=JSON.parse(JSON.stringify(e))).stops;if(o)for(var s=0;s<o.length;s++)if(Mr$4(o[s][1])){var a=t(o[s][1],n);i=i&&a.isZoomConstant,r=r&&a.isFeatureConstant,o[s]=[o[s][0],a]}var h=function t(e,n){var i,r,o;if(Mr$4(e)){var s,a=e.stops&&"object"==typeof e.stops[0][0],h=a||!(a||void 0!==e.property),l=e.type||n||"exponential";if("exponential"===l)s=yr$4;else if("interval"===l)s=vr$4;else if("categorical"===l)s=_r$4;else if("identity"===l)s=wr$4;else{if("color-interpolate"!==l)throw new Error('Unknown function type "'+l+'"');s=br$4}if(a){for(var c={},u=[],f=0;f<e.stops.length;f++){var d=e.stops[f];void 0===c[d[0].zoom]&&(c[d[0].zoom]={zoom:d[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),c[d[0].zoom].stops.push([d[0].value,d[1]])}for(var m in c)u.push([c[m].zoom,t(c[m])]);i=function(t,n){var i=yr$4({stops:u,base:e.base},t)(t,n);return"function"==typeof i?i(t,n):i},r=!1,o=!1}else h?(i=function(t){var n=s(e,t);return"function"==typeof n?n(t):n},r=!0,o=!1):(i=function(t,n){var i=s(e,n?n[e.property]:null);return"function"==typeof i?i(t,n):i},r=!1,o=!0)}else i=function(){return e},r=!0,o=!0;return i.isZoomConstant=o,i.isFeatureConstant=r,i}(e,n);return h.isZoomConstant=i&&h.isZoomConstant,h.isFeatureConstant=r&&h.isFeatureConstant,h}(t,"exponential")}function Pr$4(t,e){if(!t)return null;var n=!1;if(Array.isArray(t)){for(var i,r=[],o=0;o<t.length;o++)(i=Pr$4(t[o],e))?(r.push(i),n=!0):r.push(t[o]);return n?r:t}var s,a={__fn_types_loaded:!0},h=[];for(s in t)t.hasOwnProperty(s)&&h.push(s);for(var l=function(t){Object.defineProperty(a,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=Sr$4(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},c=0,u=h.length;c<u;c++)Mr$4(t[s=h[c]])?(n=!0,a["_"+s]=t[s],l(s)):a[s]=t[s];return n?a:t}function Ar$4(t){if(!t||!t.stops)return[];for(var e=[],n=0,i=t.stops.length;n<i;n++)e.push(t.stops[n][1]);return e}var Er$4=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Or$4(t){return new Function("f","var p = (f && f.properties || {}); return "+Rr$4(t))}function Rr$4(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?kr$4(t[1],t[2],"===",!1):"!="===e?kr$4(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?kr$4(t[1],t[2],e,!0):"any"===e?Lr$4(t.slice(1),"||"):"all"===e?Lr$4(t.slice(1),"&&"):"none"===e?jr$4(Lr$4(t.slice(1),"||")):"in"===e?zr$4(t[1],t.slice(2)):"!in"===e?jr$4(zr$4(t[1],t.slice(2))):"has"===e?Fr$4(t[1]):"!has"===e?jr$4(Fr$4(t[1])):"contains"===e?function(t,e,n){var i=Ir$4(t);return void 0!==n?"("+i+" + '').indexOf(\""+e+'") === '+n:"("+i+" + '').indexOf(\""+e+'") >= 0'}(t[1],t[2],t[3]):"true")+")"}function Ir$4(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function kr$4(t,e,n,i){return"object"==typeof(r=t)&&r&&t.op?function(t,e,n,i){var r=t.property,o=t.op,s=Ir$4(r);return"length"!==o?(console.error("not support "+o+" op"),"false"):Dr$4(s="(("+s+"+='').length)",r,e,n,i)}(t,e,n,i):Dr$4(Ir$4(t),t,e,n,i);var r}function Dr$4(t,e,n,i,r){var o="$type"===e?Er$4.indexOf(n):JSON.stringify(n);return(r?"typeof "+t+"=== typeof "+o+"&&":"")+t+i+o}function Lr$4(t,e){return t.map(Rr$4).join(e)}function zr$4(t,e){"$type"===t&&(e=e.map((function(t){return Er$4.indexOf(t)})));var n=JSON.stringify(e.sort(Hr$4)),i=Ir$4(t);return e.length<=200?n+".indexOf("+i+") !== -1":"function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }("+i+", "+n+",0,"+(e.length-1)+")"}function Fr$4(t){return"$id"===t?'"id" in f':JSON.stringify(t)+" in p"}function jr$4(t){return"!("+t+")"}function Hr$4(t,e){return t<e?-1:t>e?1:0}function Nr$4(t){var e=t._toJSON(),n=e.feature;return n.type=Er$4.indexOf(n.geometry.type),n.subType=e.subType,n}function Br$4(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}var Gr$4=[],Vr$4={};function Wr$4(t,e){return Pr$4(t,(function(){var t=e.getMap();return function(t,e,n){return t[0]=e,t[1]=n,t}(Gr$4,t?t.getZoom():12,kn$3({},e.getProperties(),function(t,e,n,i){return t["{bearing}"]=e,t["{pitch}"]=n,t["{zoom}"]=i,t}(Vr$4,t&&t.getBearing()||0,t&&t.getPitch()||0,t?t.getZoom():10)))}))}function Ur$4(t){var e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}function Zr$4(t,e,n){if(!t.markerPath)return null;var i=1,r=Ur$4(t);Ln$3(t.markerOpacity)&&(i=t.markerOpacity),Ln$3(t.opacity)&&(i*=t.opacity);var o={};if(r){for(var s in r.stroke)r.stroke.hasOwnProperty(s)&&(Dn$3(r.stroke[s])||(o[s]=r.stroke[s]));for(var a in r.fill)r.fill.hasOwnProperty(a)&&(Dn$3(r.fill[a])||(o[a]=r.fill[a]))}for(var h,l=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath],c=[],u=0;u<l.length;u++)(h=kn$3({},h=jn$3(l[u])?{path:l[u]}:l[u],o)).d=h.path,delete h.path,c.push(h);var f=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];i<1&&f.push('opacity="'+i+'"'),t.markerPathWidth&&t.markerPathHeight&&f.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),f.push('preserveAspectRatio="none"'),e&&f.push('width="'+e+'"'),n&&f.push('height="'+n+'"'),f.push("><defs></defs>");for(var d=0;d<c.length;d++){var m="<path ";for(var g in c[d])c[d].hasOwnProperty(g)&&(m+=" "+g+'="'+c[d][g]+'"');f.push(m+="></path>")}return f.push("</svg>"),"data:image/svg+xml;base64,"+tr$4(f.join(" "))}function Xr$4(t,e){if(!t)return[];var n=t;Array.isArray(t)||(n=[t]);for(var i,r,o,s,a=[],h=An$4,l=n.length-1;l>=0;l--)if(t=n[l]){e&&(t=Jr$4(t));for(var c=0;c<h.length;c++)if(Mr$4(i=t[h[c]])&&(i=Ar$4(i)),i){Array.isArray(i)||(i=[i]);for(var u=0;u<i.length;u++)"url("===i[u].slice(0,4)&&(i[u]=$i$4(i[u])),a.push([i[u],t[(r=En$3[c])[0]],t[r[1]]])}if("path"===t.markerType&&t.markerPath)if(o=Mr$4(t.markerWidth)?200:t.markerWidth,s=Mr$4(t.markerHeight)?200:t.markerHeight,Mr$4(t.markerPath)){i=Ar$4(t.markerPath);for(var f=t.markerPath,d=0;d<i.length;d++)t.markerPath=i[d],a.push([Zr$4(t),o,s]);t.markerPath=f}else a.push([Zr$4(t),o,s])}return a}function Jr$4(t){if(!t)return null;var e=t;if(Un$3)return e;for(var n,i=An$4,r=0,o=i.length;r<o;r++)(n=e[i[r]])&&(e[i[r]]=qr$4(n));return e}function qr$4(t){if(Mr$4(t)){for(var e=t.stops,n=0;n<e.length;n++)e[n][1]=qr$4(e[n][1]);return t}return"url("===t.slice(0,4)&&(t=$i$4(t)),t}var Yr$4=function(){function t(t,e){Ln$3(t)&&Ln$3(e)?(this.width=t,this.height=e):Ln$3(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}var e=t.prototype;return e.copy=function(){return new t(this.width,this.height)},e.add=function(e,n){var i,r;return e instanceof t?(i=this.width+e.width,r=this.height+e.height):(i=this.width+e,r=this.height+n),new t(i,r)},e.equals=function(t){return this.width===t.width&&this.height===t.height},e.multi=function(e){return new t(this.width*e,this.height*e)},e._multi=function(t){return this.width*=t,this.height*=t,this},e._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},e.toPoint=function(){return new Ii$4(this.width,this.height)},e.toArray=function(){return[this.width,this.height]},e.toJSON=function(){return{width:this.width,height:this.height}},t}();function Kr$4(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}var Qr$4=/[\b\t\r\v\f]/gim;function $r$4(t){return jn$3(t)?t.replace(Qr$4,""):t}function to$3(t){return Kr$4(t).split(/\s+/)}var eo$3="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function no$3(t,e){return no$3.node?no$3.node(t,e):(eo$3.font=e,eo$3.measureText(t).width)}function io$3(t,e,n){var i=no$3(t,e);return new Yr$4(i,n||14)}function ro$3(t,e,n,i){if(!t||0===t.length)return[{text:"",width:0}];var r=Dn$3(i)?no$3(t,e):i,o=r/t.length,s=Math.floor(n/o/2);if(o>=n||s<=0)return[{text:"",width:n}];if(r<=n)return[{text:t,width:r}];for(var a=[],h=t.substring(0,s),l=o*s,c=s,u=t.length;c<u;c++){var f=t[c],d=no$3(h+f);d>=n?(a.push({text:h,width:l}),h=t.substring(c,s+c),c+=s-1,l=o*s):(h+=f,l=d),c>=u-1&&(l=no$3(h),a.push({text:h,width:l}))}return a}var oo$3=/\{([\w_]+)\}/g;function so$3(t,e){return jn$3(t)?t.replace(oo$3,(function(t,n){if(!e)return"";var i=e[n];return Dn$3(i)?"":Array.isArray(i)?i.join():i})):t}function ao$3(t,e){Ln$3(t)&&(t+="");var n=e.textMaxHeight||0,i=co$3(t=t||"",e);return n&&n<i.size.height&&(i.size.height=n),i}function ho$3(t,e,n){var i=t.width,r=t.height;return new Ii$4("left"===e?-i:"right"===e?0:-i/2,"top"===n?-r:"bottom"===n?0:-r/2)}function lo$3(t){return t.textFont?t.textFont:(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+t.textSize+"px "+(t.textFaceName?'"'===t.textFaceName[0]?t.textFaceName:'"'+t.textFaceName+'"':"monospace")}function co$3(t,e){var n=lo$3(e),i=e.textLineSpacing||0,r=io$3(t,n,e.textSize),o=r.width,s=r.height,a=e.textWrapCharacter,h=[],l=e.textWrapWidth;(!l||l>o)&&(l=o),jn$3(t)||(t+="");var c=0;if(a&&t.indexOf(a)>=0)for(var u=t.split(a),f=0,d=u.length;f<d;f++){var m=u[f],g=no$3(m,n);if(g>l)for(var p=ro$3(m,n,l,g),_=0,v=p.length;_<v;_++){var y=p[_].width;y>c&&(c=y),h.push({text:p[_].text,size:new Yr$4(y,s)})}else g>c&&(c=g),h.push({text:m,size:new Yr$4(g,s)})}else if(o>l)for(var x=ro$3(t,n,l,o),b=0;b<x.length;b++){var w=x[b].width;w>c&&(c=w),h.push({text:x[b].text,size:new Yr$4(w,s)})}else o>c&&(c=o),h.push({text:t,size:r});var C=h.length;return{total:C,size:new Yr$4(c,s*C+i*(C-1)),rows:h,rawSize:r}}function uo$3(t){var e=0,n=t&&t.length||0;if(!n)return e;for(var i=0;i<n;i++)e=(e<<5)-e+t.charCodeAt(i),e&=e;return e}function fo$3(t){return t&&t.colorStops}function mo$3(t){var e=[t.type];if(t.places&&e.push(t.places.join()),t.colorStops){for(var n=[],i=t.colorStops.length-1;i>=0;i--)n.push(t.colorStops[i].join());e.push(n.join(","))}return e.join("_")}function go$3(t,e){if(!t)return 1;var n=[];if(Array.isArray(t)){for(var i=0;i<t.length;i++)n.push(go$3(t[i],e));return n.sort().join(",")}var r=Object.keys(t).sort().reduce((function(n,i){return e&&0!==i.indexOf(e)||(n[i]=t[i]),n}),{});return uo$3(JSON.stringify(r))}function po$3(t,e){function n(t,e){Dn$3(t.opacity)?t.opacity=e:t.opacity*=e}var i;if(Array.isArray(t)){i=[];for(var r=0;r<t.length;r++){var o=kn$3({},t[r]);n(o,e),i.push(o)}}else n(i=kn$3({},t),e);return i}function _o$3(t){var e=Array.prototype.slice.call(arguments,1);if(e&&e.length||(e=[{}]),Array.isArray(t)){for(var n,i,r=[],o=0,s=t.length;o<s;o++){n=t[o],i={};for(var a=0,h=e.length;a<h;a++)Array.isArray(e[a])?Dn$3(e[a][o])?kn$3(i,n||{}):kn$3(i,n,e[a][o]):kn$3(i,n,e[a]?e[a]:{});r.push(i)}return r}var l=[{},t];return l.push.apply(l,e),kn$3.apply(this,l)}function vo$2(t){if(t.symbol&&(t=[t]),Array.isArray(t))return t;var e=t.$root,n=t.$iconset;return t=t.style,(e||n)&&(e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),n&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),yo$3(t,(function(t){return"{$root}"===t?e:"{$iconset}"===t?n:null}))),t}function yo$3(t,e){for(var n=0;n<t.length;n++){var i=t[n].symbol;i&&bo$2(i,e)}}var xo$2=/(\{\$root\}|\{\$iconset\})/g;function bo$2(t,e){for(var n in t)t.hasOwnProperty(n)&&"textName"!==n&&(jn$3(t[n])&&t[n].length>2?t[n]=t[n].replace(xo$2,e):Mr$4(t[n])?t[n]=wo$2(t[n],e):Fn$3(t[n])&&bo$2(t[n],e))}function wo$2(t,e){var n=t.default;jn$3(n)&&(t.default=n.replace(xo$2,e));for(var i=t.stops,r=0;r<i.length;r++)Array.isArray(i[r])&&(jn$3(i[r][1])?i[r][1]=i[r][1].replace(xo$2,e):Mr$4(i[r][1])&&(i[r][1]=wo$2(i[r][1],e)));return t}function Co$2(t){void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);for(var e=t.length,n=0;n<e;n++){var i=t[n];if(i.style){var r=i.style,o=r.lineDasharray,s=r.lineWidth;if(s&&Ln$3(s)&&s>0&&o&&Array.isArray(o)&&o.length)return!0}}return!1}var Mo$2=Object.freeze({now:In$3,extend:kn$3,isNil:Dn$3,isNumber:Ln$3,isInteger:zn$3,isObject:Fn$3,isString:jn$3,isFunction:Hn$3,hasOwn:Bn$3,join:function(t,e){return t.join?t.join(e||","):Array.prototype.join.call(t,e||",")},isEmpty:function(t){var e;for(e in t)return!1;return!e},toRadian:Vn$3,toDegree:Wn$3,IS_NODE:Un$3,get requestAnimFrame(){return Ei$4},get cancelAnimFrame(){return Oi$4},isSVG:ki$4,loadImage:Di$4,UID:zi$4,GUID:Fi$4,parseJSON:ji$4,pushIn:Hi$4,removeFromArray:Ni$4,forEachCoord:Bi$4,getValueOrDefault:Gi$4,sign:Vi$4,log2:Wi$4,interpolate:Ui$4,wrap:Zi$4,clamp:Xi$4,isArrayHasData:Ji$4,isURL:function(t){return qi$4.test(t)},isCssUrl:Qi$4,extractCssUrl:$i$4,btoa:tr$4,b64toBlob:er$4,computeDegree:nr$4,emptyImageUrl:ir$4,equalMapView:rr$4,flash:sr$4,_defaults:function(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var r=n[i],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}return t},getPointsResultPts:ar$4,getImageBitMap:hr$4,getAbsoluteURL:lr$4,calCanvasSize:fr$4,translateToSVGStyles:Ur$4,getMarkerPathBase64:Zr$4,getExternalResources:Xr$4,convertResourceUrl:Jr$4,isGradient:fo$3,getGradientStamp:mo$3,getSymbolStamp:function(t,e){return go$3(t,e)},getSymbolHash:go$3,lowerSymbolOpacity:po$3,extendSymbol:_o$3,parseStyleRootPath:vo$2,convertStylePath:yo$3,parseSymbolPath:bo$2,isDashLine:Co$2,trim:Kr$4,escapeSpecialChars:$r$4,splitWords:to$3,stringWidth:no$3,stringLength:io$3,splitContent:ro$3,CONTENT_EXPRE:oo$3,replaceVariable:so$3,describeText:ao$3,getAlignPoint:ho$3,getFont:lo$3,splitTextToRow:co$3,hashCode:uo$3}),To$3=Un$3?function(t){return t[0]}:function(t){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1},So$2=To$3(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),Po$3=To$3(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),Ao$3=To$3(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]);function Eo$2(t,e){var n=document.createElement(t);return e&&Vo$2(n,e),n}function Oo$2(t,e,n){var i=Eo$2(t);return e&&No$2(i,e),n&&n.appendChild(i),i}function Ro$2(t){if(!t)return this;if(Si$4.ielt9||Si$4.ie9){var e=Eo$2("div");e.appendChild(t),e.innerHTML="",e=null}else t.parentNode&&t.parentNode.removeChild(t);return this}function Io$2(t,e,n,i){if(!(t&&t.addEventListener&&e&&n))return this;for(var r=function(e){e||(e=window.event),n.call(i||t,e)},o=e.split(" "),s=o.length-1;s>=0;s--){var a=o[s];a&&(t["Z__"+a]||(t["Z__"+a]=[]),Do$2(t,a,n)>=0&&(console.warn(t,"find '"+a+"' handler:",n," The old listener function will be removed"),ko$2(t,a,n)),t["Z__"+a].push({callback:r,src:n}),t.addEventListener(a,r,!!Si$4.supportsPassive&&{capture:!1,passive:!1}))}return this}function ko$2(t,e,n){function i(e,n){"mousewheel"===e&&Si$4.gecko&&(e="DOMMouseScroll"),t.removeEventListener(e,n,!1)}if(!t||!t.removeEventListener||!e)return this;for(var r=e.split(" "),o=r.length-1;o>=0;o--){var s=r[o];if(s){if(!n&&t["Z__"+s]){for(var a=t["Z__"+s],h=0,l=a.length;h<l;h++)i(a[h].callback);return delete t["Z__"+s],this}var c=Do$2(t,s,n);if(c<0)return this;i(s,t["Z__"+s][c].callback),t["Z__"+s].splice(c,1)}}return this}function Do$2(t,e,n){if(!t||!t["Z__"+e]||!n)return-1;for(var i=t["Z__"+e],r=0,o=i.length;r<o;r++)if(i[r].src===n)return r;return-1}function Lo$2(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function zo$3(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function Fo$3(t,e){return t?(Si$4.any3d?function(t,e){var n=e||new Ii$4(0,0);t.style[So$2]=Si$4.any3d?"translate3d("+n.x+"px,"+n.y+"px,0px)":"translate("+n.x+"px,"+n.y+"px)"}(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null}function jo$3(t){var e=window.getComputedStyle(t),n=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],i=t.getBoundingClientRect(),r=t.offsetWidth,o=t.offsetHeight;return t.__position=[i.left+n[0],i.top+n[1],r?i.width/r:1,o?i.height/o:1],t.__position}function Ho$3(t,e){t||(t=window.event);var n=e.__position;return n||(n=jo$3(e)),new Ii$4((t.clientX-n[0]-e.clientLeft)/n[2],(t.clientY-n[1]-e.clientTop)/n[3])}function No$2(t,e){var n,r,o=t.style.cssText;return(r=(n=o).length-";".length)>=0&&n.indexOf(";",r)===r||(o+=";"),t.style.cssText=o+e,this}function Bo$3(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=Wo$2(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function Go$3(t,e){if(void 0===t.classList||Bo$3(t,e)){var n=Wo$2(t);Vo$2(t,(n?n+" ":"")+e)}else for(var i=to$3(e),r=0,o=i.length;r<o;r++)t.classList.add(i[r]);return this}function Vo$2(t,e){return Dn$3(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function Wo$2(t){return Dn$3(t.className.baseVal)?t.className:t.className.baseVal}function Uo$2(t,e){var n,i=((n=document.createElement(t)).style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(n),n);jn$3(e)?i.innerHTML=e:i.appendChild(e);var r=new Yr$4(i.clientWidth,i.clientHeight);return Ro$2(i),r}To$3(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);var Zo$2,Xo$3=Io$2,Jo$2=ko$2,qo$2="function"==typeof Map,Yo$2=function(){},Ko$2=function(){function t(t,e){this.max=t,this.onRemove=e||Yo$2,this.reset()}var e=t.prototype;return e.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var n=this.getAndRemove(this.order[0]);n&&this.onRemove(n)}return this},e.has=function(t){return t in this.data},e.keys=function(){return this.order},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},e.get=function(t){return this.has(t)?this.data[t]:null},e.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},e.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},t}();qo$2&&(Zo$2=function(){function t(t,e){this.max=t,this.onRemove=e||Yo$2,this.reset()}var e=t.prototype;return e.reset=function(){if(this.data){var t=this.data.values(),e=Array.isArray(t),n=0;for(t=e?t:t[Symbol.iterator]();;){var i;if(e){if(n>=t.length)break;i=t[n++]}else{if((n=t.next()).done)break;i=n.value}this.onRemove(i)}}return this.data=new Map,this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e),this.data.size>this.max&&this.shrink()):this.data.set(t,e),this):this},e.keys=function(){var t=new Array(this.data.size),e=0,n=this.data.keys(),i=Array.isArray(n),r=0;for(n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if((r=n.next()).done)break;o=r.value}t[e++]=o}return t},e.shrink=function(){for(var t=this.data.keys(),e=t.next();this.data.size>this.max;){var n=this.getAndRemove(e.value);n&&this.onRemove(n),e=t.next()}},e.has=function(t){return this.data.has(t)},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data.get(t);return this.data.delete(t),e},e.get=function(t){return this.has(t)?this.data.get(t):null},e.remove=function(t){if(!this.has(t))return this;var e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this},e.setMaxSize=function(t){return this.max=t,this.data.size>this.max&&this.shrink(),this},t}());var Qo$2=qo$2?Zo$2:Ko$2,$o$2={jsonp:function(t,e){var n="_maptalks_jsonp_"+zi$4();t.match(/\?/)?t+="&callback="+n:t+="?callback="+n;var i=document.createElement("script");return i.type="text/javascript",i.src=t,window[n]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(t,e,n){if(Hn$3(e)){var i=n;n=e,e=i}if(Un$3&&$o$2.get.node)return $o$2.get.node(t,n,e);var r=$o$2._getClient(n);if(r.open("GET",t,!0),e){for(var o in e.headers)r.setRequestHeader(o,e.headers[o]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(null),r},post:function(t,e,n){var i;if(jn$3(t)){if(Hn$3(e)){var r=n;n=e,e=r}i=(e=e||{}).postData}else i=e,t=(e=t).url;if(Un$3&&$o$2.post.node)return e.url=t,$o$2.post.node(e,i,n);var o=$o$2._getClient(n);if(o.open("POST",e.url,!0),e.headers||(e.headers={}),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in o)for(var s in e.headers)e.headers.hasOwnProperty(s)&&o.setRequestHeader(s,e.headers[s]);return jn$3(i)||(i=JSON.stringify(i)),o.send(i),o},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){var e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=$o$2._wrapCallback(e,t),e},getArrayBuffer:function(t,e,n){if(Hn$3(e)){var i=n;n=e,e=i}return e||(e={}),e.responseType="arraybuffer",$o$2.get(t,e,n)},getImage:function(t,e,n){return $o$2.getArrayBuffer(e,n,(function(e,n){if(e)t.onerror&&t.onerror(e);else if(n){var i=window.URL||window.webkitURL,r=t.onload;t.onload=function(){r&&r(),i.revokeObjectURL(t.src)};var o=new Blob([new Uint8Array(n.data)],{type:n.contentType});t.cacheControl=n.cacheControl,t.expires=n.expires,t.src=n.data.byteLength?i.createObjectURL(o):ir$4}}))},getJSON:function(t,e,n){if(Hn$3(e)){var i=n;n=e,e=i}var r=function(t,e){var i=e?ji$4(e):null;n(t,i)};return e&&e.jsonp?$o$2.jsonp(t,r):$o$2.get(t,e,r)}},ts$1=!1,es$1=null,ns$1=Math.PI/180,is$1={getCanvas2DContext:function(t){return t.getContext("2d",{willReadFrequently:!0})},setHitTesting:function(t){ts$1=t},createCanvas:function(t,e,n){var i;return Un$3?i=new n(t,e):((i=Eo$2("canvas")).width=t,i.height=e),i},prepareCanvasFont:function(t,e){t.textBaseline="top",t.font=lo$3(e);var n=e.textFill;n||(n="#000"),t.fillStyle=is$1.getRgba(n,e.textOpacity)},prepareCanvas:function(t,e,n,i){if(e){var r=e.lineWidth;Dn$3(r)||t.lineWidth===r||(t.lineWidth=r);var o=e.linePatternFile,s=e.lineColor||"#000";if(i)t.strokeStyle="#000";else if(o&&n){var a;(e.linePatternDx||e.linePatternDy)&&(a=[e.linePatternDx,e.linePatternDy]),is$1._setStrokePattern(t,o,r,a,n),e.lineDasharray=[]}else fo$3(s)?t.strokeStyle=e.lineGradientExtent?is$1._createGradient(t,s,e.lineGradientExtent):"#000":(Array.isArray(s)&&(s=is$1.normalizeColorToRGBA(s)),t.strokeStyle=s);e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&Ji$4(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var h=e.polygonPatternFile,l=e.polygonFill||"rgba(255,255,255,0)";if(i)t.fillStyle="#000";else if(h&&n){var c=os$1(h),u=n.getImage([c,null,null]);if(u||(u=n.getImage([c+"-texture",null,r])),ki$4(c)&&u instanceof Image&&(Si$4.edge||Si$4.ie)){var f=u.width||20,d=u.height||20,m=is$1.createCanvas(f,d);is$1.image(m.getContext("2d"),u,0,0,f,d),u=m}u?(t.fillStyle=t.createPattern(u,"repeat"),(e.polygonPatternDx||e.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[e.polygonPatternDx,e.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",c)}else fo$3(l)?t.fillStyle=e.polygonGradientExtent?is$1._createGradient(t,l,e.polygonGradientExtent):"rgba(255,255,255,0)":(Array.isArray(l)&&(l=is$1.normalizeColorToRGBA(l)),t.fillStyle=l)}},_createGradient:function(t,e,n){var i=null,r=e.places,o=n.getMin(),s=n.getMax(),a=n.getWidth(),h=n.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,a*r[2],o.x+r[3]*a,o.y+r[4]*h,a*r[5]]}else{var l=n.getCenter()._round();r=[l.x,l.y,Math.abs(l.x-o.x),l.x,l.y,0]}i=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,o.x+r[2]*a,o.y+r[3]*h]}else r=[o.x,o.y,s.x,o.y];i=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach((function(t){i.addColorStop.apply(i,t)})),i},_setStrokePattern:function(t,e,n,i,r){var o,s=os$1(e);if(Un$3)o=r.getImage([s,null,n]);else{var a=s+"-texture-"+n;if(!(o=r.getImage(a))){var h=r.getImage([s,null,null]);if(h){var l;l=h.width&&h.height?Math.round(h.width*n/h.height):n;var c=is$1.createCanvas(l,n,t.canvas.constructor);is$1.image(c.getContext("2d"),h,0,0,l,n),r.addResource([a,null,n],c),o=c}}}o?(t.strokeStyle=t.createPattern(o,"repeat"),t.strokeStyle.linePatternOffset=i):"undefined"!=typeof console&&console.warn("img not found for",s)},clearRect:function(t,e,n,i,r){t.canvas._drawn=!1,t.clearRect(e,n,i,r)},fillCanvas:function(t,e,n,i){if(ts$1&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=is$1._isPattern(t.fillStyle),s=t.fillStyle&&t.fillStyle.polygonPatternOffset,a=s?s[0]:0,h=s?s[1]:0;Dn$3(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),o&&t.translate((n=n||0)+a,(i=i||0)+h),t.fill(),o&&t.translate(-n-a,-i-h),e<1&&(t.globalAlpha=r)}},getRgba:function(t,e){return Dn$3(e)&&(e=1),"#"!==t[0]?(Array.isArray(t)&&(t=is$1.normalizeColorToRGBA(t,e)),t):(7===t.length?(n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(n=17*parseInt(t.substring(1,2),16),i=17*parseInt(t.substring(2,3),16),r=17*parseInt(t.substring(3,4),16)),"rgba("+n+","+i+","+r+","+e+")");var n,i,r},normalizeColorToRGBA:function(t,e){return void 0===e&&(e=1),"rgba("+255*t[0]+","+255*t[1]+","+255*t[2]+","+(4===t.length?t[3]:1)*e+")"},image:function(t,e,n,i,r,o){t.canvas._drawn=!0;try{Ln$3(r)&&Ln$3(o)?t.drawImage(e,n,i,r,o):t.drawImage(e,n,i)}catch(t){console&&(console.warn("error when drawing image on canvas:",t),console.warn(e))}},text:function(t,e,n,i,r){is$1._textOnMultiRow(t,r.rows,i,n,r.size,r.rawSize)},_textOnMultiRow:function(t,e,n,i,r,o){for(var s,a,h=ho$3(r,n.textHorizontalAlignment,n.textVerticalAlignment),l=o.height+n.textLineSpacing,c=i.add(0,h.y),u=n.textMaxHeight,f=0,d=0,m=e.length;d<m&&(s=e[d].text,a=ho$3(e[d].size,n.textHorizontalAlignment,n.textVerticalAlignment),is$1._textOnLine(t,s,c.add(a.x,d*l),n.textHaloRadius,n.textHaloFill,n.textHaloOpacity),!(u>0&&(f+=l)+o.height>=u));d++);},_textOnLine:function(t,e,n,i,r,o){ts$1&&(o=1);var s,a,h=0!==o&&0!==i;t.textBaseline="top";var l=t.shadowBlur,c=t.shadowOffsetX,u=t.shadowOffsetY;if(h){var f=t.globalAlpha;t.globalAlpha*=o,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*i,Array.isArray(r)&&(r=is$1.normalizeColorToRGBA(r)),t.strokeStyle=r,t.strokeText(e,n.x,n.y+1),t.miterLimit=10,t.globalAlpha=f,s=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",a=t.fillStyle,t.fillStyle="#000"}l&&h&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),is$1.fillText(t,e,n),s&&(t.globalCompositeOperation=s,is$1.fillText(t,e,n,a),l&&(t.shadowBlur=l,t.shadowOffsetX=c,t.shadowOffsetY=u))},fillText:function(t,e,n,i){t.canvas._drawn=!0,i&&(t.fillStyle=i),t.fillText(e,n.x,n.y+1)},_stroke:function(t,e,n,i){if(ts$1&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=t.strokeStyle&&t.strokeStyle.linePatternOffset,s=o?o[0]:0,a=o?o[1]:0,h=is$1._isPattern(t.strokeStyle)&&(!Dn$3(n)&&!Dn$3(i)||!Dn$3(s)&&!Dn$3(a));Dn$3(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),h&&t.translate((n=n||0)+s,(i=i||0)+a),t.stroke(),h&&t.translate(-n-s,-i-a),e<1&&(t.globalAlpha=r)}},_path:function(t,e,n,i,r){if(Ji$4(e))for(var o,s=Ji$4(n),a=!0!==r&&is$1._isPattern(t.strokeStyle),h=0,l=e.length;h<l;h++)if(o=e[h],!s||t.setLineDash)t.lineTo(o.x,o.y),a&&h>0&&(c(e[h-1],o),t.beginPath(),t.moveTo(o.x,o.y));else if(s){if(h===l-1)break;rs$1(t,o,e[h+1],n)}function c(e,n){var r=nr$4(e.x,e.y,n.x,n.y);t.save();var o=Math.cos(r);Math.abs(o)<1e-7?t.translate(e.x-t.lineWidth/2,e.y):t.translate(e.x,e.y-t.lineWidth/2/o),t.rotate(r),is$1._stroke(t,i),t.restore()}},path:function(t,e,n,i,r){Ji$4(e)&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),is$1._path(t,e,r,n),is$1._stroke(t,n))},_multiClip:function(t,e){if(e&&0!==e.length)for(var n=0,i=(e=e[0]).length;n<i;n++){var r=e[n],o=r.x,s=r.y;0===n?t.moveTo(o,s):t.lineTo(o,s),n===i-1&&t.lineTo(o=e[0].x,s=e[0].y)}},polygon:function(t,e,n,i,r,o){if(t.isMultiClip)is$1._multiClip(t,e);else if(t.isClip)is$1._multiClip(t,Array.isArray(e[0])?e:[e]);else if(Ji$4(e)){var s=is$1._isPattern(t.strokeStyle),a=Ji$4(r)&&!t.setLineDash||s&&!o;Ji$4(e[0])||(e=[e]);var h,l,c,u=t;if(e.length>1&&!Un$3&&(es$1||(es$1=is$1.createCanvas(1,1)),t.canvas._drawn=!1,es$1.width=t.canvas.width,es$1.height=t.canvas.height,ss$1(t=es$1.getContext("2d"),u)),a){for(t.save(),l=0,c=e.length;l<c;l++)Ji$4(e[l])&&(is$1._ring(t,e[l],null,0,!0),h=i,l>0&&(t.globalCompositeOperation="destination-out",h=1),is$1.fillCanvas(t,h,e[l][0].x,e[l][0].y),l>0?t.globalCompositeOperation="source-over":c>1&&(t.fillStyle="#fff"),is$1._stroke(t,0));t.restore()}var f=t.fillStyle;for(l=0,c=e.length;l<c;l++)Ji$4(e[l])&&(o?(is$1.paintSmoothLine(t,e[l],n,o,!0),t.closePath()):is$1._ring(t,e[l],r,n),a||(h=i,l>0&&(t.globalCompositeOperation="destination-out",h=1),is$1.fillCanvas(t,h,e[l][0].x,e[l][0].y),l>0?t.globalCompositeOperation="source-over":c>1&&(t.fillStyle="#fff")),is$1._stroke(t,n));t.fillStyle!==f&&(t.fillStyle=f),e.length>1&&!Un$3&&(u.drawImage(es$1,0,0),u.canvas._drawn=t.canvas._drawn,ss$1(u,t))}},_ring:function(t,e,n,i,r){var o=is$1._isPattern(t.strokeStyle);r||!o||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),is$1._path(t,e,n,i,r),o||t.closePath()},paintSmoothLine:function(t,e,n,i,r,o,s){if(e)if(e.length<=2||!i)is$1.path(t,e,n);else{var a,h=e.length,l=r?h:h-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==s&&(l-=Math.max(l-o-1,0));for(var c=0;c<l;c++){var u=void 0,f=void 0,d=void 0,m=void 0,g=void 0,p=void 0;c-1<0?r?(u=e[l-1].x,f=e[l-1].y):(u=e[c+1].x,f=e[c+1].y):(u=e[c-1].x,f=e[c-1].y),c+1<h?(d=e[c+1].x,m=e[c+1].y):(d=e[c+1-h].x,m=e[c+1-h].y),c+2<h?(g=e[c+2].x,p=e[c+2].y):r?(g=e[c+2-h].x,p=e[c+2-h].y):(g=e[c].x,p=e[c].y);var _=y(u,f,e[c].x,e[c].y,d,m,g,p,i,c===l-1?s:1);if(c===l-1&&s>=0&&s<1){t.bezierCurveTo(_[0],_[1],_[2],_[3],_[4],_[5]),e.splice(l-1,h-(l-1)-1);var v=new Ii$4(_[4],_[5]);v.prevCtrlPoint=new Ii$4(_[2],_[3]),e.push(v),h=e.length}else t.bezierCurveTo(_[0],_[1],_[2],_[3],d,m);e[c].nextCtrlPoint=_.slice(0,2),e[c].prevCtrlPoint=a?a.slice(2):null,a=_}!r&&e[1].prevCtrlPoint&&(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[h-1].prevCtrlPoint||(e[h-1].prevCtrlPoint=e[h-2].nextCtrlPoint),is$1._stroke(t,n)}function y(t,e,n,i,r,o,s,a,h,l){var c=(t+n)/2,u=(e+i)/2,f=(n+r)/2,d=(i+o)/2,m=(r+s)/2,g=(o+a)/2,p=Math.sqrt((n-t)*(n-t)+(i-e)*(i-e)),_=Math.sqrt((r-n)*(r-n)+(o-i)*(o-i)),v=p/(p+_),y=_/(_+Math.sqrt((s-r)*(s-r)+(a-o)*(a-o))),x=c+(f-c)*v,b=u+(d-u)*v,w=f+(m-f)*y,C=d+(g-d)*y,M=x+(f-x)*h+n-x,T=b+(d-b)*h+i-b,S=w+(f-w)*h+r-w,P=C+(d-C)*h+o-C,A=[M,T,S,P];return l<1?function(t,e,n,i,r,o,s,a,h,l){var u=1-e,f=n*u*u+2*r*e*u+s*e*e,d=r*u*u+2*s*e*u+h*e*e,m=i*u*u+2*o*e*u+a*e*e,g=o*u*u+2*a*e*u+l*e*e;return[(1*n*1+2*r*0*1+0*s*0)*u+(1*r*1+2*s*0*1+0*h*0)*e,(1*i*1+2*o*0*1+0*a*0)*u+(1*o*1+2*a*0*1+0*l*0)*e,1*f+0*d,1*m+0*g,f*u+d*e,m*u+g*e]}(0,l,n,i,M,T,S,P,r,o):A}},_arcBetween:function(t,e,n,i){var r=i,o=e.distanceTo(n),s=o/2/Math.sin(r/2),a=Math.asin((n.y-e.y)/o);e.x>n.x&&(a=Math.PI-a);var h=a-(90*ns$1-r/2),l=Math.cos(h)*s,c=Math.sin(h)*s,u=e.x+l,f=e.y+c,d=Math.asin((n.y-f)/s);u>n.x&&(d=Math.PI-d);var m=d+r;return t.beginPath(),t.arc(u,f,s,d,m),[u,f]},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,n,i){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var o=[t];o.push.apply(o,e.splice(1)),is$1._bezierCurveTo.apply(is$1,o),is$1.fillCanvas(t,i),is$1._stroke(t,n)},_bezierCurveTo:function(t,e,n,i){t.bezierCurveTo(e.x,e.y,n.x,n.y,i.x,i.y)},ellipse:function(t,e,n,i,r,o,s){var a,h,l,c,u,f,d,m,g;t.beginPath(),n===i&&n===r?t.arc(e.x,e.y,n,0,2*Math.PI):t.ellipse?i!==r?(t.ellipse(e.x,e.y,n,i,0,180*ns$1,360*ns$1,!1),t.ellipse(e.x,e.y,n,r,0,0,180*ns$1,!1)):t.ellipse(e.x,e.y,n,i,0,0,360*ns$1,!1):(d=(l=n)*(f=.5522848),m=(c=i)*f,g=(u=r)*f,t.moveTo((a=e.x)-l,h=e.y),t.bezierCurveTo(a-l,h-m,a-d,h-c,a,h-c),t.bezierCurveTo(a+d,h-c,a+l,h-m,a+l,h),t.bezierCurveTo(a+l,h+g,a+d,h+u,a,h+u),t.bezierCurveTo(a-d,h+u,a-l,h+g,a-l,h),t.closePath()),is$1.fillCanvas(t,s,e.x-n,e.y-i),is$1._stroke(t,o,e.x-n,e.y-i)},rectangle:function(t,e,n,i,r){var o=e.x,s=e.y;t.beginPath(),t.rect(o,s,n.width,n.height),is$1.fillCanvas(t,r,o,s),is$1._stroke(t,i,o,s)},sector:function(t,e,n,i,r,o){var s=ns$1;!function(t,e,n,i,a,h){var l=s*-h,c=s*-a;t.beginPath(),t.moveTo(e,n),t.arc(e,n,i,l,c),t.lineTo(e,n),is$1.fillCanvas(t,o,e-i,n-i),is$1._stroke(t,r,e-i,n-i)}(t,e.x,e.y,n,i[0],i[1])},_isPattern:function(t){return!jn$3(t)&&!("addColorStop"in t)},drawCross:function(t,e,n,i,r){t.canvas._drawn=!0,t.strokeStyle=r,t.lineWidth=i,t.beginPath(),t.moveTo(e-5,n),t.lineTo(e+5,n),t.moveTo(e,n-5),t.lineTo(e,n+5),t.stroke()},copy:function(t,e){var n=e||Eo$2("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),n},pixelRect:function(t,e,n,i){var r=t.globalAlpha,o=!1;if(t.lineWidth>0&&n>0)o=!0,n<1&&(t.globalAlpha*=n);else{if(!(i>0))return;i<1&&(t.globalAlpha*=i)}t.canvas._drawn=!0,o?t.strokeRect(e[0],e[1],1,1):t.fillRect(e[0],e[1],1,1),t.globalAlpha!==r&&(t.globalAlpha=r)}};function rs$1(t,e,n,i){var r=e.x,o=e.y,s=n.x,a=n.y,h=i,l=function(t,e){return t<=e},c=function(t,e){return t>=e},u=function(t,e){return Math.min(t,e)},f=function(t,e){return Math.max(t,e)},d={thereYet:c,cap:u},m={thereYet:c,cap:u};o-a>0&&(m.thereYet=l,m.cap=f),r-s>0&&(d.thereYet=l,d.cap=f),t.moveTo(r,o);for(var g,p,_=r,v=o,y=0,x=!0;!d.thereYet(_,s)||!m.thereYet(v,a);)g=Math.atan2(a-o,s-r),p=h[y],_=d.cap(s,_+Math.cos(g)*p),v=m.cap(a,v+Math.sin(g)*p),x?t.lineTo(_,v):t.moveTo(_,v),y=(y+1)%h.length,x=!x}function os$1(t){return"data:image/"===t.substring(0,"data:image/".length)?t:$i$4(t)}function ss$1(t,e){t.filter=e.filter,t.fillStyle=e.fillStyle,t.globalAlpha=e.globalAlpha,t.lineCap=e.lineCap,t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle}var as$1="undefined"!=typeof Promise?Promise:$e$4,hs$1=function(t){return function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.on=function(t,e,n){if(!t)return this;if(!jn$3(t))return this._switch("on",t,e);if(!e)return this;this._eventMap||(this._eventMap={});var i,r,o=t.toLowerCase().split(" ");n||(n=this);for(var s=0,a=o.length;s<a;s++){(r=this._eventMap[i=o[s]])||(this._eventMap[i]=r=[]);var h=r.length;if(h>0)for(var l=0;l<h;l++)if(e===r[l].handler&&r[l].context===n)return console.warn(this,"find '"+t+"' handler:",e," The old listener function will be removed"),this;r.push({handler:e,context:n})}return this},n.addEventListener=function(){return this.on.apply(this,arguments)},n.once=function(t,e,n){if(!jn$3(t)){var i={};for(var r in t)t.hasOwnProperty(r)&&(i[r]=this._wrapOnceHandler(r,t[r],n));return this._switch("on",i)}for(var o=t.split(" "),s=0,a=o.length;s<a;s++)this.on(o[s],this._wrapOnceHandler(o[s],e,n));return this},n.off=function(t,e,n){if(!this._eventMap||!t)return this;if(!jn$3(t))return this._switch("off",t,e);if(!e)return this;var i,r,o,s=t.split(" ");n||(n=this);for(var a=0,h=s.length;a<h;a++){if(o="Z__"+(i=s[a].toLowerCase()),!(r=this._eventMap[i]))return this;for(var l=r.length-1;l>=0;l--){var c=r[l];e!==c.handler&&e!==c.handler[o]||c.context!==n||(delete c.handler[o],r.splice(l,1))}r.length||delete this._eventMap[i]}return this},n.removeEventListener=function(){return this.off.apply(this,arguments)},n.listens=function(t,e,n){if(!this._eventMap||!jn$3(t))return 0;var i=this._eventMap[t.toLowerCase()];if(!i||!i.length)return 0;if(!e)return i.length;for(var r=0,o=i.length;r<o;r++)if(e===i[r].handler&&(Dn$3(n)||i[r].context===n))return 1;return 0},n.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},n.copyEventListeners=function(t){var e,n=t._eventMap;if(!n)return this;for(var i in n)for(var r=0,o=(e=n[i]).length;r<o;r++)this.on(i,e[r].handler,e[r].context);return this},n.fire=function(){return this._eventParent?this._eventParent.fire.apply(this._eventParent,arguments):this._fire.apply(this,arguments)},n._wrapOnceHandler=function(t,e,n){var i=this,r="Z__"+t,o=!1,s=function a(){o||(delete s[r],o=!0,e.apply(n||this,arguments),i.off(t,a,this))};return s[r]=e,s},n._switch=function(t,e,n){for(var i in e)e.hasOwnProperty(i)&&this[t](i,e[i],n);return this},n._clearListeners=function(t){this._eventMap&&jn$3(t)&&this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null)},n._clearAllListeners=function(){this._eventMap=null},n._setEventParent=function(t){return this._eventParent=t,this},n._setEventTarget=function(t){return this._eventTarget=t,this},n._fire=function(t,e){if(!this._eventMap)return this;var n=this._eventMap[t.toLowerCase()];if(!n)return this;e||(e={}),e.type=t,e.target=this._eventTarget||this;for(var i,r,o=n.slice(0),s=0,a=o.length;s<a;s++)o[s]&&(i=o[s].context,r=kn$3({},e),!1===(i?o[s].handler.call(i,r):o[s].handler(r))&&e.domEvent&&zo$3(e.domEvent));return this},e}(t)},ls$1=hs$1(function(){function t(t){this.target=t}var e=t.prototype;return e.enable=function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},e.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},e.enabled=function(){return!!this._enabled},e.remove=function(){this.disable(),delete this.target,delete this.dom},t}()),cs$2=function(){function t(t){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(t),this.callInitHooks(),this._isUpdating=!1}var e=t.prototype;return e.proxyOptions=function(){var t=this;return Si$4.proxy?(this.options.isExtensible||(this.options=new Proxy(this.options,{set:function(e,n,i){if(e[n]===i)return!0;if(e[n]=i,t._isUpdating)return!0;var r={};return r[n]=i,t.config(r),!0}})),this):this},e.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},e.setOptions=function(t){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},e.config=function(t){if(this._isUpdating=!0,!t){var e={};for(var n in this.options)this.options.hasOwnProperty(n)&&(e[n]=this.options[n]);return this._isUpdating=!1,e}if(2===arguments.length){var i={};i[t]=arguments[1],t=i}for(var r in t)this.options[r]=t[r],this[r]&&this[r]instanceof ls$1&&(t[r]?this[r].enable():this[r].disable());return this.onConfig(t),this._isUpdating=!1,this},e.onConfig=function(){},e._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var n=t._initHooks;if(n&&n!==e._initHooks)for(var i=0;i<n.length;i++)n[i].call(this)}},t.addInitHook=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var r="function"==typeof t?t:function(){this[t].apply(this,n)},o=this.prototype,s=Object.getPrototypeOf(o);return o._initHooks&&o._initHooks!==s._initHooks||(o._initHooks=[]),o._initHooks.push(r),this},t.include=function(){for(var t=0;t<arguments.length;t++)kn$3(this.prototype,t<0||arguments.length<=t?void 0:arguments[t]);return this},t.mergeOptions=function(t){var e=this.prototype,n=Object.getPrototypeOf(e);return e.options&&e.options!==n.options||(e.options=e.options?Object.create(e.options):{}),kn$3(e.options,t),this},t}(),us$1={},fs$1=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return Pi$4(e,t),e.registerJSONType=function(t){return t?(us$1[t]=this,this):this},e.getJSONClass=function(t){return t?us$1[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in us$1)if(us$1[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered geometry class!");return this._jsonType},e}(t)},ds$1={},ms$1=function(){function t(){this._tree=_n$3(9,["[0]","[1]","[2]","[3]"])}var e=t.prototype;return e.collides=function(t){return ds$1.minX=t[0],ds$1.minY=t[1],ds$1.maxX=t[2],ds$1.maxY=t[3],this._tree.collides(ds$1)},e.insertBox=function(t){return this._tree.insert(t),this},e.bulkInsertBox=function(t){return this._tree.load(t),this},e.clear=function(){return this._tree.clear(),this},t}();function gs$1(t){return function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},n.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var n=this._handlers.indexOf(e);n>=0&&this._handlers.splice(n,1),this[t].remove(),delete this[t]}return this},n._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)}var ps$1={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},_s$1={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},vs$1=function(t){function e(e,n){var i;return void 0===n&&(n={}),(i=t.call(this,null)||this).dom=e,i.options=n,i}Pi$4(e,t);var n=e.prototype;return n.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},Xo$3(this.dom,"touchstart mousedown",this._onMouseDown,this),this):this},n.disable=function(){return this.dom?(this._offEvents(),Jo$2(this.dom,"touchstart mousedown",this._onMouseDown),delete this._onMouseDown,this):this},n.onMouseDown=function(t){if((this.options.rightclick||2!==t.button)&&!(t.touches&&t.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(t))){var e=this.dom;e.setCapture?e.setCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP),e.ondragstart=function(){return!1},delete this.moved;var n=t.touches?t.touches[0]:t;this.startPos=new Ii$4(n.clientX,n.clientY),Jo$2(document,ps$1[t.type],this.onMouseMove),Jo$2(document,_s$1[t.type],this.onMouseUp),Xo$3(document,ps$1[t.type],this.onMouseMove,this),Xo$3(document,_s$1[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||(Jo$2(this.dom,"mouseleave",this.onMouseUp),Xo$3(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:t,mousePos:new Ii$4(n.clientX,n.clientY)})}},n.onMouseMove=function(t){if(t.touches&&t.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(t));else{var e=t.touches?t.touches[0]:t,n=new Ii$4(e.clientX,e.clientY).sub(this.startPos);(n.x||n.y)&&(this.moved?this.fire("dragging",{domEvent:t,mousePos:new Ii$4(e.clientX,e.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))}},n.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var n={domEvent:t};Ln$3(e.clientX)&&(n.mousePos=new Ii$4(parseInt(e.clientX,0),parseInt(e.clientY,0))),this.moved&&(n.interupted=this.interupted,this.fire("dragend",n),delete this.interupted,delete this.moved),this.fire("mouseup",n)},n._offEvents=function(){var t=this.dom;if(Jo$2(t,"mouseleave",this.onMouseUp),"undefined"!=typeof document&&"undefined"!=typeof window){for(var e in ps$1)Jo$2(document,ps$1[e],this.onMouseMove),Jo$2(document,_s$1[e],this.onMouseUp);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents(window.Event.MOUSEMOVE|window.Event.MOUSEUP)}},e}(ls$1),ys$1=function(t){function e(){return t.apply(this,arguments)||this}return Pi$4(e,t),e.toNumberArrays=function(t){return Array.isArray(t)?Bi$4(t,(function(t){return[t.x,t.y]})):[t.x,t.y]},e.toCoordinates=function(t){if(Ln$3(t[0])&&Ln$3(t[1]))return new e(t);if(t instanceof e)return t;for(var n=[],i=0,r=t.length;i<r;i++){var o=t[i];Array.isArray(o)?Ln$3(o[0])?n.push(new e(o)):n.push(e.toCoordinates(o)):n.push(o instanceof e?o:new e(o))}return n},e}(Ri$4),xs$1=function(){function t(t,e){this.type=t,this.properties=e}return t.createProj4=function(e){return new t("proj4",{proj:e})},t.fromProjectionCode=function(e){return e&&t[e=e.toUpperCase().replace(":","")]||null},t}();xs$1.WGS84=xs$1.createProj4("+proj=longlat +datum=WGS84 +no_defs"),xs$1.EPSG4326=xs$1.WGS84,xs$1.EPSG3857=xs$1.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),xs$1.IDENTITY=xs$1.createProj4("+proj=identity +no_defs"),xs$1.CGCS2000=xs$1.createProj4("+proj=longlat +datum=CGCS2000"),xs$1.EPSG4490=xs$1.CGCS2000,xs$1.BD09LL=xs$1.createProj4("+proj=longlat +datum=BD09"),xs$1.GCJ02=xs$1.createProj4("+proj=longlat +datum=GCJ02");var bs$1,ws$1=new Ii$4(0,0),Cs$1=new ys$1(0,0),Ms$1=new ys$1(0,0),Ts$1=new ys$1(0,0),Ss$1=new ys$1(0,0),Ps$1=new ys$1(0,0),As$1=new ys$1(0,0),Es$1=new ys$1(0,0),Os$1=new ys$1(0,0),Rs$1=[],Is$1=[],ks$1=function(){function t(t,e,n,i){this._clazz=ys$1;var r=arguments.length,o=r>0?arguments[r-1]:null;o&&o.unproject&&(this.projection=arguments[r-1]),this._dirty=!0,this._initialize(t,e,n,i)}var e=t.prototype;return e._initialize=function(t,e,n,i){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!Dn$3(t)){var r=this.projection;Ln$3(t)&&Ln$3(e)&&Ln$3(n)&&Ln$3(i)?r?this.set(t,e,n,i):this.set(Math.min(t,n),Math.min(e,i),Math.max(t,n),Math.max(e,i)):Array.isArray(t)?r?this.set(t[0],t[1],t[2],t[3]):this.set(Math.min(t[0],t[2]),Math.min(t[1],t[3]),Math.max(t[0],t[2]),Math.max(t[1],t[3])):Ln$3(t.x)&&Ln$3(e.x)&&Ln$3(t.y)&&Ln$3(e.y)?r?this.set(t.x,t.y,e.x,e.y):(t.x>e.x?(this.xmin=e.x,this.xmax=t.x):(this.xmin=t.x,this.xmax=e.x),t.y>e.y?(this.ymin=e.y,this.ymax=t.y):(this.ymin=t.y,this.ymax=e.y)):Ln$3(t.xmin)&&Ln$3(t.xmax)&&Ln$3(t.ymin)&&Ln$3(t.ymax)&&this.set(t.xmin,t.ymin,t.xmax,t.ymax)}},e._add=function(t){return this._dirty=!0,Dn$3(t.x)?Dn$3(t.xmin)?Dn$3(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},e.add=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._add.apply(t,arguments)},e._scale=function(t){return this._dirty=!0,this.xmin*=t,this.ymin*=t,this.xmax*=t,this.ymax*=t,this},e._sub=function(t){return this._dirty=!0,Dn$3(t.x)?Dn$3(t.xmin)?Dn$3(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},e._substract=function(){return this._sub.apply(this,arguments)},e.sub=function(){var t=new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection);return t._sub.apply(t,arguments)},e.substract=function(){return this.sub.apply(this,arguments)},e.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},e._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},e.getMin=function(t){return t?(t.set(this.xmin,this.ymin),t):new this._clazz(this.xmin,this.ymin)},e.getMax=function(t){return t?(t.set(this.xmax,this.ymax),t):new this._clazz(this.xmax,this.ymax)},e.getCenter=function(t){var e=(this.xmin+this.xmax)/2,n=(this.ymin+this.ymax)/2;return t?(t.set(e,n),t):new this._clazz(e,n)},e.isValid=function(){return!(Dn$3(this.xmin)||Dn$3(this.ymin)||Dn$3(this.xmax)||Dn$3(this.ymax))},e.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},e.intersects=function(t){this._project(this),this._project(t);var e=Math.max(this.pxmin,t.pxmin),n=Math.max(this.pymin,t.pymin),i=Math.min(this.pxmax,t.pxmax),r=Math.min(this.pymax,t.pymax);return!(e>i||n>r)},e.within=function(t){return this._project(this),this._project(t),this.pxmin>=t.pxmin&&this.pxmax<=t.pxmax&&this.pymin>=t.pymin&&this.pymax<=t.pymax},e.contains=function(t){if(!t)return!1;this._project(this);var e=this.projection;if(e)if(void 0!==t.x){var n=Cs$1;Array.isArray(t)?(n.x=t[0],n.y=t[1]):(n.x=t.x,n.y=t.y),t=e.project(n,n)}else void 0!==t.xmin&&this._project(t);return(t.x||t.pxmin||0)>=this.pxmin&&(t.x||t.pxmax||0)<=this.pxmax&&(t.y||t.pymin||0)>=this.pymin&&(t.y||t.pymax||0)<=this.pymax},e.getWidth=function(){return Math.abs(this.xmax-this.xmin)},e.getHeight=function(){return Math.abs(this.ymax-this.ymin)},e.getSize=function(){return new Yr$4(this.getWidth(),this.getHeight())},e.set=function(t,e,n,i){return this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i,this._dirty=!0,this},e.__combine=function(t){var e,n,i,r;void 0!==t.x&&(bs$1.xmin=bs$1.xmax=t.x,bs$1.ymin=bs$1.ymax=t.y,t=bs$1),this._project(t),this._project(this),Ln$3(this.pxmin)?(e=Math.min(this.pxmin,t.pxmin),n=Math.min(this.pymin,t.pymin),i=Math.max(this.pxmax,t.pxmax),r=Math.max(this.pymax,t.pymax)):(e=t.pxmin,n=t.pymin,i=t.pxmax,r=t.pymax);var o=this.projection;if(o){Ms$1.set(e,n),Ts$1.set(i,r);var s=o.unproject(Ms$1,Ms$1),a=o.unproject(Ts$1,Ts$1);e=s.x,n=s.y,i=a.x,r=a.y}return Is$1[0]=e,Is$1[1]=n,Is$1[2]=i,Is$1[3]=r,Is$1},e._combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return this.set(e[0],e[1],e[2],e[3]),this._dirty=!0,this},e.combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},e.intersection=function(t){if(!this.intersects(t))return null;Ss$1.x=Math.max(this.pxmin,t.pxmin),Ss$1.y=Math.max(this.pymin,t.pymin),Ps$1.x=Math.min(this.pxmax,t.pxmax),Ps$1.y=Math.min(this.pymax,t.pymax);var e=Ss$1,n=Ps$1,i=this.projection;return i&&(e=i.unproject(e,e),n=i.unproject(n,n)),new this.constructor(e,n,i)},e.expand=function(t){var e,n;return Ln$3(t)?e=n=t:(e=t.width||t.x||t[0]||0,n=t.height||t.y||t[1]||0),new this.constructor(this.xmin-e,this.ymin-n,this.xmax+e,this.ymax+n,this.projection)},e._expand=function(t){var e,n;return Ln$3(t)?e=n=t:(e=t.width||t.x||t[0]||0,n=t.height||t.y||t[1]||0),this.xmin-=e,this.ymin-=n,this.xmax+=e,this.ymax+=n,this._dirty=!0,this},e.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},e.toArray=function(t){var e=this.xmin,n=this.ymin,i=this.xmax,r=this.ymax;return t?(t[0].x=e,t[0].y=r,t[1].x=i,t[1].y=r,t[2].x=i,t[2].y=n,t[3].x=e,t[3].y=n,t[4].x=e,t[4].y=r,t):[new this._clazz([e,r]),new this._clazz([i,r]),new this._clazz([i,n]),new this._clazz([e,n]),new this._clazz([e,r])]},e.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},e.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},e.convertTo=function(t,e){if(!this.isValid())return null;var n,i=e||new this.constructor;return e&&i.set(null,null,null,null),this._clazz===ys$1?n=As$1:this._clazz===Ii$4&&(n=ws$1),n.x=this.xmin,n.y=this.ymax,i._combine(t(n)),n.x=this.xmax,i._combine(t(n)),n.y=this.ymin,i._combine(t(n)),n.x=this.xmin,i._combine(t(n)),i},e._project=function(t){if(t&&t.isValid()){var e=this.projection;if(e){if(t._dirty){Es$1.set(t.xmax,t.ymin),Os$1.set(t.xmin,t.ymax),Rs$1[0]=Es$1,Rs$1[1]=Os$1;var n=e.projectCoords(Rs$1),i=n[0],r=n[1];t.pxmin=Math.min(i.x,r.x),t.pymin=Math.min(i.y,r.y),t.pxmax=Math.max(i.x,r.x),t.pymax=Math.max(i.y,r.y)}delete t._dirty}else t.pxmin=t.xmin,t.pxmax=t.xmax,t.pymin=t.ymin,t.pymax=t.ymax}else t&&(t.pxmin=t.pxmax=t.pymin=t.pymax=null)},t}();bs$1=new ks$1(0,0,0,0);var Ds$1,Ls$1=function(t){function e(e,n,i,r){var o;return(o=t.call(this,e,n,i,r)||this)._clazz=Ii$4,o}return Pi$4(e,t),e}(ks$1),zs$1=function(){function t(t){this.matrix=t}var e=t.prototype;return e.transform=function(t,e,n){var i=this.matrix[0]*(t.x-this.matrix[2])/e,r=-this.matrix[1]*(t.y-this.matrix[3])/e;return n?(n.x=i,n.y=r,n):new Ii$4(i,r)},e.untransform=function(t,e,n){var i=t.x*e/this.matrix[0]+this.matrix[2],r=t.y*e/-this.matrix[1]+this.matrix[3];return n?(n.x=i,n.y=r,n):new ys$1(i,r)},t}(),Fs$1={project:function(){},unproject:function(){},projectCoords:function(t,e){var n=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(0===t.length)return[];if(!this.isSphere())return Bi$4(t,this.project,this);if(Array.isArray(t[0]))return t.map((function(t){return n.projectCoords(t,e)}));for(var i,r,o,s,a,h,l=!1!==e,c=this.getCircum(),u=this.getSphereExtent(),f=u.sx,d=u.sy,m=t[0],g=[this.project(m)],p=1,_=t.length;p<_;p++)s=(o=t[p]).x-m.x,a=o.y-m.y,h=this.project(o),Math.abs(s)>180&&l&&(void 0===i&&(i=o.x>m.x),i&&(h._add(-c.x*Vi$4(s)*f,0),o._add(-360*Vi$4(s),0))),Math.abs(a)>90&&l&&(void 0===r&&(r=o.y<m.y),r&&(h._add(0,-c.y*Vi$4(a)*d),o._add(0,-180*Vi$4(a)))),m=o,g.push(h);return g},unprojectCoords:function(t){return t?Array.isArray(t)?Bi$4(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){return!!this.isSphere()&&!this.getSphereExtent().contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var e=this.getSphereExtent(),n=new ys$1(t);return e.contains(n)||(n.x=Zi$4(t.x,e.xmin,e.xmax),n.y=Zi$4(t.y,e.ymin,e.ymax)),n},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new ys$1(180,90)),e=this.project(new ys$1(-180,-90));this.extent=new ks$1(e,t,this),this.extent.sx=t.x>e.x?1:-1,this.extent.sy=t.y>e.y?1:-1}return this.extent}},js$1={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var n=0,i=0,r=t.length;i<r-1;i++)n+=this.measureLenBetween(t[i],t[i+1]);return n}},Hs$1=kn$3({measure:"IDENTITY",measureLenBetween:function(t,e){if(!t||!e)return 0;try{return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}catch(t){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,n=0,i=t.length;n<i;n++){var o,r=t[n];e+=r.x*(o=n===i-1?t[0]:t[n+1]).y-r.y*o.x}return Math.abs(e/2)},locate:function(t,e,n,i){return(i=i||new ys$1(0,0)).set(t.x,t.y),this._locate(i,e,n)},_locate:function(t,e,n){return t?(e||(e=0),n||(n=0),e||n?(t.x=t.x+e,t.y=t.y+n,t):t):null},rotate:function(t,e,n){return t=new ys$1(t.x,t.y),this._rotate(t,e,n)},_rotate:(Ds$1=new Ii$4(0,0),function(t,e,n){return Ds$1.x=t.x-e.x,Ds$1.y=t.y-e.y,Ds$1._rotate(n*Math.PI/180),t.x=e.x+Ds$1.x,t.y=e.y+Ds$1.y,t})},js$1),Ns$1=function(){function t(t){this.radius=t}var e=t.prototype;return e.measureLenBetween=function(t,e){if(!t||!e)return 0;var n=Vn$3(t.y),i=Vn$3(e.y),r=n-i,o=Vn$3(t.x)-Vn$3(e.x);return n=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(n)*Math.cos(i)*Math.pow(Math.sin(o/2),2))),n*=this.radius,Math.round(1e5*n)/1e5},e.measureArea=function(t){var e,n=Vn$3(this.radius),i=0,r=t,o=r.length;if(o<3)return 0;for(e=0;e<o-1;e++){var s=r[e],a=r[e+1];i+=s.x*n*Math.cos(Vn$3(s.y))*a.y*n-a.x*n*Math.cos(Vn$3(a.y))*s.y*n}return o=r[e],r=r[0],i+=o.x*n*Math.cos(Vn$3(o.y))*r.y*n-r.x*n*Math.cos(Vn$3(r.y))*o.y*n,.5*Math.abs(i)},e.locate=function(t,e,n,i){return(i=i||new ys$1(0,0)).set(t.x,t.y),this._locate(i,e,n)},e._locate=function(t,e,n){if(!t)return null;if(e||(e=0),n||(n=0),!e&&!n)return t;var i,r,o=Vn$3(t.y);if(0!==n){var s=Math.abs(n);r=Zi$4(180*(o+=2*Math.sin(s/(2*this.radius))*(n>0?1:-1))/Math.PI,-90,90)}else r=t.y;if(0!==e){var a=Math.abs(e),h=Vn$3(t.x);i=Zi$4(180*(h+=2*Math.sqrt(Math.pow(Math.sin(a/(2*this.radius)),2)/Math.pow(Math.cos(o),2))*(e>0?1:-1))/Math.PI,-180,180)}else i=t.x;return t.x=i,t.y=r,t},e.rotate=function(t,e,n){return t=new ys$1(t),this._rotate(t,e,n)},e._rotate=function(t,e,n){var i=function(t,e,n){var i;return void 0===n&&(n={}),(i=n.final?Bs$1(e,t):Bs$1(t,e))>180?-(360-i):i}(e,t)-n,r=this.measureLenBetween(e,t);return t.x=e.x,t.y=e.y,function(t,e,n,i){var r=e/i,o=t.x*Math.PI/180,s=Vn$3(t.y),a=Vn$3(n),h=r*Math.cos(a),l=s+h;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);var c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),u=Math.abs(c)>1e-11?h/c:Math.cos(s),f=r*Math.sin(a)/u;return t.x=(180*(o+f)/Math.PI+540)%360-180,t.y=180*l/Math.PI,t}(t,r,i,this.radius)},t}();function Bs$1(t,e){var n=Vn$3(t.y),i=Vn$3(e.y),r=Vn$3(e.x-t.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(Wn$3(Math.atan2(r,o))+360)%360}var Gs$1=kn$3({measure:"EPSG:4326",sphere:new Ns$1(6378137),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},js$1),Vs$1=kn$3({measure:"BAIDU",sphere:new Ns$1(6370996.81),measureLenBetween:function(){return this.sphere.measureLenBetween.apply(this.sphere,arguments)},measureArea:function(){return this.sphere.measureArea.apply(this.sphere,arguments)},_locate:function(){return this.sphere._locate.apply(this.sphere,arguments)},locate:function(){return this.sphere.locate.apply(this.sphere,arguments)},_rotate:function(){return this.sphere._rotate.apply(this.sphere,arguments)},rotate:function(){return this.sphere.rotate.apply(this.sphere,arguments)}},js$1),Ws$1=Gs$1,Us$1={};function Zs$1(t){Us$1[t.measure]=t}Zs$1(Hs$1),Zs$1(Gs$1),Zs$1(Vs$1);var ia$1,Xs$1={getInstance:function(t){if(!t)return Ws$1;for(var e in Us$1)if(Bn$3(Us$1,e)){var n=Us$1[e].measure;if(!n)continue;if(t.toLowerCase()===n.toLowerCase())return Us$1[e]}return null}},Js$1=kn$3({},Fs$1,{code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t,e){var n=this.rad,i=this.metersPerDegree,r=this.maxLatitude,o=t.x,s=Math.max(Math.min(r,t.y),-r),a=o*i,h=(0===s?0:Math.log(Math.tan((90+s)*n/2))/n)*i;return e?(e.x=a,e.y=h,e):new ys$1(a,h)},unproject:function(t,e){var n,i=this.rad,r=this.metersPerDegree,o=t.x/r,s=t.y;0===s?n=0:(n=s/r,n=(2*Math.atan(Math.exp(n*i))-Math.PI/2)/i),Math.abs(Math.abs(o)-180)<1e-7&&(o=180*Vi$4(o)),Math.abs(Math.abs(n)-this.maxLatitude)<1e-7&&(n=Vi$4(n)*this.maxLatitude);var a=Zi$4(o,-180,180),h=Zi$4(n,-this.maxLatitude,this.maxLatitude);return e?(e.x=a,e.y=h,e):new ys$1(a,h)}},Gs$1),qs$1=kn$3({},Fs$1,{code:"EPSG:4326",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new ys$1(t)},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new ys$1(t)}},Gs$1),Ys$1=kn$3({},qs$1,{code:"EPSG:4490"}),Ks$1=kn$3({},Fs$1,{code:"BAIDU",project:function(t,e){return this.convertLL2MC(t,e)},unproject:function(t,e){return this.convertMC2LL(t,e)}},Vs$1,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t,e){for(var n,i=0,r=this.MCBAND.length;i<r;i++)if(Math.abs(t.y)>=this.MCBAND[i]){n=this.MC2LL[i];break}return this.convertor(t,n,e)},convertLL2MC:function(t,e){var n,i,r;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var o=new ys$1(t.x,t.y);for(i=0,r=this.LLBAND.length;i<r;i++)if(o.y>=this.LLBAND[i]){n=this.LL2MC[i];break}if(!n)for(i=this.LLBAND.length-1;i>=0;i--)if(o.y<=-this.LLBAND[i]){n=this.LL2MC[i];break}return this.convertor(t,n,e)},convertor:function(t,e,n){if(!t||!e)return null;var i=e[0]+e[1]*Math.abs(t.x),r=Math.abs(t.y)/e[9],o=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return i*=t.x<0?-1:1,o*=t.y<0?-1:1,n?(n.x=i,n.y=o,n):new ys$1(i,o)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,n){return null!=e&&(t=Math.max(t,e)),null!=n&&(t=Math.min(t,n)),t},getLoop:function(t,e,n){if(t===1/0)return n;if(t===-1/0)return e;for(;t>n;)t-=n-e;for(;t<e;)t+=n-e;return t}}),Qs$1=kn$3({},Fs$1,{code:"IDENTITY",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()}},Hs$1),$s$1=Js$1,ta$1=Object.freeze({EPSG3857:Js$1,DEFAULT:$s$1,EPSG4326:qs$1,EPSG4490:Ys$1,BAIDU:Ks$1,IDENTITY:Qs$1,Common:Fs$1}),ea$1=function(t){return function(t){function e(){return t.apply(this,arguments)||this}return Pi$4(e,t),e.registerRenderer=function(t,e){var n=this.prototype,i=Object.getPrototypeOf(n);return n._rendererClasses&&n._rendererClasses!==i._rendererClasses||(n._rendererClasses=n._rendererClasses?Object.create(n._rendererClasses):{}),n._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)},na$1={};var oa$1,sa$1="undefined"!=typeof window?window.navigator.hardwareConcurrency||4:0,aa=Math.max(Math.floor(sa$1/2),1),ha=function(){function t(t){void 0===t&&(t=50),this._limit=t,this._messages=[],this.buffers=[]}var e=t.prototype;return e.addMessage=function(t,e){if(this._messages.push(t),Array.isArray(e))for(var n=0;n<e.length;n++)this.buffers.indexOf(e[n])<0&&this.buffers.push(e[n])},e.isFull=function(){return this._messages.length>=this._limit},e.getMessage=function(){return{messageType:"batch",messages:this._messages}},t}(),la$1=function(){function t(){this.active={},this.workerCount="undefined"!=typeof window?window.MAPTALKS_WORKER_COUNT||aa:0,this._messages=[],this._messageBuffers=[]}var e=t.prototype;return e.acquire=function(t){if(!this.workers){this.workers=[];for(var e=function(){if("undefined"==typeof window)return null;if(!ia$1){var t=function(){var t="\n    var adapters = {};\n    onmessage = function (msg) {\n        msg = msg.data;\n        if (msg.messageType === 'batch') {\n            const messages = msg.messages;\n            if (messages) {\n                for (let i = 0; i < messages.length; i++) {\n                    dispatch(messages[i]);\n                }\n            }\n        } else {\n            dispatch(msg);\n        }\n    };\n\n    function dispatch(msg) {\n        var workerKey = msg.workerKey;\n        var adapter = adapters[workerKey];\n        if (!adapter) {\n            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);\n            return;\n        }\n        try {\n            adapter.onmessage(msg, wrap(msg.callback));\n        } catch (err) {\n            post(msg.callback, workerKey + ':' + err.message);\n            console.error(err);\n            throw err;\n        }\n    }\n\n    function post(callback, err, data, buffers) {\n        var msg = {\n            callback : callback\n        };\n        if (err) {\n            msg.error = err;\n        } else {\n            msg.data = data;\n        }\n        if (buffers && buffers.length > 0) {\n            postMessage(msg, buffers);\n        } else {\n            postMessage(msg);\n        }\n    }\n    function wrap(callback) {\n        return function (err, data, buffers) {\n            post(callback, err, data, buffers);\n        };\n    }\n    var workerExports;\n";for(var e in na$1){var n=na$1[e];Hn$3(n)&&0===n.length&&(n=n()),t+="\n    workerExports = {};\n    ("+n+")(workerExports, self);\n    adapters['"+e+"'] = workerExports",t+="\n    workerExports.initialize && workerExports.initialize(self);\n        "}return t+"\n    workerExports = null;\n"}();ia$1=window.URL.createObjectURL(new Blob([t],{type:"text/javascript"})),na$1=null}return ia$1}(),n=0;n<this.workerCount;n++){var i=new Worker(e);i.id=n,this.workers.push(i)}URL.revokeObjectURL(e)}return this.active[t]=!0,this.workers.slice()},e.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},e.addMessage=function(t,e,n){var i=this._messages[t];i&&i.length||(i=this._messages[t]=[new ha]);var r=i[i.length-1];r.isFull()&&(r=new ha,this._messages[t].push(r)),r.addMessage(e,n)},e.commit=function(){if(this._messages.length)for(var t=0;t<this._messages.length;t++)if(this._messages[t]&&this._messages[t].length){var e=this._messages[t].shift();this.workers[t].postMessage(e.getMessage(),e.buffers)}},t}();function ca(){return oa$1||(oa$1=new la$1),oa$1}Ei$4&&Ei$4((function t(){ca().commit(),Ei$4(t)}));var ua$1=0,fa=[],da=function(){function t(t){var e=this;this.workerKey=t,this.workerPool=ca(),this.currentActor=0,this.actorId=zi$4(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach((function(t){t.addEventListener("message",e.receiveFn,!1)}))}var e=t.prototype;return e.isActive=function(){return!!this.workers},e.broadcast=function(t,e,n){var i=this;return function(t,e,n){t.length||n(null,[]);var i=t.length,r=new Array(t.length),o=null;t.forEach((function(t,s){e(t,(function(t,e){t&&(o=t),r[s]=e,0==--i&&n(o,r)}))}))}(this.workers,(function(n,r){i.send(t,e,r,n.id)}),n=n||function(){}),this},e.send=function(t,e,n,i){var r=n?this.actorId+":"+this.callbackID++:null;return n&&(this.callbacks[r]=n),this.post({data:t,callback:String(r)},e,i),this},e.receive=function(t){var e=this,n=t.data,i=n.callback,r=this.callbacks[i];delete this.callbacks[i],"<request>"===n.type?this.actorId===n.actorId&&this[n.command](n.params,(function(t,i,r){var o={type:"<response>",callback:n.callback};t?o.error=t.message:o.data=i,e.post(o,r||fa,n.workerId)})):r&&n.error?r(n.error):r&&r(null,n.data)},e.remove=function(){var t=this;this.workers.forEach((function(e){e.removeEventListener("message",t.receiveFn,!1)})),this.workerPool.release(this.actorId),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},e.post=function(t,e,n){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),t.workerId=n,t.workerKey=this.workerKey,t.actorId=this.actorId,this.workerPool.addMessage(n,t,e||fa),n},e.getDedicatedWorker=function(){return ua$1=(ua$1+1)%this.workerPool.workerCount},t}(),ma=[],ga=function(t){function e(){return t.call(this,"core-fetch-image")||this}return Pi$4(e,t),e.prototype.fetchImage=function(t,e){this.send({url:t},ma,e)},e}(da),pa=function(t){function e(e){var n;return(n=t.call(this)||this).layer=e,n._painted=!1,n._drawTime=0,!Si$4.decodeImageInWorker||"gl"!==e.options.renderer&&(Si$4.safari||Si$4.iosWeixin)||(n._resWorkerConn=new ga),n.setToRedraw(),n}Pi$4(e,t);var n=e.prototype;return n.render=function(t){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new _a),this.checkAndDraw(this._tryToDraw,t))},n.checkAndDraw=function(t){var e=this;this._toRedraw=!1;for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.checkResources){var o=this.checkResources();o.length>0?(this._loadingResource=!0,this.loadResources(o).then((function(){e._loadingResource=!1,e.layer&&(e.layer.fire("resourceload"),e.setToRedraw())}))):t.call.apply(t,[this].concat(i))}else t.call.apply(t,[this].concat(i))},n.testIfNeedRedraw=function(){var t=this.getMap();return!(this._loadingResource||!this._toRedraw&&(t.isInteracting()&&!this.drawOnInteracting||!this.needToRedraw()))},n.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()&&!t.getRenderer().isViewChanged()||!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving)},n.onSkipDrawOnInteracting=function(){},n.isLoadingResource=function(){return this._loadingResource},n.isRenderComplete=function(){return!!this._renderComplete},n.mustRenderOnInteracting=function(){return!this._painted},n.setToRedraw=function(){return this._toRedraw=!0,this},n.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},n.isCanvasUpdated=function(){return!!this._canvasUpdated},n.remove=function(){this.onRemove(),delete this._loadingResource,delete this.southWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,delete this.layer},n.onRemove=function(){},n.onAdd=function(){},n.getMap=function(){return this.layer?this.layer.getMap():null},n.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.southWest)._add(0,-t.height);return{image:this.canvas,layer:this.layer,point:e}},n.clear=function(){this.clearCanvas()},n.isBlank=function(){return!this._painted},n.show=function(){this.setToRedraw()},n.hide=function(){this.clear(),this.setToRedraw()},n.setZIndex=function(){this.setToRedraw()},n.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var e=this.getMap(),n=e.getDevicePixelRatio(),i=e.getSize();if(t.x<0||t.x>i.width*n||t.y<0||t.y>i.height*n)return!1;var r=this.getImageData&&this.getImageData();if(r){var o=Math.round(n*t.x),s=Math.round(n*t.y);return r.data[s*r.width*4+4*o+3]>0}try{if(this.context.getImageData(n*t.x,n*t.y,1,1).data[3]>0)return!0}catch(t){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",t),this._errorThrown=!0),!1}return!1},n.loadResources=function(t){this.resources||(this.resources=new _a);var e=this.resources,n=[];if(Ji$4(t))for(var i={},r=t.length-1;r>=0;r--){var o=t[r];o&&o.length&&!i[o.join("-")]&&(i[o.join("-")]=1,e.isResourceLoaded(o,!0)||n.push(new as$1(this._promiseResource(o))))}return as$1.all(n)},n.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t._get2DExtent(),this.southWest=t._containerPointToPoint(new Ii$4(0,t.height))},n.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),n=t.getDevicePixelRatio(),i=Math.round(n*e.width),r=Math.round(n*e.height);if(this.layer._canvas){var o=this.layer._canvas;o.width=i,o.height=r,o.style&&(o.style.width=e.width+"px",o.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=is$1.createCanvas(i,r,t.CanvasClass);this.onCanvasCreate()}},n.onCanvasCreate=function(){},n.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=is$1.getCanvas2DContext(this.canvas),this.context)){this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();1!==t&&this.context.scale(t,t)}},n.resetCanvasTransform=function(){if(this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},n.resizeCanvas=function(t){var e=this.canvas;if(e){var n=t||this.getMap().getSize(),i=this.getMap().getDevicePixelRatio(),r=fr$4(n,i),o=r.width,s=r.height,a=r.cssWidth,h=r.cssHeight;!this.layer._canvas||e.style.width===a&&e.style.height===h||(e.style.width=a,e.style.height=h),e.width===o&&e.height===s||(e.height=s,e.width=o,1!==i&&this.context&&this.context.scale(i,i))}},n.clearCanvas=function(){if(this.context&&this.getMap()){var t=1/this.getMap().getDevicePixelRatio(),e=this.canvas.height*t;is$1.clearRect(this.context,0,0,Math.max(this.canvas.width*t,this.canvas.width),Math.max(e,this.canvas.height))}},n.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getMaskPainter().get2DExtent();return e.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e},n.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;var n=this.southWest,i=this.getMap();this.southWest=i._containerPointToPoint(new Ii$4(0,i.height)),t.save();var r=i.getDevicePixelRatio();if(1!==r&&(t.save(),t.scale(r,r)),e.getGeometries){t.isMultiClip=!0;var o=e.getGeometries()||[];t.beginPath(),o.forEach((function(e){e._getMaskPainter().paint(null,t)})),t.stroke(),t.isMultiClip=!1}else t.isClip=!0,t.beginPath(),e._getMaskPainter().paint(null,t),t.isClip=!1;return 1!==r&&t.restore(),t.clip(),this.southWest=n,!0},n.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,southWest:this.southWest}},n.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},n.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},n.onZoomStart=function(){},n.onZoomEnd=function(){this.setToRedraw()},n.onZooming=function(){},n.onMoveStart=function(){},n.onMoving=function(){},n.onMoveEnd=function(){this.setToRedraw()},n.onResize=function(){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},n.onDragRotateStart=function(){},n.onDragRotating=function(){},n.onDragRotateEnd=function(){this.setToRedraw()},n.onSpatialReferenceChange=function(){},n.getDrawTime=function(){return this._drawTime},n._tryToDraw=function(t){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(t)},n._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var n=In$3();this.draw(t),n=In$3()-n,this._drawTime=e?n:n/2,e&&this.layer&&this.layer.options.logDrawTime&&console.log(this.layer.getId(),"frameTimeStamp:",t,"drawTime:",this._drawTime)}},n._promiseResource=function(t){var e=this,n=this.resources,i=this.layer.options.crossOrigin,r=this.layer.options.renderer||"";return function(o){if(n.isResourceLoaded(t,!0))o(t);else if(!ki$4(t[0])&&e._resWorkerConn){var s=lr$4(t[0]);e._resWorkerConn.fetchImage(s,(function(n,i){if(n)return n&&"undefined"!=typeof console&&console.warn(n),void o(t);hr$4(i,(function(n){e._cacheResource(t,n),o(t)}))}))}else{var a=new Image;Dn$3(i)?"canvas"!==r&&(a.crossOrigin=""):a.crossOrigin=i,ki$4(t[0])&&!Un$3&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),a.onload=function(){e._cacheResource(t,a),o(t)},a.onabort=function(e){console&&console.warn("image loading aborted: "+t[0]),e&&console&&console.warn(e),o(t)},a.onerror=function(e){e&&"undefined"!=typeof console&&console.warn(e),n.markErrorResource(t),o(t)},Di$4(a,t)}}},n._cacheResource=function(t,e){if(this.layer&&this.resources){var n=t[1],i=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===ki$4(t[0])&&(Si$4.edge||Si$4.ie)){Dn$3(n)&&(n=e.width||this.layer.options.defaultIconSize[0]),Dn$3(i)&&(i=e.height||this.layer.options.defaultIconSize[1]);var r=is$1.createCanvas(n,i);is$1.image(r.getContext("2d"),e,0,0,n,i),e=r}this.resources.addResource(t,e)}},e}(cs$2),_a=function(){function t(){this.resources={},this._errors={}}var e=t.prototype;return e.addResource=function(t,e){var n=this;if(this.resources[t[0]]={image:e,width:+t[1],height:+t[2],refCnt:0},e&&!e.close&&Si$4.imageBitMap&&!Si$4.safari&&!Si$4.iosWeixin){if(e.src&&ki$4(e.src))return;createImageBitmap(e).then((function(e){n.resources[t[0]]&&(n.resources[t[0]].image=e)}))}},e.isResourceLoaded=function(t,e){if(!t)return!1;var n=this._getImgUrl(t);if(this._errors[n])return!0;var i=this.resources[n];return!(!i||e&&ki$4(t[0])&&(+t[1]>i.width||+t[2]>i.height))},e.login=function(t){var e=this.resources[t];e&&e.refCnt++},e.logout=function(t){var e=this.resources[t];e&&e.refCnt--<=0&&delete this.resources[t]},e.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},e.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},e.merge=function(t){if(!t)return this;for(var e in t.resources){var n=t.resources[e];this.addResource([e,n.width,n.height],n.image)}return this},e.forEach=function(t){if(!this.resources)return this;for(var e in this.resources)Bn$3(this.resources,e)&&t(e,this.resources[e]);return this},e._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},e.remove=function(){for(var t in this.resources){var e=this.resources[t];e&&e.image&&e.image.close&&e.image.close()}this.resources={}},t}();Si$4.decodeImageInWorker&&(na$1["core-fetch-image"]=function(){return"\nfunction (exports) {\n    exports.onmessage = function (msg, postResponse) {\n        var url = msg.data.url;\n        var fetchOptions = msg.data.fetchOptions;\n        requestImageOffscreen(url, function (err, data) {\n            var buffers = [];\n            if (data && data.data) {\n                buffers.push(data.data);\n            }\n            postResponse(err, data, buffers);\n        }, fetchOptions);\n    };\n\n    var offCanvas, offCtx;\n    function requestImageOffscreen(url, cb, fetchOptions) {\n        if (!offCanvas) {\n            offCanvas = new OffscreenCanvas(2, 2);\n            offCtx = offCanvas.getContext('2d',{willReadFrequently: true });\n        }\n        fetch(url, fetchOptions ? fetchOptions : {})\n            .then(response => response.blob())\n            .then(blob => createImageBitmap(blob))\n            .then(bitmap => {\n                // var { width, height } = bitmap;\n                // offCanvas.width = width;\n                // offCanvas.height = height;\n                // offCtx.drawImage(bitmap, 0, 0);\n                // bitmap.close();\n                // var imgData = offCtx.getImageData(0, 0, width, height);\n                // debugger\n                // https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Transferable_objects#supported_objects\n                cb(null, {data:bitmap});\n            }).catch(err => {\n                console.warn('error when loading tile:', url);\n                console.warn(err);\n                cb(err);\n            });\n    }\n}"});var ba=new Ii$4(0,0);function wa(t,e,n,i,r,o,s){var a,h,l=ba.set(e,n),c=t.set(l.x,l.y,l.x+o,l.y+s);return c._add(r),i&&(h=i,Oa.set((a=c).xmin,a.ymin,a.xmax,a.ymax),Oa.convertTo((function(t){return t._rotate(h)}),a)),c}var Ca=[];function Ma(t,e,n){var i=Aa(e,(n=n||Ea(Ca,e))[0],n[1]);return wa(t,e.markerDx||0,e.markerDy||0,Ra(e),i,n[0],n[1])}function Ta(t){return"rectangle"===t?"right":"middle"}function Sa(t){return"bar"===t||"pie"===t||"pin"===t?"top":"rectangle"===t?"bottom":"middle"}var Pa=new Yr$4(0,0);function Aa(t,e,n){var i=2*(t.shadowBlur||0)+.5;Pa.width=e,Pa.height=n;var r=t.markerType,o=ho$3(Pa,t.markerHorizontalAlignment||Ta(r),t.markerVerticalAlignment||Sa(r));return o.x!==-e/2&&(o.x-=Vi$4(o.x+e/2)*i),o.y!==-n/2&&(o.y-=Vi$4(o.y+n/2)*i),o}function Ea(t,e){var n=Gi$4(e.markerWidth,10),i=Gi$4(e.markerHeight,10),r=Gi$4(e.markerLineWidth,1),o=2*((e.shadowBlur||0)+Math.max(Math.abs(e.shadowOffsetX||0)+Math.abs(e.shadowOffsetY||0))),s=Math.round(n+r+o+1),a=Math.round(i+r+o+1);return t[0]=s,t[1]=a,t}var Oa=new Ls$1;function Ra(t,e){void 0===e&&(e="markerRotation");var n=t[e];return Ln$3(n)?-n*Math.PI/180:0}function Ia(t,e,n){var i=n?n.getImage(e.markerFile):null,r=e.markerWidth||(i?i.width:0),o=e.markerHeight||(i?i.height:0);Pa.width=r,Pa.height=o;var s=ho$3(Pa,e.markerHorizontalAlignment||"middle",e.markerVerticalAlignment||"top");return wa(t,e.markerDx||0,e.markerDy||0,Ra(e),s,r,o)}function ka(t,e,n){var i=n.size,r=ho$3(i,e.textHorizontalAlignment,e.textVerticalAlignment);if(e.textHaloRadius){var o=e.textHaloRadius;i=i.add(2*o,2*o)}return wa(t,e.textDx||0,e.textDy||0,Ra(e,"textRotation"),r,i.width,i.height)}var Da=new Ls$1;function La(t,e,n,i){var r=t||new Ls$1;if(Array.isArray(e)){for(var o=e,s=0;s<o.length;s++)La(r,o[s],n,i[s]);return r}return za(e)&&r._combine(ka(Da,e,i)),Fa(e)&&r._combine(Ia(Da,e,n)),ja(e)&&r._combine(Ma(Da,e)),Ha(e)&&r._combine(Ia(Da,e)),r}function za(t){return!!t&&!Dn$3(t.textName)}function Fa(t){return!!t&&!Dn$3(t.markerFile)}function ja(t){return!!t&&!(!Dn$3(t.markerFile)||Dn$3(t.markerType)||"path"===t.markerType)}function Ha(t){return!!t&&!(!Dn$3(t.markerFile)||"path"!==t.markerType)}var Na,Ba=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation"],Ga=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY","textWrapWidth"];function Va(t,e,n,i){for(var r,o=[],s=0,a=0,h=t.length;a<h-1;a++)(r=Wa(t[a],t[a+1],e,a,n,i))&&(o[s]=o[s]||[],o[s].push({point:r[0],index:a}),r[1]===t[a+1]&&a!==h-2||(o[s].push({point:r[1],index:a+1}),s++));return o}function Wa(t,e,n,i,r,o){var s,a,h,l=i?Na:Xa(t,n),c=Xa(e,n);for(Na=c;;){if(!(l|c))return[t,e];if(l&c)return!1;if(o)return[t,e];h=Xa(a=Za(t,e,s=l||c,n,r),n),s===l?(t=a,l=h):(e=a,c=h)}}function Ua(t,e,n){var i,r,o,s,a,h,l,c,u,f=[1,4,2,8];for(r=0,l=t.length;r<l;r++)t[r]._code=Xa(t[r],e);for(s=0;s<4;s++){for(c=f[s],i=[],r=0,o=(l=t.length)-1;r<l;o=r++)h=t[o],(a=t[r])._code&c?h._code&c||((u=Za(h,a,c,e,n))._code=Xa(u,e),i.push(u)):(h._code&c&&((u=Za(h,a,c,e,n))._code=Xa(u,e),i.push(u)),i.push(a));t=i}return t}function Za(t,e,n,i,r){var o,s,a=e.x-t.x,h=e.y-t.y,l=i.getMin(),c=i.getMax();8&n?(o=t.x+a*(c.y-t.y)/h,s=c.y):4&n?(o=t.x+a*(l.y-t.y)/h,s=l.y):2&n?(o=c.x,s=t.y+h*(c.x-t.x)/a):1&n&&(o=l.x,s=t.y+h*(l.x-t.x)/a);var u=new Ii$4(o,s);return r&&u._round(),u}function Xa(t,e){var n=0;return t.x<e.getMin().x?n|=1:t.x>e.getMax().x&&(n|=2),t.y<e.getMin().y?n|=4:t.y>e.getMax().y&&(n|=8),n}function Ja(t,e,n,i){t=new Ii$4(t);var r,o,s,a=Math.abs(n.x-e.x),h=Math.abs(n.y-e.y),l=Math.sqrt(Math.abs(a*a-h*h));return a>=h?(r=new Ii$4(e.x-l,e.y),o=new Ii$4(e.x+l,e.y),s=2*a):(r=new Ii$4(e.x,e.y-l),o=new Ii$4(e.x,e.y+l),s=2*h),t.distanceTo(r)+t.distanceTo(o)<=s+2*i}var qa=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n._prepareContext=function(t){if(Mr$4(this.symbol.opacity)?this._opacityFn||(this._opacityFn=Sr$4(this.symbol.opacity)):delete this._opacityFn,Ln$3(this.symbol.opacity))t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var e=this.getMap();t.globalAlpha=this._opacityFn(e.getZoom())}else 1!==t.globalAlpha&&(t.globalAlpha=1)},n.prepareCanvas=function(t,e,n){t.setLineDash&&Ji$4(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var i=this.getPainter().isHitTesting();is$1.prepareCanvas(t,e,n,i)},n.remove=function(){},n.setZIndex=function(){},n.show=function(){},n.hide=function(){},n._defineStyle=function(t){return Wr$4(t,this.geometry)},e}(function(){function t(){}var e=t.prototype;return e.getMap=function(){return this.geometry.getMap()},e.getPainter=function(){return this.painter},e.isDynamicSize=function(){return!1},t.testColor=function(t){return!(!t||!jn$3(t))&&Rn$3.indexOf(t)>=0},t}());function Ya(t,e,n,i){var r,o=Ka(n),s=n,a=s.markerType.toLowerCase(),h=Qa(a,s.markerWidth,s.markerHeight),l=o.lineOpacity,c=o.polygonOpacity;fo$3(o.polygonFill)&&fo$3(o.polygonFill)&&(r||(r=function(t,e,n){var i=new Ls$1;return i._combine(t),i.xmin+=-e/2,i.ymin+=-n/2,i.xmax+=e/2,i.ymax+=n/2,i}(e,s.markerWidth,s.markerHeight)),o.polygonGradientExtent=r),is$1.prepareCanvas(t,o,i);var u=s.markerWidth,f=s.markerHeight,d=s.markerLineWidth/2;if("ellipse"===a)is$1.ellipse(t,e,u/2,f/2,f/2,l,c);else if("cross"===a||"x"===a){for(var m=h.length-1;m>=0;m--)h[m]._add(e);is$1.path(t,h.slice(0,2),l),is$1.path(t,h.slice(2,4),l)}else if("diamond"===a||"bar"===a||"square"===a||"rectangle"===a||"triangle"===a){"bar"===a?e=e.add(0,-d):"rectangle"===a&&(e=e.add(d,d));for(var g=h.length-1;g>=0;g--)h[g]._add(e);is$1.polygon(t,h,l,c)}else if("pin"===a){e=e.add(0,-d);for(var p=h.length-1;p>=0;p--)h[p]._add(e);var _=t.lineCap;t.lineCap="round",is$1.bezierCurveAndFill(t,h,l,c),t.lineCap=_}else{if("pie"!==a)throw new Error("unsupported markerType: "+a);e=e.add(0,-d);var v=180*Math.atan(u/2/f)/Math.PI,y=t.lineCap;t.lineCap="round",is$1.sector(t,e,f,[90-v,90+v],l,c),t.lineCap=y}return t.canvas}function Ka(t){var e={lineColor:t.markerLineColor,linePatternFile:t.markerLinePatternFile,lineWidth:t.markerLineWidth,lineOpacity:t.markerLineOpacity,lineDasharray:t.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:t.markerFill,polygonPatternFile:t.markerFillPatternFile,polygonOpacity:t.markerFillOpacity};return 0===e.lineWidth&&(e.lineOpacity=0),e}function Qa(t,e,n){var i,r,o,s,a=n/2,h=e/2;if("triangle"===t)return[i=new Ii$4(0,0-a),r=new Ii$4(0-h,0+a),o=new Ii$4(0+h,0+a)];if("cross"===t)return[i=new Ii$4(0-h,0),r=new Ii$4(0+h,0),o=new Ii$4(0,0-a),s=new Ii$4(0,0+a)];if("diamond"===t)return[i=new Ii$4(0-h,0),r=new Ii$4(0,0-a),o=new Ii$4(0+h,0),s=new Ii$4(0,0+a)];if("square"===t)return[i=new Ii$4(0-h,0+a),r=new Ii$4(0+h,0+a),o=new Ii$4(0+h,0-a),s=new Ii$4(0-h,0-a)];if("rectangle"===t)return r=(i=new Ii$4(0,0)).add(e,0),o=i.add(e,n),s=i.add(0,n),[i,r,o,s];if("x"===t)return[i=new Ii$4(0-h,0+a),r=new Ii$4(0+h,0-a),o=new Ii$4(0+h,0+a),s=new Ii$4(0-h,0-a)];if("bar"===t)return[i=new Ii$4(0-h,0-n),r=new Ii$4(0+h,0-n),o=new Ii$4(0+h,0),s=new Ii$4(0-h,0)];if("pin"===t||"pie"===t){var l=n*Math.atan(h/a);return[i=new Ii$4(0,0),r=new Ii$4(0-l,0-n),o=new Ii$4(0+l,0-n),s=new Ii$4(0,0)]}return[]}var $a,th$1=new Ii$4(0,0),eh$1=new Ii$4(0,0),nh$1=new Ii$4(0,0),ih$1=new Ii$4(0,0),rh$1=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).symbol=e,r.geometry=n,r.painter=i,r}Pi$4(e,t);var n=e.prototype;return n.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLRes(),n=new Ls$1,i=this._getRenderPoints()[0],r=i.length-1;r>=0;r--)i[r]&&n._combine(t._pointAtResToPoint(i[r],e));return n},n.isDynamicSize=function(){var t=this.symbol;return Mr$4(t.markerWidth)||Mr$4(t.markerHeight)||Mr$4(t.textSize)},n._rotateExtent=function(t,e){return t.convertTo((function(t){return t._rotate(e)}))},n._getRenderPoints=function(){var t=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(t)},n._getRenderContainerPoints=function(t){var e=this.getPainter();if(e.isSpriting())return this._getRenderPoints()[0];var n,i=this.geometry,r=this.getDxDy();if(i._cPoint&&!t){var o=t?nh$1:ih$1;o.set(i._cPoint.x,i._cPoint.y),o._sub(e.containerOffset);var s=r.x,a=r.y;(s||a)&&o._add(s||0,a||0),n=[o]}else{var h=this._getRenderPoints()[0];n=this.painter._pointContainerPoints(h,r.x,r.y,t,!0,this.getPlacement())}if(!n||!Array.isArray(n[0]))return n;for(var l=[],c=0,u=n.length;c<u;c++)for(var f=0,d=n[c].length;f<d;f++)l.push(n[c][f]);return l},n.getPlacement=function(){return this.symbol.markerPlacement},n.getRotation=function(){return Ra(this.style)},n.getDxDy=function(){var t=this.style;return new Ii$4(t.markerDx,t.markerDy)},n._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var n=this._getRenderPoints()[1];if(!n||!n[t])return e;var i=this.getMap(),r=n[t][0],o=n[t][1];if(i.isTransforming()){var s=i.getGLRes();return r=i._pointAtResToContainerPoint(n[t][0],s,0,th$1),o=i._pointAtResToContainerPoint(n[t][1],s,0,eh$1),e+nr$4(r.x,r.y,o.x,o.y)}return e+-nr$4(r.x,r.y,o.x,o.y)},n._rotate=function(t,e,n){if(n){var i=this.getDxDy(),r=e.sub(i);return t.save(),t.translate(r.x,r.y),t.rotate(n),i}return null},e}(qa),oh$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.getPlacement=function(){return"point"},n.getDxDy=function(){return new Ii$4(0,0)},n.symbolize=function(t){var e=this.geometry,n=e.getLayer();if(e.options.debug||!n||n.options.debug){var i=this.getMap();if(i&&!i.isZooming()){var r=n.options.debugOutline;t.strokeStyle=r,t.fillStyle=r;var o=e.getContainerExtent().toArray();is$1.polygon(t,[o],1,0);for(var s=this._getRenderContainerPoints(),a=this.geometry.getId(),h=Qa("cross",10,10),l=0;l<s.length;l++){var c=s[l];Dn$3(a)||is$1.fillText(t,a,c.add(8,-4),r);for(var u=[],f=0;f<h.length;f++)u.push(h[f].add(c));is$1.path(t,u.slice(0,2),1),is$1.path(t,u.slice(2,4),1)}}}},e}(rh$1),sh$1=new Yr$4(1,1),ah$1=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this).style=r._defineStyle(r.translate()),r}Pi$4(e,t),e.test=function(t){return Fa(t)};var n=e.prototype;return n.symbolize=function(t,e){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&0!==n.markerOpacity){var i=this._getRenderContainerPoints();if(Ji$4(i)){var r=this._getImage(e);if(r){this._prepareContext(t);var o,s=n.markerWidth,a=n.markerHeight;if(!Ln$3(s)||!Ln$3(a)){a=r.height,n.markerWidth=s=r.width,n.markerHeight=a;var h=n.markerFile;e.isResourceLoaded(h)||e.addResource(h,r);var l=this.getPainter();l.isSpriting()||l.removeCache()}"path"!==this.symbol.markerType&&Ln$3(n.markerOpacity)&&n.markerOpacity<1&&(o=t.globalAlpha,t.globalAlpha*=n.markerOpacity),sh$1.width=s,sh$1.height=a;for(var c=ho$3(sh$1,n.markerHorizontalAlignment,n.markerVerticalAlignment),u=0,f=i.length;u<f;u++){var d=i[u],m=this.getRotation()?this._rotate(t,d,this._getRotationAt(u)):null;m&&(d=m),is$1.image(t,r,d.x+c.x,d.y+c.y,s,a),m&&t.restore()}void 0!==o&&(t.globalAlpha=o)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}},n._getImage=function(t){return function(t,e){return t&&t.getImage(e)||null}(t,this.style.markerFile)},n.getFixedExtent=function(t){return this._fixedExtent=this._fixedExtent||new Ls$1,Ia(this._fixedExtent,this.style,t)},n.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:Gi$4(t.markerOpacity,1),markerWidth:Gi$4(t.markerWidth,null),markerHeight:Gi$4(t.markerHeight,null),markerRotation:Gi$4(t.markerRotation,0),markerDx:Gi$4(t.markerDx,0),markerDy:Gi$4(t.markerDy,0),markerHorizontalAlignment:Gi$4(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:Gi$4(t.markerVerticalAlignment,"top")}},e}(rh$1),hh$1=new ys$1(0,0),lh$1=new ys$1(0,0),ch$1=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).symbol=e,r.geometry=n,r.painter=i,"Point"===n.type?Ai$4(r):(r.style=r._defineStyle(r.translate()),r)}Pi$4(e,t),e.test=function(t,e){if(!t)return!1;if(e&&"Point"===e.type)return!1;for(var n in t){var i=n.slice(0,4);if("line"===i||"poly"===i)return!0}return!1};var n=e.prototype;return n.symbolize=function(t,e){var n=this.style;if(0!==n.polygonOpacity||0!==n.lineOpacity||this.painter.isHitTesting()){var i=this._getPaintParams();if(i){this._prepareContext(t);var r=fo$3(n.lineColor),o="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!n.lineColor.places&&o||(n.lineGradientExtent=this.geometry.getContainerExtent()._expand(n.lineWidth)),fo$3(n.polygonFill)&&(n.polygonGradientExtent=this.geometry.getContainerExtent());var s=i[0];if("Polygon"===this.geometry.getJSONType()&&s.length>0&&Array.isArray(s[0][0])||"LineString"===this.geometry.type&&s.length>0&&Array.isArray(s[0]))for(var a=0;a<s.length;a++){this.prepareCanvas(t,n,e),r&&o&&!n.lineColor.places&&this._createGradient(t,s[a],n.lineColor);var h=[t,s[a]];i.length>1&&h.push.apply(h,i.slice(1)),h.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray),this.geometry._paintOn.apply(this.geometry,h)}else{this.prepareCanvas(t,n,e),r&&o&&!n.lineColor.places&&this._createGradient(t,s,n.lineColor);var l=[t];l.push.apply(l,i),l.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray),this.geometry._paintOn.apply(this.geometry,l)}t.setLineDash&&Array.isArray(n.lineDasharray)&&t.setLineDash([])}}},n.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new ys$1(0,0),this._extMax=new ys$1(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var n=t._prjToPoint(this._extMin,void 0,hh$1),i=t._prjToPoint(this._extMax,void 0,lh$1);return this._pxExtent?this._pxExtent.set(Math.min(n.x,i.x),Math.min(n.y,i.y),Math.max(n.x,i.x),Math.max(n.y,i.y)):this._pxExtent=new Ls$1(n,i),this._pxExtent},n.getFixedExtent=function(){var t=this.style.lineWidth/2;return new Ls$1(-t,-t,t,t)},n._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},n.translate=function(){var t=this.symbol,e={lineColor:Gi$4(t.lineColor,"#000"),lineWidth:Gi$4(t.lineWidth,2),lineOpacity:Gi$4(t.lineOpacity,1),lineDasharray:Gi$4(t.lineDasharray,[]),lineCap:Gi$4(t.lineCap,"butt"),lineJoin:Gi$4(t.lineJoin,"miter"),linePatternFile:Gi$4(t.linePatternFile,null),lineDx:Gi$4(t.lineDx,0),lineDy:Gi$4(t.lineDy,0),polygonFill:Gi$4(t.polygonFill,null),polygonOpacity:Gi$4(t.polygonOpacity,1),polygonPatternFile:Gi$4(t.polygonPatternFile,null),polygonPatternDx:Gi$4(t.polygonPatternDx,0),polygonPatternDy:Gi$4(t.polygonPatternDy,0),linePatternDx:Gi$4(t.linePatternDx,0),linePatternDy:Gi$4(t.linePatternDy,0)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},n._createGradient=function(t,e,n){if(Array.isArray(e)&&e.length){var i=e.length,r=t.createLinearGradient(e[0].x,e[0].y,e[i-1].x,e[i-1].y);n.colorStops.forEach((function(t){r.addColorStop.apply(r,t)})),t.strokeStyle=r}},e}(qa),uh$1=function(t){function e(e,n,i){var r,o=(r=t.call(this,e,n,i)||this).translate();return r._dynamic=Tr$4(o),r.style=r._defineStyle(o),0===r.style.textWrapWidth?Ai$4(r):(r.strokeAndFill=r._defineStyle(r.translateLineAndFill(r.style)),r)}Pi$4(e,t),e.test=function(t){return za(t)};var n=e.prototype;return n.symbolize=function(t,e){if(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth){var n=this._getRenderContainerPoints();if(Ji$4(n)){var i=this.style,r=this.strokeAndFill,o=so$3(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var s=this._textDesc=this._textDesc||ao$3(o,this.style);this._prepareContext(t),this.prepareCanvas(t,r,e),is$1.prepareCanvasFont(t,i);for(var a=0,h=n.length;a<h;a++){var l=n[a],c=this.getRotation()?this._rotate(t,l,this._getRotationAt(a)):null;c&&(l=c),is$1.text(t,o,l,i,s),c&&t.restore()}}}},n.getPlacement=function(){return this.symbol.textPlacement},n.getRotation=function(){var t=this.style.textRotation;return Ln$3(t)?-t*Math.PI/180:null},n.getDxDy=function(){var t=this.style;return new Ii$4(t.textDx,t.textDy)},n.getFixedExtent=function(){var t=this.geometry.getTextDesc();return Array.isArray(t)&&(t=t[this._index]),this._fixedExtent=this._fixedExtent||new Ls$1,t?ka(this._fixedExtent,this.style,t):this._fixedExtent},n.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:Gi$4(t.textFaceName,"monospace"),textWeight:Gi$4(t.textWeight,"normal"),textStyle:Gi$4(t.textStyle,"normal"),textSize:Gi$4(t.textSize,14),textFont:Gi$4(t.textFont,null),textFill:Gi$4(t.textFill,"#000"),textOpacity:Gi$4(t.textOpacity,1),textHaloFill:Gi$4(t.textHaloFill,"#ffffff"),textHaloRadius:Gi$4(t.textHaloRadius,0),textHaloOpacity:Gi$4(t.textHaloOpacity,1),textWrapWidth:Gi$4(t.textWrapWidth,null),textWrapCharacter:Gi$4(t.textWrapCharacter,"\n"),textLineSpacing:Gi$4(t.textLineSpacing,0),textDx:Gi$4(t.textDx,0),textDy:Gi$4(t.textDy,0),textHorizontalAlignment:Gi$4(t.textHorizontalAlignment,"middle"),textVerticalAlignment:Gi$4(t.textVerticalAlignment,"middle"),textAlign:Gi$4(t.textAlign,"center"),textRotation:Gi$4(t.textRotation,0),textMaxWidth:Gi$4(t.textMaxWidth,0),textMaxHeight:Gi$4(t.textMaxHeight,0)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},n.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},e}(rh$1),fh$1=[],dh=function(t){function e(e,n,i){var r,o=(r=t.call(this,e,n,i)||this).translate();return r._dynamic=Tr$4(o),r.style=r._defineStyle(o),r.strokeAndFill=r._defineStyle(Ka(r.style)),r.padding=0,r}Pi$4(e,t),e.test=function(t){return ja(t)};var n=e.prototype;return n.symbolize=function(t,e){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&(0!==n.polygonOpacity||0!==n.lineOpacity)){var i=this._getRenderContainerPoints();Ji$4(i)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(t,i,e):this._drawMarkersWithCache(t,i,e))}},n._drawMarkers=function(t,e,n){for(var i=e.length-1;i>=0;i--){var r=e[i],o=this.getRotation()?this._rotate(t,r,this._getRotationAt(i)):null;o&&(r=o),this._drawVectorMarker(t,r,n),o&&t.restore()}},n._drawMarkersWithCache=function(t,e,n){var i=this._stampSymbol(),r=n.getImage(i);r||(r=this._createMarkerImage(t,n),n.addResource([i,r.width,r.height],r));for(var o=Aa(this.style,r.width,r.height),s=e.length-1;s>=0;s--){var a=e[s],h=this.getRotation()?this._rotate(t,a,this._getRotationAt(s)):null;h&&(a=h),is$1.image(t,r,a.x+o.x,a.y+o.y),h&&t.restore()}},n._createMarkerImage=function(t,e){var n=t.canvas.constructor,i=Ea(fh$1,this.style),r=is$1.createCanvas(i[0],i[1],n),o=this._getCacheImageAnchor(i[0],i[1]),s=r.getContext("2d");return this._drawVectorMarker(s,o,e),r},n._stampSymbol=function(){return this._stamp||(this._stamp=uo$3([this.style.markerType,fo$3(this.style.markerFill)?mo$3(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,fo$3(this.style.markerLineColor)?mo$3(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},n._getCacheImageAnchor=function(t,e){var n=2*(this.symbol.shadowBlur||0)+this.padding,i=this.style.markerType;return"bar"===i||"pie"===i||"pin"===i?new Ii$4(t/2,e-n):"rectangle"===i?new Ii$4(n,n):new Ii$4(t/2,e/2)},n._getGraidentExtent=function(t){var e=new Ls$1,n=this.getDxDy(),i=this.getFixedExtent();if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)e._combine(t[r]);else e._combine(t);return e.xmin+=i.xmin-n.x,e.ymin+=i.ymin-n.y,e.xmax+=i.xmax-n.x,e.ymax+=i.ymax-n.y,e},n._drawVectorMarker=function(t,e,n){Ya(t,e,this.style,n)},n.getFixedExtent=function(){var t=this.isDynamicSize(),e=this.style.markerWidth,n=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new Ls$1,Ma(this._fixedExtent,this.style,t?[128,128*(0===e?1:n/e)]:null)},n.translate=function(){var t=this.symbol,e={markerType:Gi$4(t.markerType,"ellipse"),markerFill:Gi$4(t.markerFill,"#00f"),markerFillOpacity:Gi$4(t.markerFillOpacity,1),markerFillPatternFile:Gi$4(t.markerFillPatternFile,null),markerLineColor:Gi$4(t.markerLineColor,"#000"),markerLineWidth:Gi$4(t.markerLineWidth,1),markerLineOpacity:Gi$4(t.markerLineOpacity,1),markerLineDasharray:Gi$4(t.markerLineDasharray,[]),markerLinePatternFile:Gi$4(t.markerLinePatternFile,null),markerDx:Gi$4(t.markerDx,0),markerDy:Gi$4(t.markerDy,0),markerWidth:Gi$4(t.markerWidth,10),markerHeight:Gi$4(t.markerHeight,10),markerRotation:Gi$4(t.markerRotation,0),shadowBlur:Gi$4(t.shadowBlur,0),shadowOffsetX:Gi$4(t.shadowOffsetX,0),shadowOffsetY:Gi$4(t.shadowOffsetY,0)},n=e.markerType,i=Ta(n),r=Sa(n);return e.markerHorizontalAlignment=Gi$4(t.markerHorizontalAlignment,i),e.markerVerticalAlignment=Gi$4(t.markerVerticalAlignment,r),Ln$3(t.markerOpacity)&&(Ln$3(t.markerFillOpacity)&&(e.markerFillOpacity*=t.markerOpacity),Ln$3(t.markerLineOpacity)&&(e.markerLineOpacity*=t.markerOpacity)),e},e}(rh$1),mh=function(t){function e(e,n,i){var r;Dn$3(e.markerWidth)&&(e.markerWidth=80),Dn$3(e.markerHeight)&&(e.markerHeight=80),e=kn$3(e,(r=t.call(this,e,n,i)||this).translate());var o=r.style=r._defineStyle(e);return r._url=Si$4.gecko?[Zr$4(o,o.markerWidth,o.markerHeight),o.markerWidth,o.markerHeight]:[Zr$4(o),o.markerWidth,o.markerHeight],r}Pi$4(e,t),e.test=function(t){return Ha(t)};var n=e.prototype;return n._prepareContext=function(){},n._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var n=this.painter,i=new Image;return i.onload=function(){var t=n.getLayer()&&n.getLayer().getRenderer();t&&t.setToRedraw()},i.onerror=function(n){n&&"undefined"!=typeof console&&console.warn(n),t.markErrorResource(e._url)},i.src=this._url[0],t&&t.addResource(this._url,i),i},e}(ah$1),gh$1={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},ph=[function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this).style=n.getLayer().options.drawAltitude,r.style&&Fn$3(r.style)||(r.style={lineWidth:2}),r.style.lineWidth||(r.style.lineWidth=0),r.dxdy=r._defineStyle({dx:e.textDx||e.markerDx,dy:e.textDy||e.markerDy}),r}Pi$4(e,t),e.test=function(t,e){if(!e.getLayer())return!1;var n=e.getJSONType();return"Marker"===n||"LineString"===n};var n=e.prototype;return n.symbolize=function(t){var e=this.geometry.getLayer();if(e.options.drawAltitude){var n=this.geometry.getProperties();if(n&&n[e.options.altitudeProperty]){var i=this._getStyle();if(this._prepareContext(t),"LineString"===this.geometry.type){var r=this._getPaintParams(i.lineDx,i.lineDy,!1,!0);if(!r)return;var o=this.getPainter().getPaintParams(i.lineDx,i.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(t,r[0],o)}else{var s=this._getRenderContainerPoints(),a=this._getRenderContainerPoints(!0);if(!s||0===s.length)return;this._drawMarkerAltitude(t,s[0],a[0])}}}},n.getDxDy=function(){var t=this.dxdy;return new Ii$4(t.dx||0,t.dy||0)},n.get2DExtent=function(){return"LineString"===this.geometry.type?ch$1.prototype.get2DExtent.apply(this):t.prototype.get2DExtent.call(this)},n.getPlacement=function(){return"point"},n._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0,null,!0,"_altpt")},n._drawMarkerAltitude=function(t,e,n){var i=this._getStyle();this.prepareCanvas(t,i),is$1.path(t,[e,n],i.lineOpacity,null,i.lineDasharray)},n._drawLineAltitude=function(t,e,n){var i=this._getStyle();if(e.length>0&&Array.isArray(e[0]))for(var r=0;r<e.length;r++)this._drawLine(t,e[r],n[r]);else this._drawLine(t,e,n);t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])},n._drawLine=function(t,e,n){var i=this._getStyle();this.prepareCanvas(t,i);for(var r=0,o=e.length-1;r<o;r++)is$1.polygon(t,[e[r],e[r+1],n[r+1],n[r]],i.lineOpacity,i.polygonOpacity,i.lineDasharray)},n._getStyle=function(){var t=this.geometry.getLayer().options.drawAltitude;return Fn$3(t)||(t=gh$1),t.lineWidth||(t.lineWidth=0,t.lineOpacity=0),t},e}(rh$1),ch$1,ah$1,mh,dh,uh$1],_h=new Ii$4(0,0),vh$1=new Ls$1,yh=new Ls$1,xh=new Ls$1,bh=new Ls$1,wh$1=new Ls$1,Ch$1={},Mh={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},Th=function(t){function e(e){var n;return(n=t.call(this)||this).geometry=e,n.symbolizers=n._createSymbolizers(),n._altAtGL=n._getGeometryAltitude(),n}Pi$4(e,t);var n=e.prototype;return n.getMap=function(){return this.geometry.getMap()},n.getLayer=function(){return this.geometry.getLayer()},n._createSymbolizers=function(){var t=this.getSymbol(),e=[],n=ph,i=t;Array.isArray(t)||(i=[t]);for(var r=i.length-1;r>=0;r--)for(var o=i[r],s=n.length-1;s>=0;s--)if(n[s].test(o,this.geometry)){var a=new n[s](o,this.geometry,this);a._index=r,e.push(a),a instanceof rh$1&&(this._hasPoint=!0)}if(!e.length&&console){var h=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(h?":"+h:""):"")+") to draw : "+JSON.stringify(t))}return this._debugSymbolizer=new oh$1(t,this.geometry,this),e},n.hasPoint=function(){return!!this._hasPoint},n.getRenderPoints=function(t){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},n.getPaintParams=function(t,e,n,i,r){void 0===r&&(r="_pt");var o,s,a,h,l,c=this.getLayer()._getRenderer().mapStateCache,u=this.getMap();c&&!this._hitPoint?(o=c.resolution,s=c.pitch,a=c.bearing,h=c.glScale,l=c.containerExtent):(o=u.getResolution(),s=u.getPitch(),a=u.getBearing(),h=u.getGLScale(),l=u.getContainerExtent());var f=this.geometry,d=o,m=0!==s,g=0!==a,p=this._cachedParams,_=f._paintAsPath&&f._paintAsPath();if(_&&this._unsimpledParams&&d<=this._unsimpledParams._res)p=this._unsimpledParams;else if(!p||p._res!==o||this._pitched!==m&&f._redrawWhenPitch()||this._rotated!==g&&f._redrawWhenRotate()){if(!(p=f._getPaintParams()))return null;p._res=d,!f._simplified&&_&&(this._unsimpledParams||(this._unsimpledParams=p),d>this._unsimpledParams._res&&(this._unsimpledParams._res=d)),this._cachedParams=p}if(!p)return null;this._pitched=m,this._rotated=g;var v=h,y=[],x=this._pointContainerPoints(p[0],t,e,n,i||this._hitPoint&&!l.contains(this._hitPoint),null,r);if(!x)return null;y.push(x);for(var b=1,w=p.length;b<w;b++)Ln$3(p[b])||p[b]instanceof Yr$4?Ln$3(p[b])?y.push(p[b]/v):y.push(p[b].multi(1/v)):y.push(p[b]);return y},n._pointContainerPoints=function(t,e,n,i,r,o,s){if(void 0===s&&(s="_pt"),this._aboveCamera())return null;var a,h,l,c=this.getLayer()._getRenderer(),u=c.mapStateCache,f=this.getMap(),d=this.geometry,m=this.containerOffset;u?(a=u.glRes,h=u.containerExtent):(a=f.getGLRes(),h=f.getContainerExtent());var g=this.getLayer().options.roundPoint,p=1/0,_=1/0,v=-1/0,y=-1/0,x=!r,b=c.layer.options.clipBBoxBufferSize||3,w=this.symbolizers;function C(t,i){void 0===t&&(t=[]),void 0===i&&(i=[]);for(var r=ar$4(t,s),o=0,l=(r=f._pointsAtResToContainerPoints(t,a,i,r)).length;o<l;o++){var c=r[o];c._sub(m),(e||n)&&c._add(e||0,n||0),g&&(c.x=Math.ceil(c.x),c.y=Math.ceil(c.y)),p=Math.min(c.x,p),_=Math.min(c.y,_),v=Math.max(c.x,v),y=Math.max(c.y,y)}if(x&&Co$2(w)){if(wh$1.ymin=h.ymin,wh$1.ymin<b&&(wh$1.ymin=h.ymin-b),wh$1.xmin=h.xmin-b,wh$1.xmax=h.xmax+b,wh$1.ymax=h.ymax+b,d.getShell&&d.getHoles)return Ua(r,wh$1);var u=Va(r,wh$1,!1);if(u.length){var C=[];return u.forEach((function(t){for(var e=0,n=t.length;e<n;e++)C.push(t[e].point)})),C}}return r}var M=this.getAltitude();if(Array.isArray(t)){var T;!r&&this.geometry.options.enableClip?(T=this._clip(t,M)).inView&&(x=!1):T={points:t,altitude:M};var S=T.points;M=T.altitude,i&&(M=0);var P=M;l=[];for(var A=[],E=Ln$3(M),O=0,R=S.length;O<R;O++){var I=S[O];if(Array.isArray(I)){if(E){var k=C(I,M);l.push(k);continue}for(var D=[],L=0,z=I.length;L<z;L++)Array.isArray(M)&&(P=M[O]?M[O][L]:0),D.push(P);var F=C(I,D);l.push(F)}else Array.isArray(M)&&(P="vertex-last"===o?M[M.length-1-O]:"line"===o?(M[O]+M[O+1])/2:M[O]),A.push(P)}A.length&&(l=C(S,A))}else t instanceof Ii$4&&(i&&(M=0),l=f._pointAtResToContainerPoint(t,a,M)._sub(m),(e||n)&&l._add(e,n));return Mh.minx=p,Mh.miny=_,Mh.maxx=v,Mh.maxy=y,this._containerBbox=Mh,l},n._clip=function(t,e){if(Ln$3(e)&&0!==e)return{points:t,altitude:e};if(Array.isArray(e)){for(var n=!1,i=0,r=e.length;i<r;i++)if(0!==e[i]){n=!0;break}if(n)return{points:t,altitude:e}}var o=this.getMap(),s=this.geometry,a=this.getSymbol().lineWidth;Ln$3(a)||(a=4);var h,l,c,u=this.getLayer()._getRenderer().mapStateCache;u?(h=u._2DExtent,l=u.glExtent,c=u.pitch):(h=o._get2DExtent(),l=o._get2DExtentAtRes(o.getGLRes()),c=o.getPitch());var f=h._expand(a);if(c>0&&e){var d=o.cameraLookAt,m=o.cameraPosition;_h.set(m.x,m.y),f=f._combine(_h._add(Vi$4(d[0]-m[0]),Vi$4(d[1]-m[1])))}var g=t;if(this.get2DExtent(null,bh).within(f))return{points:g,altitude:e,inView:!0};var p=l._expand(a*o._glScale);xh.xmin=p.xmin,xh.xmax=p.xmax,xh.ymin=p.ymin,xh.ymax=p.ymax;var _=s.options.smoothness;if(s.getShell&&this.geometry.getHoles&&!_){var v=p.ymin,y=p.ymax,x=Math.abs(p.xmax-p.xmin),b=Math.abs(y-v),w=Math.sqrt(x*x+b*b),C=(w-x)/2,M=(w-b)/2;if(xh.xmin=p.xmin-C,xh.xmax=p.xmax+C,xh.ymin=p.ymin-M,xh.ymax=p.ymax+M,Array.isArray(t[0])){g=[];for(var T=0;T<t.length;T++){var S=Ua(t[T],xh);S.length&&g.push(S)}}else g=Ua(t,xh)}else if("LineString"===s.getJSONType()&&!_){if(Array.isArray(t[0])){g=[];for(var P=0;P<t.length;P++)Hi$4(g,Va(t[P],xh,!1,!!_))}else g=Va(t,xh,!1,!!_);return this._interpolateSegAlt(g,t,e)}return{points:g,altitude:e}},n._interpolateSegAlt=function(t,e,n){if(!Array.isArray(n)){var i=function(t){return t.point};return{points:t.map((function(t){return Array.isArray(t)?t.map(i):t.point})),altitude:n}}var r=function t(e,n,i){if(!Array.isArray(i))return e;for(var r=[],o=0,s=e.length;o<s;o++)if(Array.isArray(e[o]))r.push(t(e[o],n,i));else{var a=e[o];if(a.point.equals(n[a.index]))a.altitude=i[a.index],r.push(a);else{var h=void 0,l=void 0;0===a.index?(h=a.index,l=a.index+1):(h=a.index-1,l=a.index);var c=a.point.distanceTo(n[l]),u=c/(c+n[h].distanceTo(a.point)),f=Ui$4(i[h],i[l],1-u);a.altitude=f,r.push(a)}}return r}(t,e,n);return n=[],{points:r.map((function(t){if(Array.isArray(t)){var e=[],i=t.map((function(t){return e.push(t.altitude),t.point}));return n.push(e),i}return n.push(t.altitude),t.point})),altitude:n}},n.getSymbol=function(){return this.geometry._getInternalSymbol()},n.paint=function(t,e,n){if(this.symbolizers){var i=this.getLayer(),r=i._getRenderer();if(r&&(r.context||e)){var o=r.mapStateCache||{};if(this.geometry._isCheck||!t||t.intersects(this.get2DExtent(r.resources,vh$1))){var s=this.getMap(),a=this.getMinAltitude(),h=s.getFrustumAltitude();if(!(a&&h&&h<a)){this.containerOffset=n||o.offset||s._pointToContainerPoint(r.southWest)._add(0,-s.height),this._beforePaint();for(var l=e||r.context,c=[l,r.resources],u=this.symbolizers.length-1;u>=0;u--)(l.shadowBlur||this.symbolizers[u].symbol.shadowBlur)&&this._prepareShadow(l,this.symbolizers[u].symbol),this.symbolizers[u].symbolize.apply(this.symbolizers[u],c);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||i.options.debug)&&this._debugSymbolizer.symbolize.apply(this._debugSymbolizer,c)}}}}},n.getSprite=function(t,e){if("Point"!==this.geometry.type)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var n=new Ls$1;this.symbolizers.forEach((function(e){var i=e.getFixedExtent(t);n._combine(i)}));var i,r=n.getMin().multi(-1),o=e||(this.getMap()?this.getMap().CanvasClass:null),s=is$1.createCanvas(n.getWidth(),n.getHeight(),o);this._renderPoints&&(i=this._renderPoints);for(var a=s.getContext("2d"),h=[a,t],l=this.symbolizers.length-1;l>=0;l--){var c=this.symbolizers[l].getDxDy();this._renderPoints={center:[[r.add(c)]]},this._prepareShadow(a,this.symbolizers[l].symbol),this.symbolizers[l].symbolize.apply(this.symbolizers[l],h)}i&&(this._renderPoints=i),this._sprite={canvas:s,offset:n.getCenter()}}return this._spriting=!1,this._sprite},n.isSpriting=function(){return!!this._spriting},n.hitTest=function(t,e){if((!e||e<.5)&&(e=.5),this._hitPoint=t.sub(e,e),!$a){var n=this.getMap()?this.getMap().CanvasClass:null;$a=is$1.createCanvas(1,1,n)}is$1.setHitTesting(!0),$a.width=$a.height=2*e;var i=is$1.getCanvas2DContext($a);try{this.paint(null,i,this._hitPoint)}catch(t){throw t}finally{is$1.setHitTesting(!1)}delete this._hitPoint;for(var r=i.getImageData(0,0,$a.width,$a.height).data,o=3,s=r.length;o<s;o+=4)if(r[o]>0)return!0;return!1},n.isHitTesting=function(){return!!this._hitPoint},n._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},n._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var n=this.symbolizers.length-1;n>=0;n--)t.apply(e,[this.symbolizers[n]])}},n.get2DExtent=function(t,e){this._verifyProjection();var n=this.getMap();t=t||this.getLayer()._getRenderer().resources;var i=n.getZoom(),r=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===i&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==i&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new Ls$1),this._extent2D._zoom=i),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(t,new Ls$1)))),!this._extent2D)return r&&delete this._fixedExtent,null;var o=this._fixedExtent,s=o.xmin,a=o.ymin,h=o.xmax,l=o.ymax;return r&&delete this._fixedExtent,yh.set(s,-l,h,-a),e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(yh),e):this._extent2D.add(yh)},n._computeExtent2D=function(t){for(var e=this.symbolizers.length-1;e>=0;e--)t._combine(this.symbolizers[e].get2DExtent());return t},n._computeFixedExtent=function(t,e){for(var n=this.symbolizers.length-1;n>=0;n--){var i=this.symbolizers[n];i.getFixedExtent&&e._combine(i.getFixedExtent(t))}return e},n._isDynamicSize=function(){for(var t=this.symbolizers.length-1;t>=0;t--)if(this.symbolizers[t].isDynamicSize())return!0;return!1},n._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap().getFrustumAltitude();return t&&e&&e<t},n.getFixedExtent=function(){var t=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new Ls$1):(this._extent2D&&this._extent2D._zoom===t||this.get2DExtent(null,yh),this._fixedExtent)},n.setZIndex=function(t){this._eachSymbolizer((function(e){e.setZIndex(t)}))},n.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer((function(t){t.show()}))):this.getLayer().isCanvasRender()||this.paint()},n.hide=function(){this._eachSymbolizer((function(t){t.hide()}))},n.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();e&&e.setToRedraw()&&e.setToRedraw()}},n.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},n.remove=function(){this.removeCache(),this._removeSymbolizers()},n._removeSymbolizers=function(){this._eachSymbolizer((function(t){delete t.painter,t.remove()})),delete this.symbolizers},n.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},n.getAltitude=function(){return this.geometry._getAltitude()!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},n.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},n.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},n._getGeometryAltitude=function(){var t=this;if(!this.getMap())return 0;var e=this.geometry._getAltitude();if(this._propAlt=e,!e)return this.minAltitude=this.maxAltitude=0,0;var n=this.geometry.getCenter();return n?Array.isArray(e)?(this.minAltitude=Number.MAX_VALUE,this.maxAltitude=Number.MIN_VALUE,e.map((function(e){var i=t._meterToPoint(n,e);return i<t.minAltitude&&(t.minAltitude=i),i>t.maxAltitude&&(t.maxAltitude=i),i}))):(this.minAltitude=this.maxAltitude=this._meterToPoint(n,e),this.minAltitude):0},n._meterToPoint=function(t,e){var n=this.getMap(),i=n.getGLRes();return n.altitudeToPoint(e,i)*Vi$4(e)},n._verifyProjection=function(){var t=this.geometry._getProjection()||Ch$1;this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},n._beforePaint=function(){},n._afterPaint=function(){},e}(cs$2),Sh=new Ls$1,Ph$1=function(t){function e(e,n){var i;return(i=t.call(this)||this).geometry=e,i.isMask=n,i}Pi$4(e,t);var n=e.prototype;return n._eachPainter=function(t){for(var e,n=this.geometry.getGeometries(),i=0,r=n.length;i<r&&(!(e=this.isMask?n[i]._getMaskPainter():n[i]._getPainter())||!e||!1!==t.call(this,e));i++);},n.paint=function(t){this.geometry&&this._eachPainter((function(e){e.paint(t)}))},n.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var n=e||new Ls$1;return this._eachPainter((function(e){n=n._combine(e.get2DExtent(t,Sh))})),n},n.remove=function(){var t=arguments;this._eachPainter((function(e){e.remove.apply(e,t)}))},n.setZIndex=function(){var t=arguments;this._eachPainter((function(e){e.setZIndex.apply(e,t)}))},n.show=function(){var t=arguments;this._eachPainter((function(e){e.show.apply(e,t)}))},n.hide=function(){var t=arguments;this._eachPainter((function(e){e.hide.apply(e,t)}))},n.repaint=function(){var t=arguments;this._eachPainter((function(e){e.repaint.apply(e,t)}))},n.refreshSymbol=function(){var t=arguments;this._eachPainter((function(e){e.refreshSymbol.apply(e,t)}))},n.hasPoint=function(){var t=!1;return this._eachPainter((function(e){return!e.hasPoint()||(t=!0,!1)})),t},n.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter((function(n){var i=n.getMinAltitude();(t||i<e)&&(t=!1,e=i)})),e},n.getMaxAltitude=function(){var t=0;return this._eachPainter((function(e){var n=e.getMaxAltitude();n>t&&(t=n)})),t},e}(cs$2),Ah$1={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=12756274*Math.PI,n=0;n<23;n++)t[n]=e/(256*Math.pow(2,n));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<23;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{projection:"baidu",resolutions:function(){for(var t=Math.pow(2,18),e=[],n=0;n<23;n++)e[n]=t,t*=.5;return e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var t=Math.pow(2,8),e=[],n=0;n<23;n++)e[n]=t,t*=.5;return e}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=6378137*Math.PI,n=0;n<23;n++)t[n]=e/(256*Math.pow(2,n));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}}};Ah$1["EPSG:4490"]=Ah$1["EPSG:4326"];var Eh=function(){function t(t){void 0===t&&(t={}),this.options=t,this._initSpatialRef()}t.getPreset=function(t){return Ah$1[t.toUpperCase()]},t.getAllPresets=function(){return Object.keys(Ah$1)},t.getProjectionInstance=function(t){if(!t)return null;if(Fn$3(t))return t.locate||(t=kn$3({},t),kn$3(t,Xs$1.getInstance("identity"===t.measure?"IDENTITY":"EPSG:4326"))),t;for(var e in t=(t+"").toLowerCase(),ta$1)if(Bn$3(ta$1,e)){var n=ta$1[e].code;if(n&&n.toLowerCase()===t)return ta$1[e]}return null},t.equals=function(t,e){if(jn$3(t)||jn$3(e))return t===e;if(!t&&!e)return!0;if(!t||!e)return!1;if(t.projection!==e.projection)return!1;var n=t.fullExtent,i=e.fullExtent;if(n&&!i||!n&&i)return!1;if(n&&i&&(n.top!==i.top||n.bottom!==i.bottom||n.left!==i.left||n.right!==i.right))return!1;var r=t.resolutions,o=e.resolutions;if(r&&o){if(r.length!==o.length)return!1;for(var s=0;s<r.length;s++)if(r[s]!==o[s])return!1}else if(r||o)return!1;return!0};var e=t.prototype;return e._initSpatialRef=function(){var e=this.options.projection;if(!(e=e?t.getProjectionInstance(e):$s$1))throw new Error("must provide a valid projection in map's spatial reference.");(e=kn$3({},Fs$1,e)).measureLength||kn$3(e,Xs$1.DEFAULT),this._projection=e;var n,i=this.options.resolutions;if(!i&&(e.code&&(n=Ah$1[e.code.toUpperCase()])&&(i=n.resolutions,this.isEPSG="IDENTITY"!==e.code),!i))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=i,this._pyramid=!0,this._pyramid)for(var r=0;r<i.length;r++)if(i[r]&&i[r-1]&&i[r-1]/i[r]!=2){this._pyramid=!1;break}var o=this.options.fullExtent;if(!o&&(e.code&&(n=Ah$1[e.code.toUpperCase()])&&(o=n.fullExtent),!o))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(Dn$3(o.left)?(this._fullExtent=new ks$1(o),o.left=o.xmin,o.right=o.xmax,o.top=o.ymax,o.bottom=o.ymin):this._fullExtent=new ks$1(new ys$1(o.left,o.top),new ys$1(o.right,o.bottom)),Dn$3(o.top)||Dn$3(o.bottom)||Dn$3(o.left)||Dn$3(o.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");kn$3(this._fullExtent,o),this._projection.fullExtent=o,this._transformation=new zs$1([o.right>=o.left?1:-1,o.top>=o.bottom?-1:1,0,0])},e.getResolutions=function(){return this._resolutions||[]},e.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var n=this._resolutions[e];return e!==t&&t>0&&e<this._resolutions.length-1?n+(this._resolutions[e+1]-n)*(t-e):n},e.getProjection=function(){return this._projection},e.getFullExtent=function(){return this._fullExtent},e.getTransformation=function(){return this._transformation},e.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!Dn$3(this._resolutions[t]))return t;return 0},e.getMaxZoom=function(){for(var t=this._resolutions.length-1;t>=0;t--)if(!Dn$3(this._resolutions[t]))return t;return this._resolutions.length-1},e.getZoomDirection=function(){return Vi$4(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},e.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},e.isPyramid=function(){return this._pyramid},t}(),Oh=new Ii$4(0,0),Rh=new Ls$1,Ih$1={},kh=function(t){function e(e){var n,i=kn$3({},e),r=i.symbol,o=i.properties,s=i.id;return delete i.symbol,delete i.id,delete i.properties,n=t.call(this,i)||this,r?n.setSymbol(r):n._genSizeSymbol(),o&&n.setProperties(o),Dn$3(s)||n.setId(s),n}Pi$4(e,t);var n=e.prototype;return n.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[0]}while(Array.isArray(e)&&e.length>0);return e},n.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[e.length-1]}while(Array.isArray(e)&&e.length>0);return e},n.addTo=function(t,e){return t.addGeometry(this,e),this},n.getLayer=function(){return this._layer?this._layer:null},n.getMap=function(){return this._layer?this._layer.getMap():null},n.getId=function(){return this._id},n.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},n.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},n.setProperties=function(t){var e=this.properties;return this.properties=Fn$3(t)?kn$3({},t):t,this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},n.getType=function(){return this.type},n.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?_o$3(t):kn$3({},t):null},n.setSymbol=function(t){return this._symbolUpdated=t,this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},n.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=go$3(this._symbolUpdated)),this._symbolHash},n.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Parameter of updateSymbol is not an array.");for(var n=0;n<t.length;n++)za(t[n])&&delete this._textDesc,e[n]&&t[n]&&(e[n]=_o$3(e[n],t[n]))}else{if(Array.isArray(t))throw new Error("Geometry's symbol is not an array to update.");za(e)&&delete this._textDesc,e=_o$3(e||this._getInternalSymbol(),t)}return this._eventSymbolProperties=t,delete this._compiledSymbol,this.setSymbol(e)},n.getTextContent=function(){var t=this._getInternalSymbol();if(Array.isArray(t)){for(var e=[],n=!1,i=0;i<t.length;i++)e[i]=so$3(t[i]&&t[i].textName,this.getProperties()),Dn$3(e[i])||(n=!0);return n?e:null}return so$3(t&&t.textName,this.getProperties())},n.getTextDesc=function(){if(!this._textDesc){var t=this.getTextContent(),e=this._sizeSymbol,n=Array.isArray(t);this._textDesc=Array.isArray(e)?e.map((function(e,i){return ao$3(n?t[i]:"",e)})):ao$3(t,e)}return this._textDesc},n.getCenter=function(){return this._computeCenter(this._getMeasurer())},n.getExtent=function(){var t=this._getPrjExtent(),e=this._getProjection();if(t&&e){var n=e.unproject(new ys$1(t.xmin,t.ymin)),i=e.unproject(new ys$1(t.xmax,t.ymax));return new ks$1(n,i,e)}return this._computeExtent(this._getMeasurer())},n.getContainerExtent=function(t){var e=this.get2DExtent();if(!e||!e.isValid())return null;var n=this.getMap(),i=n.getGLRes(),r=this.getMinAltitude(),o=n.altitudeToPoint(r,i)*Vi$4(r),s=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,o,Oh)}),t),a=this.getMaxAltitude();if(a!==r){a=n.altitudeToPoint(a,i)*Vi$4(a);var h=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,a,Oh)}),Rh);s._combine(h)}var l=this.getLayer();if(l&&"LineString"===this.type&&a&&l.options.drawAltitude){var c=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,0,Oh)}),Rh);s._combine(c)}return s&&s._add(this._getFixedExtent()),this.options.smoothness&&s._expand(.15*s.getWidth()),s},n._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new Ls$1);var t=this._sizeSymbol,e=(t&&t.lineWidth||1)/2;return this._fixedExtent.set(-e,-e,e,e),this._fixedExtent._add([t&&t.lineDx||0,0]),this._fixedExtent._add([0,t&&t.lineDy||0]),this._fixedExtent},n.get2DExtent=function(){var t=this.getMap();if(!t)return null;if(this._extent2d)return this._extent2d;var e=this._getPrjExtent();if(!e||!e.isValid())return null;var n=e.getMin(),i=e.getMax(),r=t.getGLRes();return t._prjToPointAtRes(n,r,n),t._prjToPointAtRes(i,r,i),this._extent2d=new Ls$1(n,i),this._extent2d.z=t.getZoom(),this._extent2d},n.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},n.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof ys$1&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},n._containsPoint=function(t,e){var n=this._getPainter();return!!n&&(e=e||0,this._hitTestTolerance&&(e+=this._hitTestTolerance()),n.hitTest(t,e))},n.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},n.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},n.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,n=t.length;e<n;e++)if(Dn$3(t[e].opacity)||t[e].opacity>0)return!0;return!1}return Dn$3(t.opacity)||Fn$3(t.opacity)||Ln$3(t.opacity)&&t.opacity>0},n.getZIndex=function(){return this.options.zIndex||0},n.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},n.setZIndexSilently=function(t){return this.options.zIndex=t,this},n.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},n.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},n.translate=function(t,e){if(Dn$3(t))return this;var n=new ys$1(t,e);if(0===n.x&&0===n.y)return this;var i=this.getCoordinates();if(this._silence=!0,i)if(Array.isArray(i)){var r=Bi$4(i,(function(t){return t.add(n)}));this.setCoordinates(r)}else this.setCoordinates(i.add(n));return this._silence=!1,this._fireEvent("positionchange"),this},n.flash=function(t,e,n,i){return sr$4.call(this,t,e,n,i)},n.copy=function(){var t=this.toJSON(),n=e.fromJSON(t);return n.options.visible=!0,n},n.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},n.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},n.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(Dn$3(t.geometry)||t.geometry){var n=this._exportGeoJSONGeometry();e.geometry=n}var i,r=this.getId();return Dn$3(r)||(e.id=r),(Dn$3(t.properties)||t.properties)&&(i=this._exportProperties()),e.properties=i,e},n.toJSON=function(t){t||(t={});var e=this._toJSON(t);return kn$3(e,this._exportGraphicOptions(t)),e},n.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},n.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},n.rotate=function(t,e){if("GeometryCollection"===this.type)return this.getGeometries().forEach((function(n){return n.rotate(t,e)})),this;e=e?new ys$1(e):this.getCenter();var n=this._getMeasurer(),i=this.getCoordinates();if(!Array.isArray(i)){if(e.x!==i.x||e.y!==i.y){var r=n._rotate(i,e,t);this.setCoordinates(r)}return this}return Bi$4(i,(function(i){return n._rotate(i,e,t)})),this.setCoordinates(i),this},n._getConnectPoints=function(){return[this.getCenter()]},n._initOptions=function(t){var e=kn$3({},t),n=e.symbol,i=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),n&&this.setSymbol(n),i&&this.setProperties(i),Dn$3(r)||this.setId(r)},n._bindLayer=function(t){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._bindInfoWindow(),this._bindMenu()},n._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(Jr$4(this._checkAndCopySymbol(t[n])));return e}return t?Jr$4(t=this._checkAndCopySymbol(t)):null},n._checkAndCopySymbol=function(t){var e={};for(var n in t)e[n]=On$3[n]&&jn$3(t[n])?+t[n]:t[n];return e},n._getSymbol=function(){return this._symbol},n._setExternSymbol=function(t){return this._eventSymbolProperties=t,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},n._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},n._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},n._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},n._getInternalId=function(){return this._internalId},n._setInternalId=function(t){this._internalId=t},n._getMeasurer=function(){return this._getProjection()?this._getProjection():Eh.getProjectionInstance(this.options.defaultProjection)},n._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},n._verifyProjection=function(){var t=this._getProjection();this._projCode&&t&&this._projCode!==t.code&&this._clearProjection(),this._projCode=t?t.code:this._projCode},n._getExternalResources=function(){return Xr$4(this._getInternalSymbol())},n._getPainter=function(){var t=this.getLayer();if(!this._painter&&t)if(-1!==Sn$3.indexOf(this.type)){if(t.constructor.getCollectionPainterClass){var e=t.constructor.getCollectionPainterClass();e&&(this._painter=new e(this))}}else if(t.constructor.getPainterClass){var n=t.constructor.getPainterClass();n&&(this._painter=new n(this))}return this._painter},n._getMaskPainter=function(){return this._maskPainter||(this._maskPainter=this.getGeometries&&this.getGeometries()?new Ph$1(this,!0):new Th(this)),this._maskPainter},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},n._paint=function(t){if(this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var e=this._getProjection();e&&(this._pcenter=e.project(this._coordinates),this._clearCache())}this._painter.paint(t)}},n._clearCache=function(){delete this._extent,delete this._extent2d},n._clearProjection=function(){delete this._extent,delete this._extent2d},n._repaint=function(){this._painter&&this._painter.repaint()},n.onHide=function(){this.closeMenu(),this.closeInfoWindow()},n.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},n.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},n.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var t={};this._eventSymbolProperties?(t.properties=kn$3({},this._eventSymbolProperties),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",t)},n._genSizeSymbol=function(){var t=this._getInternalSymbol();if(t)if(Array.isArray(t)){this._sizeSymbol=[];for(var e=!1,n=0;n<t.length;n++){var i=this._sizeSymbol[n]=this._getSizeSymbol(t[n]);!e&&i&&i._dynamic&&(e=!0)}this._sizeSymbol._dynamic=e}else this._sizeSymbol=this._getSizeSymbol(t);else delete this._sizeSymbol},n._getSizeSymbol=function(t){var e=Wr$4({lineWidth:t.lineWidth,lineDx:t.lineDx,lineDy:t.lineDy},this);return(Mr$4(t.lineWidth)||Mr$4(t.lineDx)||Mr$4(t.lineDy))&&(e._dynamic=!0),e},n._getCompiledSymbol=function(){return this._compiledSymbol||(this._compiledSymbol=Wr$4(this._getInternalSymbol(),this)),this._compiledSymbol},n.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var n=!1;for(var i in t)if(t.hasOwnProperty(i)){var r=i.slice(0,5);if("arrow"===r||"smoot"===r){n=!0;break}}e?(this.setProperties(e),this._repaint()):n&&this._repaint()},n._setParent=function(t){t&&(this._parent=t)},n._getParent=function(){return this._parent},n._fireEvent=function(t,e){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e))},n._toJSON=function(t){return{feature:this.toGeoJSON(t)}},n._exportGraphicOptions=function(t){var e={};return(Dn$3(t.options)||t.options)&&(e.options=this.config()),(Dn$3(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(Dn$3(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},n._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=ys$1.toNumberArrays(t);return{type:this.getType(),coordinates:e}},n._exportProperties=function(){var t=null,e=this.getProperties();return Dn$3(e)||(t=Fn$3(e)?kn$3({},e):e),t},n._hitTestTolerance=function(){var t=this.getLayer();return t&&t.options.geometryEventTolerance||0},n._getAltitude=function(){var t=this.getLayer();if(!t)return 0;var e=t.options,n=t.getAltitude?t.getAltitude():0,i=e.enableAltitude;if(!i)return n;var r=Dh$1(t),o=(this.properties||Ih$1)[r];if(Dn$3(o)){var s=Lh(this,n,i);return Dn$3(s)?n:s}return Array.isArray(o)?o.map((function(t){return t+n})):o+n},n.getAltitude=function(){var t=Dh$1(this.getLayer()),e=(this.properties||Ih$1)[t];if(!Dn$3(e))return e;var n=Lh(this,0,!1);return Dn$3(n)?0:n},n.setAltitude=function(t){if(!Ln$3(t))return this;var e=this.getLayer(),n=Dh$1(e),i=this.properties||Ih$1,r=i[n];if(!Dn$3(r))if(Array.isArray(r))for(var o=0,s=r.length;o<s;o++)r[o]=t;else i[n]=t;var a=this.getCoordinates?this.getCoordinates():null;if(!a)return this;if(function t(e,n){if(Array.isArray(e))for(var i=0,r=e.length;i<r;i++)t(e[i],n);else e.z=n}(a,t),e){var h=e.getRenderer();h&&h.gl?this.setCoordinates(a):h&&this._repaint()}return this},n._genMinMaxAlt=function(){var t=this,e=this._getAltitude();Array.isArray(e)?(this._minAlt=Number.MAX_VALUE,this._maxAlt=Number.MIN_VALUE,e.forEach((function(e){var n=e;n<t._minAlt&&(t._minAlt=n),n>t._maxAlt&&(t._maxAlt=n)}))):this._minAlt=this._maxAlt=e},n.getMinAltitude=function(){return void 0===this._minAlt&&this._genMinMaxAlt(),this._minAlt?this._minAlt:0},n.getMaxAltitude=function(){return void 0===this._maxAlt&&this._genMinMaxAlt(),this._maxAlt?this._maxAlt:0},e}(fs$1(hs$1(gs$1(cs$2))));function Dh$1(t){var e="altitude";return t&&(e=t.options.altitudeProperty),e}function Lh(t,e,n){var i=t.getCoordinates?t.getCoordinates():null;if(i){var r=[];if(function t(e,n){if(!n.length)if(Array.isArray(e))for(var i=0,r=e.length;i<r;i++)t(e[i],n);else Ln$3(e.z)&&n.push(e.z)}(i,r),r.length){var o=function t(e,n,i){if(Array.isArray(e)){for(var r=[],o=0,s=e.length;o<s;o++)r.push(t(e[o],n,i));return r}return Ln$3(e.z)?i?n+e.z:e.z:i?n:0}(i,e,n);return t.getShell?o[0][0]:o}}return null}kh.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"});var zh={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:!Si$4.mobile},Fh=function(t){function e(e,n){var i,r;return n&&(r=n.canvas,delete n.canvas),(i=t.call(this,n)||this)._canvas=r,i.setId(e),n&&(i.setZIndex(n.zIndex),n.mask&&i.setMask(kh.fromJSON(n.mask))),i.proxyOptions(),i}Pi$4(e,t);var n=e.prototype;return n.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();Dn$3(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},n.getId=function(){return this._id},n.setId=function(t){var e=this._id;return Dn$3(t)||(t+=""),this._id=t,this.fire("idchange",{old:e,new:t}),this},n.addTo=function(t){return t.addLayer(this),this},n.setZIndex=function(t){return this._zIndex=t,Dn$3(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this},n.getZIndex=function(){return this._zIndex||0},n.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},n.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),Dn$3(e)?1/0:e):e},n.getOpacity=function(){return this.options.opacity},n.setOpacity=function(t){return this.config("opacity",t),this},n.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof pa},n.getMap=function(){return this.map?this.map:null},n.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},n.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var n=e.getZIndex();return this.setZIndex(n+1),this},n.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var n=e.getZIndex();return this.setZIndex(n-1),this},n.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var n=this.getMap();e&&n?n.once("renderend",(function(){t.fire("show")})):this.fire("show")}return this},n.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var n=this.getMap();e&&n?n.once("renderend",(function(){t.fire("hide")})):this.fire("hide")}return this},n.isVisible=function(){if(Ln$3(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!Dn$3(this.options.maxZoom)&&this.options.maxZoom<e||!Dn$3(this.options.minZoom)&&this.options.minZoom>e)return!1}return Dn$3(this.options.visible)&&(this.options.visible=!0),this.options.visible},n.remove=function(){return this.map&&this.map.removeLayer(this),this},n.getMask=function(){return this._mask},n.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type||"MultiPolygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(t._bindLayer(this),"Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=t,this.options.mask=t.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},n.removeMask=function(){if(delete this._mask,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},n.onLoad=function(){return!0},n.onLoadEnd=function(){},n.isLoaded=function(){return!!this._loaded},n.getCollisionIndex=function(){if("layer"===this.options.collisionScope)return this._collisionIndex||(this._collisionIndex=new ms$1),this._collisionIndex;var t=this.getMap();return t?t.getCollisionIndex():null},n.clearCollisionIndex=function(){return"layer"===this.options.collisionScope&&this._collisionIndex&&this._collisionIndex.clear(),this},n.getRenderer=function(){return this._getRenderer()},n.onConfig=function(t){if(t&&Object.keys&&Object.keys(t).length>0&&Dn$3(t.animation)){this._optionsHook&&Hn$3(this._optionsHook)&&this._optionsHook(t);var e=this.getRenderer();e&&e.setToRedraw&&e.setToRedraw()}},n.onAdd=function(){},n.onRendererCreate=function(){},n.onCanvasCreate=function(){},n.onRemove=function(){},n._bindMap=function(t,e){t&&(this.map=t,Dn$3(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},n._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{renderer:this._renderer})}},n._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},n._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()&&this.getMap()[t](e.getEvents(),e)},n._getRenderer=function(){return this._renderer},n._getLayerList=function(){return this.map?this.map._layers:[]},n._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getMaskPainter();return t?t.get2DExtent():null},e}(fs$1(hs$1(ea$1(cs$2))));Fh.mergeOptions(zh);var jh=Fh.prototype.fire;Fh.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={}),e.type=t,e.target=this,this.map._onLayerEvent(e)),jh.apply(this,arguments)};var Hh,Nh,Bh,Gh,Vh,Wh,Uh,Zh=new ys$1(0,0),Xh=["centerCross","fog","fogColor","debugSky"],Jh={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!Un$3,zoomAnimationDuration:330,panAnimation:!Un$3,panAnimationDuration:600,rotateAnimation:!Un$3,zoomable:!0,enableInfoWindow:!0,hitDetect:!Si$4.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0,preventWheelScroll:!0},qh=function(t){function e(n,i){var r;if(!i)throw new Error("Invalid options when creating map.");if(!i.center)throw new Error("Invalid center when creating map.");var o=kn$3({},i),s=o.zoom;delete o.zoom;var a=new ys$1(o.center);delete o.center;var h=o.baseLayer;delete o.baseLayer;var l=o.layers;return delete o.layers,(r=t.call(this,o)||this).VERSION=e.VERSION,Object.defineProperty(Ai$4(Ai$4(r)),"id",{value:zi$4(),writable:!1}),r._loaded=!1,r._initContainer(n),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=s,r._center=a,r.setSpatialReference(o.spatialReference||o.view),r._mapViewPoint=new Ii$4(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),h&&r.setBaseLayer(h),l&&r.addLayer(l),r.setMaxExtent(o.maxExtent),r._Load(),r.proxyOptions(),r}Pi$4(e,t),e.addOnLoadHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(n),this};var n=e.prototype;return n.isLoaded=function(){return!!this._loaded},n.getContainer=function(){return this._containerDOM},n.getSpatialReference=function(){return this._spatialReference},n.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&Eh.equals(e,t)||this._updateSpatialReference(t,e),this},n._updateSpatialReference=function(t,e){if(jn$3(t)&&(t=Eh.getPreset(t)),t=kn$3({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new Eh(t),this.options.spatialReference&&Hn$3(this.options.spatialReference.projection)){var n=this._spatialReference.getProjection();this.options.spatialReference.projection=n.code}return this._resetMapStatus(),this._fireEvent("spatialreferencechange",{old:e,new:kn$3({},this.options.spatialReference)}),this},n.onConfig=function(t){var e=t.spatialReference||t.view;Dn$3(e)||this._updateSpatialReference(e,null);for(var n=!1,i=0,r=Xh.length;i<r;i++)if(!Dn$3(t[Xh[i]])){n=!0;break}if(!n)return this;var o=this.getRenderer();return o&&o.setToRedraw(),this},n.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},n.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},n.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},n.resetCursor=function(){return this.setCursor(null)},n.getCenter=function(){return this._loaded&&this._prjCenter?this.getProjection().unproject(this._prjCenter):this._center},n.setCenter=function(t){if(!t)return this;t=new ys$1(t);var e=this.getProjection().project(t);return this._verifyExtent(e)?this._loaded?(this.onMoveStart(),this._setPrjCenter(e),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},n.getSize=function(){return Dn$3(this.width)||Dn$3(this.height)?this._getContainerDomSize():new Yr$4(this.width,this.height)},n.getContainerExtent=function(){var t=this.height,e=this.getPitch(),n=this.options.maxVisualPitch;return n&&e>n&&(t=this._getVisualHeight(n)),new Ls$1(0,this.height-t,this.width,this.height)},n._getVisualHeight=function(t){t=t||.01;var e=(90-this.getPitch())*Math.PI/180,n=this.getFov()*Math.PI/180;t*=Math.PI/180;var i=this.cameraCenterDistance/this.getGLScale(),r=Math.tan(n/2),o=i*r/(1/Math.tan(t)-r)/Math.sin(t),s=i*(Math.sin(e)*o/(i+Math.cos(e)*o));return this.height/2+s},n.getExtent=function(){return this._pointToExtent(this._get2DExtent())},n.getProjExtent=function(){var t=this._get2DExtent();return new ks$1(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},n.getPrjExtent=function(){return this.getProjExtent()},n.getMaxExtent=function(){return this.options.maxExtent?new ks$1(this.options.maxExtent,this.getProjection()):null},n.setMaxExtent=function(t){if(t){var e=new ks$1(t,this.getProjection());this.options.maxExtent=e;var n=this.getProjection();this._prjMaxExtent=e.convertTo((function(t){return n.project(t)})),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=n.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},n.getZoom=function(){return this._zoomLevel},n.getZoomForScale=function(t,e,n){var i=this.getZoom();if(Dn$3(e)&&(e=i),1===t&&e===i)return i;var r=this._getResolution(e),o=this.getZoomFromRes(r/t);return n?o:this.getSpatialReference().getZoomDirection()<0?Math.ceil(o-1e-6):Math.floor(o+1e-6)},n.getZoomFromRes=function(t){var e=this._getResolutions(),n=this._getResolution(this.getMinZoom()),i=this._getResolution(this.getMaxZoom());if(n<=i){if(t<=n)return this.getMinZoom();if(t>=i)return this.getMaxZoom()}else{if(t>=n)return this.getMinZoom();if(t<=i)return this.getMaxZoom()}for(var r=e.length,o=0;o<r-1;o++)if(e[o]){var s=e[o+1]-e[o],a=t-e[o];if(Vi$4(s)===Vi$4(a)&&Math.abs(s)>=Math.abs(a))return o+a/s}return r-1},n.setZoom=function(t,e){return void 0===e&&(e={animation:!0}),isNaN(t)||Dn$3(t)||(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t)),this},n.getMaxZoom=function(){return Dn$3(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},n.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),null!==t&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},n.getMinZoom=function(){return Dn$3(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},n.setMinZoom=function(t){if(null!==t){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},n.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},n.getGLRes=function(){if(this._glRes)return this._glRes;var t=this.getSpatialReference().getFullExtent();return this._glRes=(t.right-t.left)/Math.pow(2,19),this._glRes},n.getGLScale=function(t){return Dn$3(t)&&(t=this.getZoom()),this._getResolution(t)/this.getGLRes()},n.zoomIn=function(){return this.setZoom(this.getZoom()+1)},n.zoomOut=function(){return this.setZoom(this.getZoom()-1)},n.isZooming=function(){return!!this._zooming},n.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},n.setCenterAndZoom=function(t,e){return Dn$3(e)||this._zoomLevel===e?this.setCenter(t):(this.setCenter(t),this.setZoom(e,{animation:!1})),this},n.getFitZoom=function(t,e){var n=this;if(!(t&&t instanceof ks$1))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var i=this.getSize(),r=t.convertTo((function(t){return n.coordToPoint(t)})),o=r.getWidth(),s=r.getHeight(),a=i.width/o,h=i.height/s,l=this.getSpatialReference().getZoomDirection()<0?Math.max(a,h):Math.min(a,h);return this.getZoomForScale(l,null,e)},n.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},n.setView=function(t){return t?(t.center&&this.setCenter(t.center),null===t.zoom||isNaN(+t.zoom)||this.setZoom(+t.zoom,{animation:!1}),null===t.pitch||isNaN(+t.pitch)||this.setPitch(+t.pitch),null===t.pitch||isNaN(+t.bearing)||this.setBearing(+t.bearing),this):this},n.getResolution=function(t){return this._getResolution(t)},n.getScale=function(t){var e=Dn$3(t)?this.getZoom():t,n=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/n},n.fitExtent=function(t,e,n,i){if(void 0===n&&(n={}),!t)return this;t=new ks$1(t,this.getProjection());var r=this.getFitZoom(t)+(e||0),o=t.getCenter();return void 0===n.animation||n.animation?this._animateTo({center:o,zoom:r},{duration:n.duration||this.options.zoomAnimationDuration,easing:n.easing||"out"},i):this.setCenterAndZoom(o,r)},n.getBaseLayer=function(){return this._baseLayer},n.setBaseLayer=function(t){var e=!1;return this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),t?(this._baseLayer=t,t._bindMap(this,-1),this._baseLayer.on("layerload",(function(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))}),this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this):(delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this)},n.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},n.getLayers=function(t){return this._getLayers((function(e){return!(e===this._baseLayer||e.getId().indexOf("_maptalks__internal_layer_")>=0)&&(!t||t(e))}))},n.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var n=this.getBaseLayer();return n&&n.getId()===t?n:null},n.addLayer=function(t){if(!t)return this;if(!Array.isArray(t))return t=Array.prototype.slice.call(arguments,0),this.addLayer(t);this._layerCache||(this._layerCache={});for(var e=this._layers,n=0,i=t.length;n<i;n++){var r=t[n],o=r.getId();if(Dn$3(o))throw new Error("Invalid id for the layer: "+o);if(r.getMap()!==this){if(this._layerCache[o])throw new Error("Duplicate layer id in the map: "+o);this._layerCache[o]=r,r._bindMap(this),e.push(r),this._loaded&&r.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},n.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];if(r instanceof Fh||(r=this.getLayer(r)),r){var o=r.getMap();if(o&&o===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var s=r.getId();this._layerCache&&delete this._layerCache[s]}}}if(e.length>0){var a=this.getRenderer();a&&a.setLayerCanvasUpdated(),e.forEach((function(t){t.fire("remove")}))}return this._fireEvent("removelayer",{layers:t}),this},n.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],n=Number.MAX_VALUE,i=0,r=t.length;i<r;i++){var o=t[i];if(jn$3(t[i])&&(o=this.getLayer(o)),!(o instanceof Fh&&o.getMap()&&o.getMap()===this))throw new Error("It must be a layer added to this map to order.");o.getZIndex()<n&&(n=o.getZIndex()),e.push(o)}for(var s=0,a=e.length;s<a;s++)e[s].setZIndex(n+s);return this},n.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var n=t.save,i=this._getRenderer();if(i&&i.toDataURL){var r=t.fileName;r||(r="export");var o=i.toDataURL(e,t.quality||.92);if(n&&o){var s;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var a=er$4(o.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),e);s=URL.createObjectURL(a)}else s=o;var h=document.createElement("a");h.download=r,h.href=s,document.body.appendChild(h),h.click(),document.body.removeChild(h)}return o}return null},n.coordToPoint=function(t,e,n){return this.coordinateToPoint(t,e,n)},n.coordToPointAtRes=function(t,e,n){return this.coordinateToPointAtRes(t,e,n)},n.pointToCoord=function(t,e,n){return this.pointToCoordinate(t,e,n)},n.pointAtResToCoord=function(t,e,n){return this.pointAtResToCoordinate(t,e,n)},n.coordToViewPoint=function(t,e,n){return this.coordinateToViewPoint(t,e,n)},n.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},n.coordToContainerPoint=function(t,e,n){return this.coordinateToContainerPoint(t,e,n)},n.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},n.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},n.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},n.checkSize=function(t){var e=In$3()-this._initTime<1500&&0===this.width||0===this.height,n=this._getContainerDomSize(),i=this.height,r=this.width;if(!t&&n.width===r&&n.height===i)return this;jo$3(this._containerDOM);var o=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(n);else{var s=this._getVisualHeight(this.getPitch()),a=new Ii$4(0,this.height-s),h=this._containerPointToPrj(a);this._updateMapSize(n);var l=this._getVisualHeight(this.getPitch()),c=new Ii$4(0,this.height-l);this._setPrjCoordAtContainerPoint(h,c),this._mapViewCoord=this._getPrjCenter()}return(e||0===n.width||0===n.height||0===r||0===i)&&(this._eventSilence=!0,this.setCenter(o),delete this._eventSilence),this._fireEvent("resize"),this},n.locate=function(t,e,n){return this.getProjection()._locate(new ys$1(t),e,n)},n.getMainPanel=function(){return this._getRenderer().getMainPanel()},n.getPanels=function(){return this._panels},n.remove=function(){var t=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var e=this.getLayers(),n=0;n<e.length;n++)e[n].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter((function(t){return"maptalks-wrapper"===t.className})).forEach((function(e){return t._containerDOM.removeChild(e)})),delete this._panels,delete this._containerDOM,delete this.renderer,this._fireEvent("removeend"),this._clearAllListeners(),Si$4.removeDPRListening&&Si$4.removeDPRListening(this),this},n.isRemoved=function(){return!this._containerDOM},n.isMoving=function(){return!!this._moving},n.onMoveStart=function(t){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var e=this._getPrjCenter();this._originCenter&&!this._verifyExtent(e)||(this._originCenter=e),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},n.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving"))},n.onMoveEnd=function(t){this._moving=!1,this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),!this._verifyExtent(this._getPrjCenter())&&this._originCenter&&this._panTo(this._originCenter)},n.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},n.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},n.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},n.isDragRotating=function(){return!!this._dragRotating},n.isOffscreen=function(t,e){void 0===e&&(e=0);var n=this.width+e,i=this.height+e,r=t.xmin,o=t.ymin,s=t.xmax,a=t.ymax;return Array.isArray(t)&&(r=t[0],o=t[1],s=t[2],a=t[3]),s<e||r>=n||a<e||o>i},n.getRenderer=function(){return this._getRenderer()},n.getDevicePixelRatio=function(){return this.options.devicePixelRatio||Si$4.devicePixelRatio||1},n.setDevicePixelRatio=function(t){return Ln$3(t)&&t>0&&t!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=t,this.checkSize(!0)),this},n._initContainer=function(t){if(jn$3(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,Un$3&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},n._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},n._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},n._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},n._removeLayer=function(t,e){if(t&&e){var n=e.indexOf(t);n>-1&&e.splice(n,1)}},n._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++)this._layers[t]._order=t,this._layers[t].sortLayersByZIndex&&this._layers[t].sortLayersByZIndex();this._layers.sort((function(t,e){var n=t.getZIndex()-e.getZIndex();return 0===n?t._order-e._order:n}))}},n._fireEvent=function(t,e){this._eventSilence||(this.fire("_"+t,e),this.fire(t,e))},n._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=In$3()},n._initRenderer=function(){var t=e.getRendererClass(this.options.renderer);this._renderer=new t(this),this._renderer.load()},n._getRenderer=function(){return this._renderer},n._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer((function(t){t&&t.load()}),this.getLayers())},n._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,n=[],i=0;i<e.length;i++)t&&!t.call(this,e[i])||n.push(e[i]);return n},n._eachLayer=function(t){if(!(arguments.length<2)){var e=Array.prototype.slice.call(arguments,1);e&&!Array.isArray(e)&&(e=[e]);for(var n=[],i=0,r=e.length;i<r;i++)n=n.concat(e[i]);for(var o=0,s=n.length;o<s;o++)t.call(t,n[o])}},n._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},n._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),n=this._spatialReference.getMaxZoom(),i=this._spatialReference.getMinZoom();(Dn$3(t)||-1===t||t>n)&&this.setMaxZoom(n),(Dn$3(e)||-1===e||e<i)&&this.setMinZoom(i),(t=this.getMaxZoom())<(e=this.getMinZoom())&&this.setMaxZoom(e),(Dn$3(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter;var r=this.getProjection();this._prjCenter=r.project(this._center),this._calcMatrices();var o=this._getRenderer();o&&o.resetContainer()},n._getContainerDomSize=function(){if(!this._containerDOM)return null;var t,e,n=this._containerDOM;if(this._containerDomContentRect)return new Yr$4(t=this._containerDomContentRect.width,e=this._containerDomContentRect.height);if(Dn$3(n.width)||Dn$3(n.height)){if(Dn$3(n.clientWidth)||Dn$3(n.clientHeight))throw new Error("can not get size of container");t=parseInt(n.clientWidth,0),e=parseInt(n.clientHeight,0)}else{t=n.width,e=n.height;var i=this.getDevicePixelRatio();1!==i&&n.layer&&(t/=i,e/=i)}return new Yr$4(t,e)},n._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},n._getPrjCenter=function(){return this._prjCenter},n._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},n._setPrjCoordAtContainerPoint=function(t,e){if(e.x===this.width/2&&e.y===this.height/2)return this;var n=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),i=this._pointToPrj(this._prjToPoint(t).sub(n));return this._setPrjCenter(i),this},n._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return!e||e.contains(t)},n._offsetCenterByPixel=function(t){var e=new Ii$4(this.width/2-t.x,this.height/2-t.y),n=this._containerPointToPrj(e);return this._setPrjCenter(n),n},n.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this):this._mapViewPoint},n.getViewPoint=function(){var t=this._getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},n._resetMapViewPoint=function(){this._mapViewPoint=new Ii$4(0,0),this._mapViewCoord=this._getPrjCenter()},n._getResolution=function(t){return void 0!==t&&t!==this._zoomLevel||void 0===this._mapRes?(Dn$3(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t)):this._mapRes},n._getResolutions=function(){return this._spatialReference.getResolutions()},n._prjToPoint=function(t,e,n){e=Dn$3(e)?this.getZoom():e;var i=this._getResolution(e);return this._prjToPointAtRes(t,i,n)},n._prjToPointAtRes=function(t,e,n){return this._spatialReference.getTransformation().transform(t,e,n)},n._prjsToPointsAtRes=function(t,e,n){void 0===n&&(n=[]);for(var i=this._spatialReference.getTransformation(),r=[],o=0,s=t.length;o<s;o++){var a=i.transform(t[o],e,n[o]);r.push(a)}return r},n._pointToPrj=function(t,e,n){e=Dn$3(e)?this.getZoom():e;var i=this._getResolution(e);return this._pointToPrjAtRes(t,i,n)},n._pointToPrjAtRes=function(t,e,n){return this._spatialReference.getTransformation().untransform(t,e,n)},n._pointToPoint=function(t,e,n){return Dn$3(e)?(n?(n.x=t.x,n.y=t.y):n=t.copy(),n):this._pointAtResToPoint(t,this._getResolution(e),n)},n._pointAtResToPoint=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(e/this._getResolution())},n._pointToPointAtRes=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(this._getResolution()/e)},n._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},n._callOnLoadHooks=function(){var t=e.prototype;if(t._onLoadHooks)for(var n=0,i=t._onLoadHooks.length;n<i;n++)t._onLoadHooks[n].call(this)},n._fixPrjOnWorldWide=function(t){var e=this.getProjection();if(e&&e.fullExtent&&t){var n=e.fullExtent||{},i=n.left,r=n.bottom,o=n.top,s=n.right;Ln$3(i)&&(t.x=Math.max(i,t.x)),Ln$3(s)&&(t.x=Math.min(s,t.x)),Ln$3(r)&&(t.y=Math.max(r,t.y)),Ln$3(o)&&(t.y=Math.min(o,t.y))}return this},e}(gs$1(hs$1(ea$1(cs$2))));qh.include({coordinateToPoint:function(t,e,n){var i=this._getResolution(e);return this.coordinateToPointAtRes(t,i,n)},coordinateToPointAtRes:(Uh=new ys$1(0,0),function(t,e,n){var i=this.getProjection().project(t,Uh);return this._prjToPointAtRes(i,e,n)}),pointToCoordinate:function(){var t=new ys$1(0,0);return function(e,n,i){var r=this._pointToPrj(e,n,t);return this.getProjection().unproject(r,i)}}(),pointAtResToCoordinate:function(){var t=new ys$1(0,0);return function(e,n,i){var r=this._pointToPrjAtRes(e,n,t);return this.getProjection().unproject(r,i)}}(),coordinateToViewPoint:function(){var t=new ys$1(0,0);return function(e,n,i){return this._prjToViewPoint(this.getProjection().project(e,t),n,i)}}(),viewPointToCoordinate:function(){var t=new ys$1(0,0);return function(e,n){return this.getProjection().unproject(this._viewPointToPrj(e,t),n)}}(),coordinateToContainerPoint:function(t,e,n){var i=this._getResolution(e);return this.coordinateToContainerPointAtRes(t,i,n)},coordinateToContainerPointAtRes:function(){var t=new ys$1(0,0);return function(e,n,i){var r=this.getProjection().project(e,t);return this._prjToContainerPointAtRes(r,n,i)}}(),coordinatesToContainerPoints:function(t,e){var n=this._getResolution(e);return this.coordinatesToContainerPointsAtRes(t,n)},coordinatesToContainerPointsAtRes:function(t,e){for(var n=[],i=this._spatialReference.getTransformation(),r=e/this._getResolution(),o=this.getProjection(),s=new ys$1(0,0),a=this.isTransforming(),h=this._prjToPoint(this._getPrjCenter(),void 0,Zh),l=0,c=t.length;l<c;l++){var u=o.project(t[l],s),f=i.transform(u,e);f=f._multi(r),this._toContainerPoint(f,a,r,0,h),n.push(f)}return n},containerPointToCoordinate:function(){var t=new ys$1(0,0);return function(e,n){var i=this._containerPointToPrj(e,t);return this.getProjection().unproject(i,n)}}(),containerToExtent:(Vh=new Ii$4(0,0),Wh=new Ii$4(0,0),function(t){var e=new Ls$1(this._containerPointToPoint(t.getMin(Vh),void 0,Vh),this._containerPointToPoint(t.getMax(Wh),void 0,Wh));return this._pointToExtent(e)}),distanceToPixel:function(){var t=new Ii$4(0,0),e=new Ii$4(0,0);return function(n,i,r){var o=this.getProjection();if(!o)return null;var s=this.getScale()/this.getScale(r),a=this.getCenter(),h=o.locate(a,n,i),l=this.coordToContainerPoint(a,void 0,t),c=this.coordToContainerPoint(h,void 0,e);return c._sub(l)._multi(s)._abs(),new Yr$4(c.x,c.y)}}(),distanceToPoint:function(t,e,n,i){var r=this._getResolution(n);return this.distanceToPointAtRes(t,e,r,i)},distanceToPointAtRes:function(){var t=new Ii$4(0,0),e=new ys$1(0,0);return function(n,i,r,o,s){var a=this.getProjection();if(!a)return null;var h=o||this.getCenter(),l=a.locate(h,n,i,e),c=this.coordToPointAtRes(h,r,t),u=this.coordToPointAtRes(l,r,s);return u._sub(c)._abs(),u}}(),altitudeToPoint:(Bh=new ys$1(0,40),Gh=new Ii$4(0,0),function(t,e,n){void 0===t&&(t=0);var i=this.distanceToPointAtRes(t,t,e,n||Bh,Gh);t<0&&i.x>0&&(i.x=-i.x);var r=this.options.heightFactor;return r&&1!==r&&(i.x*=r,i.y*=r),i.x}),pointAtResToAltitude:function(){var t=new ys$1(0,40);return function(e,n,i){return void 0===e&&(e=0),this.pointAtResToDistance(e,0,n,i||t)}}(),pixelToDistance:(Hh=new ys$1(0,0),Nh=new ys$1(0,0),function(t,e){var n=this.getProjection();if(!n)return null;var i=this.getFullExtent(),r=Hh.set(this.width/2+t,this.height/2+(i.top>i.bottom?-1:1)*e),o=this.containerPointToCoord(r,Nh);return n.measureLength(this.getCenter(),o)}),pointToDistance:function(t,e,n){var i=this.getResolution(n);return this.pointAtResToDistance(t,e,i)},pointAtResToDistance:function(){var t=new Ii$4(0,0),e=new ys$1(0,0),n=new ys$1(0,0),i=new ys$1(0,0);return function(r,o,s,a){var h=this.getProjection();if(!h)return null;var l=a?h.project(a,e):this._getPrjCenter(),c=this._prjToPointAtRes(l,s,t);c._add(r,o);var u=this.pointAtResToCoord(c,s,n),f=a||h.unproject(l,i);return h.measureLength(f,u)}}(),locateByPoint:function(){var t=new Ii$4(0,0);return function(e,n,i){var r=this.coordToContainerPoint(e,void 0,t);return this.containerPointToCoord(r._add(n,i))}}(),_get2DExtent:function(t,e){var n;if(void 0!==t&&t!==this._zoomLevel||!this._mapExtent2D||(n=this._mapExtent2D),n)return e?(e.set(n.xmin,n.ymin,n.xmax,n.ymax),e):n.copy();var i=this._getResolution(t);return this._get2DExtentAtRes(i,e)},_get2DExtentAtRes:function(){var t=new Ii$4(0,0);return function(e,n){var i=this;return e===this._mapGlRes&&this._mapGlExtent2D?this._mapGlExtent2D:this.getContainerExtent().convertTo((function(n){return i._containerPointToPointAtRes(n,e,t)}),n)}}(),_pointToExtent:function(){var t=new ys$1(0,0),e=new ys$1(0,0);return function(n){var i=n.getMin(),r=n.getMax(),o=this.getFullExtent(),s=!o||o.left<=o.right?[i.x,r.x]:[r.x,i.x],a=s[1],h=!o||o.top>o.bottom?[r.y,i.y]:[i.y,r.y],l=h[0],c=i.set(s[0],h[1]),u=r.set(a,l);return new ks$1(this.pointToCoord(c,void 0,t),this.pointToCoord(u,void 0,e),this.getProjection())}}(),_getViewPointFrameOffset:function(){var t=new Ii$4(0,0);return function(){if(this.isZooming())return null;var e=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(e)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(e,void 0,t)):null}}(),_viewPointToPrj:function(){var t=new Ii$4(0,0);return function(e,n){return this._containerPointToPrj(this.viewPointToContainerPoint(e,t),n)}}(),_prjToContainerPoint:function(t,e,n,i){var r=this._getResolution(e);return this._prjToContainerPointAtRes(t,r,n,i)},_prjToContainerPointAtRes:function(){var t=new Ii$4(0,0);return function(e,n,i,r){return this._pointAtResToContainerPoint(this._prjToPointAtRes(e,n,t),n,r||0,i)}}(),_prjToViewPoint:function(){var t=new Ii$4(0,0);return function(e,n,i){var r=this._prjToContainerPoint(e,void 0,t,i);return this.containerPointToViewPoint(r,n)}}(),_viewPointToPoint:function(){var t=new Ii$4(0,0);return function(e,n,i){return this._containerPointToPoint(this.viewPointToContainerPoint(e,t),n,i)}}(),_pointToViewPoint:function(){var t=new ys$1(0,0);return function(e,n,i){return this._prjToViewPoint(this._pointToPrj(e,n,t),i)}}()}),qh.mergeOptions(Jh);var Yh=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},n.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},n._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var n=e.getZoom(),i=t.domEvent.shiftKey?Math.ceil(n)-1:Math.floor(n)+1;e._zoomAnimation(i,t.containerPoint)}},e}(ls$1);qh.mergeOptions({doubleClickZoom:!0}),qh.addOnLoadHook("addHandler","doubleClickZoom",Yh);var Kh=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){var t=this.target;t&&(this._dragHandler=new vs$1(t._panels.mapWrapper||t._containerDOM,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable())},n.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},n._cancelOn=function(t){return!(!this.target.isZooming()&&!this._ignore(t))},n._ignore=function(t){return!!t&&(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t))},n._onMouseDown=function(t){delete this.startDragTime,delete this._mode,2===t.domEvent.button||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),Lo$2(t.domEvent)},n._onDragStart=function(t){this.startDragTime=In$3(),"move"===this._mode?this._moveStart(t):"rotatePitch"===this._mode&&this._rotateStart(t)},n._onDragging=function(t){this.target._isEventOutMap(t.domEvent)||("move"===this._mode?this._moving(t):"rotatePitch"===this._mode&&this._rotating(t))},n._onDragEnd=function(t){"move"===this._mode?this._moveEnd(t):"rotatePitch"===this._mode&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},n._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},n._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var n=Ho$3(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=e._containerPointToPrj(n)},n._moving=function(t){if(this.startDragTime){var e=this.target,n=Ho$3(e._getActualEvent(t.domEvent),e.getContainer());e._setPrjCoordAtContainerPoint(this.startPrjCoord,n),e.onMoving(t)}},n._moveEnd=function(t){if(this.startDragTime){var e="touchend"===t.domEvent.type,n=this.target,i=In$3()-this.startDragTime,r=t.mousePos.x-this.startX,o=t.mousePos.y-this.startY,s=n._getPrjCenter(),a=s.sub(this._startPrjCenter);if(this._clear(),n.options.panAnimation&&!t.interupted&&n._verifyExtent(n._getPrjCenter())&&i<280&&Math.abs(o)+Math.abs(r)>5){i*=5;var h=s.add(a._multi(e?5:2.8));n._panTo(h,{duration:e?3*i:2*i,easing:"outExpo"})}else n.onMoveEnd(t)}},n._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},n._rotating=function(t){var e=this.target,n=t.mousePos.x,i=t.mousePos.y,r=e.getPitch(),o=e.getBearing(),s=Math.abs(n-this.preX),a=Math.abs(i-this.preY);if(this._rotateMode||(this._rotateMode=e.options.dragRotatePitch?"rotate_pitch":s>a?"rotate":s<a?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&a<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var h;h=e.options.dragPitch||s>a?-.6*(this.preX-n):n>e.width/2?.6*(this.preY-i):-.6*(this.preY-i);var l=e.getBearing()+h;this._db=this._db||0,this._db+=h,e._setBearing(l)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e._setPitch(e.getPitch()+.4*(this.preY-i)),this.preX=n,this.preY=i,e.getBearing()===o&&e.getPitch()===r||e.onDragRotating(t)}},n._rotateEnd=function(t){var e=this.target,n=e.getBearing();this._clear();var i=In$3()-this.startDragTime;if(e.onDragRotateEnd(t),e.options.rotateAnimation&&Math.abs(n-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!t.interupted&&i<400){var r=e.getBearing();e._animateTo({bearing:r+this._db/1.5},{easing:"outQuint",duration:1600})}},n._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},e}(ls$1);qh.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),qh.addOnLoadHook("addHandler","draggable",Kh);var Qh="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend",$h={mousemove:["mousemove","mouseover","mouseout","mouseenter"],touchend:["touchend","click"]},tl=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){var t=this.target;Xo$3(t._panels.allLayers||t._containerDOM,Qh,this._identifyGeometryEvents,this)},n.removeHooks=function(){var t=this.target;Jo$2(t._panels.allLayers||t._containerDOM,Qh,this._identifyGeometryEvents)},n._identifyGeometryEvents=function(t,e){var n=this.target;if(!n.isInteracting()&&!n._ignoreEvent(t)){var i=null,r=e||t.type,o="mousedown"===r||"touchstart"===r&&t.touches&&1===t.touches.length;if(o)this._mouseDownTime=In$3();else if(("click"===r||"touchend"===r)&&this._mouseDownTime){var s=this._mouseDownTime;if(delete this._mouseDownTime,In$3()-s>300){if("click"===r)return}else"touchend"===r&&(i="click")}var a=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(a){var h=Ho$3(a,n._containerDOM);"touchstart"===r&&Lo$2(t);for(var l=null,c=this.target.getRenderer().getTopElements(),u=o&&2!==t.button,f=0;f<c.length;f++)if(c[f].hitTest(h)){var d=c[f].options.cursor;if(d&&(l=d),u||c[f].events&&c[f].events.indexOf(r)>=0){var m={target:n,type:r,domEvent:t,containerPoint:h};if(u)return n._setPriorityCursor(l),void c[f].mousedown(m);c[f].onEvent(m)}}var g=n._getLayers((function(t){return!(!t.identify||!t.options.geometryEvents)}));if(n._setPriorityCursor(l),g.length){var p={includeInternals:!0,filter:function(e){if(!(e instanceof kh))return!1;var n=e._getEventTypeToFire(t);if("mousemove"===r){if(!l&&e.options.cursor&&(l=e.options.cursor),!e.listens("mousemove")&&!e.listens("mouseover")&&!e.listens("mouseenter"))return!1}else if(!e.listens(n)&&!e.listens(i))return!1;return!0},count:1,onlyVisible:n.options.onlyVisibleGeometryEvents,containerPoint:h,layers:g,eventTypes:$h[r]||[r]},_=function(e){var o=!0;if("mousemove"===r){var s={};if(e.length>0)for(var a=e.length-1;a>=0;a--){var h=e[a];if(h instanceof kh){var c=h._getInternalId();s[c]=h,h._onEvent(t),this._prevOverGeos&&this._prevOverGeos.geomap[c]||h._onEvent(t,"mouseenter"),o=h._onEvent(t,"mouseover")}}n._setPriorityCursor(l);var u=this._prevOverGeos&&this._prevOverGeos.geos;if(this._prevOverGeos={geos:e,geomap:s},u&&u.length>0)for(var f=u.length-1;f>=0;f--){var d=u[f];if(d instanceof kh)s[u[f]._getInternalId()]||(o=d._onEvent(t,"mouseout"))}}else{if(!e||!e.length)return;for(var g=e.length-1;g>=0;g--)if(e[g]instanceof kh){o=e[g]._onEvent(t),i&&e[g]._onEvent(t,i);break}}!1===o&&zo$3(t)}.bind(this);"mousemove"===r||"touchmove"===r?this._queryIdentifyTimeout=n.getRenderer().callInNextFrame((function(){n.isInteracting()||n.identifyAtPoint(p,_)})):n.identifyAtPoint(p,_)}}}},e}(ls$1);qh.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),qh.addOnLoadHook("addHandler","geometryEvents",tl);var el=function(t){function e(e){var n;return(n=t.call(this,e)||this)._thisScrollZoom=n._scrollZoom.bind(Ai$4(Ai$4(n))),n._wheelZoomRate=1/450,n._defaultZoomRate=.01,n._delta=0,n}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){Io$2(this.target._containerDOM,"wheel",this._onWheelScroll,this)},n.removeHooks=function(){ko$2(this.target._containerDOM,"wheel",this._onWheelScroll)},n._onWheelScroll=function(t){var e=this.target;if(e.options.preventWheelScroll&&(Lo$2(t),zo$3(t)),e._ignoreEvent(t)||!e.options.zoomable)return!1;var n=e._checkZoomOrigin(Ho$3(t,e._containerDOM));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,n)):this._interval(t,n)},n._seamless=function(t,e){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*t.deltaY:t.deltaY;if(n%4.000244140625!=0&&(this._ensureTrackpad||(Math.abs(n)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(n*=14)),t.shiftKey&&n&&(n/=4),this._lastWheelEvent=t,this._delta-=n,!this._zooming&&this._delta){var i=this.target;this._zoomOrigin=e,i.onZoomStart(null,e)}this._start()},n._start=function(){this._delta&&(this._zooming=!0,this._active||(this.target.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0))},n._scrollZoom=function(){var t=this;if(this._active=!1,this._delta){var e=Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);var i=this.target,r=i.getZoom(),o=i.getZoomForScale(n,r,!0);this._delta=0,i.onZooming(o,this._zoomOrigin),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout((function(){t._zooming=!1,delete t._timeout,i.onZoomEnd(i.getZoom(),t._zoomOrigin)}),210)}},n._interval=function(t,e){var n=this,i=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var r=(t.deltaY?-1*t.deltaY:t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(r*=-1);var o=i.getZoom(),s=o+r;return(s=i._checkZoom(r>0?Math.ceil(s):Math.floor(s)))===o||(this._zooming=!0,this._delta||(i.onZoomStart(null,e),this._origin=e,this._delta=r,this._startZoom=i.getZoom()),i._animateTo({zoom:s-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},(function(e){"finished"===e.state.playState?n._requesting<1||Math.abs(s-n._startZoom)>2||s===i.getMaxZoom()||s===i.getMinZoom()?(i._animateTo({zoom:s,around:n._origin},{continueOnViewChanged:!0,duration:100},(function(t){"running"!==t.state.playState&&(delete n._zooming,delete n._requesting)})),delete n._startZoom,delete n._origin,delete n._delta,n._requesting=0):Dn$3(n._requesting)||(delete n._zooming,n._onWheelScroll(t)):"running"!==e.state.playState&&(delete n._zooming,delete n._requesting)}))),!1},e}(ls$1);qh.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0}),qh.addOnLoadHook("addHandler","scrollWheelZoom",el);var nl=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){Io$2(this.target.getContainer(),"touchstart",this._onTouchStart,this)},n.removeHooks=function(){ko$2(this.target.getContainer(),"touchstart",this._onTouchStart)},n._onTouchStart=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var n=e.getContainer(),i=Ho$3(t.touches[0],n),r=Ho$3(t.touches[1],n);this.preY=i.y,this._startP1=i,this._startP2=r,this._startDist=i.distanceTo(r),this._startVector=i.sub(r),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),Jo$2(document,"touchmove",this._onTouchMove),Jo$2(document,"touchend",this._onTouchEnd),Io$2(document,"touchmove",this._onTouchMove,this),Io$2(document,"touchend",this._onTouchEnd,this),Lo$2(t),e._fireEvent("touchactstart")}},n._onTouchMove=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var n=e.getContainer(),i=Ho$3(t.touches[0],n),r=Ho$3(t.touches[1],n),o=i.sub(this._startP1),s=r.sub(this._startP2),a=i.sub(r),h=i.distanceTo(r)/this._startDist,l=180*a.angleWith(this._startVector)/Math.PI,c=.4*((this.preY||i.y)-i.y);this.preY=i.y;var u={domEvent:t,mousePos:[i,r]};if(this.mode||(e.options.touchRotate&&Math.abs(l)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&o.y*s.y>0&&Math.abs(o.y)>10&&Math.abs(s.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-h)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(u)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=h;var f=e._getResolution(this._startZoom)/h,d=e.getZoomFromRes(f);e.onZooming(d,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(e._setBearing(this._startBearing+l),e.onDragRotating(u)):"pitch"===this.mode&&(e._setPitch(e.getPitch()+c),e.onDragRotating(u)),e._fireEvent("touchactinging")}},n._startTouching=function(t){var e=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var n=e.getSize();this._Origin=new Ii$4(n.width/2,n.height/2),e.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateStart(t)},n._onTouchEnd=function(t){delete this.preY;var e=this.target;if(Jo$2(document,"touchmove",this._onTouchMove),Jo$2(document,"touchend",this._onTouchEnd),"zoom"===this.mode||"rotate_zoom"===this.mode){var n=this._scale,i=e._getResolution(this._startZoom)/n,r=e.getZoomFromRes(i);e.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},e}(ls$1);qh.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),qh.addOnLoadHook("addHandler","touchGesture",nl);var il="__anim_player",rl={outExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},outQuint:function(t){return 1-Math.pow(1-t,5)},in:function(t){return Math.pow(t,2)},out:function(t){return 1-rl.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?rl.inAndOut(2*t):1-rl.inAndOut(2*(t-.5))}},ol=function(t,e){this.state=t,this.styles=e},sl=function(t,e,n,i){this._animation=t,this.options=e,this._onFrame=n,this.playState="idle",this.ready=!0,this.finished=!1,this.target=i},al={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function e(t){if(!Array.isArray(t))return al._resolveStyles(t);for(var e=[],n=[],i=[],r=0;r<t.length;r++){var o=al._resolveStyles(t[r]);o&&(e.push(o[0]),n.push(o[1]),i.push(o[2]))}return e.length?[e,n,i]:null}function n(t){var e,n=t;Array.isArray(t)||(n=Ln$3(t)?[0,t]:t instanceof Ii$4||t instanceof ys$1?[new(e=t.constructor)(0,0),t]:[t,t]);var i=n[0],r=n[1];return Ln$3(i)&&Ln$3(r)?i===r?null:[i,r-i,r]:Array.isArray(i)&&Ln$3(i[0])||i instanceof ys$1||i instanceof Ii$4?(Array.isArray(i)?(i=new ys$1(i),r=new ys$1(r)):(i=new(e=i.constructor)(i),r=new e(r)),i.equals(r)?null:[i,r.sub(i),r]):[i,r,r]}var i,r={},o={},s={};for(var a in t)if(t.hasOwnProperty(a)){var h=t[a];if(!h)continue;if(Array.isArray(h)&&(Dn$3(h[0])||Dn$3(h[1])))continue;var l;i=h,(l=!Array.isArray(i)&&i.constructor===Object||Array.isArray(i)&&i[0].constructor===Object?e(h):n(h))&&(o[a]=l[0],r[a]=l[1],s[a]=l[2])}return[o,r,s]},framing:function(t,e){e||(e={});var n,i,r,o=e.easing?rl[e.easing]:rl.linear;return o||(o=rl.linear),(t=al._resolveStyles(t))&&(i=t[0],n=t[1],r=t[2]),function(t,e){var s,a;if(t<0)s={playState:"idle",delta:0},a=i;else if(t<e){var h=o(t/e);s={playState:"running",delta:h},a=function t(e,n,i){if(!n||!i)return null;var o={};for(var s in i)if(i.hasOwnProperty(s)){if(n[s]===r[s]){o[s]=n[s];continue}var a=n[s],h=i[s];if(Ln$3(h))o[s]=a+e*h;else if(Array.isArray(h)){for(var l=[],c=0;c<h.length;c++)l.push(t(e,a[c],h[c]));o[s]=l}else o[s]=h.constructor===Object?t(e,a,h):a instanceof Ii$4||a instanceof ys$1?a.add(h.multi(e)):h}return o}(h,i,n)}else s={playState:"finished",delta:1},a=r;return s.startStyles=i,s.destStyles=r,s.progress=t,s.remainingMs=e-t,new ol(s,a)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=Ei$4(al._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]();this._frameQueue.length?this._animationFrameId=Ei$4(al._frameFn):delete this._animationFrameId}},animate:function(t,e,n,i){e||(e={});var r=al.framing(t,e);return new sl(r,e,n,i)}};al._frameFn=al._run.bind(al),kn$3(sl.prototype,{_prepare:function(){var t=this.options,e=t.speed||t.duration;jn$3(e)&&((e=al.speed[e])||(e=+e)),e||(e=al.speed.normal),this.duration=e,this._framer=t.framer||al._requestAnimFrame.bind(al)},play:function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[il])return this;this.target&&(this.target[il]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=In$3();if(!this.startTime){var e=this.options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},pause:function(){return"paused"===this.playState||(this.playState="paused",this._run()),this},cancel:function(){return"idle"===this.playState||(this.playState="idle",this.finished=!1,this._run()),this},finish:function(){return"finished"===this.playState||(this.playState="finished",this.finished=!0,this._run()),this},reverse:function(){},_run:function(){var t=this,e=this._onFrame,n=In$3(),i=n-this._playStartTime;if(this.options.repeat&&i>=this.duration&&(this._playStartTime=n,i=0),"running"===this.playState){var r=this._animation(i,this.duration);this.playState=r.state.playState,"running"!==this.playState&&this.target&&delete this.target[il],"idle"===this.playState?this.startTime>n&&setTimeout(this._run.bind(this),this.startTime-n):"running"===this.playState?this._framer((function(){"running"===t.playState&&(t.currentTime=i,e&&e(r),t._run())})):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(this.target&&delete this.target[il],e){"finished"===this.playState?i=this.duration:"idle"===this.playState&&(i=0);var o=this._animation(i,this.duration);o.state.playState=this.playState,e(o)}}});var hl=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.animateShow=function(t,e){var n=this;void 0===t&&(t={}),this._showPlayer&&this._showPlayer.finish(),Hn$3(t)&&(e=t={});var i=this.getCoordinates();if(0===i.length)return this;this._animIdx=0,this._animLenSoFar=0,this.show();var r=this.getShell?this.getShell().concat(this.getShell()[0]):i,o=this._getProjection(),s=o.projectCoords(r,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=o.unproject(this._prjAniShowCenter);var a=t.duration||1e3,h=t.easing||"out";this.setCoordinates([]);var l=0;s.length&&(s[0]._distance=0);for(var c=1;c<s.length;c++){var u=s[c].distanceTo(s[c-1]);s[c]._distance=u,l+=u}this._tempCoord=new ys$1(0,0),this._tempPrjCoord=new Ii$4(0,0);var f=this._showPlayer=al.animate({t:a},{duration:a,easing:h},(function(t){if(n.getMap()){var o=n._drawAnimShowFrame(t.styles.t,a,l,r,s);"finished"===t.state.playState&&(delete n._showPlayer,delete n._aniShowCenter,delete n._prjAniShowCenter,delete n._animIdx,delete n._animLenSoFar,delete n._animTailRatio,delete n._tempCoord,delete n._tempPrjCoord,n.setCoordinates(i)),e&&e(t,o)}else if("finished"!==f.playState&&(f.finish(),e)){var h=n.getCoordinates();e(t,h[h.length-1])}}),this);return f.play(),f},n._drawAnimShowFrame=function(t,e,n,i,r){if(0===t)return i[0];var o,s,a=t/e*n,h=0;for(o=this._animIdx+1,s=r.length;o<s&&!(this._animLenSoFar+(h=r[o]._distance)>a);o++)this._animLenSoFar+=h;if(this._animIdx=o-1,this._animIdx>=s-1)return this.setCoordinates(i),i[i.length-1];var l=this._animIdx,c=r[l],u=r[l+1],f=(a-this._animLenSoFar)/h;this._animTailRatio=f;var d=c.y+(u.y-c.y)*f;this._tempPrjCoord.x=c.x+(u.x-c.x)*f,this._tempPrjCoord.y=d;var m=this._tempPrjCoord,g=i[l],p=i[l+1],_=g.y+(p.y-g.y)*f;this._tempCoord.x=g.x+(p.x-g.x)*f,this._tempCoord.y=_;var v=this._tempCoord,y=!!this.getShell;if(!y&&this.options.smoothness>0){for(var x=[],b=[],w=0;w<=this._animIdx;w++)x.push(i[w]),b.push(r[w]);x.push(v,v),b.push(m,m),this.setCoordinates(x),this._setPrjCoordinates(b)}else{var C=i.slice(0,this._animIdx+1);C.push(v);var M=r.slice(0,this._animIdx+1);M.push(m),y?(this.setCoordinates([this._aniShowCenter].concat(C)),this._setPrjCoordinates([this._prjAniShowCenter].concat(M))):(this.setCoordinates(C),this._setPrjCoordinates(M))}return v},n._getCenterInExtent=function(t,e,n){var i=this.getExtent();if(!t.intersects(i))return null;var r=n(e,t);if(0===r.length)return null;var o=0,s=0,a=0;r.forEach((function(t){Array.isArray(t)?t.forEach((function(t){t.point&&(t=t.point),o+=t.x,s+=t.y,a++})):(t.point&&(t=t.point),o+=t.x,s+=t.y,a++)}));var h=new ys$1(o,s)._multi(1/a);return h.count=a,h},n._getPath2DPoints=function(t,e,n){if(!Ji$4(t))return[];var i=this.getMap(),r=!e&&this._shouldSimplify(),o=this.options.simplifyTolerance*i._getResolution(),s=Array.isArray(t[0]);if(delete this._simplified,r&&!s){var a=t.length;t=yn$3(t,o,!1),this._simplified=t.length<a}if(n||(n=i._getResolution()),Array.isArray(t)){var h=[];if(!Array.isArray(t[0]))return h=ar$4(t,"_glPt"),i._prjsToPointsAtRes(t,n,h);for(var l=[],c=0,u=t.length;c<u;c++){var f=t[c];h=ar$4(f,"_glPt");var d=i._prjsToPointsAtRes(f,n,h);l.push(d)}return l}return i._prjToPointAtRes(t,n)},n._shouldSimplify=function(){var t=this.getLayer(),e=this.getProperties(),n=e&&t.options.enableAltitude&&!Dn$3(e[t.options.altitudeProperty])&&0!==e[t.options.altitudeProperty];return t&&t.options.enableSimplify&&!n&&this.options.enableSimplify&&!this._showPlayer},n._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},n._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},n._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},n._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},n._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t,this.options.antiMeridian):[]},n._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},n._computeCenter=function(){var t=this._coordinates;if(!Ji$4(t))return null;for(var e=0,n=0,i=0,r=t.length,o=0;o<r;o++)t[o]&&Ln$3(t[o].x)&&Ln$3(t[o].y)&&(e+=t[o].x,n+=t[o].y,i++);return new ys$1(e/i,n/i)},n._computeExtent=function(){var t=this._coordinates;if(!Ji$4(t))return null;var e=[t];return this.hasHoles&&this.hasHoles()&&e.push.apply(e,this.getHoles()),this._coords2Extent(e,this._getProjection())},n._computePrjExtent=function(){var t=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&t.push.apply(t,this._getPrjHoles()),this._coords2Extent(t)},n._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,n=1,i=t.length;n<i;n++)e+=t[n].distanceTo(t[n-1]);return e},n._hitTestTolerance=function(){var e,n=this._getInternalSymbol();if(Array.isArray(n)){e=0;for(var i=0;i<n.length;i++)Ln$3(n[i].lineWidth)&&n[i].lineWidth>e&&(e=n[i].lineWidth)}else e=n.lineWidth;return t.prototype._hitTestTolerance.call(this)+(Ln$3(e)?e/2:1.5)},n._coords2Extent=function(t,e){if(!t||0===t.length||Array.isArray(t[0])&&0===t[0].length)return null;for(var n=new ks$1(e),i=0,r=t.length;i<r;i++)for(var o=0,s=t[i].length;o<s;o++)n._combine(t[i][o]);return n},e}(kh);hl.mergeOptions({smoothness:0,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var ll=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="Polygon",e&&i.setCoordinates(e),i}Pi$4(e,t);var n=e.prototype;return n.getOutline=function(){return this._getPainter()?new e(this.getExtent().toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}}):null},n.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=ys$1.toCoordinates(t),n=e.length;if(Array.isArray(e[0])){if(this._coordinates=this._trimRing(e[0]),n>1){for(var i=[],r=1;r<n;r++)e[r]&&i.push(this._trimRing(e[r]));this._holes=i}}else this._coordinates=this._trimRing(e);return this._projectRings(),this},n.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],n=0,i=t.length;n<i;n++)e.push(this._copyAndCloseRing(t[n]));return e},n.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),Ua)},n.getShell=function(){return this._coordinates||[]},n.getHoles=function(){return this._holes||[]},n.hasHoles=function(){return this.getHoles().length>0},n._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},n._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},n._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},n._checkRing=function(t){if(this._cleanRing(t),!t||!Ji$4(t))return!1;var e=t[t.length-1],n=!0;return t[0].x===e.x&&t[0].y===e.y||(n=!1),n},n._trimRing=function(t){var e=this._checkRing(t);return Ji$4(t)&&e&&t.splice(t.length-1,1),t},n._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return Ji$4(t)&&!e?(t.push(t[0].copy()),t):t},n._getPrjShell=function(){return"Polygon"===this.getJSONType()?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this.getShell())),this._prjShell)},n._getPrjHoles=function(){var t=this._getProjection();return this._verifyProjection(),t&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},n._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!Ji$4(e))return 0;for(var n=0,i=0,r=e.length;i<r;i++)n+=t.measureLength(e[i]);return n},n._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!Ji$4(e))return 0;for(var n=t.measureArea(e[0]),i=1,r=e.length;i<r;i++)n-=t.measureArea(e[i]);return n},n._updateCache=function(){t.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},n._clearCache=function(){return delete this._prjShell,t.prototype._clearCache.call(this)},n._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),t.prototype._clearProjection.call(this)},e}(hl);function cl(t){return function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(t){var e=t instanceof ys$1?t:new ys$1(t);if(e.equals(this._coordinates))return this;if(this._coordinates=e,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var n=this._getProjection();return this._setPrjCoordinates(n.project(this._coordinates)),this},n._getCenter2DPoint=function(t){var e=this.getMap();if(!e)return null;var n=this._getPrjCoordinates();return n?(t||(t=e._getResolution()),e._prjToPointAtRes(n,t)):null},n._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pcenter&&t&&this._coordinates&&(this._pcenter=t.project(this._coordinates)),this._pcenter},n._setPrjCoordinates=function(t){this._pcenter=t,this.onPositionChanged()},n._updateCache=function(){this._clearCache();var t=this._getProjection();this._pcenter&&t&&(this._coordinates=t.unproject(this._pcenter))},n._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},n._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},e}(t)}ll.registerJSONType("Polygon");var ul=new Ls$1,fl=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="Point",e&&i.setCoordinates(e),i}Pi$4(e,t);var n=e.prototype;return n.getOutline=function(){var t=this.getCoordinates(),n=this.getContainerExtent(),i=this.getMap().coordToContainerPoint(t);return new e(t,{symbol:{markerType:"square",markerWidth:n.getWidth(),markerHeight:n.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:n.xmin-(i.x-n.getWidth()/2),markerDy:n.ymin-(i.y-n.getHeight()/2)}})},n.setSymbol=function(){var e;delete this._fixedExtent;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.prototype.setSymbol).call.apply(e,[this].concat(i))},n._getSizeSymbol=function(t){for(var e,n={},i=!1,r=!1,o=0;o<Ba.length;o++){var s=t[Ba[o]];Dn$3(s)||(!i&&Mr$4(s)&&(i=!0,r=!0),n[Ba[o]]=s)}for(var a=0;a<Ga.length;a++){var h=t[Ga[a]];Dn$3(h)||(!i&&Mr$4(h)&&(i=!0),n[Ga[a]]=h)}return i?(e=Wr$4(n,this),r&&(e._dynamic=!0)):e=n,e},n._setExternSymbol=function(e){return this._symbol||delete this._fixedExtent,t.prototype._setExternSymbol.call(this,e)},n._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},n._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new Ls$1,this._fixedExtent.set(null,null,null,null);var t=this._sizeSymbol;if(!t)return this._fixedExtent;var e=this.getLayer()&&this.getLayer().getRenderer(),n=e&&e.resources,i=this.getTextDesc();if(Array.isArray(t)){ul.set(1/0,1/0,-1/0,-1/0);for(var r=0;r<t.length;r++)t[r]&&this._fixedExtent._combine(La(ul,t[r],n,i&&i[r]))}else this._fixedExtent=La(this._fixedExtent,t,n,i);return this._fixedExtent},n._isVectorMarker=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&ja(t)},n._canEdit=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&(ja(t)||Ha(t)||Fa(t))},n._containsPoint=function(e,n){var i=this.getContainerExtent();return n&&(i=i.expand(n)),!!i.contains(e)&&(!this.options.hitTestForEvent||t.prototype._containsPoint.call(this,e,n))},n._computeExtent=function(){return dl.call(this,"getCenter")},n._computePrjExtent=function(){return dl.call(this,"_getPrjCoordinates")},n._computeGeodesicLength=function(){return 0},n._computeGeodesicArea=function(){return 0},n._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new Th(this).getSprite(t,e)},e}(cl(kh));function dl(t){var e=this[t]();return e?new ks$1(e,e,this._getProjection()):null}fl.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1}),fl.registerJSONType("Marker");var ml=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="LineString",e&&i.setCoordinates(e),i}Pi$4(e,t);var n=e.prototype;return n.getOutline=function(){return ll.prototype.getOutline.call(this)},n.setCoordinates=function(t){return t?(this._coordinates=ys$1.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},n.getCoordinates=function(){return this._coordinates||[]},n.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),Va)},n._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},n._computeGeodesicArea=function(){return 0},e}(hl);ml.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),ml.registerJSONType("LineString");var gl=new Ls$1,pl=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="GeometryCollection",i.setGeometries(e),i}Pi$4(e,t);var n=e.prototype;return n.getContainerExtent=function(t){var e=t||new Ls$1;return this.forEach((function(t){e._combine(t.getContainerExtent(gl))})),e},n.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),n=this._getSymbol(),i=this.config(),r=e.length-1;r>=0;r--)e[r]._initOptions(i),e[r]._setParent(this),e[r]._setEventParent(this),n&&e[r].setSymbol(n);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},n.getGeometries=function(){return this._geometries||[]},n.forEach=function(t,e){for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i]&&(e?t.call(e,n[i],i):t(n[i],i));return this},n.filter=function(t,n){if(!t)return new e;var i=[],r=Hn$3(t),o=r?t:Or$4(t);return this.forEach((function(t){var e=r?t:Nr$4(t);(n?o.call(n,e):o(e))&&i.push(t)}),this),new e(i)},n.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach((function(t){t&&t.translate&&t.translate.apply(t,e)})),this},n.isEmpty=function(){return!Ji$4(this.getGeometries())},n.remove=function(){return this.forEach((function(t){t._unbind()})),kh.prototype.remove.apply(this,arguments)},n.show=function(){return this.options.visible=!0,this.forEach((function(t){t.show()})),this},n.hide=function(){return this.options.visible=!1,this.forEach((function(t){t.hide()})),this},n.onConfig=function(t){this.forEach((function(e){e.config(t)}))},n.getSymbol=function(){var e=t.prototype.getSymbol.call(this);if(!e){var n=[],i=!1;this.forEach((function(t){t.getSymbol()&&!i&&(i=!0),n.push(t.getSymbol())})),i&&(e={children:n})}return e},n.setSymbol=function(t){if(t&&t.children)this._symbol=null,this.forEach((function(e,n){e.setSymbol(t.children[n])}));else{var e=this._prepareSymbol(t);this._symbol=e,this.forEach((function(t){t.setSymbol(e)}))}return this.onSymbolChanged(),this},n._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach((function(e){e._setExternSymbol(t)})),this.onSymbolChanged(),this},n._bindLayer=function(){t.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},n._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach((function(e){e._bindLayer(t)}))},n._checkGeometries=function(t){if(t&&!Array.isArray(t)){if(t instanceof kh)return[t];throw new Error("The geometry added to collection is invalid.")}for(var e=0,n=t.length;e<n;e++)if(!this._checkGeo(t[e]))throw new Error("The geometry added to collection is invalid. Index: "+e);return t},n._checkGeo=function(t){return t instanceof kh},n._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach((function(t){t&&t._updateCache&&t._updateCache()}))},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach((function(t){t._removePainter()}))},n._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,n=0,i=0,r=this.getGeometries(),o=0,s=r.length;o<s;o++)if(r[o]){var a=r[o]._computeCenter(t);a&&(e+=a.x,n+=a.y,i++)}return 0===i?null:new ys$1(e/i,n/i)},n._containsPoint=function(t,e){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)if(n[i]._containsPoint(t,e))return this._pickGeometryIndex=i,!0;return!1},n._computeExtent=function(t){return _l.call(this,t,"_computeExtent")},n._computePrjExtent=function(t){return _l.call(this,t,"_computePrjExtent")},n._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,i=0,r=e.length;i<r;i++)e[i]&&(n+=e[i]._computeGeodesicLength(t));return n},n._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,i=0,r=e.length;i<r;i++)e[i]&&(n+=e[i]._computeGeodesicArea(t));return n},n._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),n=0,i=e.length;n<i;n++)e[n]&&t.push(e[n]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},n._toJSON=function(t){var e,n={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter((function(t){return t&&t._toJSON})).map((function(t){var e=t._toJSON();return e.subType?e:t._exportGeoJSONGeometry()}))}},i=this.getId();return Dn$3(i)||(n.id=i),(Dn$3(t.properties)||t.properties)&&(e=this._exportProperties()),n.properties=e,t.feature=n,t},n._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e]&&t[e]._clearProjection()},n._getConnectPoints=function(){var t=this.getExtent();return[new ys$1(t.xmin,t.ymax),new ys$1(t.xmax,t.ymin),new ys$1(t.xmin,t.ymin),new ys$1(t.xmax,t.ymax)]},n._getExternalResources=function(){if(this.isEmpty())return[];for(var t,e,n=this.getGeometries(),i=[],r={},o=0,s=n.length;o<s;o++)if(n[o])for(var a=0,h=(t=Xr$4(n[o]._getInternalSymbol())).length;a<h;a++)r[e=t[a].join()]||(i.push(t[a]),r[e]=1);return i},n.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1);for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i].startEdit(t);this._editing=!0;var o=this.getLayer();return o&&"canvas"===o.options.renderer&&this.hide(),setTimeout((function(){e.fire("editstart")}),1),this},n.endEdit=function(){if(this.isEmpty())return this;for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},n.isEditing=function(){return!!this._editing},e}(kh);function _l(t,e){if(this.isEmpty())return null;for(var n=new ks$1,i=this.getGeometries(),r=0,o=i.length;r<o;r++)if(i[r]){var s=i[r][e](t);s&&n._combine(s)}return n}pl.registerJSONType("GeometryCollection");var vl=function(t){function e(e,n,i,r){var o;return(o=t.call(this,null,r)||this).GeometryType=e,o.type=n,o._initData(i),o}Pi$4(e,t);var n=e.prototype;return n.getCoordinates=function(){for(var t=[],e=this.getGeometries(),n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.getShell&&"Polygon"!==r.getJSONType()?[r.getShell()]:r.getCoordinates())}return t},n.setCoordinates=function(t){for(var e=[],n=0,i=(t=t||[]).length;n<i;n++){var r=new this.GeometryType(t[n],this.config());e.push(r)}return this.setGeometries(e),this},n._initData=function(t){(t=t||[]).length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},n._checkGeo=function(t){return t instanceof this.GeometryType},n._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=ys$1.toNumberArrays(t);return{type:this.getType(),coordinates:e}},n._toJSON=function(t){return{feature:this.toGeoJSON(t)}},e}(pl),yl=function(t){function e(e,n){return t.call(this,fl,"MultiPoint",e,n)||this}return Pi$4(e,t),e.prototype.findClosest=function(t){if(!t)return null;var e=this.getCoordinates(),n=null,i=1/0;return e.forEach((function(e){var r,o,s,a,h=(s=(o=t).x-(r=e).x,a=o.y-r.y,Math.sqrt(s*s+a*a));h<i&&(n=e,i=h)})),n},e}(vl);yl.registerJSONType("MultiPoint");var xl=function(t){function e(){return t.apply(this,arguments)||this}return Pi$4(e,t),e.prototype.getCenterInExtent=function(t){var e=this.getGeometries(),n=0,i=0,r=0;return e.forEach((function(e){var o=e.getCenterInExtent(t);o&&(n+=o.x*o.count,i+=o.y*o.count,r+=o.count)})),0===r?null:new ys$1(n,i)._multi(1/r)},e}(vl),bl=function(t){function e(e,n){return t.call(this,ml,"MultiLineString",e,n)||this}return Pi$4(e,t),e}(xl);bl.registerJSONType("MultiLineString");var wl=function(t){function e(e,n){return t.call(this,ll,"MultiPolygon",e,n)||this}return Pi$4(e,t),e}(xl);wl.registerJSONType("MultiPolygon");var Cl={Marker:fl,LineString:ml,Polygon:ll,MultiPoint:yl,MultiLineString:bl,MultiPolygon:wl},Ml={toGeometry:function(t,e){if(jn$3(t)&&(t=ji$4(t)),Array.isArray(t)){for(var n=[],i=0,r=t.length;i<r;i++){var o=Ml._convert(t[i],e);Array.isArray(o)?Hi$4(n,o):n.push(o)}return n}return Ml._convert(t,e)},_convert:function(t,e){if(!t||Dn$3(t.type))return null;var n=t.type;if("Feature"===n){var i=Ml._convert(t.geometry);return i?(i.setId(t.id),i.setProperties(t.properties),e&&e(i),i):null}if("FeatureCollection"===n){var r=t.features;return r?Ml.toGeometry(r,e):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(n)>=0){var o=new Cl["Point"===n?"Marker":n](t.coordinates);return e&&e(o),o}if("GeometryCollection"===n){var s=t.geometries;if(!Ji$4(s)){var a=new pl;return e&&e(a),a}for(var h=[],l=s.length,c=0;c<l;c++)h.push(s[c].subType?kh.getJSONClass(s[c].subType).fromJSON(s[c]):Ml._convert(s[c]));var u=new pl(h);return e&&e(u),u}return null}},Tl=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,e&&r.setCoordinates(e),r._radius=n,r}Pi$4(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.radius,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getRadius=function(){return this._radius},n.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},n.getShell=function(){for(var t,e,n,i=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints,s=this.getRadius(),a=[],h=0,l=o-1;h<l;h++){t=360*h/l*Math.PI/180,e=s*Math.cos(t),n=s*Math.sin(t);var c=i.locate(r,e,n);a.push(c)}return a.push(a[0]),a},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._containsPoint=function(e,n){var i=this.getMap();if(i.getPitch())return t.prototype._containsPoint.call(this,e,n);var r=i._pointToContainerPoint(this._getCenter2DPoint()),o=this.getSize(),s=Dn$3(n)?this._hitTestTolerance():n,a=r.add(o.width/2,o.height/2);return Ja(e,r,a,s)},n._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var n=this._getPrjCoordinates(),i=e.map((function(e){return t.project(e)})),r=i[1].x-n.x,o=i[3].y-n.y;return new ks$1(n.add(i[0].x-n.x,i[2].y-n.y),n.add(r,o))},n._computeExtent=function(t){var e=this._getMinMax(t);return e?new ks$1(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},n._getMinMax=function(t){if(!t||!this._coordinates||Dn$3(this._radius))return null;var e=this._radius;return[t.locate(this._coordinates,-e,0),t.locate(this._coordinates,e,0),t.locate(this._coordinates,0,e),t.locate(this._coordinates,0,-e)]},n._computeGeodesicLength=function(){return Dn$3(this._radius)?0:2*Math.PI*this._radius},n._computeGeodesicArea=function(){return Dn$3(this._radius)?0:Math.PI*Math.pow(this._radius,2)},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:ys$1.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=this.getCenter(),n=kn$3({},t);n.geometry=!1;var i=this.toGeoJSON(n);return i.geometry={type:"Polygon"},{feature:i,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},e}(cl(ll));Tl.mergeOptions({numberOfShellPoints:60}),Tl.registerJSONType("Circle");var Sl=function(t){function e(e,n,i,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o.width=n,o.height=i,o}Pi$4(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getWidth=function(){return this.width},n.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},n.getHeight=function(){return this.height},n.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},n.getShell=function(){for(var t,e,n,i,r=this._getMeasurer(),o=this.getCoordinates(),s=this.options.numberOfShellPoints,a=this.getWidth(),h=this.getHeight(),l=[],c=Math.pow(a/2,2)*Math.pow(h/2,2),u=Math.pow(a/2,2),f=Math.pow(h/2,2),d=0;d<s;d++){e=(t=360*d/s)*Math.PI/180,n=Math.sqrt(c/(u*Math.pow(Math.tan(e),2)+f)),i=Math.sqrt(c/(f*Math.pow(1/Math.tan(e),2)+u)),t>90&&t<270&&(n*=-1),t>180&&t<360&&(i*=-1);var m=r.locate(o,n,i);l.push(m)}return l},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=i.getProjection(),o=Dn$3(n)?this._hitTestTolerance():n,s=r.projectCoords([this._coordinates,i.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian);return Ja(e,i._prjToContainerPoint(s[0]),i._prjToContainerPoint(s[1]),o)},n._computePrjExtent=function(){return Tl.prototype._computePrjExtent.apply(this,arguments)},n._computeExtent=function(){return Tl.prototype._computeExtent.apply(this,arguments)},n._getMinMax=function(t){if(!t||!this._coordinates||Dn$3(this.width)||Dn$3(this.height))return null;var e=this.getWidth(),n=this.getHeight();return[t.locate(this._coordinates,-e/2,0),t.locate(this._coordinates,e/2,0),t.locate(this._coordinates,0,-n/2),t.locate(this._coordinates,0,n/2)]},n._computeGeodesicLength=function(){return Dn$3(this.width)||Dn$3(this.height)?0:2*Math.PI*(this.width>this.height?this.width:this.height)/2-4*Math.abs(this.width-this.height)},n._computeGeodesicArea=function(){return Dn$3(this.width)||Dn$3(this.height)?0:Math.PI*this.width*this.height/4},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:ys$1.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=kn$3({},t),n=this.getCenter();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Ellipse",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},e}(cl(ll));Sl.mergeOptions({numberOfShellPoints:80}),Sl.registerJSONType("Ellipse");var Pl=function(t){function e(e,n,i,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o._width=n,o._height=i,o}Pi$4(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(t){if(this._coordinates=t instanceof ys$1?t:new ys$1(t),!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var e=this._getProjection();return this._setPrjCoordinates(e.project(this._coordinates)),this},n.getWidth=function(){return this._width},n.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},n.getHeight=function(){return this._height},n.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},n.getShell=function(){var t=this._getMeasurer(),e=this._coordinates,n=this.getMap(),i=1,r=-1;if(n){var o=n.getFullExtent();o.left>o.right&&(i=-1),o.bottom>o.top&&(r=1)}var s=[];return s.push(e),s.push(t.locate(e,i*this._width,0)),s.push(t.locate(e,i*this._width,r*this._height)),s.push(t.locate(e,0,r*this._height)),s.push(e),s},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pnw&&t&&this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw},n._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},n._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this),n=this._getProjection();if(!n.isSphere())return e;for(var i=n.getSphereExtent(),r=i.sx,o=i.sy,s=this._getProjection().getCircum(),a=e[0],h=1,l=e.length;h<l;h++){var c=e[h],u=0,f=0;r*(a.x-c.x)>0&&(u=s.x*r),o*(a.y-c.y)<0&&(f=s.y*o),e[h]._add(u,f)}return e},n._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},n._clearProjection=function(){this._pnw=null,t.prototype._clearProjection.call(this)},n._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=Dn$3(n)?this._hitTestTolerance():n,o=i._getResolution()*r,s=this._getPrjExtent().expand(o),a=i._containerPointToPrj(e);return s.contains(a)},n._computePrjExtent=function(t){var e=this._getSouthEast(t);if(!e)return null;var n=t.projectCoords([new ys$1(this._coordinates.x,e.y),new ys$1(e.x,this._coordinates.y)],this.options.antiMeridian);return new ks$1(n[0],n[1])},n._computeExtent=function(t){var e=this._getSouthEast(t);return e?new ks$1(this._coordinates,e,this._getProjection()):null},n._getSouthEast=function(t){if(!t||!this._coordinates||Dn$3(this._width)||Dn$3(this._height))return null;var e=this.getWidth(),n=-this.getHeight();if(t.fullExtent){var i=t.fullExtent;e*=i.right>i.left?1:-1,n*=i.top>i.bottom?1:-1}var r=t.locate(this._coordinates,e,0),o=t.locate(this._coordinates,0,n);return r.y=o.y,r},n._computeGeodesicLength=function(){return Dn$3(this._width)||Dn$3(this._height)?0:2*(this._width+this._height)},n._computeGeodesicArea=function(){return Dn$3(this._width)||Dn$3(this._height)?0:this._width*this._height},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:ys$1.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=kn$3({},t),n=this.getCoordinates();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Rectangle",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},e}(ll);Pl.registerJSONType("Rectangle");var Al=function(t){function e(e,n,i,r,o){var s;return(s=t.call(this,e,n,o)||this).startAngle=i,s.endAngle=r,s}Pi$4(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getStartAngle=function(){return this.startAngle},n.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},n.getEndAngle=function(){return this.endAngle},n.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},n.getShell=function(){for(var t,e,n,i=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints-2,s=this.getRadius(),a=[r.copy()],h=this.getStartAngle(),l=this.getEndAngle()-h,c=0;c<o;c++){t=(l*c/(o-1)+h)*Math.PI/180,e=s*Math.cos(t),n=s*Math.sin(t);var u=i.locate(r,e,n);a.push(u)}return a.push(r.copy()),a},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var d,r=i._pointToContainerPoint(this._getCenter2DPoint()),o=Dn$3(n)?this._hitTestTolerance():n,s=this.getSize(),a=r,h=e,l=Math.atan2(a.y-h.y,h.x-a.x),c=l<0?360*(l+2*Math.PI)/(2*Math.PI):360*l/(2*Math.PI),u=this.startAngle%360,f=this.endAngle%360;return d=u>f?!(c>f&&c<u):c>=u&&c<=f,h.distanceTo(a)<=s.width/2+o&&d},n._computeGeodesicLength=function(){return Dn$3(this._radius)?0:2*Math.PI*this._radius*Math.abs(this.startAngle-this.endAngle)/360+2*this._radius},n._computeGeodesicArea=function(){return Dn$3(this._radius)?0:Math.PI*Math.pow(this._radius,2)*Math.abs(this.startAngle-this.endAngle)/360},n._toJSON=function(t){var e=kn$3({},t),n=this.getCenter();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Sector",coordinates:[n.x,n.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},e}(Tl);Al.mergeOptions({numberOfShellPoints:60}),Al.registerJSONType("Sector");var El=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n._arc=function(t,e,n){for(var i=this.options.arcDegree*Math.PI/180,r=1,o=e.length;r<o;r++){var s=is$1._arcBetween(t,e[r-1],e[r],i),a=[e[r-1].x+e[r].x-s[0],e[r-1].y+e[r].y-s[1]];e[r-1].nextCtrlPoint=a,e[r].prevCtrlPoint=a,is$1._stroke(t,n)}},n._quadraticCurve=function(t,e){if(e.length<=2)is$1._path(t,e);else{var n,i;for(n=2,i=e.length;n<i;n+=2)t.quadraticCurveTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y);if((n-=1)<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},n._bezierCurve=function(t,e){if(e.length<=3)is$1._path(t,e);else{var n,i;for(n=1,i=e.length;n+2<i;n+=3)t.bezierCurveTo(e[n].x,e[n].y,e[n+1].x,e[n+1].y,e[n+2].x,e[n+2].y);if(n<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},n._getCurveArrowPoints=function(t,e,n,i,r,o){var s,a=e.length;for(s=o;s<a;s+=o){var h=this._getArrowShape(e[s-1],e[s],n,i,r);h&&t.push(h)}if((s-=o)<a-1)for(s+=1;s<a;s++){var l=this._getArrowShape(e[s-1],e[s],n,i,r);l&&t.push(l)}},e}(ml);El.mergeOptions({enableSimplify:!1,enableClip:!1});var Ol=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},n._paintOn=function(t,e,n){t.beginPath(),this._arc(t,e,n),is$1._stroke(t,n),this._paintArrow(t,e,n)},e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i},e}(El);Ol.registerJSONType("ArcCurve"),Ol.mergeOptions({arcDegree:90});var Rl=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},n._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),is$1._stroke(t,n),this._paintArrow(t,e,n)},n._getArrowPoints=function(t,e,n,i,r){return this._getCurveArrowPoints(t,e,n,i,r,3)},e}(El);Rl.registerJSONType("CubicBezierCurve");var Il=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},n._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,n),is$1._stroke(t,n),this._paintArrow(t,e,n)},n._getArrowPoints=function(t,e,n,i,r){return this._getCurveArrowPoints(t,e,n,i,r,2)},e}(El);Il.registerJSONType("QuadBezierCurve");var kl={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},Dl={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},Ll=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.getContent=function(){return this._content},n.setContent=function(t){var e=this._content;return this._content=$r$4(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},n.onAdd=function(){this._refresh()},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return delete e.symbol,e},n.setSymbol=function(e){if(this._refreshing||!e)return t.prototype.setSymbol.call(this,e);var n=this._parseSymbol(e);if(this.setTextStyle){var i=this.getTextStyle()||{};i.symbol=n[0],this.setTextStyle(i)}else this.setTextSymbol&&this.setTextSymbol(n[0]);if(this.setBoxStyle){var r=this.getBoxStyle()||{};r.symbol=n[1],this.setBoxStyle(r)}else this.setBoxSymbol&&this.setBoxSymbol(n[1]);return this},n._parseSymbol=function(t){var e={},n={};for(var i in t)Bn$3(t,i)&&(0===i.indexOf("text")?e[i]=t[i]:n[i]=t[i]);return[e,n]},n._getTextSize=function(t){return co$3(this._content,t).size},n._getInternalSymbol=function(){return this._symbol},n._getDefaultTextSymbol=function(){return kn$3({},kl)},n._getDefaultBoxSymbol=function(){return kn$3({},Dl)},n._getDefaultPadding=function(){return[12,8]},e}(fl),zl=function(t){function e(e,n,i,r,o){var s;return void 0===o&&(o={}),(s=t.call(this,n,o)||this)._content=$r$4(e),s._width=Dn$3(i)?100:i,s._height=Dn$3(r)?40:r,o.boxSymbol&&s.setBoxSymbol(o.boxSymbol),o.textStyle&&s.setTextStyle(o.textStyle),s._refresh(),s}Pi$4(e,t);var n=e.prototype;return n.getWidth=function(){return this._width},n.setWidth=function(t){return this._width=t,this._refresh(),this},n.getHeight=function(){return this._height},n.setHeight=function(t){return this._height=t,this._refresh(),this},n.getBoxSymbol=function(){return kn$3({},this.options.boxSymbol)},n.setBoxSymbol=function(t){return this.options.boxSymbol=t?kn$3({},t):t,this.getSymbol()&&this._refresh(),this},n.getTextStyle=function(){return this.options.textStyle?kn$3({},this.options.textStyle):null},n.setTextStyle=function(t){return this.options.textStyle=t?kn$3({},t):t,this.getSymbol()&&this._refresh(),this},e.fromJSON=function(t){var n=t.feature,i=new e(t.content,n.geometry.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i.setId(n.id),t.symbol&&i.setSymbol(t.symbol),i},n._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},n._refresh=function(){var t,e,n=this.getTextStyle()||{},i=n.padding||[12,8];if(Mr$4(this._width)){var r=(t=JSON.parse(JSON.stringify(this._width))).stops;if(r)for(var o=0;o<r.length;o++)r[o][1]=r[o][1]-2*i[0]}else t=this._width-2*i[0];if(Mr$4(this._height)){var s=(e=JSON.parse(JSON.stringify(this._height))).stops;if(s)for(var a=0;a<s.length;a++)s[a][1]=s[a][1]-2*i[1]}else e=this._height-2*i[1];var h=kn$3({},n.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:t,textMaxHeight:e});n.wrap&&!h.textWrapWidth&&(h.textWrapWidth=t);var l,c=n.horizontalAlignment;if(h.textDx=h.markerDx||0,Mr$4(this._width)){var u=(l=JSON.parse(JSON.stringify(this._width))).stops;if(u)for(var f=0;f<u.length;f++)u[f][1]=u[f][1]/2-i[0],"left"===c&&(u[f][1]*=-1)}else l=h.markerWidth/2-i[0],"left"===c&&(l*=-1);"left"===c?(h.textHorizontalAlignment="right",h.textDx=l):"right"===c&&(h.textHorizontalAlignment="left",h.textDx=l);var d,m=n.verticalAlignment;if(h.textDy=h.markerDy||0,Mr$4(this._height)){var g=(d=JSON.parse(JSON.stringify(this._height))).stops;if(g)for(var p=0;p<g.length;p++)g[p][1]=g[p][1]/2-i[1],"top"===m&&(g[p][1]*=-1)}else d=h.markerHeight/2-i[1],"top"===m&&(d*=-1);"top"===m?(h.textVerticalAlignment="bottom",h.textDy=d):"bottom"===m&&(h.textVerticalAlignment="top",h.textDy=d),this._refreshing=!0,this.updateSymbol(h),delete this._refreshing},n.startEdit=function(e){var n=this._getCompiledSymbol();if(Mr$4(this._width)){var i=n.markerWidth;this._oldWidth=this._width,this.setWidth(i)}if(Mr$4(this._height)){var r=n.markerHeight;this._oldHeight=this._height,this.setHeight(r)}t.prototype.startEdit.call(this,e)},n.endEdit=function(){var e=this.getMap(),n=e&&e.getZoom();if(this._oldWidth){for(var i=this._width/Sr$4(this._oldWidth)(n),r=this._oldWidth.stops,o=0;o<r.length;o++)r[o][1]*=i;this.setWidth(this._oldWidth),delete this._oldWidth}if(this._oldHeight){for(var s=this._height/Sr$4(this._oldHeight)(n),a=this._oldHeight.stops,h=0;h<a.length;h++)a[h][1]*=s;this.setHeight(this._oldHeight),delete this._oldHeight}t.prototype.endEdit.call(this)},e}(Ll);zl.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),zl.registerJSONType("TextBox");var Fl=function(t){function e(e,n,i){var r;return void 0===i&&(i={}),r=t.call(this,n,i)||this,i.textSymbol&&r.setTextSymbol(i.textSymbol),i.boxStyle&&r.setBoxStyle(i.boxStyle),r._content=$r$4(e),r._refresh(),r}Pi$4(e,t);var n=e.prototype;return n.getBoxStyle=function(){return this.options.boxStyle?kn$3({},this.options.boxStyle):null},n.setBoxStyle=function(t){return this.options.boxStyle=t?kn$3({},t):t,this._refresh(),this},n.getTextSymbol=function(){return kn$3({},this._getDefaultTextSymbol(),this.options.textSymbol)},n.setTextSymbol=function(t){return this.options.textSymbol=t?kn$3({},t):t,this._refresh(),this},e.fromJSON=function(t){var n=t.feature,i=new e(t.content,n.geometry.coordinates,t.options);return i.setProperties(n.properties),i.setId(n.id),t.symbol&&i.setSymbol(t.symbol),i},n._canEdit=function(){return!1},n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},n._refresh=function(){var t=kn$3({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){kn$3(t,e.symbol);var n=this._getBoxSize(t),i=n[1],r=e.padding||this._getDefaultPadding(),o=n[0];t.markerWidth=o.width,t.markerHeight=o.height;var s=t.textDx||0,a=t.textDy||0,h=ho$3(i,t.textHorizontalAlignment,t.textVerticalAlignment)._add(s,a),l=e.horizontalAlignment||"middle";t.markerDx=h.x,"left"===l?t.markerDx+=t.markerWidth/2-r[0]:"right"===l?t.markerDx-=t.markerWidth/2-i.width-r[0]:t.markerDx+=i.width/2;var c=e.verticalAlignment||"middle";t.markerDy=h.y,"top"===c?t.markerDy+=t.markerHeight/2-r[1]:"bottom"===c?t.markerDy-=t.markerHeight/2-i.height-r[1]:t.markerDy+=i.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},n._getBoxSize=function(t){t.markerType||(t.markerType="square");var e,n,i=this.getBoxStyle(),r=this._getTextSize(t),o=i.padding||this._getDefaultPadding();return e=r.width+2*o[0],n=r.height+2*o[1],i.minWidth&&(!e||e<i.minWidth)&&(e=i.minWidth),i.minHeight&&(!n||n<i.minHeight)&&(n=i.minHeight),[new Yr$4(e,n),r]},e}(Ll);Fl.mergeOptions({boxStyle:null,textSymbol:null}),Fl.registerJSONType("Label");var jl=function(t){return function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t),e._hasConnectors=function(t){return!Dn$3(t.__connectors)&&t.__connectors.length>0},e._getConnectors=function(t){return t.__connectors};var n=e.prototype;return n.getConnectSource=function(){return this._connSource},n.setConnectSource=function(t){var e=this._connTarget;return this.onRemove(),this._connSource=t,this._connTarget=e,this.onAdd(),this},n.getConnectTarget=function(){return this._connTarget},n.setConnectTarget=function(t){var e=this._connSource;return this.onRemove(),this._connSource=e,this._connTarget=t,this._updateCoordinates(),this._registerEvents(),this},n._updateCoordinates=function(){var t=this.getMap();if(!t&&this._connSource&&(t=this._connSource.getMap()),!t&&this._connTarget&&(t=this._connTarget.getMap()),t&&this._connSource&&this._connTarget){for(var e,n,i=this._connSource._getConnectPoints(),r=this._connTarget._getConnectPoints(),o=0,s=this.getCoordinates(),a=0,h=i.length;a<h;a++)for(var l=i[a],c=0,u=r.length;c<u;c++){var f=r[c],d=t.computeLength(l,f);0===a&&0===c?(e=l,n=f,o=d):d<o&&(e=l,n=f)}Ji$4(s)&&s[0].equals(e)&&s[1].equals(n)||this.setCoordinates([e,n])}},n.onAdd=function(){this._registerEvents(),this._updateCoordinates()},n.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&Ni$4(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(Ni$4(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof kh&&this._connTarget instanceof kh)){var t=this.getMap();t&&t.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},n._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},n._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var t=this.options.showOn;if(this.hide(),"moving"===t?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===t?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===t?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof kh&&this._connTarget instanceof kh)){var e=this.getMap();e&&e.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},e}(t)},Hl={showOn:"always"},Nl=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,1===arguments.length&&(i=e,e=null,n=null),r._connSource=e,r._connTarget=n,r}return Pi$4(e,t),e}(jl(ml));Nl.mergeOptions(Hl),Nl.registerJSONType("ConnectorLine");var Bl=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,1===arguments.length&&(i=e,e=null,n=null),r._connSource=e,r._connTarget=n,r}return Pi$4(e,t),e}(jl(Ol));Bl.mergeOptions(Hl),Bl.registerJSONType("ArcConnectorLine");var Gl=[],Vl=function(t){function e(e,n,i){var r;n&&!(n instanceof kh)&&!Array.isArray(n)&&Pn$3.indexOf(n.type)<0&&(i=n,n=null),(r=t.call(this,e,i)||this)._maxZIndex=0,r._minZIndex=0,r._initCache(),n&&r.addGeometry(n);var o=r.options.style;return o&&r.setStyle(o),r}Pi$4(e,t);var n=e.prototype;return n.getGeometryById=function(t){return Dn$3(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},n.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var n,i=[],r=0,o=this._geoList.length;r<o;r++)n=this._geoList[r],(e?t.call(e,n):t(n))&&i.push(n);return i},n.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},n.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},n.getCount=function(){return this._geoList.length},n.getExtent=function(){if(0===this.getCount())return null;var t=new ks$1(this.getProjection());return this.forEach((function(e){t._combine(e.getExtent())})),t},n.forEach=function(t,e){for(var n=this._geoList.slice(0),i=0,r=n.length;i<r;i++)e?t.call(e,n[i],i):t(n[i],i);return this},n.filter=function(t,e){var n=[],i=Hn$3(t),r=i?t:Or$4(t);return this.forEach((function(t){var o=i?t:Nr$4(t);(e?r.call(e,o):r(o))&&n.push(t)}),this),n},n.isEmpty=function(){return!this._geoList.length},n.addGeometry=function(t,e){if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(Ml.toGeometry(t),e);if(!Array.isArray(t)){var n=arguments.length,i=arguments[n-1];return t=Array.prototype.slice.call(arguments,0,n-1),e=i,i&&Fn$3(i)&&("type"in i||i instanceof kh)&&(t.push(i),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;var r;this._initCache(),e&&(r=new ks$1),this._toSort=this._maxZIndex>0;for(var o=[],s=0,a=t.length;s<a;s++){var h=t[s];if(!h)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+s);if(!(h instanceof kh)&&(h=kh.fromJSON(h),Array.isArray(h)))for(var l=0,c=h.length;l<c;l++)this._add(h[l],r,s),o.push(h[l]);Array.isArray(h)||(this._add(h,r,s),o.push(h))}var u=this.getMap();if(u&&(this._getRenderer().onGeometryAdd(o),r&&!Dn$3(r.xmin))){var f=r.getCenter(),d=u.getFitZoom(r);if(Fn$3(e)){var m=Hn$3(e.step)?e.step:function(){};u.animateTo({center:f,zoom:d},kn$3({duration:u.options.zoomAnimationDuration,easing:"out"},e),m)}else!0===e&&u.setCenterAndZoom(f,d)}return this.fire("addgeo",{geometries:t}),this},n.getGeoMinZIndex=function(){return this._minZIndex},n.getGeoMaxZIndex=function(){return this._maxZIndex},n._add=function(t,e,n){this._toSort||(this._toSort=0!==t.getZIndex()),this._updateZIndex(t.getZIndex());var i=t.getId();if(!Dn$3(i)){if(!Dn$3(this._geoMap[i]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+i+", at index:"+n);this._geoMap[i]=t}var r=zi$4();t._setInternalId(r),this._geoList.push(t),this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(t)},n.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof kh||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{geometries:t}),this},n.clear=function(){this._clearing=!0,this.forEach((function(t){t.remove()})),this._geoMap={};var t=this._geoList;this._geoList=[];var e=this._getRenderer();return e&&(e.onGeometryRemove(t),e.clearImageData&&e.clearImageData()),this._clearing=!1,this.fire("clear"),this},n.onRemoveGeometry=function(t){if(t&&!this._clearing&&this===t.getLayer()&&!Dn$3(t._getInternalId())){var e=t.getId();Dn$3(e)||delete this._geoMap[e];var n=this._findInList(t);n>=0&&this._geoList.splice(n,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}},n.getStyle=function(){return this.options.style?this.options.style:null},n.setStyle=function(t){return this.options.style=t,t=vo$2(t),this._cookedStyles=function t(e){if(!Array.isArray(e))return t([e]);for(var n=[],i=0;i<e.length;i++){var r;r=!0===e[i].filter?function(){return!0}:Or$4(e[i].filter),n.push(Br$4({},e[i],{filter:r}))}return n}(t),this.forEach((function(t){this._styleGeometry(t)}),this),this.fire("setstyle",{style:t}),this},n._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=Nr$4(t),n=0,i=this._cookedStyles.length;n<i;n++)if(!0===this._cookedStyles[n].filter(e))return t._setExternSymbol(this._cookedStyles[n].symbol),!0;return!1},n.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach((function(t){t._setExternSymbol(null)}),this),this.fire("removestyle"),this):this},n.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},n.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return Fh.prototype.hide.call(this)},n._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},n._updateZIndex=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,e)),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,e))},n._sortGeometries=function(){var t=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort((function(e,n){return t._updateZIndex(e.getZIndex(),n.getZIndex()),t._compare(e,n)})),this._toSort=!1)},n._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},n._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;this._sortGeometries();for(var n,i=0,r=e-1;i<=r;){if(n=Math.floor((i+r)/2),this._geoList[n]===t)return n;this._compare(this._geoList[n],t)>0?r=n-1:i=n+1}return-1},n._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},n._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!Dn$3(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}Dn$3(t.old)||t.new===t.old||delete this._geoMap[t.old]}},n._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},n._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},n._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},n._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},n._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},n._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},n._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},n._hasGeoListeners=function(t){if(!t)return!1;Array.isArray(t)||(Gl[0]=t,t=Gl);for(var e=this.getGeometries()||[],n=0,i=e.length;n<i;n++)for(var r=0,o=t.length;r<o;r++)if(e[n].listens(t[r])>0)return!0;return!1},e}(Fh);Vl.mergeOptions({drawImmediate:!1,geometryEvents:!0});var Wl=new Ls$1,Ul={debug:!1,enableSimplify:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:Si$4.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,geometryEventTolerance:1},Zl=function(t){function e(e,n,i){return t.call(this,e,n,i)||this}Pi$4(e,t);var n=e.prototype;return n.onConfig=function(e){if(t.prototype.onConfig.call(this,e),e.enableAltitude||e.drawAltitude||e.altitudeProperty){var n=this.getRenderer();n&&n.setToRedraw&&n.setToRedraw()}},n.identify=function(t,e){void 0===e&&(e={});var n=this.getRenderer();t instanceof ys$1||(t=new ys$1(t));var i=this.getMap().coordToContainerPoint(t);return e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(i,e):this._hitGeos(this._geoList,i,e)},n.identifyAtPoint=function(t,e){void 0===e&&(e={});var n=this.getRenderer();return t instanceof Ii$4||(t=new Ii$4(t)),e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(t,e):this._hitGeos(this._geoList,t,e)},n._hitGeos=function(t,e,n){void 0===n&&(n={});var i=n.filter,r=[],o=n.tolerance,s=this.getMap(),a=this.getRenderer(),h=a&&a.getImageData&&a.getImageData();if(h){for(var l=0,c=t.length-1;c>=0;c--){var u=t[c]._hitTestTolerance()+(o||0);u>l&&(l=u)}var f=s.getDevicePixelRatio();h.r=f;for(var d=!1,m=e.x-l,g=e.y-l,p=-l;p<=l;p++){for(var _=-l;_<=l;_++){var v=Math.round((m+p)*f),y=Math.round((g+_)*f);if(h.data[y*h.width*4+4*v+3]>0){d=!0;break}}if(d)break}if(!d)return r}for(var x=t.length-1;x>=0;x--){var b=t[x];if(b&&b.isVisible()&&b._getPainter()&&b.options.interactive){if(!(b instanceof ml&&(b._getArrowStyle()||b instanceof El))){var w=b.getContainerExtent(Wl);if(o&&(w=w._expand(o)),!w||!w.contains(e))continue}if(b._containsPoint(e,o)&&(!i||i(b))&&(r.push(b),n.count&&r.length>=n.count))break}}return r},n.getAltitude=function(){return this.options.altitude||0},n.toJSON=function(t){t||(t={});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if(Dn$3(t.geometries)||t.geometries){var n;if(t.clipExtent){var i=this.getMap(),r=i?i.getProjection():null;n=new ks$1(t.clipExtent,r)}for(var o=[],s=this.getGeometries(),a=0,h=s.length;a<h;a++){var l=s[a],c=l.getExtent();if(c&&(!n||n.intersects(c))){var u=l.toJSON(t.geometries);o.push(u)}}e.geometries=o}return e},e.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var n=new e(t.id,t.options),i=t.geometries,r=[],o=0;o<i.length;o++){var s=kh.fromJSON(i[o]);s&&r.push(s)}return n.addGeometry(r),n},e.getPainterClass=function(){return Th},e.getCollectionPainterClass=function(){return Ph$1},e}(Vl);Zl.mergeOptions(Ul),Zl.registerJSONType("VectorLayer");var Xl="_map_tool",Jl=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.addTo=function(t){return t?(this._map=t,t[Xl]&&t[Xl].disable(),this.onAdd&&this.onAdd(),this.enable(),t[Xl]=this,this._fireEvent("add"),this):this},n.getMap=function(){return this._map},n.enable=function(){return!this._map||this._enabled||(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable")),this},n.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},n.isEnabled=function(){return!!this._enabled},n.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[Xl],delete this._map),this._fireEvent("remove"),this):this},n._registerEvents=function(){this._switchEvents("on")},n._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},n._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},e}(hs$1(cs$2)),ql={},Yl=function(t){function e(e){var n;return(n=t.call(this,e)||this)._checkMode(),n._events={click:n._clickHandler,"mousemove touchmove":n._mouseMoveHandler,dblclick:n._doubleClickHandler,"mousedown touchstart":n._mouseDownHandler,"mouseup touchend":n._mouseUpHandler,mousemove:n._mouseMoveHandler,mousedown:n._mouseDownHandler,mouseup:n._mouseUpHandler},n}Pi$4(e,t),e.registerMode=function(t,e){ql[t.toLowerCase()]=e},e.getRegisterMode=function(t){return ql[t.toLowerCase()]};var n=e.prototype;return n.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},n.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},n.getSymbol=function(){return _o$3(this.options.symbol||this.options.symbol)},n.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},n.getCurrentGeometry=function(){return this._geometry},n.onAdd=function(){this._checkMode()},n.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var t=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})),this._geometryEvents=t.options.geometryEvents,this.options.blockGeometryEvents&&t.config("geometryEvents",!1),this},n.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw({ignoreEndEvent:!0}),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&t.config("geometryEvents",this._geometryEvents),this},n.undo=function(){var t=this._getRegisterMode();if(!this._shouldRecordHistory(t.action)||!this._historyPointer)return this;var e=this._clickCoords.slice(0,--this._historyPointer);return t.update(this.getMap().getProjection(),e,this._geometry),this},n.redo=function(){var t=this._getRegisterMode();if(!this._shouldRecordHistory(t.action)||Dn$3(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var e=this._clickCoords.slice(0,++this._historyPointer);return t.update(this.getMap().getProjection(),e,this._geometry),this},n._shouldRecordHistory=function(t){return Array.isArray(t)&&"click"===t[0]&&"mousemove"===t[1]&&"dblclick"===t[2]},n._checkMode=function(){this._getRegisterMode()},n._saveMapCfg=function(){var t=this.getMap();this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom});for(var e=this._getRegisterMode().action,n=!1,i=0;i<e.length;i++)if(e[i].indexOf("mousedown")>=0||e[i].indexOf("touchstart")>=0){n=!0;break}if(n){var r=this.getMap();this._mapDraggable=r.options.draggable,r.config({draggable:!1})}},n._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),Dn$3(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},n._loadResources=function(){var t=Xr$4(this.getSymbol());t.length>0&&this._drawToolLayer._getRenderer().loadResources(t)},n._getProjection=function(){return this._map.getProjection()},n._getRegisterMode=function(){var t=this.getMode(),n=e.getRegisterMode(t);if(!n)throw new Error(t+" is not a valid mode of DrawTool.");return n},n.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var n=0;n<t.length;n++)e[t[n]]=this._events[t[n]];return e}return null},n._mouseDownHandler=function(t){this._createGeometry(t)},n._mouseUpHandler=function(t){this.endDraw(t)},n._clickHandler=function(t){var e=this.getMap(),n=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var i=this._clickCoords.length,r=e._pointToPrj(t.point2d);if(this._clickCoords[i-1].equals(r))return}if(this._geometry){var o=e._pointToPrj(t.point2d);Dn$3(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer));var s=this._geometry.snapTo;if(s&&Hn$3(s)){var a=this._getSnapResult(s,t.containerPoint);if(o=a.prjCoord,this._clickCoords=this._clickCoords.concat(a.effectedVertex),this._clickCoords[this._clickCoords.length-1].equals(o))return}if(this._clickCoords.push(o),this._historyPointer=this._clickCoords.length,t.drawTool=this,n.update(e.getProjection(),this._clickCoords,this._geometry,t),"point"===this.getMode())return void this.endDraw(t);this._fireEvent(this._clickCoords.length<=1?"drawstart":"drawvertex",t),n.clickLimit&&n.clickLimit===this._historyPointer&&this.endDraw(t)}else this._createGeometry(t)},n._createGeometry=function(t){var e=this.getMode(),n=this._getRegisterMode(),i=this.getMap()._pointToPrj(t.point2d),r=this.getSymbol();if(!this._geometry){this._clickCoords=[i],t.drawTool=this,this._geometry=n.create(this.getMap().getProjection(),this._clickCoords,t),r&&"point"!==e?this._geometry.setSymbol(r):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t);var o=this._geometry.snapTo;if(o&&Hn$3(o)){var s=this._getSnapResult(o,t.containerPoint),a=this.getMap();a&&s&&(this._clickCoords=[s.prjCoord],n.update(a.getProjection(),this._clickCoords,this._geometry,t))}}"point"===e&&"mousemove"!==t.type&&this.endDraw(t)},n._mouseMoveHandler=function(t){var e=this.getMap();if(e&&!e.isInteracting())if("point"!==this.getMode()||this._geometry){if(this._geometry){var n=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(n)){var i=e._pointToPrj(t.point2d),r=[],o=this._geometry.snapTo;if(o&&Hn$3(o)){var s=this._getSnapResult(o,n);i=s.prjCoord,r=s.effectedVertex}var a=e.getProjection();t.drawTool=this;var h=this._getRegisterMode();if(this._shouldRecordHistory(h.action)){var l=this._clickCoords.slice(0,this._historyPointer);if(l&&l.length>0&&i.equals(l[l.length-1]))return;h.update(a,l.concat(r,[i]),this._geometry,t)}else h.update(a,i,this._geometry,t);this._fireEvent("mousemove",t)}}}else this._createGeometry(t)},n._doubleClickHandler=function(t){if(this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var n=this._getRegisterMode(),i=this._clickCoords;if(!(i.length<2)){var r=this.getMode();if(!(r&&r.indexOf("polygon")>-1&&i.length<3)){for(var o=this.getMap().getProjection(),s=[i[0]],a=1,h=i.length;a<h;a++)i[a].x===i[a-1].x&&i[a].y===i[a-1].y||s.push(i[a]);s.length<2||this._geometry&&this._geometry instanceof ll&&s.length<3||(t.drawTool=this,n.update(o,s,this._geometry,t),this.endDraw(t))}}}}},n._addGeometryToStage=function(t){this._getDrawLayer().addGeometry(t)},n.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,t.ignoreEndEvent||this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},n._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},n._getMouseContainerPoint=function(t){var e=this._getRegisterMode().action;return(e[0].indexOf("mousedown")>=0||e[0].indexOf("touchstart")>=0)&&zo$3(t.domEvent),t.containerPoint},n._isValidContainerPoint=function(t){var e=this._map.getSize();return!(t.x<0||t.y<0||t.x>e.width||t.y>e.height)},n._getSnapResult=function(t,e){var n=this.getMap(),i=[];if(this.options.edgeAutoComplete){i.push(n._prjToContainerPoint(this._clickCoords[(this._historyPointer||1)-1]));var r=this._clickCoords[(this._historyPointer||1)-2];r&&i.push(n._prjToContainerPoint(r))}var o=t(e,i),s=n._containerPointToPrj(e=(o.effectedVertex?o.point:o)||e);return o.effectedVertex&&(o.effectedVertex=o.effectedVertex.map((function(t){return n._containerPointToPrj(t)}))),{prjCoord:s,effectedVertex:o.effectedVertex||[]}},n._getDrawLayer=function(){var t="_maptalks__internal_layer_drawtool",e=this._map.getLayer(t);return e||(e=new Zl(t,{enableSimplify:!1,enableAltitude:this.options.enableAltitude}),this._map.addLayer(e)),e},n._fireEvent=function(t,e){e||(e={}),e=kn$3({},e),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),e.tempGeometry=this._geometry),Jl.prototype._fireEvent.call(this,t,e)},e}(Jl);Yl.mergeOptions({symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1});var Kl=function(t){function e(e){var n;return(n=t.call(this,e)||this).drawTool=new Yl({mode:"boxZoom",ignoreMouseleave:!1}),n}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},n.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},n._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},n._boxZoom=function(t){var e=this.target;this.drawTool.remove();var n=t.geometry,i=n.getCenter(),r=n.getSymbol(),o=new ks$1(i,e.locateByPoint(i,r.markerWidth,r.markerHeight),e.getProjection()),s=e.getFitZoom(o);e._animateTo({center:o.getCenter(),zoom:s})},e}(ls$1);qh.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),qh.addOnLoadHook("addHandler","boxZoom",Kl);var Ql=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},n.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},n._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var n=t.containerPoint,i=e.getContainerExtent();if(i){var r,o=n.x,s=n.y,a=i.xmax,h=i.ymax;o<30&&(r=[Math.abs(o-30),0]),s<30&&(r=[0,Math.abs(s-30)]),o+30>a&&(r=[-Math.abs(o+30-a),0]),s+30>h&&(r=[0,-Math.abs(s+30-h)]),r&&e.panBy(r,{duration:1})}}},e}(ls$1);function $l(t,e,n){return t*(1-n)+e*n}qh.mergeOptions({autoPanAtEdge:!1}),qh.addOnLoadHook("addHandler","autoPanAtEdge",Ql),qh.include({animateTo:function(t,e,n){var i=this;void 0===e&&(e={}),Hn$3(e)&&(n=e,e={});var r=this.getProjection(),o=this.getView(),s={},a=!0;for(var h in t)if(Bn$3(t,h)&&!Dn$3(t[h])&&("prjCenter"===h||!Dn$3(o[h])))if(a=!1,"center"===h){var l=new ys$1(o[h]),c=new ys$1(t[h]);l.equals(c)||(s.center=[l,c])}else if("prjCenter"===h){var u=new ys$1(this._getPrjCenter()),f=new ys$1(t[h]);u.equals(f)||(s.prjCenter=[u,f])}else o[h]!==t[h]&&"around"!==h&&(s[h]=[o[h],t[h]]);if(a)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var d=t.around||new Ii$4(this.width/2,this.height/2),m=this._getRenderer(),g=this._animPlayer=al.animate(s,{easing:e.easing||"out",duration:e.duration||this.options.zoomAnimationDuration,framer:function(t){m.callInNextFrame(t)},repeat:e.repeat},(function(t){i.isRemoved()?g.finish():("running"===g.playState?(t.styles.center?(i._setPrjCenter(r.project(t.styles.center)),i.onMoving(i._parseEventFromCoord(i.getCenter()))):t.styles.prjCenter&&(i._setPrjCenter(t.styles.prjCenter),i.onMoving(i._parseEventFromCoord(i.getCenter()))),Dn$3(t.styles.zoom)||i.onZooming(t.styles.zoom,d),Dn$3(t.styles.pitch)||i._setPitch(t.styles.pitch),Dn$3(t.styles.bearing)||i._setBearing(t.styles.bearing),i._fireEvent("animating")):"paused"===g.playState&&g!==i._mapAnimPlayer||(g._interupted||(s.center?i._setPrjCenter(r.project(s.center[1])):s.prjCenter&&i._setPrjCenter(s.prjCenter[1]),Dn$3(s.pitch)||i._setPitch(s.pitch[1]),Dn$3(s.bearing)||i._setBearing(s.bearing[1])),i._endAnim(g,s,d,e)),n&&n(t))}),this);return this._startAnim(s,d),g},_animateTo:function(t,e,n){return void 0===e&&(e={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(t,e,n),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(t,e,n){var i=this;void 0===e&&(e={}),this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),Hn$3(e)&&(n=e,e={}),e=kn$3({curve:1.42},e);var r=this;function o(t,e){return r.getResolution(e)/r.getResolution(t)}var s=t.around||new Ii$4(this.width/2,this.height/2),a=this.getMinZoom(),h=this.getMaxZoom(),l=this.getProjection(),c=this.getView(),u=c.zoom,f=c.bearing,d=c.pitch,m="zoom"in t?Xi$4(+t.zoom,a,h):u,g="bearing"in t?+t.bearing:f,p="pitch"in t?+t.pitch:d,_=l.project(t.center&&new ys$1(t.center)||this.getCenter()),v=o(m,u),y=l.project(this.getCenter()),x=_.sub(y),b=e.curve,w=Math.max(this.width,this.height),C=w/v,M=x.mag();if("minZoom"in e){var T=Xi$4(Math.min(e.minZoom,u,m),a,h),S=w/o(T,u);b=Math.sqrt(S/M*2)}var P=b*b;function A(t){var e=(C*C-w*w+(t?-1:1)*P*P*M*M)/(2*(t?C:w)*P*M);return Math.log(Math.sqrt(e*e+1)-e)}function E(t){return(Math.exp(t)-Math.exp(-t))/2}function O(t){return(Math.exp(t)+Math.exp(-t))/2}var R=A(0),I=function(t){return O(R)/O(R+b*t)},k=function(t){return w*((O(R)*(E(e=R+b*t)/O(e))-E(R))/P)/M;var e},D=(A(1)-R)/b;if(Math.abs(M)<1e-6||!isFinite(D)){if(Math.abs(w-C)<1e-6)return this.animateTo(t,e,n);var L=C<w?-1:1;D=Math.abs(Math.log(C/w))/b,k=function(){return 0},I=function(t){return Math.exp(L*b*t)}}var z=this._getRenderer(),F=this._animPlayer=al.animate({k:[0,1]},{easing:e.easing||"out",duration:e.duration||8,framer:function(t){z.callInNextFrame(t)}},(function(r){if(i.isRemoved())F.finish();else{var o=r.styles.k,a=o*D,h=1/I(a),l={};if(t.center){var c=1===o?_:y.add(x.multi(k(a)));l.prjCenter=[_,c]}if(u!==m){var v=1===o?m:i.getZoomForScale(h,u,!0);l.zoom=[u,v]}if(d!==p){var b=$l(d,p,o);l.pitch=[p,b]}if(f!==g){var w=$l(f,g,o);l.bearing=[g,w]}"running"===F.playState?(l.prjCenter&&(i._setPrjCenter(l.prjCenter[1]),i.onMoving(i._parseEventFromCoord(i.getCenter()))),l.zoom&&i.onZooming(l.zoom[1],s),l.pitch&&i._setPitch(l.pitch[1]),l.bearing&&i._setBearing(l.bearing[1]),i._fireEvent("animating")):"paused"===F.playState&&F!==i._mapAnimPlayer||(F._interupted||(l.prjCenter&&i._setPrjCenter(l.prjCenter[1]),l.pitch&&i._setPitch(l.pitch[1]),l.bearing&&i._setBearing(l.bearing[1])),i._endAnim(F,l,s,e)),n&&n(r)}}));return this._startAnim({center:t.center,zoom:t.zoom!==u,pitch:p!==d,bearing:g!==f},s),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,e,n,i){delete this._animRotating;var r,o=t._interupted?"animateinterrupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer,e.center)r=t._interupted?this.getCenter():e.center[1],this.onMoveEnd(this._parseEventFromCoord(r));else if(e.prjCenter){var s;s=t._interupted?this._getPrjCenter():e.prjCenter[1];var a=this._parseEventFromCoord(this.getProjection().unproject(s));a.point2d=this._prjToPoint(s),this.onMoveEnd(a)}Dn$3(e.zoom)||(t._interupted?this.onZoomEnd(this.getZoom(),n):i.wheelZoom?this.onZooming(e.zoom[1],n):this.onZoomEnd(e.zoom[1],n)),o&&this._fireEvent(o),Dn$3(e.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),i.wheelZoom||this._resumePrev(t)},_startAnim:function(t,e){this._animPlayer&&((t.center||t.prjCenter)&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],e),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){t&&(delete this._animRotating,"finished"!==t.playState&&(t._interupted=!0,t.cancel()),t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(t){if(this._prevAnimPlayer){var e=this._prevAnimPlayer;"paused"!==e.playState&&delete this._prevAnimPlayer,t!==e&&(this._animPlayer=e,e.play())}}});var tc="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend ";function ec(t,e,n,i,r){var o=1/Math.tan(e/2),s=1/(i-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*s,t[15]=0,t}function nc(t,e,n){var i,r,o,s,a,h,l,c,u,f,d,m,g=n[0],p=n[1],_=n[2];return e===t?(t[12]=e[0]*g+e[4]*p+e[8]*_+e[12],t[13]=e[1]*g+e[5]*p+e[9]*_+e[13],t[14]=e[2]*g+e[6]*p+e[10]*_+e[14],t[15]=e[3]*g+e[7]*p+e[11]*_+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],f=e[9],d=e[10],m=e[11],t[0]=i=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=l,t[7]=c,t[8]=u,t[9]=f,t[10]=d,t[11]=m,t[12]=i*g+a*p+u*_+e[12],t[13]=r*g+h*p+f*_+e[13],t[14]=o*g+l*p+d*_+e[14],t[15]=s*g+c*p+m*_+e[15]),t}function ic(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function rc(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],f=e[9],d=e[10],m=e[11],g=e[12],p=e[13],_=e[14],v=e[15],y=n[0],x=n[1],b=n[2],w=n[3];return t[0]=y*i+x*a+b*u+w*g,t[1]=y*r+x*h+b*f+w*p,t[2]=y*o+x*l+b*d+w*_,t[3]=y*s+x*c+b*m+w*v,t[4]=(y=n[4])*i+(x=n[5])*a+(b=n[6])*u+(w=n[7])*g,t[5]=y*r+x*h+b*f+w*p,t[6]=y*o+x*l+b*d+w*_,t[7]=y*s+x*c+b*m+w*v,t[8]=(y=n[8])*i+(x=n[9])*a+(b=n[10])*u+(w=n[11])*g,t[9]=y*r+x*h+b*f+w*p,t[10]=y*o+x*l+b*d+w*_,t[11]=y*s+x*c+b*m+w*v,t[12]=(y=n[12])*i+(x=n[13])*a+(b=n[14])*u+(w=n[15])*g,t[13]=y*r+x*h+b*f+w*p,t[14]=y*o+x*l+b*d+w*_,t[15]=y*s+x*c+b*m+w*v,t}function oc(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],c=e[8],u=e[9],f=e[10],d=e[11],m=e[12],g=e[13],p=e[14],_=e[15],v=n*a-i*s,y=n*h-r*s,x=n*l-o*s,b=i*h-r*a,w=i*l-o*a,C=r*l-o*h,M=c*g-u*m,T=c*p-f*m,S=c*_-d*m,P=u*p-f*g,A=u*_-d*g,E=f*_-d*p,O=v*E-y*A+x*P+b*S-w*T+C*M;return O?(t[0]=(a*E-h*A+l*P)*(O=1/O),t[1]=(r*A-i*E-o*P)*O,t[2]=(g*C-p*w+_*b)*O,t[3]=(f*w-u*C-d*b)*O,t[4]=(h*S-s*E-l*T)*O,t[5]=(n*E-r*S+o*T)*O,t[6]=(p*x-m*C-_*y)*O,t[7]=(c*C-f*x+d*y)*O,t[8]=(s*A-a*S+l*M)*O,t[9]=(i*S-n*A-o*M)*O,t[10]=(m*w-g*x+_*v)*O,t[11]=(u*x-c*w-d*v)*O,t[12]=(a*T-s*P-h*M)*O,t[13]=(n*P-i*T+r*M)*O,t[14]=(g*y-m*b-p*v)*O,t[15]=(c*b-u*y+f*v)*O,t):null}function sc(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ac(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function hc(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function lc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function cc(t){var e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function uc(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function fc(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2];return t[0]=r*h-o*a,t[1]=o*s-i*h,t[2]=i*a-r*s,t}function dc(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.hypot?Math.hypot(n,i,r):function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}(n,i,r)}function mc(t,e,n){var i=e[0],r=e[1],o=e[2],s=1/(n[3]*i+n[7]*r+n[11]*o+n[15]);return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])*s,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])*s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])*s,t}qh.include({_registerDomEvents:function(){Io$2(this._panels.mapWrapper||this._containerDOM,tc,this._handleDOMEvent,this)},_removeDomEvents:function(){ko$2(this._panels.mapWrapper||this._containerDOM,tc,this._handleDOMEvent)},_handleDOMEvent:function(t){var e=this.options.clickTimeThreshold,n=t.type,i="mousedown"===n||"touchstart"===n&&(!t.touches||1===t.touches.length);i&&(this._domMouseDownTime=In$3(),this._domMouseDownView=this.getView());var r="contextmenu"===n&&function(t){if(!t._domMouseDownView)return!0;var e=t.getView(),n=t._domMouseDownView;return e.bearing!==n.bearing||e.pitch!==n.pitch}(this);if("contextmenu"===n){Lo$2(t);var o=this._domMouseDownTime;In$3()-o<=e&&!r&&this._fireDOMEvent(this,t,"dom:"+t.type)}else this._fireDOMEvent(this,t,"dom:"+t.type);if(!this._ignoreEvent(t)){var s,a=!1;if(i)this._mouseDownTime=In$3();else if("click"===n||"touchend"===n||"contextmenu"===n){if(!this._mouseDownTime)return;var h=this._mouseDownTime;if(delete this._mouseDownTime,In$3()-h>e){if("click"===n||"contextmenu"===n)return}else if("contextmenu"===n){if(r)return}else"touchend"===n&&(a=!0)}a&&(this._clickTime&&In$3()-this._clickTime<=e?(delete this._clickTime,s="dblclick",this._fireDOMEvent(this,t,"dom:dblclick")):(this._clickTime=In$3(),s="click",this._fireDOMEvent(this,t,"dom:click"))),this._ignoreEvent(t)||(this._fireDOMEvent(this,t,n),s&&this._fireDOMEvent(this,t,s))}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;if(this._isEventOutMap(t))return!0;var e,n=t.srcElement||t.target;if(n)for(;n&&n!==this._containerDOM;){if(n.className&&n.className.indexOf&&(n.className.indexOf("maptalks-control")>=0||n.className.indexOf("maptalks-ui")>=0&&e&&!e.eventsPropagation))return!0;e=n,n=n.parentNode}return!1},_isEventOutMap:function(t){if(this.getPitch()>this.options.maxVisualPitch){var e=Ho$3(this._getActualEvent(t),this._containerDOM);if(!this.getContainerExtent().contains(e))return!0}return!1},_parseEvent:function(t,e){if(!t)return null;var n={domEvent:t};if("keypress"!==e){var i=this._getActualEvent(t);if(i&&void 0!==i.clientX){var r=Ho$3(i,this._containerDOM);n=kn$3(n,{containerPoint:r,viewPoint:this.containerPointToViewPoint(r)});var o=this.options.maxVisualPitch;(this.getPitch()<=o||r.y>=this.height-this._getVisualHeight(o))&&(n=kn$3(n,{coordinate:this.containerPointToCoord(r),point2d:this._containerPointToPoint(r)}))}}return n},_parseEventFromCoord:function(t){var e=this.coordToContainerPoint(t);return{coordinate:t,containerPoint:e,viewPoint:this.containerPointToViewPoint(e),point2d:this.coordToPoint(t)}},_getActualEvent:function(t){return t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t},_fireDOMEvent:function(t,e,n){if(!this.isRemoved()){var i=this._parseEvent(e,n);this._fireEvent(n,i)}},_getEventParams:function(t){var e={domEvent:t},n=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(n){var i=Ho$3(n,this._containerDOM);e.coordinate=this.containerPointToCoordinate(i),e.containerPoint=i,e.viewPoint=this.containerPointToViewPoint(i),e.pont2d=this._containerPointToPoint(i)}return e}}),qh.addOnLoadHook("_registerDomEvents"),qh.include({isFullScreen:function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullscreen)t.requestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var e="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",e)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}),qh.include({panTo:function(t,e,n){if(void 0===e&&(e={}),!t)return this;if(Hn$3(e)&&(n=e,e={}),t=new ys$1(t),void 0===e.animation||e.animation){var i=this.getProjection().project(t);return this._panAnimation(i,e.duration,n)}return this.setCenter(t),this},_panTo:function(t,e){return void 0===e&&(e={}),void 0===e.animation||e.animation?this._panAnimation(t,e.duration):(this.onMoveStart(),this._setPrjCenter(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(t,e,n){if(void 0===e&&(e={}),!t)return this;if(Hn$3(e)&&(n=e,e={}),t=new Ii$4(t),this.getContainerExtent().ymin>0&&t.y>30){var i=t.y;t.y=30,t.x=30*t.x/i,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(this.onMoveStart(),void 0===e.animation||e.animation){t=t.multi(-1);var r=this._containerPointToPrj(new Ii$4(this.width/2+t.x,this.height/2+t.y));this._panAnimation(r,e.duration,n)}else this._offsetCenterByPixel(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter()));return this},_panAnimation:function(t,e,n){return this._animateTo({prjCenter:t},{duration:e||this.options.panAnimationDuration},n)}}),kh.fromJSON=function(t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var r=kh.fromJSON(t[n]);Array.isArray(t)?e=e.concat(r):e.push(r)}return e}return t&&!t.feature?Ml.toGeometry(t):(t.subType?(o=kh.getJSONClass(t.subType).fromJSON(t),Dn$3(t.feature.id)||o.setId(t.feature.id)):(o=Ml.toGeometry(t.feature),t.options&&o.config(t.options)),t.symbol&&o.setSymbol(t.symbol),t.infoWindow&&o.setInfoWindow(t.infoWindow),o);var o},Fh.fromJSON=function(t){if(!t)return null;var e=t.type,n=Fh.getJSONClass(e);if(!n||!n.fromJSON)throw new Error("unsupported layer type:"+e);return n.fromJSON(t)},qh.include({JSON_VERSION:"1.0",toJSON:function(t){t||(t={});var e={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};e.options=this.config(),e.options.center=this.getCenter(),e.options.zoom=this.getZoom(),e.options.bearing=this.getBearing(),e.options.pitch=this.getPitch();var n=this.getBaseLayer();(Dn$3(t.baseLayer)||t.baseLayer)&&n&&(e.baseLayer=n.toJSON(t.baseLayer));var i={};t.clipExtent&&(i.clipExtent=!0===t.clipExtent?this.getExtent():t.clipExtent);var r=[];if(Dn$3(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var o=this.getLayers(),s=0,a=o.length;s<a;s++)if(o[s].toJSON){var h=kn$3({},Fn$3(t.layers)?t.layers:{},i);r.push(o[s].toJSON(h))}e.layers=r}else if(Ji$4(t.layers)){for(var l=t.layers,c=0;c<l.length;c++){var u=l[c],f=this.getLayer(u.id);if(f.toJSON){var d=kn$3({},u.options,i);r.push(f.toJSON(d))}}e.layers=r}else e.layers=[];return e}}),qh.fromJSON=function(t,e,n){if(!t||!e)return null;n||(n={});var i=new qh(t,e.options);if(Dn$3(n.baseLayer)||n.baseLayer){var r=Fh.fromJSON(e.baseLayer);r&&i.setBaseLayer(r)}if(Dn$3(n.layers)||n.layers){for(var o=[],s=e.layers,a=0;a<s.length;a++){var h=Fh.fromJSON(s[a]);o.push(h)}i.addLayer(o)}return i},qh.include({computeLength:function(t,e){if(!this.getProjection())return null;var n=new ys$1(t),i=new ys$1(e);return n.equals(i)?0:this.getProjection().measureLength(n,i)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,e){var n=new ys$1((t=t||{}).coordinate);return this._identify(t,e,(function(e){return e.identify(n,t)}))},identifyAtPoint:function(t,e){var n=new Ii$4((t=t||{}).containerPoint),i=this.containerPointToCoord(n);return this._identify(t,e,(function(e){return e.identifyAtPoint?e.identifyAtPoint(n,t):i?e.identify(i,t):[]}))},_identify:function(t,e,n){var i=t.layers;if(!Ji$4(i))return this;for(var r=t.eventTypes,o=[],s=0,a=i.length;s<a;s++)jn$3(i[s])?o.push(this.getLayer(i[s])):o.push(i[s]);r&&(o=o.filter((function(t){return!t._hasGeoListeners||t._hasGeoListeners(r)})));for(var h=[],l=o.length-1;l>=0&&!(t.count&&h.length>=t.count);l--){var c=o[l];if(c&&c.getMap()&&(t.includeInvisible||c.isVisible())&&(t.includeInternals||!(c.getId().indexOf("_maptalks__internal_layer_")>=0))){var u=n(c);u&&(Array.isArray(u)?Hi$4(h,u):h.push(u))}}return e.call(this,h),this}}),qh.include({_zoom:function(t,e){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoomOrigin(e),t=this._checkZoom(t),this.onZoomStart(t,e),this._frameZoom=this.getZoom(),this.onZoomEnd(t,e))},_zoomAnimation:function(t,e,n){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoom(t),this.getZoom()!==t&&(e=this._checkZoomOrigin(e),this._startZoomAnim(t,e,n)))},_checkZoomOrigin:function(t){return t&&!this.options.zoomInCenter||(t=new Ii$4(this.width/2,this.height/2)),this.options.zoomOrigin&&(t=new Ii$4(this.options.zoomOrigin)),t},_startZoomAnim:function(t,e,n){Dn$3(n)&&(n=1);var i=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(i-n)/Math.abs(i-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:t,around:e},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,e){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=this._containerPointToPrj(e),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,e,n){if(this.options.zoomable&&this._frameZoom!==t){Dn$3(n)&&(n=1),this._zoomTo(t,e);var i=this.getResolution(t),r=this.getResolution(this._startZoomVal)/i/n,o=this._prjToContainerPoint(this._startZoomCoord,this._startZoomVal),s=this.getViewPoint();if(!this.isRotating()&&!o.equals(e)&&1!==r){var a=this.getPitch(),h=o._sub(e)._multi(1/(1-r));a&&(h.y/=Math.cos(a*Math.PI/180)),e=e.add(h)}var l={view:[r,0,0,r,(e.x-s.x)*(1-r),(e.y-s.y)*(1-r)]},c=this.getDevicePixelRatio();1!==c&&(e=e.multi(c)),l.container=[r,0,0,r,e.x*(1-r),e.y*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:e,matrix:l}),this._frameZoom=t}},onZoomEnd:function(t,e){if(this.options.zoomable){var n=this._startZoomVal;this._zoomTo(t,e),this._zooming=!1,this._getRenderer().onZoomEnd(),this._fireEvent("zoomend",{from:n,to:t}),this._verifyExtent(this._getPrjCenter())||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(t,e){this._zoomLevel=t,this._calcMatrices(),e&&this._setPrjCoordAtContainerPoint(this._startZoomCoord,e)},_checkZoom:function(t){var e=this.getMaxZoom(),n=this.getMinZoom();return t<n&&(t=n),t>e&&(t=e),t}});var gc,pc,_c,vc,yc,xc,bc,wc,Cc,Mc=Math.PI/180,Tc=new ys$1(0,0);function Sc(){return sc(new Array(16))}qh.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/Mc},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*Mc,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/Mc:0},setBearing:function(t){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(t)},_setBearing:function(t){if(Si$4.ie9)throw new Error("map can't rotate in IE9.");var e=-Zi$4(t,-180,180)*Mc;if(this._angle===e)return this;var n=this.getBearing();return this._fireEvent("rotatestart",{from:n,to:e}),this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:n,to:e}),this._fireEvent("rotateend",{from:n,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(t)},_setPitch:function(t){if(Si$4.ie9)throw new Error("map can't tilt in IE9.");var e=Xi$4(t,0,this.options.maxPitch)*Mc;if(this._pitch===e)return this;var n=this.getPitch();return this._fireEvent("pitchstart",{from:n,to:e}),this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:n,to:e}),this._fireEvent("pitchend",{from:n,to:e}),this},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var t=90-this.getPitch(),e=this.getFov()/2,n=this.cameraPosition?this.cameraPosition[2]:0;if(e<=t)return n;e=Math.PI*e/180;var i=new Ii$4(this.cameraPosition).distanceTo(new Ii$4(this.cameraLookAt)),r=n*Math.tan(2*e);return n+Math.tan(e)*(i+r)},_pointToContainerPoint:function(t,e,n,i){void 0===n&&(n=0);var r=this._getResolution(e);return this._pointAtResToContainerPoint(t,r,n,i)},_pointAtResToContainerPoint:function(t,e,n,i){void 0===n&&(n=0),i||(i=new Ii$4(0,0)),t=this._pointAtResToPoint(t,e,i);var r,o=this.isTransforming(),s=e/this._getResolution();return o||n||(r=this._prjToPoint(this._getPrjCenter(),void 0,Tc)),this._toContainerPoint(i,o,s,n,r),i},_pointsAtResToContainerPoints:function(t,e,n,i){void 0===n&&(n=[]),void 0===i&&(i=[]);var r=this.getPitch(),o=this.getBearing();if(0===r&&0===o){var s=this._get2DExtent(),a=s.xmin,h=s.ymin,l=s.xmax,c=s.ymax;if(l>a&&c>h){for(var u=e/this._getResolution(),f=this.getSize(),d=f.height,m=(l-a)/f.width,g=(c-h)/d,p=0,_=t.length;p<_;p++)if(t[p]){var v=i[p];v.x=t[p].x,v.y=t[p].y,v._multi(u),v.x=(v.x-a)*m,v.y=d-(v.y-h)*g}else i[p]=null;return i}}for(var y=Array.isArray(n),x=this.isTransforming(),b=e/this._getResolution(),w=this._prjToPoint(this._getPrjCenter(),void 0,Tc),C=0,M=t.length;C<M;C++)if(t[C]){var T=i[C];T.x=t[C].x,T.y=t[C].y,T._multi(b),this._toContainerPoint(T,x,b,y?n[C]||0:n,w)}else i[C]=null;return i},_toContainerPoint:(Cc=[0,0,0],function(t,e,n,i,r){var o=this.width/2,s=this.height/2;if(e||i){var a=this._glScale;hc(Cc,t.x*a,t.y*a,(i*=n)*a);var h=this._projIfBehindCamera(Cc,this.cameraPosition,this.cameraForward);mc(h,h,this.projViewMatrix),t.x=h[0]*o+o,t.y=-h[1]*s+s}else t._sub(r.x,r.y),t.set(t.x,-t.y),t._add(o,s)}),_projIfBehindCamera:(xc=new Array(3),bc=new Array(3),wc=new Array(3),function(t,e,n){lc(xc,t,e);var i=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(n,xc);return i<=0&&(function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}(bc,n,1.01*i),function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2]}(t,e,lc(wc,xc,bc))),t}),_containerPointToPoint:function(t,e,n){var i=this._getResolution(e);return this._containerPointToPointAtRes(t,i,n)},_containerPointToPointAtRes:(_c=[0,0,0],vc=[0,0,0,1],yc=[0,0,0,1],function(t,e,n){if(this.isTransforming()){var i=this.width/2||1,r=this.height/2||1;hc(_c,(t.x-i)/i,(r-t.y)/r,0),hc(vc,_c[0],_c[1],0),hc(yc,_c[0],_c[1],1),vc[3]=yc[3]=1,mc(vc,vc,this.projViewMatrixInverse),mc(yc,yc,this.projViewMatrixInverse);var o=vc[1],s=yc[1],a=vc[2],h=yc[2],l=a===h?0:(0-a)/(h-a),c=Ui$4(vc[0],yc[0],l),u=Ui$4(o,s,l);return n?(n.x=c,n.y=u):n=new Ii$4(c,u),n._multi(1/this._glScale),this._getResolution()===e?n:this._pointToPointAtRes(n,e,n)}var f=this._prjToPointAtRes(this._getPrjCenter(),e,n),d=this._getResolution()/e;return f._add(d*(t.x-this.width/2),-d*(t.y-this.height/2))}),_calcMatrices:(pc=Sc(),function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var t=this.getSize(),e=t.width||1,n=t.height||1;this._glScale=this.getGLScale();var i=this._getCameraWorldMatrix(),r=this.getFov()*Math.PI/180,o=this._getCameraFar(r,this.getPitch());this.cameraFar=o,this.cameraNear=this.cameraCenterDistance/20;var s=this.projMatrix||Sc();ec(s,r,e/n,this.cameraNear,o),this.projMatrix=s,this.viewMatrix=oc(this.viewMatrix||Sc(),i),this.projViewMatrix=rc(this.projViewMatrix||Sc(),s,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=rc(this.projViewMatrixInverse||Sc(),i,oc(pc,s)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this._get2DExtent(),this._mapGlExtent2D=this._get2DExtentAtRes(this._mapGlRes)}),_getCameraFar:function(t,e){var n=this.cameraCenterDistance=dc(this.cameraPosition,this.cameraLookAt),i=n,r=(this.options.cameraInfiniteFar?10:4)*n;if(e>0&&(e=e*Math.PI/180,2/Math.PI-e>t/2)){var o=Math.tan(t/2),s=Math.tan(e);r=Math.max(n*o/(1/s-o),r)}return(i+=r)+1},_calcCascadeMatrixes:function(){var t=Sc();function e(e,n,i){var r=this.width,o=this.height,s=this.getFov()*Math.PI/180,a=this._getCameraFar(s,n),h=this.cameraCenterDistance;return a=h+(a-h)/Math.cos((90-n)*Math.PI/180)*Math.cos((90-e)*Math.PI/180),ec(t,s,r/o,.1,a),rc(i,t,this.viewMatrix)}return function(){var t=this.getPitch(),n=this.options.cascadePitches[0],i=this.options.cascadePitches[1],r=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||Sc(),o=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||Sc();t>n?e.call(this,t,n,r):ac(this.cascadeFrustumMatrix0,this.projViewMatrix),t>i?e.call(this,t,i,o):ac(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var t=Sc(),e=Sc(),n=[1,-1,1],i=[0,0,0];return function(){var r=this.width||1,o=this.height||1,s=.5/Math.tan(this._fov/2)*o;return ic(t,this.projMatrix,n),nc(t,t,hc(i,0,0,-s)),this._pitch&&function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],s=e[5],a=e[6],h=e[7],l=e[8],c=e[9],u=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+l*i,t[5]=s*r+c*i,t[6]=a*r+u*i,t[7]=h*r+f*i,t[8]=l*r-o*i,t[9]=c*r-s*i,t[10]=u*r-a*i,t[11]=f*r-h*i}(t,t,this._pitch),this._angle&&function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],s=e[1],a=e[2],h=e[3],l=e[4],c=e[5],u=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+l*i,t[1]=s*r+c*i,t[2]=a*r+u*i,t[3]=h*r+f*i,t[4]=l*r-o*i,t[5]=c*r-s*i,t[6]=u*r-a*i,t[7]=f*r-h*i}(t,t,this._angle),sc(e),ic(e,e,hc(i,r/2,-o/2,1)),rc(this.domCssMatrix||Sc(),e,t)}}(),_getFovZ:function(t){var e=this.getGLScale(t),n=this._getFovRatio();return e*(this.height||1)/2/n},_getCameraWorldMatrix:(gc={},function(){var t=this.getGLRes(),e=this._prjToPointAtRes(this._prjCenter,t);this.cameraLookAt=hc(this.cameraLookAt||[0,0,0],e.x,e.y,0);var n=this.getPitch()*Mc,i=this.getBearing()*Mc,r=this._getFovZ(),o=r*Math.cos(n),s=Math.sin(n)*r,a=e.x-s*Math.sin(i),h=e.y-s*Math.cos(i);this.cameraPosition=hc(this.cameraPosition||[0,0,0],a,h,o),this.cameraToCenterDistance=dc(this.cameraPosition,this.cameraLookAt);var l=s||1,c=this.cameraUp=hc(this.cameraUp||[0,0,0],Math.sin(i)*l,Math.cos(i)*l,0),u=this.cameraWorldMatrix=this.cameraWorldMatrix||Sc();!function(t,e,n,i){var r=[0,0,0],o=[0,0,0],s=[0,0,0];lc(s,e,n),0===cc(s)&&(s[2]=1),uc(s,s),fc(r,i,s),0===cc(s)&&(1===Math.abs(i[2])?s[0]+=1e-4:s[2]+=1e-4,uc(s,s),fc(r,i,s)),uc(r,r),fc(o,s,r),t[0]=r[0],t[4]=o[0],t[8]=s[0],t[1]=r[1],t[5]=o[1],t[9]=s[1],t[2]=r[2],t[6]=o[2],t[10]=s[2]}(u,this.cameraPosition,this.cameraLookAt,c);var f,d,m=this.cameraForward||[0,0,0];return lc(m,this.cameraLookAt,this.cameraPosition),this.cameraForward=uc(m,m),function(t,e){var n,i=e[0],r=e[4],o=e[8],s=e[1],a=e[5],h=e[9],l=e[2],c=e[6],u=e[10],f=i+a+u;f>0?(n=.5/Math.sqrt(f+1),t.w=.25/n,t.x=(c-h)*n,t.y=(o-l)*n,t.z=(s-r)*n):i>a&&i>u?(n=2*Math.sqrt(1+i-a-u),t.w=(c-h)/n,t.x=.25*n,t.y=(r+s)/n,t.z=(o+l)/n):a>u?(n=2*Math.sqrt(1+a-i-u),t.w=(o-l)/n,t.x=(r+s)/n,t.y=.25*n,t.z=(h+c)/n):(n=2*Math.sqrt(1+u-i-a),t.w=(s-r)/n,t.x=(o+l)/n,t.y=(h+c)/n,t.z=.25*n)}(gc,u),function(t,e){var n=t,i=e.x,r=e.y,o=e.z,s=e.w,a=i+i,h=r+r,l=o+o,c=i*a,u=i*h,f=i*l,d=r*h,m=r*l,g=o*l,p=s*a,_=s*h,v=s*l;n[0]=1-(d+g),n[4]=u-v,n[8]=f+_,n[1]=u+v,n[5]=1-(c+g),n[9]=m-p,n[2]=f-_,n[6]=m+p,n[10]=1-(c+d),n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}(u,gc),(d=u)[12]=(f=this.cameraPosition)[0],d[13]=f[1],d[14]=f[2],u}),_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*Mc)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach((function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}}))}}),qh.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var e=this._getCurrentView(),n=this._viewHistory.length-1;n>=0;n--)if(rr$4(t,this._viewHistory[n]))return this._viewHistoryPointer=n,void this._fireViewChange(e,t);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var i=this.options.viewHistoryCount;i>0&&this._viewHistory.length>i&&this._viewHistory.splice(0,this._viewHistory.length-i),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(e,t)},zoomToPreviousView:function(t){if(void 0===t&&(t={}),!this.hasPreviousView())return null;var e=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(e,t),e},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(t){if(void 0===t&&(t={}),!this.hasNextView())return null;var e=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(e,t),e},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(t,e){var n=this,i=this.getView();e.animation?this._animateTo(t,{duration:e.duration},(function(e){"finished"===e.state.playState&&n._fireViewChange(i,t)})):(this.setView(t),this._fireViewChange(i,t))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,e){this._fireEvent("viewchange",{old:t,new:e}),this._insertUICollidesQueue()},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),qh.mergeOptions({viewHistory:!0,viewHistoryCount:10});var Pc=new ms$1;qh.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new ms$1,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this},_insertUICollidesQueue:function(){return this._uiCollidesQueue||(this._uiCollidesQueue=[]),this._uiCollidesQueue.push(1),this},uiCollides:function(){if(!this.uiList||0===this.uiList.length||!this._uiCollidesQueue||0===this._uiCollidesQueue.length)return this;var t=Pc;t.clear();for(var e=this.uiList,n=0,i=e.length;n<i;n++){var r=e[n],o=r.options,s=o.collisionBufferSize;if(o.collision){var a=r.getDOM();if(r.isVisible()&&a&&a.getBoundingClientRect){r.bbox||(r.bbox=[0,0,0,0]);var h=a.getBoundingClientRect(),l=h.x,c=h.y,u=l+h.width+s,f=c-s,d=c+h.height+s;r.bbox[0]=l-s,r.bbox[1]=f,r.bbox[2]=u,r.bbox[3]=d,t.collides(r.bbox)?r._collidesEffect(!1):(t.insertBox(r.bbox),r._collidesEffect(!0))}}}return this._uiCollidesQueue=[],this},_addUI:function(t){return this.uiList||(this.uiList=[]),this.uiList.indexOf(t)>-1||(this.uiList.push(t),this.uiList=this.uiList.sort((function(t,e){return e.options.collisionWeight-t.options.collisionWeight}))),this},_removeUI:function(t){if(!this.uiList)return-1;var e=this.uiList.indexOf(t);return e<0||this.uiList.splice(e,1),e}});var Ac=function(t){function e(e){var n;return(n=t.call(this,e)||this).on("enable",n._afterEnable,Ai$4(Ai$4(n))).on("disable",n._afterDisable,Ai$4(Ai$4(n))),n._measureLayers=[],n}Pi$4(e,t);var n=e.prototype;return n.clear=function(){if(Ji$4(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._measureLayers=[],this},n.getMeasureLayers=function(){return this._measureLayers},n.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},n.undo=function(){t.prototype.undo.call(this);var e=this._historyPointer;if(e!==this._vertexes.length)for(var n=e;n<this._vertexes.length;n++)this._vertexes[n].label&&this._vertexes[n].label.remove(),this._vertexes[n].marker.remove();return this},n.redo=function(){t.prototype.redo.call(this);var e=this._historyPointer-1;return this._vertexes[e]&&(this._vertexes[e].marker.getLayer()||(this._vertexes[e].label&&this._vertexes[e].label.addTo(this._measureMarkerLayer),this._vertexes[e].marker.addTo(this._measureMarkerLayer))),this},n._measure=function(t){var e,n,i=this.getMap();t instanceof kh?e=i.computeGeometryLength(t):Array.isArray(t)&&(e=i.getProjection().measureLength(t)),this._lastMeasure=e,n="zh-CN"===this.options.language?[" 米"," 公里"," 英尺"," 英里"]:[" m"," km"," feet"," mile"];var r="";return this.options.metric&&(r+=e<1e3?e.toFixed(0)+n[0]:(e/1e3).toFixed(2)+n[1]),this.options.imperial&&(r.length>0&&(r+="\n"),r+=(e*=3.2808399)<5280?e.toFixed(0)+n[2]:(e/5280).toFixed(2)+n[3]),r},n._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},n._afterEnable=function(){this._registerMeasureEvents()},n._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},n._msOnDrawStart=function(t){var e=this.getMap(),n=e._pointToPrj(t.point2d),i=zi$4(),r="distancetool_"+i,o="distancetool_markers_"+i;e.getLayer(r)?(this._measureLineLayer=e.getLayer(r),this._measureMarkerLayer=e.getLayer(o)):(this._measureLineLayer=new Zl(r).addTo(e),this._measureMarkerLayer=new Zl(o).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer);var s=new fl(t.coordinate,{symbol:this.options.vertexSymbol});s._setPrjCoordinates(n);var a=new Fl("zh-CN"===this.options.language?"起点":"start",t.coordinate,this.options.labelOptions);a._setPrjCoordinates(n),this._lastVertex=a,this._addVertexMarker(s,a)},n._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var n=_o$3(this.options.vertexSymbol);n.markerWidth/=2,n.markerHeight/=2,this._tailMarker=new fl(t.coordinate,{symbol:n}).addTo(this._measureMarkerLayer),this._tailLabel=new Fl(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var i=this._geometry._getPrjCoordinates(),r=i[i.length-1];this._tailMarker.setCoordinates(t.coordinate),this._tailMarker._setPrjCoordinates(r),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(t.coordinate),this._tailLabel._setPrjCoordinates(r)},n._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},n._msOnDrawVertex=function(t){var e=this._geometry._getPrjCoordinates(),n=e[e.length-1],i=t.geometry,r=new fl(t.coordinate,{symbol:this.options.vertexSymbol}),o=this._measure(i),s=new Fl(o,t.coordinate,this.options.labelOptions);this._addVertexMarker(r,s),s._setPrjCoordinates(n),r._setPrjCoordinates(n),this._lastVertex=s},n._addVertexMarker=function(t,e){this._vertexes||(this._vertexes=[]),void 0!==this._historyPointer&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:e,marker:t}),this._measureMarkerLayer.addGeometry(t),e&&this._measureMarkerLayer.addGeometry(e)},n._msOnDrawEnd=function(t){if(this._clearTailMarker(),t.geometry._getPrjCoordinates().length<2)return this._lastMeasure=0,void this._clearMeasureLayers();var e=this._lastVertex.getSize();e||(e=new Yr$4(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),e.width);var n=t.geometry.copy();n._setPrjCoordinates(t.geometry._getPrjCoordinates()),n.addTo(this._measureLineLayer),this._lastMeasure=n.getLength()},n._addClearMarker=function(t,e,n){var i=this.options.clearButtonSymbol,r={markerDx:(i.markerDx||0)+n,textDx:(i.textDx||0)+n};Array.isArray(i)&&(r=i.map((function(t){return t?{markerDx:(t.markerDx||0)+n,textDx:(t.textDx||0)+n}:null}))),i=_o$3(i,r);var o=new fl(t,{symbol:i}),s=this._measureLineLayer,a=this._measureMarkerLayer;o.on("click",(function(){return s.remove(),a.remove(),!1}),this),o.addTo(this._measureMarkerLayer),o._setPrjCoordinates(e)},n._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},n._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},e}(Yl);Ac.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]}),function(t){function e(e){var n;return(n=t.call(this,e)||this)._measureLayers=[],n}Pi$4(e,t);var n=e.prototype;return n._measure=function(t){var e,n,i=this.getMap();t instanceof kh?e=i.computeGeometryArea(t):Array.isArray(t)&&(e=i.getProjection().measureArea(t)),this._lastMeasure=e,n="zh-CN"===this.options.language?[" 平方米"," 平方公里"," 平方英尺"," 平方英里"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];var r="";return this.options.metric&&(r+=e<1e6?e.toFixed(0)+n[0]:(e/1e6).toFixed(2)+n[1]),this.options.imperial&&(r.length>0&&(r+="\n"),r+=(e*=3.2808399)<27878400?e.toFixed(0)+n[2]:(e/27878400).toFixed(2)+n[3]),r},n._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},n._msOnDrawVertex=function(t){var e=this.getMap()._pointToPrj(t.point2d),n=new fl(t.coordinate,{symbol:this.options.vertexSymbol});n._setPrjCoordinates(e),this._measure(t.geometry),this._lastVertex=n,this._addVertexMarker(n)},n._msOnDrawEnd=function(t){var e;if(this._clearTailMarker(),t.point2d)e=this.getMap()._pointToPrj(t.point2d);else{var n=t.geometry._getPrjCoordinates();n=n.slice(0,n.length-1),t.geometry._setPrjCoordinates(n),e=n[n.length-1]}if(t.geometry._getPrjCoordinates().length<3)return this._lastMeasure=0,void this._clearMeasureLayers();var i=this._measure(t.geometry),r=this.getMap().getProjection().unproject(e),o=new Fl(i,r,this.options.labelOptions).addTo(this._measureMarkerLayer);o._setPrjCoordinates(e);var s=o.getSize();s||(s=new Yr$4(10,10)),this._addClearMarker(r,e,s.width);var a=t.geometry.copy();a._setPrjCoordinates(t.geometry._getPrjCoordinates()),a.addTo(this._measureLineLayer),this._lastMeasure=a.getArea()},e}(Ac).mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5}});var Ec={create:function(t,e){var n=t.unproject(e[0]),i=new Tl(n,0);return i._setPrjCoordinates(e[0]),i},update:function(t,e,n){var i=n.getMap(),r=Array.isArray(e)?e[e.length-1]:e,o=t.unproject(r),s=i.computeLength(n.getCenter(),o);n.setRadius(s)},generate:function(t){return t}};Yl.registerMode("circle",kn$3({clickLimit:2,action:["click","mousemove","click"]},Ec)),Yl.registerMode("freeHandCircle",kn$3({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Ec));var Oc={create:function(t,e){var n=t.unproject(e[0]),i=new Sl(n,0,0);return i._setPrjCoordinates(e[0]),i},update:function(t,e,n){var i=n.getMap(),r=n.getCenter(),o=Array.isArray(e)?e[e.length-1]:e,s=t.unproject(o),a=i.computeLength(r,new ys$1({x:s.x,y:r.y})),h=i.computeLength(r,new ys$1({x:r.x,y:s.y}));n.setWidth(2*a),n.setHeight(2*h)},generate:function(t){return t}};Yl.registerMode("ellipse",kn$3({clickLimit:2,action:["click","mousemove","click"]},Oc)),Yl.registerMode("freeHandEllipse",kn$3({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Oc));var Rc={create:function(t,e){var n=new ll([]);return n._firstClick=e[0],n},update:function(t,e,n,i){var r=n.getMap(),o=i.containerPoint,s=r._prjToContainerPoint(n._firstClick),a=[[s.x,s.y],[o.x,s.y],[o.x,o.y],[s.x,o.y]];n.setCoordinates(a.map((function(t){return r.containerPointToCoord(new Ii$4(t))}))),n._setPrjCoordinates(a.map((function(t){return r._containerPointToPrj(new Ii$4(t))})))},generate:function(t){return t}};Yl.registerMode("rectangle",kn$3({clickLimit:2,action:["click","mousemove","click"]},Rc)),Yl.registerMode("freeHandRectangle",kn$3({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Rc)),Yl.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(t,e){var n=t.unproject(e[0]),i=new fl(n);return i._setPrjCoordinates(e[0]),i},generate:function(t){return t},update:function(t,e,n){if(Array.isArray(e)&&(e=e[e.length-1]),!e)return n;var i=t.unproject(e);return n.setCoordinates(i),n}});var Ic={create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new ml(n);return i._setPrjCoordinates(e),i},update:function(t,e,n){var i,r=n.getSymbol();Array.isArray(e)?i=e:(i=n._getPrjCoordinates()).push(e);var o=i.map((function(e){return t.unproject(e)}));n.setCoordinates(o),n._setPrjCoordinates(i);var s=n.getLayer();if(s){var a=s.getGeometryById("polygon");if(!a&&i.length>=3){if(a=new ll([o],{id:"polygon"}),r){var h=_o$3(r,{lineOpacity:0});a.setSymbol(h)}a.addTo(s)}a&&a._setPrjCoordinates(i)}},generate:function(t){var e=new ll(t.getCoordinates(),{symbol:t.getSymbol()});return e._setPrjCoordinates(t._getPrjCoordinates()),e._projCode=t._projCode,e}};Yl.registerMode("polygon",kn$3({action:["click","mousemove","dblclick"]},Ic)),Yl.registerMode("freeHandPolygon",kn$3({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Ic));var kc={create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new ml(n);return i._setPrjCoordinates(e),i},update:function(t,e,n){var i;Array.isArray(e)?i=e:(i=n._getPrjCoordinates()).push(e);var r=i.map((function(e){return t.unproject(e)}));n.setCoordinates(r),n._setPrjCoordinates(i)},generate:function(t){return t}};function Dc(t){for(var e=t.tileInfo,n=[e.cols,e.rows],i=[],r=e.lods,o=0,s=r.length;o<s;o++)i.push(r[o].resolution);var a=t.fullExtent,h=e.origin,l=[1,-1,h.x,h.y];return delete a.spatialReference,{spatialReference:{resolutions:i,fullExtent:a},tileSystem:l,tileSize:n}}function Lc(t,e){return void 0===e&&(e=[]),e.forEach((function(e){t=t.replace(e[0],e[1])})),t}function zc(t){var e=t.projection,n=t.isArcgis,i=t.isGeoServer,r=t.isSuperMap,o=.0002645833333333333;return(n||i||r)&&(o=28e-5),e&&e.indexOf("4326")>-1&&(o=2.3767925226029154e-9,(n||r)&&(o=2.518101729011901e-9),i&&(o=2.51528279553466e-9)),o}function Fc(t,e){var n=t.getElementsByTagName(e);return n&&n.length?n:t.getElementsByTagName("wmts:"+e)}function jc(t,e){for(var n=0;n<t.length;n++){var i=t[n];if((i=i.getElementsByTagName("ows:Identifier")[0])&&i.textContent===e)return t[n]}return null}function Hc(t,e){void 0===e&&(e={});var n,i,r,o=Fc(t,"TileMatrix"),s=[],a=[],h=[],l=!1;if(!n){var c=t.getElementsByTagName("ows:SupportedCRS")[0];c&&(n=function(t){var e=t.indexOf("EPSG")>-1?t:"EPSG:"+t;return Lc(e,[["4490","4326"],["102100","3857"],["900913","3857"]])}(n=function(t){for(var e="",n=t.split(""),i=n.length-1;i>=0&&!isNaN(n[i]);i--)e=n[i]+e;return e}(n=(n=c.textContent).split("EPSG")[1])))}i||(i=t.getElementsByTagName("ows:Identifier")[0])&&(i=i.textContent),e.projection=n;for(var u=1/0,f=0;f<o.length;f++){var d=o[f],m=d.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(m))?(r=m.substr(0,m.lastIndexOf(":")),m=(m=m.split(":"))[m.length-1],m=parseInt(m),l=!0,e.isGeoServer=!0):m=parseInt(m),u=Math.min(u,m);var g=Fc(d,"ScaleDenominator")[0].textContent,p=Fc(d,"TopLeftCorner")[0].textContent,_=Fc(d,"TileWidth")[0].textContent,v=Fc(d,"TileHeight")[0].textContent;if(0===h.length&&h.push(parseInt(_),parseInt(v)),0===a.length){var y=p.split(" ").filter((function(t){return""!==t})).map((function(t){return parseFloat(t)})),x=y[0],b=y[1];x>0?a.push(1,-1,b,x):a.push(1,-1,x,b)}var w=zc(e),C=parseFloat(g)*w;s.push(C)}if(u>0)for(var M=s[0],T=u-1;T>=0;T--)s.splice(0,0,M*=2);return{resolutions:s,tileSize:h,tileSystem:a,projection:n,TileMatrixSet:i,isGeoServer:l,levelStr:r}}Yl.registerMode("linestring",kn$3({action:["click","mousemove","dblclick"]},kc)),Yl.registerMode("freeHandLinestring",kn$3({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},kc)),Yl.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new Ol(n);return i._setPrjCoordinates(e),i},update:kc.update,generate:function(t){return t}}),Yl.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new Il(n);return i._setPrjCoordinates(e),i},update:kc.update,generate:function(t){return t}}),Yl.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new Rl(n);return i._setPrjCoordinates(e),i},update:kc.update,generate:function(t){return t}}),Yl.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t,e){var n=t.unproject(e=e[0]),i=new fl(n);return i._firstClick=e,i},update:function(t,e,n,i){var r=n.getMap(),o=r._prjToContainerPoint(n._firstClick),s=i.containerPoint;e=r._containerPointToPrj(new ys$1(Math.min(o.x,s.x),Math.min(o.y,s.y)));var a=t.unproject(e);n.setCoordinates(a)._setPrjCoordinates(e),n.updateSymbol({markerWidth:Math.abs(o.x-s.x),markerHeight:Math.abs(o.y-s.y)})},generate:function(t){return t}}),Eh.loadArcgis=function(t,e,n){if(void 0===n&&(n={jsonp:!0}),jn$3(t)&&"{"!==t.substring(0,1))$o$2.getJSON(t,(function(t,n){if(t)e(t);else{var i=Dc(n);e(null,i)}}),n);else{jn$3(t)&&(t=ji$4(t));var i=Dc(t);e(null,i)}return this},Eh.loadWMTS=function(t,e,n){return void 0===n&&(n={jsonp:!0}),jn$3(t)&&$o$2.get(t,(function(i,r){if(i)e(i);else{var o=function(t,e,n){null==n.isArcgis&&(n.isArcgis=t.indexOf("arcgis")>-1),null==n.isSuperMap&&(n.isSuperMap=t.indexOf("supermap")>-1);var i=(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("Contents")[0];if(!i)return[];var r=Fc(i,"Layer");if(!r.length)return[];for(var o=[],s=0,a=i.childNodes.length;s<a;s++)"TileMatrixSet"===i.childNodes[s].localName&&o.push(i.childNodes[s]);if(!o.length)return[];for(var h=[],l=0,c=r.length;l<c;l++){var u=r[l],f=u.querySelectorAll("Style")[0];f&&(f=f.getElementsByTagName("ows:Identifier")[0])&&(f=f.textContent);var d=u.getElementsByTagName("ows:Identifier")[0];d&&(d=d.textContent);var m=Fc(u,"TileMatrixSetLink");if(0!==m.length)for(var g=0,p=m.length;g<p;g++){var _=m[g];(_=Fc(_,"TileMatrixSet")[0])&&(_=_.textContent);var v=jc(o,_);if(v){var y=u.querySelectorAll("ResourceURL")[0],x="";y&&(x=y.attributes.template.value);var b=Hc(v,n),w=b.resolutions,C=b.tileSize,M=b.tileSystem,T=b.projection,S=b.TileMatrixSet,P=b.isGeoServer,A=b.levelStr;x.length||(x=e.substr(0,e.lastIndexOf("?")),x+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var E=Lc(x,[["{LAYER}",d],["{Layer}",d],["{layer}",d],["{STYLE}",f],["{Style}",f],["{style}",f],["{TileMatrixSet}",S],["{TileMatrix}",P?A+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",P?"image/png":"tiles"]]);h.push({tileSize:C,tileSystem:M,spatialReference:{resolutions:w,projection:T},urlTemplate:E,info:{layerName:d,TileMatrixSet:S,style:f,tileSize:C,tileSystem:M,resolutions:w,projection:T,urlTemplate:E}})}}}return h}(r,t,n);e(null,o)}}),n),this};var Nc=function(t){function e(e){var n;return(n=t.call(this,e)||this).proxyOptions(),n}Pi$4(e,t);var n=e.prototype;return n.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},n.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},n._collides=function(){var t=this.getMap();return t?(t._addUI(this),t._insertUICollidesQueue(),this):this},n._collidesEffect=function(t){var e=this.getDOM();if(!e)return this;if(e.style.visibility=t?"visible":"hidden",!e.classList||!e.classList.add)return this;if(!this.options.collisionFadeIn)return this;var n=e.classList.contains("mtk-ui-fadein");return t&&!n?e.classList.add("mtk-ui-fadein"):!t&&n&&e.classList.remove("mtk-ui-fadein"),this},n.show=function(t){var e=this.getMap();if(!e)return this;this.options.visible=!0,t=t||this._coordinate||this._owner.getCenter();var n=this.isVisible();this._showBySymbolChange||this.fire("showstart");var i=this._getUIContainer();this._coordinate=t,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var r=this.__uiDOM=this.buildOn(e);if(r.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(r),!r)return this._showBySymbolChange||this.fire("showend"),this._collides(),this;this._measureSize(r),this._singleton()&&(r._uiComponent=this,e[this._uiDomKey()]=r),this._setPosition(),r.style[Ao$3]=null,i.appendChild(r);var o=this._getAnimation();if(n&&(o.ok=!1),o.ok&&(o.fade&&(r.style.opacity=0),o.scale)){if(this.getTransformOrigin){var s=this.getTransformOrigin();r.style[Po$3]=s}r.style[So$2]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(r.style.display=""),this.options.eventsToStop&&Xo$3(r,this.options.eventsToStop,zo$3),this.options.autoPan&&this._autoPan();var a=o.transition;return o.ok&&a&&(a&&(r.style[Ao$3]=a),o.fade&&(r.style.opacity=1),o.scale&&(r.style[So$2]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this._collides(),this},n.hide=function(){var t=this;if(!this.getDOM())return this;this._onDomMouseout&&this._onDomMouseout(),this.options.visible=!1;var e=this._getAnimation(),n=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(n.style[Ao$3]=e.transition,setTimeout((function(){n.style.display="none",t.fire("hide")}),this.options.animationDuration)):(n.style.display="none",this.fire("hide")),e.fade&&(n.style.opacity=0),e.scale&&(n.style[So$2]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this._collides(),this},n.isVisible=function(){if(!this.options.visible)return!1;var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&"none"!==t.style.display},n.remove=function(){if(delete this._mapEventsOn,!this._owner)return this;var t=this.getMap();return t&&t._removeUI(this),this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this._collides(),this},n.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},n.getOwner=function(){return this._owner},n.getDOM=function(){return this.__uiDOM},n._roundPoint=function(t){return this.options.roundPoint&&(t=t._round()),t},n.getPosition=function(){if(!this.getMap())return null;var t=this._roundPoint(this._getViewPoint());if(this.getOffset){var e=this._roundPoint(this.getOffset());e&&t._add(e)}return t},n._getAnimation=function(){for(var t={fade:!1,scale:!1},e=this.options.animation?this.options.animation.split(","):[],n=0;n<e.length;n++){var i=Kr$4(e[n]);"fade"===i?t.fade=!0:"scale"===i&&(t.scale=!0)}var r=null;return t.fade&&(r="opacity "+this.options.animationDuration+"ms"),t.scale&&(r=r?r+",":"",r+=So$2+" "+this.options.animationDuration+"ms"),t.transition=r,t.ok=null!==r,t},n._getViewPoint=function(){var t=0,e=this._coordinate||{};Ln$3(e.z)?t=e.z:this._owner&&this._owner.getAltitude&&(t=this._owner.getAltitude()||0);var n=this._meterToPoint(this._coordinate,t);return this.getMap().coordToViewPoint(this._coordinate,void 0,n)._add(this.options.dx,this.options.dy)},n._meterToPoint=function(t,e){var n=this.getMap();return n.altitudeToPoint(e,n._getResolution())*Vi$4(e)},n._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(!t.isMoving()){var n=this._getViewPoint()._round(),i=t.width,r=t.height,o=t.viewPointToContainerPoint(n),s=this.getOffset(),a=o.add(s),h=t._viewPointToPrj(n),l=parseInt(e.clientWidth),c=parseInt(e.clientHeight),u=0,f=0;if(a.x<0?u=50-a.x:a.x+l>i&&(u=-(a.x+l-i)-50),a.y-c<0?f=Math.abs(a.y-c)+50:a.y+c>r&&(f=r-(a.y+c)-50),l>=i&&(u=i/2-o.x),0!==f||0!==u){var d=o.add(u,f),m=t._containerPointToPoint(d)._sub(t._prjToPoint(t._getPrjCenter())),g=t._pointToPrj(t._prjToPoint(h).sub(m));t._panAnimation(g)}}},n._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute";var n=t.style.bottom?"bottom":"top";if(t.style.display="",e.appendChild(t),t.getBoundingClientRect){var i=t.getBoundingClientRect();this._size=new Yr$4(i.width,i.height)}else this._size=new Yr$4(t.clientWidth,t.clientHeight);return t.style.display="none",t.style.left="0px",t.style[n]="0px",this._size},n._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),n=this._uiDomKey();if(e[n]){t&&Jo$2(e[n],t,zo$3);var i=e[n]._uiComponent;i&&i!==this&&i.isVisible()&&i.fire("hide"),Ro$2(e[n]),i&&!this.hideDom&&i._switchMapEvents("off"),delete e[n]}delete this.__uiDOM}else this.__uiDOM&&(t&&Jo$2(this.__uiDOM,t,zo$3),Ro$2(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},n._uiDomKey=function(){return"__ui_"+this._getClassName()},n._singleton=function(){return this.options.single},n._getUIContainer=function(){return this.getMap()._panels.ui},n._getClassName=function(){return"UIComponent"},n._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn="on"===t;var n=this._getDefaultEvents();if(this.getEvents&&kn$3(n,this.getEvents()),n)for(var i in n)n.hasOwnProperty(i)&&e[t](i,n[i],this)}},n._switchEvents=function(t){var e=this._getOwnerEvents();if(this._owner)for(var n in e)e.hasOwnProperty(n)&&this._owner[t](n,e[n],this)},n._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},n._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof kh&&(t.positionchange=this.onGeometryPositionChange,t.symbolchange=this._updatePosition),this.getOwnerEvents&&kn$3(t,this.getOwnerEvents()),t},n.onGeometryPositionChange=function(t){this._owner&&this.isVisible()&&(this._showBySymbolChange=!0,this.show(t.target.getCenter()),delete this._showBySymbolChange)},n.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},n.onEvent=function(){this.isVisible()&&this._updatePosition()},n.onZoomEnd=function(){this.isVisible()&&this._setPosition()},n.onResize=function(){this.isVisible()&&this._setPosition()},n.onDomSizeChange=function(){this.isVisible()&&(this._setPosition(),this._collides())},n._updatePosition=function(){return this.getMap()?(this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this)),this):this},n._setPosition=function(){var t=this.getDOM();if(t){t.style[Ao$3]=null;var e=this.getPosition();this._pos=e,t.style[So$2]=this._toCSSTranslate(e)+" scale(1)"}},n._toCSSTranslate=function(t){if(!t)return"";if(Si$4.any3d){var e=this.getMap(),n=e?e.getBearing():0,i=e?e.getPitch():0,r="";return this.options.pitchWithMap&&i&&(r+=" rotateX("+Math.round(i)+"deg)"),this.options.rotateWithMap&&n&&(r+=" rotateZ("+Math.round(-n)+"deg)"),"translate3d("+t.x+"px,"+t.y+"px, 0px)"+r}return"translate("+t.x+"px,"+t.y+"px)"},n._observerDomSize=function(t){var e=this;return t&&Si$4.resizeObserver&&!this._resizeObserver?(this._resizeObserver=new ResizeObserver((function(t){if(t.length){var n=t[0].borderBoxSize;e._domContentRect=n&&n.length?{width:n[0].inlineSize,height:n[0].blockSize}:t[0].contentRect}else delete e._domContentRect;e.onDomSizeChange&&e.onDomSizeChange()})),this._resizeObserver.observe(t),this):this},n.isSupportZoomFilter=function(){return!1},n.onConfig=function(){return this._updatePosition(),this},e.isSupport=function(t){return!!(t&&Hn$3(t.on)&&Hn$3(t.off)&&Hn$3(t.getCenter))},e}(hs$1(cs$2));Nc.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1,collision:!1,collisionBufferSize:2,collisionWeight:0,collisionFadeIn:!1});var Bc="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",Gc=function(t){function e(e,n){var i;return(i=t.call(this,n)||this)._markerCoord=new ys$1(e),i}Pi$4(e,t);var n=e.prototype;return n._getClassName=function(){return"UIMarker"},n.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition(),this._collides()),this},n.getCoordinates=function(){return this._markerCoord},n.getCenter=function(){return this.getCoordinates()},n.getAltitude=function(){var t=this.getCoordinates()||{};return Ln$3(t.z)?t.z:this.options.altitude||0},n.setAltitude=function(t){return Ln$3(t)&&this._markerCoord&&(this._markerCoord.z=t,this._updatePosition&&(this._updatePosition(),this._collides())),this},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},n.getContent=function(){return this.options.content},n.onAdd=function(){this.show()},n.show=function(){return t.prototype.show.call(this,this._markerCoord)},n.flash=function(t,e,n,i){return sr$4.call(this,t,e,n,i)},n.buildOn=function(){var t,e=this.options.content,n=jn$3(e);return n||Hn$3(e)?(t=Eo$2("div"),n?t.innerHTML=this.options.content:e.bind(this)(t)):t=this.options.content,this.options.containerClass&&(t.className=this.options.containerClass),this._registerDOMEvents(t),t},n.getOffset=function(){var t=this.getSize(),e=-t.width/2,n=-t.height/2,i=this.options,r=i.horizontalAlignment,o=i.verticalAlignment;return"left"===r?e=-t.width:"right"===r&&(e=0),"top"===o?n=-t.height:"bottom"===o&&(n=0),new Ii$4(e,n)},n.getTransformOrigin=function(){return"center center"},n.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},n.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},n._registerDOMEvents=function(t){Xo$3(t,Bc,this._onDomEvents,this)},n._onDomEvents=function(t){var e=this.getMap()._parseEvent(t,t.type),n=t.type;if("mousedown"===n&&(this._mousedownEvent=t),"mouseup"===n&&(this._mouseupEvent=t),("click"!==n||!this._mouseClickPositionIsChange())&&("touchstart"===n&&(this._touchstartTime=In$3()),this.fire(t.type,e),"touchend"===n&&Si$4.touch)){var i=this.getMap().options.clickTimeThreshold||280;In$3()-this._touchstartTime<i&&this._onDomEvents(kn$3({},t,{type:"click"}))}},n._removeDOMEvents=function(t){Jo$2(t,Bc,this._onDomEvents)},n._mouseClickPositionIsChange=function(){var t=this._mousedownEvent||{},e=this._mouseupEvent||{};return t.x!==e.x||t.y!==e.y},n._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),n=this.getSize(),i=n.width,r=n.height;return[t.containerPointToCoordinate(e.add(-i/2,0)),t.containerPointToCoordinate(e.add(i/2,0)),t.containerPointToCoordinate(e.add(0,r/2)),t.containerPointToCoordinate(e.add(0,-r/2))]},n._getViewPoint=function(){var t=0;if(this._owner){var e=this.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},n._getDefaultEvents=function(){return kn$3({},t.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},n._setPosition=function(){this.onZoomFilter(),t.prototype._setPosition.call(this)},n.onZoomFilter=function(){var t=this.getDOM();t&&(this.isVisible()||"none"===t.style.display?this.isVisible()&&"none"===t.style.display&&(t.style.display=""):t.style.display="none")},n.isVisible=function(){var t=this.getMap();if(!t)return!1;if(!this.options.visible)return!1;var e=t.getZoom(),n=this.options,i=n.minZoom,r=n.maxZoom;return!(!Dn$3(i)&&e<i||!Dn$3(r)&&e>r)&&this.getDOM()&&!0},n.isSupportZoomFilter=function(){return!0},e}(gs$1(Nc));Gc.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null,horizontalAlignment:"middle",verticalAlignment:"middle"});var Vc=Si$4.touch?"touchstart mousedown":"mousedown",Wc=function(t){function e(e){return t.call(this,e)||this}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on(Vc,this._startDrag,this)},n.removeHooks=function(){this.target.off(Vc,this._startDrag,this)},n._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||2===e.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},n._prepareDragHandler=function(){this._dragHandler=new vs$1(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},n._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},n._onMouseDown=function(t){zo$3(t.domEvent)},n._dragging=function(t){var e=this.target,n=e.getMap()._parseEvent(t.domEvent),i=n.domEvent;if(!(i.touches&&i.touches.length>1))if(this._isDragging){var r=n.coordinate,o=n.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=o);var s=r.sub(this._lastCoord),a=o.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=o,this.target.setCoordinates(this.target.getCoordinates().add(s)),n.coordOffset=s,n.pointOffset=a,e.fire("dragging",n)}else this._isDragging=!0},n._endDrag=function(t){var e=this.target,n=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,n){var i=n._parseEvent(t.domEvent);e&&e._mouseClickPositionIsChange&&e._mouseClickPositionIsChange()&&e.fire("dragend",i)}},n.isDragging=function(){return!!this._isDragging},e}(ls$1);Gc.addInitHook("addHandler","draggable",Wc);var Uc=/\{ *([\w_]+) *\}/g,Zc={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},Xc=new Yr$4(0,0),Jc=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n._getClassName=function(){return"InfoWindow"},n.addTo=function(e){return e instanceof kh&&(e.getInfoWindow()&&e.getInfoWindow()!==this&&e.removeInfoWindow(),e._infoWindow=this),t.prototype.addTo.call(this,e)},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},n.getContent=function(){return this.options.content},n.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},n.getTitle=function(){return this.options.title},n.buildOn=function(){var t=Hn$3(this.options.content),e=jn$3(this.options.content);if(this.options.custom){if(e||t){var n=Eo$2("div");return e?(n.innerHTML=this.options.content,this._replaceTemplate(n)):this.options.content.bind(this)(n),n}return this._replaceTemplate(this.options.content),this.options.content}this._bindDomEvents(this.getDOM(),"off");var i=Eo$2("div");this.options.containerClass&&(i.className=this.options.containerClass);var r=this._getWindowWidth();i.style.width=Ln$3(r)?r+"px":"auto",i.style.bottom="0px";var o='<em class="maptalks-ico"></em>';this.options.title&&(o+="<h2>"+this.options.title+"</h2>"),i.innerHTML=o+='<a href="javascript:void(0);" class="maptalks-close"></a><div class="maptalks-msgContent"></div>',this._replaceTemplate(i);var s=i.querySelector(".maptalks-msgContent");return e||t?e?s.innerHTML=this.options.content:this.options.content.bind(this)(s):s.appendChild(this.options.content),this._onCloseBtnClick=this.hide.bind(this),Io$2(i.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),t||this._replaceTemplate(s),this._bindDomEvents(i,"on"),i},n._replaceTemplate=function(t){if(this.options.enableTemplate&&this._owner&&this._owner.getProperties&&t&&t.innerHTML){var e=this._owner.getProperties()||{};Fn$3(e)&&(t.innerHTML=t.innerHTML.replace(Uc,(function(t,n){return e[n]})))}return this},n.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},n.getOffset=function(){var t=this.getSize(),e=new Ii$4(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var n=this.getOwner();if(n instanceof fl||n instanceof yl){var i,r;if(n instanceof fl)i=n._getPainter(),r=n.getSize();else{var o=n.getGeometries();if(!o||!o.length)return e;i=o[0]._getPainter(),r=o[0].getSize()}if(r||(r=Xc),i){var s=i.getFixedExtent();e._add(s.xmax-r.width/2,s.ymin)}else e._add(0,-r.height)}return e},n.show=function(e){return this.getMap()&&this.getMap().options.enableInfoWindow?t.prototype.show.call(this,e):this},n.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},n.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},n.onRemove=function(){this._onDomMouseout(),this.onDomRemove()},n.onDomRemove=function(){this._onCloseBtnClick&&(ko$2(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},n._onAutoOpen=function(t){var e=this,n=this.getOwner();setTimeout((function(){n instanceof fl||n instanceof Nc?e.show(n.getCoordinates()):n instanceof yl?e.show(n.findClosest(t.coordinate)):n instanceof ml||n instanceof bl?(e.getMap().getScale()>=8&&(t.coordinate=e._rectifyMouseCoordinte(n,t.coordinate)),e.show(t.coordinate)):e.show(t.coordinate)}),1)},n._rectifyMouseCoordinte=function(t,e){var n=this;return t instanceof ml?this._rectifyLineStringMouseCoordinate(t,e).coordinate:t instanceof bl?t.getGeometries().map((function(t){return n._rectifyLineStringMouseCoordinate(t,e)})).sort((function(t,e){return t.dis-e.dis}))[0].coordinate:e},n._rectifyLineStringMouseCoordinate=function(t,e){for(var n=this,i=t.getCoordinates().map((function(t){return n.getMap().coordToContainerPoint(t)})),r=this.getMap().coordToContainerPoint(e),o=1/0,s=-1,a=0,h=i.length;a<h;a++){var l=r.distanceTo(i[a]);l<o&&(o=l,s=a)}var c=[];0===s?c.push(i[0],i[1]):s===i.length-1?c.push(i[s-1],i[s]):c.push(i[s-1],i[s],i[s+1]);for(var u=[],f=this.getMap().getSize(),d=f.width,m=f.height,g=0,p=c.length-1;g<p;g++){var _=c[g],v=c[g+1];if(_.x===v.x)for(var y=Math.max(0,Math.min(_.y,v.y)),x=Math.min(m,Math.max(_.y,v.y)),b=y;b<=x;b++)u.push(new Ii$4(_.x,b));else for(var w=(v.y-_.y)/(v.x-_.x),C=Math.max(0,Math.min(_.x,v.x)),M=Math.min(d,Math.max(_.x,v.x)),T=C;T<=M;T++)u.push(new Ii$4(T,w*(T-_.x)+_.y))}for(var S=1/0,P=-1,A=0,E=u.length;A<E;A++){var O=r.distanceTo(u[A]);O<S&&(S=O,P=A)}return{dis:S,coordinate:P<0?e:this.getMap().containerPointToCoord(u[P])}},n._getWindowWidth=function(){var t=this.options.width;return t||(t=Zc.width),t},n._bindDomEvents=function(t,e){if(t){var n=this._getDomEvents(),i="on"===e?Xo$3:Jo$2;for(var r in n)i(t,r,n[r],this)}},n._getDomEvents=function(){return{mouseover:this._onDomMouseover,mouseout:this._onDomMouseout}},n._onDomMouseover=function(t){var e=this.getMap();e&&(e.options.preventWheelScroll=!1)},n._onDomMouseout=function(t){var e=this.getMap();e&&(e.options.preventWheelScroll=!0)},e}(Nc);Jc.mergeOptions(Zc);var qc="remove hide shapechange positionchange dragend animatestart";(function(t){Pi$4(n,t);var e=n.prototype;function n(e,n){var i;return void 0===n&&(n={}),(i=t.call(this,n)||this)._content=e,i}return e._getClassName=function(){return"ToolTip"},e.addTo=function(e){if(n.isSupport(e))return e.on("mousemove",this.onMouseMove,this),e.on("mouseout",this.onMouseOut,this),e.on(qc,this.hideDom,this),t.prototype.addTo.call(this,e);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},e.setStyle=function(t){return this.options.containerClass=t,this},e.getStyle=function(){return this.options.containerClass},e.getContent=function(){return this._content},e.buildOn=function(){var t=Eo$2("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var n=e.containerClass||e.cssName;return!n&&e.height&&(t.style.lineHeight=e.height+"px"),Hn$3(this._content)?this._content.bind(this)(t):t.innerHTML='<div class="'+n+'">'+this._content+"</div>",t},e.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},e.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var n=this.getMap();if(n){var i=n.locateByPoint(t.coordinate,-5,25);0===this.options.showTimeout?this.show(i):this._timeout=setTimeout((function(){n&&e.show(i)}),this.options.showTimeout)}},e.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mouseover",this.onMouseOver,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(qc,this.hideDom,this))},e.hideDom=function(){return this.hide()},e.onEvent=function(){return t.prototype.onEvent.call(this),this.hideDom(),this},e._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},n})(Nc).mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var Yc=function(t){function e(e){return t.call(this,e)||this}Pi$4(e,t);var n=e.prototype;return n._getClassName=function(){return"Menu"},n.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,this._owner=t,Nc.prototype.addTo.apply(this,arguments)},n.setItems=function(t){return this.options.items=t,this},n.getItems=function(){return this.options.items||[]},n.buildOn=function(){if(this.options.custom){if(jn$3(this.options.items)){var t=Eo$2("div");return t.innerHTML=this.options.items,t}return this.options.items}var e=Eo$2("div");this.options.containerClass&&Go$3(e,this.options.containerClass),e.style.width=this._getMenuWidth()+"px";var n=this._createMenuItemDom();return e.appendChild(n),Xo$3(e,"contextmenu",Lo$2),e},n.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),n=this.getSize(),i=0,r=0;return e.x+n.width>t.width&&(i=-n.width),e.y+n.height>t.height&&(r=-n.height),new Ii$4(i,r)},n.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},n.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},n._createMenuItemDom=function(){var t=this,e=this.getMap(),n=Eo$2("ul");Go$3(n,"maptalks-menu-items");var i,r,o=this.getItems();function s(n){return function(i){var r=e._parseEvent(i,"click");r.target=t,r.owner=t._owner,r.index=n,!1!==this._callback(r)&&(t.hide(),t._owner&&t._owner.fire("closemenu"))}}for(var a=0,h=o.length;a<h;a++){if("-"===(i=o[a])||"_"===i)Go$3(r=Eo$2("li"),"maptalks-menu-splitter");else{r=Eo$2("li");var l=i.item;Hn$3(l)&&(l=l({owner:this._owner,index:a})),r.innerHTML=l,r._callback=i.click,Xo$3(r,"click",s(a))}n.appendChild(r)}var c=this.options.maxHeight||0;return c>0&&No$2(n,"max-height: "+c+"px; overflow-y: auto;"),n},n._getMenuWidth=function(){return this.options.width||160},e}(Nc);Yc.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var Kc={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(t){var e=this instanceof qh?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&e&&(this._bindMenu(),this._menu.show(t)),this.fire("openmenu",{coordinate:t}),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new Yc(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return this.openMenu(t.coordinate),!1}};qh.include(Kc),kh.include(Kc);var Qc=function(t){function e(e){return e&&e.position&&!jn$3(e.position)&&(e.position=kn$3({},e.position)),t.call(this,e)||this}Pi$4(e,t);var n=e.prototype;return n.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t._panels.control;return this.__ctrlContainer=Eo$2("div"),No$2(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},n.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},n.getMap=function(){return this._map},n.getPosition=function(){return kn$3({},this._parse(this.options.position))},n.setPosition=function(t){return this.options.position=jn$3(t)?t:kn$3({},t),this._updatePosition(),this},n.getContainerPoint=function(){var t,e,n=this.getPosition(),i=this.getMap().getSize();return Dn$3(n.left)?Dn$3(n.right)||(t=i.width-parseInt(n.right)):t=parseInt(n.left),Dn$3(n.top)?Dn$3(n.bottom)||(e=i.height-parseInt(n.bottom)):e=parseInt(n.top),new Ii$4(t,e)},n.getContainer=function(){return this.__ctrlContainer},n.getDOM=function(){return this._controlDom},n.show=function(){return this.__ctrlContainer.style.display="",this},n.hide=function(){return this.__ctrlContainer.style.display="none",this},n.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},n.remove=function(){return this._map?(Ro$2(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},n._parse=function(t){var n=t;return jn$3(t)&&(n=e.positions[n]),n},n._updatePosition=function(){var t=this.getPosition();for(var e in t||(t={top:20,left:20}),t)t.hasOwnProperty(e)&&(t[e]=parseInt(t[e]),this.__ctrlContainer.style[e]=t[e]+"px");this.fire("positionchange",{position:kn$3({},t)})},e}(hs$1(cs$2));Qc.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},qh.mergeOptions({control:!0}),qh.include({addControl:function(t){return this._containerDOM.getContext||t.addTo(this),this},removeControl:function(t){return t&&t.getMap()===this?(t.remove(),this):this}});var $c="addlayer removelayer setbaselayer baselayerremove",tu$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.buildOn=function(){return this._attributionContainer=Eo$2("div"),this._attributionContainer.className="maptalks-attribution",this._update(),this._attributionContainer},n.onAdd=function(){this.getMap().on($c,this._update,this)},n.onRemove=function(){this.getMap().off($c,this._update,this)},n._update=function(){var t=this.getMap();if(t){var e=t._getLayers((function(t){return t.options.attribution})).reverse().map((function(t){return t.options.attribution})),n=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+n+"</span>"}},e}(Qc);tu$1.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'}),qh.mergeOptions({attribution:!0}),qh.addOnLoadHook((function(){var t=this.options.attribution||this.options.attributionControl;t&&(this.attributionControl=new tu$1(t),this.addControl(this.attributionControl))}));var eu$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.buildOn=function(){var t=this.container=Eo$2("div",this.options.containerClass),e=this.panel=Eo$2("div","panel"),n=this.button=Eo$2("button");return t.appendChild(n),t.appendChild(e),t},n.onAdd=function(){Xo$3(this.button,"mouseover",this._show,this),Xo$3(this.panel,"mouseleave",this._hide,this),Xo$3(this.getMap(),"click",this._hide,this)},n.onRemove=function(){this.panel&&(Jo$2(this.button,"mouseover",this._show),Jo$2(this.panel,"mouseleave",this._hide),Jo$2(this.getMap(),"click",this._hide),Ro$2(this.panel),Ro$2(this.button),delete this.panel,delete this.button,delete this.container)},n._show=function(){Bo$3(this.container,"shown")||(Go$3(this.container,"shown"),this._createPanel())},n._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||Vo$2(this.container,this.options.containerClass)},n._createPanel=function(){this.panel.innerHTML="";var t=Eo$2("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},n._renderLayers=function(t,e){var n=this,i=t.getBaseLayer(),r=t.getLayers(),o=r.length;if(i){var s=i.layers||[i],a=Eo$2("li","group"),h=Eo$2("ul"),l=Eo$2("label");l.innerHTML=this.options.baseTitle,a.appendChild(l);for(var c=0,u=s.length;c<u;c++)this._isExcluded(s[c])&&(h.appendChild(this._renderLayer(s[c],!0)),a.appendChild(h),e.appendChild(a))}if(o){var f=Eo$2("li","group"),d=Eo$2("ul"),m=Eo$2("label"),g=Eo$2("input");g.type="checkbox",g.checked=!0,m.innerHTML=this.options.overlayTitle,f.appendChild(g),f.appendChild(m);for(var p=function(t){var e=t.target.checked,n=t.target.parentNode;if(n){var i=n.getElementsByTagName("ul")[0];if(i){var r=function(t){var n=t._layer;n&&n[e?"show":"hide"]()},o=function(t){var n=t._layer,i=t.childNodes[0];i&&(i.checked=e),n&&n[e?"show":"hide"]()};r(n),i.childNodes.forEach((function(t){o(t);var e=t.getElementsByTagName("ul")[0];e&&(r(t),e.childNodes.forEach((function(t){o(t)})))}))}}},_=0;_<o;_++){var v=r[_];this._isExcluded(v)&&(v.getLayers?function(){var t=Eo$2("li","group"),e=Eo$2("ul"),i=Eo$2("label"),r=Eo$2("input");i.innerHTML=v.getId(),r.type="checkbox",r.checked=v.isVisible(),r.onchange=p,t.appendChild(r),t.appendChild(i),t.appendChild(e),t._layer=v,d.appendChild(t),(v.getLayers()||[]).forEach((function(t){e.appendChild(n._renderLayer(t,!1,r.checked))}))}():d.appendChild(this._renderLayer(v)),v&&!v.isVisible()&&(g.checked=!1))}f.appendChild(d),e.appendChild(f),g.onchange=p}},n._isExcluded=function(t){var e=t.getId(),n=this.options.excludeLayers;return!(n.length&&n.indexOf(e)>=0)},n._renderLayer=function(t,e,n){var i=this;void 0===n&&(n=!0);var r=Eo$2("li","layer"),o=Eo$2("label"),s=Eo$2("input"),a=this.getMap(),h=t.options.visible;t.options.visible=!0;var l=t.isVisible();return t.options.visible=h,r.className="layer",e?(s.type="radio",s.name="base"):s.type="checkbox",s.checked=h&&l,n||(s.checked=!1),l||s.setAttribute("disabled","disabled"),s.onchange=function(e){if("radio"===e.target.type){var n=a.getBaseLayer(),r=n.layers;if(r)for(var o=0,s=r.length;o<s;o++){var h=r[o];h[h===t?"show":"hide"]()}else n.isVisible()||n.show();a._fireEvent("setbaselayer")}else t[e.target.checked?"show":"hide"]();i.fire("layerchange",{target:t})},r.appendChild(s),o.innerHTML=t.getId(),r.appendChild(o),r._layer=t,r},e}(Qc);eu$1.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),qh.mergeOptions({layerSwitcherControl:!1}),qh.addOnLoadHook((function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new eu$1(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))}));var nu$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=Eo$2("div"),n=this.mapContainer=Eo$2("div");n.style.width=t[0]+"px",n.style.height=t[1]+"px",n.className=this.options.containerClass;var i=this.button=Eo$2("div");return i.className=this.options.buttonClass,e.appendChild(n),e.appendChild(i),e},n.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),Xo$3(this.button,"click",this._onButtonClick,this),this._updateButtonText()},n.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),Jo$2(this.button,"click",this._onButtonClick)},n.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},n.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width="0px",t.style.height="0px",this},n.getOverviewMap=function(){return this._overview},n._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},n._updateButtonText=function(){this.button.innerHTML=this._overview?"-":"+"},n._createOverview=function(){var t=this.getMap(),e=this.mapContainer,n=t.config();kn$3(n,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new qh(e,n),this._updateBaseLayer(),this._perspective=new ll(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new Zl("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},n._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),n=t.getMinZoom(),i=this.options.level;if(i>0){for(var r=i;r>0;r--)if(e-r>=n)return e-r}else for(var o=i;o<0;o++)if(e-o>=n)return e-o;return e},n._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},n._getPerspectiveCoords=function(){var t=this.getMap(),e=t.getProjection();return t.getContainerExtent().toArray().map((function(n){if(e){var i=t._containerPointToPrj(n);return t._fixPrjOnWorldWide(i),e.unproject(i)}return t.containerPointToCoordinate(n)}))},n._update=function(){if(this._overview){jo$3(this._overview._containerDOM);var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},n._updateSpatialReference=function(){if(this._overview){var t=this.getMap();this._overview.setSpatialReference(t.options.spatialReference)}},n._updateBaseLayer=function(){if(this._overview){var t=this.getMap().getBaseLayer();if(t){var e=t.layers,n=0;if(e)for(var i=0,r=e.length;i<r;i++)if(e[i].isVisible()){n=i;break}var o=t.toJSON(),s=null;e?(s=o.layers[n].options).visible=!0:s=o.options,this._overview.setMinZoom(s.minZoom||null).setMaxZoom(s.maxZoom||null),delete s.minZoom,delete s.maxZoom,delete o.options.canvas,o.options.visible=!0,o.options.renderer="canvas";var a=Fh.fromJSON(o);for(var h in t)Hn$3(t[h])&&t.hasOwnProperty(h)&&t[h]!==t.constructor.prototype[h]&&(a[h]=t[h]);this._overview.setBaseLayer(a)}else this._overview.setBaseLayer(null)}},e}(Qc);nu$1.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),qh.mergeOptions({overviewControl:!1}),qh.addOnLoadHook((function(){this.options.overviewControl&&(this.overviewControl=new nu$1(this.options.overviewControl),this.addControl(this.overviewControl))})),function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.buildOn=function(){var t;if(this.options.custom)jn$3(this.options.content)?(t=Eo$2("div")).innerHTML=this.options.content:t=this.options.content;else{if(t=Eo$2("div","maptalks-panel"),this.options.closeButton){var e=Eo$2("a","maptalks-close");e.href="javascript:;",e.onclick=function(){t.style.display="none"},t.appendChild(e)}var n=Eo$2("div","maptalks-panel-content");n.innerHTML=this.options.content,t.appendChild(n)}return this.draggable=new vs$1(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},n.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),Qc.prototype.update.call(this)},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},n.getContent=function(){return this.options.content},n._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},n._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=kn$3({},this.getPosition()),this.fire("dragstart",t)},n._onDragging=function(t){var e=t.mousePos.sub(this._startPos),n=this._startPosition,i=this.getPosition();Dn$3(i.top)||(i.top=parseInt(n.top)+e.y),Dn$3(i.bottom)||(i.bottom=parseInt(n.bottom)-e.y),Dn$3(i.left)||(i.left=parseInt(n.left)+e.x),Dn$3(i.right)||(i.right=parseInt(n.right)-e.x),this.setPosition(i),this.fire("dragging",t)},n._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},n._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),n=this.getDOM(),i=parseInt(n.clientWidth),r=parseInt(n.clientHeight);return[t.containerPointToCoordinate(e.add(i/2,0)),t.containerPointToCoordinate(e.add(i,r/2)),t.containerPointToCoordinate(e.add(i/2,r)),t.containerPointToCoordinate(e.add(0,r/2))]},e}(Qc).mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var iu$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.buildOn=function(t){return this._map=t,this._scaleContainer=Eo$2("div",this.options.containerClass),this._addScales(),t.on("zoomend",this._update,this),this._map._loaded&&this._update(),this._scaleContainer},n.onRemove=function(){this.getMap().off("zoomend",this._update,this)},n._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=Oo$2("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=Oo$2("div",this.options.containerClass?null:t,this._scaleContainer))},n._update=function(){var t=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(t)},n._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},n._updateMetric=function(t){var e=this._getRoundNum(t);this._updateScale(this._mScale,e<1e3?e+" m":e/1e3+" km",e/t)},n._updateImperial=function(t){var e,n,i,r=3.2808399*t;r>5280?(n=this._getRoundNum(e=r/5280),this._updateScale(this._iScale,n+" mile",n/e)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" feet",i/r))},n._updateScale=function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},n._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)},e}(Qc);iu$1.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),qh.mergeOptions({scaleControl:!1}),qh.addOnLoadHook((function(){this.options.scaleControl&&(this.scaleControl=new iu$1(this.options.scaleControl),this.addControl(this.scaleControl))})),function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.buildOn=function(t){this._map=t;var e=Eo$2("div"),n=Eo$2("ul","maptalks-toolbar-hx");e.appendChild(n),Go$3(e,this.options.vertical?"maptalks-toolbar-vertical":"maptalks-toolbar-horizonal");var i=this;function r(t,e,n,r){var o=i._getItems()[e];return function(i){return zo$3(i),t({target:o,index:e,childIndex:n,dom:r})}}var o=this.options.items;if(Ji$4(o))for(var s=0,a=o.length;s<a;s++){var h=o[s],l=Eo$2("li");if(28!==this.options.height&&(l.style.lineHeight=this.options.height+"px"),l.style.height=this.options.height+"px",l.style.cursor="pointer",/<[a-z\][\s\S]*>/i.test(h.item)){l.style.textAlign="center";var c=Uo$2("div",h.item);l.innerHTML='<div style="margin-top:'+(this.options.height-c.height)/2+'px;">'+h.item+"</div>"}else l.innerHTML=h.item;if(h.click&&Xo$3(l,"click",r(h.click,s,null,l)),Ji$4(h.children)){var u=this._createDropMenu(s);l.appendChild(u),l._menu=u,Xo$3(l,"mouseover",(function(){this._menu.style.display=""})),Xo$3(l,"mouseout",(function(){this._menu.style.display="none"}))}n.appendChild(l)}return e},n._createDropMenu=function(t){var e=this;function n(t,n,i){var r=e._getItems()[n].children[i];return function(e){return zo$3(e),t({target:r,index:n,childIndex:i})}}var i=Eo$2("div","maptalks-dropMenu"),r=this._getItems(),o=r.length,s=Eo$2("ul"),a=r[t].children;t===o-1&&a&&(i.style.cssText="right: 0px;",s.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(s.style.bottom=0)),i.appendChild(Eo$2("em","maptalks-ico"));for(var h=0,l=0,c=a.length;l<c;l++){var u=io$3(a[l].item,"12px");u.width>h&&(h=u.width)}for(var f=0,d=a.length;f<d;f++){var m=a[f],g=Eo$2("li");g.innerHTML='<a href="javascript:;">'+m.item+"</a>",g.style.cursor="pointer",g.style.width=h+24+"px",Xo$3(g.childNodes[0],"click",n(m.click,t,f)),s.appendChild(g)}if(this.options.vertical){var p=h<95?95:h;this.options.reverseMenu?i.style.right=-(p+20)+"px":i.style.left=-(p+20)+"px"}else this.options.reverseMenu?i.style.bottom="28px":i.style.top="28px";return i.appendChild(s),i.style.display="none",i},n._getItems=function(){return this.options.items||[]},e}(Qc).mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:{}});var ru$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.buildOn=function(t){var e=this.options,n=Eo$2("div","maptalks-zoom");if(e.zoomLevel){var i=Eo$2("span","maptalks-zoom-zoomlevel");n.appendChild(i),this._levelDOM=i}var r=Eo$2("div","maptalks-zoom-slider"),o=Eo$2("a","maptalks-zoom-zoomin");if(o.href="javascript:;",o.innerHTML="+",r.appendChild(o),this._zoomInButton=o,e.slider){var s=Eo$2("div","maptalks-zoom-slider-box"),a=Eo$2("div","maptalks-zoom-slider-ruler"),h=Eo$2("span","maptalks-zoom-slider-reading"),l=Eo$2("span","maptalks-zoom-slider-dot");a.appendChild(h),s.appendChild(a),s.appendChild(l),r.appendChild(s),this._sliderBox=s,this._sliderRuler=a,this._sliderReading=h,this._sliderDot=l}var c=Eo$2("a","maptalks-zoom-zoomout");return c.href="javascript:;",c.innerHTML="-",r.appendChild(c),this._zoomOutButton=c,n.appendChild(r),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),n},n.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._zoomInButton&&Jo$2(this._zoomInButton,"click",this._onZoomInClick),this._zoomOutButton&&Jo$2(this._zoomOutButton,"click",this._onZoomOutClick),this._sliderRuler&&(Jo$2(this._sliderRuler,"click",this._onClickRuler),this.dotDragger.disable(),delete this.dotDragger)},n._update=function(){var t=this.getMap();if(this._sliderBox){var e=10*(t.getMaxZoom()-t.getMinZoom());this._sliderBox.style.height=e+16+"px",this._sliderRuler.style.height=e+8+"px",this._sliderRuler.style.cursor="pointer";var n=10*(t.getMaxZoom()-t.getZoom());this._sliderReading.style.height=10*(t.getZoom()-t.getMinZoom()+1)+"px",this._sliderDot.style.top=n+"px"}this._updateText()},n._updateText=function(){if(this._levelDOM){var t=this.getMap().getZoom();zn$3(t)||(t=Math.floor(10*t)/10),this._levelDOM.innerHTML=t}},n._registerDomEvents=function(){this._zoomInButton&&Xo$3(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&Xo$3(this._zoomOutButton,"click",this._onZoomOutClick,this),this._sliderRuler&&(Xo$3(this._sliderRuler,"click",this._onClickRuler,this),this.dotDragger=new vs$1(this._sliderDot,{ignoreMouseleave:!0}),this.dotDragger.on("dragstart",this._onDotDragstart,this).on("dragging dragend",this._onDotDrag,this).enable())},n._onZoomInClick=function(t){Lo$2(t),this.getMap().zoomIn()},n._onZoomOutClick=function(t){Lo$2(t),this.getMap().zoomOut()},n._onClickRuler=function(t){Lo$2(t);var e=this.getMap(),n=Ho$3(t,this._sliderRuler).y,i=e.getMaxZoom(),r=Math.floor(i-n/10);e.setZoom(r)},n._onDotDragstart=function(t){Lo$2(t.domEvent);var e=this.getMap(),n=e.getSize().toPoint()._multi(.5);e.onZoomStart(e.getZoom(),n)},n._onDotDrag=function(t){Lo$2(t.domEvent);var e=this.getMap(),n=e.getSize().toPoint()._multi(.5),i=Ho$3(t.domEvent,this._sliderRuler),r=e.getMaxZoom(),o=e.getMinZoom(),s=i.y,a=r-s/10;r<a?(a=r,s=0):o>a&&(a=o,s=10*(r-o)),"dragging"===t.type?e.onZooming(a,n,1):"dragend"===t.type&&e.onZoomEnd(this.options.seamless?a:Math.round(a),n),this._sliderDot.style.top=s+"px",this._sliderReading.style.height=10*(e.getZoom()-o+1)+"px",this._updateText()},e}(Qc);ru$1.mergeOptions({position:"top-left",slider:!0,zoomLevel:!0,seamless:!1}),qh.mergeOptions({zoomControl:!1}),qh.addOnLoadHook((function(){this.options.zoomControl&&(this.zoomControl=new ru$1(this.options.zoomControl),this.addControl(this.zoomControl))}));var ou$1=function(){function t(t,e,n,i){Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:e},this.origin={x:n,y:i})}return t.getDefault=function(t){return"baidu"===t.code.toLowerCase()?"baidu":t.code.toLowerCase()==="EPSG:4326".toLowerCase()?"tms-global-geodetic":"identity"===t.code.toLowerCase()?[1,-1,0,0]:"web-mercator"},t}(),su$1=6378137*Math.PI;kn$3(ou$1,{"web-mercator":new ou$1([1,-1,-su$1,su$1]),"tms-global-mercator":new ou$1([1,1,-su$1,-su$1]),"tms-global-geodetic":new ou$1([1,1,-180,-90]),baidu:new ou$1([1,1,0,0])});var au$1=function(){function t(t,e,n,i){this.map=t,this.tileSize=i,this.fullExtent=n,this.prepareTileInfo(e,n),this._xScale=n.right>=n.left?1:-1,this._yScale=n.top>=n.bottom?1:-1;var r=t.getGLRes();this._pointOrigin=t._prjToPointAtRes(new Ii$4(this.tileSystem.origin),r),this._glRes=r}var e=t.prototype;return e.prepareTileInfo=function(t,e){if(jn$3(t)?t=ou$1[t.toLowerCase()]:Array.isArray(t)&&(t=new ou$1(t)),!t)throw new Error("Invalid TileSystem");this.tileSystem=t,this.transformation=new zs$1([e.right>e.left?1:-1,e.top>e.bottom?-1:1,t.origin.x,t.origin.y])},e._getTileNum=function(t,e){var n=this.tileSystem,i=this.tileSize,r=Math.floor(1e-7*n.scale.x+t.x/(i.width*e)),o=Math.ceil(1e-7*n.scale.y+t.y/(i.height*e));return{x:n.scale.x*r,y:n.scale.y*o}},e.getTileIndex=function(t,e,n){var i=this.tileSystem,r=this.transformation.transform(t,1),o=this._getTileNum(r,e);return i.scale.x<0&&(o.x-=1),i.scale.y>0&&(o.y-=1),this.getNeighorTileIndex(o.x,o.y,0,0,e,n)},e.getNeighorTileIndex=function(t,e,n,i,r,o){var s=this.tileSystem,a=t+s.scale.x*n,h=e-s.scale.y*i,l=!1,c=a,u=h,f=this._getTileFullIndex(r);return o&&(!0!==o&&"x"!==o||(f.xmax===f.xmin?a=f.xmin:a<f.xmin?(a=f.xmax-(f.xmin-a)%(f.xmax-f.xmin))===f.xmax&&(a=f.xmin):a>=f.xmax&&(a=f.xmin+(a-f.xmin)%(f.xmax-f.xmin))),!0!==o&&"y"!==o||(f.ymax===f.ymin?h=f.ymin:h>=f.ymax?h=f.ymin+(h-f.ymin)%(f.ymax-f.ymin):h<f.ymin&&(h=f.ymax-(f.ymin-h)%(f.ymax-f.ymin))===f.ymax&&(h=f.ymin))),(a<f.xmin||a>f.xmax||h>f.ymax||h<f.ymin)&&(l=!0),{x:a,y:h,idx:c,idy:u,out:l}},e._getTileFullIndex=function(t){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[t])return this._tileFullIndex[t];var e=this.fullExtent,n=this.transformation,i=this._getTileNum(n.transform(new ys$1(e.left,e.top),1),t),r=this._getTileNum(n.transform(new ys$1(e.right,e.bottom),1),t),o=this.tileSystem;return o.scale.x<0&&(i.x-=1,r.x-=1),o.scale.y>0&&(i.y-=1,r.y-=1),this._tileFullIndex[t]=new ks$1(i,r),this._tileFullIndex[t]},e.getTilePrjNW=function(t,e,n){var i=this.tileSystem,r=this.tileSize;return new ys$1(i.origin.x+this._xScale*i.scale.x*(t+(1===i.scale.x?0:1))*n*r.width,i.origin.y+this._yScale*i.scale.y*(e+(1===i.scale.y?1:0))*n*r.height)},e.getTilePointNW=function(t,e,n){var i=this._glRes/n,r=this.tileSystem,o=this.tileSize;return new Ii$4(this._pointOrigin.x*i+this._xScale*r.scale.x*(t+(1===r.scale.x?0:1))*o.width,this._pointOrigin.y*i+this._yScale*r.scale.y*(e+(1===r.scale.y?1:0))*o.height)},e.getTilePrjSE=function(t,e,n){var i=this.tileSystem,r=this.tileSize;return new ys$1(i.origin.x+this._xScale*i.scale.x*(t+(1===i.scale.x?1:0))*n*r.width,i.origin.y+this._yScale*i.scale.y*(e+(1===i.scale.y?0:1))*n*r.height)},e.getTilePointSE=function(t,e,n){var i=this._glRes/n,r=this.tileSystem,o=this.tileSize;return new Ii$4(this._pointOrigin.x*i+this._xScale*r.scale.x*(t+(1===r.scale.x?1:0))*o.width,this._pointOrigin.y*i+this._yScale*r.scale.y*(e+(1===r.scale.y?0:1))*o.height)},e.getTilePrjExtent=function(t,e,n){var i=this.getTilePrjNW(t,e,n),r=this.getTilePrjSE(t,e,n);return new ks$1(i,r)},t}(),hu$1=new Ii$4(0,0),lu$1="undefined"!=typeof Set,cu$1=function(){function t(){this._table=lu$1?new Set:{}}var e=t.prototype;return e.add=function(t){lu$1?this._table.add(t):this._table[t]=!0},e.has=function(t){return lu$1?this._table.has(t):this._table[t]},e.reset=function(){lu$1?this._table.clear():this._table={}},t}(),uu$1={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,backgroundZoomDiff:6,loadingLimitOnInteracting:3,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!Un$3,debug:!1,spatialReference:null,maxCacheSize:256,renderer:Si$4.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,backZoomOffset:0},fu$1=/\{ *([\w_]+) *\}/g,du$1=new Ii$4(0,0),mu$1=new Ii$4(0,0),gu$1=new Ii$4(0,0),pu$1=new Ii$4(0,0),_u$1=new Ii$4(0,0),vu$1=new Ii$4(0,0),yu$1=[[0,0,0],[0,0,0]],xu$1=[0,0,0],bu$1=[0,0,0],wu$1=[],Cu$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t),e.fromJSON=function(t){return t&&"TileLayer"===t.type?new e(t.id,t.options):null};var n=e.prototype;return n.forceReload=function(){return this.clear(),this.load(),this},n.getTileSize=function(){if(this._tileSize)return this._tileSize;var t=this.options.tileSize;return Ln$3(t)&&(t=[t,t]),this._tileSize=new Yr$4(t),this._tileSize},n.getTiles=function(t,e){return this._coordCache={},this._isPyramidMode()?this._getPyramidTiles(t,e):this._getCascadeTiles(t,e)},n._isPyramidMode=function(){var t=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&t&&t.isPyramid()},n._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var t=this.getSpatialReference(),e=t.getFullExtent(),n=t.getResolution(0),i=this.getMap();return this._tileFullExtent=e.convertTo((function(t){return i._prjToPointAtRes(t,n,hu$1)})),this._tileFullExtent},n._getRootNodes=function(t){var e=this.getMap();if(this._rootNodes){var n=this._rootNodes,i=n.tiles;if(e.width!==n.mapWidth||e.height!==n.mapHeight){for(var r=this._getRootError(),o=0;o<i.length;o++)i[o].error=r;this._rootNodes.mapWidth=e.width,this._rootNodes.mapHeight=e.height}for(var s=0;s<i.length;s++)i[s].offset[0]=t[0],i[s].offset[1]=t[1];return this._rootNodes}var a=this.getSpatialReference(),h=a.getResolution(0),l=this._getTileConfig(),c=a.getFullExtent(),u=l.tileSystem,f=u.origin,d=u.scale,m=l.getTilePrjExtent(0,0,h),g=m.getWidth(),p=m.getHeight(),_=Math.abs((f.x-c.left)/g);_=Math.ceil(_-1e-5);var v=Math.abs((c.right-f.x)/g);v=Math.ceil(v-1e-5);var y=Math.ceil(Math.abs(c.top-f.y)/p);y=Math.ceil(y-1e-5);var x=Math.ceil(Math.abs(c.bottom-f.y)/p);if((v+_)*((x=Math.ceil(x-1e-5))+y)>32)return{status:0,error:"Too many root nodes"};for(var b=this._getRootError(),w=[],C=-_;C<v;C++)for(var M=-y;M<x;M++){var T=d.y<0?M:-(M+1);w.push({x:C,y:T,z:0,idx:C,idy:T,res:h,extent2d:l.getTilePrjExtent(C,T,h).convertTo((function(t){return e._prjToPointAtRes(t,h,hu$1)})),id:this._getTileId(C,T,0),url:this.getTileUrl(C,T,0+this.options.zoomOffset),offset:[0,0],error:b,children:[]})}return this._rootNodes={status:1,tiles:w,mapWidth:e.width,mapHeight:e.height},this._getRootNodes(t)},n._getRootError=function(){var t=this.getMap(),e=Vn$3(t.getFov()),n=t.width/t.height,i=t.cameraPosition[2],r=i*Math.tan(.5*e),o=r*n,s=Math.sqrt(i*i+r*r+o*o);return t._getFovZ(0)*(s/i)*this.getSpatialReference().getResolution(0)/t.getResolution(0)},n._getPyramidTiles=function(t,e){var n=this.getMap();isNaN(+t)&&(t=this._getTileZoom(n.getZoom()));var i,r=this.getSpatialReference(),o=Math.min(t,this.getMaxZoom()),s=n.projViewMatrix,a=this._getTileFullExtent(),h=this._getTileOffset(0);if(this.options.repeatWorld){var l=n.getContainerExtent(),c=this._convertToExtent2d(l),u=r.getResolution(0)/n.getResolution();if(c.within(a.copy()._scale(u))){var f=this._getRootNodes(h);if(1!==f.status)return console.warn(f.error),this._disablePyramid=!0,this.getTiles(t,e);i=f.tiles.concat()}else{var d=n.getPitch(),m=n.options.cascadePitches[1],g=Math.floor(n._getVisualHeight(m)),p=d<=m?l:new Ls$1(0,n.height-g,n.width,n.height);this._visitedTiles=new cu$1;var _=this._getTiles(0,p,2,e&&e.getRenderer(),!0),v=this._getRootError();_.tiles.forEach((function(t){t.error=v})),i=_.tiles}}else{var y=this._getRootNodes(h);if(1!==y.status)return console.warn(y.error),this._disablePyramid=!0,this.getTiles(t,e);i=y.tiles.concat()}for(var x=n.getGLRes(),b={0:h},w=this.options.backZoomOffset+t,C=new Ls$1,M=[];i.length>0;){var T=i.pop();T.z!==o?(b[T.z+1]||(b[T.z+1]=this._getTileOffset(T.z+1)),this._splitNode(T,s,i,M,C,o,b[T.z+1],e&&e.getRenderer(),x),w<t&&M[M.length-1]!==T&&w===T.z&&M.push(T)):(C._combine(T.extent2d),M.push(T))}return{tileGrids:[{extent:C,count:M.length,tiles:M,offset:[0,0],zoom:t}],count:M.length}},n._splitNode=function(t,e,n,i,r,o,s,a,h){for(var l=this._getTileConfig().tileSystem.scale.y,c=t.z+1,u=this.getSpatialReference(),f=t.x,d=t.y,m=t.extent2d,g=t.idx,p=t.idy,_=m.getWidth()/2*2,v=m.getHeight()/2*2,y=2*m.xmin,x=2*m.ymax,b=2*m.ymin,w=a||this.getRenderer(),C=!1,M=[],T=u.getResolution(c),S=T/h,P=0;P<4;P++){var A=P%2,E=P>>1,O=(f<<1)+A,R=(d<<1)+E,I=(g<<1)+A,k=(p<<1)+E;t.children||(t.children=[]);var D=t.children[P];D||(D=this._getTileId(I,k,c),t.children[P]=D);var L=w.isTileCachedOrLoading(D),z=void 0,F=L&&L.info;if(!F){if(this.tileInfoCache||(this.tileInfoCache=new Qo$2(4*this.options.maxCacheSize)),!(F=this.tileInfoCache.get(D))){if(l<0){var j=y+A*_,H=x-E*v;z=new Ls$1(j,H-v,j+_,H)}else{var N=y+A*_,B=b+E*v;z=new Ls$1(N,B,N+_,B+v)}F={x:O,y:R,idx:I,idy:k,z:c,extent2d:z,error:t.error/2,res:T,id:D,parentNodeId:t.id,children:[],url:this.getTileUrl(O,R,c+this.options.zoomOffset),offset:s},this.tileInfoCache.add(D,F)}a&&(F.layer=this.getId())}F.error=t.error/2,F.offset[0]=s[0],F.offset[1]=s[1];var G=this._isTileVisible(F,e,S,o,s);if(1===G)C=!0;else{if(-1===G)continue;if(0===G&&c!==o)return i.push(t),void r._combine(t.extent2d)}M.push(F)}c===o?C?n.push.apply(n,M):(i.push(t),r._combine(t.extent2d)):n.push.apply(n,M)},n._isTileVisible=function(t,e,n,i,r){if(0===t.z)return 1;if(!this._isTileInFrustum(t,e,n,r))return-1;var o=this.options.maxError;return Dn$3(o)&&(o=1),this._getScreenSpaceError(t,n,i,r)>=o?1:0},n._isTileInFrustum=function(t,e,n,i){if(!this._zScale){var r=this.getMap(),o=r.getGLRes();this._zScale=r.altitudeToPoint(100,o)/100}var s=t.extent2d,a=s.ymin,h=s.xmax,l=s.ymax;return yu$1[0][0]=(s.xmin-i[0])*n,yu$1[0][1]=(a-i[1])*n,yu$1[0][2]=(t.minAltitude||0)*this._zScale,yu$1[1][0]=(h-i[0])*n,yu$1[1][1]=(l-i[1])*n,yu$1[1][2]=(t.maxAltitude||0)*this._zScale,Cn$3(e,yu$1)},n._getScreenSpaceError=function(t,e,n,i){var r=t.error,o=this.getMap(),s=t.extent2d,a=s.ymin,h=s.xmax,l=s.ymax;xu$1[0]=(s.xmin-i[0])*e,xu$1[1]=(a-i[1])*e,bu$1[0]=(h-i[0])*e,bu$1[1]=(l-i[1])*e;var c,u,f,d,m,g,p=(c=xu$1,u=bu$1,f=o.cameraPosition,d=Math.max(c[0]-f[0],0,f[0]-u[0]),m=Math.max(c[1]-f[1],0,f[1]-u[1]),g=Math.max(c[2]-f[2],0,f[2]-u[2]),Math.sqrt(d*d+m*m+g*g)),_=Math.max(Math.abs(p),1e-7),v=Math.abs(t.z-n);return r*(o.height<1e3||v<=1?1:v<=2?.7:.605)/_},n._getCascadeTiles=function(t,e){var n=this.getMap(),i=n.getPitch(),r=e&&e.getRenderer(),o=n.getContainerExtent(),s=[],a=0,h=this.getMinZoom(),l=n.options.cascadePitches[0],c=n.options.cascadePitches[1],u=Math.floor(n._getVisualHeight(c)),f=Dn$3(t)?this._getTileZoom(n.getZoom()):t;if(this._visitedTiles=new cu$1,!Dn$3(t)||!this.options.cascadeTiles||i<=l||!Dn$3(h)&&f<=h){var d=i<=c?o:new Ls$1(0,n.height-u,n.width,n.height),m=this._getTiles(f,d,2,r);return m&&(a+=m.tiles.length,s.push(m)),{tileGrids:s,count:a}}var g=Math.floor(n._getVisualHeight(l)),p=new Ls$1(0,n.height-g,n.width,n.height),_=this._getTiles(f,p,0,r);a+=_?_.tiles.length:0,s.push(_);var v,y,x=p.ymin,b=n.getSpatialReference().getZoomDirection(),w=b;if(i>c){f-w<=h&&(w=0);var C=new Ls$1(0,n.height-u,n.width,x);a+=(v=this._getTiles(f-w,C,1,r))?v.tiles.length:0,x=C.ymin,w+=4*b,s.push(v)}if(f-w>=h){var M=new Ls$1(0,o.ymin,n.width,x);a+=(y=this._getTiles(f-w,M,2,r))?y.tiles.length:0,s.push(y)}return v&&y&&(s[1]=y,s[2]=v),{tileGrids:s,count:a}},n.getTileUrl=function(t,e,n){var i=this.options.urlTemplate,r="";if(this.options.subdomains){var o=this.options.subdomains;if(Ji$4(o)){var s=(t+e)%o.length;s<0&&(s=0),r=o[s]}}if(Hn$3(i))return i(t,e,n,r);var a={x:t,y:e,z:n,s:r};return this.options.token&&(a.token=this.options.token),this.options.customTags&&kn$3(a,this.options.customTags),i.replace(fu$1,(function(t,e){var n=a[e];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(a)),n}))},n.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},n.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},n.getSpatialReference=function(){var t=this.getMap();if(t&&(!this.options.spatialReference||Eh.equals(this.options.spatialReference,t.options.spatialReference)))return t.getSpatialReference();if(this._sr)return this._sr;var e=this.options.spatialReference;if(jn$3(e)&&!(e=Eh.getPreset(e)))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+Eh.getAllPresets().join());return this._sr=new Eh(e),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==t.getSpatialReference().toJSON().projection,this._sr},n.getMinZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(t.prototype.getMinZoom.call(this),this._srMinZoom):t.prototype.getMinZoom.call(this)},n.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(t.prototype.getMaxZoom.call(this),this._srMaxZoom):t.prototype.getMaxZoom.call(this)},n._getTileZoom=function(t){if(!this._hasOwnSR){var e=this.getMap().getResolution(t),n=this.getSpatialReference().getResolution(t);t+=Math.log(n/e)*Math.LOG2E}var i=this.options.maxAvailableZoom;return!Dn$3(i)&&t>i&&(t=i),zn$3(t)||(t=Math.round(t)),Math.max(0,t)},n._getTiles=function(t,e,n,i,r){var o=this.getMap(),s=t,a=o.projViewMatrix,h=o.getResolution(t)/o.getResolution(t-1)==.5;n<2&&(0===n&&h&&(s-=1),a=0===n?o.cascadeFrustumMatrix0:1===n?o.cascadeFrustumMatrix1:o.projViewMatrix);var l=s+this.options.zoomOffset,c=this._getTileOffset(l),u=c[0]||c[1],f={zoom:s,extent:null,offset:c,tiles:[]};if(l<0)return f;if(!(o&&this.isVisible()&&o.width&&o.height))return f;if(!r){var d=this.getMinZoom(),m=this.getMaxZoom();if(!Dn$3(d)&&s<d||!Dn$3(m)&&s>m)return f}var g=this._getTileConfig();if(!g)return f;var p,_={zoom:c},v=this.getSpatialReference().getResolution(l);p=this._hasOwnSR?o.getGLScale(s):v/o.getGLRes();var y=!this._hasOwnSR&&this.options.repeatWorld,x=this._convertToExtent2d(e),b=this._getMask2DExtent();if(b){var w=b.intersection(x);if(!w)return f;e=w.convertTo((function(t){return o._pointToContainerPoint(t,void 0,0,hu$1)}))}var C,M=o._containerPointToPrj(e.getCenter(),du$1),T=o._prjToPoint(M,l,mu$1);C=this._project(u?o._pointToPrj(T._add(c),l,mu$1):M,mu$1);var S=o.getGLScale()/o.getGLScale(l);gu$1.x=x.xmin*S,gu$1.y=x.ymax*S,pu$1.x=x.xmax*S,pu$1.y=x.ymin*S;for(var P=this._project(o._pointToPrj(gu$1._add(c),l,gu$1),gu$1),A=this._project(o._pointToPrj(pu$1._add(c),l,pu$1),pu$1),E=g.getTileIndex(C,v,y),O=g.getTileIndex(P,v,y),R=g.getTileIndex(A,v,y),I=Math.ceil(Math.abs(E.idy-O.idy)),k=Math.ceil(Math.abs(E.idx-O.idx)),D=Math.ceil(Math.abs(E.idy-R.idy)),L=Math.ceil(Math.abs(E.idx-R.idx)),z=(I+D+1)*(k+L+1),F=this.getTileSize(),j=this.getRenderer()||i,H=this._getTileConfig().tileSystem.scale,N=[],B=new Ls$1,G=new Ii$4(0,0),V=-I;V<=D;V++)for(var W=-k,U=-1/0,Z=!1;W>=U&&W<=L;){var X=g.getNeighorTileIndex(E.idx,E.idy,W,V,v,y);U===-1/0?W++:W--;var J=this._getTileId(X.idx,X.idy,s);if(!(X.out||this._visitedTiles&&this._visitedTiles.has(J))){var q=j&&j.isTileCachedOrLoading(J);q&&(q=q.info);var Y=void 0;if(q){var K=q.extent2d;G.set(K.xmin,K.ymax),Y=G}else if(this._hasOwnSR){var Q=g.getTilePrjNW(X.x,X.y,v);Y=o._prjToPoint(this._unproject(Q,pu$1),s)}else Y=g.getTilePointNW(X.x,X.y,v);var $=void 0,tt=void 0;if(this._hasOwnSR){var et=void 0;if(this._hasOwnSR){var nt=g.getTilePrjSE(X.x,X.y,v);et=o._prjToPoint(this._unproject(nt,pu$1),s,pu$1)}else et=g.getTilePointSE(X.x,X.y,v);$=Math.ceil(Math.abs(et.x-Y.x)),tt=Math.ceil(Math.abs(et.y-Y.y))}else $=F.width,tt=F.height;var it=H.x*(X.idx-X.x)*$,rt=H.y*(X.idy-X.y)*tt;q||!it&&!rt||Y._add(it,rt);var ot=q&&q.extent2d||new Ls$1(Y.x,Y.y-tt,Y.x+$,Y.y);if(z<=4||Z||this._isTileInExtent(a,ot,c,p)){var st=this._hasOwnSR?o._getResolution(s):v;this._visitedTiles&&0===n&&this._visitedTiles.add(J),h&&0===n?(this._splitTiles(a,N,j,X,s+1,st,ot,it,rt,_,i),B._combine(ot)):(q?(q.offset[0]=c[0],q.offset[1]=c[1]):(q={z:s,x:X.x,y:X.y,idx:X.idx,idy:X.idy,extent2d:ot,offset:c,id:J,res:st,url:this.getTileUrl(X.x,X.y,s)},i&&(q.layer=this.getId())),N.push(q),B._combine(ot)),U===-1/0?(U=W,W=L):Z||(Z=!0)}}}if(N.length){var at=o._containerPointToPoint(e.getCenter(),s,hu$1)._add(c),ht=new Ii$4(0,0),lt=new Ii$4(0,0);N.sort((function(t,e){return ht.set((t.extent2d.xmin+t.extent2d.xmax)/2,(t.extent2d.ymin+t.extent2d.ymax)/2),lt.set((e.extent2d.xmin+e.extent2d.xmax)/2,(e.extent2d.ymin+e.extent2d.ymax)/2),ht.distanceTo(at)-lt.distanceTo(at)}))}return{offset:c,zoom:t,extent:B,tiles:N}},n._convertToExtent2d=function(t){var e=this,n=this.getMap();return t.convertTo((function(t){if(t.y>0&&t.y<n.height){var i=(0===t.x?0:1)+t.y;e._coordCache[i]||(e._coordCache[i]=n._containerPointToPoint(t))}return n._containerPointToPoint(t,void 0,hu$1)}))},n._splitTiles=function(t,e,n,i,r,o,s,a,h,l,c){var u=this._getTileConfig().tileSystem.scale.y,f=this.getMap().getGLScale(r),d=_u$1.set(2*s.xmin,u<0?2*s.ymax:2*s.ymin),m=s.getWidth(),g=s.getHeight(),p=2*i.idx,_=2*i.idy,v=2*i.x,y=2*i.y,x=this._checkAndAddTile(t,n,p,_,v,y,r,o,0,0,m,g,d,f,l,c);x&&e.push(x),(x=this._checkAndAddTile(t,n,p,_,v,y,r,o,0,1,m,g,d,f,l,c))&&e.push(x),(x=this._checkAndAddTile(t,n,p,_,v,y,r,o,1,0,m,g,d,f,l,c))&&e.push(x),(x=this._checkAndAddTile(t,n,p,_,v,y,r,o,1,1,m,g,d,f,l,c))&&e.push(x)},n._checkAndAddTile=function(t,e,n,i,r,o,s,a,h,l,c,u,f,d,m,g){var p=this._getTileId(n+h,i+l,s);if(this._visitedTiles&&this._visitedTiles.has(p))return null;var _=m[s];_||(_=m[s]=this._getTileOffset(s));var v=this._getTileConfig().tileSystem.scale.y,y=new Ls$1(f.x+h*c,f.y+v*l*u,f.x+(h+1)*c,f.y+v*(l+1)*u);if(!this._isSplittedTileInExtent(t,y,_,d))return null;var x=a/2,b=e&&e.isTileCachedOrLoading(p);return b?b=b.info:(b={z:s,x:r+h,y:o+l,extent2d:y,id:p,offset:_,res:x,url:this.getTileUrl(r+h,o+l,s+this.options.zoomOffset)},g&&(b.layer=this.getId())),b},n._getTileOffset=function(t){var e=this.options.offset;return Hn$3(e)&&(e=e.call(this,t)),Ln$3(e)?[e,e]:e||[0,0]},n._getTileId=function(t,e,n,i){return(i||this.getId())+"_"+e+"_"+t+"_"+n},n._project=function(t,e){if(this._hasOwnSR){var n=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(n.unproject(t,e),e)}return t},n._unproject=function(t,e){if(this._hasOwnSR){var n=this.getMap(),i=this.getSpatialReference(),r=n.getProjection(),o=i.getProjection();return r.project(o.unproject(t,e),e)}return t},n._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),n=this.getSpatialReference(),i=n.getProjection(),r=n.getFullExtent();this._defaultTileConfig=new au$1(t,ou$1.getDefault(i),r,e),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new au$1(t,this.options.tileSystem,r,e)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},n._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},n._bindMap=function(e){var n=e.getBaseLayer();return n===this&&(n.options.hasOwnProperty("forceRenderOnMoving")||this.config({forceRenderOnMoving:!0})),this._onSpatialReferenceChange(),t.prototype._bindMap.apply(this,arguments)},n._isTileInExtent=function(t,e,n,i){var r,o=this.getMap();if(t!==o.projViewMatrix){var s=e.getCenter(vu$1)._sub(n[0],n[1])._multi(i);hc(wu$1,s.x,s.y,0),r=function(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(s=s||1),t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,t}(wu$1,wu$1,o.projViewMatrix)[1]<0?o.projViewMatrix:t}else r=o.projViewMatrix;return yu$1[0][0]=(e.xmin-n[0])*i,yu$1[0][1]=(e.ymin-n[1])*i,yu$1[1][0]=(e.xmax-n[0])*i,yu$1[1][1]=(e.ymax-n[1])*i,Cn$3(r,yu$1)},n._isSplittedTileInExtent=function(t,e,n,i){var r=this.getMap();return yu$1[0][0]=(e.xmin-n[0])*i,yu$1[0][1]=(e.ymin-n[1])*i,yu$1[1][0]=(e.xmax-n[0])*i,yu$1[1][1]=(e.ymax-n[1])*i,Cn$3(r.projViewMatrix,yu$1)},n.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},n._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var t=this.getRenderer();t&&t.clear()},n.getPolygonOffsetCount=function(){return 2},n.getPolygonOffset=function(){return this._polygonOffset||0},n.setPolygonOffset=function(t){return this._polygonOffset=t,this},e}(Fh);Cu$1.registerJSONType("TileLayer"),Cu$1.mergeOptions(uu$1);var Mu$1=new Yr$4(256,256),Tu$1="show hide remove";function Su$1(t){return Array.isArray(t)||(t=[t]),t}var Pu$1=function(t){function e(e,n,i){var r;return(r=t.call(this,e,i)||this).layers=n||[],r._checkChildren(),r.layerMap={},r._groupChildren=[],r}Pi$4(e,t),e.fromJSON=function(t){if(!t||"GroupTileLayer"!==t.type)return null;var n=t.layers.map((function(t){return Fh.fromJSON(t)}));return new e(t.id,n,t.options)};var n=e.prototype;return n.getLayers=function(){return this.layers},n.addLayer=function(t){var e=this;void 0===t&&(t=[]),t=Su$1(t);var n=this.layers.length;return t.forEach((function(t){t instanceof Cu$1&&(-1!==e.layers.indexOf(t)||e.layerMap[t.getId()]||e.layers.push(t))})),n!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},n.removeLayer=function(t){var e=this;void 0===t&&(t=[]),t=Su$1(t);var n=this.layers.length;return t.forEach((function(t){if(t instanceof Cu$1||(t=e.layerMap[t]),t instanceof Cu$1){var n=e.layers.indexOf(t);n>=0&&(e.layers.splice(n,1),t._doRemove(),t.off(Tu$1,e._onLayerShowHide,e))}})),n!==this.layers.length&&(this._refresh(),this._renderLayers()),this},n.clearLayers=function(){var t=this;return this.layers.forEach((function(e){e._doRemove(),e.off(Tu$1,t._onLayerShowHide,t)})),this.layers=[],this._refresh(),this._renderLayers(),this},n.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map((function(t){return t.toJSON()})),options:this.config()}},n.getTileSize=function(t){var e=this.getLayer(t);return e?e.getTileSize():Mu$1},n.getTiles=function(t,e){for(var n=this.layers,i=[],r=0,o=0,s=n.length;o<s;o++){var a=n[o];if(a&&a.options.visible&&a.isVisible()&&a.getMap()){var h=a.getTiles(t,e||this);h&&0!==h.count&&(r+=h.count,Hi$4(i,h.tileGrids))}}return{count:r,tileGrids:i}},n.onAdd=function(){this._sortLayers(),this._refresh(),t.prototype.onAdd.call(this)},n.onRemove=function(){var e=this;this.layers.forEach((function(t){t._doRemove(),t.off(Tu$1,e._onLayerShowHide,e)})),this.layerMap={},this._groupChildren=[],t.prototype.onRemove.call(this)},n.getLayer=function(t){return this.getChildLayer(t)},n.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var n=0;n<this._groupChildren.length;n++){var i=this._groupChildren[n].getChildLayer(t);if(i)return i}return null},n._onLayerShowHide=function(t){var e=t||{},n=e.target;return"remove"===e.type&&n&&(this.layers.splice(this.layers.indexOf(n),1),n._doRemove(),n.off(Tu$1,this._onLayerShowHide,this),this._refresh()),this._renderLayers(),this},n._renderLayers=function(){var t=this.getRenderer();return t&&t.setToRedraw(),this},n._refresh=function(){var t=this,e=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach((function(n){t.layerMap[n.getId()]=n,n.getChildLayer&&t._groupChildren.push(n),n.getMap()||n._bindMap(e),n.on(Tu$1,t._onLayerShowHide,t)})),this},n.isVisible=function(){if(!t.prototype.isVisible.call(this))return!1;for(var e=this.layers,n=0,i=e.length;n<i;n++)if(e[n].isVisible())return!0;return!1},n._checkChildren=function(){var t=this,e={};this.layers.forEach((function(n){var i=n.getId();if(e[i])throw new Error("Duplicate child layer id ("+i+") in the GroupTileLayer ("+t.getId()+")");e[i]=1}))},n._sortLayers=function(){this.layers.sort((function(t,e){return t.options.zIndex-e.options.zIndex}))},e}(Cu$1);Pu$1.registerJSONType("GroupTileLayer"),Pu$1.mergeOptions({maxCacheSize:1024});var Au$1,Eu$1={crs:null,uppercase:!1,detectRetina:!1},Ou$1={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},Ru$1=function(t){function e(e,n){var i;return i=t.call(this,e)||this,Au$1||(Au$1=kn$3({},i.options)),i.wmsParams=kn$3({},Ou$1),i.setOptions(n),i.setZIndex(n.zIndex),Si$4.proxy||i._optionsHook(n),i}Pi$4(e,t);var n=e.prototype;return n._optionsHook=function(t){for(var e in void 0===t&&(t={}),t)"tileSize"===e&&(this._tileSize=null),e in Au$1||(this.wmsParams[e]=t[e]);var n=this.getTileSize();return this.wmsParams.width=n.width,this.wmsParams.height=n.height,this._wmsVersion=parseFloat(this.wmsParams.version),this},n.onAdd=function(){var e=this.getMap().getDevicePixelRatio(),n=Eu$1.detectRetina?e:1;this.wmsParams.width*=n,this.wmsParams.height*=n;var i=this.options.crs||this.getMap().getProjection().code;this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=i,t.prototype.onAdd.call(this)},n.getTileUrl=function(e,n,i){var r=this.getSpatialReference().getResolution(i),o=this._getTileConfig().getTilePrjExtent(e,n,r),s=o.getMax(),a=o.getMin(),h=(this._wmsVersion>=1.3&&("EPSG:4326"===this.wmsParams.crs||"EPSG:4490"===this.wmsParams.crs)?[a.y,a.x,s.y,s.x]:[a.x,a.y,s.x,s.y]).join(","),l=t.prototype.getTileUrl.call(this,e,n,i);return l+function(t,e,n){var i=[];for(var r in t)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}(this.wmsParams,l,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},n.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"WMSTileLayer"===t.type?new e(t.id,t.options):null},e}(Cu$1);Ru$1.registerJSONType("WMSTileLayer"),Ru$1.mergeOptions(Eu$1);var Iu$1=function(t){function e(e,n){var i;return(i=t.call(this,e,n)||this).options.hasOwnProperty("forceRenderOnMoving")||(i.options.forceRenderOnMoving=!1),i}Pi$4(e,t);var n=e.prototype;return n.drawTile=function(){},n.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"CanvasTileLayer"===t.type?new e(t.id,t.options):null},e}(Cu$1);function ku$1(t,e,n){var i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(i);throw t.deleteShader(i),new Error("Failed to compile shader: "+r)}return i}Iu$1.registerJSONType("CanvasTileLayer");var ju$1=[0,0],Hu$1=[0,0,0],Nu$1=new Array(16),Bu$1=new Ii$4(20,20),Gu$1=function(t){var e,n=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.drawGLImage=function(t,e,n,i,r,o,s,a){this.gl.program!==this.program&&this.useProgram(this.program);var h=this.gl;if(this.loadTexture(t),this.canvas.gl&&this.canvas.gl.wrap){var l=this.layer&&this.layer.options.opacity;Dn$3(l)&&(l=1),s*=l}Hu$1[0]=e||0,Hu$1[1]=n||0;var c=sc(Nu$1);nc(c,c,Hu$1),ic(c,c,[o,o,1]),rc(c,this.getMap().projViewMatrix,c),h.uniformMatrix4fv(this.program.u_matrix,!1,c),h.uniform1f(this.program.u_opacity,s),h.uniform1f(this.program.u_debug_line,0);var u=t.glBuffer;!u||u.width===i&&u.height===r||(this.saveImageBuffer(u),delete t.glBuffer),t.glBuffer?h.bindBuffer(h.ARRAY_BUFFER,u):t.glBuffer=this.bufferTileData(0,0,i,r),ju$1[0]="a_position",ju$1[1]=2,ju$1[2]=t.glBuffer.type,this.enableVertexAttrib(ju$1),h.drawArrays(h.TRIANGLE_STRIP,0,4),a&&this.drawDebug(c,0,0,i,r,a)},n.drawDebug=function(t,e,n,i,r,o){var s=this.gl;s.disable(s.DEPTH_TEST),s.bindBuffer(s.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),s.bufferData(s.ARRAY_BUFFER,new Float32Array([e,n,e+i,n,e+i,n-r,e,n-r,e,n]),s.DYNAMIC_DRAW),s.uniformMatrix4fv(this.program.u_matrix,!1,t),s.uniform1f(this.program.u_opacity,1),s.uniform1f(this.program.u_debug_line,1),s.drawArrays(s.LINE_STRIP,0,5);var a=this._debugInfoCanvas;if(!a){var h=this.getMap().getDevicePixelRatio()>1?2:1;(a=this._debugInfoCanvas=document.createElement("canvas")).width=256*h,a.height=32*h;var l=a.getContext("2d");l.font="20px monospace",l.scale(h,h)}var c=a.getContext("2d");c.clearRect(0,0,a.width,a.height),is$1.fillText(c,o,Bu$1,this.layer.options.debugOutline),this.loadTexture(a),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,a);var u=e+(i=256),f=n-r+32,d=n-r;s.bufferData(s.ARRAY_BUFFER,this.set8(e,f,e,d,u,f,u,d),s.DYNAMIC_DRAW),s.uniform1f(this.program.u_debug_line,0),s.drawArrays(s.TRIANGLE_STRIP,0,4),s.enable(s.DEPTH_TEST)},n.bufferTileData=function(t,e,n,i,r){var o,s=t,a=t+n,h=e,l=e-i;o=zn$3(s)&&zn$3(a)&&zn$3(h)&&zn$3(l)?this.set8Int(s,h,s,l,a,h,a,l):this.set8(s,h,s,l,a,h,a,l);var c=this.loadImageBuffer(o,r);return c.width=n,c.height=i,c.type=o instanceof Int16Array?"SHORT":"FLOAT",c},n.drawTinImage=function(t,e,n,i,r){var o=this.gl;this.loadTexture(t),o.uniformMatrix4fv(this.program.u_matrix,!1,this.getMap().projViewMatrix),o.uniform1f(this.program.u_opacity,r),o.bindBuffer(o.ARRAY_BUFFER,this.posBuffer),this.enableVertexAttrib(["a_position",3]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2]),o.bufferData(o.ARRAY_BUFFER,new Float32Array(n),o.DYNAMIC_DRAW),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),o.DYNAMIC_DRAW),o.drawElements(o.TRIANGLES,i.length,o.UNSIGNED_SHORT,0)},n.createCanvas2=function(){this.canvas2=is$1.createCanvas(this.canvas.width,this.canvas.height)},n.createGLContext=function(){this.gl=this.canvas.gl&&this.canvas.gl.wrap?this.canvas.gl.wrap():function(t,e){for(var n={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},i=["webgl","experimental-webgl"],r=null,o=0;o<i.length;++o){try{r=t.getContext(i[o],e||n)}catch(t){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);var t=this.gl;t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram("\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",this.layer.options.fragmentShader||"\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n        }\n    "),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),t.bufferData(t.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.enableSampler("u_image"),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},n.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},n.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)),this.gl.wrap||this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},n.disposeImage=function(t){t&&(t.texture&&this.saveTexture(t.texture),t.glBuffer&&this.saveImageBuffer(t.glBuffer),delete t.texture,delete t.glBuffer)},n._createTexture=function(t){var e=this.gl,n=this.getTexture()||e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),zn$3(Wi$4(t.width))&&zn$3(Wi$4(t.width))&&e.generateMipmap(e.TEXTURE_2D),n},n.getTexture=function(){this._textures||(this._textures=[]);var t=this._textures;return t&&t.length>0?t.pop():null},n.saveTexture=function(t){this._textures.push(t)},n.loadTexture=function(t){var e=this.gl,n=t.texture;return n||(n=this._createTexture(t),t.texture=n),e.bindTexture(e.TEXTURE_2D,n),n},n.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var t=this._imageBuffers;return t&&t.length>0?t.pop():null},n.saveImageBuffer=function(t){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(t)},n.loadImageBuffer=function(t,e){var n=this.gl,i=e||this.createImageBuffer();return n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),i},n.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},n.removeGLCanvas=function(){var t=this.gl;if(t){if(this._debugBuffer&&(t.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach((function(e){t.deleteBuffer(e)})),delete this._buffers),this._textures&&(this._textures.forEach((function(e){return t.deleteTexture(e)})),delete this._textures),this._debugInfoCanvas){var e=this._debugInfoCanvas.texture;e&&t.deleteTexture(e),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var n=t.program;t.deleteShader(n.fragmentShader),t.deleteShader(n.vertexShader),t.deleteProgram(n),delete this.gl,delete this.canvas2}},n.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},n.enableVertexAttrib=function(t){!function(t,e,n){if(Array.isArray(n[0])){for(var i=Float32Array.BYTES_PER_ELEMENT,r=0,o=0;o<n.length;o++)r+=n[o][1]||0;for(var s=0,a=0;a<n.length;a++){var h=t.getAttribLocation(e,n[a][0]);if(h<0)throw new Error("Failed to get the storage location of "+n[a][0]);t.vertexAttribPointer(h,n[a][1],t[n[a][2]||"FLOAT"],!1,i*r,i*s),s+=n[a][1]||0,t.enableVertexAttribArray(h)}}else{var l=t.getAttribLocation(e,n[0]);t.vertexAttribPointer(l,n[1],t[n[2]||"FLOAT"],!1,0,0),t.enableVertexAttribArray(l)}}(this.gl,this.gl.program,t)},n.createProgram=function(t,e){for(var n=this.gl,i=function(t,e,n){var i=ku$1(t,t.VERTEX_SHADER,e),r=ku$1(t,t.FRAGMENT_SHADER,n);if(!i||!r)return null;var o=t.createProgram();return o?(t.attachShader(o,i),t.attachShader(o,r),t.linkProgram(o),{program:o,vertexShader:i,fragmentShader:r}):null}(n,t,e),r=i.program,o=i.vertexShader,s=i.fragmentShader,a=n.getProgramParameter(r,35718),h=[],l=0;l<a;++l){var c=n.getActiveUniform(r,l);h.push(c.name)}return r.vertexShader=o,r.fragmentShader=s,this._initUniforms(r,h),r},n.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},n.enableSampler=function(t,e){var n=this.gl,i=this._getUniform(n.program,t);return e||(e=0),n.uniform1i(i,e),i},n._initUniforms=function(t,e){for(var n=0;n<e.length;n++){var i=e[n],r=e[n],o=i.indexOf("[");o>=0&&(i=i.substring(0,o),Un$3||(r=r.substring(0,o))),t[i]=this._getUniform(t,r)}},n._getUniform=function(t,e){var n=this.gl.getUniformLocation(t,e);if(!n)throw new Error("Failed to get the storage location of "+e);return n},e}(t);return kn$3(n.prototype,{set8:(e=Si$4.ie9?null:new Float32Array(8),function(t,n,i,r,o,s,a,h){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=h,e}),set8Int:function(){var t=Si$4.ie9?null:new Int16Array(8);return function(e,n,i,r,o,s,a,h){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t}}()}),n},Vu$1={renderer:Si$4.webgl?"gl":"canvas",crossOrigin:null},Wu$1=new Ii$4(0,0),Uu$1=function(t){function e(e,n,i){var r;return!n||Array.isArray(n)||n.url||(i=n,n=null),(r=t.call(this,e,i)||this)._images=n,r}Pi$4(e,t);var n=e.prototype;return n.onAdd=function(){this._prepareImages(this._images)},n.setImages=function(t){return this._images=t,this._prepareImages(t),this},n.getImages=function(){return this._images},n._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap(),n=e.getGLRes();this._imageData=t.map((function(t){var i=new ks$1(t.extent);return kn$3({},t,{extent:i,extent2d:i.convertTo((function(t){return e.coordToPointAtRes(t,n)}))})})),this._images=t;var i=this.getRenderer();i&&i.refreshImages()},e}(Fh);Uu$1.mergeOptions(Vu$1);var Zu$1=[],Xu$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},n.checkResources=function(){var t=this;if(this._imageLoaded)return Zu$1;var e=this.layer._imageData.map((function(t){return[t.url,null,null]}));if(this.resources){var n=[],i=new _a;e.forEach((function(e){if(t.resources.isResourceLoaded(e)){var r=t.resources.getImage(e);i.addResource(e,r)}else n.push(e)})),this.resources.forEach((function(e,n){i.isResourceLoaded(e)||t.retireImage(n.image)})),this.resources=i,e=n}return this._imageLoaded=!0,e},n.retireImage=function(t){t.close&&t.close()},n.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},n.draw=function(){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(),this.completeRender())},n._drawImages=function(){var t=this.layer._imageData,e=this.getMap(),n=e._get2DExtentAtRes(e.getGLRes());if(t&&t.length)for(var i=0;i<t.length;i++){var r=t[i].extent2d,o=this.resources&&this.resources.getImage(t[i].url);o&&n.intersects(r)&&(this._painted=!0,this._drawImage(o,r,t[i].opacity||1))}},n._drawImage=function(t,e,n){var i=0,r=this.context;n<1&&(i=r.globalAlpha,r.globalAlpha=n);var o=this.getMap(),s=Wu$1.set(e.xmin,e.ymax),a=o._pointAtResToContainerPoint(s,o.getGLRes()),h=a.x,l=a.y,c=o.getBearing();c&&(r.save(),r.translate(h,l),c&&r.rotate(-c*Math.PI/180),h=l=0);var u=o.getGLScale();r.drawImage(t,h,l,e.getWidth()/u,e.getHeight()/u),c&&r.restore(),i&&(r.globalAlpha=i)},n.drawOnInteracting=function(){this.draw()},e}(pa),Ju$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.isDrawable=function(){return!0},n._drawImage=function(t,e,n){this.drawGLImage(t,e.xmin,e.ymax,e.getWidth(),e.getHeight(),1,n)},n.createContext=function(){this.createGLContext()},n.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},n.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.retireImage=function(t){t.close&&t.close(),this.disposeImage(t)},n.onRemove=function(){this.removeGLCanvas(),t.prototype.onRemove.call(this)},e}(Gu$1(Xu$1));Uu$1.registerRenderer("canvas",Xu$1),Uu$1.registerRenderer("gl",Ju$1);var qu$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.getPrepareParams=function(){return[]},n.getDrawParams=function(){return[]},n.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=is$1.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},n.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&t.prototype.needToRedraw.call(this)},n.draw=function(){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer.apply(this,arguments)},n.drawOnInteracting=function(){this._drawLayerOnInteracting.apply(this,arguments)},n.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.layer.options.doubleBuffer){var n=e.image;this.buffer.width===n.width&&this.buffer.height===n.height||(this.buffer.width=n.width,this.buffer.height=n.height);var i=this.buffer.getContext("2d"),r=this.layer.doubleBuffer(i,this.context);(void 0===r||r)&&(is$1.image(i,n,0,0),e.image=this.buffer)}return e},n.remove=function(){return delete this._drawContext,t.prototype.remove.call(this)},n.onZoomStart=function(e){this.layer.onZoomStart(e),t.prototype.onZoomStart.call(this,e)},n.onZooming=function(e){this.layer.onZooming(e),t.prototype.onZooming.call(this,e)},n.onZoomEnd=function(e){this.layer.onZoomEnd(e),t.prototype.onZoomEnd.call(this,e)},n.onMoveStart=function(e){this.layer.onMoveStart(e),t.prototype.onMoveStart.call(this,e)},n.onMoving=function(e){this.layer.onMoving(e),t.prototype.onMoving.call(this,e)},n.onMoveEnd=function(e){this.layer.onMoveEnd(e),t.prototype.onMoveEnd.call(this,e)},n.onResize=function(e){this.layer.onResize(e),t.prototype.onResize.call(this,e)},n.prepareDrawContext=function(){if(!this._predrawed){var t=Yu$1(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw.apply(this.layer,[this.context].concat(t)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},n._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],n=Yu$1(this.getDrawParams());return e.push.apply(e,n),e.push.apply(e,this._drawContext),e},n._drawLayer=function(){var t=this._prepareDrawParams();if(t){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.layer.draw.apply(this.layer,t.concat(n)),this.completeRender()}},n._drawLayerOnInteracting=function(){if(this.layer.drawOnInteracting){var t=this._prepareDrawParams();if(t){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.layer.drawOnInteracting.apply(this.layer,t.concat(n)),this.completeRender()}}},e}(pa);function Yu$1(t){return t||(t=[]),Array.isArray(t)||(t=[t]),t}var Ku$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.isCanvasRender=function(){return!0},n.prepareToDraw=function(){},n.draw=function(){},n.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},n.play=function(){return this.config("animation",!0),this},n.pause=function(){return this.config("animation",!1),this},n.isPlaying=function(){return this.options.animation},n.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},n.requestMapToRender=function(){return this._getRenderer()&&this._getRenderer().requestMapToRender(),this},n.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},n.onCanvasCreate=function(){return this},n.onZoomStart=function(){},n.onZooming=function(){},n.onZoomEnd=function(){},n.onMoveStart=function(){},n.onMoving=function(){},n.onMoveEnd=function(){},n.onResize=function(){},n.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},e}(Fh);Ku$1.mergeOptions({doubleBuffer:!1,animation:!1}),Ku$1.registerRenderer("canvas",qu$1);var Qu$1=new Ii$4(0,0),$u$1=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.getParticles=function(){},n.draw=function(t,e){var n=this.getParticles(In$3());if(n&&0!==n.length){var i=this.getMap(),r=e.extent;e.maskExtent&&(r=e.extent.intersection(e.maskExtent)),r=r.convertTo((function(t){return i._pointToContainerPoint(t,void 0,0,Qu$1)}));for(var o=2*Math.PI,s=0,a=n.length;s<a;s++){var h=n[s].point;if(r.contains(h)){var l=n[s].color||this.options.lineColor||"#fff",c=n[s].r;t.fillStyle!==l&&(t.fillStyle=l),c<=2?t.fillRect(h.x-c/2,h.y-c/2,c,c):(t.beginPath(),t.arc(h.x,h.y,c/2,0,o),t.fill())}}this._fillCanvas(t)}else this._getRenderer()&&(this._getRenderer()._shouldClear=!0)},n._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, "+1/(this.options.trail||30)+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},e}(Ku$1);$u$1.mergeOptions({animation:!0}),$u$1.registerRenderer("canvas",function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},n.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},n.onSkipDrawOnInteracting=function(){this._shouldClear=!0},e}(qu$1));var tf,ef,nf=new _a,rf=function(t){function e(e,n,i){var r;(r=t.call(this,i)||this).target=e,e.once("remove",r.delete,Ai$4(Ai$4(r)));var o=r.options.symbol,s=o.markerLineWidth||1;return r.w=o.markerWidth+s,r.h=o.markerHeight+s,r.opacity=Dn$3(o.opacity)?1:o.opacity,r.map=n,r.events=i.events,r._fetchImage(),r.addTo(n),r}Pi$4(e,t);var n=e.prototype;return n.getCursor=function(){return this.options.cursor||"default"},n._fetchImage=function(){var t=this.map,e=this.options.symbol,n=e.markerFile;this.url=n||go$3(e);var i=nf.getImage(this.url);if(!i){var r=this.w,o=this.h;if(n)(i=new Image).onload=function(){var e=t.getRenderer();e&&e.setToRedraw()},i.src=this.url;else{var s=document.createElement("canvas");s.width=r,s.height=o,i=Ya(s.getContext("2d"),{x:r/2,y:o/2},e,nf)}nf.addResource([this.url,r,o],i)}nf.login(this.url),this._img=i},n.setContainerPoint=function(t){this._point=t,this._point._sub(this.w/2,this.h/2)},n.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},n.offset=function(t){this._point._add(t)},n.render=function(t){if(!this._img)return!1;var e=this.options.symbol,n=e.markerDx||0,i=e.markerDy||0,r=this.map,o=this._point,s=o.x,a=o.y,h=this.w,l=this.h;if(s+h>0&&s<r.width&&a+l>0&&a<r.height){var c=r.getDevicePixelRatio();return t.globalAlpha=this.opacity,t.drawImage(this._img,Math.round((s+n)*c),Math.round((a+i)*c),Math.round(h*c),Math.round(l*c)),!0}return!1},n.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}nf.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},n.hitTest=function(t){var e=this.options.symbol,n=this._point.x+(e.markerDx||0),i=this._point.y+(e.markerDy||0);return t.x>=n&&t.x<=n+this.w&&t.y>=i&&t.y<=i+this.h},n.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},n.onEvent=function(t){this.fire(t.type,t)},n.mousedown=function(t){var e=this.options.cursor;e&&t.target.setCursor(e),this.onDragstart(t)},n.onDragstart=function(t){var e=t.containerPoint,n=t.target,i=this._dragger=new vs$1(n._panels.mapWrapper||n._containerDOM);i.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),i.type="handle",i.onMouseDown(t.domEvent),tf=e.x,ef=e.y,this.fire("dragstart",{containerPoint:e})},n.onDragging=function(t){if(this._dragger){var e=this.map,n=Ho$3(t.domEvent,e._containerDOM),i={x:n.x-tf,y:n.y-ef},r=e.containerPointToCoord(new Ii$4(tf,ef)),o=e.containerPointToCoord(n);tf=n.x,ef=n.y,this.offset(i),this.fire("dragging",{containerPoint:n,coordOffset:o._sub(r)})}},n.onDragend=function(t){if(this._dragger){var e=this.map;e.resetCursor();var n=Ho$3(t.domEvent,e._containerDOM);this.offset({x:n.x-tf,y:n.y-ef}),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:n})}},e}(hs$1(cs$2)),of=function(){function t(t,e){this.target=t,t.once("remove",this.delete,this),this.map=e,this.addTo(e)}var e=t.prototype;return e.setPoints=function(t){this.points=t;var e=t.map((function(t){return t.x})),n=t.map((function(t){return t.y}));this.xmin=Math.min.apply(Math,e),this.xmax=Math.max.apply(Math,e),this.ymin=Math.min.apply(Math,n),this.ymax=Math.max.apply(Math,n)},e.hitTest=function(){return!1},e.render=function(t){var e=this.map;if(!(this.xmax<=0||this.xmin>=e.width||this.ymax<=0||this.ymin>=e.height)){var n=e.getDevicePixelRatio();t.lineWidth=1,t.strokeStyle="#000",t.globalAlpha=1,t.beginPath();var i=this.points;t.moveTo(o(i[0].x),o(i[0].y));for(var r=1;r<this.points.length;r++)t.lineTo(o(i[r].x),o(i[r].y));t.closePath(),t.stroke()}function o(t){return Math.round(t)*n+.5}},e.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},e.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}},t}();function sf(t,e){return{markerType:t,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:e}}var af={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:sf("ellipse",1),vertexHandleSymbol:sf("square",1),newVertexHandleSymbol:sf("square",.4)},hf=function(t){function e(e,n){var i;return(i=t.call(this,n)||this)._geometry=e,i._geometry?i:Ai$4(i)}Pi$4(e,t);var n=e.prototype;return n.getMap=function(){return this._geometry.getMap()},n.prepare=function(){var t=this.getMap();t&&(t.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},n._prepareEditStageLayer=function(){var t=this._geometry.getLayer();if("canvas"===t.options.renderer){var e=this.getMap(),n="_maptalks__internal_layer__edit_stage_"+zi$4()+"_shadow";this._shadowLayer=e.getLayer(n),this._shadowLayer||(this._shadowLayer=new t.constructor(n),e.addLayer(this._shadowLayer))}},n.start=function(){if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){this.editing=!0,this.prepare();var t,e=this._geometry,n="canvas"===this._geometry.getLayer().options.renderer;this._geometryDraggble=e.options.draggable,n?(e.config("draggable",!1),(t=e.copy()).setSymbol(e._getInternalSymbol()),t.copyEventListeners(e),e._getParent()&&t.copyEventListeners(e._getParent()),t._setEventTarget(e),t.setId(null).config({draggable:!1}),this._shadow=t,e.hide()):e instanceof fl&&e.config("draggable",!0),this._switchGeometryEvents("on"),(e instanceof fl||e instanceof Tl||e instanceof Pl||e instanceof Sl)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(t),e instanceof fl?t&&(t.config("draggable",!0),t.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),e instanceof fl&&!1!==this.options.resize?this.createMarkerEditor():e instanceof Tl?this.createCircleEditor():e instanceof Pl||e instanceof Sl?this.createEllipseOrRectEditor():e instanceof Al||(e instanceof ll||e instanceof ml)&&this.createPolygonEditor()}},n.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()?(this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")):this.fire("remove")},n.isEditing=function(){return!Dn$3(this.editing)&&this.editing},n._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},n._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var n in e)this._geometry[t](n,e[n],this)}},n._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},n._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},n._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;e||(this._editOutline=new of(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var n=this._editOutline.points;if(t instanceof fl)this._editOutline.setPoints(t.getContainerExtent().toArray(n));else{var i=this.getMap();(n=t._getPrjExtent().toArray(n)).forEach((function(t){return i._prjToContainerPoint(t,null,t)})),this._editOutline.setPoints(n)}return e},n._createCenterHandle=function(){var t,e=this,n=this.getMap(),i=this.options.centerHandleSymbol,r=n.coordToContainerPoint(this._geometry.getCenter()),o=this.createHandle(r,{symbol:i,cursor:"move",onDown:function(){if(e._shadow){var n=po$3((t=e._shadow.copy())._getInternalSymbol(),.5);t.setSymbol(n).addTo(e._geometry.getLayer())}},onMove:function(n){var i=n.coordOffset;t?t.translate(i):e._geometry.translate(i)},onUp:function(){e._update("setCoordinates",ys$1.toNumberArrays((t||e._geometry).getCoordinates())),t&&t.remove()}});this._addRefreshHook((function(){var t=e._geometry.getCenter();o.setContainerPoint(n.coordToContainerPoint(t))}))},n._createHandleInstance=function(t,e){var n=this.getMap(),i=Pr$4(e.symbol,(function(){return[n.getZoom(),{"{bearing}":n.getBearing(),"{pitch}":n.getPitch(),"{zoom}":n.getZoom()}]})),r=new rf(this,n,{symbol:i,cursor:e.cursor,events:this.options.removeVertexOn});return r.setContainerPoint(t),r},n.createHandle=function(t,e){e||(e={});var n=this._createHandleInstance(t,e),i=this;return n.on("dragstart",(function(t){return this._updating=!0,e.onDown&&(this._geometry.fire("handledragstart"),e.onDown.call(i,t.containerPoint,t)),!1}),this),n.on("dragging",(function(t){return i._hideContext(),e.onMove&&(this._geometry.fire("handledragging"),e.onMove.call(i,t)),!1}),this),n.on("dragend",(function(t){return e.onUp&&(this._geometry.fire("handledragend"),e.onUp.call(i,t)),this._updating=!1,!1}),this),e.onRefresh&&(n.refresh=e.onRefresh),n},n._createResizeHandles=function(t,e,n){var i=this,r=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],o=[null,"y",null,"x","x",null,"y",null],s=this._geometry,a=s instanceof fl;t||(t=[]);var h=this,l=[],c={},u=this.getMap(),f=this.options.vertexHandleSymbol,d=function(){for(var d=function(){if(a){var t=s.getContainerExtent();return[new Ii$4(t.xmin,t.ymin),new Ii$4((t.xmax+t.xmin)/2,t.ymin),new Ii$4(t.xmax,t.ymin),new Ii$4(t.xmin,(t.ymin+t.ymax)/2),new Ii$4(t.xmax,(t.ymin+t.ymax)/2),new Ii$4(t.xmin,t.ymax),new Ii$4((t.xmax+t.xmin)/2,t.ymax),new Ii$4(t.xmax,t.ymax)]}var e=s._getPrjExtent();return[new Ii$4(e.xmin,e.ymax),new Ii$4((e.xmax+e.xmin)/2,e.ymax),new Ii$4(e.xmax,e.ymax),new Ii$4(e.xmin,(e.ymax+e.ymin)/2),new Ii$4(e.xmax,(e.ymax+e.ymin)/2),new Ii$4(e.xmin,e.ymin),new Ii$4((e.xmax+e.xmin)/2,e.ymin),new Ii$4(e.xmax,e.ymin)]}(),m=function(m){if(Array.isArray(t)&&t.some((function(t){return t===m})))return"continue";var g,p=d[m],_=a?p:u._prjToContainerPoint(p);if(l.length<d.length-t.length){var v=i.createHandle(_,{symbol:f,cursor:r[m],axis:o[m],onMove:(g=m,function(t){h._updating=!0,e(t.containerPoint,g),s.fire("resizing")}),onUp:function(){h._updating=!1,n()}});c[m]=l.length,l.push(v)}else l[c[m]].setContainerPoint(_)},g=0;g<d.length;g++)m(g)};return d(),this._addRefreshHook(d),l},n.createMarkerEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();if(e._canEdit()){this._history||this._recordHistory(d());var i=e._getInternalSymbol(),r=new Ii$4(0,0);Ln$3(i.markerDx)&&(r.x=i.markerDx),Ln$3(i.markerDy)&&(r.y=i.markerDy);var o=null,s="middle",a="middle";if(dh.test(i)){var h=i.markerType;"pin"===h||"pie"===h||"bar"===h?(o=[5,6,7],s="bottom"):"rectangle"===h&&(o=[0,1,2,3,5],s="top",a="left")}else(ah$1.test(i)||mh.test(i))&&(s="bottom",o=[5,6,7]);var l,c=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var u=e.getSize();l=u.width/u.height}var f=this._createResizeHandles(o,(function(i,h){if(o&&o.indexOf(h)>=0){var u=n.containerPointToCoordinate(i.sub(r)),d=e.getCoordinates();u.x=d.x,e.setCoordinates(u),t._updateCoordFromShadow(!0),i=f[f.length-1-h].getContainerPoint()}var m=n.coordToContainerPoint(e.getCoordinates()).add(r),g=e._getInternalSymbol(),p=i.sub(m);"bottom"===s&&i.y>m.y&&(p.y=0);var _="middle"===s?2:1,v="left"===a?1:2,y=Math.abs(p.x)*v,x=Math.abs(p.y)*_;l&&(x=(y=Math.max(y,x*l))/l);var b=c[h];e instanceof zl?((l||0===b||2===b)&&(e.setWidth(y),e!==t._geometry&&t._geometry.setWidth(y)),(l||1===b||2===b)&&(e.setHeight(x),e!==t._geometry&&t._geometry.setHeight(x))):((l||0===b||2===b)&&(g.markerWidth=Math.min(y,t._geometry.options.maxMarkerWidth||1/0)),(l||1===b||2===b)&&(g.markerHeight=Math.min(x,t._geometry.options.maxMarkerHeight||1/0)),e.setSymbol(g),e!==t._geometry&&t._geometry.setSymbol(g))}),(function(){t._update(d())}))}else console&&console.warn("A marker can't be resized with symbol:",e.getSymbol());function d(){var t=[["setCoordinates",e.getCoordinates().toArray()]];return e instanceof zl?(t.push(["setWidth",e.getWidth()]),t.push(["setHeight",e.getHeight()])):t.push(["setSymbol",e.getSymbol()]),t}},n.createCircleEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();this._history||this._recordHistory([["setCoordinates",e.getCoordinates().toArray()],["setRadius",e.getRadius()]]),this._createResizeHandles(null,(function(i){var r=e.getCenter(),o=n.containerPointToCoord(i),s=new ml([[r.x,r.y],[o.x,r.y]]),a=new ml([[r.x,r.y],[r.x,o.y]]),h=Math.max(n.computeGeometryLength(s),n.computeGeometryLength(a));e.setRadius(h),e!==t._geometry&&t._geometry.setRadius(h)}),(function(){t._update("setRadius",e.getRadius())}))},n.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],n=this._shadow||this._geometry;this._history||this._recordHistory(a());var i,r=this.getMap(),o=this._geometry instanceof Pl;this.options.fixAspectRatio&&(i=n.getWidth()/n.getHeight());var s=this._createResizeHandles(null,(function(a,h){var l,c,u,f=o?1:2,d=s[h].getContainerPoint(),m=e[h];if(o){var g=s[7-h].getContainerPoint(),p=(l=d.sub(g)).abs();c=r.pixelToDistance(p.x,0),u=r.pixelToDistance(0,p.y);var _=n.getSize(),v=n.getCoordinates(),y=n.getWidth(),x=n.getHeight(),b=r.containerPointToCoord(a),w=r.containerPointToCoord(g),C=new ml([[w.x,w.y],[b.x,w.y]]),M=new ml([[w.x,w.y],[w.x,b.y]]);if(c=r.computeGeometryLength(C),u=r.computeGeometryLength(M),0===m)if(i&&(p.y=p.x/i,_.height=Math.abs(p.y),u=c/i),d.y=g.y-_.height/2,b.y=v.y,4===h)b.x=Math.min(b.x,v.x);else{var T=r.locate(v,y,0);b.x=r.locate(new ys$1(T.x,b.y),-c,0).x}else if(1===m)i&&(p.x=p.y*i,_.width=Math.abs(p.x),c=u*i),d.x=g.x-_.width/2,b.x=v.x,b.y=Math.max(b.y,w.y);else{if(i&&(c>u*i?(u=c/i,d.y=g.y+p.x*Vi$4(l.y)/i):(c=u*i,d.x=g.x+p.y*Vi$4(l.x)*i)),0===h||5===h){var S=r.locate(v,y,0===h?0:-x);b.x=r.locate(new ys$1(S.x,b.y),-c,0).x}else b.x=Math.min(b.x,w.x);b.y=Math.max(b.y,w.y)}n.setCoordinates(b),t._updateCoordFromShadow(!0)}else{var P=n.getCenter(),A=r.containerPointToCoord(d),E=new ml([[P.x,P.y],[A.x,P.y]]),O=new ml([[P.x,P.y],[P.x,A.y]]);c=r.computeGeometryLength(E),u=r.computeGeometryLength(O),i&&(u=(c=Math.max(c,u*i))/i)}(i||0===m||2===m)&&(n.setWidth(c*f),n!==t._geometry&&t._geometry.setWidth(c*f)),(i||1===m||2===m)&&(n.setHeight(u*f),n!==t._geometry&&t._geometry.setHeight(u*f))}),(function(){t._update(a())}));function a(){return[["setCoordinates",n.getCoordinates().toArray()],["setWidth",n.getWidth()],["setHeight",n.getHeight()]]}},n.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow||this._geometry,n=this;this._history||this._recordHistory("setCoordinates",ys$1.toNumberArrays(e.getCoordinates()));var i=e instanceof ll?3:2,r="maptalks--editor-vertex-index",o={0:[]},s={0:[]};function a(t){if(void 0===t&&(t=0),e instanceof ll){var n=e.getCoordinates()[t]||[];return n.slice(0,n.length-1)}return e.getCoordinates()}function h(t){return void 0===t&&(t=0),0===t?e._getPrjCoordinates():e._getPrjHoles()[t-1]}function l(){for(var t in o){for(var e=o[t].length-1;e>=0;e--)o[t][e][r]=e;for(var i=s[t].length-1;i>=0;i--)s[t][i][r]=i}n._updateCoordFromShadow()}function c(t){n._updating=!0;var a=t.target,c=a[r],u=Ln$3(a._ringIndex)?a._ringIndex:0,f=h(u);if(!(f.length<=i)){var d,m=e instanceof ml&&(0===c||c===f.length-1);f.splice(c,1),u>0?e._prjHoles[u-1]=f:e._setPrjCoordinates(f),e._updateCache(),o[u].splice(c,1)[0].delete(),c<s[u].length&&s[u].splice(c,1)[0].delete(),s[u].splice(d=0===c?s[u].length-1:c-1,1)[0].delete(),m||s[u].splice(d,0,p.call(n,d,u)),l(),n._updating=!1}}function u(i,r,o){void 0===o&&(o=0);var a=n._geometry.snapTo;a&&Hn$3(a)&&(i=n._geometry.snapTo(i)||i);var l,c=h(o),u=t._containerPointToPrj(i.sub(d())),f=c[r];f.x=u.x,f.y=u.y,e._updateCache(),e.onShapeChanged(),n._updateCoordFromShadow(!0),l=0===r?s[o].length-1:r-1,s[o][r]&&s[o][r].refresh(),s[o][l]&&s[o][l].refresh()}var f=new Ii$4(0,0);function d(){var t=e._getCompiledSymbol();return f.x=t.lineDx||0,f.y=t.lineDy||0,f}function m(e,i,o){void 0===i&&(i=0);var s=(o||a(i))[e],h=n.createHandle(t.coordToContainerPoint(s)._add(d()),{symbol:n.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){u(h.getContainerPoint(),h[r],i)},onRefresh:function(e,n){s=(n||a(i))[h[r]];var o=t.coordToContainerPoint(s);h.setContainerPoint(o._add(d()))},onUp:function(){n._updateCoordFromShadow()},onDown:function(t,e){}});return h[r]=e,h._ringIndex=i,h.on(n.options.removeVertexOn,c),h}var g=!1;function p(i,c,f){void 0===c&&(c=0);var _=f||a(c),v=_[i].add(i+1>=_.length?_[0]:_[i+1]).multi(.5),y=n.createHandle(v,{symbol:n.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(i,o){if(!o||!o.domEvent||2!==o.domEvent.button){var a=h(c),l=y[r],u=y.getContainerPoint(),f=t._containerPointToPrj(u);a.splice(l+1,0,f),c>0?e._prjHoles[c-1]=a:e._setPrjCoordinates(a),e._updateCache(),y.opacity=1,s[c].splice(l,0,p.call(n,l,c),p.call(n,l+1,c)),g=!0}},onMove:function(){u(y.getContainerPoint(),y[r]+1,c)},onUp:function(t){if(t&&t.domEvent&&2===t.domEvent.button)g=!1;else{var e=y[r];Ni$4(y,s[c]),y.delete(),o[c].splice(e+1,0,m.call(n,e+1,c)),l(),n._updateCoordFromShadow(),g=!1}},onRefresh:function(e,n){_=n||a(e);var i=y[r],o=_[i].add(_[i===_.length-1?0:i+1]).multi(.5),s=t.coordToContainerPoint(o);y.setContainerPoint(s._add(d()))}});return y[r]=i,y}if(e instanceof ll)for(var _=e.getHoles().length+1,v=0;v<_;v++){o[v]=[],s[v]=[];for(var y=a(v),x=0,b=y.length;x<b;x++)o[v].push(m.call(this,x,v,y)),x<b-1&&s[v].push(p.call(this,x,v,y));s[v].push(p.call(this,y.length-1,v,y))}else{for(var w=a(0),C=0,M=w.length;C<M;C++)o[0].push(m.call(this,C,0,w)),C<M-1&&s[0].push(p.call(this,C,0,w));s[0].length&&2===e.getCoordinates().length&&(s[0][0].options.symbol.markerDx=12)}this._addRefreshHook((function(){if(!g){for(var t in s)for(var n=a(t),i=s[t].length-1;i>=0;i--)s[t][i].refresh(t,n);for(var r in s[0].length&&e instanceof ml&&(2===e.getCoordinates().length?s[0][0].options.symbol.markerDx=12:e.getCoordinates().length>2&&(s[0][0].options.symbol.markerDx=0)),o)for(var h=a(r),l=o[r].length-1;l>=0;l--)o[r][l].refresh(r,h)}}))},n._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},n._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},n._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},n._update=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this._exeHistory([t,n]),this._recordHistory.apply(this,[t].concat(n))},n._updateCoordFromShadow=function(t){var e=(this._shadow||this._geometry).getCoordinates(),n=this._geometry,i=this._updating;this._updating=!0,n.setCoordinates(e),t||this._recordHistory("setCoordinates",ys$1.toNumberArrays(n.getCoordinates())),this._updating=i},n._recordHistory=function(t){this._history||(this._history=[],this._historyPointer=0);for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];if(this._history.length){var r=this._history[this._history.length-1];if(r[0]===t&&JSON.stringify(r[1])===JSON.stringify(n))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([t,n]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},n.cancel=function(){return this._history&&0!==this._historyPointer?(this._historyPointer=0,this._exeAndReset(this._history[0]),this):this},n.undo=function(){if(!this._history||0===this._historyPointer)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},n.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},n._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,n=this._historyPointer;this.stop(),this._history=e,this._historyPointer=n,this.start()}},n._onDragStart=function(){this._updating=!0},n._onDragEnd=function(){this._updating=!1},n._exeHistory=function(t){if(Array.isArray(t)){var e=this._updating;this._updating=!0;var n=this._shadow||this._geometry,i=this._geometry;Array.isArray(t[0])?t[0].forEach((function(t){var e=t[0],r=t.slice(1);n[e].apply(n,r),n!==i&&i[e].apply(i,r)})):(n[t[0]].apply(n,t[1]),n!==i&&i[t[0]].apply(i,t[1])),this._updating=e}},e}(hs$1(cs$2));hf.mergeOptions(af),Ll.include({startEditText:function(){return this.getMap()?(this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=t;var e=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(e),Jo$2(this._textEditor,"mousedown dblclick",zo$3),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),e=this._createEditor();this._textEditor=e,t.on("mousedown",this.endEditText,this);var n=this._getEditorOffset();this._editUIMarker=new Gc(this.getCoordinates(),{animation:null,content:e,dx:n.dx,dy:n.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},e=0,n=0,i=t.textHorizontalAlignment;return"middle"===i||Dn$3(i)?(e=(t.textDx||0)-2,n=(t.textDy||0)-2):(e=(t.markerDx||0)-2,n=(t.markerDy||0)-2),{dx:e,dy:n}},_createEditor:function(){var t=this.getContent(),e=this.getSize(),n=this._getInternalSymbol()||{},i=e.width,r=n.textFill||"#000000",o=n.textSize||12,s=e.height,a=n.markerLineColor||"#000",h=n.markerFill||"#3398CC",l=n.textLineSpacing||0,c=Eo$2("div");return c.contentEditable=!0,c.style.cssText="background:"+h+"; border:1px solid "+a+";\n            color:"+r+";font-size:"+o+"px;width:"+(i-2)+"px;height:"+(s-2)+"px;margin: auto;\n            line-height:"+(o+l)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",c.innerText=t,Xo$3(c,"mousedown dblclick",zo$3),c.onkeyup=function(t){13===t.keyCode&&(c.style.height=parseInt(c.style.height||0)+o/2+"px")},c},_setCursorToLast:function(t){var e;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())}}),kh.include({animate:function(t,e,n){var i=this;this._animPlayer&&this._animPlayer.finish(),Hn$3(e)&&(n=e),e||(e={});var r,o=this.getMap(),s=this._getProjection(),a=this._prepareAnimationStyles(t),h=e.focus;if(delete this._animationStarted,o){var l=o._getRenderer();e.framer=function(t){l.callInNextFrame(t)}}var c=al.animate(a,e,(function(t){if(o&&o.isRemoved())c.finish();else{o&&!i._animationStarted&&h&&o.onMoveStart();var e=t.styles;for(var a in e)if("symbol"!==a&&"translate"!==a&&e.hasOwnProperty(a)){var l="set"+a[0].toUpperCase()+a.slice(1);i[l](e[a])}var u=e.translate;if(u){var f=u;r&&(f=u.sub(r)),r=u,i.translate(f)}var d=e.symbol;if(d){var m=i.getSymbol()||{};i.setSymbol(_o$3(m,d))}if(o&&h){var g=s.project(i.getCenter());o._setPrjCenter(g);var p=o._parseEventFromCoord(s.unproject(g));"running"!==c.playState?o.onMoveEnd(p):o.onMoving(p)}i._fireAnimateEvent(c.playState),n&&n(t)}}),this);return this._animPlayer=c,this._animPlayer.play()},_prepareAnimationStyles:function(t){var e=this._getInternalSymbol(),n={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];if("translate"!==i&&"symbol"!==i){var o=this["get"+i[0].toUpperCase()+i.substring(1)]();n[i]=[o,r]}else if("symbol"===i){var s=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(e))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");s=[];for(var a=t.symbol,h=0;h<a.length;h++)if(a[h]){var l={};for(var c in a[h])a[h].hasOwnProperty(c)&&(l[c]=[e[h][c],a[h][c]]);s.push(l)}else s.push(null)}else{if(Array.isArray(e))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var u in s={},r)r.hasOwnProperty(u)&&(s[u]=[e[u],r[u]])}n.symbol=s}else"translate"===i&&(n.translate=new ys$1(r))}return n},_fireAnimateEvent:function(t){"finished"===t?(delete this._animationStarted,this._fireEvent("animateend")):"running"===t&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var lf=Si$4.touch?"touchstart mousedown":"mousedown",cf=function(t){function e(e){return t.call(this,e)||this}Pi$4(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on(lf,this._startDrag,this)},n.removeHooks=function(){this._endDrag(),this.target.off(lf,this._startDrag,this),delete this.container},n._prepareDragHandler=function(){this._dragHandler=new vs$1(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},n._prepareShadow=function(){var t=this,e=this.target;if("canvas"===e.getLayer().options.renderer){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var n=this._shadow=e.copy();if(n.getGeometries){var i=n.getGeometries(),r=e.getGeometries();i.forEach((function(e,n){t._updateShadowSymbol(e,r[n])}))}else this._updateShadowSymbol(n,e);n.setId(null),this._prepareShadowConnectors()}},n._updateShadowSymbol=function(t,e){if(t.setSymbol(e._getInternalSymbol()),e.options.dragShadow){var n=po$3(t._getInternalSymbol(),.5);t.setSymbol(n)}},n._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,n=this._dragStageLayer._getRenderer().resources,i=[];if(Nl._hasConnectors(t))for(var r=Nl._getConnectors(t),o=0,s=r.length;o<s;o++){var a=r[o],h=a.config(),l=a._getInternalSymbol();h.symbol=po$3(l,.5);var c;c=a.getConnectSource()===t?new a.constructor(e,a.getConnectTarget(),h):new a.constructor(a.getConnectSource(),e,h),i.push(c),a.getLayer()&&a.getLayer()._getRenderer()&&n.merge(a.getLayer()._getRenderer().resources)}this._shadowConnectors=i,i.push(e),this._dragStageLayer.bringToFront().addGeometry(i)},n._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},n._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer("_maptalks__internal_layer__drag_stage"),this._dragStageLayer||(this._dragStageLayer=new Zl("_maptalks__internal_layer__drag_stage",{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var n=new _a;n.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=n},n._startDrag=function(t){var e=this.target.getMap();if(e&&!this.target._getParent()&&!this.isDragging()){var n=t.domEvent;n.touches&&n.touches.length>1||2===n.button||(this.container=e._panels.mapWrapper||e._containerDOM,this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),Xo$3(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}},n._dragging=function(t){var e=this.target,n=e.getMap(),i=n._parseEvent(t.domEvent),r=i.domEvent;if(!(r.touches&&r.touches.length>1)){var o=n._getVisualHeight(n.options.maxVisualPitch);if(!(i.containerPoint.y<n.height-o)){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",i)),this.target._fireEvent("dragstart",this._startParam||i),void delete this._startParam;var s=this._shadow||e,a=s.options.dragOnAxis,h=s.options.dragOnScreenAxis,l=i.containerPoint,c=i.coordinate;this._lastPoint=this._lastPoint||l,this._lastCoord=this._lastCoord||c,h?("x"===a?l.y=this._lastPoint.y:"y"===a&&(l.x=this._lastPoint.x),c=n.containerPointToCoord(l)):c=this._correctCoord(c);var u=l.sub(this._lastPoint),f=c.sub(this._lastCoord);h||("x"===a?u.y=f.y=0:"y"===a&&(u.x=f.x=0)),this._lastPoint=l,this._lastCoord=c,s.translate(f),s===e||e.options.dragShadow||e.translate(f),i.coordOffset=f,i.pointOffset=u,s._fireEvent("dragging",i),s!==e&&e._fireEvent("dragging",i)}}},n._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&Jo$2(this.container,"mouseleave",this._endDrag),this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var n=e.getMap();if(this.enabled()&&n){var i=n._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(i),this._moved&&e._fireEvent("dragend",i)}}},n.isDragging=function(){return!!this._isDragging},n._updateTargetAndRemoveShadow=function(t){if(this._shadow){var e=this.target,n=e.getMap();e.options.dragShadow||e.show();var i=this._shadow;if(i){if(e.options.dragShadow)if(e.getGeometries){var r=i.getGeometries(),o=e.getGeometries();r.forEach((function(t,e){o[e].setCoordinates(r[e].getCoordinates())}))}else e.setCoordinates(i.getCoordinates());i._fireEvent("dragend",t),i.remove(),delete this._shadow}this._shadowConnectors&&(n.getLayer("_maptalks__internal_layer__drag_stage").removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new _a,this._dragStageLayer.remove())}},n._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var n=this.target;if(!n.getMinAltitude())return t;var i=(n.getMinAltitude()+n.getMaxAltitude())/2;return e.locateByPoint(t,0,-i)},e}(ls$1);kh.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1}),kh.addInitHook("addHandler","draggable",cf),kh.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),kh.include({startEdit:function(t){var e=this.getMap();return e&&this.options.editable?(this._editor&&this.endEdit(),this._editor=new hf(this,t),this._editor.start(),this._getParent()||this.fire("editstart"),e.getRenderer().setToRedraw(),this):this},endEdit:function(){if(this._editor){this._editor.stop(),delete this._editor,this._getParent()||this.fire("editend");var t=this.getMap();t&&t.getRenderer().setToRedraw()}return this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),kh.include({_onEvent:function(t,e){var n=this.getMap();if(n){var i=e||this._getEventTypeToFire(t);"contextmenu"===i&&this.listens("contextmenu")&&(zo$3(t),Lo$2(t));var r=n._getEventParams(t);Ln$3(this._pickGeometryIndex)&&(r.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(i,r)}},_getEventTypeToFire:function(t){return t.type}}),kh.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof Jc?(this._infoWindow=t,this._infoWinOptions=kn$3({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=kn$3({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()?(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(t)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var t=this._infoWinOptions;return t?(this._infoWindow=new Jc(t),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}});var uf=new Ii$4(0,0),ff=new Ii$4(0,0),df=new Ii$4(0,0),mf=new Ii$4(0,0),gf=[],pf=function(t){function e(){return t.call(this,"core-fetch-image")||this}Pi$4(e,t);var n=e.prototype;return n.checkUrl=function(t){return t&&jn$3(t)?lr$4(t):t},n.fetchImage=function(t,e,n,i){t=this.checkUrl(t),this.send({url:t,fetchOptions:i},gf,n,e)},e}(da),_f=new Image,vf=function(t){function e(e){var n;return(n=t.call(this,e)||this).tilesInView={},n.tilesLoading={},n._parentTiles=[],n._childTiles=[],n._tileQueue=[],n.tileCache=new Qo$2(e.options.maxCacheSize,n.deleteTile.bind(Ai$4(Ai$4(n)))),Si$4.decodeImageInWorker&&n.layer.options.decodeImageInWorker&&("gl"===e.options.renderer||!Si$4.safari&&!Si$4.iosWeixin)&&(n._tileImageWorkerConn=new pf),n._compareTiles=xf.bind(Ai$4(Ai$4(n))),n}Pi$4(e,t);var n=e.prototype;return n.getCurrentTileZoom=function(){return this._tileZoom},n.draw=function(t,e){var n=this.getMap();if(this.isDrawable()){var i=this.prepareCanvas();if(!i||i.intersects(this.canvasExtent2D)){var r;this._renderTimestamp!==t&&(this._consumeTileQueue(),this._renderTimestamp=t);var o=!1,s=this._frameTiles;if(s&&t===s.timestamp){if(s.empty)return;r=s}else{if(!(r=this._getTilesInCurrentFrame()))return this._frameTiles={empty:!0,timestamp:t},void this.completeRender();o=!0,this._frameTiles=r,this._frameTiles.timestamp=t,r.loadingCount&&this.loadTileQueue(r.tileQueue)}var a=r.loading,h=r.loadingCount;this._drawTiles(r.tiles,r.parentTiles,r.childTiles,r.placeholders,e),h||a||(n.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),o&&this._retireTiles()}else this.completeRender()}},n.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},n._getTilesInCurrentFrame=function(){var t=this.getMap(),e=this.layer.getTiles();if(this._frameTileGrids=e,!(e=e.tileGrids)||!e.length)return null;var n=e.reduce((function(t,e){return t+(e&&e.tiles&&e.tiles.length||0)}),0);n>=this.tileCache.max/2&&this.tileCache.setMaxSize(2*n+1);var i=0,r=!1,o={},s=[],a=[],h={},l=[],c={},u=[],f={},d={},m=this._markTiles(),g=this._getLoadLimit(),p=e.length;this._tileZoom=e[0].zoom;for(var _=0;_<p;_++){var v=e[_].tiles,y=void 0;v.length&&(y=this._generatePlaceHolder(v[0].res));for(var x=0,b=v.length;x<b;x++){var w=v[x],C=w.id,M=!1;if(this._isLoadingTile(C))M=r=!0,this.tilesLoading[C].current=!0;else{var T=this._getCachedTile(C);T?(T.image&&this.getTileOpacity(T.image)<1&&(M=r=!0,this.setToRedraw()),s.push(T)):(M=r=!0,g&&i+m[0]>g||t.isInteracting()&&!t.isMoving()&&!t.isRotating()||(i++,d[C]=w))}if(M&&!o[C]){o[C]=1,y&&!f[C]&&(w.cache=!1,u.push({image:y,info:w}),f[C]=1);var S=this._findParentTile(w);if(S){var P=S.info.id;void 0===h[P]&&(h[P]=a.length,a.push(S))}else if(!a.length){var A=this._findChildTiles(w);A.length&&A.forEach((function(t){c[t.info.id]||(l.push(t),c[t.info.id]=1)}))}}}}return a.length&&(l.length=0,this._childTiles.length=0),{childTiles:l,parentTiles:a,tiles:s,placeholders:u,loading:r,loadingCount:i,tileQueue:d}},n.isTileCachedOrLoading=function(t){return this.tileCache.get(t)||this.tilesInView[t]||this.tilesLoading[t]},n._drawTiles=function(t,e,n,i,r){var o=this;e.length&&(e.sort(this._compareTiles),this._parentTiles=e),n.length&&(this._childTiles=n,this._childTiles.sort(this._compareTiles));var s={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:r};this.onDrawTileStart(s,r),1===this.layer.options.opacity&&(this._childTiles.forEach((function(t){return o._drawTile(t.info,t.image,r)})),this._parentTiles.forEach((function(t){return o._drawTile(t.info,t.image,r)}))),t.sort(this._compareTiles);for(var a=0,h=t.length;a<h;a++)this._drawTileAndCache(t[a],r);this.layer.options.opacity<1&&(this._childTiles.forEach((function(t){return o._drawTile(t.info,t.image,r)})),this._parentTiles.forEach((function(t){return o._drawTile(t.info,t.image,r)}))),i.forEach((function(t){return o._drawTile(t.info,t.image,r)})),this.onDrawTileEnd(s,r)},n.onDrawTileStart=function(){},n.onDrawTileEnd=function(){},n._drawTile=function(t,e,n){e&&this.drawTile(t,e,n)},n._drawTileAndCache=function(t,e){t.current=!0,this.tilesInView[t.info.id]=t,this._drawTile(t.info,t.image,e),this.tileCache.add(t.info.id,t)},n.drawOnInteracting=function(t,e,n){this.draw(e,n)},n.needToRedraw=function(){var e=this.getMap();return!!this._tileQueue.length||(e.getPitch()?t.prototype.needToRedraw.call(this):!(!e.isRotating()&&!e.isZooming())||(e.isMoving()?!!this.layer.options.forceRenderOnMoving:t.prototype.needToRedraw.call(this)))},n.hitDetect=function(){return!1},n._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:0},n.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},n.clear=function(){this._retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._parentTiles=[],this._childTiles=[],t.prototype.clear.call(this)},n._isLoadingTile=function(t){return!!this.tilesLoading[t]},n.clipCanvas=function(e){return t.prototype.clipCanvas.call(this,e)},n._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var n=e.getContainerExtent(),i=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(n.ymin)*i,Math.ceil(n.getWidth())*i,Math.ceil(n.getHeight())*i),t.stroke(),t.clip(),!0},n.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e],i=this.loadTile(n);void 0===i.loadTime&&(this.tilesLoading[n.id]={image:i,current:!0,info:n})}},n.loadTile=function(t){var e;if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)this._fetchImage(e={},t);else{var n=this.layer.getTileSize(t.layer);(e=new Image).width=n.width,e.height=n.height,e.onload=this.onTileLoad.bind(this,e,t),e.onerror=this.onTileError.bind(this,e,t),this.loadTileImage(e,t.url)}return e},n._fetchImage=function(t,e){var n=this;if(t instanceof Image)t.src=e.url;else{var i=Math.abs(e.x+e.y)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(e.url,i,(function(i,r){i?n.onTileError(t,e,i):hr$4(r,(function(t){n.onTileLoad(t,e)}))}),this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},n.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;return Dn$3(n)||(t.crossOrigin=n),Di$4(t,[e])},n.abortTileLoading=function(t){t&&(t.onload=yf,t.onerror=yf,t.src=ir$4)},n.onTileLoad=function(t,e){this._tileQueue.push({tileInfo:e,tileData:t})},n._consumeTileQueue=function(){for(var t=0,e=this.layer.options.tileLimitPerFrame,n=this._tileQueue;n.length&&(e<=0||t<e);){var i=n.shift(),r=i.tileData,o=i.tileInfo;this.checkTileInQueue(r,o)&&(this.consumeTile(r,o),t++)}},n.checkTileInQueue=function(){return!0},n.consumeTile=function(t,e){if(this.layer){var n=e.id;if(this.tilesInView){var i={tile:e,tileImage:t};this.layer.fire("tileload",i),(t=i.tileImage).loadTime=In$3(),delete this.tilesLoading[n],this._addTileToCache(e,t),this.setToRedraw()}}},n.onTileError=function(t,e){if(this.layer){if(t.onerrorTick=t.onerrorTick||0,this.layer.options.tileRetryCount>t.onerrorTick)return t.onerrorTick++,void this._fetchImage(t,e);var n=this.layer.options.errorUrl;if(n){if(t instanceof Image&&t.src!==n)return void(t.src=n);(t=new Image).src=n}t=t instanceof Image?t:_f,this.abortTileLoading(t,e),t.loadTime=0,delete this.tilesLoading[e.id],this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}},n.drawTile=function(t,e){if(e&&this.getMap()){var n=t.extent2d,i=t.offset,r=uf.set(n.xmin-i[0],n.ymax-i[1]),o=t.z,s=t.id,a=this.getMap(),h=a.getZoom(),l=this.context,c=a._pointAtResToContainerPoint(r,t.res,0,ff),u=a.getBearing(),f=u||h!==o,d=this.getTileOpacity(e),m=l.globalAlpha;d<1&&(l.globalAlpha=d,this.setToRedraw()),f||c._round();var g=c.x,p=c.y,_=t.extent2d.xmax-t.extent2d.xmin,v=t.extent2d.ymax-t.extent2d.ymin;if(f){l.save(),l.translate(g,p),u&&(l.rotate(-u*Math.PI/180),_+=.1,v+=.1);var y=a._getResolution();if(y!==t.res){var x=t.res/y;l.scale(x,x)}g=p=0}if(is$1.image(l,e,g,p,_,v),this.layer.options.debug){var b=this.layer.options.debugOutline;l.save(),l.strokeStyle=b,l.fillStyle=b,l.strokeWidth=10,l.font="20px monospace";var w=new Ii$4(g,p);is$1.rectangle(l,w,{width:_,height:v},1,0),is$1.fillText(l,this.getDebugInfo(s),w._add(32,v-14),b),is$1.drawCross(l,g+_/2,p+v/2,2,b),l.restore()}f&&l.restore(),l.globalAlpha!==m&&(l.globalAlpha=m),this.setCanvasUpdated()}},n.getDebugInfo=function(t){var e=t.split("_"),n=e.length;return"x:"+e[n-2]+", y:"+e[n-3]+", z:"+e[n-1]},n._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer);if(!e||!e.options.background)return[];for(var n=this.getMap(),i=[],r=t.res,o=t.extent2d.getMin(),s=t.extent2d.getMax(),a=e._project(n._pointToPrjAtRes(o,r,df),df),h=e._project(n._pointToPrjAtRes(s,r,mf),mf),l=1;l<3;l++)this._findChildTilesAt(i,a,h,e,t.z+l);return i},n._findChildTilesAt=function(t,e,n,i,r){var o=i.options.zoomOffset,s=i.getId(),a=i.getSpatialReference().getResolution(r+o);if(a)for(var h,l,c=i._getTileConfig().getTileIndex(e,a),u=i._getTileConfig().getTileIndex(n,a),f=Math.min(c.idx,u.idx),d=Math.max(c.idx,u.idx),m=Math.min(c.idy,u.idy),g=Math.max(c.idy,u.idy),p=f;p<d;p++)for(var _=m;_<g;_++)h=i._getTileId(p,_,r+o,s),this.tileCache.has(h)&&(l=this.tileCache.getAndRemove(h),t.push(l),this.tileCache.add(h,l))},n._findParentTile=function(t){var e=this.getMap(),n=this._getLayerOfTile(t.layer);if(!n||!n.options.background)return null;for(var i=n.getSpatialReference(),r=i.getZoomDirection(),o=n.options.zoomOffset,s=n.options.backgroundZoomDiff,a=t.res,h=t.extent2d.getCenter(),l=n._project(e._pointToPrjAtRes(h,a)),c=1;c<=s;c++){var u=t.z-r*c,f=i.getResolution(u+o);if(f){var d=n._getTileConfig().getTileIndex(l,f),m=n._getTileId(d.x,d.y,u+o,t.layer);if(this.tileCache.has(m)){var g=this.tileCache.getAndRemove(m);return this.tileCache.add(m,g),g}}}return null},n._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},n._getCachedTile=function(t){var e=this.tilesInView,n=this.tileCache.getAndRemove(t);if(n){e[t]=n;var i=this.tilesLoading;if(i&&i[t]){i[t].current=!1;var r=i[t];this.abortTileLoading(r.image,r.info),delete i[t]}}else n=e[t];return n},n._addTileToCache=function(t,e){this.tilesInView[t.id]={image:e,current:!0,info:t}},n.getTileOpacity=function(t){return this.layer.options.fadeAnimation&&t.loadTime?Math.min(1,(In$3()-t.loadTime)/(1e3/60*10)):1},n.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,t.prototype.onRemove.call(this)},n._markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var n in this.tilesLoading)this.tilesLoading[n].current=!1,t++;if(this.tilesInView)for(var i in this.tilesInView)this.tilesInView[i].current=!1,e++;return[t,e]},n._retireTiles=function(t){for(var e in this.tilesLoading){var n=this.tilesLoading[e];!t&&n.current||(n.image&&this.abortTileLoading(n.image,n.info),this.deleteTile(n),delete this.tilesLoading[e])}for(var i in this.tilesInView){var r=this.tilesInView[i];r.current||(delete this.tilesInView[i],this.tileCache.has(i)||this.deleteTile(r))}},n.deleteTile=function(t){t&&t.image&&(t.image.close&&t.image.close(),t.image.onload=null,t.image.onerror=null)},n._generatePlaceHolder=function(t){var e=this.getMap(),n=this.layer.options.placeholder;if(!n||e.getPitch())return null;var i=this.layer.getTileSize(),r=t/e._getResolution(),o=this._tilePlaceHolder=this._tilePlaceHolder||is$1.createCanvas(1,1,e.CanvasClass);return o.width=i.width*r,o.height=i.height*r,Hn$3(n)?n(o):function(t){var e=t.getContext("2d"),n=t.width,i=t.height,r=n/16,o=i/16;e.beginPath();for(var s=0;s<16;s++)e.moveTo(0,s*o),e.lineTo(n,s*o),e.moveTo(s*r,0),e.lineTo(s*r,i);e.strokeStyle="rgba(180, 180, 180, 0.1)",e.lineWidth=1,e.stroke(),e.beginPath();for(var a=[[0,0],[n,0],[0,i],[n,i],[0,0],[0,i],[n,0],[n,i],[0,i/2],[n,i/2],[n/2,0],[n/2,i]],h=1;h<a.length;h+=2)e.moveTo(a[h-1][0],a[h-1][1]),e.lineTo(a[h][0],a[h][1]);e.lineWidth=4,e.stroke()}(o),o},e}(pa);function yf(){return!1}function xf(t,e){return Math.abs(this._tileZoom-t.info.z)-Math.abs(this._tileZoom-e.info.z)}Cu$1.registerRenderer("canvas",vf);var bf=new Ii$4(0,0),wf={properties:{}},Cf=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.isDrawable=function(){return!0},n.needToRedraw=function(){var e=this.getMap();return!(!this._gl()||e.getPitch()||!e.isZooming()||e.isMoving()||e.isRotating())||t.prototype.needToRedraw.call(this)},n.onDrawTileStart=function(t,e){var n=this.gl;n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.enable(n.POLYGON_OFFSET_FILL),n.enable(n.STENCIL_TEST),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE);var i=Dn$3(this.layer.options.depthMask)||!!this.layer.options.depthMask;if(n.depthMask(i),e&&e.renderTarget){var r=e.renderTarget.fbo;if(r){var o=e.renderTarget.getFramebuffer(r);n.bindFramebuffer(n.FRAMEBUFFER,o)}}},n.onDrawTileEnd=function(t,e){var n=this.gl;e&&e.renderTarget&&e.renderTarget.fbo&&n.bindFramebuffer(n.FRAMEBUFFER,null)},n.drawTile=function(e,n,i){if(!i||!i.sceneFilter||i.sceneFilter(wf)){var r=this.getMap();if(e&&r&&n){var o=e._glScale=e._glScale||e.res/r.getGLRes(),s=e.extent2d.xmax-e.extent2d.xmin,a=e.extent2d.ymax-e.extent2d.ymin;if(!1!==e.cache&&this._bindGLBuffer(n,s,a),this._gl()){var h=e.offset,l=bf.set(e.extent2d.xmin-h[0],e.extent2d.ymax-h[1]),c=l.x*o,u=l.y*o,f=this.getTileOpacity(n),d=null;this.layer.options.debug&&(d=this.getDebugInfo(e.id));var m=this.gl;m.stencilFunc(m.LEQUAL,this.tilesInView[e.id]?0:Math.abs(this.getCurrentTileZoom()-e.z),255);var g=this.layer.getPolygonOffset(),p=this.tilesInView[e.id]?g-1:g;m.polygonOffset(p,p),this.drawGLImage(n,c,u,s,a,o,f,d),f<1?this.setToRedraw():this.setCanvasUpdated()}else t.prototype.drawTile.call(this,e,n)}}},n._bindGLBuffer=function(t,e,n){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,n))},n.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;t.crossOrigin=null!==n?n:"",t.src=e},n.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},n.createContext=function(){t.prototype.createContext.call(this),this.createGLContext()},n.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},n.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.getCanvasImage=function(){if(!this._gl()||!this.canvas2)return t.prototype.getCanvasImage.call(this);var e=t.prototype.getCanvasImage.call(this);return e&&(e.image=this.canvas2),e},n._gl=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},n.deleteTile=function(e){t.prototype.deleteTile.call(this,e),e&&e.image&&this.disposeImage(e.image),delete e.image},n.onRemove=function(){t.prototype.onRemove.call(this),this.removeGLCanvas()},e}(Gu$1(vf));function Mf(t){var e=this.layer.getTileSize(),n=this.canvas.constructor,i=this.getMap(),r=i.getDevicePixelRatio(),o=is$1.createCanvas(e.width*r,e.height*r,n);o.layer=this.layer;var s=this,a=new Ii$4(t.extent2d.xmin,t.extent2d.ymax),h=new ks$1(i.pointToCoordinate(a),i.pointToCoordinate(a.add(e.width,e.height)),i.getProjection());return this.layer.drawTile(o,{url:t.url,point:a,center:i.pointToCoordinate(a.add(e.width/2,e.height/2)),extent:h,z:t.z,x:t.x,y:t.y},(function(e){e?s.onTileError(o,t):s.onTileLoad(o,t)})),o}Cu$1.registerRenderer("gl",Cf);var Tf=function(t){function e(){return t.apply(this,arguments)||this}return Pi$4(e,t),e.prototype.loadTile=function(){return Mf.apply(this,arguments)},e}(vf),Sf=function(t){function e(){return t.apply(this,arguments)||this}return Pi$4(e,t),e.prototype.loadTile=function(){return Mf.apply(this,arguments)},e}(Cf);Iu$1.registerRenderer("canvas",Tf),Iu$1.registerRenderer("gl",Sf);var Ef=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.checkResources=function(){var t=this._geosToCheck;if(this._resourceChecked||t||(t=this.layer._geoList),!Ji$4(t))return[];for(var e=[],n={},i=t.length-1;i>=0;i--){var r=t[i]._getExternalResources();if(r.length)if(this.resources)for(var o=0;o<r.length;o++){var s=r[o][0];this.resources.isResourceLoaded(r[o])||n[s]||(e.push(r[o]),n[s]=1)}else e.push.apply(e,r)}return this._resourceChecked=!0,delete this._geosToCheck,e},n.render=function(){return this.layer._sortGeometries(),t.prototype.render.apply(this,arguments)},n._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),Hi$4(this._geosToCheck,t))},n.onGeometryAdd=function(t){this._addGeoToCheckRes(t),Of(this)},n.onGeometryRemove=function(){Of(this)},n.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),Of(this)},n.onGeometryShapeChange=function(){Of(this)},n.onGeometryPositionChange=function(){Of(this)},n.onGeometryZIndexChange=function(){Of(this)},n.onGeometryShow=function(){Of(this)},n.onGeometryHide=function(){Of(this)},n.onGeometryPropertiesChange=function(){Of(this)},e}(pa);function Of(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}var Rf=new Ls$1,If=[],kf=new Ls$1,Df=function(t){function e(){return t.apply(this,arguments)||this}Pi$4(e,t);var n=e.prototype;return n.getImageData=function(){if(!this.layer.options.geometryEvents||!this._lastRenderTime||In$3()-this._lastRenderTime<32)return null;if(!this.context||!this.context.canvas)return null;if(!this._imageData){var t=this.context.canvas,e=t.width,n=t.height;try{this._imageData=this.context.getImageData(0,0,e,n)}catch(t){console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",t)}}return this._imageData},n.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=In$3()},n.checkResources=function(){var e=this,n=t.prototype.checkResources.apply(this,arguments),i=this.layer.getStyle();return i&&(Array.isArray(i)||(i=[i]),i.forEach((function(t){for(var i=Xr$4(t.symbol,!0),r=0,o=i.length;r<o;r++)e.resources.isResourceLoaded(i[r])||n.push(i[r])}))),n},n.needToRedraw=function(){var e=this.getMap();return!(!e.isInteracting()||!this.layer.options.enableAltitude)||!(e.isZooming()&&!e.isRotating()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===Zl)&&t.prototype.needToRedraw.call(this)},n.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},n.isBlank=function(){return!!this.context&&!this.context.canvas._drawn},n.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount(),n=this.mapStateCache.resolution;(t.isZooming()&&t.options.seamlessZoom&&void 0!==this._drawnRes&&n>1.5*this._drawnRes&&this._geosToDraw.length<e||t.isMoving()||t.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._drawnRes=n),this._sortByDistanceToCamera(t.cameraPosition);for(var i=0,r=this._geosToDraw.length;i<r;i++){var o=this._geosToDraw[i];o._isCheck||o.isVisible()?(o._paint(this._displayExtent),this._geosToDraw[i]._cPoint=void 0,this._geosToDraw[i]._inCurrentView=void 0):(delete o._cPoint,delete o._inCurrentView)}this.clearImageData()}},n.show=function(){this.layer.forEach((function(t){t._repaint()})),t.prototype.show.apply(this,arguments)},n.forEachGeo=function(t,e){this.layer.forEach(t,e)},n.drawGeos=function(){this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this.forEachGeo(this.checkGeo,this),this._sortByDistanceToCamera(this.getMap().cameraPosition);for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(),this._geosToDraw[t]._cPoint=void 0,this._geosToDraw[t]._inCurrentView=void 0;this.clearImageData()},n.prepareToDraw=function(){this._hasPoint=!1,this._geosToDraw=[]},n.checkGeo=function(t){if("Point"!==t.type||void 0===this._onlyHasPoint){if(t._isCheck=!1,t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),n=!0;if(t._inCurrentView)n=!0;else if(!1===t._inCurrentView)n=!1;else{var i=e.get2DExtent(this.resources,Rf);i&&i.intersects(this._displayExtent)||(n=!1)}n&&(e.hasPoint()&&(this._hasPoint=!0),t._isCheck=!0,this._geosToDraw.push(t))}}else t._inCurrentView&&(this._hasPoint=!0,t._isCheck=!0,this._geosToDraw.push(t))},n.onZoomEnd=function(){delete this.canvasExtent2D,t.prototype.onZoomEnd.apply(this,arguments)},n.onRemove=function(){this.forEachGeo((function(t){t.onHide()})),delete this._geosToDraw},n.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),t.prototype.onGeometryPropertiesChange.call(this,e)},n._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},n.identifyAtPoint=function(t,e){void 0===e&&(e={});var n=this._geosToDraw;return n?this.layer._hitGeos(n,t,e):[]},n._updateMapStateCache=function(){var t=this.getMap(),e=t._pointToContainerPoint(this.southWest)._add(0,-t.height),n=t.getResolution(),i=t.getPitch(),r=t.getBearing(),o=t.getGLScale(),s=t.getGLRes(),a=t.getContainerExtent(),h=t._get2DExtent(),l=t._get2DExtentAtRes(s);return this.mapStateCache={resolution:n,pitch:i,bearing:r,glScale:o,glRes:s,_2DExtent:h,glExtent:l,containerExtent:a,offset:e},this},n._batchConversionMarkers=function(t){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var e=[],n=[],i=[],r={},o=this.layer,s=o.options,a=o.getAltitude?o.getAltitude():0,h=o.isCanvasRender();this._onlyHasPoint=!0;for(var l=0,c=0,u=this.layer._geoList.length;c<u;c++){var f=this.layer._geoList[c];if("Point"===f.getType()){var d=f._painter;d||(d=f._getPainter());var m=d.getRenderPoints("center")[0][0],g=s.enableAltitude?f._getAltitude():a;void 0===r[g]&&(r[g]=d.getAltitude()),e[l]=m,i[l]=r[g],n[l]=f,l++}else this._onlyHasPoint=!1}if(0===l)return[];var p=this.getMap(),_=ar$4(e,"_pt");_=p._pointsAtResToContainerPoints(e,t,i,_);for(var v=p.getContainerExtent(),y=v.xmax,x=v.ymax,b=v.xmin,w=v.ymin,C={},M=0,T=n.length;M<T;M++){var S=n[M];if(S._cPoint=_[M],S._cPoint){var P=_[M],A=P.x,E=P.y;if(S._inCurrentView=A>=b&&E>=w&&A<=y&&E<=x,!S._inCurrentView){var R,O=S.getSymbolHash();R=O?C[O]=C[O]||S._painter.getFixedExtent():S._painter.getFixedExtent(),kf.set(R.xmin,R.ymin,R.xmax,R.ymax),kf._add(_[M]),S._inCurrentView=kf.intersects(v)}S._inCurrentView&&(S.isVisible()&&h||(S._inCurrentView=!1),this._onlyHasPoint&&S._inCurrentView&&(this._hasPoint=!0,S._isCheck=!0,this._geosToDraw.push(S)))}else S._inCurrentView=!1}return _},n._sortByDistanceToCamera=function(t){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var e=this.getMap(),n=e.distanceToPoint(1e3,0,e.getGLScale()).x/1e3;this._geosToDraw.sort((function(e,i){var r=e.getType(),o=i.getType();if("Point"!==r||"Point"!==o)return 0;var s=e._painter,a=i._painter;if(!s||!a)return 0;var h=s.getRenderPoints("center")[0][0],l=a.getRenderPoints("center")[0][0],c=s.getAltitude()*n,u=a.getAltitude()*n;hc(If,h.x,h.y,c);var f=dc(If,t);return hc(If,l.x,l.y,u),dc(If,t)-f}))}},n._constructorIsThis=function(){return this.constructor===e},e}(Ef);Zl.registerRenderer("canvas",Df);var Lf=function(t){function e(e){var n;return(n=t.call(this,e)||this)._containerIsCanvas=!!e._containerDOM.getContext,n._registerEvents(),n._loopTime=0,n}Pi$4(e,t);var n=e.prototype;return n.load=function(){this.initContainer()},n.renderFrame=function(t){var e=this.map;if(!e||!e.options.renderable)return!1;if(e.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(t),delete this._isViewChanged,e._fireEvent("framestart"),this.updateMapDOM(),e.clearCollisionIndex();var n=this._getAllLayerToRender();return this.drawLayers(n,t),this.drawLayerCanvas(n)&&(this.drawTops(),this._drawCenterCross(),e.options.debugSky&&this._debugSky()),this._needClear=!1,e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,e.uiCollides(),!0},n.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t._getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},n.drawLayers=function(t,e){for(var n=this.map,i=n.isInteracting(),r=[],o=[],s=n.options.fpsOnInteracting||0,a=0===s?0:1e3/s,h=this.map.options.layerCanvasLimitOnInteracting,l=t.length,c=n.getBaseLayer(),u=0,f=0;f<l;f++){var d=t[f];if(d.isVisible()){var m=d.isCanvasRender();m&&r.push(d.getId());var g=d._getRenderer();if(g){var p=this._checkLayerRedraw(d);m&&g.isCanvasUpdated()&&(p||o.push(d.getId()),this.setLayerCanvasUpdated());var _=g.__zoomTransformMatrix;if(delete g.__zoomTransformMatrix,p){if(i&&m){if(h>0&&l-1-f>h&&d!==c){d._getRenderer().clearCanvas();continue}u+=this._drawCanvasLayerOnInteracting(d,u,a,e)}else i&&g.drawOnInteracting?(g.prepareRender&&g.prepareRender(),g.checkAndDraw?g.checkAndDraw(g.drawOnInteracting,this._eventParam,e):g.drawOnInteracting(this._eventParam,e)):(g.render(e),m&&_&&g.isLoadingResource()&&(g.__zoomTransformMatrix=_));m&&(o.push(d.getId()),this.setLayerCanvasUpdated())}else m&&i&&(n.isZooming()&&!n.getPitch()?(g.prepareRender(),g.__zoomTransformMatrix=this._zoomMatrix):(n.getPitch()||n.isRotating())&&g.clearCanvas())}}}var v=this._canvasIds||[],y=this._updatedIds||[];this._canvasIds=r,this._updatedIds=o,this.isLayerCanvasUpdated()||v.join("---")===r.join("---")&&y.join("---")===o.join("---")||this.setLayerCanvasUpdated()},n._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,n=t._getRenderer();return t.isCanvasRender()?n.testIfNeedRedraw():!(!n.needToRedraw||!n.needToRedraw())||e.isInteracting()||this.isViewChanged()},n._drawCanvasLayerOnInteracting=function(t,e,n,i){var r=this.map,o=t._getRenderer(),s=o.getDrawTime(),a=0===n||n>0&&e+s<=n;if(o.mustRenderOnInteracting&&o.mustRenderOnInteracting())o.render(i);else{if(o.drawOnInteracting&&(t===r.getBaseLayer()||a||r.isZooming()&&t.options.forceRenderOnZooming||r.isMoving()&&t.options.forceRenderOnMoving||r.isRotating()&&t.options.forceRenderOnRotating))return o.prepareRender(),o.prepareCanvas(),o.checkAndDraw?o.checkAndDraw(o.drawOnInteracting,this._eventParam,i):o.drawOnInteracting(this._eventParam,i),s;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&o.clearCanvas():(o.prepareRender(),o.__zoomTransformMatrix=this._zoomMatrix)}return o.drawOnInteracting&&!a&&o.onSkipDrawOnInteracting(this._eventParam,i),0},n._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach((function(e){var n=t.getLayer(e);if(n){var i=n._getRenderer();i&&i.isRenderComplete()&&n.fire("layerload")}}))}},n.isLayerCanvasUpdated=function(){return this._canvasUpdated},n.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},n.drawLayerCanvas=function(t){var e=this.map;if(!e)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged()&&!1===this._needClear)return!1;this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var n,i=e.isInteracting(),r=e.options.layerCanvasLimitOnInteracting,o=t.length,s=[],a=0;a<o;a++)if(t[a].isVisible()&&t[a].isCanvasRender()&&t[a]._getRenderer()){var h=this._getLayerImage(t[a]);h&&h.image&&(t[a]===e.getBaseLayer()?n=[t[a],h]:s.push([t[a],h]))}var l=this.canvas.width,c=this.canvas.height;n&&(this._drawLayerCanvasImage(n[0],n[1],l,c),this._drawFog()),o=s.length;for(var u=i&&r>=0&&o>r?o-r:0;u<o;u++)this._drawLayerCanvasImage(s[u][0],s[u][1],l,c);return e._fireEvent("renderend",{context:this.context}),!0},n.setToRedraw=function(){var t=this._getAllLayerToRender();this._needClear=!0;for(var e=0,n=t.length;e<n;e++){var i=t[e].getRenderer();i&&i.canvas&&i.setToRedraw&&i.setToRedraw()}},n.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.height+"px",n=this.map._panels;n.mapWrapper.style.width=t.width+"px",n.mapWrapper.style.height=e,this._updateCanvasSize()}},n.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map._containerDOM:this.map._panels?this.map._panels.mapWrapper:null:null},n.toDataURL=function(t,e){return this.canvas?this.canvas.toDataURL(t,e):null},n.remove=function(){Si$4.webgl&&"undefined"!=typeof document&&(ko$2(document,"visibilitychange",this._thisDocVisibilitychange),ko$2(document,"dragstart",this._thisDocDragStart),ko$2(document,"dragend",this._thisDocDragEnd)),this._resizeInterval&&clearInterval(this._resizeInterval),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},n.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){var n=e._getLayers(),i="default",r=e.options.hitDetectLimit||0,o=0;t&&t._round&&t._round();for(var s=n.length-1;s>=0;s--){var a=n[s];if(!(!a.options.hitDetect||a.isEmpty&&a.isEmpty())){var h=a._getRenderer();if(h&&h.hitDetect&&(!h.isBlank||!h.isBlank())){if("default"!==a.options.cursor&&h.hitDetect(t)){i=a.options.cursor||"pointer";break}if(o++,r>0&&o>r)break}}}e._trySetCursor(i)}},n._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},n.initContainer=function(){var t=this.map._panels;function e(e,n,i,r){var o,s=Eo$2("div",n);return i&&(s.style.cssText=i),t[e]=s,r||((o=s).onselectstart=function(){return!1},o.ondragstart=function(){return!1},o.setAttribute("unselectable","on")),s}var n=this.map._containerDOM;if(!this._containerIsCanvas){n.innerHTML="";var i="position:absolute;top:0px;left:0px;",r=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),o=e("allLayers","maptalks-all-layers",i+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),s=e("backStatic","maptalks-back-static",i+"z-index:0;",!0),a=e("back","maptalks-back",i+"z-index:1;"),h=e("backLayer","maptalks-back-layer",i),l=e("canvasContainer","maptalks-canvas-layer",i+"border:none;z-index:2;"),c=e("frontStatic","maptalks-front-static",i+"z-index:3;",!0),u=e("front","maptalks-front",i+"z-index:4;",!0),f=e("frontLayer","maptalks-front-layer",i+"z-index:0;"),d=e("ui","maptalks-ui",i+"border:none;z-index:1;",!0),m=e("control","maptalks-control","z-index:1",!0);n.appendChild(r),o.appendChild(s),a.appendChild(h),a.layerDOM=h,o.appendChild(a),o.appendChild(l),u.appendChild(f),u.layerDOM=f,u.uiDOM=d,o.appendChild(c),o.appendChild(u),u.appendChild(d),r.appendChild(o),r.appendChild(m),this.createCanvas(),this.resetContainer();var g=this.map._getContainerDomSize();this.updateMapSize(g)}},n.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var t=this._mapview,e=this._getMapView();return this._isViewChanged=!t||!rr$4(t,e),this._isViewChanged},n._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||rr$4(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},n.isSpatialReferenceChanged=function(){return this._spatialRefChanged},n._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},n._frameLoop=function(t){var e=this;this.map?(this._frameTimestamp=t=t||0,this._resizeCount=0,this.renderFrame(t),this._animationFrame=Ei$4((function(t){e._frameLoop(t)}))):this._cancelFrameLoop()},n._cancelFrameLoop=function(){this._animationFrame&&Oi$4(this._animationFrame)},n._drawLayerCanvasImage=function(t,e,n,i){var r=this.context,o=e.point.round(),s=this.map.getDevicePixelRatio();1!==s&&o._multi(s);var a=e.image,h=a.width,l=a.height;if(!(o.x+h<=0||o.y+l<=0)){var c=t.options.opacity;if(Ln$3(c)||(c=1),!(c<=0)){var u=e.opacity;if(Ln$3(u)||(u=1),!(u<=0)){var f=r.globalAlpha;c<1&&(r.globalAlpha*=c),u<1&&(r.globalAlpha*=u),t.options.cssFilter&&(r.filter=t.options.cssFilter);var d=t.getRenderer(),m=d.__zoomTransformMatrix,g=d.clipCanvas(this.context);m&&(r.save(),r.setTransform.apply(r,m)),r.drawImage(a,0,0,h,l,o.x,o.y,n,i),m&&r.restore(),g&&r.restore(),"none"!==r.filter&&(r.filter="none"),r.globalAlpha=f}}}},n._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,n=new Ii$4(this.canvas.width/2,this.canvas.height/2);Hn$3(t)?t(e,n):is$1.drawCross(this.context,n.x,n.y,2,"#f00")}},n._drawContainerExtent=function(){var t=this.map.options.cascadePitches,e=this.map.height-this.map._getVisualHeight(t[0]),n=this.map.height-this.map._getVisualHeight(t[1]),i=this.map.getContainerExtent(),r=this.context;r.beginPath(),r.moveTo(0,i.ymin),r.lineTo(i.xmax,i.ymin),r.stroke(),r.beginPath(),r.moveTo(0,e),r.lineTo(i.xmax,e),r.stroke(),r.beginPath(),r.moveTo(0,n),r.lineTo(i.xmax,n),r.stroke()},n._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch)&&t.options.fog){var e=t.getDevicePixelRatio(),n=this.context,i=t.getContainerExtent(),r=(t.height-t._getVisualHeight(75))*e;r<0&&(r=0);var o=i.ymin*e,s=Math.ceil(o-r),a=t.options.fogColor.join(),h=n.createLinearGradient(0,r,0,o+30),l=1-30/(s+30);h.addColorStop(0,"rgba("+a+", 0)"),h.addColorStop(.3,"rgba("+a+", 0.3)"),h.addColorStop(l,"rgba("+a+", 1)"),h.addColorStop(1,"rgba("+a+", 0)"),n.beginPath(),n.fillStyle=h,n.fillRect(0,r,Math.ceil(i.getWidth())*e,Math.ceil(s+30))}},n._debugSky=function(){var t=this.map;if(!t)return this;var e=t.getContainerExtent().ymin;if(e<=0)return this;var n=this.context;return n.strokeStyle="red",n.strokeRect(0,0,t.width,e),this},n._getAllLayerToRender=function(){return this.map._getLayers()},n.clearCanvas=function(){this.canvas&&is$1.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},n._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),n=this.canvas,i=fr$4(e,t.getDevicePixelRatio()),r=i.width,o=i.height,s=i.cssWidth,a=i.cssHeight;return!n.style||n.style.width===s&&n.style.height===a||(n.style.width=s,n.style.height=a),(r!==n.width||o!==n.height)&&(n.height=o,n.width=r,this.topLayer.width=n.width,this.topLayer.height=n.height,!0)},n.createCanvas=function(){this.topLayer=Eo$2("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map._containerDOM:(this.canvas=Eo$2("canvas"),this._updateCanvasSize(),this.map._panels.canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},n._updateDomPosition=function(t){return void 0===this._checkPositionTime&&(this._checkPositionTime=-1/0),Math.abs(t-this._checkPositionTime)>=500&&(jo$3(this.map._containerDOM),this._checkPositionTime=Math.min(t,this._checkPositionTime)),this},n._checkSize=function(){this.map&&this.map.checkSize()},n._setCheckSizeInterval=function(t){var e=this;Si$4.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver((function(t){!e.map||e.map.isRemoved()?e._resizeObserver.disconnect():t.length&&(e.map._containerDomContentRect=t[0].contentRect,e._checkSize(t[0].contentRect),e._resizeCount=e._resizeCount||0,e.renderFrame((e._frameTimestamp||0)+ ++e._resizeCount/100))})),this._resizeObserver.observe(this.map._containerDOM))):(clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval((function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()}),this._checkSizeInterval))},n._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!Un$3&&"undefined"!=typeof window&&this._setCheckSizeInterval(e.options.checkSizeInterval),Si$4.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",(function(e){t._eventParam=e})),e.on("_zooming",(function(n){e.getPitch()||(t._zoomMatrix=n.matrix.container),t._eventParam=n})),e.on("_zoomend",(function(e){t._eventParam=e,delete t._zoomMatrix})),e.on("_spatialreferencechange",(function(){t._spatialRefChanged=!0})),Si$4.webgl&&"undefined"!=typeof document&&(Io$2(document,"visibilitychange",this._thisDocVisibilitychange,this),Io$2(document,"dragstart",this._thisDocDragStart,this),Io$2(document,"dragend",this._thisDocDragEnd,this)),Si$4.addDPRListening&&Si$4.addDPRListening(this.map)},n._onMapMouseMove=function(t){var e=this,n=this.map;!n.isInteracting()&&n.options.hitDetect&&(this._hitDetectFrame&&Oi$4(this._hitDetectFrame),this._hitDetectFrame=Ei$4((function(){e.hitDetect(t.containerPoint)})))},n._getCanvasLayers=function(){return this.map._getLayers((function(t){return t.isCanvasRender()}))},n.addTopElement=function(t){this._tops||(this._tops=[]),this._tops.push(t)},n.removeTopElement=function(t){if(this._tops){var e=this._tops.indexOf(t);e>=0&&this._tops.splice(e,1)}},n.getTopElements=function(){return this._tops||[]},n.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var t=this.getTopElements(),e=!1,n=0;n<t.length;n++)t[n].render(this.topCtx)&&(e=!0);e&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},e}(function(t){function e(e){var n;return(n=t.call(this)||this).map=e,n._handlerQueue=[],n._thisDocVisibilitychange=n._onDocVisibilitychange.bind(Ai$4(Ai$4(n))),n._thisDocDragStart=n._onDocDragStart.bind(Ai$4(Ai$4(n))),n._thisDocDragEnd=n._onDocDragEnd.bind(Ai$4(Ai$4(n))),n}Pi$4(e,t);var n=e.prototype;return n.callInNextFrame=function(t){this._handlerQueue.push(t)},n.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]()},n.offsetPlatform=function(t,e){if(!this.map._panels.front)return this;if(!e&&0===t.x&&0===t.y)return this;var n=this.map._panels,i=this._frontCount=n.back.layerDOM.childElementCount,r=this._backCount=n.front.layerDOM.childElementCount,o=this._uiCount=n.front.uiDOM.childElementCount;if(i||r||o){var s=this.map.offsetPlatform();s=t?s.add(t)._round():s.round(),r&&Fo$3(n.back,s),(i||o)&&Fo$3(n.front,s)}return this},n.domChanged=function(){var t=this.map._panels;return!!t.front&&(void 0===this._frontCount||this._frontCount!==t.back.layerDOM.childElementCount||void 0===this._backCount||this._backCount!==t.front.layerDOM.childElementCount||void 0===this._uiCount||this._uiCount!==t.front.uiDOM.childElementCount)},n.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map._panels.front)){var t=new Ii$4(0,0);Fo$3(this.map._panels.back,t),Fo$3(this.map._panels.front,t)}},n.onZoomEnd=function(){this.resetContainer()},n.onLoad=function(){this._frameLoop()},n._onDocVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},n._getWrapPanel=function(){if(!this.map)return null;var t=this.map.getPanels();return t&&t.mapWrapper},n._onDocDragStart=function(){var t=this._getWrapPanel();t&&(t.style.overflow="visible")},n._onDocDragEnd=function(){var t=this._getWrapPanel();t&&(t.style.overflow="hidden")},n._containerIsOffscreen=function(){var t=this.map.getContainer();return!t||!t.style||"none"===t.style.display||Math.min(t.clientWidth,t.clientHeight)<=0},e}(cs$2));qh.registerRenderer("canvas",Lf),qh.mergeOptions({fog:!1,fogColor:[233,233,233]});var zf={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};fl.include(zf),Sl.include(zf),Tl.include(zf),Al.include(zf),Pl.include({_getRenderPoints:function(t){var e=this.getMap(),n=e.getGLRes();if("vertex"===t){for(var i=this._trimRing(this.getShell()),r=[],o=0,s=i.length;o<s;o++)r.push(e.coordToPointAtRes(i[o],n));return[r,null]}return[[e.coordToPointAtRes(this.getCenter(),n)],null]}});var Ff={_getRenderPoints:function(t){var e,n=this.getMap(),i=n.getGLRes(),r=null;if("point"===t)(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&e.length>0&&Array.isArray(e[0])&&(e=e[0].concat(e[1]));else if("vertex"===t)if(r=[],(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&e.length>0&&Array.isArray(e[0])){for(var o=0,s=e.length;o<s;o++)for(var a=0,h=e[o].length;a<h;a++)r.push(0===a?[e[o][a],e[o][a+1]]:[e[o][a-1],e[o][a]]);e=e[0].concat(e[1])}else for(var l=0,c=e.length;l<c;l++)r.push(0===l?[e[l],e[l+1]]:[e[l-1],e[l]]);else if("line"===t){e=[],r=[];var u=this._getPath2DPoints(this._getPrjCoordinates(),!1,i);if(u.length>0&&Array.isArray(u[0]))for(var f,d=1,m=u.length;d<m;d++){f=u[d],this instanceof ll&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(f[0]);for(var g=1,p=f.length;g<p;g++)e.push(f[g].add(f[g-1])._multi(.5)),r.push([f[g-1],f[g]])}else{this instanceof ll&&u.length>0&&!u[0].equals(u[u.length-1])&&u.push(u[0]);for(var _=1,v=u.length;_<v;_++)e.push(u[_].add(u[_-1])._multi(.5)),r.push([u[_-1],u[_]])}}else if("vertex-first"===t){var y=this._getPrjCoordinates(),x=y.length,b=x?n._prjToPointAtRes(y[0],i):null;e=x?[b]:[],r=x?[[b,y[1]?n._prjToPointAtRes(y[1],i):b]]:[]}else if("vertex-last"===t){var w=this._getPrjCoordinates(),C=w.length,M=C?n._prjToPointAtRes(w[C-1],i):null;e=C?[M]:[];var T=C>1?C-2:C-1;r=C?[[w[T]?n._prjToPointAtRes(w[T],i):M,M]]:[]}else{var S=this.getCenter();if(S){var P=this._getProjection().project(S);e=[n._prjToPointAtRes(P,i)]}else e=[]}return[e,r]}};ml.include(Ff),ll.include(Ff);var jf={within:!1,center:[0,0]};function Hf(t){if(t&&t._containerBbox){jf.within=!1;var e=t._containerBbox,n=e.minx,i=e.miny,r=e.maxx,o=e.maxy,s=Math.abs(r-n),a=Math.abs(o-i);s<=1&&a<=1&&(jf.within=!0,jf.center[0]=(n+r)/2,jf.center[1]=(i+o)/2),delete t._containerBbox}else jf.within=!1;return jf}kh.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1}});var Nf={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof Sl||this instanceof Al},_paintAsPath:function(){var t=this.getMap();return this._getAltitude()>0||t.getPitch()||this instanceof Sl&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return ll.prototype._getPaintParams.call(this,!0);var e=this._getPrjCoordinates(),n=t._prjToPointAtRes(e,t.getGLRes()),i=this._getRenderSize(n);return[n].concat(i)},_paintOn:function(){return this._paintAsPath()?is$1.polygon.apply(is$1,arguments):is$1.ellipse.apply(is$1,arguments)},_getRenderSize:function(t){var e=this.getMap(),n=e.getGLRes(),i=this._getPrjExtent(),r=e._prjToPointAtRes(i.getMin(),n),o=e._prjToPointAtRes(i.getMax(),n);return[Math.abs(o.x-r.x)/2,Math.abs(o.y-t.y),Math.abs(t.y-r.y)]}};Sl.include(Nf),Tl.include(Nf),Pl.include({_getPaintParams:function(){var t=this.getMap(),e=this._getPrjShell();return[this._getPath2DPoints(e,!1,t.getGLRes())]},_paintOn:is$1.polygon}),Al.include(Nf,{_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return ll.prototype._getPaintParams.call(this,!0);var t=this.getMap(),e=t._prjToPointAtRes(this._getPrjCoordinates(),t.getGLRes());return[e,this._getRenderSize(e)[0],[this.getStartAngle(),this.getEndAngle()]]},_paintOn:function(){if(this._paintAsPath())return is$1.polygon.apply(is$1,arguments);var t=this.getMap().getBearing(),e=arguments;return t&&(e[3]=e[3].slice(0),e[3][0]+=t,e[3][1]+=t),is$1.sector.apply(is$1,e)}}),hl.include({_paintAsPath:function(){return!0}}),ml.include({arrowStyles:{classic:[3,4]},_getArrowShape:function(t,e,n,i,r){if(!t||!e||t.equals(e))return null;r||(r=0);var o,s=n*i[1]+r,a=n*i[0]/2+r;(o=e.sub(e.nextCtrlPoint||e.prevCtrlPoint?new Ii$4(e.prevCtrlPoint?e.prevCtrlPoint:e.nextCtrlPoint):t))._unit();var h=e.sub(o.multi(s));o._perp();var l=h.add(o.multi(a));return o._multi(-1),[l,e,h.add(o.multi(a)),l]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getGLRes())]},_paintOn:function(t,e,n,i,r){var o=Hf(this._painter);o.within?is$1.pixelRect(t,o.center,n,i):this.options.smoothness?is$1.paintSmoothLine(t,e,n,this.options.smoothness,!1,this._animIdx,this._animTailRatio):is$1.path(t,e,n,null,r),this._paintArrow(t,e,n)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,n){var i=this._getArrowStyle();if(!i||t.length<2)return[];for(var r=t.length>0&&Array.isArray(t[0])?t:[t],o=this._getArrowPlacement(),s=[],a=this.getMap(),h=a.coordToContainerPoint(this.getFirstCoordinate()),l=a.coordToContainerPoint(this.getLastCoordinate()),c=r.length-1;c>=0;c--){if("vertex-first"===o||"vertex-firstlast"===o&&r[c][0].closeTo(h,.01)){var u=this._getArrowShape(r[c][1],r[c][0],e,i,n);u&&s.push(u)}if("vertex-last"===o||"vertex-firstlast"===o&&r[c][r[c].length-1].closeTo(l,.01)){var f=this._getArrowShape(r[c][r[c].length-2],r[c][r[c].length-1],e,i,n);f&&s.push(f)}else"point"===o&&this._getArrowPoints(s,r[c],e,i,n)}return s},_getArrowPoints:function(t,e,n,i,r){for(var o=0,s=e.length-1;o<s;o++){var a=this._getArrowShape(e[o],e[o+1],n,i,r);a&&t.push(a)}},_paintArrow:function(t,e,n){var i=this._getInternalSymbol().lineWidth;(!Ln$3(i)||i<3)&&(i=3);var r=this._getArrows(e,i);if(r.length){t.setLineDash&&t.setLineDash([]);for(var o=r.length-1;o>=0;o--)t.fillStyle=t.strokeStyle,is$1.polygon(t,r[o],n,n)}}}),ll.include({_getPaintParams:function(t){var e=this.getMap().getGLRes(),n=this._getPrjShell(),i=this._getPath2DPoints(n,t,e),r=i.length>0&&Array.isArray(i[0]);r&&(i=[[i[0]],[i[1]]]);var o=this._getPrjHoles(),s=[];if(o&&o.length>0){for(var a=this._simplified,h=0;h<o.length;h++){var l=this._getPath2DPoints(o[h],t,e);Array.isArray(l)&&r?Array.isArray(l[0])?(i[0].push(l[0]),i[1].push(l[1])):i[0].push(l):s.push(l)}a&&(this._simplified=a)}return r||Hi$4(i=[i],s),[i]},_paintOn:function(t,e,n,i,r){var o=Hf(this._painter);o.within?is$1.pixelRect(t,o.center,n,i):is$1.polygon(t,e,n,i,r,this.options.smoothness)}}),qh.VERSION="1.0.0-rc.18";var Bf="attribute vec3 aPosition;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = c * getPosition(aPosition);\n  gl_Position = projViewModelMatrix * d;\n}",Gf={exports:{}};function Vf(t,e,n){n=n||2;var i,r,o,s,a,h,l,c=e&&e.length,u=c?e[0]*n:t.length,f=Wf(t,0,u,n,!0),d=[];if(!f||f.next===f.prev)return d;if(c&&(f=function(t,e,n,i){var r,o,s,a=[];for(r=0,o=e.length;r<o;r++)(s=Wf(t,e[r]*i,r<o-1?e[r+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),a.push(ed(s));for(a.sort(Kf),r=0;r<a.length;r++)n=Qf(a[r],n);return n}(t,e,f,n)),t.length>80*n){i=o=t[0],r=s=t[1];for(var m=n;m<u;m+=n)(a=t[m])<i&&(i=a),(h=t[m+1])<r&&(r=h),a>o&&(o=a),h>s&&(s=h);l=0!==(l=Math.max(o-i,s-r))?32767/l:0}return Zf(f,d,n,i,r,l,0),d}function Wf(t,e,n,i,r){var o,s;if(r===md(t,e,n,i)>0)for(o=e;o<n;o+=i)s=ud(o,t[o],t[o+1],s);else for(o=n-i;o>=e;o-=i)s=ud(o,t[o],t[o+1],s);return s&&od(s,s.next)&&(fd(s),s=s.next),s}function Uf(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!od(i,i.next)&&0!==rd(i.prev,i,i.next))i=i.next;else{if(fd(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Zf(t,e,n,i,r,o,s){if(t){!s&&o&&function(t,e,n,i){var r=t;do{0===r.z&&(r.z=td(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,s,a,h,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,i=n,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,h--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(s>1)}(r)}(t,i,r,o);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,o?Jf(t,i,r,o):Xf(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(h.i/n|0),fd(t),t=h.next,l=h.next;else if((t=h)===l){s?1===s?Zf(t=qf(Uf(t),e,n),e,n,i,r,o,2):2===s&&Yf(t,e,n,i,r,o):Zf(Uf(t),e,n,i,r,o,1);break}}}function Xf(t){var e=t.prev,n=t,i=t.next;if(rd(e,n,i)>=0)return!1;for(var r=e.x,o=n.x,s=i.x,a=e.y,h=n.y,l=i.y,c=r<o?r<s?r:s:o<s?o:s,u=a<h?a<l?a:l:h<l?h:l,f=r>o?r>s?r:s:o>s?o:s,d=a>h?a>l?a:l:h>l?h:l,m=i.next;m!==e;){if(m.x>=c&&m.x<=f&&m.y>=u&&m.y<=d&&nd(r,a,o,h,s,l,m.x,m.y)&&rd(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Jf(t,e,n,i){var r=t.prev,o=t,s=t.next;if(rd(r,o,s)>=0)return!1;for(var a=r.x,h=o.x,l=s.x,c=r.y,u=o.y,f=s.y,d=a<h?a<l?a:l:h<l?h:l,m=c<u?c<f?c:f:u<f?u:f,g=a>h?a>l?a:l:h>l?h:l,p=c>u?c>f?c:f:u>f?u:f,_=td(d,m,e,n,i),v=td(g,p,e,n,i),y=t.prevZ,x=t.nextZ;y&&y.z>=_&&x&&x.z<=v;){if(y.x>=d&&y.x<=g&&y.y>=m&&y.y<=p&&y!==r&&y!==s&&nd(a,c,h,u,l,f,y.x,y.y)&&rd(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x.x>=d&&x.x<=g&&x.y>=m&&x.y<=p&&x!==r&&x!==s&&nd(a,c,h,u,l,f,x.x,x.y)&&rd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=_;){if(y.x>=d&&y.x<=g&&y.y>=m&&y.y<=p&&y!==r&&y!==s&&nd(a,c,h,u,l,f,y.x,y.y)&&rd(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=d&&x.x<=g&&x.y>=m&&x.y<=p&&x!==r&&x!==s&&nd(a,c,h,u,l,f,x.x,x.y)&&rd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function qf(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!od(r,o)&&sd(r,i,i.next,o)&&ld(r,o)&&ld(o,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(o.i/n|0),fd(i),fd(i.next),i=t=o),i=i.next}while(i!==t);return Uf(i)}function Yf(t,e,n,i,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&id(s,a)){var h=cd(s,a);return s=Uf(s,s.next),h=Uf(h,h.next),Zf(s,e,n,i,r,o,0),void Zf(h,e,n,i,r,o,0)}a=a.next}s=s.next}while(s!==t)}function Kf(t,e){return t.x-e.x}function Qf(t,e){var n=function(t,e){var n,i=e,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==e);if(!n)return null;var h,l=n,c=n.x,u=n.y,f=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&nd(o<u?r:s,o,c,u,o<u?s:r,o,i.x,i.y)&&(h=Math.abs(o-i.y)/(r-i.x),ld(i,t)&&(h<f||h===f&&(i.x>n.x||i.x===n.x&&$f(n,i)))&&(n=i,f=h)),i=i.next}while(i!==l);return n}(t,e);if(!n)return e;var i=cd(n,t);return Uf(i,i.next),Uf(n,n.next)}function $f(t,e){return rd(t.prev,t,e.prev)<0&&rd(e.next,t,t.next)<0}function td(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ed(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function nd(t,e,n,i,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(i-a)>=(n-s)*(e-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function id(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&sd(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(ld(t,e)&&ld(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(rd(t.prev,t,e.prev)||rd(t,e.prev,e))||od(t,e)&&rd(t.prev,t,t.next)>0&&rd(e.prev,e,e.next)>0)}function rd(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function od(t,e){return t.x===e.x&&t.y===e.y}function sd(t,e,n,i){var r=hd(rd(t,e,n)),o=hd(rd(t,e,i)),s=hd(rd(n,i,t)),a=hd(rd(n,i,e));return r!==o&&s!==a||!(0!==r||!ad(t,n,e))||!(0!==o||!ad(t,i,e))||!(0!==s||!ad(n,t,i))||!(0!==a||!ad(n,e,i))}function ad(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function hd(t){return t>0?1:t<0?-1:0}function ld(t,e){return rd(t.prev,t,t.next)<0?rd(t,e,t.next)>=0&&rd(t,t.prev,e)>=0:rd(t,e,t.prev)<0||rd(t,t.next,e)<0}function cd(t,e){var n=new dd(t.i,t.x,t.y),i=new dd(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function ud(t,e,n,i){var r=new dd(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function fd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function dd(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function md(t,e,n,i){for(var r=0,o=e,s=n-i;o<n;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}Gf.exports=Vf,Gf.exports.default=Vf,Vf.deviation=function(t,e,n,i){var r=e&&e.length,o=Math.abs(md(t,0,r?e[0]*n:t.length,n));if(r)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(md(t,e[s]*n,s<a-1?e[s+1]*n:t.length,n));var h=0;for(s=0;s<i.length;s+=3){var l=i[s]*n,c=i[s+1]*n,u=i[s+2]*n;h+=Math.abs((t[l]-t[u])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[u+1]-t[l+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},Vf.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[r][o][s]);r>0&&n.holes.push(i+=t[r-1].length)}return n};var gd=Gf.exports;const pd=[],_d=[],vd=[1,1,1],yd=[0,0,0,1];class xd{constructor(t,e){this.regl=t,this._viewport=e,this.renderer=new N$8(t),this._init()}_init(){this._maskColorFbo=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._maskModeFbo=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"nearest",min:"nearest"}),depth:!0});const t=[{name:"projViewModelMatrix",type:"function",fn:(t,n)=>multiply$5([],n.projViewMatrix,n.modelMatrix)}];this._maskColorShader=new ie$5({vert:Bf,frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec4 maskColor;\nvoid main() {\n  gl_FragColor = maskColor;\n}",uniforms:t,extraCommandProps:{viewport:this._viewport}}),this._maskModeShader=new ie$5({vert:Bf,frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float maskMode;\nuniform float flatHeight;\nuniform vec2 heightRange;\nvoid main() {\n  gl_FragColor = vec4(maskMode, flatHeight, heightRange.x, heightRange.y);\n}",uniforms:t,extraCommandProps:{viewport:this._viewport}}),this._scene=new yt$6}setExtentPositions(t){this._disposeMeshes();const e=this._calExtent(t),n=[(e[0]+e[2])/2,(e[1]+e[3])/2,0],i=[];for(let e=0;e<t.length;e++){const r=this._createMesh(t[e],n);i.push(r)}this._meshes=i}_createMesh(t,n){const i=[],{position:r,maskColor:o,maskMode:a,flatHeight:h,heightRange:l}=t;for(let t=0;t<r.length;t++){const e=r[t];i.push(e[0]-n[0]),i.push(e[1]-n[1]),i.push(e[2])}const c=gd(i,null,3),u=new Q$7({POSITION:i},c,0,{positionAttribute:"POSITION"});u.generateBuffers(this.regl);const f=new ft$6(u);f.setUniform("maskColor",o),f.setUniform("maskMode",a),f.setUniform("flatHeight",h),f.setUniform("heightRange",l);const d=fromRotationTranslationScale(pd,identity$1(_d),n,vd);return f.localTransform=d,f}render(t){this._resize(),this.renderer.clear({color:yd,depth:1,framebuffer:this._maskColorFbo}),this.renderer.clear({color:yd,depth:1,framebuffer:this._maskModeFbo}),this._scene.setMeshes(this._meshes);const e={projViewMatrix:t};return this.renderer.render(this._maskColorShader,e,this._scene,this._maskColorFbo),this.renderer.render(this._maskModeShader,e,this._scene,this._maskModeFbo),{colorExtent:this._maskColorFbo,modeExtent:this._maskModeFbo}}_calExtent(t){let e=1/0,n=1/0,i=-1/0,r=-1/0;for(let o=0;o<t.length;o++){const{position:s}=t[o];for(let t=0;t<s.length;t++)s[t][0]<e&&(e=s[t][0]),s[t][1]<n&&(n=s[t][1]),s[t][0]>i&&(i=s[t][0]),s[t][1]>r&&(r=s[t][1])}return[e,n,i,r]}_resize(){const t=Mo$2.isFunction(this._viewport.width)?this._viewport.width():this._viewport.width.data(),e=Mo$2.isFunction(this._viewport.height)?this._viewport.height():this._viewport.height.data();!this._maskColorFbo||this._maskColorFbo.width===t&&this._maskColorFbo.height===e||(this._maskColorFbo.resize(t,e),this._maskModeFbo.resize(t,e))}_disposeMeshes(){this._meshes&&(this._meshes.forEach((t=>{t.geometry.dispose(),t.dispose()})),delete this._meshes)}dispose(){this._maskColorFbo&&(this._maskColorFbo.destroy(),delete this._maskColorFbo),this._maskModeFbo&&(this._maskModeFbo.destroy(),delete this._maskModeFbo),this._maskColorShader&&(this._maskColorShader.dispose(),delete this._maskColorShader),this._maskModeShader&&(this._maskModeShader.dispose(),delete this._maskModeShader),this._disposeMeshes()}}const bd=[];class wd{constructor(t,e,n){this._regl=t,this.joints=e,this.inverseBindMatrices=[],this.jointMatrices=[],this.jointData=new Float32Array(16*e.length);for(let t=0;t<e.length;++t)this.inverseBindMatrices.push(new Float32Array(n.buffer,n.byteOffset+16*Float32Array.BYTES_PER_ELEMENT*t,16)),this.jointMatrices.push(new Float32Array(this.jointData.buffer,16*Float32Array.BYTES_PER_ELEMENT*t,16));this.jointTextureSize=[4,6]}update(t,n){invert$2(bd,t);for(let t=0;t<this.joints.length;++t){const i=this.jointMatrices[t];multiply$5(i,bd,n[this.joints[t].nodeIndex]),multiply$5(i,i,this.inverseBindMatrices[t])}return this._regl.texture({width:4,type:"float",height:this.joints.length,data:this.jointData})}}const Cd=[0,0,0],Md=[0,0,0,1],Td=[1,1,1],Sd=[];class Pd{constructor(t=[0,0,0],e=[0,0,0,1],n=[1,1,1]){this.translation=t,this.rotation=e,this.scale=n}getMatrix(){return fromRotationTranslationScale(Sd,this.rotation,this.translation,this.scale)}decompose(t){getTranslation$1(this.translation,t),getRotation(this.rotation,t),getScaling(this.scale,t)}update(t){t&&(t.translation&&!equals$5(t.translation,Cd)&&copy$4(this.translation,t.translation),t.rotation&&!equals$3(t.rotation,Md)&&copy$2(this.rotation,t.rotation),t.scale&&!equals$5(t.scale,Td)&&copy$4(this.scale,t.scale))}}class Ad{constructor(t){this._init(t)}_init(t){this.geometry=t.geometry,this.nodeMatrix=t.nodeMatrix,this.materialInfo=t.materialInfo,this.extraInfo=t.extraInfo,this.animationMatrix=t.animationMatrix,this.morphWeights=t.morphWeights,this.skin=t.skin,this.nodeIndex=t.nodeIndex}copy(){this.copyGeometry||(this.copyGeometry=this._copyGeometry(this.geometry))}createCopyBarycentric(){this.copyGeometry&&!this.copyGeometry.data.aBarycentric&&(this.copyGeometry.buildUniqueVertex(),this.copyGeometry.createBarycentric("aBarycentric"))}_copyGeometry(t){const e=t.data,n=t.elements,i={};for(const n in e)if(y$5(e[n]))i[n]=e[n].slice();else if(e[n].buffer&&e[n].buffer.destroy)i[n]={buffer:e[n].buffer},y$5(e[n].array)&&(i[n].array=e[n].array.slice());else{const e=t._getAttributeData(n);i[n]=n!==t.desc.positionAttribute?e:e.slice()}const r=void 0!==n.length?n.slice():n,o=t.count,s=JSON.parse(JSON.stringify(t.desc)),a=new Q$7(i,r,o,s);return a.properties=t.properties,a}}let Ed=0;class Od{constructor(t,e){this.gltf=t,this.regl=e,this.geometries=[],e&&(this._emptyTexture=e.texture({width:2,height:2}))}getMeshesInfo(){return this.gltf?(this.geometries.length||(this._createTextures(this.gltf.textures),this._createSkins(this.gltf.skins),this.gltf.scenes[0].nodes.forEach((t=>{this._parserNode(t,this.geometries)}))),this.geometries):null}_createSkins(t){if(t){this._skinMap={};for(let e=0;e<t.length;e++){const n=t[e];n.joints=n.joints.map((t=>this.gltf.nodes[t])),this._skinMap[e]=new wd(this.regl,n.joints,n.inverseBindMatrices.array),delete n.inverseBindMatrices}}}_createTextures(t){if(t){this._textureMap={};for(let e=0;e<t.length;e++){const n=t[e];this._textureMap[e]||(this._textureMap[e]=this._toTexture(n),delete n.image)}}}dispose(){this._emptyTexture&&this._emptyTexture.destroy();const t=this.getMeshesInfo();if(t){t.forEach((t=>{t.geometry.dispose();for(const e in t.materialInfo){const n=t.materialInfo[e];n.destroy&&!n[L$8]&&n.destroy()}}));for(const t in this._textureMap){const e=this._textureMap[t];e.destroy&&!e[L$8]&&e.destroy()}delete this.gltf}}updateAnimation(e,n,i,r,o,s,a){const h=this.gltf;if(!h)return;if(Ed=h.animations?k$8.getAnimationTimeSpan(h,r):null,!Ed)return;e-=o;let l=0;l=n||!n&&this._isFirstLoop(e,i,r,o)?e*i*.001%(Ed.max-Ed.min)+Ed.min:e*i*.001+Ed.min,h.scenes[0].nodes.forEach((t=>{this._updateNodeMatrix(r,l,t,null,s)}));for(const t in this.gltf.nodes){const e=this.gltf.nodes[t],n=s[e.nodeIndex];if(e.skin&&n){const t=e.skin.update(n,s);a[e.nodeIndex]={jointTextureSize:[4,6],numJoints:e.skin.joints.length,jointTexture:t}}}}_isFirstLoop(e,n,i,r){const o=this.gltf;return!r||!o||(Ed=o.animations?k$8.getAnimationTimeSpan(o,i):null,e*n*.001/(Ed.max-Ed.min)<1)}hasSkinAnimation(){return!!this._isAnimation}_updateNodeMatrix(n,i,r,o,s){if(r.trs){const e=k$8.getAnimationClip(this.gltf,Number(r.nodeIndex),i,n);e.weights&&this._updateMorph(r,e.weights),r.trs.update(e)}s[r.nodeIndex]=o?multiply$5(s[r.nodeIndex]||[],o,r.matrix||r.trs.getMatrix()):copy$5(s[r.nodeIndex]||[],r.matrix||r.trs.getMatrix()),r.children&&r.children.forEach((t=>{this._updateNodeMatrix(n,i,t,s[r.nodeIndex],s)})),this._updateSkinTexture(r)}_updateMorph(t,e){const n=e.length;if(!t.influencesList){t.influencesList=[];for(let e=0;e<n;e++)t.influencesList[e]=[e,0]}const i=t.influencesList;for(let t=0;t<i.length;t++){const n=i[t];n[0]=t,n[1]=e[t]}i.sort(Id);const r=[];for(let t=0;t<8;t++)r[t]=[t,0];for(let t=0;t<8;t++)t<n&&i[t][1]?(r[t][0]=i[t][0],r[t][1]=i[t][1]):(r[t][0]=Number.MAX_SAFE_INTEGER,r[t][1]=0);r.sort(Rd),t.geometries.forEach((t=>{const e=t.properties.morphTargets;for(let n=0;n<8;n++){const i=r[n],o=i[0],s=i[1];o!==Number.MAX_SAFE_INTEGER&&s?(t.updateData("POSITION"+n,e["POSITION_"+o].array),t.properties.morphWeights[n]=s):t.properties.morphWeights[n]=0}}))}_updateSkinTexture(t){if(!this.gltf.joints)return;const e=this.gltf.animations;if(!e)return;const n=this.gltf.joints.length;e.forEach((e=>{const i=e.channels;for(let e=0;e<i.length;e++)i[e].target.node===t.nodeIndex&&t.skin.updateJointTexture(n)}))}_parserNode(t,n,i){if(t.isParsed)return;t.nodeMatrix=t.nodeMatrix||identity$2([]),t.localMatrix=t.localMatrix||identity$2([]),t.matrix?(t.trs=new Pd,t.trs.decompose(t.matrix)):t.trs=new Pd(t.translation,t.rotation,t.scale),t.localMatrix=t.trs.getMatrix(),i?multiply$5(t.nodeMatrix,i,t.matrix||t.localMatrix):copy$5(t.nodeMatrix,t.matrix||t.localMatrix);const r=t.nodeMatrix;if(t.children)for(let e=0;e<t.children.length;e++)this._parserNode(t.children[e],n,r);if(f$2(t.skin)){this._isAnimation=!0;const e=t.skin;t.trs=new Pd,t.skin=this._skinMap[e]}f$2(t.mesh)&&(t.mesh=this.gltf.meshes[t.mesh],t.mesh.node=t,t.geometries=t.geometries||[],t.mesh.primitives.forEach((e=>{const i=function(t,e){const n=t.attributes,i=n.COLOR_0;if(i&&i.array instanceof Float32Array){const t=new Uint8Array(i.array.length);for(let e=0;e<t.length;e++)t[e]=Math.round(255*i.array[e]);i.array=t}else if(i&&i.array instanceof Uint16Array){const t=new Uint8Array(i.array);i.array=t}const r={};for(const t in n)r[t]=g$3({},n[t]),e&&(r[t].buffer=Nt$5(e,n[t],{dimension:n[t].itemSize}));if(t.morphTargets){const t=E$6(r.POSITION)?r.POSITION.itemSize*r.POSITION.count:r.POSITION.array.length;for(let e=0;e<8;e++)r["POSITION"+e]||(r["POSITION"+e]=new Float32Array(t).fill(0));for(let t=0;t<4;t++){const e=r.NORMAL.array?r.NORMAL.array.length:r.NORMAL.length;r["NORMAL"+t]||(r["NORMAL"+t]=new Float32Array(e).fill(0))}}let o=t.indices;o&&void 0===o.bufferView&&o.array&&(o=o.array);const s=new Q$7(r,o,0,{primitive:_$6(t.mode)?Pt$5(t.mode):t.mode,positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",color0Attribute:"COLOR_0"});return t.morphTargets&&(s.properties.morphWeights=[]),t.mode>3&&!s.data.NORMAL&&s.createNormal("NORMAL"),s}(e,this.regl);i.properties.morphTargets=e.morphTargets,t.geometries.push(i);const o=this._createMaterialInfo(e.material),s={geometry:i,nodeMatrix:r,materialInfo:o,extraInfo:this._createExtralInfo(e.material),animationMatrix:t.trs.getMatrix(),morphWeights:t.weights,nodeIndex:t.nodeIndex};t.skin&&(s.skin={jointTextureSize:[4,6],numJoints:t.skin.joints.length,jointTexture:t.skin.jointTexture});const a=new Ad(s);n.push(a)}))),t.isParsed=!0}_createMaterialInfo(t){const e={};if(this.gltf.materials&&this.gltf.materials[t]){const n=this.gltf.materials[t],i=n.pbrMetallicRoughness;if(i){const t=i.metallicRoughnessTexture,n=i.baseColorTexture;n&&(e.baseColorTexture=this._getTexture(n),n.KHR_texture_transform&&(e.khr_offset=n.KHR_texture_transform.offset||[0,0],e.khr_rotation=n.KHR_texture_transform.rotation||0,e.khr_scale=n.KHR_texture_transform.scale||[1,1])),i.baseColorFactor&&(e.baseColorFactor=i.baseColorFactor),t?e.metallicRoughnessTexture=this._getTexture(t):(f$2(i.metallicFactor)&&(e.metallicFactor=i.metallicFactor),f$2(i.roughnessFactor)&&(e.roughnessFactor=i.roughnessFactor))}const r=n.extensions;if(r&&r.KHR_materials_pbrSpecularGlossiness){const t=r.KHR_materials_pbrSpecularGlossiness;e.name="pbrSpecularGlossiness";for(const n in t)e[n]=f$2(t[n].index)?this._getTexture(t[n]):t[n]}n.normalTexture&&(e.normalTexture=this._getTexture(n.normalTexture)),n.occlusionTexture&&(e.occlusionTexture=this._getTexture(n.occlusionTexture)),n.emissiveTexture&&(e.emissiveTexture=this._getTexture(n.emissiveTexture)),n.emissiveFactor&&(e.emissiveFactor=n.emissiveFactor),e.alphaCutoff=n.alphaCutoff||.5}return e}_createExtralInfo(t){const e={};if(this.gltf.materials&&this.gltf.materials[t]){const n=this.gltf.materials[t];e.doubleSided=n.doubleSided,e.alphaMode=n.alphaMode||"OPAQUE"}return e}_getTexture(t){const e=t.extensions,n=t.index;if(!f$2(n))return null;e&&e.KHR_texture_transform&&(t.KHR_texture_transform=e.KHR_texture_transform);const i=this._textureMap[n];return i.texInfo=t,i}_toTexture(t){if(!t)return this._emptyTexture;const e=t.sampler||{};return new Vt$5({width:t.image.width,height:t.image.height,data:t.image.array,mag:kt$5(e.magFilter)||"linear",min:Lt$5(e.minFilter)||"linear",wrapS:Ft$5(e.wrapS)||"repeat",wrapT:Ft$5(e.wrapT)||"repeat"})}}function Rd(t,e){return t[0]-e[0]}function Id(t,e){return Math.abs(e[1])-Math.abs(t[1])}function kd(e){const n=e.lastIndexOf("/"),i=e.slice(0,n),r=e.slice(e.lastIndexOf(".")).toLowerCase();return".gltf"===r?function(e,n){return w$8.getJSON(e,{})}(e).then((t=>Ld(i,t))):".glb"===r?function(e,n){return w$8.getArrayBuffer(e,{})}(e).then((t=>Ld(i,{buffer:t.data,byteOffset:0}))):null}function Dd(t,e){return new Od(t,e)}function Ld(e,n){return new k$8(e,n).load()}var zd=Object.freeze({__proto__:null,load:kd,exportGLTFPack:Dd,loadGLTF:Ld});const Bd={vertices:[-.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0],normals:[-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012],indices:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},Gd={cube:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1])},NORMAL:{array:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1])}},indices:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),mode:4}]}],scenes:[{nodes:[{mesh:0}]}]},plane:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array([-1,0,-1,1,0,-1,-1,0,1,1,0,1])},NORMAL:{array:new Int8Array([0,1,0,0,1,0,0,1,0,0,1,0])},TEXCOORD_0:{array:new Int8Array([0,0,1,0,0,1,1,1])}},indices:new Uint16Array([3,1,0,0,2,3]),mode:4}]}],scenes:[{nodes:[{mesh:0}]}]},pyramid:{meshes:[{primitives:[{attributes:{POSITION:{array:new Float32Array(Bd.vertices)},NORMAL:{array:new Float32Array(Bd.normals)},TEXCOORD_0:{array:new Float32Array(Bd.uv)}},indices:new Uint16Array(Bd.indices),mode:4}]}],scenes:[{nodes:[{mesh:0}]}]}};class Vd{constructor(t,e){this.regl=t,this.resourceMap={},this._requestor=e}getGLTF(t){return this.resourceMap[t]}loginGLTF(t){if(this.resourceMap[t])this.resourceMap[t].refCount+=1;else{if(Gd[t]){const e=function(t){let e=null;return Gd[t]&&(e={meshes:Gd[t].meshes},e.scenes=JSON.parse(JSON.stringify(Gd[t].scenes))),e}(t);this.resourceMap[t]=this._exportGLTFResource(e,t,!1)}else this.resourceMap[t]=this._requestor?this._requestor(t).then((e=>{const n=this._exportGLTFResource(e,t);return this.resourceMap[t]=n,n})):this._loadGLTFModel(t).catch((t=>t));this.resourceMap[t].refCount=1}}logoutGLTF(t){if(this.resourceMap[t]&&(this.resourceMap[t].refCount-=1,this.resourceMap[t].refCount<1)){const e=this.resourceMap[t].resources;if(e)for(let t=0;t<e.length;t++)e[t].geometry.dispose(),e[t].copyGeometry&&e[t].copyGeometry.dispose(),e[t].material&&e[t].material.dispose();this.resourceMap[t].gltfPack&&this.resourceMap[t].gltfPack.dispose(),delete this.resourceMap[t]}}isSimpleModel(t){return Gd[t]}_exportGLTFResource(t,e,n=!0){const i=Dd(t,n?this.regl:null),r=i.getMeshesInfo();return{gltfPack:i,resources:r,json:{asset:t.asset,animations:t.animations?t.animations.map((t=>({name:t.name}))):null},refCount:this.resourceMap[e]?this.resourceMap[e].refCount:0}}_loadData(t){return kd(t).then((t=>t))}_loadGLTFModel(t){return this._loadData(t).then((e=>(this.resourceMap[t]=this._exportGLTFResource(e,t),this.resourceMap[t])))}}const Wd=function(){const t=[0,0,0],n=90*Math.PI/180,i=[0,0,0,0],r=new Array(16);return function(o,s,a,h,l,c){const u=[lookAt([],t,[1,0,0],c&&c[0]||[0,-1,0]),lookAt([],t,[-1,0,0],c&&c[1]||[0,-1,0]),lookAt([],t,[0,1,0],c&&c[2]||[0,0,1]),lookAt([],t,[0,-1,0],c&&c[3]||[0,0,-1]),lookAt([],t,[0,0,1],c&&c[4]||[0,-1,0]),lookAt([],t,[0,0,-1],c&&c[5]||[0,-1,0])],f={context:{viewMatrix:function(t,e,n){return u[n]},projMatrix:perspective(r,n,1,.5,1.1)}};return s&&(f.framebuffer=s.faces?function(t,e,n){return s.faces[n]}:s),o(f)(6,((t,e,n)=>{const r={color:i,depth:1};s&&(r.framebuffer=s.faces?s.faces[n]:s),o.clear(r),a(h),l&&l()})),s}}();var Ud={vertices:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],textures:[1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},Zd="#define SHADER_NAME CUBE_MAP\nattribute vec3 aPosition;\nvarying vec3 vWorldPos;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nvoid main() {\n  vWorldPos = aPosition;\n  gl_Position = projMatrix * viewMatrix * vec4(vWorldPos, 1.);\n}",Xd="precision highp float;\n#define PI 3.1415926\nvarying vec3 vWorldPos;\nuniform sampler2D equirectangularMap;\nconst vec2 c = vec2(.1591, .3183);\nvec2 d(vec3 e) {\n  vec2 f = vec2(atan(e.y, e.x), asin(e.z));\n  f *= c;\n  f += .5;\n  return f;\n}\nvec3 h(const in vec4 i, const in float j) {\n  return j * i.rgb * i.a;\n}\nvec4 k(const in vec3 i, const in float j) {\n  vec4 l;\n  vec3 m = i / j;\n  l.a = clamp(max(max(m.r, m.g), max(m.b, 1e-6)), .0, 1.);\n  l.a = ceil(l.a * 255.) / 255.;\n  l.rgb = m / l.a;\n  return l;\n}\nvoid main() {\n  vec2 f = d(normalize(vWorldPos));\n  vec4 i = texture2D(equirectangularMap, f);\n#ifdef INPUT_RGBM\ngl_FragColor = i;\n#else\ngl_FragColor = vec4(h(i, 7.), 1.);\n#endif\n}";
/*!
	 * from claygl
	 * https://github.com/pissang/claygl/
	 * License: BSD-2-Clause
	 */function Jd(t,e){var n=t[0],i=t[1],r=t[2];return 0===e?1:1===e?n:2===e?i:3===e?r:4===e?n*r:5===e?i*r:6===e?n*i:7===e?3*r*r-1:n*n-i*i}var qd={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]},Yd=["px","nx","py","ny","pz","nz"];const Kd=Xt$5.compile(Le$4);function Qd(t,e,n){const i=t({frag:Kd,vert:Zd,attributes:{aPosition:Ud.vertices},uniforms:{projMatrix:t.context("projMatrix"),viewMatrix:t.context("viewMatrix"),cubeMap:e,environmentExposure:1,bias:0,size:n,hsv:[0,0,0]},elements:Ud.indices}),r=[],o=t.framebuffer(n);return Wd(t,o,i,{size:n},(function(){const e=t.read();r.push(new e.constructor(e))})),i.destroy(),o.destroy(),r}const $d=new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]),tm=new Int8Array([0,1,0,0,1,1,1,0]);function em(t,e,n,i){e=e||256;const r=nm(n=n||1024,i=i||256),o=t.texture({data:r,width:i,height:n,min:"nearest",mag:"nearest"}),s=t.buffer($d),a=t.buffer(tm),h=t.framebuffer({radius:e,colorType:"uint8",colorFormat:"rgba",min:"linear",mag:"linear"}),l=t({frag:"precision mediump float;\nvarying vec2 vTexCoords;\nuniform sampler2D distributionMap;\nconst float c = 3.14159265359;\nvec4 d(float a, float b) {\n  a *= 65535.;\n  b *= 65535.;\n  vec4 rgba;\n  rgba[0] = mod(a, 255.);\n  rgba[1] = (a - rgba[0]) / 65280.0;\n  rgba[2] = mod(b, 255.);\n  rgba[3] = (b - rgba[2]) / 65280.0;\n  return rgba;\n}\nvec3 e(float f, vec3 h, float i) {\n  vec4 j = texture2D(distributionMap, vec2(i, f));\n  vec3 k = j.xyz;\n  float l = sign(j.w - .5);\n  float m = sign(j.w - clamp(l, .0, 1.) * 200.0 / 255. - .15);\n  k.x *= l;\n  k.y *= m;\n  vec3 n = abs(h.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 o = normalize(cross(n, h));\n  vec3 u = cross(h, o);\n  vec3 v = o * k.x + u * k.y + h * k.z;\n  return normalize(v);\n}\nfloat A(float B, float i) {\n  float a = i;\n  float C = (a * a) / 2.;\n  float D = B;\n  float E = B * (1. - C) + C;\n  return D / E;\n}\nfloat F(float B, float G, float i) {\n  float I = A(B, i);\n  float J = A(G, i);\n  return J * I;\n}\nvec2 K(float B, float i) {\n  vec3 L;\n  L.x = sqrt(1. - B * B);\n  L.y = .0;\n  L.z = B;\n  float M = .0;\n  float O = .0;\n  vec3 h = vec3(.0, .0, 1.);\n  const int P = 1024;\n  for(int Q = 0; Q < P; ++Q) {\n    vec3 k = e(float(Q) / float(P), h, i);\n    vec3 R = normalize(2. * dot(L, k) * k - L);\n    float G = max(R.z, .0);\n    float S = max(k.z, .0);\n    float T = max(dot(L, k), .0);\n    float B = max(dot(h, L), .0);\n    if(G > .0) {\n      float U = F(B, G, i);\n      float W = (U * T) / (S * B);\n      float X = pow(1. - T, 5.);\n      M += (1. - X) * W;\n      O += X * W;\n    }\n  }\n  M /= float(P);\n  O /= float(P);\n  return vec2(M, O);\n}\nvoid main() {\n  vec2 Y = K(vTexCoords.x, vTexCoords.y);\n  gl_FragColor = d(Y.x, Y.y);\n}",vert:"attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoords;\nvoid main() {\n  vTexCoords = aTexCoord;\n  gl_Position = vec4(aPosition, 1.);\n}",attributes:{aPosition:{buffer:s},aTexCoord:{buffer:a}},uniforms:{distributionMap:o},framebuffer:h,viewport:{x:0,y:0,width:e,height:e},count:$d.length/3,primitive:"triangle strip"});return l(),l.destroy(),s.destroy(),a.destroy(),o.destroy(),h}function nm(t,e){const n=new Array(t*e*4);for(let i=0;i<t;i++){const{x:r,y:o}=im(i,t);for(let t=0;t<e;t++){const s=t/e,a=s*s,h=2*Math.PI*r,l=Math.sqrt((1-o)/(1+(a*a-1)*o)),c=Math.sqrt(1-l*l),u=4*(i*e+t),f=c*Math.cos(h),d=c*Math.sin(h);n[u]=Math.abs(255*f),n[u+1]=Math.abs(255*d),n[u+2]=255*l,n[u+3]=(f>0?200:0)+(d>0?55:0)}}return n}function im(t,e){let n=(t<<16|t>>>16)>>>0;return n=((1431655765&n)<<1|(2863311530&n)>>>1)>>>0,n=((858993459&n)<<2|(3435973836&n)>>>2)>>>0,n=((252645135&n)<<4|(4042322160&n)>>>4)>>>0,n=(((16711935&n)<<8|(4278255360&n)>>>8)>>>0)/4294967296,{x:t/e,y:n}}var rm=Object.freeze({__proto__:null,createIBLMaps:function(t,e={}){const i=e.envTexture,r=e.envCubeSize||512,o=e.sampleSize||1024,s=e.roughnessLevels||256,a=e.prefilterCubeSize||256;let h;if(Array.isArray(i)){const n=t.cube({flipY:!0,faces:i});h=function(t,e,n,i,r){const o=t({frag:"#define ENC_RGBM 1\n"+Kd,vert:Zd,attributes:{aPosition:Ud.vertices},uniforms:{hsv:[0,0,0],projMatrix:t.context("projMatrix"),viewMatrix:t.context("viewMatrix"),cubeMap:e,bias:0,size:e.width,environmentExposure:1,rgbmRange:r},elements:Ud.indices}),s=t.cube({width:n,height:n,min:"linear",mag:"linear",format:"rgba"}),a=t.framebufferCube({radius:n,color:s});return Wd(t,a,o,{size:n},null,[[0,0,-1],[0,0,-1],[0,0,1],[0,0,1],[0,-1,0],[0,-1,0]]),o.destroy(),a}(t,n,r,0,e.rgbmRange),n.destroy()}else h=function(t,e,n,i){n=n||512;const r=t({frag:"#define INPUT_RGBM 1\n"+Xd,vert:Zd,attributes:{aPosition:Ud.vertices},uniforms:{projMatrix:t.context("projMatrix"),viewMatrix:t.context("viewMatrix"),equirectangularMap:e},elements:Ud.indices}),o=t.cube({width:n,height:n,min:"linear",mag:"linear",format:"rgba"}),s=t.framebufferCube({radius:n,color:o});return Wd(t,s,r),r.destroy(),s}(t,i,r);const{prefilterMap:l,prefilterMipmap:c}=function(t,e,n,i,r,o){const s=function(t,e,n,i,r,o){const s=nm(r=r||1024,o=o||256),a=t.texture({data:s,width:o,height:r,min:"nearest",mag:"nearest"}),h=t({frag:"#define SHADER_NAME PBR_prefilter\nprecision highp float;\nvarying vec3 vWorldPos;\nuniform samplerCube environmentMap;\nuniform sampler2D distributionMap;\nuniform float roughness;\nuniform float resolution;\nuniform float rgbmRange;\nconst float c = 3.14159265359;\nfloat d(vec3 e, vec3 f, float h) {\n  float a = h * h;\n  float i = a * a;\n  float j = max(dot(e, f), .0);\n  float k = j * j;\n  float l = i;\n  float m = (k * (i - 1.) + 1.);\n  m = c * m * m;\n  return l / m;\n}\nvec3 n(float o, vec3 e, float h) {\n  vec4 u = texture2D(distributionMap, vec2(h, o));\n  vec3 f = u.xyz;\n  float v = sign(u.w - .5);\n  float A = sign(u.w - 200.0 / 255. * clamp(v, .0, 1.) - .15);\n  f.x *= v;\n  f.y *= A;\n  vec3 B = abs(e.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 C = normalize(cross(B, e));\n  vec3 D = cross(e, C);\n  vec3 E = C * f.x + D * f.y + e * f.z;\n  return normalize(E);\n}\nvec4 F(const in vec3 G, const in float I) {\n  if(I <= .0)\n    return vec4(G, 1.);\n  vec4 J;\n  vec3 K = G / I;\n  J.a = clamp(max(max(K.r, K.g), max(K.b, 1e-6)), .0, 1.);\n  J.a = ceil(J.a * 255.) / 255.;\n  J.rgb = K / J.a;\n  return J;\n}\nvec3 L(const in vec4 G, const in float I) {\n  if(I <= .0)\n    return G.rgb;\n  return I * G.rgb * G.a;\n}\nvoid main() {\n  vec3 e = normalize(vWorldPos);\n  vec3 M = e;\n  vec3 O = M;\n  const int P = 1024;\n  vec3 Q = vec3(.0);\n  float S = .0;\n  for(int T = 0; T < P; ++T) {\n    vec3 f = n(float(T) / float(P), e, roughness);\n    vec3 U = normalize(2. * dot(O, f) * f - O);\n    float W = max(dot(e, U), .0);\n    if(W > .0) {\n      Q += L(textureCube(environmentMap, U), rgbmRange).rgb * W;\n      S += W;\n    }\n  }\n  Q = Q / S;\n  gl_FragColor = F(Q, rgbmRange);\n}",vert:Zd,attributes:{aPosition:Ud.vertices},uniforms:{projMatrix:t.context("projMatrix"),viewMatrix:t.context("viewMatrix"),environmentMap:e,distributionMap:a,roughness:t.prop("roughness"),resolution:i,rgbmRange:n||7},elements:Ud.indices,viewport:{x:0,y:0,width:t.prop("size"),height:t.prop("size")}});let l=i;const c=t.texture({radius:i,min:"linear",mag:"linear"}),u=t.framebuffer({radius:i,color:c}),f=Math.log(l)/Math.log(2),d=[];for(let e=0;e<=f;e++){let n=0;Wd(t,u,h,{roughness:e/(f-1),size:l},(function(){const e=t.read({framebuffer:u});d[n]||(d[n]={mipmap:[]}),d[n].mipmap.push(e),n++})),l/=2,u.resize(l)}return a.destroy(),u.destroy(),h.destroy(),d}(t,e,n,i,r,o);return{prefilterMap:t.cube({radius:i,min:"linear mipmap linear",mag:"linear",faces:s}),prefilterMipmap:s}}(t,h,e.rgbmRange,a,o,s);let u;if(!e.ignoreSH){const e=a;u=function(t,e,i){for(var r=new Array(9),o=[],s=[],a=[],h=0;h<9;h++){for(var l=[0,0,0],c=0;c<Yd.length;c++){for(var u=t[c],f=[0,0,0],d=0,m=0,g=qd[Yd[c]],p=0;p<i;p++)for(var _=0;_<e;_++){o[0]=_/(e-1)*2-1,o[1]=p/(i-1)*2-1,o[2]=-1,normalize$4(o,o),a[0]=o[g[0]]*g[3],a[1]=o[g[1]]*g[4],a[2]=o[g[2]]*g[5],s[0]=u[m++]/255,s[1]=u[m++]/255,s[2]=u[m++]/255;var v=u[m++]/255*7;s[0]*=v,s[1]*=v,s[2]*=v,scaleAndAdd$2(f,f,s,Jd(a,h)*-o[2]),d+=-o[2]}scaleAndAdd$2(l,l,f,1/d)}r[h]=scale$4(l,l,1/6)}return r}(Qd(t,l,e),e,e);const i=[];for(let t=0;t<u.length;t++)i.push(...u[t]);u=i}const f={rgbmRange:e.rgbmRange,envMap:h,prefilterMap:l};return u&&(f.sh=u),"array"===e.format&&(f.envMap={width:h.width,height:h.height,faces:Qd(t,h,r)},f.prefilterMap={width:l.width,height:l.height,faces:c},h.destroy(),l.destroy()),f},generateDFGLUT:em});const om={uvScale:[1,1],uvOffset:[0,0],uvRotation:0,baseColorFactor:[1,1,1,1],emissiveFactor:[0,0,0],baseColorIntensity:1,anisotropyDirection:0,anisotropyFactor:0,clearCoatFactor:0,clearCoatIor:1.4,clearCoatRoughnessFactor:.04,clearCoatThickness:5,emitColorFactor:1,occlusionFactor:1,roughnessFactor:.4,metallicFactor:0,normalMapFactor:1,specularF0:.5,emitMultiplicative:1,normalMapFlipY:0,outputSRGB:1,baseColorTexture:null,normalTexture:null,occlusionTexture:null,metallicRoughnessTexture:null,emissiveTexture:null,uvOrigin:[0,0],noiseTexture:null,clearCoatTint:[.006,.006,.006],specularAAVariance:20,specularAAThreshold:20,hsv:[0,0,0],contrast:1,bumpTexture:null,bumpScale:.05,bumpMinLayers:5,bumpMaxLayers:20};class sm extends tt$6{constructor(t){const e=g$3({},om);(t.metallicRoughnessTexture||t.metallicRoughnessTexture)&&(e.roughnessFactor=1,e.metallicFactor=1),super(t,e)}appendDefines(t,e){super.appendDefines(t,e);const n=this.uniforms;return n.GAMMA_CORRECT_INPUT&&(t.GAMMA_CORRECT_INPUT=1),e.data[e.desc.colorAttribute]&&(t.HAS_COLOR=1),e.data[e.desc.color0Attribute]&&(t.HAS_COLOR0=1,t.COLOR0_SIZE=e.getColor0Size()),e.data[e.desc.tangentAttribute]?t.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(t.HAS_NORMAL=1),e.data[e.desc.uv0Attribute]?(n.baseColorTexture&&(t.HAS_ALBEDO_MAP=1),n.metallicRoughnessTexture&&(t.HAS_METALLICROUGHNESS_MAP=1),n.occlusionTexture&&(t.HAS_AO_MAP=1),n.emissiveTexture&&(t.HAS_EMISSIVE_MAP=1),n.normalTexture&&(t.HAS_NORMAL_MAP=1),n.bumpTexture&&(t.HAS_BUMP_MAP=1),(t.HAS_ALBEDO_MAP||t.HAS_METALLICROUGHNESS_MAP||t.HAS_AO_MAP||t.HAS_EMISSIVE_MAP||t.HAS_NORMAL_MAP||t.HAS_BUMP_MAP)&&(t.HAS_MAP=1),n.noiseTexture&&(t.HAS_RANDOM_TEX=1),e.data[e.desc.tangentAttribute]?t.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(t.HAS_NORMAL=1),t):t}}class am extends(ht$6(sm)){}function hm(t,e,n){if(n.ambientUpdate){const{iblTexes:i}=t;if(i){const r=n.target;um(i),t.iblTexes=cm(e,r)}else t.iblTexes=cm(e,n.target)}}const lm=[0,0];function cm(t,e){const n=e.getLightManager().getAmbientResource();return n?{prefilterMap:t.cube({width:n.prefilterMap.width,height:n.prefilterMap.height,faces:n.prefilterMap.faces,min:"linear mipmap linear",mag:"linear",format:"rgba"}),sh:n.sh,rgbmRange:n.rgbmRange}:null}function um(t){for(const e in t)t[e].destroy&&t[e].destroy(),delete t[e]}var fm=Object.freeze({__proto__:null,loginIBLResOnCanvas:function(t,e,n){if(!t.dfgLUT&&(t.dfgLUT=em(e),t.dfgLUT.mtkRefCount=0,n)){const i=hm.bind(this,t,e);n.on("updatelights",i),t._iblResListener=i}t.dfgLUT.mtkRefCount++;const i=n.getLightManager();return i&&i.getAmbientResource()?(t.iblTexes||(t.iblTexes=cm(e,n)),{dfgLUT:t.dfgLUT,iblTexes:t.iblTexes}):{dfgLUT:t.dfgLUT,iblTexes:null}},getIBLResOnCanvas:function(t){const{dfgLUT:e,iblTexes:n}=t;return{dfgLUT:e,iblTexes:n}},logoutIBLResOnCanvas:function(t,e){let n=!1;t.dfgLUT&&(t.dfgLUT.mtkRefCount--,t.dfgLUT.mtkRefCount<=0)&&(n=!0,e&&e.off("updatelights",t._iblResListener),t.dfgLUT.destroy(),delete t.dfgLUT),t.iblTexes&&n&&(um(t.iblTexes),delete t.iblTexes)},getPBRUniforms:function(t,e,n,i,r){const o=t.viewMatrix,s=t.projMatrix,a=t.cameraPosition,h=t.getRenderer().canvas,l=function(t,e){const n=t.getLightManager(),i=n&&n.getAmbientResource(),r=n&&n.getAmbientLight()||{},o=n&&n.getDirectionalLight()||{};let s;if(i){const t=e.prefilterMap.width,n=Math.log(t)/Math.log(2);s={prefilterMap:e.prefilterMap,diffuseSPH:e.sh,prefilterMiplevel:[n,n],prefilterSize:[t,t],hdrHSV:r.hsv||[0,0,0]}}else s={ambientColor:r.color||[.2,.2,.2]};return s.rgbmRange=i?e.rgbmRange:7,s.environmentExposure=_$6(r.exposure)?r.exposure:1,s.environmentOrientation=r.orientation||0,s.light0_diffuse=[...o.color||[1,1,1],1],s.light0_viewDirection=o.direction||[1,1,-1],s}(t,e),c=g$3({viewMatrix:o,projMatrix:s,projViewMatrix:t.projViewMatrix,cameraPosition:a,outSize:[h.width,h.height],cameraNearFar:[t.cameraNear,t.cameraFar]},l);return c.brdfLUT=n,i&&i.renderUniforms&&g$3(c,i.renderUniforms),c.halton=r||lm,c},createIBLTextures:cm,disposeIBLTextures:um,isSupported:function(t){return t.hasExtension("EXT_shader_texture_lod")}});class dm extends ie$5{constructor(t){super({vert:"attribute vec3 aPosition;\nuniform mat4 lightProjViewModelMatrix;\nuniform mat4 positionMatrix;\n#include <line_extrusion_vert>\n#include <get_output>\nvarying vec4 vPosition;\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 d = getLineExtrudePosition(aPosition);\n  vec4 e = getPosition(d);\n#else\nvec4 e = getPosition(aPosition);\n#endif\ngl_Position = lightProjViewModelMatrix * c * e;\n  vPosition = gl_Position;\n}",frag:"#define SHADER_NAME vsm_mapping\n#ifdef USE_VSM\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\nvarying vec4 vPosition;\n#ifdef PACK_FLOAT\n#include <common_pack_float>\n#endif\nvoid main() {\n  \n#if defined(USE_VSM)\nfloat c = vPosition.z / vPosition.w;\n  c = c * .5 + .5;\n  float d = c;\n  float e = c * c;\n  float f = dFdx(c);\n  float h = dFdy(c);\n  e += .25 * (f * f + h * h);\n  gl_FragColor = vec4(d, e, c, .0);\n#endif\n#if defined(USE_ESM)\n#ifdef PACK_FLOAT\ngl_FragColor = common_encodeDepth(gl_FragCoord.z);\n#else\ngl_FragColor = vec4(gl_FragCoord.z, .0, .0, 1.);\n#endif\n#endif\n}",uniforms:[{name:"lightProjViewModelMatrix",type:"function",fn:function(t,n){return multiply$5([],n.lightProjViewMatrix,n.modelMatrix)}}],extraCommandProps:{},defines:t})}filter(t){return t.castShadow}}class mm extends de$5{constructor({blurOffset:t}){super({vert:ce$5,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\n#include <common_pack_float>\nvoid main() {\n  float c = .0;\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      float f = common_decodeDepth(texture2D(textureSource, e));\n      float s = max(.0, sign(1. - f));\n      d += sign(f) * s;\n      c += f;\n    }\n  float h = c / max(1., d);\n  gl_FragColor = common_encodeDepth(h);\n}",defines:{BOXBLUR_OFFSET:t||2}}),this._blurOffset=t||2}getMeshCommand(t,e){const n="box_shadow_blur_"+this._blurOffset;return this.commands[n]||(this.commands[n]=this.createREGLCommand(t,null,e.getElements())),this.commands[n]}}let gm,pm;class _m{constructor(t,{width:e,height:n,blurOffset:i,defines:r}){this.renderer=t,this.width=e||512,this.height=n||512,this.blurOffset=u$2(i)?2:i,this._init(r)}render(t,{cameraProjViewMatrix:e,lightDir:n,farPlane:i,cameraLookAt:r}){return{lightProjViewMatrix:this._renderShadow(t,e,n,i,r),shadowMap:this.blurTex||this.depthTex,depthFBO:this.depthFBO,blurFBO:this.blurFBO}}resize(t,e){return this.depthTex&&(this.depthTex.resize(t,e),this.depthFBO.resize(t,e)),this.blurFBO&&(this.blurTex.resize(t,e),this.blurFBO.resize(t,e)),this}_renderShadow(t,e,n,i,r){const o=this.renderer,s=gm(e);if(i)for(let t=4;t<8;t++)s[t]=i[t-4];const a=pm(r,s,n);return o.clear({color:[1,0,0,1],depth:1,framebuffer:this.depthFBO}),o.render(this.shadowMapShader,{lightProjViewMatrix:a},t,this.depthFBO),this.blurFBO&&(this.boxBlurShader||(this.boxBlurShader=new mm({blurOffset:this.blurOffset})),o.clear({color:[1,0,0,1],depth:1,framebuffer:this.blurFBO}),o.render(this.boxBlurShader,{resolution:[this.depthTex.width,this.depthTex.height],textureSource:this.depthTex},null,this.blurFBO)),a}_init(t){const e=this.renderer.regl,n=this.width,i=this.height;this.depthTex=e.texture({width:n,height:i,format:"rgb",type:"uint8",min:"nearest",mag:"nearest"}),this.shadowMapShader=new dm(t),this.shadowMapShader.filter=t=>t.castShadow,this.depthFBO=e.framebuffer({color:this.depthTex}),this.blurOffset<=0||(this.blurTex=e.texture({width:n,height:i,format:"rgb",type:"uint8",min:"linear",mag:"linear"}),this.blurFBO=e.framebuffer({color:this.blurTex}))}dispose(){this.depthTex&&(this.depthTex.destroy(),this.depthFBO.destroy(),delete this.depthTex,delete this.depthFBO),this.blurTex&&(this.blurTex.destroy(),this.blurFBO.destroy(),delete this.blurTex,delete this.blurFBO),this.shadowMapShader&&(this.shadowMapShader.dispose(),delete this.shadowMapShader),this.boxBlurShader&&(this.boxBlurShader.dispose(),delete this.boxBlurShader)}}gm=function(){const t=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1]],n=new Array(16);return function(r){invert$2(n,r);const o=[];for(let e=0;e<t.length;e++){const r=transformMat4$1([],t[e],n);scale$3(r,r,1/r[3]),o.push(r)}return o}}(),pm=function(){let t=new Array(4);const r=new Array(3),o=[0,0,0,0],s=[0,1,0],a=new Array(3);let h=new Array(16),l=new Array(16),c=new Array(16);const u=[1,1,1],f=[0,0,0];return function(d,m,g){set$3(o,...d,1),scale$4(r,g,-1),h=lookAt(h,add$4(a,o,normalize$4(a,r)),o,s),transformMat4$1(t,m[0],h);let p=t[2],_=t[2],v=t[0],y=t[0],x=t[1],b=t[1];for(let e=1;e<8;e++)t=transformMat4$1(t,m[e],h),t[2]>_&&(_=t[2]),t[2]<p&&(p=t[2]),t[0]>y&&(y=t[0]),t[0]<v&&(v=t[0]),t[1]>b&&(b=t[1]),t[1]<x&&(x=t[1]);l=ortho(l,-1,1,-1,1,-_,-p);const w=u[0]=2/(y-v),C=u[1]=-2/(b-x);f[0]=-.5*(v+y)*w,f[1]=-.5*(x+b)*C,identity$2(c),translate$1(c,c,f),scale$5(c,c,u);const M=multiply$5(l,c,l);return multiply$5(new Array(16),M,h)}}();class vm extends ie$5{constructor(t){super({vert:"#define SHADER_NAME SHADOW_DISPLAY\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 halton;\nuniform vec2 globalTexSize;\nvarying vec4 vPosition;\n#include <vsm_shadow_vert>\nvoid main() {\n  vec4 c = vec4(aPosition, 1.);\n  vec4 d = modelViewMatrix * c;\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / globalTexSize.xy;\n  gl_Position = e * d;\n  vPosition = gl_Position;\n  shadow_computeShadowPars(c);\n}",frag:"#define SHADER_NAME SHADOW_DISPLAY\nprecision mediump float;\nuniform vec3 color;\n#include <vsm_shadow_frag>\nvoid main() {\n  float c = shadow_computeShadow();\n  float d = 1. - c;\n  gl_FragColor = vec4(color * d, d);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,n){const i=[];return multiply$5(i,n.viewMatrix,n.modelMatrix),i}}],defines:t||{USE_ESM:1},extraCommandProps:{depth:{enable:!0,mask:!1},viewport:{x:0,y:0,width:(t,e)=>e.globalTexSize[0],height:(t,e)=>e.globalTexSize[1]}}})}getMeshCommand(t,e){return this.commands.shadow_display||(this.commands.shadow_display=this.createREGLCommand(t,null,e.getElements())),this.commands.shadow_display}}function ym(t){return 256*t[2]*256+256*t[1]+t[0]}const xm=new Uint8Array(4),bm=new Float32Array(xm.buffer);let wm,Cm;const Mm="\n    vec3 unpack(highp float f) {\n        highp vec3 color;\n        color.b = floor(f / 65536.0);\n        color.g = floor((f - color.b * 65536.0) / 256.0);\n        color.r = f - floor(color.b * 65536.0) - floor(color.g * 256.0);\n        // now we have a vec3 with the 3 components in range [0..255]. Let's normalize it!\n        return color / 255.0;\n    }\n",Tm=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    uniform float fbo_picking_meshId;\n\n    ${Mm}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), fbo_picking_meshId / 255.0);\n    }\n`,Sm=`\n    precision highp float;\n\n    uniform int fbo_picking_meshId;\n    varying float vFbo_picking_visible;\n\n    ${Mm}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(float(fbo_picking_meshId)), 1.0);\n        // gl_FragColor = vec4(unpack(float(35)), 1.0);\n    }\n`,Pm=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    ${Mm}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), 1.0);\n    }\n`;class Am{constructor(t,{vert:e,uniforms:n,defines:i,extraCommandProps:r},o,s){this._renderer=t,this._fbo=o,this._map=s,this._clearFbo(o),this._vert=e,this._uniforms=n,this._defines=i,this._extraCommandProps=g$3({},r),delete this._extraCommandProps.blend,delete this._extraCommandProps.stencil,this._currentMeshes=[],this._init()}_init(){const t=[];this._uniforms&&t.push(...this._uniforms);const e={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const t in this._defines)e[t]=this._defines[t];const n=this._vert,i=this._extraCommandProps;this._shader0=new ie$5({vert:n,frag:Tm,uniforms:t,defines:e,extraCommandProps:i}),this._shader2=new ie$5({vert:n,frag:Pm,uniforms:t,defines:e,extraCommandProps:i});const r={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const t in this._defines)r[t]=this._defines[t];this._shader1=new ie$5({vert:n,frag:Sm,uniforms:t,defines:r,extraCommandProps:i}),this._depthShader=new ie$5({vert:n,frag:"\n    #ifdef GL_ES\n        precision highp float;\n    #endif\n    #if __VERSION__ == 100\n        #extension GL_EXT_frag_depth : enable\n    #endif\n    #include <gl2_frag>\n    #include <common_pack_float>\n    varying float vFbo_picking_viewZ;\n    uniform float logDepthBufFC;\n    varying float vFbo_picking_fragDepth;\n\n    const float PackUpscale = 256. / 255.;\n    const float UnpackDownscale = 255. / 256.;\n    const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n    const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n    const float ShiftRight8 = 1. / 256.;\n    vec4 packDepthToRGBA(const in float v ) {\n        vec4 r = vec4(fract(v * PackFactors), v);\n        r.yzw -= r.xyz * ShiftRight8;\n        return r * PackUpscale;\n    }\n\n    void main() {\n        float fragDepth = vFbo_picking_fragDepth > 1.0 ? vFbo_picking_fragDepth : vFbo_picking_viewZ + 1.0;\n        #if __VERSION__ == 300\n            gl_FragDepthEXT = log2(fragDepth) * logDepthBufFC * 0.5;\n        #endif\n        vec4 depthColor = packDepthToRGBA(fragDepth - 1.0);\n        glFragColor = common_unpackFloat(dot(depthColor, UnpackFactors));\n        #if __VERSION__ == 100\n            gl_FragColor = glFragColor;\n        #endif\n    }\n",uniforms:t,defines:r,extraCommandProps:i}),this._depthShader.version=300,this._scene=new yt$6,this._scene1=new yt$6}filter(){return!0}render(t,e,n=!1){if(!t||!t.length)return this;const i=this._fbo;n&&this.clear(),t=t.filter((t=>t&&t.isValid())),this._scene.setMeshes(t);const r=this._getShader(t,n);r.filter=this.filter,this._currentShader&&r!==this._currentShader&&this.clear(),this._currentShader=r,t.forEach(((t,e)=>{t.setUniform("fbo_picking_meshId",e+this._currentMeshes.length)}));for(let e=0;e<t.length;e++)this._currentMeshes.push(t[e]);return this._renderer.render(r,e,this._scene,i),this}pick(t,e,n,i,r={}){const o=this._currentShader,s=this._currentMeshes;if(!o||!s||!s.length)return{pickingId:null,meshId:null,point:null};t=Math.round(t),e=Math.round(e);const a=this._fbo;if(t<=2||t>=a.width-2||e<=2||e>=a.height-2)return{pickingId:null,meshId:null,point:null};const{px:h,py:l,width:c,height:u}=this._getParams(t,e,n,a),f=new Uint8Array(4*c*u),d=this._renderer.regl.read({data:f,x:h,y:l,framebuffer:a,width:c,height:u}),m=[];let g=[];for(let t=0;t<d.length;t+=4){const{pickingId:e,meshId:n}=this._packData(d.subarray(t,t+4),o);m.push(n),g.push(e)}const p={},_=m.filter((t=>null!=t&&!p[t]&&(p[t]=1,!0))).map((t=>s[t]));let v;for(let t=0;t<_.length;t++)if(_[t]&&_[t].geometry){v=_[t];break}if(!v)return{pickingId:null,meshId:null,point:null};const y=v.geometry.desc.pickingIdAttribute;m.length&&o===this._shader1&&(void 0!==v.getUniform("uPickingId")||v.geometry.data[y])&&(g=this._getPickingId(h,l,c,u,f,_,i));const x=[],b=[];if(m.length&&r.returnPoint){const{viewMatrix:n,projMatrix:o}=r,s=this._pickDepth(h,l,c,u,f,_,i);for(let i=0;i<s.length;i++)if(s[i]&&null!=m[i]&&null!=g[i]){const r=this._getWorldPos(t,e,s[i],n,o),a=this._convertPickPoint(r);x.push(r),b.push(a)}else x.push(null)}const w=[];for(let t=0;t<=n;t++)w.push(t),t>0&&w.push(-t);for(let t=0;t<w.length;t++)for(let e=0;e<w.length;e++){const i=(w[e]+n)*c+(w[t]+n);if(null!=m[i]&&null!=g[i])return{meshId:m[i],pickingId:g[i],point:x[i]||null,coordinate:b[i]||null}}return{pickingId:null,meshId:null,point:null}}_convertPickPoint(t){const e=this._map;if(!e)return null;const n=e.getGLRes();if(!wm){const t=e.getCenter();Cm=new t.constructor(0,0,0);const n=e.coordToPoint(t);wm=new n.constructor(0,0)}wm.set(t[0],t[1]);const i=e.pointAtResToCoord(wm,n,Cm),r=e.pointAtResToAltitude(t[2],n);return[i.x,i.y,r]}clear(){return this._fbo&&this._clearFbo(this._fbo),this._currentMeshes=[],delete this._currentShader,this}getMeshAt(t){return this._currentMeshes?this._currentMeshes[t]:null}getRenderedMeshes(){return this._currentMeshes}dispose(){this.clear(),this._shader0&&this._shader0.dispose(),this._shader1&&this._shader1.dispose(),this._shader2&&this._shader2.dispose(),this._scene&&this._scene.clear(),this._scene1&&this._scene1.clear()}_getWorldPos(t,n,i,r,o){const s=this._fbo,a=[],h=s.width/2||1,l=s.height/2||1,c=[(t-h)/h,(l-n)/l,0,1],u=[(t-h)/h,(l-n)/l,1,1],f=invert$2(a,o),d=[],m=[];Em(d,c,f),Em(m,u,f);const g=-d[2],p=(i-g)/(-m[2]-g),y=invert$2(a,multiply$5(a,o,r)),x=Em(c,c,y),b=Em(u,u,y);return[v$6(x[0],b[0],p),v$6(x[1],b[1],p),v$6(x[2],b[2],p)]}_getPickingId(t,e,n,i,r,o,s){const a=this._renderer.regl,h=this._getFBO1();this._clearFbo(h),this._scene1.setMeshes(o),this._renderer.render(this._shader2,s,this._scene1,h);const l=a.read({data:r,x:t,y:e,framebuffer:h,width:n,height:i}),c=[];for(let t=0;t<l.length;t+=4)c.push(ym(l.subarray(t,t+4)));return c}_pickDepth(t,e,n,i,r,o,s){const a=this._renderer.regl,h=this._getFBO1();this._scene1.setMeshes(o),this._clearFbo(h),s.logDepthBufFC=2/(Math.log(this._map.cameraFar+1)/Math.LN2),this._renderer.render(this._depthShader,s,this._scene1,h);const l=a.read({data:r,x:t,y:e,framebuffer:h,width:n,height:i}),c=[];for(let t=0;t<l.length;t+=4)c.push((u=l.subarray(t,t+4),xm[0]=u[3],xm[1]=u[2],xm[2]=u[1],xm[3]=u[0],bm[0]));var u;return c}_packData(t,e){if(255===t[0]&&255===t[1]&&255===t[2]&&255===t[3])return{meshId:null,pickingId:null};let n=null,i=null;return e===this._shader1?i=ym(t):e===this._shader0?(i=t[3],n=ym(t)):(i=null,n=ym(t)),{meshId:i,pickingId:n}}_clearFbo(t){this._renderer.regl.clear({color:[1,1,1,1],depth:1,stencil:0,framebuffer:t})}_getShader(t,e){return e&&t.length<256?this._shader0:this._shader1}_getFBO1(){const t=this._renderer.regl,e=this._fbo;return this._fbo1?this._fbo1.width===e.width&&this._fbo1.height===e.height||this._fbo1.resize(e.width,e.height):this._fbo1=t.framebuffer(e.width,e.height),this._fbo1}_getParams(t,e,n,i){e=i.height-e;let r=2*n+1,o=2*n+1;const s=(t-=n)+r,a=(e-=n)+o;return s>i.width&&(r-=s-i.width),a>i.height&&(o-=a-i.height),{px:t=t<0?0:t,py:e=e<0?0:e,width:r,height:o}}getPickingVert(){return this._vert}getUniformDeclares(){return this._uniforms}}function Em(t,e,n){const i=e[0],r=e[1],o=e[2],s=1/(n[3]*i+n[7]*r+n[11]*o+n[15]);return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])*s,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])*s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])*s,t}const Om=t=>t&&t.geometry&&void 0===t.geometry.properties.shaderHash,Rm=[],Im=[],km=[{name:"modelViewMatrix",type:"function",fn:(t,n)=>multiply$5(Rm,n.viewMatrix,n.modelMatrix)},{name:"modelViewProjMatrix",type:"function",fn:(t,n)=>{const i=multiply$5(Rm,n.viewMatrix,n.modelMatrix);return multiply$5(Rm,n.projMatrix,i)}},{name:"modelMatrixInverse",type:"function",fn:(t,n)=>invert$2(Rm,n.modelMatrix)},{name:"projMatrixInverse",type:"function",fn:(t,n)=>invert$2(Rm,n.projMatrix)},{name:"modelViewMatrixInverse",type:"function",fn:(t,n)=>(multiply$5(Rm,n.viewMatrix,n.modelMatrix),invert$2(Rm,Rm))},{name:"modelViewProjMatrixInverse",type:"function",fn:(t,n)=>{const i=multiply$5(Rm,n.viewMatrix,n.modelMatrix);return multiply$5(Rm,n.projMatrix,i),invert$2(Rm,Rm)}},{name:"modelInverseTransposeMatrix",type:"function",fn:(t,e)=>{const n=fromMat4$1(Im,e.modelMatrix),i=transpose$1(n,n);return invert$3(i,i)}},{name:"modelViewInverseTransposeMatrix",type:"function",fn:(t,n)=>{const i=multiply$5(Rm,n.viewMatrix,n.modelMatrix),o=fromMat4$1(Im,i),s=transpose$1(o,o);return invert$3(s,s)}}],Dm={LOCAL:"positionMatrix",MODEL:"modelMatrix",VIEW:"viewMatrix",PROJECTION:"projMatrix",MODELVIEW:"modelViewMatrix",MODELVIEWPROJECTION:"modelViewProjMatrix",MODELINVERSE:"modelMatrixInverse",VIEWINVERSE:"viewMatrixInverse",PROJECTIONINVERSE:"projMatrixInverse",MODELVIEWINVERSE:"modelViewMatrixInverse",MODELVIEWPROJECTIONINVERSE:"modelViewProjMatrixInverse",MODELINVERSETRANSPOSE:"modelInverseTransposeMatrix",MODELVIEWINVERSETRANSPOSE:"modelViewInverseTransposeMatrix",VIEWPORT:"viewport",JOINTMATRIX:"jointMatrix",ALPHACUTOFF:"alphaCutoff"};class Lm{constructor(t,e,n){this._regl=t,this._khrShaders={},this._commandProps=e,this._resLoader=n}getExcludeFilter(){return Om}forEachShader(t){for(const e in this._khrShaders){const n=this._khrShaders[e];t(n.shader,n.filter,n.uniformSemantics)}}createMesh(t,e,n,i){const r=e.extensions.KHR_techniques_webgl,o=e.materials[t.material].extensions.KHR_techniques_webgl,{technique:s,values:a}=o,h=r.techniques[s],l=r.programs[h.program],c=r.shaders[l.vertexShader],u=r.shaders[l.fragmentShader];u.content=function(t){return t&&t.indexOf("precision")<0?"precision mediump float;\n"+t:t}(u.content);const f=O$7(c.content)+"-"+O$7(u.content);this._khrShaders[f]||(this._khrShaders[f]=this._createTechniqueShader(f,r,s,this._commandProps,i));const{attributeSemantics:d}=this._khrShaders[f],m=this._createGeometry(t,d,n,f),p=g$3({},a);for(const t in a)h.uniforms[t]&&35678===h.uniforms[t].type&&(p[t]=this._getTexture(e.textures[a[t].index]));return{geometry:m,material:new tt$6(p)}}_createGeometry(t,e,n,i){const r=t.attributes;if(r.COLOR_0){const t=r.COLOR_0.array||r.COLOR_0;if(t instanceof Float32Array){const e=new Uint8Array(t.length);for(let n=0;n<e.length;n++)e[n]=Math.round(255*t[n]);r.COLOR_0.array?(r.COLOR_0.array=e,r.COLOR_0.componentType=5121):r.COLOR_0=e}}const o={};for(const t in r){const n=Nt$5(this._regl,r[t],{dimension:r[t].itemSize}),i=e[t]||t;o[i]={buffer:n},r[t].quantization&&(o[i].quantization=r[t].quantization),i===e.POSITION&&(o[i].array=r[t].array)}const s=new Q$7(o,t.indices.array?t.indices.array:t.indices,0,{positionAttribute:e.POSITION,normalAttribute:e.NORMAL,uv0Attribute:e.TEXCOORD_0,uv1Attribute:e.TEXCOORD_1,color0Attribute:e.COLOR_0,tangentAttribute:e.TANGENT,textureCoordMatrixAttribute:e.TextureCoordMatrix,primitive:void 0===t.mode?"triangles":Pt$5(t.mode)});s.generateBuffers(this._regl,{excludeElementsInVAO:n}),s.properties.shaderHash=i;const a=s.data[s.desc.positionAttribute];return a&&a.array&&delete a.array,s}_getTexture(t){const e={type:t.type?Et$5(t.type):"uint8",format:t.format?Rt$5(t.format):"rgba",flipY:!!t.flipY},n=t.image;n.array?e.data=n.array:n.mipmap&&(e.mipmap=n.mipmap),e.width=n.width,e.height=n.height;const i=t.sampler||t.texture.sampler;return i&&(i.magFilter&&(e.mag=kt$5(i.magFilter)),i.minFilter&&(e.min=Lt$5(i.minFilter)),i.wrapS&&(e.wrapS=Ft$5(i.wrapS)),i.wrapT&&(e.wrapT=Ft$5(i.wrapT))),new Vt$5(e,this._resLoader)}_createTechniqueShader(t,e,n,i,r){const{techniques:o,programs:s,shaders:a}=e,h=o[n],l=s[h.program],c=a[l.vertexShader].content,u=a[l.fragmentShader].content,f={};for(const t in h.uniforms){const e=h.uniforms[t];e.semantic&&(f[e.semantic]=t)}const d=km.slice();for(const t in f)d.push({name:f[t],type:"function",fn:(e,n)=>n[Dm[t]]});const m=new ie$5({vert:c,frag:u,uniforms:d,extraCommandProps:i});r&&(m.version=300);const g={};for(const t in h.attributes)g[h.attributes[t].semantic]=t;return{shader:m,filter:e=>e&&e.geometry&&e.geometry.properties.shaderHash===t,uniformSemantics:f,attributeSemantics:g}}dispose(){for(const t in this._khrShaders){const{shader:e}=this._khrShaders[t];e.dispose()}this._khrShaders={}}}const zm={parseHDR:Tt$5},Fm={PBRHelper:rm,StandardMaterial:sm,StandardSpecularGlossinessMaterial:am,StandardShader:class extends ie$5{constructor(t={}){let n=t.extraCommandProps||{};const i=t.uniforms;n=g$3({},n);const o=t.defines||{},s=[],a=[],h=[],l=[],c=[],u=[{name:"modelNormalMatrix",type:"function",fn:(t,e)=>fromMat4$1(s,e.modelMatrix)},{name:"modelViewNormalMatrix",type:"function",fn:(t,n)=>{const i=multiply$5(a,n.viewMatrix,n.modelMatrix),o=invert$2(i,i),s=transpose(o,o);return fromMat4$1(h,s)}},{name:"modelViewMatrix",type:"function",fn:(t,n)=>multiply$5(l,n.viewMatrix,n.modelMatrix)},{name:"uEnvironmentTransform",type:"function",fn:(t,e)=>fromRotation$2(c,Math.PI*(e.environmentOrientation||0)/180)}];i&&u.push(...i),super({vert:t.vert||"#include <gl2_vert>\n#define SHADER_NAME PBR\nprecision highp float;\nattribute vec3 aPosition;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nuniform vec2 uvOrigin;\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nuniform float uvRotation;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#endif\nvec3 c;\nvec3 d;\nvec4 e;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform vec2 outSize;\nuniform vec2 halton;\nuniform mediump vec3 cameraPosition;\nuniform mat3 modelNormalMatrix;\n#ifdef HAS_SSR\nuniform mat3 modelViewNormalMatrix;\nvarying vec3 vViewNormal;\n#ifdef HAS_TANGENT\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\nvarying vec3 vModelVertex;\n#if defined(HAS_MAP)\nvarying vec2 vTexCoord;\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#include <highlight_vert>\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\nvarying vec3 vColor0;\n#else\nattribute vec4 aColor0;\nvarying vec4 vColor0;\n#endif\n#endif\n#include <line_extrusion_vert>\n#include <get_output>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <heatmap_render_vert>\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#if __VERSION__ == 100\nmat3 f(in mat3 h) {\n  vec3 i = h[0];\n  vec3 j = h[1];\n  vec3 k = h[2];\n  return mat3(vec3(i.x, j.x, k.x), vec3(i.y, j.y, k.y), vec3(i.z, j.z, k.z));\n}\n#else\nmat3 f(in mat3 h) {\n  return transpose(h);\n}\n#endif\n#endif\nvoid l(const highp vec4 q, out highp vec3 m) {\n  m = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid l(const highp vec4 q, out highp vec3 m, out highp vec3 t) {\n  l(q, m);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nconst float o = .5;\nvec2 u(vec2 v, float A) {\n  return vec2(cos(A) * (v.x - o) + sin(A) * (v.y - o) + o, cos(A) * (v.y - o) - sin(A) * (v.x - o) + o);\n}\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\nvoid main() {\n  mat4 B = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 C = getLineExtrudePosition(aPosition);\n  vec4 D = getPosition(C);\n#else\nvec4 D = getPosition(aPosition);\n#endif\nvModelVertex = (modelMatrix * D).xyz;\n  vec4 E = B * D;\n  vec4 F = modelViewMatrix * E;\n  vViewVertex = F;\n  mat4 G = projMatrix;\n  G[2].xy += halton.xy / outSize.xy;\n#ifdef HAS_MASK_EXTENT\ngl_Position = G * getMaskPosition(E, modelMatrix);\n#else\ngl_Position = G * F;\n#endif\n#ifdef PICKING_MODE\nfloat H = 1.;\n#if defined(HAS_COLOR)\nH *= aColor.a;\n#endif\n#if defined(HAS_COLOR0)\nH *= aColor0.a;\n#endif\nfbo_picking_setData(gl_Position.w, H != .0);\n#else\n#if defined(HAS_MAP)\nvec2 I = getTexcoord(aTexCoord);\n#ifdef HAS_RANDOM_TEX\nvec2 J = uvOrigin;\n  vec2 K = I * uvScale + uvOffset;\n  if(uvRotation != .0) {\n    J = u(J, uvRotation);\n    K = u(K, uvRotation);\n  }\n  vTexCoord = mod(J, 1.) + K;\n#else\nvec2 J = uvOrigin;\n  vec2 K = I * uvScale;\n  if(uvRotation != .0) {\n    J = u(J, uvRotation);\n    K = u(K, uvRotation);\n  }\n  vTexCoord = mod(J, 1.) + K + uvOffset;\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\n#endif\n#if defined(HAS_TANGENT) || defined(HAS_NORMAL)\nmat3 L = mat3(B);\n  mat3 M = modelNormalMatrix * L;\n#if defined(HAS_TANGENT)\nvec3 t;\n  l(aTangent, d, t);\n  vModelTangent = vec4(M * t, aTangent.w);\n#else\n#ifdef HAS_DECODE_NORMAL\nd = getNormal(aNormal);\n#else\nd = aNormal;\n#endif\n#endif\nvec3 N = d;\n  vModelNormal = M * N;\n#else\nd = vec3(.0);\n  vModelNormal = vec3(.0);\n#endif\n#if defined(HAS_TANGENT)\nvModelBiTangent = cross(vModelNormal, vModelTangent.xyz) * sign(aTangent.w);\n#endif\n#ifdef HAS_SSR\nmat3 O = modelViewNormalMatrix * L;\n  vViewNormal = O * d;\n#if defined(HAS_TANGENT)\nvec4 P = vec4(t, aTangent.w);\n  vViewTangent = vec4(O * P.xyz, P.w);\n#endif\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\nhighlight_setVarying();\n#if defined(HAS_COLOR0)\nvColor0 = aColor0 / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(E);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * B, D);\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nmat3 Q = f(mat3(vModelTangent.xyz, vModelBiTangent, vModelNormal));\n  vTangentViewPos = Q * cameraPosition;\n  vTangentFragPos = Q * vModelVertex;\n#endif\n#endif\n}",frag:t.frag||"#if __VERSION__ == 100\n#if defined(GL_EXT_shader_texture_lod)\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\n#define saturate(x)        clamp(x, 0.0, 1.0)\nprecision mediump float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\nuniform float contrast;\nconst float c = .04;\nstruct MaterialUniforms {\n  vec2 roughnessMetalness;\n  vec3 albedo;\n  float alpha;\n  vec3 normal;\n  vec3 emit;\n  float ao;\n  vec3 specularColor;\n  float glossiness;\n} d;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform vec3 cameraPosition;\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\nuniform float glossinessFactor;\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\nuniform vec3 emissiveFactor;\nuniform vec4 baseColorFactor;\nuniform float baseColorIntensity;\nuniform float anisotropyDirection;\nuniform float anisotropyFactor;\nuniform float clearCoatFactor;\nuniform float clearCoatIor;\nuniform float clearCoatRoughnessFactor;\nuniform float clearCoatThickness;\nuniform float emitColorFactor;\nuniform float occlusionFactor;\nuniform float environmentExposure;\nuniform float roughnessFactor;\nuniform float metallicFactor;\nuniform float normalMapFactor;\nuniform float rgbmRange;\nuniform float specularF0;\nuniform int emitMultiplicative;\nuniform int normalMapFlipY;\nuniform int outputSRGB;\nuniform mat3 uEnvironmentTransform;\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nuniform sampler2D metallicRoughnessTexture;\n#endif\n#if defined(HAS_EMISSIVE_MAP)\nuniform sampler2D emissiveTexture;\n#endif\n#if defined(HAS_AO_MAP)\nuniform sampler2D occlusionTexture;\n#endif\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nuniform sampler2D normalTexture;\n#endif\n#if defined(HAS_ALPHAMODE)\nuniform float alphaCutoff;\n#endif\n#ifdef HAS_RANDOM_TEX\nuniform highp vec2 uvOrigin;\nuniform highp float uvRotation;\nuniform sampler2D noiseTexture;\n#endif\nuniform sampler2D brdfLUT;\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform vec3 diffuseSPH[9];\nuniform vec2 prefilterMiplevel;\nuniform vec2 prefilterSize;\n#else\nuniform vec3 ambientColor;\n#endif\nuniform vec2 cameraNearFar;\nuniform vec3 clearCoatTint;\nuniform vec3 light0_viewDirection;\nuniform vec4 light0_diffuse;\n#ifdef HAS_SSR\nvarying vec3 vViewNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelVertex;\nvarying vec4 vViewVertex;\n#if defined(HAS_MAP)\n#include <computeTexcoord_frag>\n#endif\nvarying vec3 vModelNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvarying vec3 vColor0;\n#else\nvarying vec4 vColor0;\n#endif\n#endif\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\nuniform float currentTime;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatternGapColor;\nuniform vec2 uvScale;\nvarying float vPatternHeight;\nvarying float vLinesofar;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvec2 e(vec2 f) {\n  vec2 h = mod(f, 1.);\n  vec2 i = vTexInfo.xy;\n  vec2 j = vTexInfo.zw;\n  return (i + h * j) / atlasSize;\n}\n#endif\n#include <heatmap_render_frag>\n#include <snow_frag>\n#include <mask_frag>\n#ifdef HAS_RANDOM_TEX\nconst float k = .5;\nvec2 l(vec2 h, float m) {\n  return vec2(cos(m) * (h.x - k) + sin(m) * (h.y - k) + k, cos(m) * (h.y - k) - sin(m) * (h.x - k) + k);\n}\nfloat n(vec3 o) {\n  return o.x + o.y + o.z;\n}\n#endif\nvec4 u(sampler2D A, in vec2 h) {\n  \n#ifdef HAS_RANDOM_TEX\nhighp vec2 B = uvOrigin;\n  if(uvRotation != .0) {\n    B = l(B, uvRotation);\n  }\n  highp vec2 C = h + B - mod(B, 1.);\n  float D = texture2D(noiseTexture, .005 * C).x;\n  vec2 E = dFdx(C);\n  vec2 F = dFdx(C);\n  float G = D * 8.;\n  float H = fract(G);\n#if 1\nfloat I = floor(G);\n  float J = I + 1.;\n#else\nfloat I = floor(G + .5);\n  float J = floor(G);\n  H = min(H, 1. - H) * 2.;\n#endif\nvec2 K = sin(vec2(3., 7.) * I);\n  vec2 L = sin(vec2(3., 7.) * J);\n  float M = .5;\n  vec4 N = texture2DGradEXT(A, h + M * K, E, F);\n  vec4 O = texture2DGradEXT(A, h + M * L, E, F);\n  return mix(N, O, smoothstep(.2, .8, H - .1 * n(N.xyz - O.xyz)));\n#else\nreturn texture2D(A, h);\n#endif\n}\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nuniform sampler2D bumpTexture;\nuniform float bumpScale;\nuniform float bumpMaxLayers;\nuniform float bumpMinLayers;\nvec2 P(vec2 h, vec3 Q) {\n  float R = mix(bumpMaxLayers, bumpMinLayers, abs(dot(vec3(.0, .0, 1.), Q)));\n  float S = 1. / R;\n  float T = .0;\n  vec2 U = Q.xy * bumpScale / (Q.z * R);\n  vec2 V = h;\n  float W = u(bumpTexture, V).r;\n  for(int X = 0; X < 30; X++) {\n    T += S;\n    V -= U;\n    W = u(bumpTexture, V).r;\n    if(W < T) {\n      break;\n    }\n  }\n  vec2 Y = V + U;\n  float Z = W - T;\n  float ba = u(bumpTexture, Y).r - T + S;\n  return mix(V, Y, Z / (Z - ba));\n}\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#endif\n#define SHADER_NAME PBR\nvec3 bb(const in vec3 bc) {\n  return vec3(bc.r < .0031308 ? bc.r * 12.92 : 1.055 * pow(bc.r, 1. / 2.4) - .055, bc.g < .0031308 ? bc.g * 12.92 : 1.055 * pow(bc.g, 1. / 2.4) - .055, bc.b < .0031308 ? bc.b * 12.92 : 1.055 * pow(bc.b, 1. / 2.4) - .055);\n}\nvec3 bd(const in vec3 bc) {\n  return vec3(bc.r < .04045 ? bc.r * (1. / 12.92) : pow((bc.r + .055) * (1. / 1.055), 2.4), bc.g < .04045 ? bc.g * (1. / 12.92) : pow((bc.g + .055) * (1. / 1.055), 2.4), bc.b < .04045 ? bc.b * (1. / 12.92) : pow((bc.b + .055) * (1. / 1.055), 2.4));\n}\nvec3 be(const in vec4 bc, const in float bf) {\n  if(bf <= .0)\n    return bc.rgb;\n  return bf * bc.rgb * bc.a;\n}\nvec3 bg() {\n  return d.albedo;\n}\nfloat bh() {\n  \n#if defined(HAS_ALPHAMODE)\nif(d.alpha >= alphaCutoff) {\n    return 1.;\n  } else {\n    return .0;\n  }\n#else\nreturn d.alpha;\n#endif\n}\nfloat bi() {\n  \n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nvec3 bc = d.specularColor;\n  return max(max(bc.r, bc.g), bc.b);\n#else\nreturn d.roughnessMetalness.y;\n#endif\n}\nfloat bj() {\n  return specularF0;\n}\nfloat bk() {\n  \n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn 1. - d.glossiness;\n#else\nreturn d.roughnessMetalness.x;\n#endif\n}\nvec3 bl() {\n  return d.emit;\n}\nvec3 bm() {\n  return d.normal;\n}\nfloat bn() {\n  return clearCoatFactor;\n}\nfloat bo() {\n  return clearCoatRoughnessFactor;\n}\nfloat bp() {\n  return d.ao;\n}\nfloat bq(const in vec4 br) {\n  return br.r + br.g / 255.;\n}\nfloat bs(const in vec2 bt, const in float bu) {\n  vec3 bv = vec3(.06711056, .00583715, 52.9829189);\n  return fract(bv.z * fract(dot(bt.xy + bu * vec2(47., 17.) * .695, bv.xy))) * .5;\n}\nvec3 bw(const in float bx, in vec3 by, const in vec3 t, const in vec3 b, in vec3 bz) {\n  by.xy = bx * by.xy;\n  mat3 bA = mat3(t, b, bz);\n  return normalize(bA * by);\n}\nvoid bB(const in vec3 bC, const in vec3 by, const in vec3 bD, out float bE, out vec3 bF, out float bG) {\n  bE = 1.;\n  bF = -bD;\n  bG = dot(bF, by);\n}\nvec4 bH(const in vec3 by, const in vec3 bC, const in float bI) {\n  float bJ = clamp(dot(by, bC), 0., 1.);\n  float bK = bI * bI;\n  return vec4(bK, bK * bK, bJ, bJ * (1. - bK));\n}\nfloat bL(const vec4 bH, const float bM) {\n  float bN = bH.y;\n  float bO = (bM * bN - bM) * bM + 1.;\n  return bN / (3.141593 * bO * bO);\n}\nvec3 bP(const vec3 bQ, const float bR, const in float bS) {\n  float bT = pow(1. - bS, 5.);\n  return bR * bT + (1. - bT) * bQ;\n}\nfloat bP(const float bQ, const float bR, const in float bS) {\n  return bQ + (bR - bQ) * pow(1. - bS, 5.);\n}\nfloat bU(const vec4 bH, const float bV) {\n  float a = bH.x;\n  float bW = bV * (bH.w + a);\n  float bX = bH.z * (bV * (1. - a) + a);\n  return .5 / (bW + bX);\n}\nvec3 bY(const vec4 bH, const vec3 by, const vec3 bC, const vec3 bF, const vec3 bZ, const float bV, const float bR) {\n  vec3 ca = normalize(bC + bF);\n  float bM = clamp(dot(by, ca), 0., 1.);\n  float bS = clamp(dot(bF, ca), 0., 1.);\n  float cb = bL(bH, bM);\n  float cc = bU(bH, bV);\n  vec3 cd = bP(bZ, bR, bS);\n  return (cb * cc * 3.141593) * cd;\n}\nvoid ce(const in vec3 by, const in vec3 bC, const in float bV, const in vec4 bH, const in vec3 cf, const in vec3 bZ, const in float bE, const in vec3 cg, const in vec3 bF, const in float bR, out vec3 ch, out vec3 ci, out bool cj) {\n  cj = bV > .0;\n  if(cj == false) {\n    ci = ch = vec3(.0);\n    return;\n  }\n  vec3 ck = bE * bV * cg;\n  ci = ck * bY(bH, by, bC, bF, bZ, bV, bR);\n  ch = ck * cf;\n}\nfloat cl(float at, float ab, float cm, float cn, float co, float cp, float bJ, float bV) {\n  float cq = bV * length(vec3(at * cm, ab * cn, bJ));\n  float cr = bJ * length(vec3(at * co, ab * cp, bV));\n  return .5 / (cq + cr);\n}\nfloat cs(const float at, const float ab, const float ct, const float cu, const float bM) {\n  float bN = at * ab;\n  vec3 bO = vec3(ab * ct, at * cu, bN * bM);\n  float x = bN / dot(bO, bO);\n  return bN * (x * x) / 3.141593;\n}\nvec3 cv(const vec4 bH, const vec3 by, const vec3 bC, const vec3 bF, const vec3 bZ, const float bV, const float bR, const in vec3 cw, const in vec3 cx, const in float cy) {\n  vec3 ca = normalize(bC + bF);\n  float bM = clamp(dot(by, ca), 0., 1.);\n  float bJ = clamp(dot(by, bC), 0., 1.);\n  float bS = clamp(dot(bF, ca), 0., 1.);\n  float cm = dot(cw, bC);\n  float cn = dot(cx, bC);\n  float co = dot(cw, bF);\n  float cp = dot(cx, bF);\n  float ct = dot(cw, ca);\n  float cu = dot(cx, ca);\n  float cz = sqrt(1. - abs(cy) * .9);\n  if(cy > .0)\n    cz = 1. / cz;\n  float at = bH.x * cz;\n  float ab = bH.x / cz;\n  float cb = cs(at, ab, ct, cu, bM);\n  float cc = cl(at, ab, cm, cn, co, cp, bJ, bV);\n  vec3 cd = bP(bZ, bR, bS);\n  return (cb * cc * 3.141593) * cd;\n}\nvoid cA(const in vec3 by, const in vec3 bC, const in float bV, const in vec4 bH, const in vec3 cf, const in vec3 bZ, const in float bE, const in vec3 cg, const in vec3 bF, const in float bR, const in vec3 cw, const in vec3 cx, const in float cy, out vec3 ch, out vec3 ci, out bool cj) {\n  cj = bV > .0;\n  if(cj == false) {\n    ci = ch = vec3(.0);\n    return;\n  }\n  vec3 ck = bE * bV * cg;\n  ci = ck * cv(bH, by, bC, bF, bZ, bV, bR, cw, cx, cy);\n  ch = ck * cf;\n}\n#if defined(HAS_IBL_LIGHTING)\nvec3 cB(const in vec3 by) {\n  vec3 bz = uEnvironmentTransform * by;\n  float x = bz.x;\n  float y = bz.y;\n  float z = bz.z;\n  vec3 cC = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    cC = hsv_apply(cC, hdrHSV);\n  }\n  return max(cC, vec3(.0));\n}\nfloat cD(const in float cE) {\n  return cE;\n}\nvec3 cF(const in float cG, const in vec3 cH) {\n  vec3 cI = cH;\n  float cJ = prefilterMiplevel.x;\n  float cK = min(cJ, cD(cG) * prefilterMiplevel.y);\n  vec3 cL = be(textureCubeLod(prefilterMap, cI, cK), rgbmRange);\n  if(length(hdrHSV) > .0) {\n    return hsv_apply(cL, hdrHSV);\n  } else {\n    return cL;\n  }\n}\nvec3 cM(const in vec3 cN, const in vec3 cH, const in float cO) {\n  float cP = 1. - cO;\n  float cQ = cP * (sqrt(cP) + cO);\n  return mix(cN, cH, cQ);\n}\nvec3 cR(const in vec3 by, const in vec3 bC, const in float bI, const in vec3 cS) {\n  vec3 cH = reflect(-bC, by);\n  cH = cM(by, cH, bI);\n  vec3 cT = cF(bI, uEnvironmentTransform * cH);\n  float bx = clamp(1. + dot(cH, cS), .0, 1.);\n  cT *= bx * bx;\n  return cT;\n}\n#else\nvec3 cR(const in vec3 by, const in vec3 bC, const in float bI, const in vec3 cS) {\n  return ambientColor;\n}\n#endif\nvec3 cU(const in vec3 bZ, const in float bI, const in float bJ, const in float bR) {\n  vec4 rgba = texture2D(brdfLUT, vec2(bJ, bI));\n  float b = (rgba[3] * 65280.0 + rgba[2] * 255.);\n  float a = (rgba[1] * 65280.0 + rgba[0] * 255.);\n  const float cV = 1. / 65535.;\n  return (bZ * a + b * bR) * cV;\n}\nvec3 cW(const in vec3 by, const in vec3 bC, const in float bI, const in vec3 bZ, const in vec3 cS, const in float bR) {\n  float bJ = dot(by, bC);\n  return cR(by, bC, bI, cS) * cU(bZ, bI, bJ, bR);\n}\nvec3 cX(const float bJ, const float bV, const vec3 cY, const float bO) {\n  return exp(cY * -bO * ((bV + bJ) / max(bV * bJ, 1e-3)));\n}\nvec3 cZ(const in float bJ, const in float bV, const in float da) {\n  return mix(vec3(1.), cX(bJ, bV, clearCoatTint, clearCoatThickness), da);\n}\nvoid db(const in float dc, const in vec3 by, const in vec3 bC, const in float bG, const in vec4 bH, const in float bE, const in vec3 cg, const in vec3 bF, const in float da, out vec3 dd, out vec3 de) {\n  if(bG <= .0) {\n    dd = vec3(.0);\n    de = vec3(.0);\n    return;\n  }\n  float df = clamp(dot(by, -refract(bF, by, 1. / clearCoatIor)), 0., 1.);\n  vec3 dg = cZ(dc, df, da);\n  vec3 ca = normalize(bC + bF);\n  float bM = clamp(dot(by, ca), 0., 1.);\n  float bS = clamp(dot(bF, ca), 0., 1.);\n  float cb = bL(bH, bM);\n  float cc = bU(bH, df);\n  float cd = bP(c, 1., bS);\n  dd = (bE * bG * da * cb * cc * 3.141593 * cd) * cg;\n  de = (1. - cd * da) * dg;\n}\nfloat dh(const in int di, const in float dj, const in vec3 by, const in vec3 bC) {\n  if(di == 0)\n    return 1.;\n  float bO = dot(by, bC) + dj;\n  return clamp(bO * bO - 1. + dj, .0, 1.);\n}\nvec3 dk(const in vec3 by, const in vec3 bC, const in float bI, const in vec3 cw, const in vec3 cx, const in float cy) {\n  vec3 dl = cy >= .0 ? cx : cw;\n  vec3 dm = cross(dl, bC);\n  vec3 dn = cross(dm, dl);\n  float dp = abs(cy) * clamp(5. * bI, .0, 1.);\n  return normalize(mix(by, dn, dp));\n}\nvoid dq() {\n  \n#ifdef HAS_MAP\nvec2 h = computeTexCoord();\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nh = P(h, normalize(vTangentViewPos - vTangentFragPos));\n#endif\nd.albedo = baseColorIntensity * baseColorFactor.rgb;\n  d.alpha = baseColorFactor.a;\n#if defined(HAS_PATTERN)\nfloat dr = vLinesofar;\n  vec2 j = vTexInfo.zw;\n#ifdef HAS_PATTERN_GAP\nfloat ds = vLinePatternGap;\n#else\nfloat ds = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat dt = vLinePatternAnimSpeed;\n#else\nfloat dt = linePatternAnimSpeed;\n#endif\nfloat du = ceil(j.x * vPatternHeight / j.y);\n  float dv = du * (1. + ds);\n  dr += mod(currentTime * -dt * .2, dv);\n  float dw = mod(dr / dv, 1.);\n  float dx = mod(flipY * vNormalY, 1.);\n  vec2 h = e(vec2(dw * (1. + ds) * uvScale[0], dx * uvScale[1]));\n  vec4 dy = texture2D(linePatternFile, h);\n  float dz = clamp(sign(1. / (1. + ds) - dw) + .000001, .0, 1.);\n  dy = mix(linePatternGapColor, dy, dz);\n#ifdef IS_SQUARE_TUBE\nfloat o = clamp(sign(abs(vNormalY) - .999999), .0, 1.);\n  dy = mix(dy, vec4(1.), o);\n#endif\nd.albedo *= dy.rgb;\n  d.alpha *= dy.a;\n#endif\n#if defined(HAS_ALBEDO_MAP)\nvec4 dA = u(baseColorTexture, h);\n  d.albedo *= bd(dA.rgb);\n  d.alpha *= dA.a;\n#endif\n#if defined(HAS_COLOR0)\nd.albedo *= vColor0.rgb;\n#if COLOR0_SIZE == 4\nd.alpha *= vColor0.a;\n#endif\n#endif\n#if defined(HAS_COLOR)\nd.albedo *= vColor.rgb;\n  d.alpha *= vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nd.albedo *= lineColor.rgb;\n  d.alpha *= lineColor.a;\n#else\nd.albedo *= polygonFill.rgb;\n  d.alpha *= polygonFill.a;\n#endif\n#if defined(HAS_INSTANCE_COLOR)\nd.albedo *= vInstanceColor.rgb;\n  d.alpha *= vInstanceColor.a;\n#endif\n#if defined(IS_LINE_EXTRUSION)\nd.alpha *= lineOpacity;\n#else\nd.alpha *= polygonOpacity;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nd.roughnessMetalness = u(metallicRoughnessTexture, h).gb * vec2(roughnessFactor, metallicFactor);\n#else\nd.roughnessMetalness = vec2(roughnessFactor, metallicFactor);\n#endif\nd.emit = emissiveFactor;\n#if defined(HAS_EMISSIVE_MAP)\nif(emitMultiplicative == 1) {\n    d.emit *= bd(u(emissiveTexture, h).rgb);\n  } else {\n    d.emit += bd(u(emissiveTexture, h).rgb);\n  }\n#endif\nd.emit *= emitColorFactor;\n#if defined(HAS_AO_MAP)\nd.ao = u(occlusionTexture, h).r;\n#else\nd.ao = 1.;\n#endif\nd.ao *= occlusionFactor;\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nvec3 dB = u(normalTexture, h).xyz * 2. - 1.;\n  dB.y = normalMapFlipY == 1 ? -dB.y : dB.y;\n  d.normal = dB;\n#else\nd.normal = normalize(vModelNormal);\n#endif\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nd.albedo *= diffuseFactor.rgb;\n  d.alpha *= diffuseFactor.a;\n#if defined(HAS_DIFFUSE_MAP)\nvec4 cf = u(diffuseTexture, h);\n  d.albedo *= bd(cf.rgb);\n  d.alpha *= cf.a;\n#endif\nd.specularColor = specularFactor;\n  d.glossiness = glossinessFactor;\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nvec4 dC = u(specularGlossinessTexture, h);\n  d.specularColor *= bd(dC.rgb);\n  d.glossiness *= dC.a;\n#endif\n#endif\n}\nvec3 dD(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float dE = 2.43;\n  const float bO = .59;\n  const float dF = .14;\n  return (x * (a * x + b)) / (x * (dE * x + bO) + dF);\n}\nvec3 dG(vec3 bc) {\n  bc = dD(bc);\n  return bc = pow(bc, vec3(1. / 2.2));\n}\nuniform float specularAAVariance;\nuniform float specularAAThreshold;\nfloat dH(float bI, const vec3 dI) {\n  \n#if defined(GL_OES_standard_derivatives) || __VERSION__ == 300\nvec3 dJ = dFdx(dI);\n  vec3 dK = dFdy(dI);\n  float dL = specularAAVariance * (dot(dJ, dJ) + dot(dK, dK));\n  float dM = min(2. * dL, specularAAThreshold);\n  float dN = saturate(bI * bI + dM);\n  return sqrt(dN);\n#else\nreturn bI;\n#endif\n}\n#ifdef HAS_SSR\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nvec3 dO(const in mat4 dP, const in vec3 dQ) {\n  vec4 dR = dP * vec4(dQ, 1.);\n  return vec3(.5 + .5 * dR.xy / dR.w, dR.w);\n}\nvec3 dS(const in float dT, const in vec2 h) {\n  return texture2D(TextureReflected, h).rgb;\n}\nfloat dU(float dV) {\n  highp mat4 dP = projMatrix;\n  highp float z = dV * 2. - 1.;\n  return -dP[3].z / (z + dP[2].z);\n}\nfloat dW(const vec2 h) {\n  float dV = bq(texture2D(TextureDepth, h));\n  return dV;\n}\nvec3 dX(const in float bu, const in vec3 dY, const in vec3 dZ, const in vec3 ea, const in vec3 bC, const in float eb) {\n  vec2 ec;\n  ec.x = bs(gl_FragCoord.yx, bu);\n  ec.y = fract(ec.x * 52.9829189);\n  ec.y = mix(ec.y, 1., .7);\n  float ed = 2. * 3.14159 * ec.x;\n  float ee = pow(max(ec.y, .000001), eb / (2. - eb));\n  float ef = sqrt(1. - ee * ee);\n  vec3 eg = vec3(ef * cos(ed), ef * sin(ed), ee);\n  eg = eg.x * dY + eg.y * dZ + eg.z * ea;\n  return normalize((2. * dot(bC, eg)) * eg - bC);\n}\nfloat eh(const in float bu) {\n  return (bs(gl_FragCoord.xy, bu) - .5);\n}\nvec3 ei(const in vec3 ej, const in float ek, const in vec3 el) {\n  vec3 em = dO(projMatrix, vViewVertex.xyz + el * ek);\n  em.z = 1. / em.z;\n  em -= ej;\n  float en = min(1., .99 * (1. - ej.x) / max(1e-5, em.x));\n  float eo = min(1., .99 * (1. - ej.y) / max(1e-5, em.y));\n  float ep = min(1., .99 * ej.x / max(1e-5, -em.x));\n  float eq = min(1., .99 * ej.y / max(1e-5, -em.y));\n  return em * min(en, eo) * min(ep, eq);\n}\nfloat er(const in vec3 ej, const in vec3 em, inout float es, inout float et) {\n  float eu = (et + es) * .5;\n  vec3 ev = ej + em * eu;\n  float z = dW(ev.xy);\n  float dV = dU(z);\n  float ew = -1. / ev.z;\n  es = dV > ew ? es : eu;\n  et = dV > ew ? eu : et;\n  return eu;\n}\nvec4 ex(const in vec3 ej, const in float ek, in float ey, const in vec3 el, const in float bI, const in float bu) {\n  int ez = 20;\n  float eA = 1. / float(ez);\n  ey *= eA;\n  vec3 em = ei(ej, ek, el);\n  float eB = eA;\n  vec3 eC = vec3(.0, eB, 1.);\n  vec3 ev;\n  float z, dV, ew, eD, eE, eF;\n  bool eG;\n  float eH = 1.;\n  float eu;\n  for(int X = 0; X < ez; X++) {\n    ev = ej + em * eC.y;\n    z = dW(ev.xy);\n    dV = dU(z);\n    ew = -1. / ev.z;\n    float eI = clamp(sign(.999 - z), .0, 1.);\n    eD = eI * (ew - dV);\n    eD *= clamp(sign(abs(eD) - ek * eA * eA), .0, 1.);\n    eG = abs(eD + ey) < ey;\n    eE = clamp(eC.x / (eC.x - eD), .0, 1.);\n    eF = eG ? eC.y + eE * eA - eA : 1.;\n    eC.z = min(eC.z, eF);\n    eC.x = eD;\n    if(eG) {\n      float es = eC.y - eA;\n      float et = eC.y;\n      eu = er(ej, em, es, et);\n      eu = er(ej, em, es, et);\n      eu = er(ej, em, es, et);\n      eH = eu;\n      break;\n    }\n    eC.y += eA;\n  }\n  return vec4(ej + em * eH, 1. - eH);\n}\nvec4 eJ(in vec4 eK, const in float eL, const in vec3 eM, const in vec3 eN, const in float bI) {\n  vec4 eO = mix(outputFovInfo[0], outputFovInfo[1], eK.x);\n  eK.xyz = vec3(mix(eO.xy, eO.zw, eK.y), 1.) * -1. / eK.z;\n  eK.xyz = (reprojViewProjMatrix * vec4(eK.xyz, 1.)).xyw;\n  eK.xy /= eK.z;\n  float eP = clamp(6. - 6. * max(abs(eK.x), abs(eK.y)), .0, 1.);\n  eK.xy = .5 + .5 * eK.xy;\n  vec3 eQ = eN * dS(bI * (1. - eK.w), eK.xy);\n  return vec4(mix(eM, eQ, eL * eP), 1.);\n}\nvec3 ssr(const in vec3 eM, const in vec3 eN, const in float bI, const in vec3 by, const in vec3 bC) {\n  float eR = .0;\n  vec4 cC = vec4(.0);\n  float eb = bI * bI;\n  eb = eb * eb;\n  vec3 eS = abs(by.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 dY = normalize(cross(eS, by));\n  vec3 dZ = cross(by, dY);\n  float eL = ssrFactor * clamp(-4. * dot(bC, by) + 3.8, .0, 1.);\n  eL *= clamp(4.7 - bI * 5., .0, 1.);\n  vec3 ej = dO(projMatrix, vViewVertex.xyz);\n  ej.z = 1. / ej.z;\n  vec3 el = dX(eR, dY, dZ, by, bC, eb);\n  float ek = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, el.z * .5 + .5);\n  float ey = .5 * ek;\n  vec4 eK;\n  if(dot(el, by) > .001 && eL > .0) {\n    eK = ex(ej, ek, ey, el, bI, eR);\n    if(eK.w > .0)\n      cC += eJ(eK, eL, eM, eN, bI);\n    \n  }\n  return cC.w > .0 ? cC.rgb / cC.w : eM;\n}\n#endif\n#include <highlight_frag>\nvoid main() {\n  dq();\n  vec3 bC = normalize(cameraPosition - vModelVertex.xyz);\n#if defined(HAS_DOUBLE_SIDE)\nvec3 cS = gl_FrontFacing ? normalize(vModelNormal) : -normalize(vModelNormal);\n#else\nvec3 cS = normalize(vModelNormal);\n#endif\n#if defined(HAS_TANGENT)\nvec4 eT;\n  eT = vModelTangent;\n#if defined(HAS_DOUBLE_SIDE)\neT.xyz = gl_FrontFacing ? normalize(eT.xyz) : -normalize(eT.xyz);\n#else\neT.xyz = normalize(eT.xyz);\n#endif\nvec3 eU = normalize(vModelBiTangent);\n#endif\nfloat bQ = .08 * bj();\n  float eV = bi();\n  vec3 eW = bg();\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nvec3 eX = d.specularColor;\n#else\nvec3 eX = mix(vec3(bQ), eW, eV);\n#endif\neW *= 1. - eV;\n  float eY = clamp(50.0 * eX.g, .0, 1.);\n  float eZ = bk();\n  if(specularAAVariance > .0) {\n    eZ = dH(eZ, cS);\n  }\n  vec3 fa = bl();\n  vec3 fb = bm();\n  vec3 fc = vec3(fb);\n#if defined(HAS_TANGENT) && defined(HAS_NORMAL_MAP)\nfc = bw(normalMapFactor, fc, eT.xyz, eU, cS);\n#endif\nfloat fd = bn();\n  float fe = bo();\n  if(specularAAVariance > .0) {\n    fe = dH(fe, cS);\n  }\n  vec3 ff = cS;\n#if defined(HAS_TANGENT)\nfloat cy;\n  vec3 cw;\n  vec3 cx;\n  if(anisotropyFactor > .0) {\n    cy = anisotropyFactor;\n    eT.xyz = normalize(eT.xyz - fc * dot(eT.xyz, fc));\n    eU = normalize(cross(fc, eT.xyz)) * eT.w;\n    cw = normalize(mix(eT.xyz, eU, anisotropyDirection));\n    cx = normalize(mix(eU, -eT.xyz, anisotropyDirection));\n  }\n#endif\nvec3 cf = vec3(.0);\n  vec3 bZ = vec3(.0);\n  vec3 fg;\n#if defined(HAS_TANGENT)\nif(anisotropyFactor > .0) {\n    fg = dk(fc, bC, eZ, cw, cx, cy);\n  } else {\n    fg = fc;\n  }\n#else\nfg = fc;\n#endif\n#if defined(HAS_IBL_LIGHTING)\ncf = eW * cB(fc) * .5;\n#else\ncf = eW * ambientColor;\n#endif\nbZ = cW(fg, bC, eZ, eX, cS, eY);\n  float dc;\n  if(clearCoatFactor > .0) {\n    dc = clamp(dot(ff, -refract(bC, ff, 1. / clearCoatIor)), 0., 1.);\n    float fh = fd * bP(c, 1., dc);\n    vec3 fi = cZ(dc, dc, fd);\n    bZ = mix(bZ * fi, cR(ff, bC, fe, cS), fh);\n    cf *= fi * (1. - fh);\n  }\n  float fj = 1.;\n  float fk = bp();\n  cf *= environmentExposure * fk;\n#ifdef HAS_IBL_LIGHTING\nfj = dh(1, fk, fc, bC);\n#endif\n#ifdef HAS_SSR\nvec3 fl = normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n  vec3 fm = fl;\n#if defined(HAS_TANGENT) && defined(HAS_NORMAL_MAP)\nvec4 fn;\n  fn = vViewTangent;\n  fn = gl_FrontFacing ? fn : -fn;\n  fn.xyz = normalize(fn.xyz);\n  vec3 fo = normalize(cross(fl, fn.xyz)) * fn.w;\n  fm = bw(normalMapFactor, fb, fn.xyz, fo, fl);\n#endif\nbZ = ssr(bZ, eX * fj, eZ, fm, -normalize(vViewVertex.xyz));\n#endif\nbZ *= environmentExposure * fj;\n  float bE, bG;\n  vec3 bF;\n  bool cj;\n  vec3 fp;\n  vec3 fq;\n  vec4 fr = bH(fc, bC, max(.045, eZ));\n  vec3 fs = vModelNormal;\n  bB(bC, fc, light0_viewDirection, bE, bF, bG);\n#if defined(HAS_TANGENT)\nif(anisotropyFactor > .0) {\n    cA(fc, bC, bG, fr, eW, eX, bE, light0_diffuse.rgb, bF, eY, cw, cx, cy, fq, fp, cj);\n  } else {\n    ce(fc, bC, bG, fr, eW, eX, bE, light0_diffuse.rgb, bF, eY, fq, fp, cj);\n  }\n#else\nce(fc, bC, bG, fr, eW, eX, bE, light0_diffuse.rgb, bF, eY, fq, fp, cj);\n#endif\nif(clearCoatFactor > .0) {\n    vec3 ft;\n    vec3 fu;\n    vec4 fv = bH(ff, bC, fe);\n    db(dc, ff, bC, dot(ff, bF), fv, bE, light0_diffuse.rgb, bF, fd, ft, fu);\n    fq *= fu;\n    fp = ft + fp * fu;\n  }\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat fw = shadow_computeShadow();\n  fq = shadow_blend(fq, fw).rgb;\n  fp = shadow_blend(fp, fw).rgb;\n#endif\nvec3 fx = vec3(bZ);\n  vec3 fy = vec3(cf);\n  cf += fq;\n  bZ += fp;\n  cf += fa;\n  vec3 fz = bZ + cf;\n  if(outputSRGB == 1)\n    fz = bb(fz);\n  glFragColor = vec4(fz, bh());\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_SNOW\nglFragColor.rgb = snow(glFragColor, bm(), 1.);\n#endif\nif(contrast != 1.) {\n    glFragColor = contrastMatrix(contrast) * glFragColor;\n  }\n  if(length(hsv) > .0) {\n    glFragColor = hsv_apply(glFragColor, hsv);\n  }\n#ifdef OUTPUT_NORMAL\nglFragColor = vec4(cS, 1.);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:u,extraCommandProps:n,defines:o}),this.version=300}getGeometryDefines(t){const e={};return t.data[t.desc.tangentAttribute]?e.HAS_TANGENT=1:t.data[t.desc.normalAttribute]&&(e.HAS_NORMAL=1),t.data[t.desc.colorAttribute]&&(e.HAS_COLOR=1),t.data[t.desc.color0Attribute]&&(e.HAS_COLOR0=1,e.COLOR0_SIZE=t.getColor0Size()),e}},StandardDepthShader:class extends ie$5{constructor(t={}){const n=[];super({vert:"#define SHADER_NAME depth_vert\nprecision highp float;\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform vec2 outSize;\nuniform vec2 halton;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec4 d = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 d = getPosition(aPosition);\n#endif\nvec4 e = modelViewMatrix * c * d;\n  mat4 f = projMatrix;\n  f[2].xy += halton.xy / outSize.xy;\n  gl_Position = f * e;\n}",frag:"#define SHADER_NAME depth_frag\nprecision highp float;\nvoid main() {\n  gl_FragColor = vec4(1., .0, .0, 1.);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(t,i)=>multiply$5(n,i.viewMatrix,i.modelMatrix)}],extraCommandProps:t.extraCommandProps,defines:t.defines})}},PBRUtils:fm};var u$3=Object.freeze({__proto__:null,AbstractTexture:F$7,BloomPass:Oe$4,BoundingBox:U$7,BoxBlurShader:class extends de$5{constructor({blurOffset:t}){super({vert:ce$5,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\nuniform float ignoreTransparent;\nvoid main() {\n  vec4 c = vec4(.0);\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      vec4 f = texture2D(textureSource, e);\n      float h;\n      if(ignoreTransparent == 1.) {\n        h = sign(f.a);\n      } else {\n        h = 1.;\n      }\n      d += h;\n      c += h * f;\n    }\n  gl_FragColor = c / max(d, 1.) * clamp(sign(d - 1.), .0, 1.);\n}",defines:{BOXBLUR_OFFSET:t||2},extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}}),this._blurOffset=t||2}getMeshCommand(t,e){const n="box_blur_"+this._blurOffset;return this.commands[n]||(this.commands[n]=this.createREGLCommand(t,null,e.getElements())),this.commands[n]}},Constants:z$6,CopyShader:He$4,DeferredRenderer:class extends N$8{},ExtentPass:xd,FBORayPicking:Am,FogPass:Be$4,FogShader:Ge$4,FxaaShader:me$4,GLTFHelper:zd,GLTFManager:Vd,Geometry:Q$7,HDR:zm,HeatmapDisplayShader:Fe$4,HeatmapShader:ke$4,InstancedMesh:dt$6,Jitter:Ae$4,KHRTechniquesWebglManager:Lm,Material:tt$6,Mesh:ft$6,MeshShader:ie$5,PhongMaterial:rt$6,PhongShader:ae$5,PhongSpecularGlossinessMaterial:lt$6,Plane:Ut$5,PointLineShader:class extends ie$5{constructor(t={}){const n=[];super({vert:"attribute vec3 aPosition;\n#ifdef HAS_COLOR0\nattribute vec4 aColor0;\nvarying vec4 vColor;\n#endif\nuniform mat4 modelMatrix;\nuniform mat4 projMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float pointSize;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#endif\n#include <get_output>\n#include <heatmap_render_vert>\n#ifdef HAS_FLOODANALYSE\nvarying float vHeight;\n#endif\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_PointSize = pointSize;\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(d * c, modelMatrix);\n#else\ngl_Position = projViewModelMatrix * d * c;\n#endif\n#ifdef HAS_COLOR0\nvColor = aColor0 / 255.;\n#endif\n#ifdef HAS_MAP\nvTexCoord = aTexCoord;\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * d, c);\n#endif\n}",frag:"precision mediump float;\n#include <gl2_frag>\n#if defined(HAS_COLOR0)\nvarying vec4 vColor;\n#endif\n#include <heatmap_render_frag>\nuniform vec4 baseColorFactor;\n#if defined(HAS_MAP)\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec2 vTexCoord;\n#endif\n#include <mask_frag>\nvoid main() {\n  \n#ifdef HAS_COLOR0\nglFragColor = vColor * baseColorFactor;\n#else\nglFragColor = vec4(1.) * baseColorFactor;\n#endif\n#ifdef HAS_MAP\n#ifdef HAS_ALBEDO_MAP\nglFragColor *= texture2D(baseColorTexture, vTexCoord);\n#endif\n#ifdef HAS_DIFFUSE_MAP\nglFragColor *= texture2D(diffuseTexture, vTexCoord);\n#endif\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,i)=>multiply$5(n,i.projViewMatrix,i.modelMatrix)}],defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}})}},PostProcessShader:be$4,QuadShader:de$5,REGLHelper:Gt$5,RainRipplesPass:qe$4,Renderer:N$8,ResourceLoader:gt$6,Scene:yt$6,Shader:ee$5,ShaderLib:Xt$5,ShadowDisplayShader:vm,ShadowMapShader:dm,ShadowPass:_m,SkyboxShader:ze$4,SsaoPass:xe$4,SsrPass:Ie$4,TaaPass:Me$4,Texture2D:Vt$5,TextureCube:class extends F$7{onLoad(t){const e=this.config;if(!e)return;const n=this._createFaces(t);e.faces=n.map((t=>t.data)),this._updateREGL()}createREGLTexture(t){return t.cube(this.config)}_createFaces(){return[]}},ToonMaterial:class extends rt$6{constructor(t){super(t,ot$6)}},ToonShader:class extends ae$5{constructor(t={}){super({vert:se$5,frag:oe$5,defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}})}},Util:k$7,WaterShader:class extends ie$5{constructor(t={}){super({vert:"precision highp float;\nprecision highp sampler2D;\nconst float c = 3.141592653589793;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nvec4 d(mat4 e, mat4 f, vec3 h) {\n  return e * modelMatrix * f * vec4(h, 1.);\n}\nvec3 i(in vec3 h, in vec3 j) {\n  return normalize(h + j);\n}\nmat3 k(in vec3 l) {\n  vec3 t = normalize(cross(vec3(.0, .0, 1.), l));\n  vec3 b = normalize(cross(l, t));\n  return mat3(t, b, l);\n}\nvoid m() {\n  \n}\nvoid main(void) {\n  vuv = aTexCoord;\n  vpos = (modelMatrix * vec4(aPosition, 1.)).xyz;\n  vnormal = aNormal;\n  vtbnMatrix = k(vnormal);\n  gl_Position = d(projMatrix, viewMatrix, vpos);\n  m();\n}",frag:"precision highp float;\nprecision highp sampler2D;\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\nuniform vec3 octaveTextureRepeat;\nuniform vec4 waveParams;\nuniform vec2 waveDirection;\nuniform vec4 waterColor;\nuniform vec3 lightingDirection;\nuniform vec3 lightingIntensity;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nconst vec2 c = vec2(6. / 25., 5. / 24.);\nvec2 d(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rg - 1.;\n}\nfloat h(vec2 f) {\n  return texture2D(texWavePerturbation, f).b;\n}\nvec3 i(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rgb - 1.;\n}\nfloat j(vec2 f, float k) {\n  return fract(k);\n}\nfloat l(vec2 f, float k) {\n  float m = j(f, k);\n  return 1. - abs(1. - 2. * m);\n}\nvec3 n(sampler2D o, vec2 f, float k, float u) {\n  float v = waveParams[2];\n  float A = waveParams[3];\n  vec2 B = d(o, f) * v;\n  float m = j(f, k + u);\n  float C = l(f, k + u);\n  vec2 D = f;\n  D -= B * (m + A);\n  D += u;\n  D += (k - m) * c;\n  return vec3(D, C);\n}\nconst float E = .3737;\nconst float F = 7.77;\nvec3 G(sampler2D H, sampler2D I, vec2 f, vec2 J, float k) {\n  float K = waveParams[0];\n  vec2 L = k * -J;\n  float M = h(f * E) * F;\n  vec3 N = n(I, f + L, k + M, .0);\n  vec3 O = n(I, f + L, k + M, .5);\n  vec3 P = i(H, N.xy) * N.z;\n  vec3 Q = i(H, O.xy) * O.z;\n  vec3 R = normalize(P + Q);\n  R.xy *= K;\n  R.z = sqrt(1. - dot(R.xy, R.xy));\n  return R;\n}\nvec3 S(vec2 f, float k) {\n  float T = waveParams[1];\n  return G(texWaveNormal, texWavePerturbation, f * T, waveDirection, k);\n}\nconst float U = 3.141592653589793;\nconst float V = 1. / U;\nconst float W = .3183098861837907;\nconst float X = 1.570796326794897;\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nfloat Y = 2.2;\nvec3 Z(float ba, vec3 bb, float bc) {\n  return bb + (bc - bb) * pow(1. - ba, 5.);\n}\nfloat bd(float be, float bf) {\n  float bg = bf * bf;\n  float bh = be * be;\n  float bi = pow((bh * (bg - 1.) + 1.), Y) * U;\n  return bg / bi;\n}\nfloat bj(float bk) {\n  return .25 / (bk * bk);\n}\nvec3 bl(in PBRShadingWater bm, float bf, vec3 bn, float bo) {\n  vec3 bp = Z(bm.VdotH, bn, bo);\n  float bq = bd(bm.NdotH, bf);\n  float br = bj(bm.LdotH);\n  return (bq * br) * bp;\n}\nvec3 bs(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float bt = 2.2;\nconst float bu = .4545454545;\nvec4 bv(vec4 bw) {\n  return vec4(pow(bw.rgb, vec3(bu)), bw.w);\n}\nvec3 bx(vec3 bw) {\n  return pow(bw, vec3(bt));\n}\nconst vec3 by = vec3(.02, 1., 5.);\nconst vec2 bz = vec2(.02, .1);\nconst float bf = .06;\nconst vec3 bA = vec3(0, .6, .9);\nconst vec3 bB = vec3(.72, .92, 1.);\nPBRShadingWater bC;\nvec3 bD(in float bE, in vec3 bF, in vec3 bG) {\n  float bH = pow((1. - bE), by[2]);\n  return mix(bG, bF, bH);\n}\nvec3 bI(in vec3 bJ, in vec3 bK, in vec3 bL, vec3 bw, in vec3 bM, in vec3 bN, in float bO) {\n  vec3 bP = bx(bw);\n  vec3 bQ = normalize(bL + bK);\n  bC.NdotL = clamp(dot(bJ, bL), .0, 1.);\n  bC.NdotV = clamp(dot(bJ, bK), .001, 1.);\n  bC.VdotN = clamp(dot(bK, bJ), .001, 1.);\n  bC.NdotH = clamp(dot(bJ, bQ), .0, 1.);\n  bC.VdotH = clamp(dot(bK, bQ), .0, 1.);\n  bC.LdotH = clamp(dot(bL, bQ), .0, 1.);\n  float bR = max(dot(bN, bK), .0);\n  vec3 bS = bx(bB);\n  vec3 bT = bx(bA);\n  vec3 bB = bD(bR, bS, bT);\n  float bU = max(dot(bN, bL), .0);\n  bB *= .1 + bU * .9;\n  float bV = clamp(bO, .8, 1.);\n  vec3 bW = Z(bC.VdotN, vec3(by[0]), by[1]) * bB * bV;\n  vec3 bX = bP * mix(bB, bU * bM * V, 2. / 3.) * bV;\n  vec3 bY = vec3(.0);\n  if(bR > .0 && bU > .0) {\n    vec3 bZ = bl(bC, bf, vec3(bz[0]), bz[1]);\n    vec3 ca = bM * V * bO;\n    bY = bC.NdotL * ca * bZ;\n  }\n  return bs(bW + bX + bY);\n}\nvoid main() {\n  vec3 bN = vnormal;\n  vec3 cb = S(vuv, timeElapsed);\n  vec3 bJ = normalize(vtbnMatrix * cb);\n  vec3 bK = -normalize(vpos - camPos);\n  vec3 bL = normalize(-lightingDirection);\n  float bO = 1.;\n  vec4 cc = vec4(bI(bJ, bK, bL, waterColor.rgb, lightingIntensity, bN, bO), waterColor.w);\n  gl_FragColor = bv(cc);\n}",defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}})}},WireFrameMaterial:nt$6,WireframeShader:class extends ie$5{constructor(t={}){let n=t.extraCommandProps||{};const i=[];n=g$3({},n,{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},sample:{alpha:!0}}),super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aBarycentric;\nvarying vec3 vBarycentric;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projMatrix;\nuniform mat4 positionMatrix;\nvarying vec3 vPosition;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = getPosition(aPosition);\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(c * d, modelMatrix);\n#else\ngl_Position = projMatrix * modelViewMatrix * c * d;\n#endif\nvBarycentric = aBarycentric;\n  vPosition = aPosition;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec3 vBarycentric;\nuniform float time;\nuniform float thickness;\nuniform float secondThickness;\nuniform float dashRepeats;\nuniform float dashLength;\nuniform bool dashOverlap;\nuniform bool dashEnabled;\nuniform bool dashAnimate;\nuniform bool seeThrough;\nuniform bool insideAltColor;\nuniform bool dualStroke;\nuniform bool squeeze;\nuniform float squeezeMin;\nuniform float squeezeMax;\nuniform vec4 stroke;\nuniform vec4 fill;\nuniform float opacity;\nuniform bool noiseEnable;\nvarying vec3 vPosition;\n#ifdef HAS_INSTANCE\nvarying vec4 vInstanceColor;\n#endif\n#include <mask_frag>\n#define F4 0.309016994374947451\n#define halfDist 0.5\nvec4 c(vec4 x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nfloat c(float x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nvec4 d(vec4 x) {\n  return c((x * 34. + 1.) * x);\n}\nfloat d(float x) {\n  return c((x * 34. + 1.) * x);\n}\nvec4 e(vec4 r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nfloat e(float r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nvec4 f(float h, vec4 i) {\n  const vec4 k = vec4(1., 1., 1., -1.);\n  vec4 p, s;\n  p.xyz = floor(fract(vec3(h) * i.xyz) * 7.) * i.z - 1.;\n  p.w = 1.5 - dot(abs(p.xyz), k.xyz);\n  s = vec4(lessThan(p, vec4(.0)));\n  p.xyz = p.xyz + (s.xyz * 2. - 1.) * s.www;\n  return p;\n}\nfloat l(vec4 m) {\n  const vec4 n = vec4(.138196601125011, .276393202250021, .414589803375032, -.447213595499958);\n  vec4 o = floor(m + dot(m, vec4(F4)));\n  vec4 u = m - o + dot(o, n.xxxx);\n  vec4 A;\n  vec3 B = step(u.yzw, u.xxx);\n  vec3 D = step(u.zww, u.yyz);\n  A.x = B.x + B.y + B.z;\n  A.yzw = 1. - B;\n  A.y += D.x + D.y;\n  A.zw += 1. - D.xy;\n  A.z += D.z;\n  A.w += 1. - D.z;\n  vec4 E = clamp(A, .0, 1.);\n  vec4 F = clamp(A - 1., .0, 1.);\n  vec4 G = clamp(A - 2., .0, 1.);\n  vec4 H = u - G + n.xxxx;\n  vec4 I = u - F + n.yyyy;\n  vec4 J = u - E + n.zzzz;\n  vec4 K = u + n.wwww;\n  o = c(o);\n  float L = d(d(d(d(o.w) + o.z) + o.y) + o.x);\n  vec4 M = d(d(d(d(o.w + vec4(G.w, F.w, E.w, 1.)) + o.z + vec4(G.z, F.z, E.z, 1.)) + o.y + vec4(G.y, F.y, E.y, 1.)) + o.x + vec4(G.x, F.x, E.x, 1.));\n  vec4 i = vec4(1. / 294., 1. / 49., 1. / 7., .0);\n  vec4 N = f(L, i);\n  vec4 O = f(M.x, i);\n  vec4 P = f(M.y, i);\n  vec4 Q = f(M.z, i);\n  vec4 R = f(M.w, i);\n  vec4 S = e(vec4(dot(N, N), dot(O, O), dot(P, P), dot(Q, Q)));\n  N *= S.x;\n  O *= S.y;\n  P *= S.z;\n  Q *= S.w;\n  R *= e(dot(R, R));\n  vec3 T = max(.6 - vec3(dot(u, u), dot(H, H), dot(I, I)), .0);\n  vec2 U = max(.6 - vec2(dot(J, J), dot(K, K)), .0);\n  T = T * T;\n  U = U * U;\n  return 49. * (dot(T * T, vec3(dot(N, u), dot(O, H), dot(P, I))) + dot(U * U, vec2(dot(Q, J), dot(R, K))));\n}\nconst float V = 3.14159265359;\nfloat W(float X, float Y) {\n  float Z = fwidth(Y) * halfDist;\n  return smoothstep(X - Z, X + Z, Y);\n}\nvec4 ba(vec3 bb) {\n  float bc = min(min(bb.x, bb.y), bb.z);\n  float bd = .0;\n  if(noiseEnable)\n    bd += l(vec4(vPosition.xyz * 80.0, time * halfDist)) * .12;\n  bc += bd;\n  float be = max(bb.x, bb.y);\n  if(bb.y < bb.x && bb.y < bb.z) {\n    be = 1. - be;\n  }\n  float bf = thickness;\n  if(squeeze) {\n    bf *= mix(squeezeMin, squeezeMax, (1. - sin(be * V)));\n  }\n  if(dashEnabled) {\n    float bg = 1. / dashRepeats * dashLength / 2.;\n    if(!dashOverlap) {\n      bg += 1. / dashRepeats / 2.;\n    }\n    if(dashAnimate) {\n      bg += time * .22;\n    }\n    float bh = fract((be + bg) * dashRepeats);\n    bf *= 1. - W(dashLength, bh);\n  }\n  float bi = 1. - W(bf, bc);\n#ifdef HAS_INSTANCE\nvec4 bj = vInstanceColor;\n#else\nvec4 bj = stroke;\n#endif\nvec4 bk = vec4(.0);\n  if(seeThrough) {\n    bk = vec4(bj.xyz, bi);\n    if(insideAltColor && !gl_FrontFacing) {\n      bk.rgb = fill.xyz;\n    }\n  } else {\n    vec3 bl = mix(fill.xyz, bj.xyz, bi);\n    bk.a = fill.a;\n    if(dualStroke) {\n      float bm = 1. - W(secondThickness, bc);\n      vec3 bn = mix(fill.xyz, stroke.xyz, abs(bm - bi));\n      bk.rgb = bn;\n    } else {\n      bk.rgb = bl;\n    }\n  }\n  return bk;\n}\nvoid main() {\n  glFragColor = ba(vBarycentric);\n  glFragColor *= halfDist + opacity;\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(t,n)=>multiply$5(i,n.viewMatrix,n.modelMatrix)}],extraCommandProps:n}),this.version=300}},earcut:gd,pbr:Fm}),isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,fastDeepEqual=function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var i,length,key,arrA=isArray(a),arrB=isArray(b);if(arrA&&arrB){if((length=a.length)!=b.length)return!1;for(i=length;0!=i--;)if(!equal(a[i],b[i]))return!1;return!0}if(arrA!=arrB)return!1;var dateA=a instanceof Date,dateB=b instanceof Date;if(dateA!=dateB)return!1;if(dateA&&dateB)return a.getTime()==b.getTime();var regexpA=a instanceof RegExp,regexpB=b instanceof RegExp;if(regexpA!=regexpB)return!1;if(regexpA&&regexpB)return a.toString()==b.toString();var keys=keyList(a);if((length=keys.length)!==keyList(b).length)return!1;for(i=length;0!=i--;)if(!hasProp.call(b,keys[i]))return!1;for(i=length;0!=i--;)if(!equal(a[key=keys[i]],b[key]))return!1;return!0}return a!=a&&b!=b};
/*!
	 * @maptalks/fusiongl v0.5.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.com
	 */
function _$5(E){for(let _=1;_<arguments.length;_++){const t=arguments[_];for(const _ in t)E[_]=t[_]}return E}function t$1(E,...t){for(let R=0;R<t.length;R++)_$5(E,t[R])}class R$7{constructor(E){this.context=E,this.COLOR_ATTACHMENT0_WEBGL=36064,this.COLOR_ATTACHMENT1_WEBGL=36065,this.COLOR_ATTACHMENT2_WEBGL=36066,this.COLOR_ATTACHMENT3_WEBGL=36067,this.COLOR_ATTACHMENT4_WEBGL=36068,this.COLOR_ATTACHMENT5_WEBGL=36069,this.COLOR_ATTACHMENT6_WEBGL=36070,this.COLOR_ATTACHMENT7_WEBGL=36071,this.COLOR_ATTACHMENT8_WEBGL=36072,this.COLOR_ATTACHMENT9_WEBGL=36073,this.COLOR_ATTACHMENT10_WEBGL=577040,this.COLOR_ATTACHMENT11_WEBGL=577041,this.COLOR_ATTACHMENT12_WEBGL=577042,this.COLOR_ATTACHMENT13_WEBGL=577043,this.COLOR_ATTACHMENT14_WEBGL=577044,this.COLOR_ATTACHMENT15_WEBGL=577045,this.DRAW_BUFFER0_WEBGL=34853,this.DRAW_BUFFER1_WEBGL=34854,this.DRAW_BUFFER2_WEBGL=34855,this.DRAW_BUFFER3_WEBGL=34856,this.DRAW_BUFFER4_WEBGL=34857,this.DRAW_BUFFER5_WEBGL=34858,this.DRAW_BUFFER6_WEBGL=34859,this.DRAW_BUFFER7_WEBGL=34860,this.DRAW_BUFFER8_WEBGL=34861,this.DRAW_BUFFER9_WEBGL=34862,this.DRAW_BUFFER10_WEBGL=34863,this.DRAW_BUFFER11_WEBGL=34864,this.DRAW_BUFFER12_WEBGL=34865,this.DRAW_BUFFER13_WEBGL=34866,this.DRAW_BUFFER14_WEBGL=34867,this.DRAW_BUFFER15_WEBGL=34868,this.MAX_COLOR_ATTACHMENTS_WEBGL=36063,this.MAX_DRAW_BUFFERS_WEBGL=2178}drawBuffersWEBGL(){return this.context.drawBuffers.apply(this.context,arguments)}}class T$7{constructor(E){this.context=E,this.VERTEX_ARRAY_BINDING_OES=34229}createVertexArrayOES(){return this.context.createVertexArray()}deleteVertexArrayOES(){return this.context.deleteVertexArray.apply(this.context,arguments)}isVertexArrayOES(){return this.context.isVertexArray.apply(this.context,arguments)}bindVertexArrayOES(){return this.context.bindVertexArray.apply(this.context,arguments)}}class A$4{constructor(E){this.context=E,this.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070}drawArraysInstancedANGLE(){return this.context.drawArraysInstanced.apply(this.context,arguments)}drawElementsInstancedANGLE(){return this.context.drawElementsInstanced.apply(this.context,arguments)}vertexAttribDivisorANGLE(){return this.context.vertexAttribDivisor.apply(this.context,arguments)}}const s={webgl_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},oes_element_index_uint:{},oes_texture_float:{},oes_texture_half_float:{HALF_FLOAT_OES:36193},ext_color_buffer_float:{},oes_standard_derivatives:{},ext_frag_depth:{},ext_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},ext_shader_texture_lod:{}},e$2={has(E,_){const t=E._;return!(!t&&!E.t.getExtension(_))&&(_=_.toLowerCase(),t&&s[_]||"webgl_draw_buffers"===_||"oes_vertex_array_object"===_||"angle_instanced_arrays"===_)},mock(E,_){return _=_.toLowerCase(),s[_]?E._?("oes_texture_float"!==_&&"oes_texture_half_float"!==_||E.t.getExtension("EXT_color_buffer_float"),s[_]):this.t.getExtension(_):"webgl_draw_buffers"===_?new R$7(E):"oes_vertex_array_object"===_?new T$7(E):"angle_instanced_arrays"===_?new A$4(E):null},getInternalFormat:(E,_,t)=>6402===_?33190:34041===_?35056:36193===t&&_===E.RGBA?34842:36193===t&&_===E.RGB?34843:t===E.FLOAT&&_===E.RGBA?34836:t===E.FLOAT&&_===E.RGB?34837:_,getTextureType:(E,_)=>36193===_?E.HALF_FLOAT:_};let r$1=1;class i$2{constructor(E){this.uid=r$1++,this.states=function(E){return{scissor:[0,0,E.canvas.width,E.canvas.height],viewport:[0,0,E.canvas.width,E.canvas.height],blendColor:[0,0,0,0],blendEquationSeparate:[E.FUNC_ADD,E.FUNC_ADD],blendFuncSeparate:[E.ONE,E.ZERO,E.ONE,E.ZERO],clearColor:[0,0,0,0],clearDepth:[1],clearStencil:[0],colorMask:[!0,!0,!0,!0],cullFace:[E.BACK],depthFunc:[E.LESS],depthMask:[!0],depthRange:[0,1],capabilities:{3042:!1,2884:!1,2929:!1,3024:!1,32823:!1,32926:!1,32928:!1,3089:!1,2960:!1},frontFace:[E.CCW],hint:{33170:[E.DONT_CARE],35723:[E.DONT_CARE]},lineWidth:[1],pixelStorei:{3333:[4],3317:[4],37440:[!1],37441:[!1],37443:[E.BROWSER_DEFAULT_WEBGL]},polygonOffset:[0,0],sampleCoverage:[1,!1],stencilFuncSeparate:{1028:[E.ALWAYS,0,4294967295],1029:[E.ALWAYS,0,4294967295]},stencilMaskSeparate:{1028:[4294967295],1029:[4294967295]},stencilOpSeparate:{1028:[E.KEEP,E.KEEP,E.KEEP],1029:[E.KEEP,E.KEEP,E.KEEP]},program:null,framebuffer:{36160:null,36008:null,36009:null},renderbuffer:{36161:null},textures:{active:-1,units:function(){const _=[],t=E.getParameter(E.MAX_COMBINED_TEXTURE_IMAGE_UNITS);for(let E=0;E<t;E++)_.push({3553:null,34067:null});return _[-1]={3553:null,34067:null},_}()},attributes:{},arrayBuffer:null,elementArrayBuffer:null}}(E),this.t=E,this.t._fusiongl_drawCalls=0,this._="undefined"!=typeof WebGL2RenderingContext&&this.t instanceof WebGL2RenderingContext,this.R=E.getParameter(E.MAX_VERTEX_ATTRIBS)}get canvas(){return this.t.canvas}get drawingBufferWidth(){return this.t.drawingBufferWidth}get drawingBufferHeight(){return this.t.drawingBufferHeight}get gl(){return this.t}get buffersOES(){return this.T||(this.T=this.t.getExtension("WEBGL_draw_buffers")),this.T}get vaoOES(){return this.A||(this.A=this.t.getExtension("OES_vertex_array_object")),this.A}get angleOES(){return this.s||(this.s=this.t.getExtension("ANGLE_instanced_arrays")),this.s}attachShader(E,_){return this.t.attachShader(E,_)}shaderSource(E,_){return this.t.shaderSource(E,_)}compileShader(E){return this.t.compileShader(E)}createShader(E){return this.t.createShader(E)}createProgram(){return this.t.createProgram()}deleteProgram(E){return this.states.program===E&&(this.states.program=null),this.t.deleteProgram(E)}deleteShader(E){return this.t.deleteShader(E)}detachShader(E,_){return this.t.detachShader(E,_)}getAttachedShaders(E){return this.t.getAttachedShaders(E)}linkProgram(E){return this.t.linkProgram(E)}getShaderParameter(E,_){return this.t.getShaderParameter(E,_)}getShaderPrecisionFormat(E,_){return this.t.getShaderPrecisionFormat(E,_)}getShaderInfoLog(E){return this.t.getShaderInfoLog(E)}getShaderSource(E){return this.t.getShaderSource(E)}getProgramInfoLog(E){return this.t.getProgramInfoLog(E)}getProgramParameter(E,_){return this.t.getProgramParameter(E,_)}getError(){return this.t.getError()}getContextAttributes(){return this.t.getContextAttributes()}getExtension(E){return e$2.has(this,E)?e$2.mock(this,E):this.t.getExtension(E)}getSupportedExtensions(){return this.t.getSupportedExtensions()}getParameter(E){return this.t.getParameter(E)}isEnabled(E){return this.t.isEnabled(E)}isProgram(E){return this.t.isProgram(E)}isShader(E){return this.t.isShader(E)}validateProgram(E){return this.t.validateProgram(E)}clear(E){return this.i(),this.t.clear(E)}drawArrays(E,_,t){return this.i(),this.N(),this.t.drawArrays(E,_,t)}drawElements(E,_,t,R){return this.i(),this.N(),this.t.drawElements(E,_,t,R)}drawBuffers(E){return this.i(),this.N(),this._?this.t.drawBuffers(E):this.buffersOES.drawBuffersWEBGL(E)}N(){this.t._fusiongl_drawCalls++}resetDrawCalls(){this.t._fusiongl_drawCalls=0}getDrawCalls(){return this.t._fusiongl_drawCalls}I(){const E=this.t,_=E.getParameter(E.CURRENT_PROGRAM),t=E.getProgramParameter(_,E.ACTIVE_ATTRIBUTES),R=[];for(let _=0;_<t;_++)R.push(E.getVertexAttrib(_,E.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING));this.h={buffers:R,elements:E.getParameter(E.ELEMENT_ARRAY_BUFFER_BINDING),framebuffer:E.getParameter(E.FRAMEBUFFER_BINDING)},window.DEBUGGING&&(console.log(this.uid,this.h),console.log(this.uid,this.states.attributes),console.log(this.states.attributes[0].buffer===this.h.buffers[0]),console.log(this.states.attributes[1].buffer===this.h.buffers[1]),console.log(this.states.attributes[2].buffer===this.h.buffers[2]))}finish(){return this.t.finish()}flush(){return this.i(),this.t.flush()}commit(){return this.i(),this.t.commit()}isContextLost(){return this.t.isContextLost()}}t$1(i$2.prototype,{DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBSTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}),t$1(i$2.prototype,{bufferData(...E){return this.i(),this.t.bufferData(...E)},bufferSubData(...E){return this.i(),this.t.bufferSubData(...E)},createBuffer(){return this.t.createBuffer()},deleteBuffer(E){const _=this.states;_.arrayBuffer===E?_.arrayBuffer=null:_.elementArrayBuffer===E&&(_.elementArrayBuffer=null);const t=_.attributes;for(const _ in t)t[_].buffer===E&&(t[_].buffer=null);return this.t.deleteBuffer(E)},getBufferParameter(E,_){return this.i(),this.t.getBufferParameter(E,_)},isBuffer(E){return this.t.isBuffer(E)}}),t$1(i$2.prototype,{checkFramebufferStatus(E){return this.t.checkFramebufferStatus(E)},createFramebuffer(){return this.t.createFramebuffer()},deleteFramebuffer(E){const _=this.states.framebuffer;for(const t in _)_[t]===E&&(_[t]=null);return this.t.deleteFramebuffer(E)},framebufferRenderbuffer(E,_,t,R){return this.i(),this.t.framebufferRenderbuffer(E,_,t,R)},framebufferTexture2D(E,_,t,R,T){return this.i(),this.t.framebufferTexture2D(E,_,t,R,T)},getFramebufferAttachmentParameter(E,_,t){return this.i(),this.t.getFramebufferAttachmentParameter(E,_,t)},isFramebuffer(E){return this.t.isFramebuffer(E)},readPixels(E,_,t,R,T,A,s){return this.i(),this.t.readPixels(E,_,t,R,T,A,s)},blitFramebuffer(E,_,t,R,T,A,s,e,r,i){return this.i(),this.t.blitFramebuffer(E,_,t,R,T,A,s,e,r,i)}}),t$1(i$2.prototype,{createRenderbuffer(){return this.t.createRenderbuffer()},deleteRenderbuffer(E){const _=this.states.renderbuffer;for(const t in _)_[t]===E&&(_[t]=null);return this.t.deleteRenderbuffer(E)},getRenderbufferParameter(E,_){return this.i(),this.t.getRenderbufferParameter(E,_)},isRenderbuffer(E){return this.t.isRenderbuffer(E)},renderbufferStorage(E,_,t,R){return this.i(),this.t.renderbufferStorage(E,_,t,R)},renderbufferStorageMultisample(E,_,t,R,T){return this.i(),this.t.renderbufferStorageMultisample(E,_,t,R,T)}}),t$1(i$2.prototype,{scissor(E,_,t,R){this.i();const T=this.states.scissor;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.scissor(E,_,t,R))},viewport(E,_,t,R){this.i();const T=this.states.viewport;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.viewport(E,_,t,R))},blendColor(E,_,t,R){this.i();const T=this.states.blendColor;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.blendColor(E,_,t,R))},blendEquation(E){this.i();const _=this.states.blendEquationSeparate;_[0]===E&&_[1]===E||(_[0]=E,_[1]=E,this.t.blendEquation(E))},blendEquationSeparate(E,_){this.i();const t=this.states.blendEquationSeparate;t[0]===E&&t[1]===_||(t[0]=E,t[1]=_,this.t.blendEquationSeparate(E,_))},blendFunc(E,_){this.i();const t=this.states.blendFuncSeparate;t[0]===E&&t[2]===E&&t[1]===_&&t[3]===_||(t[0]=E,t[1]=_,t[2]=E,t[3]=_,this.t.blendFunc(E,_))},blendFuncSeparate(E,_,t,R){this.i();const T=this.states.blendFuncSeparate;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.blendFuncSeparate(E,_,t,R))},clearColor(E,_,t,R){this.i();const T=this.states.clearColor;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.clearColor(E,_,t,R))},clearDepth(E){this.i();const _=this.states.clearDepth;_[0]!==E&&(_[0]=E,this.t.clearDepth(E))},clearStencil(E){this.i();const _=this.states.clearStencil;_[0]!==E&&(_[0]=E,this.t.clearStencil(E))},colorMask(E,_,t,R){this.i();const T=this.states.colorMask;T[0]===E&&T[1]===_&&T[2]===t&&T[3]===R||(T[0]=E,T[1]=_,T[2]=t,T[3]=R,this.t.colorMask(E,_,t,R))},cullFace(E){this.i();const _=this.states.cullFace;_[0]!==E&&(_[0]=E,this.t.cullFace(E))},depthFunc(E){this.i();const _=this.states.depthFunc;_[0]!==E&&(_[0]=E,this.t.depthFunc(E))},depthMask(E){this.i();const _=this.states.depthMask;_[0]!==E&&(_[0]=E,this.t.depthMask(E))},depthRange(E,_){this.i();const t=this.states.depthRange;t[0]===E&&t[1]===_||(t[0]=E,t[1]=_,this.t.depthRange(E,_))},disable(E){this.i();const _=this.states.capabilities;_[E]&&(_[E]=!1,this.t.disable(E))},enable(E){this.i();const _=this.states.capabilities;_[E]||(_[E]=!0,this.t.enable(E))},frontFace(E){this.i();const _=this.states.frontFace;_[0]!==E&&(_[0]=E,this.t.frontFace(E))},hint(E,_){this.i();const t=this.states.hint;t[E][0]!==_&&(t[E][0]=_,this.t.hint(E,_))},lineWidth(E){this.i();const _=this.states.lineWidth;_[0]!==E&&(_[0]=E,this.t.lineWidth(E))},pixelStorei(E,_){this.i();const t=this.states.pixelStorei;t[E]!==_&&(t[E]&&(t[E][0]=_),this.t.pixelStorei(E,_))},polygonOffset(E,_){this.i();const t=this.states.polygonOffset;t[0]===E&&t[1]===_||(t[0]=E,t[1]=_,this.t.polygonOffset(E,_))},sampleCoverage(E,_){this.i();const t=this.states.sampleCoverage;t[0]===E&&t[1]===_||(t[0]=E,t[1]=_,this.t.sampleCoverage(E,_))},stencilFunc(E,_,t){this.i();const R=this.states.stencilFuncSeparate,T=this.t;R[T.FRONT][0]===E&&R[T.FRONT][1]===_&&R[T.FRONT][2]===t&&R[T.BACK][0]===E&&R[T.BACK][1]===_&&R[T.BACK][2]===t||(R[T.FRONT][0]=R[T.BACK][0]=E,R[T.FRONT][1]=R[T.BACK][1]=_,R[T.FRONT][2]=R[T.BACK][2]=t,this.t.stencilFunc(E,_,t))},stencilFuncSeparate(E,_,t,R){if(this.i(),E===this.t.FRONT_AND_BACK)return void this.stencilFunc(_,t,R);const T=this.states.stencilFuncSeparate;T[E][0]===_&&T[E][1]===t&&T[E][2]===R||(T[E][0]=_,T[E][1]=t,T[E][2]=R,this.t.stencilFuncSeparate(E,_,t,R))},stencilMask(E){this.i();const _=this.t,t=this.states.stencilMaskSeparate;t[_.FRONT][0]===E&&t[_.BACK][0]===E||(t[_.FRONT][0]=E,t[_.BACK][0]=E,this.t.stencilMask(E))},stencilMaskSeparate(E,_){if(this.i(),E===this.t.FRONT_AND_BACK)return void this.stencilMask(_);const t=this.states.stencilMaskSeparate;t[E][0]!==_&&(t[E][0]=_,this.t.stencilMaskSeparate(E,_))},stencilOp(E,_,t){this.i();const R=this.states.stencilOpSeparate,T=this.t;R[T.FRONT][0]===E&&R[T.FRONT][1]===_&&R[T.FRONT][2]===t&&R[T.BACK][0]===E&&R[T.BACK][1]===_&&R[T.BACK][2]===t||(R[T.FRONT][0]=R[T.BACK][0]=E,R[T.FRONT][1]=R[T.BACK][1]=_,R[T.FRONT][2]=R[T.BACK][2]=t,this.t.stencilOp(E,_,t))},stencilOpSeparate(E,_,t,R){if(this.i(),E===this.t.FRONT_AND_BACK)return void this.stencilOp(_,t,R);const T=this.states.stencilOpSeparate;T[E][0]===_&&T[E][1]===t&&T[E][2]===R||(T[E][0]=_,T[E][1]=t,T[E][2]=R,this.t.stencilOpSeparate(E,_,t,R))},bindFramebuffer(E,_){this.i();const t=this.states.framebuffer;t[E]!==_&&(t[E]=_,this.t.bindFramebuffer(E,_))},bindRenderbuffer(E,_){this.i();const t=this.states.renderbuffer;t[E]!==_&&(t[E]=_,this.t.bindRenderbuffer(E,_))},bindTexture(E,_){this.i();const t=this.states.textures;t.units[-1!==t.active?t.active-33984:-1][E]=_,this.t.bindTexture(E,_)},activeTexture(E){this.i();const _=this.t,t=this.states.textures,R=t.active;t.active=E,this.activeUnit!==E&&(_.activeTexture(E),this.activeUnit=E),-1===R&&(t.units[E-33984][_.TEXTURE_2D]=t.units[-1][_.TEXTURE_2D],t.units[E-33984][_.TEXTURE_CUBE_MAP]=t.units[-1][_.TEXTURE_CUBE_MAP],t.units[-1][_.TEXTURE_2D]=null,t.units[-1][_.TEXTURE_CUBE_MAP]=null)},useProgram(E){this.i();const _=this.states;_.program!==E&&(_.program=E,this.t.useProgram(E))},bindBuffer(E,_){this.i();const t=this.t,R=this.states;E===t.ELEMENT_ARRAY_BUFFER?R.elementArrayBuffer=_:R.arrayBuffer=_,t.bindBuffer(E,_)},bindVertexArray(E){this.i();const _=this.t,t=this.states;t.vao!==E&&(t.vao=E,this._?_.bindVertexArray(E):this.vaoOES.bindVertexArrayOES(E))},vertexAttribPointer(E,_,t,R,T,A){this.i(),this.states.attributes[E]||(this.states.attributes[E]={enable:!0});const s=this.states.attributes[E];return s.buffer=this.states.arrayBuffer,s.args?(s.args[0]=E,s.args[1]=_,s.args[2]=t,s.args[3]=R,s.args[4]=T,s.args[5]=A):s.args=[E,_,t,R,T,A],this.t.vertexAttribPointer(E,_,t,R,T,A)},vertexAttribDivisor(E,_){return this.i(),this.states.attributes[E].divisor=_,this._?this.t.vertexAttribDivisor(E,_):this.angleOES.vertexAttribDivisorANGLE(E,_)}},{i(){const E=this.t;if(E.S&&E.S!==this){this.O(E.S.states),E.S=this}E.S=this},O(_){if(!_)return;delete this.activeUnit;const t=this.states,R=this.t;for(const T in t)if("capabilities"!==T&&"textures"!==T&&"attributes"!==T&&"arrayBuffer"!==T&&"elementArrayBuffer"!==T&&"vao"!==T)if("program"===T)t.program!==_.program&&R.useProgram(t.program);else if("framebuffer"===T)for(const E in t[T])t[T][E]!==_[T][E]&&R.bindFramebuffer(+E,t[T][E]);else if("renderbuffer"===T)for(const E in t[T])t[T][E]!==_[T][E]&&R.bindRenderbuffer(+E,t[T][E]);else if(!fastDeepEqual(t[T],_[T]))if(Array.isArray(_[T]))R[T](...t[T]);else if(_[T])for(const A in t[T])fastDeepEqual(t[T][A],_[T][A])||R[T](+A,...t[T][A]);for(const E in t.capabilities)t.capabilities[E]!==_.capabilities[E]&&R[t.capabilities[E]?"enable":"disable"](+E);const T=t.textures,s=T.units,e=_.textures.units,r=T.active-R.TEXTURE0;for(let E=0;E<s.length;E++)E===r||s[E][R.TEXTURE_2D]===e[E][R.TEXTURE_2D]&&s[E][R.TEXTURE_CUBE_MAP]===e[E][R.TEXTURE_CUBE_MAP]||(R.activeTexture(R.TEXTURE0+E),R.bindTexture(R.TEXTURE_2D,s[E][R.TEXTURE_2D]),R.bindTexture(R.TEXTURE_CUBE_MAP,s[E][R.TEXTURE_CUBE_MAP]));if(T.active>-1){const E=s[r];E[R.TEXTURE_2D]===e[r][R.TEXTURE_2D]&&E[R.TEXTURE_CUBE_MAP]===e[r][R.TEXTURE_CUBE_MAP]||(R.activeTexture(T.active),R.bindTexture(R.TEXTURE_2D,E[R.TEXTURE_2D]),R.bindTexture(R.TEXTURE_CUBE_MAP,E[R.TEXTURE_CUBE_MAP]))}this._?R.bindVertexArray(null):this.A&&this.A.bindVertexArrayOES(null);const i=this.R,N=t.attributes;for(let E=0;E<i;E++){const _=N[E];_?(_.buffer&&(R.bindBuffer(R.ARRAY_BUFFER,_.buffer),R.vertexAttribPointer(..._.args),void 0!==_.divisor&&(this._?R.vertexAttribDivisor(E,_.divisor):this.angleOES.vertexAttribDivisorANGLE(E,_.divisor))),_.enable?R.enableVertexAttribArray(E):R.disableVertexAttribArray(E)):R.disableVertexAttribArray(E)}R.bindBuffer(R.ARRAY_BUFFER,t.arrayBuffer),R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,t.elementArrayBuffer);const I=t.vao;I&&(this._?R.bindVertexArray(I||null):this.A&&this.A.bindVertexArrayOES(I||null))}}),t$1(i$2.prototype,{compressedTexImage2D(E,_,t,R,T,A,s){return this.i(),this.t.compressedTexImage2D(E,_,t,R,T,A,s)},copyTexImage2D(E,_,t,R,T,A,s,e){return this.i(),this.t.copyTexImage2D(E,_,t,R,T,A,s,e)},copyTexSubImage2D(E,_,t,R,T,A,s,e){return this.i(),this.t.copyTexSubImage2D(E,_,t,R,T,A,s,e)},createTexture(){return this.t.createTexture()},deleteTexture(E){const _=this.states.textures.units;for(let t=0;t<_.length;t++)for(const R in _[t])_[t][R]===E&&(_[t][R]=null);return this.t.deleteTexture(E)},generateMipmap(E){return this.i(),this.t.generateMipmap(E)},getTexParameter(E,_){return this.i(),this.t.getTexParameter(E,_)},isTexture(E){return this.t.isTexture(E)},texImage2D(...E){if(this.i(),this._){const _=E[E.length-2],t=e$2.getInternalFormat(this.t,E[2],_);t!==E[2]&&(E[2]=t);const R=e$2.getTextureType(this.t,_);R!==_&&(E[E.length-2]=R)}return this.t.texImage2D(...E)},texSubImage2D(E){if(this.i(),this._){const _=E[E.length-2],t=e$2.getTextureType(this.t,_);t!==_&&(E[E.length-2]=t)}return this.t.texSubImage2D(...E)},texParameterf(E,_,t){return this.i(),this.t.texParameterf(E,_,t)},texParameteri(E,_,t){return this.i(),this.t.texParameteri(E,_,t)}}),t$1(i$2.prototype,{bindAttribLocation(E,_,t){return this.t.bindAttribLocation(E,_,t)},enableVertexAttribArray(E){return this.i(),this.states.attributes[E]||(this.states.attributes[E]={}),this.states.attributes[E].enable=!0,this.t.enableVertexAttribArray(E)},disableVertexAttribArray(E){return this.i(),this.states.attributes[E]||(this.states.attributes[E]={}),this.states.attributes[E].enable=!1,this.t.disableVertexAttribArray(E)},getActiveAttrib(E,_){return this.t.getActiveAttrib(E,_)},getActiveUniform(E,_){return this.t.getActiveUniform(E,_)},getAttribLocation(E,_){return this.t.getAttribLocation(E,_)},getUniformLocation(E,_){return this.t.getUniformLocation(E,_)},getVertexAttrib(E,_){return this.i(),this.t.getVertexAttrib(E,_)},getVertexAttribOffset(E,_){return this.i(),this.t.getVertexAttribOffset(E,_)},uniformMatrix2fv(E,_,t){return this.i(),this.t.uniformMatrix2fv(E,_,t)},uniformMatrix3fv(E,_,t){return this.i(),this.t.uniformMatrix3fv(E,_,t)},uniformMatrix4fv(E,_,t){return this.i(),this.t.uniformMatrix4fv(E,_,t)},uniform1f(E,_){return this.i(),this.t.uniform1f(E,_)},uniform1fv(E,_){return this.i(),this.t.uniform1fv(E,_)},uniform1i(E,_){return this.i(),this.t.uniform1i(E,_)},uniform1iv(E,_){return this.i(),this.t.uniform1iv(E,_)},uniform2f(E,_,t){return this.i(),this.t.uniform2f(E,_,t)},uniform2fv(E,_){return this.i(),this.t.uniform2fv(E,_)},uniform2i(E,_,t){return this.i(),this.t.uniform2i(E,_,t)},uniform2iv(E,_){return this.i(),this.t.uniform2iv(E,_)},uniform3f(E,_,t,R){return this.i(),this.t.uniform3f(E,_,t,R)},uniform3fv(E,_){return this.i(),this.t.uniform3fv(E,_)},uniform3i(E,_,t,R){return this.i(),this.t.uniform3i(E,_,t,R)},uniform3iv(E,_){return this.i(),this.t.uniform3iv(E,_)},uniform4f(E,_,t,R,T){return this.i(),this.t.uniform4f(E,_,t,R,T)},uniform4fv(E,_){return this.i(),this.t.uniform4fv(E,_)},uniform4i(E,_,t,R,T){return this.i(),this.t.uniform4i(E,_,t,R,T)},uniform4iv(E,_){return this.i(),this.t.uniform4iv(E,_)},vertexAttrib1f(E,_){return this.i(),this.t.vertexAttrib1f(E,_)},vertexAttrib2f(E,_,t){return this.i(),this.t.vertexAttrib2f(E,_,t)},vertexAttrib3f(E,_,t,R){return this.i(),this.t.vertexAttrib3f(E,_,t,R)},vertexAttrib4f(E,_,t,R,T){return this.i(),this.t.vertexAttrib4f(E,_,t,R,T)},vertexAttrib1fv(E,_){return this.i(),this.t.vertexAttrib1fv(E,_)},vertexAttrib2fv(E,_){return this.i(),this.t.vertexAttrib2fv(E,_)},vertexAttrib3fv(E,_){return this.i(),this.t.vertexAttrib3fv(E,_)},vertexAttrib4fv(E,_){return this.i(),this.t.vertexAttrib4fv(E,_)}}),t$1(i$2.prototype,{createVertexArray(){return this._?this.t.createVertexArray():this.vaoOES.createVertexArrayOES()},deleteVertexArray(E){const _=this.states;return _.vao===E&&(_.vao=null),this._?this.t.deleteVertexArray(E):this.vaoOES.deleteVertexArrayOES(E)},isVertexArray(E){return this._?this.t.isVertexArray(E):this.vaoOES.isVertexArrayOES(E)}}),t$1(i$2.prototype,{drawArraysInstanced(E,_,t,R){return this.i(),this.N(),this._?this.t.drawArraysInstanced(E,_,t,R):this.angleOES.drawArraysInstancedANGLE(E,_,t,R)},drawElementsInstanced(E,_,t,R,T){return this.i(),this.N(),this._?this.t.drawElementsInstanced(E,_,t,R,T):this.angleOES.drawElementsInstancedANGLE(E,_,t,R,T)}});
/*!
	 * @maptalks/gl v0.81.4
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.com
	 */
var m$4={exports:{}},v$5={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},w$6={exports:{}},b$5=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},_$4=Array.prototype.concat,y$4=Array.prototype.slice,M$6=w$6.exports=function(t){for(var i=[],e=0,s=t.length;e<s;e++){var n=t[e];b$5(n)?i=_$4.call(i,y$4.call(n)):i.push(n)}return i};M$6.wrap=function(t){return function(){return t(M$6(arguments))}};var x$5=v$5,C$5=w$6.exports,S$6=Object.hasOwnProperty,T$6=Object.create(null);for(var O$6 in x$5)S$6.call(x$5,O$6)&&(T$6[x$5[O$6]]=O$6);var k$6=m$4.exports={to:{},get:{}};function A$3(t,i,e){return Math.min(Math.max(i,t),e)}function E$5(t){var i=Math.round(t).toString(16).toUpperCase();return i.length<2?"0"+i:i}k$6.get=function(t){var i,e;switch(t.substring(0,3).toLowerCase()){case"hsl":i=k$6.get.hsl(t),e="hsl";break;case"hwb":i=k$6.get.hwb(t),e="hwb";break;default:i=k$6.get.rgb(t),e="rgb"}return i?{model:e,value:i}:null},k$6.get.rgb=function(t){if(!t)return null;var i,e,s,n=[0,0,0,1];if(i=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(s=i[2],i=i[1],e=0;e<3;e++){var r=2*e;n[e]=parseInt(i.slice(r,r+2),16)}s&&(n[3]=parseInt(s,16)/255)}else if(i=t.match(/^#([a-f0-9]{3,4})$/i)){for(s=(i=i[1])[3],e=0;e<3;e++)n[e]=parseInt(i[e]+i[e],16);s&&(n[3]=parseInt(s+s,16)/255)}else if(i=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(e=0;e<3;e++)n[e]=parseInt(i[e+1],0);i[4]&&(n[3]=i[5]?.01*parseFloat(i[4]):parseFloat(i[4]))}else{if(!(i=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(i=t.match(/^(\w+)$/))?"transparent"===i[1]?[0,0,0,0]:S$6.call(x$5,i[1])?((n=x$5[i[1]])[3]=1,n):null:null;for(e=0;e<3;e++)n[e]=Math.round(2.55*parseFloat(i[e+1]));i[4]&&(n[3]=i[5]?.01*parseFloat(i[4]):parseFloat(i[4]))}for(e=0;e<3;e++)n[e]=A$3(n[e],0,255);return n[3]=A$3(n[3],0,1),n},k$6.get.hsl=function(t){if(!t)return null;var i=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(i){var e=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,A$3(parseFloat(i[2]),0,100),A$3(parseFloat(i[3]),0,100),A$3(isNaN(e)?1:e,0,1)]}return null},k$6.get.hwb=function(t){if(!t)return null;var i=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(i){var e=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,A$3(parseFloat(i[2]),0,100),A$3(parseFloat(i[3]),0,100),A$3(isNaN(e)?1:e,0,1)]}return null},k$6.to.hex=function(){var t=C$5(arguments);return"#"+E$5(t[0])+E$5(t[1])+E$5(t[2])+(t[3]<1?E$5(Math.round(255*t[3])):"")},k$6.to.rgb=function(){var t=C$5(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},k$6.to.rgb.percent=function(){var t=C$5(arguments),i=Math.round(t[0]/255*100),e=Math.round(t[1]/255*100),s=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+i+"%, "+e+"%, "+s+"%)":"rgba("+i+"%, "+e+"%, "+s+"%, "+t[3]+")"},k$6.to.hsl=function(){var t=C$5(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},k$6.to.hwb=function(){var t=C$5(arguments),i="";return t.length>=4&&1!==t[3]&&(i=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+i+")"},k$6.to.keyword=function(t){return T$6[t.slice(0,3)]};var L$7={exports:{}},F$6=v$5,I$5={};for(var R$6 in F$6)F$6.hasOwnProperty(R$6)&&(I$5[F$6[R$6]]=R$6);var P$6=L$7.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var H$7 in P$6)if(P$6.hasOwnProperty(H$7)){if(!("channels"in P$6[H$7]))throw new Error("missing channels property: "+H$7);if(!("labels"in P$6[H$7]))throw new Error("missing channel labels property: "+H$7);if(P$6[H$7].labels.length!==P$6[H$7].channels)throw new Error("channel and label counts mismatch: "+H$7);var D$6=P$6[H$7].channels,N$7=P$6[H$7].labels;delete P$6[H$7].channels,delete P$6[H$7].labels,Object.defineProperty(P$6[H$7],"channels",{value:D$6}),Object.defineProperty(P$6[H$7],"labels",{value:N$7})}P$6.rgb.hsl=function(t){var i,e,s=t[0]/255,n=t[1]/255,r=t[2]/255,h=Math.min(s,n,r),o=Math.max(s,n,r),a=o-h;return o===h?i=0:s===o?i=(n-r)/a:n===o?i=2+(r-s)/a:r===o&&(i=4+(s-n)/a),(i=Math.min(60*i,360))<0&&(i+=360),e=(h+o)/2,[i,100*(o===h?0:e<=.5?a/(o+h):a/(2-o-h)),100*e]},P$6.rgb.hsv=function(t){var i,e,s,n,r,h=t[0]/255,o=t[1]/255,a=t[2]/255,l=Math.max(h,o,a),c=l-Math.min(h,o,a),u=function(t){return(l-t)/6/c+.5};return 0===c?n=r=0:(r=c/l,i=u(h),e=u(o),s=u(a),h===l?n=s-e:o===l?n=1/3+i-s:a===l&&(n=2/3+e-i),n<0?n+=1:n>1&&(n-=1)),[360*n,100*r,100*l]},P$6.rgb.hwb=function(t){var i=t[0],e=t[1],s=t[2];return[P$6.rgb.hsl(t)[0],1/255*Math.min(i,Math.min(e,s))*100,100*(s=1-1/255*Math.max(i,Math.max(e,s)))]},P$6.rgb.cmyk=function(t){var i,e=t[0]/255,s=t[1]/255,n=t[2]/255;return[100*((1-e-(i=Math.min(1-e,1-s,1-n)))/(1-i)||0),100*((1-s-i)/(1-i)||0),100*((1-n-i)/(1-i)||0),100*i]},P$6.rgb.keyword=function(t){var i=I$5[t];if(i)return i;var e,s,n,r=1/0;for(var h in F$6)if(F$6.hasOwnProperty(h)){var a=(s=t,n=F$6[h],Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2)+Math.pow(s[2]-n[2],2));a<r&&(r=a,e=h)}return e},P$6.keyword.rgb=function(t){return F$6[t]},P$6.rgb.xyz=function(t){var i=t[0]/255,e=t[1]/255,s=t[2]/255;return[100*(.4124*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.3576*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.1805*(s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92)),100*(.2126*i+.7152*e+.0722*s),100*(.0193*i+.1192*e+.9505*s)]},P$6.rgb.lab=function(t){var i=P$6.rgb.xyz(t),e=i[0],s=i[1],n=i[2];return s/=100,n/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116)-16,500*(e-s),200*(s-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]},P$6.hsl.rgb=function(t){var i,e,s,n,r,h=t[0]/360,o=t[1]/100,a=t[2]/100;if(0===o)return[r=255*a,r,r];i=2*a-(e=a<.5?a*(1+o):a+o-a*o),n=[0,0,0];for(var l=0;l<3;l++)(s=h+1/3*-(l-1))<0&&s++,s>1&&s--,n[l]=255*(r=6*s<1?i+6*(e-i)*s:2*s<1?e:3*s<2?i+(e-i)*(2/3-s)*6:i);return n},P$6.hsl.hsv=function(t){var i=t[0],e=t[1]/100,s=t[2]/100,n=e,r=Math.max(s,.01);return e*=(s*=2)<=1?s:2-s,n*=r<=1?r:2-r,[i,100*(0===s?2*n/(r+n):2*e/(s+e)),(s+e)/2*100]},P$6.hsv.rgb=function(t){var i=t[0]/60,e=t[1]/100,s=t[2]/100,n=Math.floor(i)%6,r=i-Math.floor(i),h=255*s*(1-e),o=255*s*(1-e*r),a=255*s*(1-e*(1-r));switch(s*=255,n){case 0:return[s,a,h];case 1:return[o,s,h];case 2:return[h,s,a];case 3:return[h,o,s];case 4:return[a,h,s];case 5:return[s,h,o]}},P$6.hsv.hsl=function(t){var i,e,s,n=t[0],r=t[1]/100,h=t[2]/100,o=Math.max(h,.01);return s=(2-r)*h,e=r*o,[n,100*(e=(e/=(i=(2-r)*o)<=1?i:2-i)||0),100*(s/=2)]},P$6.hwb.rgb=function(t){var i,e,s,n,r,h,o,a=t[0]/360,l=t[1]/100,c=t[2]/100,u=l+c;switch(u>1&&(l/=u,c/=u),s=6*a-(i=Math.floor(6*a)),0!=(1&i)&&(s=1-s),n=l+s*((e=1-c)-l),i){default:case 6:case 0:r=e,h=n,o=l;break;case 1:r=n,h=e,o=l;break;case 2:r=l,h=e,o=n;break;case 3:r=l,h=n,o=e;break;case 4:r=n,h=l,o=e;break;case 5:r=e,h=l,o=n}return[255*r,255*h,255*o]},P$6.cmyk.rgb=function(t){var e=t[1]/100,s=t[2]/100,n=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-n)+n)),255*(1-Math.min(1,e*(1-n)+n)),255*(1-Math.min(1,s*(1-n)+n))]},P$6.xyz.rgb=function(t){var i,e,s,n=t[0]/100,r=t[1]/100,h=t[2]/100;return e=-.9689*n+1.8758*r+.0415*h,s=.0557*n+-.204*r+1.057*h,i=(i=3.2406*n+-1.5372*r+-.4986*h)>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,[255*(i=Math.min(Math.max(0,i),1)),255*(e=Math.min(Math.max(0,e),1)),255*(s=Math.min(Math.max(0,s),1))]},P$6.xyz.lab=function(t){var i=t[0],e=t[1],s=t[2];return e/=100,s/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116)-16,500*(i-e),200*(e-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},P$6.lab.xyz=function(t){var i,e,s;i=t[1]/500+(e=(t[0]+16)/116),s=e-t[2]/200;var r=Math.pow(e,3),h=Math.pow(i,3),o=Math.pow(s,3);return e=r>.008856?r:(e-16/116)/7.787,i=h>.008856?h:(i-16/116)/7.787,s=o>.008856?o:(s-16/116)/7.787,[i*=95.047,e*=100,s*=108.883]},P$6.lab.lch=function(t){var i,e=t[0],s=t[1],n=t[2];return(i=360*Math.atan2(n,s)/2/Math.PI)<0&&(i+=360),[e,Math.sqrt(s*s+n*n),i]},P$6.lch.lab=function(t){var i,s=t[1];return i=t[2]/360*2*Math.PI,[t[0],s*Math.cos(i),s*Math.sin(i)]},P$6.rgb.ansi16=function(t){var i=t[0],e=t[1],s=t[2],n=1 in arguments?arguments[1]:P$6.rgb.hsv(t)[2];if(0===(n=Math.round(n/50)))return 30;var r=30+(Math.round(s/255)<<2|Math.round(e/255)<<1|Math.round(i/255));return 2===n&&(r+=60),r},P$6.hsv.ansi16=function(t){return P$6.rgb.ansi16(P$6.hsv.rgb(t),t[2])},P$6.rgb.ansi256=function(t){var i=t[0],e=t[1],s=t[2];return i===e&&e===s?i<8?16:i>248?231:Math.round((i-8)/247*24)+232:16+36*Math.round(i/255*5)+6*Math.round(e/255*5)+Math.round(s/255*5)},P$6.ansi16.rgb=function(t){var i=t%10;if(0===i||7===i)return t>50&&(i+=3.5),[i=i/10.5*255,i,i];var e=.5*(1+~~(t>50));return[(1&i)*e*255,(i>>1&1)*e*255,(i>>2&1)*e*255]},P$6.ansi256.rgb=function(t){if(t>=232){var i=10*(t-232)+8;return[i,i,i]}var e;return t-=16,[Math.floor(t/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},P$6.rgb.hex=function(t){var i=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(i.length)+i},P$6.hex.rgb=function(t){var i=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!i)return[0,0,0];var e=i[0];3===i[0].length&&(e=e.split("").map((function(t){return t+t})).join(""));var s=parseInt(e,16);return[s>>16&255,s>>8&255,255&s]},P$6.rgb.hcg=function(t){var i,e=t[0]/255,s=t[1]/255,n=t[2]/255,r=Math.max(Math.max(e,s),n),h=Math.min(Math.min(e,s),n),o=r-h;return i=o<=0?0:r===e?(s-n)/o%6:r===s?2+(n-e)/o:4+(e-s)/o+4,i/=6,[360*(i%=1),100*o,100*(o<1?h/(1-o):0)]},P$6.hsl.hcg=function(t){var s,i=t[1]/100,e=t[2]/100,n=0;return(s=e<.5?2*i*e:2*i*(1-e))<1&&(n=(e-.5*s)/(1-s)),[t[0],100*s,100*n]},P$6.hsv.hcg=function(t){var e=t[2]/100,s=t[1]/100*e,n=0;return s<1&&(n=(e-s)/(1-s)),[t[0],100*s,100*n]},P$6.hcg.rgb=function(t){var e=t[1]/100,s=t[2]/100;if(0===e)return[255*s,255*s,255*s];var n,r=[0,0,0],h=t[0]/360%1*6,o=h%1,a=1-o;switch(Math.floor(h)){case 0:r[0]=1,r[1]=o,r[2]=0;break;case 1:r[0]=a,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=o;break;case 3:r[0]=0,r[1]=a,r[2]=1;break;case 4:r[0]=o,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=a}return[255*(e*r[0]+(n=(1-e)*s)),255*(e*r[1]+n),255*(e*r[2]+n)]},P$6.hcg.hsv=function(t){var i=t[1]/100,e=i+t[2]/100*(1-i),s=0;return e>0&&(s=i/e),[t[0],100*s,100*e]},P$6.hcg.hsl=function(t){var i=t[1]/100,e=t[2]/100*(1-i)+.5*i,s=0;return e>0&&e<.5?s=i/(2*e):e>=.5&&e<1&&(s=i/(2*(1-e))),[t[0],100*s,100*e]},P$6.hcg.hwb=function(t){var i=t[1]/100,e=i+t[2]/100*(1-i);return[t[0],100*(e-i),100*(1-e)]},P$6.hwb.hcg=function(t){var e=1-t[2]/100,s=e-t[1]/100,n=0;return s<1&&(n=(e-s)/(1-s)),[t[0],100*s,100*n]},P$6.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},P$6.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},P$6.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},P$6.gray.hsl=P$6.gray.hsv=function(t){return[0,0,t[0]]},P$6.gray.hwb=function(t){return[0,100,t[0]]},P$6.gray.cmyk=function(t){return[0,0,0,t[0]]},P$6.gray.lab=function(t){return[t[0],0,0]},P$6.gray.hex=function(t){var i=255&Math.round(t[0]/100*255),e=((i<<16)+(i<<8)+i).toString(16).toUpperCase();return"000000".substring(e.length)+e},P$6.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var G$6=L$7.exports;function B$6(t,i){return function(e){return i(t(e))}}function V$7(t,i){for(var e=[i[t].parent,t],s=G$6[i[t].parent][t],n=i[t].parent;i[n].parent;)e.unshift(i[n].parent),s=B$6(G$6[i[n].parent][n],s),n=i[n].parent;return s.conversion=e,s}var U$6=L$7.exports,z$5=function(t){for(var i=function(t){var i=function(){for(var t={},i=Object.keys(G$6),e=i.length,s=0;s<e;s++)t[i[s]]={distance:-1,parent:null};return t}(),e=[t];for(i[t].distance=0;e.length;)for(var s=e.pop(),n=Object.keys(G$6[s]),r=n.length,h=0;h<r;h++){var o=n[h],a=i[o];-1===a.distance&&(a.distance=i[s].distance+1,a.parent=s,e.unshift(o))}return i}(t),e={},s=Object.keys(i),n=s.length,r=0;r<n;r++){var h=s[r];null!==i[h].parent&&(e[h]=V$7(h,i))}return e},W$6={};Object.keys(U$6).forEach((function(t){W$6[t]={},Object.defineProperty(W$6[t],"channels",{value:U$6[t].channels}),Object.defineProperty(W$6[t],"labels",{value:U$6[t].labels});var i=z$5(t);Object.keys(i).forEach((function(e){var s=i[e];W$6[t][e]=function(t){var i=function(i){if(null==i)return i;arguments.length>1&&(i=Array.prototype.slice.call(arguments));var e=t(i);if("object"==typeof e)for(var s=e.length,n=0;n<s;n++)e[n]=Math.round(e[n]);return e};return"conversion"in t&&(i.conversion=t.conversion),i}(s),W$6[t][e].raw=function(t){var i=function(i){return null==i?i:(arguments.length>1&&(i=Array.prototype.slice.call(arguments)),t(i))};return"conversion"in t&&(i.conversion=t.conversion),i}(s)}))}));var $$6=m$4.exports,X$6=W$6,Y$5=[].slice,J$6=["keyword","gray","hex"],K$6={};Object.keys(X$6).forEach((function(t){K$6[Y$5.call(X$6[t].labels).sort().join("")]=t}));var Z$6={};function Q$6(t,i){if(!(this instanceof Q$6))return new Q$6(t,i);if(i&&i in J$6&&(i=null),i&&!(i in X$6))throw new Error("Unknown model: "+i);var e,s;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof Q$6)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var n=$$6.get(t);if(null===n)throw new Error("Unable to parse color from string: "+t);this.model=n.model,this.color=n.value.slice(0,s=X$6[this.model].channels),this.valpha="number"==typeof n.value[s]?n.value[s]:1}else if(t.length){this.model=i||"rgb";var r=Y$5.call(t,0,s=X$6[this.model].channels);this.color=st$5(r,s),this.valpha="number"==typeof t[s]?t[s]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var h=Object.keys(t);"alpha"in t&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var o=h.sort().join("");if(!(o in K$6))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=K$6[o];var a=X$6[this.model].labels,l=[];for(e=0;e<a.length;e++)l.push(t[a[e]]);this.color=st$5(l)}if(Z$6[this.model])for(s=X$6[this.model].channels,e=0;e<s;e++){var c=Z$6[this.model][e];c&&(this.color[e]=c(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function tt$5(t,i,e){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(Z$6[t]||(Z$6[t]=[]))[i]=e})),t=t[0],function(s){var n;return arguments.length?(e&&(s=e(s)),(n=this[t]()).color[i]=s,n):(n=this[t]().color[i],e&&(n=e(n)),n)}}function it$5(t){return function(i){return Math.max(0,Math.min(t,i))}}function et$5(t){return Array.isArray(t)?t:[t]}function st$5(t,i){for(var e=0;e<i;e++)"number"!=typeof t[e]&&(t[e]=0);return t}Q$6.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var i=this.model in $$6.to?this:this.rgb(),e=1===(i=i.round("number"==typeof t?t:1)).valpha?i.color:i.color.concat(this.valpha);return $$6.to[i.model](e)},percentString:function(t){var i=this.rgb().round("number"==typeof t?t:1),e=1===i.valpha?i.color:i.color.concat(this.valpha);return $$6.to.rgb.percent(e)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},i=X$6[this.model].channels,e=X$6[this.model].labels,s=0;s<i;s++)t[e[s]]=this.color[s];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new Q$6(this.color.map(function(t){return function(i){return function(t,i){return Number(t.toFixed(i))}(i,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new Q$6(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:tt$5("rgb",0,it$5(255)),green:tt$5("rgb",1,it$5(255)),blue:tt$5("rgb",2,it$5(255)),hue:tt$5(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:tt$5("hsl",1,it$5(100)),lightness:tt$5("hsl",2,it$5(100)),saturationv:tt$5("hsv",1,it$5(100)),value:tt$5("hsv",2,it$5(100)),chroma:tt$5("hcg",1,it$5(100)),gray:tt$5("hcg",2,it$5(100)),white:tt$5("hwb",1,it$5(100)),wblack:tt$5("hwb",2,it$5(100)),cyan:tt$5("cmyk",0,it$5(100)),magenta:tt$5("cmyk",1,it$5(100)),yellow:tt$5("cmyk",2,it$5(100)),black:tt$5("cmyk",3,it$5(100)),x:tt$5("xyz",0,it$5(100)),y:tt$5("xyz",1,it$5(100)),z:tt$5("xyz",2,it$5(100)),l:tt$5("lab",0,it$5(100)),a:tt$5("lab",1),b:tt$5("lab",2),keyword:function(t){return arguments.length?new Q$6(t):X$6[this.model].keyword(this.color)},hex:function(t){return arguments.length?new Q$6(t):$$6.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,i=[],e=0;e<t.length;e++){var s=t[e]/255;i[e]=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4)}return.2126*i[0]+.7152*i[1]+.0722*i[2]},contrast:function(t){var i=this.luminosity(),e=t.luminosity();return i>e?(i+.05)/(e+.05):(e+.05)/(i+.05)},level:function(t){var i=this.contrast(t);return i>=7.1?"AAA":i>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),i=0;i<3;i++)t.color[i]=255-t.color[i];return t},lighten:function(t){var i=this.hsl();return i.color[2]+=i.color[2]*t,i},darken:function(t){var i=this.hsl();return i.color[2]-=i.color[2]*t,i},saturate:function(t){var i=this.hsl();return i.color[1]+=i.color[1]*t,i},desaturate:function(t){var i=this.hsl();return i.color[1]-=i.color[1]*t,i},whiten:function(t){var i=this.hwb();return i.color[1]+=i.color[1]*t,i},blacken:function(t){var i=this.hwb();return i.color[2]+=i.color[2]*t,i},grayscale:function(){var t=this.rgb().color,i=.3*t[0]+.59*t[1]+.11*t[2];return Q$6.rgb(i,i,i)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var i=this.hsl(),e=i.color[0];return e=(e=(e+t)%360)<0?360+e:e,i.color[0]=e,i},mix:function(t,i){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var e=t.rgb(),s=this.rgb(),n=void 0===i?.5:i,r=2*n-1,h=e.alpha()-s.alpha(),o=((r*h==-1?r:(r+h)/(1+r*h))+1)/2,a=1-o;return Q$6.rgb(o*e.red()+a*s.red(),o*e.green()+a*s.green(),o*e.blue()+a*s.blue(),e.alpha()*n+s.alpha()*(1-n))}},Object.keys(X$6).forEach((function(t){if(-1===J$6.indexOf(t)){var i=X$6[t].channels;Q$6.prototype[t]=function(){if(this.model===t)return new Q$6(this);if(arguments.length)return new Q$6(arguments,t);var e="number"==typeof arguments[i]?i:this.valpha;return new Q$6(et$5(X$6[this.model][t].raw(this.color)).concat(e),t)},Q$6[t]=function(e){return"number"==typeof e&&(e=st$5(Y$5.call(arguments),i)),new Q$6(e,t)}}}));var nt$5=Q$6;const rt$5="function"==typeof Object.assign;function ht$5(t){if(rt$5)Object.assign.apply(Object,arguments);else for(let i=1;i<arguments.length;i++){const e=arguments[i];for(const i in e)t[i]=e[i]}return t}function ot$5(t){return null==t}const at$5=[];function lt$5(t,i){const e=i._get2DExtentAtRes(i.getGLRes()),s=e.getWidth(),n=e.getHeight(),r=t;return identity$2(r),translate$1(r,r,i.cameraLookAt),scale$5(r,r,set$4(at$5,s,n,1)),r}function ct$5(t){for(let i=1;i<arguments.length;i++){const e=arguments[i];if(e)for(let i=0,s=e.length;i<s;i++)t.push(e[i])}return t.length}const ut$5={};function ft$5(t,i){if(!Array.isArray(i)){i=ut$5[i]=ut$5[i]||nt$5(i).array()}for(let e=0;e<i.length;e++)t[e]=i[e];return 3===i.length&&(t[3]=1),t}function dt$5(t,i){if(Array.isArray(i))for(let e=0;e<i.length;e++)t[e]=255*i[e];else{i=ut$5[i]=ut$5[i]||nt$5(i).array();for(let e=0;e<i.length;e++)t[e]=i[e]}return 3===t.length&&t.push(255),t}const pt$5=[0,0],gt$5=[0,0,0];let mt$5;class vt$4{static getUniformDeclares(){const t=[],i=[];return i.push({name:"shadow_lightProjViewModelMatrix",type:"function",fn:function(i,e){return multiply$5(t,e.shadow_lightProjViewMatrix,e.modelMatrix)}}),i.push("shadow_shadowMap","shadow_opacity","esm_shadow_threshold","shadow_color","shadow_nearFar"),i}constructor(t,i,e){this.renderer=new N$8(t),this.sceneConfig=i,this.t=.3,this.i=e,this.s()}resize(){const t=this.canvas;t.width=this.i.getRenderer().canvas.width,t.height=this.i.getRenderer().canvas.height}s(){const t=this.sceneConfig.shadow||{};let i=512;const e=t.quality;"high"===e?i=2048:"medium"===e&&(i=1024);const s=this.getDefines();this.h=new _m(this.renderer,{width:i,height:i,blurOffset:t.blurOffset,defines:s}),this.o=new vm(s),this.u()}getDefines(){return{HAS_SHADOWING:1,PACK_FLOAT:1,USE_ESM:1}}render(t,i,e,s,n,r,a,l,c,u){this.p();const f=this.i.getMap();let d,p;if(u||this.m(f,a,!!t)){this.v=this.v||[],this._=this._||[];const s=multiply$5(this.v,i,e),n=normalize$4(this._,r);mt$5||(mt$5=f.getContainerExtent());let l=f.height;f.getPitch()>62&&(l=f._getVisualHeight(62));const c=mt$5.set(0,f.height-l,f.width,f.height).convertTo((t=>f._containerPointToPointAtRes(t,f.getGLRes()))).toArray();t&&a.addMesh(this.M);const u=c.map((t=>[t.x,t.y,0,1])),{lightProjViewMatrix:g,shadowMap:m,blurFBO:v}=this.h.render(a,{cameraProjViewMatrix:s,lightDir:n,farPlane:u,cameraLookAt:f.cameraLookAt});d=this.C=g,p=this.S=m,this.T=v,this.O=a.getMeshes().reduce(((t,i)=>(i.castShadow&&(t[i.uuid]={v0:i.version,v1:i.geometry.version}),t)),{}),this.k={count:a.getMeshes().length-+!!t,displayShadow:!!t},this.A=!0}else d=this.C,p=this.S,this.A=!1;return this.L=i,this.F=e,t&&a.getMeshes().length&&this.displayShadow(s,n,l,c),{shadow_lightProjViewMatrix:d,shadow_shadowMap:p,shadow_opacity:n,shadow_color:s,esm_shadow_threshold:this.t}}displayShadow(t,i,e,s){const n=this.C,r=this.M,o=this.I||[],a=this.i.getRenderer().canvas,l=this.R=this.R||[];l[0]=a.width,l[1]=a.height,this.renderer.render(this.o,{halton:e||pt$5,globalTexSize:l,projMatrix:this.L,viewMatrix:this.F,shadow_lightProjViewModelMatrix:multiply$5(o,n,r.localTransform),shadow_shadowMap:this.S,esm_shadow_threshold:this.t,shadow_opacity:i,color:t||gt$5},this.P,s)}dispose(){this.h.dispose(),this.o.dispose(),this.M&&(this.M.geometry.dispose(),this.M.dispose()),delete this.renderer}isUpdated(){return!1!==this.A}m(t,i,e){if(!this.O)return!0;const s=this.k;if(i.getMeshes().length!==s.count||e!==s.displayShadow)return!0;const n=i.getMeshes();for(let t=0;t<n.length;t++){const i=this.O[n[t].uuid];if(n[t].castShadow&&(n[t].hasSkinAnimation()||!i||i.v0!==n[t].version||i.v1!==n[t].geometry.version))return!0}return!1}u(){const t=new Ut$5;t.generateBuffers(this.renderer.regl),this.M=new ft$6(t),this.P=new yt$6([this.M])}p(){const t=this.i.getMap(),i=lt$5(this.M.localTransform,t);this.M.setLocalTransform(i)}}const{createIBLTextures:wt$5,disposeIBLTextures:bt$5,getPBRUniforms:_t$5}=Fm.PBRUtils,yt$5=[0,0],Mt$4=[1,1];class xt$5{static getGroundTransform(t,i){return lt$5(t,i)}constructor(t,i){this.H=t,this.renderer=new N$8(t),this.i=i,this.D=new gt$6,this.N=this.G.bind(this),this.s()}needToRedraw(){const t=this.j();return t&&(t[0]||t[1])}getMap(){return this.i&&this.i.getMap()}getSymbol(){const t=this.i.getGroundConfig();return t&&t.symbol}isEnable(){const t=this.i.getGroundConfig();return t&&t.enable}paint(t){if(!this.isEnable())return!1;const i=this.B();if(this.V(t)&&i===this.U)return!1;const e=this.W(t);e&&this.M.setDefines(e),this.M.material!==this.material&&this.M.setMaterial(this.material);const s=this.i.getGroundConfig();this.M.ssr=(s&&s.symbol).ssr?1:0,this.p();const n=this.q(t);n.offsetFactor=t.offsetFactor,n.offsetUnits=t.offsetUnits;const r=t&&t.renderTarget&&t.renderTarget.fbo;return i===this.U?(this.renderer.render(i,n,this.P,r),this.i.getRenderer().setCanvasUpdated(),!0):(i.filter=t.sceneFilter,this.renderer.render(i,n,this.P,r),this.i.getRenderer().setCanvasUpdated(),!0)}V(t){return!!(this.i.getRenderer().isEnableSSR&&this.i.getRenderer().isEnableSSR()&&t&&t.ssr)}update(){const t=this.i.getGroundConfig();if(!t)return;const i=t&&t.symbol;if(i){this.$=this.X(i.polygonFill||[1,1,1,1]),this.Y=void 0===i.polygonOpacity?1:i.polygonOpacity;const t=i.polygonPatternFile;if(t){if(!this.J||this.J._pattern_src!==t){const i=new Image;i.onload=()=>{this.J&&this.J.destroy(),this.J=this.K(i),this.J._pattern_src=t},i.src=t}}else this.J&&(this.J.destroy(),delete this.J)}else this.$=[1,1,1,1],this.Y=1,this.J&&(this.J.destroy(),delete this.J);this.Z()}setToRedraw(){const t=this.i.getRenderer();t&&t.setToRedraw()}dispose(){this.material&&(this.material.dispose(),delete this.material),this.M&&(this.M.geometry.dispose(),this.M.material&&this.M.material.dispose(),this.M.dispose(),delete this.M),this.J&&(this.J.destroy(),delete this.J),this.U&&(this.U.dispose(),delete this.U),this.tt&&(this.tt.dispose(),delete this.tt),this.it(),this.et&&(this.et.destroy(),delete this.et);const t=this.getMap();t&&t.off("updatelights",this.st,this)}B(){const t=this.i.getGroundConfig();if(!t||!t.renderPlugin)return this.U;const i=t.renderPlugin.type;if("lit"===i)return this.tt;if("fill"===i)return this.U;throw new Error("unsupported render plugin of "+i+" for layer ground")}q(t){const i=this.nt(t);return i.polygonFill=this.$,i.polygonOpacity=this.Y,this.B()===this.U&&this.J&&(i.polygonPatternFile=this.J),i}nt(t){let i;return"lit"===this.i.getGroundConfig().renderPlugin.type?(this.rt||(this.rt=wt$5(this.H,this.getMap())),this.et||(this.et=Fm.PBRHelper.generateDFGLUT(this.H)),i=_t$5(this.getMap(),this.rt,this.et,t&&t.ssr,t&&t.jitter)):i={projViewMatrix:this.getMap().projViewMatrix},this.ht(i,t),i}ht(t,i){const e=i&&i.includes;if(e)for(const s in e)e[s]&&i[s].renderUniforms&&ht$5(t,i[s].renderUniforms)}it(){this.rt&&(bt$5(this.rt),delete this.rt)}s(){this.getMap().on("updatelights",this.st,this);const t=this.ot(),i=vt$4.getUniformDeclares(),e=[];i.push({name:"projViewModelMatrix",type:"function",fn:function(t,i){return multiply$5(e,i.projViewMatrix,i.modelMatrix)}}),this.U=new ie$5({vert:"attribute vec3 aPosition;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\n#ifdef HAS_PATTERN\n    attribute vec2 aTexCoord;\n    uniform vec2 uvScale;\n    uniform vec2 uvOffset;\n    varying vec2 vTexCoord;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_vert>\n#endif\nvoid main () {\n    #ifdef HAS_PATTERN\n        vTexCoord = aTexCoord * uvScale + uvOffset;\n    #endif\n    vec3 position = vec3(aPosition);\n    gl_Position = projViewModelMatrix * vec4(position, 1.0);\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        shadow_computeShadowPars(vec4(position, 1.0));\n    #endif\n}",frag:"precision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n    uniform sampler2D polygonPatternFile;\n    varying vec2 vTexCoord;\n#endif\nuniform vec4 polygonFill;\nuniform float polygonOpacity;\nvoid main() {\n    #ifdef HAS_PATTERN\n        vec4 color = texture2D(polygonPatternFile, vTexCoord);\n    #else\n        vec4 color = polygonFill;\n    #endif\n    gl_FragColor = color * polygonOpacity;\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        float shadowCoeff = shadow_computeShadow();\n        gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, shadowCoeff);\n    #endif\n}",uniforms:i,extraCommandProps:t});const s=vt$4.getUniformDeclares();s.push(...Ie$4.getUniformDeclares()),this.tt=new Fm.StandardShader({uniforms:s,extraCommandProps:t}),this.u(),this.update()}ot(){const t=[0,1],i=this.i.getRenderer().canvas;return{viewport:{x:0,y:0,width:()=>i.width,height:()=>i.height},depth:{enable:!0,mask:()=>{const t=this.i.getGroundConfig();return t.depth||void 0===t.depth},range:()=>{const i=this.i.getGroundConfig(),e=i&&i.renderPlugin.sceneConfig;return e&&e.depthRange||t},func:"<="},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:{factor:(t,i)=>i.offsetFactor,units:(t,i)=>i.offsetUnits}}}}lt(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}u(){const t=new Ut$5;t.data.aTexCoord=new Uint8Array([0,1,1,1,0,0,1,0]),t.createTangent(),t.generateBuffers(this.renderer.regl),this.M=new ft$6(t,null,{castShadow:!1});const i=this.tt.getGeometryDefines(t);this.M.setDefines(i),this.P=new yt$6([this.M])}p(){const t=this.getMap(),i=xt$5.getGroundTransform(this.M.localTransform,t);this.M.setLocalTransform(i);const e=t._get2DExtentAtRes(t.getGLRes()),s=e.getWidth(),n=e.getHeight(),r=t.cameraLookAt,h=r[0]-s,o=r[1]+n;let a=this.material&&this.material.get("uvOffset")||yt$5;a[0]=a[0]||0,a[1]=a[1]||0;const l=this.j(),c=this.material&&this.material.get("noiseTexture"),u=l&&(l[0]||l[1]);if(u){a=[a[0],a[1]];const t=performance.now(),i=c?5e4:1e3,e=c?256:1;l[0]&&(a[0]=t*l[0]%i/i*e),l[1]&&(a[1]=t*l[1]%i/i*e)}const f=this.material&&this.material.get("uvScale")||Mt$4,d=.5/f[0],p=.5/f[1],g=e.getWidth()/d*2,m=e.getHeight()/p*2;if(this.M.setUniform("uvScale",[g,-m]),u&&c){const t=[h-(l[0]?a[0]:0),o+(l[1]?a[1]:0)],i=t[0]/d%1,e=t[1]/p%1,s=[t[0]/d-i,t[1]/p-e];this.M.setUniform("uvOffset",[i+(l[0]?0:a[0]),e+(l[1]?0:a[1])]),this.M.setUniform("uvOrigin",s)}else{const t=h/d%1,i=o/p%1,e=[h/d-t,o/p-i];this.M.setUniform("uvOffset",[t+a[0],i+a[1]]),this.M.setUniform("uvOrigin",e)}}W(t){let i=!1;const e=this.M.defines,s=this.i.ct&&this.i.ct(),n=this.i.getGroundConfig();function r(t,s){t?e[s]||(e[s]=1,i=!0):e[s]&&(delete e[s],i=!0)}r(this.lt(),"HAS_IBL_LIGHTING"),r(t&&t.ssr&&n&&n.symbol&&n.symbol.ssr,"HAS_SSR");const h=t&&s&&s.shadow&&s.shadow.enable;return r(h,"HAS_SHADOWING"),r(h,"USE_ESM"),r(!!this.J,"HAS_PATTERN"),r(t&&t.ssao,"HAS_SSAO"),i?e:null}Z(){const t=this.getSymbol()&&this.getSymbol().material;if(!t)return;const i={};let e=!1;for(const r in t)if(n=r,Object.prototype.hasOwnProperty.call(t,n))if(r.indexOf("Texture")>0){let s=t[r];if(!s)continue;s="string"==typeof s?{url:s,wrap:"repeat"}:s,s.flipY=!0,s.min="linear",s.mag="linear",s.flipY=!0,i[r]=new Vt$5(s,this.D),e=!0}else i[r]=t[r];var n;this.material?(this.ut=new Fm.StandardMaterial(i),this.ut.isReady()?this.G():this.ut.once("complete",this.N)):(this.material=new Fm.StandardMaterial(i),this.material.once("complete",this.N,this)),e||this.G()}G(){this.ut&&(this.material.dispose(),this.material=this.ut,delete this.ut),this.setToRedraw(!0)}K(t){return this.H.texture({width:t.width,height:t.height,data:t,mag:"linear",min:"linear",flipY:!1,wrap:"repeat"})}st(t){if(t.ambientUpdate){this.it();const t=this.getMap();t&&(this.rt=wt$5(this.H,t))}this.setToRedraw()}X(t){return ft$5([],t)}j(){return this.material&&this.material.get("uvOffsetAnim")}getRenderMeshes(){return this.P.getMeshes()}}const{createIBLTextures:Ct$4,disposeIBLTextures:St$4}=Fm.PBRUtils,Tt$4=[0,0,0],Ot$4=[],kt$4=[];class At$4{constructor(t,i){this.ft=4,this.H=t,this.renderer=new N$8(t),this.i=i,this.s(),this.dt()}paint(t){if(!this.isEnable()||!this.pt)return;const i=this.q(t);this.renderer.render(this.gt,i,null,t&&t.renderTarget&&t.renderTarget.fbo)}update(){const t=this.getMap();if(!t||!this.isEnable())return;const i=t.getLightManager(),e=i&&i.getAmbientResource();e!==this.pt&&this.rt&&(St$4(this.rt),delete this.rt),this.pt=e,this.dt()}dispose(){this.gt.dispose(),St$4(this.rt),delete this.gt,delete this.rt,delete this.pt}getMap(){return this.i.getMap()}dt(){if(!this.pt)return;const t=this.i.ct();this.gt.setMode(1,0,t.environment&&t.environment.mode?1:0)}isEnable(){const t=this.i.ct();return this.lt()&&t&&t.environment&&t.environment.enable}lt(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}q(){const t=this.getMap(),i=this.getMap().getLightManager().getAmbientLight();let e=this.rt;e||(e=this.rt=Ct$4(this.H,t));const s=this.i.getRenderer().canvas,n=this.i.ct().environment||{},r=n.level||0,h=e.prefilterMap.width,l=this.vt=this.vt||[],u=n.brightness||0;return copy$4(Ot$4,i&&i.hsv||Tt$4),u&&(Ot$4[2]+=u),kt$4[0]=s.width,kt$4[1]=s.height,{rgbmRange:e.rgbmRange,cubeMap:e.prefilterMap,bias:r,size:h/Math.pow(2,Math.max(0,r-1)),environmentExposure:(f=i.exposure,"number"!=typeof f||isNaN(f)?1:i.exposure),diffuseSPH:e.sh,viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,resolution:kt$4,hsv:Ot$4,transformMatrix:fromRotation$2(l,Math.PI/180*-i.orientation||0)};var f}s(){const t=this.getMap();if(t.on("updatelights",this.update,this),this.gt=new ze$4,t.options.lights){const t=this.getMap().getLightManager().getAmbientResource();this.pt=t}}}const Et$4=[],Lt$4=[.03,.03,.03],Ft$4=[],It$4=[],Rt$4=[],Pt$4=[1,1,1],Ht$4=[-1200,-1200,0],Dt$4=[1200,1200,1e3],Nt$4={min:[],max:[]},Gt$4=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class jt$4{constructor(t,i){this.H=t,this.renderer=new N$8(t),this.i=i,this.wt=new Bt$4,this.s()}getMap(){return this.i&&this.i.getMap()}s(){const t=this.i.getRenderer().canvas;this.gt=new ie$5({vert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform vec3 cameraPosition;\nuniform float top;\nuniform float bottom;\nuniform float time;\nvarying vec2 vTexCoord;\n#include <get_output>\nfloat angle(float x, float y){\n    return atan(y, x);\n}\nvec2 getFoot(vec2 camera, vec2 normal, vec2 pos) {\n    vec2 position = vec2(0.0, 0.0);\n    float distanceLen = distance(pos, normal);\n    float a = angle(camera.x - normal.x, camera.y - normal.y);\n    pos.x > normal.x ? a -= 0.785 : a += 0.785;\n    position.x = cos(a) * distanceLen;\n    position.y = sin(a) * distanceLen;\n    return position + normal;\n    return position;\n}\nvoid main()\n{\n    vec4 localPosition = getPosition(aPosition);\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec2 foot = getFoot(vec2(cameraPosition.x, cameraPosition.z), vec2(aNormal.x, aNormal.z), vec2(localPosition.x, localPosition.z));\n    float height = top - bottom;\n    float y = aNormal.y - bottom - height * time;\n    y = y + (y < 0.0 ? height : 0.0);\n    float ratio = (1.0 - y / height) * (1.0 - y / height);\n    y = height * (1.0 - ratio);\n    y += bottom;\n    y += aPosition.y - aNormal.y;\n    localPosition = vec4( foot.x, y, foot.y , 1.0);\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D rainMap;\nvoid main() {\n    vec4 rainColor = texture2D(rainMap, vTexCoord);\n    vec4 diffuseColor = vec4(diffuse, opacity);\n    diffuseColor *= rainColor;\n    gl_FragColor = diffuseColor;\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,i){return multiply$5(Et$4,i.viewMatrix,i.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height},depth:{enable:!0,mask:!1,func:"less",range:[0,1]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this.bt()}bt(){const t=this.H.texture({width:2,height:2});if(this._t=this.yt(),!this._t)return;this.Mt=new yt$6(this._t);const i=this.xt();i.rainTexture?this.Ct(i.rainTexture).then((t=>{this._t.material.set("rainMap",t)})):(this._t.material.set("rainMap",t),console.warn("should set rain texture."))}yt(){const t=this.getMap(),i=this.xt();if(!i)return;this.St=t.getZoom();const e=this.Tt(),s=this.Ot=i.density,n=this.kt=i.rainWidth||1,r=this.At=i.rainHeight||1,h=[],o=[],a=[],l=[];for(let t=0;t<s;t++){const i={};i.x=Math.random()*(e.max[0]-e.min[0])+e.min[0],i.y=Math.random()*(e.max[2]-e.min[2])+e.min[2],i.z=Math.random()*(e.max[1]-e.min[1])+e.min[1];const s=(e.max[2]-e.min[2])/37.5*r,c=s/3*n;h.push(i.x+c,i.y+s,i.z,i.x-c,i.y+s,i.z,i.x-c,i.y,i.z,i.x+c,i.y,i.z),o.push(i.x,i.y-s/2,i.z,i.x,i.y-s/2,i.z,i.x,i.y-s/2,i.z,i.x,i.y-s/2,i.z),a.push(1,1,0,1,0,0,1,0),l.push(4*t+0,4*t+1,4*t+2,4*t+0,4*t+2,4*t+3)}const c={};c.POSITION=h,c.NORMAL=o,c.TEXCOORD_0=a;const u=new Q$7(c,l,0,{primitive:"triangles",positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});u.generateBuffers(this.renderer.regl);const f=new tt$6({rainMap:this.H.texture({width:2,height:2}),diffuse:i.color||[1,1,1],opacity:i.opacity||1}),p=new ft$6(u,f);return p.setUniform("top",e.max[2]),p.setUniform("bottom",e.min[2]),this.Et(p),p.transparent=!0,p}Ct(t){const i=new Image;return i.src=this.Lt=t,new Promise(((t,e)=>{i.onload=()=>{const e=this.H.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"clamp",wrapT:"clamp",data:i});t(e)},i.onerror=t=>{e(t)}}))}paint(t){if(!this.Mt)return;const i=this.xt(),e={},s=this.getMap();e.projMatrix=s.projMatrix,e.viewMatrix=s.viewMatrix,e.cameraPosition=s.cameraPosition;const n=i.speed||1,r=this.wt.getElapsedTime()/(2/n)%1;e.time=r,this._t.material.set("diffuse",i.color||Pt$4),this._t.material.set("opacity",i.opacity||1),this.Et(this._t);this.renderer.render(this.gt,e,this.Mt,t&&t.renderTarget&&t.renderTarget.fbo),this.i.getRenderer().setCanvasUpdated()}Et(t){const i=this.getMap(),e=i.coordinateToPointAtRes(i.getCenter(),i.getGLRes());let s=i.getGLScale()/i.getGLScale(this.St);const n=set$4(It$4,s,s,s),r=multiply$4(n,Lt$4,n),a=identity$2(Rt$4),c=this.xt(),u=i.getBearing();fromRotationTranslationScale(a,fromEuler(Ft$4,c.windDirectionX||0,c.windDirectionY||0,90-u),[e.x,e.y,0],r),multiply$5(a,a,Gt$4),t.setLocalTransform(a)}setToRedraw(){const t=this.i.getRenderer();t&&t.setToRedraw()}update(){const t=this.xt();if(t){if(this._t||this.bt(),t.density!==this.Ot||t.rainWidth!==this.kt||t.rainHeight!==this.At){const t=this._t.material.get("rainMap");this._t.geometry.dispose(),this._t.dispose(),this.Mt.clear(),this._t=this.yt(),this._t.material.set("rainMap",t),this.Mt.setMeshes(this._t)}t.rainTexture!==this.Lt&&this.Ct(t.rainTexture).then((t=>{this._t.material.set("rainMap",t)}))}}dispose(){this._t&&(this._t.geometry.dispose(),this._t.material&&this._t.material.dispose(),this._t.dispose(),delete this._t),this.gt&&(this.gt.dispose(),delete this.gt)}isEnable(){const t=this.xt();return t&&t.enable}xt(){const t=this.i.getWeatherConfig();return t&&t.rain}Tt(){const t=16.685648411389433-this.getMap().getZoom();return scale$4(Nt$4.min,Ht$4,Math.pow(2,t)),scale$4(Nt$4.max,Dt$4,Math.pow(2,t)),Nt$4}}class Bt$4{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let i=("undefined"==typeof performance?Date:performance).now();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}}}const Vt$4=[],Ut$4=[.03,.03,.03],zt$4=[],Wt$4=[],qt$4=[],$t$4=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class Xt$4{constructor(t,i){this.H=t,this.i=i,this.s()}s(){const t=this.i.getRenderer().canvas;this.gt=new ie$5({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\n#include <get_output>\nvoid main()\n{\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec4 localPosition = getPosition(aPosition);\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nprecision mediump float;\nuniform sampler2D perlinTexture;\nvarying vec2 vTexCoord;\nfloat lerp(float a, float b, float w) {\n    return a + w * (b - a);\n}\nvoid main() {\n    float snowIntense = texture2D(perlinTexture, vTexCoord).r;\n    vec3 fixedC = vec3(1.0, 1.0, 1.0);\n    float r = lerp(0.5, fixedC.x, snowIntense);\n    float g = lerp(0.5, fixedC.y, snowIntense);\n    float b = lerp(0.5, fixedC.z, snowIntense);\n    glFragColor = vec4(r, g, b, 1.0);\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,i){return multiply$5(Vt$4,i.viewMatrix,i.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height}}}),this.gt.version=300,this.Mt=new yt$6,this.Ft=this.It(),this.Mt.setMeshes(this.Ft),this.renderer=new N$8(this.H);const e=this.Rt();e&&(e.snowGroundTexture?this.Pt(e.snowGroundTexture):(this.Ht=this.H.texture({width:2,height:2}),console.warn("should set snow ground texture.")))}render(t){this.Ht&&this.Ft.material.set("perlinTexture",this.Ht);const i=this.i.getMap();this.Dt(i);this.renderer.render(this.gt,{projMatrix:i.projMatrix,viewMatrix:i.viewMatrix,cameraPosition:i.cameraPosition},this.Mt,t&&t.renderTarget&&t.renderTarget.fbo),this.i.getRenderer().setCanvasUpdated()}Dt(t){const i=t.coordinateToPointAtRes(t.getCenter(),t.getGLRes());let e=t.getGLScale()/t.getGLScale(this.St);const s=set$4(Wt$4,e,e,e),n=multiply$4(s,Ut$4,s),r=identity$2(qt$4);fromRotationTranslationScale(r,fromEuler(zt$4,0,0,0),[i.x,i.y,.005],n),multiply$5(r,r,$t$4),this.Ft.setLocalTransform(r)}Pt(t){const i=new Image;i.onload=()=>{this.Ht=this.H.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"repeat",wrapT:"repeat",data:i})},i.onerror=t=>{console.log(t)},i.src=this.Nt=t}It(){const t=this.i.getMap();this.St=t.getZoom();const i=16e3*Math.pow(2,16.685648411389433-this.St),s={};s.POSITION=[-i,0,-i,i,0,-i,-i,0,i,i,0,i],s.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],s.TEXCOORD_0=[0,0,1,0,0,1,1,1];const n=new Q$7(s,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});n.generateBuffers(this.H);const r=new tt$6({perlinTexture:this.H.texture({with:2,height:2})});return new ft$6(n,r)}getMeshes(){return this.Ft}dispose(){this.Ft&&(this.Ft.geometry.dispose(),this.Ft.material&&this.Ft.material.dispose(),this.Ft.dispose(),delete this.Ft),this.gt&&(this.gt.dispose(),delete this.gt)}update(){const t=this.Rt();t&&t.snowGroundTexture===!this.Nt&&this.Pt(t.snowGroundTexture)}isEnable(){const t=this.xt();return t&&t.enable}Rt(){const t=this.i.getWeatherConfig();return t&&t.snow}}const Yt$4=[];class Jt$4{constructor(t,i,e){this.H=t,this.i=i,this.Gt=e,this.s()}s(){this.renderer=new N$8(this.H);const t=this.i.getRenderer(),i=this.jt={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.Bt=i.width,this.Vt=i.height,this.Ut=this.H.framebuffer({color:this.H.texture({width:t.canvas?t.canvas.width:1,height:t.canvas?t.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.EMPTY_TEXTURE=this.H.texture({with:2,height:2}),this.zt=new jt$4(this.H,this.i),this.Wt=new qe$4(this.H,i),this.qt=new Xt$4(this.H,this.i),this.$t=new Be$4(this.H,i),this.Xt=new Ge$4,this.Xt.version=300}getMap(){return this.i&&this.i.getMap()}renderScene(t){this.renderSnowMask(t),this.renderRain(t)}renderRain(t){this.isEnableRain()&&this.zt.paint(t)}renderSnowMask(t){if(!this.isEnableSnow())return;const i=this.getMap();this.qt.render(t,i)}paint(t,i){if(!i||!i.length)return t;this.Yt();const e=this.i.getWeatherConfig(),s={};if(this.isEnableRain()?(s.ripplesMap=this.Jt(),this.Xt.shaderDefines.HAS_RAIN=1):delete this.Xt.shaderDefines.HAS_RAIN,this.isEnableSnow()?(this.Xt.shaderDefines.HAS_SNOW=1,i.forEach((t=>{t.defines.HAS_SNOW=1}))):(delete this.Xt.shaderDefines.HAS_SNOW,i.forEach((t=>{delete t.defines.HAS_SNOW}))),this.isEnableFog()){s.fogColor=e.fog.color||[.9,.9,.9],this.Xt.shaderDefines.HAS_FOG=1}else delete this.Xt.shaderDefines.HAS_FOG;return this.Xt.setDefines(this.Xt.shaderDefines),s.mixFactorMap=this.Kt(i)||this.EMPTY_TEXTURE,s.sceneMap=t,s.time=this.Zt()/1e3,s.resolution=set(Yt$4,this.Ut.width,this.Ut.height),this.renderer.render(this.Xt,s,null,this.Ut),this.Ut}Kt(t){const i={},e=this.getMap(),s=e.getZoom(),n=Math.pow(2,16.685648411389433-s),r=this.i.getWeatherConfig().fog;if(!r)return;const h=r.start||.1,o=r.end||100;return i.projMatrix=e.projMatrix,i.viewMatrix=e.viewMatrix,i.cameraPosition=e.cameraPosition,i.fogDist=[h*n,o*n],this.$t.render(t,i)}Jt(){const t=this.getMap(),i=this.i.getWeatherConfig(),e=i.rain.rippleRadius||24,s={};return s.projMatrix=t.projMatrix,s.viewMatrix=t.viewMatrix,s.time=this.Zt()/1e3,s.rippleRadius=e,s.density=i.rain.density||2e3,this.Wt.render(t,s)}Zt(){if(!this.i)return 0;if(void 0===this.Qt&&(this.Qt=0),this.isPlaying()){const t=this.i.getRenderer();this.Qt=t.getFrameTime()}return this.Qt}isEnable(){const t=this.i.getWeatherConfig();return t&&t.enable}isEnableRain(){const t=this.i.getWeatherConfig();return t&&t.enable&&t.rain&&t.rain.enable}isEnableFog(){const t=this.i.getWeatherConfig();return t&&t.enable&&t.fog&&t.fog.enable}isEnableSnow(){const t=this.i.getWeatherConfig();return t&&t.enable&&t.snow&&t.snow.enable}isPlaying(){const t=this.i.getWeatherConfig();if(t)return!1!==t.playing}ti(){return this.isEnableRain()||this.isEnableFog()||this.isEnableSnow()}update(){this.isEnableRain()&&(this.zt=this.zt||new jt$4(this.H,this.i),this.zt.update()),this.isEnableSnow()&&(this.qt=this.qt||new Xt$4(this.H,this.i),this.qt.update())}getShadowMeshes(){return this.qt.getMeshes()}Yt(){const t=this.Bt(),i=this.Vt();!this.Ut||this.Ut.width===t&&this.Ut.height===i||this.Ut.resize(t,i)}dispose(){this.Ut&&this.Ut.destroy(),this.Xt&&(this.Xt.dispose(),delete this.Xt),this.zt&&(this.zt.dispose(),delete this.zt),this.qt&&(this.qt.dispose(),delete this.qt)}}const Kt$4=[],Zt$4=t=>!!t.bloom,Qt$4=t=>!!t.ssr;class ti$3{constructor(t,i,e){this.H=t,this.i=i,this.ii=new N$8(t),this.ei=new me$4,this.si=new Me$4(this.ii,e),this.ni=new He$4,this.ri=new Ie$4(this.H)}setContextIncludes(){}bloom(t,i,e,s,n,r,h){this.hi||(this.hi=new Oe$4(this.H));const o=this.i.getRenderer().oi(this.ai);return this.hi.render(t,o,s,n,r,i,e,h)}drawBloom(t){const i=this.i.getRenderer(),e=this.H,s=this.ai;if(s){const{width:i,height:n}=t;s.width===i&&s.height===n||s.resize(i,n),e.clear({color:[0,0,0,0],framebuffer:s})}else{const i=this.li(t);this.ai=e.framebuffer(i)}const n=i.getFrameTime(),r=i.getFrameEvent(),h=i.getFrameContext(),o=h.renderMode,a=h.sceneFilter,l=h.renderTarget;h.renderMode="default",h.sceneFilter=Zt$4,h.renderTarget={fbo:this.ai,getFramebuffer:ii$3,getDepthTexture:ei$3};const c=i.glCtx;return c.resetDrawCalls(),i.forEachRenderer(r?t=>{i.clearStencil(t,s),t.drawOnInteracting(r,n,h)}:t=>{i.clearStencil(t,s),t.draw(n,h)}),h.renderMode=o,h.sceneFilter=a,h.renderTarget=l,c.getDrawCalls()}genSsrMipmap(t,i){const e=this.i.getMap().projViewMatrix;this.ri.genMipMap(t,i,e)}getPrevSsrProjViewMatrix(){return this.ri&&this.ri.getPrevProjViewMatrix()}drawSSR(t,i,e){e&&this.ri.copyDepthTex(t);const s=this.i.getRenderer(),n=s.getFrameTime(),r=s.getFrameEvent(),h=s.getFrameContext();h.ssr=this.getSSRContext();const o=h.renderMode,a=h.sceneFilter;h.renderMode="default",h.sceneFilter=Qt$4,h.renderTarget.fbo=i;const l=s.glCtx;let c=!1;s.forEachRenderer(r?t=>{s.clearStencil(t,i),c||(l.resetDrawCalls(),c=!0),t.drawOnInteracting(r,n,h)}:t=>{s.clearStencil(t,i),c||(l.resetDrawCalls(),c=!0),t.draw(n,h)});const u=s.drawGround();return delete h.ssr,h.renderMode=o,h.sceneFilter=a,this.ci=l.getDrawCalls()>0,u}getSSRUniforms(){const t=this.i.ct(),i=t&&t.postProcess,e=this.i.getMap();return this.ri.getSSRUniforms(e,i.ssr.factor,i.ssr.quality)}getSSRContext(){const t=this.i.ct(),i=t&&t.postProcess,e=this.i.getMap(),s=this.ri.getSSRUniforms(e,i.ssr.factor,i.ssr.quality);return s?{renderUniforms:s,defines:{HAS_SSR:1}}:null}taa(t,i,{projMatrix:e,needClear:s}){const n=this.si;return{outputTex:n.render(t,i,e,s),redraw:n.needToRedraw()}}isTaaNeedRedraw(){return this.si.needToRedraw()}ssao(t,i,e){return this.ui||(this.ui=new xe$4(this.ii),this.i.getRenderer().setToRedraw()),this.ui.render({projMatrix:e.projMatrix,cameraNear:e.cameraNear,cameraFar:e.cameraFar,bias:e.ssaoBias,radius:e.ssaoRadius,intensity:e.ssaoIntensity,quality:.6},t,i)}fxaa(t,i,e,s,n,r,h,o,a,l,u,f,d,p,g,m){!t||t.width===i.fbo&&t.height===i.height||t.resize(i.width,i.height);const v={};n?v.HAS_TAA_TEX=1:delete v.HAS_TAA_TEX,r?v.HAS_FXAA_TEX=1:delete v.HAS_FXAA_TEX,f?v.HAS_OUTLINE_TEX=1:delete v.HAS_OUTLINE_TEX,e?v.HAS_NOAA_TEX=1:delete v.HAS_NOAA_TEX,s?v.HAS_POINT_TEX=1:delete v.HAS_POINT_TEX,this.ei.setDefines(v),this.ii.render(this.ei,{textureSource:i,noAaTextureSource:e,pointTextureSource:s,taaTextureSource:n,fxaaTextureSource:r,resolution:set(Kt$4,i.width,i.height),enableFXAA:h,enableToneMapping:o,enableSharpen:a,pixelRatio:l,sharpFactor:u,textureOutline:f,highlightFactor:d,outlineFactor:p,outlineWidth:g,outlineColor:m},null,t)}renderFBOToScreen(t,i,e,s){this.fi||(this.fi=[]),this.fi[0]=t.width,this.fi[1]=t.height;const n=this.i.getRenderer();this.ii.render(this.ni,{texture:t.color&&n.oi(t)||t,size:this.fi,enableSharpen:+!!i,sharpFactor:e,pixelRatio:s})}postprocess(t,i,e){this.di||(this.di=new be$4);const s=this.i&&this.i.getRenderer(),n=e||s.oi(t);return i.resolution=set(Kt$4,n.width,n.height),i.textureSource=n,i.timeGrain=performance.now(),this.ii.render(this.di,i),this.pi}dispose(){this.ai&&(this.ai.destroy(),delete this.ai),this.si&&(this.si.dispose(),delete this.si),this.ui&&(this.ui.dispose(),delete this.ui),this.hi&&(this.hi.dispose(),delete this.hi),this.di&&(this.di.dispose(),delete this.di),this.ei&&(this.ei.dispose(),delete this.ei),this.ni&&(this.ni.dispose(),delete this.ni)}li(t,i){const{width:e,height:s}=this.i.getRenderer().canvas,n=this.H;let r;r=this.i.getRenderer().gi()?n.renderbuffer({width:e,height:s,samples:this.i.options.multiSamples,format:"rgba8"}):n.texture({min:"nearest",mag:"nearest",format:i||"rgba",width:e,height:s});const h={width:e,height:s,colors:[r]};return t&&(h.depthStencil=t),h}}function ii$3(t){return t._framebuffer.framebuffer}function ei$3(t){return t.depthStencil._texture.texture}class si$3 extends de$5{constructor(t){super({vert:"#if __VERSION__ == 300\n\t#define attribute in\n\t#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main()\n{\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_FLOODANALYSE\n    uniform vec3 flood_waterColor;\n    uniform float flood_waterOpacity;\n    uniform sampler2D floodMap;\n#endif\n#ifdef HAS_SKYLINE\n    uniform sampler2D skylineMap;\n#endif\n#ifdef HAS_VIEWSHED\n    uniform vec4 viewshed_visibleColor;\n    uniform vec4 viewshed_invisibleColor;\n    uniform sampler2D viewshedMap;\n#endif\n#ifdef HAS_INSIGHT\n    uniform vec4 insight_visibleColor;\n    uniform vec4 insight_invisibleColor;\n    uniform sampler2D insightMap;\n#endif\n#ifdef HAS_CUT\n    uniform sampler2D meshesMap;\n    uniform sampler2D invisibleMap;\n#endif\n#ifdef HAS_EXCAVATE\n    uniform sampler2D excavateMap;\n#endif\n#ifdef HAS_CROSSCUT\n    uniform sampler2D crosscutMap;\n    uniform vec4 cutLineColor;\n#endif\n#ifdef HAS_HEIGHTLIMIT\n    uniform vec3 limitColor;\n    uniform sampler2D heightLimitMap;\n#endif\nuniform sampler2D sceneMap;\nvoid main() {\n    vec4 sceneColor = texture2D(sceneMap, vTexCoord);\n    glFragColor = sceneColor;\n    #ifdef HAS_VIEWSHED\n        vec4 viewshedColor = texture2D(viewshedMap, vTexCoord);\n        if (viewshedColor.r > 0.99) {\n            glFragColor = vec4(mix(viewshed_invisibleColor.rgb, sceneColor.rgb, viewshed_invisibleColor.a), sceneColor.a);\n        } else if (viewshedColor.g > 0.99) {\n            glFragColor = vec4(mix(viewshed_visibleColor.rgb, sceneColor.rgb, viewshed_visibleColor.a), sceneColor.a);\n        } else if (viewshedColor.a < 0.01) {\n            glFragColor = vec4(viewshedColor.rgb, 1.0);\n        }\n    #endif\n    #ifdef HAS_FLOODANALYSE\n        vec4 floodColor = texture2D(floodMap, vTexCoord);\n        if (floodColor.r > 0.0) {\n            glFragColor = vec4(mix(flood_waterColor, glFragColor.rgb, flood_waterOpacity), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_SKYLINE\n        vec4 skylineColor = texture2D(skylineMap, vTexCoord);\n        if (skylineColor.r > 0.0 || skylineColor.g > 0.0 || skylineColor.b > 0.0) {\n            glFragColor = skylineColor;\n        }\n    #endif\n    #ifdef HAS_INSIGHT\n        vec4 insightColor = texture2D(insightMap, vTexCoord);\n        if (insightColor.g > 0.0) {\n            glFragColor = insight_visibleColor;\n        } else if (insightColor.r > 0.0) {\n            glFragColor = insight_invisibleColor;\n        }\n    #endif\n    #ifdef HAS_CUT\n        vec4 cutColor = texture2D(invisibleMap, vTexCoord);\n        vec4 meshesMapColor = texture2D(meshesMap, vTexCoord);\n        if (cutColor.r == 1.0 && cutColor.g == 0.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 1.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 0.0 && cutColor.b == 1.0) {\n          glFragColor = sceneColor;\n        }\n    #endif\n    #ifdef HAS_EXCAVATE\n        vec4 excavateColor = texture2D(excavateMap, vTexCoord);\n        if (excavateColor.r == 1.0 && excavateColor.g == 0.0 && excavateColor.b == 0.0) {\n          glFragColor = sceneColor;\n        }  else {\n          glFragColor = excavateColor;\n        }\n    #endif\n    #ifdef HAS_CROSSCUT\n        vec4 crosscutColor = texture2D(crosscutMap, vTexCoord);\n        if (crosscutColor.r > 0.0) {\n            glFragColor = vec4(mix(cutLineColor.rgb, glFragColor.rgb, 0.99), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_HEIGHTLIMIT\n        vec4 heightLimitColor = texture2D(heightLimitMap, vTexCoord);\n        if (heightLimitColor.r > 0.0) {\n            glFragColor = vec4(mix(limitColor, glFragColor.rgb, 0.6), glFragColor.a);\n        }\n    #endif\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",extraCommandProps:{viewport:t,cull:{enable:!0},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}})}}class ni$3{constructor(t,i,e){this.H=t,this.i=i,this.Gt=e,this.s()}s(){this.renderer=new N$8(this.H);const t=this.i.getRenderer(),i=this.jt={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.Ut=this.H.framebuffer({color:this.H.texture({width:t.canvas?t.canvas.width:1,height:t.canvas?t.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.gt=new si$3(i)}getMap(){return this.i&&this.i.getMap()}paint(t,i){if(!i&&i.length)return t;this.Yt();const e={},s=this.i.mi;if(!this.vi())return t;this.H.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.Ut}),delete this.gt.shaderDefines.HAS_FLOODANALYSE,delete this.gt.shaderDefines.HAS_VIEWSHED,delete this.gt.shaderDefines.HAS_SKYLINE,delete this.gt.shaderDefines.HAS_INSIGHT,delete this.gt.shaderDefines.HAS_CUT,delete this.gt.shaderDefines.HAS_EXCAVATE,delete this.gt.shaderDefines.HAS_CROSSCUT,delete this.gt.shaderDefines.HAS_HEIGHTLIMIT;for(let t=0;t<s.length;t++){const n=s[t];if(!n.isEnable())continue;const r=n.getDefines();ht$5(this.gt.shaderDefines,r);const h=this.getMap(),o=h.width,a=h.height,l=this.wi(i,n.getExcludeLayers()),c=n.renderAnalysis(l,o,a);c&&ht$5(e,c)}return e.sceneMap=t,this.gt.setDefines(this.gt.shaderDefines),this.renderer.render(this.gt,e,null,this.Ut),this.Ut}wi(t,i){let e=[];for(let s=0;s<t.length;s++){if(i.indexOf(t[s].getId())>-1)continue;const n=t[s].getRenderer();if(n&&n.getAnalysisMeshes){const t=n.getAnalysisMeshes();t.forEach((t=>{t.setUniform("useAnalysis",1)})),e=e.concat(t)}}return e}Yt(){const t=t$2.Util.isFunction(this.jt.width.data)?this.jt.width.data():this.jt.width,e=t$2.Util.isFunction(this.jt.height.data)?this.jt.height.data():this.jt.height;!this.Ut||this.Ut.width===t&&this.Ut.height===e||this.Ut.resize(t,e)}vi(){const t=this.i&&this.i.mi;if(!t)return!1;for(let i=0;i<t.length;i++)if(t[i].isEnable())return!0;return!1}}const ri$3=[0,0,0,0],hi$3=[0,0],oi$3=t=>!t.bloom&&!t.ssr,ai$3=t=>!t.bloom,li$3=t=>!t.ssr;function ui$3(t){return"number"==typeof t&&!isNaN(t)}function fi$3(t){return t._framebuffer.framebuffer}function di$3(t){return t.depthStencil._texture.texture}function pi$3(t,i,e){return null==t[i]?e:t[i]}class gi$3 extends t__namespace.worker.Actor{constructor(t){super("@maptalks/terrain"),this.mapId=t}checkUrl(i){return i&&t__namespace.Util.isString(i)?t__namespace.Util.getAbsoluteURL(i):i}fetchTerrain(t,i,e){t=this.checkUrl(t);const s={actorId:this.actorId,mapId:this.mapId,command:"fetchTerrain",params:{url:t,origin:location.origin,terrainWidth:i.terrainWidth,type:i.type,accessToken:i.accessToken,error:i.error,maxAvailable:i.maxAvailable}};this.send(s,null,((t,i)=>{t?e(t):e(t,i)}))}abortTerrain(t,i){this.broadcast({actorId:this.actorId,mapId:this.mapId,command:"abortTerrain",params:{url:t}},null,i)}addLayer(t,i,e){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{}},null,e)}createTerrainMesh(t,i){this.send({actorId:this.actorId,command:"createTerrainMesh",params:t},[t.terrainHeights.data.buffer],((t,e)=>{t?i(t):i(t,e)}))}removeLayer(t,i,e){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,e)}}const mi$3=[];function vi$3(t,i,e,s,n,r,h){if((s-=h)<=0)return mi$3;let o=t.options.tileSize;Array.isArray(o)&&(o=o[0]);const a=t._getTileOffset(s),l=n[0]-a[0],c=a[1]-n[1];let u,f;if(l||c){const i=t._getTileConfig();u=i.tileSystem.scale.x,f=i.tileSystem.scale.x}let d=0,p=0,g=r/=Math.pow(2,h),m=r;if(l<0?g+=u*Math.ceil(-l/o-1e-7):l>0&&(d-=u*Math.ceil(l/o-1e-7)),c>0?p-=f*Math.ceil(c/o-1e-7):c<0&&(m+=f*Math.ceil(-c/o-1e-7)),0===d&&0===p&&g<=1&&m<=1){const n=Math.floor(i*r),h=Math.floor(e*r);return[{x:n,y:h,z:s,offset:a,id:t._getTileId(n,h,s)}]}let v=[];for(let n=d;n<g;n++)for(let h=p;h<m;h++){const o=i*r+n,l=e*r+h;v.push({x:o,y:l,z:s,offset:a,id:t._getTileId(o,l,s)})}return v}function wi$3(t,i,e,s,n){const r=t.getRenderer().tileCache,h=Math.floor(i/2),o=Math.floor(e/2),a=s-1,l=t._getTileId(h,o,a),c=r.get(l);return!c&&n<=0?wi$3(t,h,o,a,n+1):c}function bi$3(t,i,e,s){let n=t/e*s/i;return n<1?(n=1/n,n=1/Math.round(n)):n=Math.round(n),n}function _i$3(t,i,e){const s=t.getResolution(i),n=i-Math.log(e/s)*Math.LOG2E;return{zoom:n,res:t.getResolution(n)}}const yi$3=[],Mi$3=new t__namespace.Point(0,0),xi$3=new t__namespace.Point(0,0),Ci$3=new t__namespace.PointExtent(0,0,0,0),Si$3=new t__namespace.Point(0,0),Ti$3=[],Oi$3=new t__namespace.Point(20,20),ki$3=[!1,!1,!1,!1],Ai$3=[!0,!0,!0,!0];const Li$3=4;function Fi$3(t,i,e,s,n,r){const h=s.info.res/n,{info:o,image:a}=s,l=o.offset,c=a.width*h,u=a.height*h,p=o.extent2d.xmin*h-i.xmin,g=i.ymax-o.extent2d.ymax*h,m=e[0]-l[0],v=l[1]-e[1];if(t.drawImage(a,p+m,g+v,c,u),r){const{x:i,y:e,z:n}=s.info;Ii$3(t,`${i}/${e}/${n}`,"yellow",1,p+m,g+v,c,u,-18)}}function Ii$3(t,i,e,s,n,r,h,o,a=0){t.font="20px monospace",t.fillStyle=e,Oi$3.y=o-30,t.globalAlpha=1,t.fillText(i,Oi$3.x+n,Oi$3.y+r+a),t.globalAlpha=.6,t.strokeStyle=e,t.lineWidth=s,t.beginPath(),t.moveTo(n,r),t.lineTo(n+h,r),t.lineTo(n+h,r+o),t.lineTo(n,r+o),t.lineTo(n,r),t.stroke(),t.globalAlpha=1}function Ri$3(t,i){return i.properties.z-t.properties.z}t__namespace.renderer.TileLayerCanvasRenderer.include({renderTerrainSkin(t,i,e,s,n,r){const{res:h,extent2d:o,offset:a}=e,l=i.options.debug,c=i.options.debugOutline,u=s.getContext("2d");r&&Fi$3(u,o,a,r,h,l);for(let t=0;t<n.length;t++)Fi$3(u,o,a,n[t],h,l);if(l){const t=e.x+"/"+e.y+"/"+e.z,{width:i,height:s}=u.canvas;Ii$3(u,t,c,6,0,0,i,s)}},createTerrainTexture(t,i){const e=document.createElement("canvas");return e.width=t,e.height=i,e}});const Pi$3=new t__namespace.Coordinate(0,0),Hi$3=new t__namespace.Point(0,0),Di$3=[],Ni$3=[],Gi$3={tileGrids:[],count:0},ji$3="01",Bi$3="1";class Vi$3 extends t__namespace.TileLayer{getTileUrl(t,i,e){let s=super.getTileUrl(t,i,e);const n=this.options.type;return"cesium"===n&&(i=(1<<(e-=1))-i-1),"mapbox"===n?this.options.requireSkuToken&&(this.Je||(this.Je=this.Ke()),s.indexOf("?")>-1?s+="&sku="+this.Je:s+="?sku="+this.Je):"cesium"===n&&(s+="?extensions=octvertexnormals-watermask-metadata&v=1.2.0"),s}_getTileZoom(t){this._isUpdatingOptions=!0;const i=this.options.maxAvailableZoom;this.options.maxAvailableZoom=null;const e=super._getTileZoom(t);return this.options.maxAvailableZoom=i,this._isUpdatingOptions=!1,e}Ke(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return[Bi$3,ji$3,t].join("")}setSkinLayers(t){this.Ze=t;const i=this.getRenderer();i&&i.setToRedraw()}getSkinTiles(i){const e=this.getRenderer();if(!e)return Gi$3;const s=e.getTileGridsInCurrentFrame().tileGrids[0];if(!s)return Gi$3;const n=i.getId(),r=this._getTileConfig().tileSystem.scale,h=i.getTileSize().width,o=s.tiles;if(!o.length)return Gi$3;const a=s.parents||Di$3,l=a.length,c=a.concat(o),u=i.getSpatialReference(),f=o[0].extent2d.getWidth(),d=r.x,p=r.y,g=[],m=[],v=new Set;for(let e=0;e<c.length;e++){const s=c[e],{res:r}=s,{res:o,zoom:a}=_i$3(u,s.z,r),w=o/r,b=bi$3(o,h,r,f),{extent2d:_,offset:y}=s,M=b*s.x,x=b*s.y;if(s.skinTileIds||(s.skinTileIds={}),!s.skinTileIds[n]){const e=new Set,r=[],l=vi$3(i,s.x,s.y,a,y,b,0);for(let s=0;s<l.length;s++){let n=l[s];if(e.has(n.id))continue;n.idx=n.x,n.idy=n.y,n.res=o,n.url=i.getTileUrl(n.x,n.y,n.z+i.options.zoomOffset);const u=_.xmin*w+d*(n.x-M)*h,f=_.ymax*w+p*(n.y-x)*h;n.extent2d=new t__namespace.PointExtent(u,f-h,u+h,f),e.add(n.id),r.push(n)}s.skinTileIds[n]=r}const C=s.skinTileIds[n];for(let t=0;t<C.length;t++)v.has(C[t].id)||(e<l?g.push(C[t]):m.push(C[t]),v.add(C[t].id))}return{tileGrids:[{extent:s.extent,tiles:m,parents:g,count:m.length}],count:m.length}}getSkinLayer(t){return this.getSkinLayers()[t]}getSkinLayers(){return this.Ze||Di$3}getSkinCount(){return this.Ze&&this.Ze.length||0}queryTerrainByProjCoord(t){const i=this.getRenderer();if(!i)return 0;const e=this.getMap(),s=this.getSpatialReference(),n=i.getCurrentTileZoom(),r=s.getResolution(n),h=this.options.repeatWorld,o=this._getTileConfig().getTileIndex(t,r,h),a=e._prjToPointAtRes(t,r,Hi$3);return i.He(Ni$3,o,a,r,n)}queryTerrain(t){if(!this.getRenderer())return 0;const i=this.getMap().getProjection().project(t,Pi$3);return this.queryTerrainByProjCoord(i)}queryTileAltitude(t,i,e){const s=this.getRenderer();return s?s.je(t,i,e):null}queryTileMesh(t,i){const e=this.getRenderer();e&&e.Qe(t,i)}}Vi$3.include({_getTileId:(t,i,e)=>{const s=Math.pow(4,e+1);return""+(s+t*Math.sqrt(s/4)+i)}}),Vi$3.mergeOptions({forceRenderOnMoving:!0,forceRenderOnZooming:!0,forceRenderOnRotating:!0,fadeDuration:1e3/60*15,opacity:1,renderer:"gl",pyramidMode:1,tileSize:512,terrainWidth:65,backZoomOffset:0,depthMask:!0,blendSrc:"one",blendDst:"one minus src alpha",requireSkuToken:!0,tileRetryCount:0}),Vi$3.registerJSONType("TerrainLayer"),Vi$3.registerRenderer("gl",class extends t__namespace.renderer.TileLayerCanvasRenderer{constructor(...t){super(...t),this.Oe=new yt$6,this.ke=new yt$6}isDrawable(){return!0}consumeTile(t,i){if(t&&t.mesh&&!t.terrainMesh){t.terrainMesh=this.Ae(i,t.mesh),i.minAltitude=t.data.min,i.maxAltitude=t.data.max;const e=this.layer.tileInfoCache;if(e&&i.parentNodeId){const t=e.get(i.parentNodeId);t&&(void 0===t.minAltitude&&(t.minAltitude=i.minAltitude),void 0===t.maxAltitude&&(t.maxAltitude=i.maxAltitude))}}super.consumeTile(t,i);const e=this.getMap();if(e.updateCenterAltitude&&void 0===e.centerAltitude&&i.z===this.getCurrentTileZoom()){const t=e._getPrjCenter(),s=e._prjToPointAtRes(t,i.res,Si$3);i.extent2d.contains(s)&&e.updateCenterAltitude()}}draw(t,i){this.Oe.clear(),this.ke.clear(),super.draw(t,i),this.Ee(i)}drawTile(t,i){const e=this.getMap();if(!t||!e||!i)return;let s=this.drawingCurrentTiles?this.getTileOpacity(i):1;s*=this.layer.options.opacity||1;const n=i.terrainMesh;if(n){n.setUniform("opacity",s);const i=this.layer.getSkinCount();if(n.properties.skinCount!==i){const t=n.defines();t.SKIN_COUNT=i,n.properties.skinCount=i,n.defines=t}const e=this.layer.getSpatialReference().getMaxZoom(),r=!0===this.drawingCurrentTiles;n.setUniform("stencilRef",r?0:1+e-t.z),n.setUniform("isParent",r?0:1),n.setUniform("debugColor",[1,1,1,1]),r?this.Oe.addMesh(n):this.ke.addMesh(n)}}_drawTiles(t,i,e){const s=this.layer.getSkinCount();for(let n=0;n<s;n++){for(let i=0;i<t.length;i++)this.Le(n,t[i].info,t[i].image);for(let t=0;t<i.length;t++)this.Le(n,i[t].info,i[t].image);for(let t=0;t<e.length;t++)this.Le(n,e[t].info,e[t].image)}return super._drawTiles(...arguments)}Le(t,i,e){const s=this.getMap();if(!i||!s||!e)return;const n=e.terrainMesh;if(n){const s=this.layer.getSkinLayer(t);this.renderSkin(s,i,e,t);const r=this.Fe(),h=n.getUniform("skins"),o=e.skins;for(let t=0;t<o.length;t++)h[t]=o[t]||r}}renderSkin(t,i,e,s){const n=t.getRenderer();if(!n)return;e.skins||(e.skins=[]),e.skinImages||(e.skinImages=[]),e.skinStatus||(e.skinStatus=[]),e.skinTileIds||(e.skinTileIds=[]);const r=e.skinStatus[s],h=n.needToRefreshTerrainTile&&n.needToRefreshTerrainTile();if(!h&&r)return;const o=t.getSpatialReference(),{x:a,y:l,z:c,res:u,offset:f}=i,p=this.layer.getTileSize().width;let g=p,m=p;const{res:v,zoom:w}=_i$3(o,c,u),b=bi$3(v,t.getTileSize().width,u,g);let _=e.skinTileIds[s];_||(_=e.skinTileIds[s]=function(t,i,e,s,n,r,h){const o={};for(let a=0;a<h;a++)o[a+""]=vi$3(t,i,e,s,n,r,a);return o}(t,a,l,w,f,b,Li$3));const y=_[0];let M=!0;const x=[];let C;for(let i=0;i<y.length;i++){const s=n.tileCache.get(y[i].id);s?x.push(s):(M=!1,C||(C=wi$3(t,y[i].x,y[i].y,y[i].z,this.layer.options.backZoomOffset)))}let S,T=e.skinImages[s];if(T||(k$7.isPowerOfTwo(g)||(g=k$7.floorPowerOfTwo(g)),k$7.isPowerOfTwo(m)||(g=k$7.floorPowerOfTwo(m)),T=n.createTerrainTexture(g,m),e.skinImages[s]=T),n.renderTerrainSkin(this.regl,this.layer,i,T,x,C),t.fire("renderterrainskin",{tile:i,skinTiles:x}),T instanceof HTMLCanvasElement){const t=document.getElementById("terrain_skin_debug");t&&(t.width=g,t.height=m,t.getContext("2d").drawImage(T,0,0))}if(T.destroy)S=T;else{const t={data:T,width:g,height:m,flipY:!0,mipmap:!0,min:"mipmap",mag:"linear"};S=e.skins[s],S?S(t):S=this.regl.texture(t)}e.skins[s]=S,M&&(e.skinStatus[s]=1,h||(e.skinTileIds=[],e.skinImages[s]=null))}Ee(t){const i=this.layer.options.fadeAnimation&&this.layer.options.fadeDuration>0,e=this.q(),s=this.getRenderFBO(t);e.cullFace="front",e.enableStencil=!1,e.colorMask=!1,e.depthMask=!0,this.renderer.render(this.gt,e,this.ke,s),e.enableStencil=!0,e.colorMask=!0,e.cullFace="back",this.ke.meshes.sort(Ri$3),i&&(e.depthMask=!1,this.ke.meshes.forEach((t=>{const i=t.properties.skirtOffset;t.geometry.setDrawOffset(0),t.geometry.setDrawCount(i)})),this.renderer.render(this.gt,e,this.ke,s),e.depthMask=!0),this.Oe.meshes.forEach((t=>{const i=t.properties.skirtOffset;t.geometry.setDrawOffset(0),t.geometry.setDrawCount(i)})),this.renderer.render(this.gt,e,this.Oe,s),i&&(e.colorMask=!1),this.renderer.render(this.gt,e,this.ke,s),e.colorMask=!0,this.ke.meshes.forEach((t=>{const{skirtOffset:i,skirtCount:e}=t.properties;t.geometry.setDrawOffset(i),t.geometry.setDrawCount(e)})),this.renderer.render(this.gt,e,this.ke,s),this.Oe.meshes.forEach((t=>{const{skirtOffset:i,skirtCount:e}=t.properties;t.geometry.setDrawOffset(i),t.geometry.setDrawCount(e)})),this.renderer.render(this.gt,e,this.Oe,s),!this.Oe.meshes.length&&!this.ke.meshes.length||Object.keys(this.tilesLoading).length||this.layer.fire("terrainreadyandrender")}Ae(t,i){const{positions:e,texcoords:s,triangles:n,numTrianglesWithoutSkirts:r}=i,a=new Q$7({POSITION:e,TEXCOORD_0:s},n,0,{primitive:"triangles",positionAttribute:"POSITION",uv0Attribute:"TEXCOORD_0"});a.generateBuffers(this.regl);const l=this.layer.getSkinCount(),c=new ft$6(a);c.setDefines({SKIN_COUNT:l}),c.properties.skinCount=l,c.properties.skirtOffset=3*r,c.properties.skirtCount=n.length-3*r,c.properties.z=t.z;const u=[],f=this.Fe();for(let t=0;t<l;t++)u[t]=f;c.setUniform("skins",u),c.setUniform("bias",0);const p=this.getMap(),g=this.layer.options.tileSize,m=g+1,v=t.res/p.getGLRes();let w=(g+2)/m;const{extent2d:b,offset:_}=t;set$4(yi$3,(b.xmin-_[0])*v,(t.extent2d.ymax-_[1])*v,0);const y=identity$2([]);return translate$1(y,y,yi$3),set$4(Ti$3,v*w,v*w,1),scale$5(y,y,Ti$3),c.localTransform=y,c}Ie(t){const i=this.layer.options.maxAvailableZoom;let e,s=t.z;for(;s>i&&t;)e=this._findParentTile(t),s=(t=e&&e.info)&&t.z;return e}Re(t,i){const{image:e,info:s}=t,n=e.data,r=n.width,{extent2d:h,res:o}=s,{extent2d:a,res:l}=i,c=h.getWidth(),u=h.getHeight();let f=(a.xmin*l/o-h.xmin)/c*r,d=(h.ymax-a.ymax*l/o)/u*r;const g=Math.ceil((a.xmax*l/o-h.xmin)/c*r-f);f=Math.floor(f),d=Math.floor(d);const m=new Float32Array(g*g);let v=1/0,w=-1/0;for(let t=0;t<g;t++)for(let i=0;i<g;i++){const e=n.data[t+f+(d+i)*r];m[t+i*g]=e,e<v&&(v=e),e>w&&(w=e)}return{width:g,height:g,data:m,min:v,max:w}}getTileOpacity(t){return this.Pe(t)?super.getTileOpacity(t):(this.resetTileLoadTime(t),0)}Pe(t){if(!t.skinStatus)return!0;const i=this.layer.getSkinCount();for(let e=0;e<i;e++)if(!t.skinStatus[e])return!1;return!0}isValidCachedTile(t){return!!t.image&&!!this.Pe(t.image)}loadTile(i){const e=this.layer.options.maxAvailableZoom,s=this.layer.getSpatialReference().getResolution(i.z);if(e&&i.z>e){const e=this.Ie(i);if(e&&e.image&&e.image.data){const n=this.Re(e,i),r={};return this.workerConn.createTerrainMesh({terrainHeights:n,terrainWidth:this.layer.options.tileSize+1,error:s},((e,s)=>{if(e){if(e.canceled)return;return console.warn(e),void this.onTileError(r,i)}t__namespace.Util.extend(r,s),this.consumeTile(r,i),this.setToRedraw()})),r}}const r={};return this.workerConn.fetchTerrain(i.url,{terrainWidth:this.layer.options.tileSize+1,type:this.layer.options.type,accessToken:this.layer.options.accessToken,error:s,maxAvailable:e===i.z},((e,s)=>{if(e){if(e.canceled)return;return console.warn(e),void this.onTileError(r,i)}t__namespace.Util.extend(r,s),this.consumeTile(r,i),this.setToRedraw()})),r}deleteTile(t){if(!t||!t.image)return;const{image:i}=t,e=i.skins;if(e&&e.length)for(let t=0;t<e.length;t++)e[t]&&e[t].destroy&&e[t].destroy();i.terrainMesh&&(i.terrainMesh.geometry.dispose(),i.terrainMesh.dispose()),delete i.skins,delete i.skinStatus,delete i.skinTileIds,delete i.terrainMesh,delete i.mesh}abortTileLoading(t,i){i&&i.url&&this.workerConn&&this.workerConn.abortTerrain(i.url),super.abortTileLoading(t,i)}onTileError(t,i){super.onTileError(t,i)}He(t,i,e,s,n){const r=this.De(i.x,i.y,n,this.layer.options.backZoomOffset);if(r&&r.image&&r.image.data){const i=r.info.extent2d,n=r.info.res/s,o=i.ymax*n-e.y,a=this.Ne(r.image.data,(e.x-i.xmin*n)/(i.getWidth()*n),o/(i.getHeight()*n));t[0]=a,t[1]=1}else t[0]=null,t[1]=0;return t}De(t,i,e,s){const n=this.layer._getTileId(t,i,e);let r=this.tilesInView[n]||this.tileCache.get(n);return!r&&s<=0?this.De(Math.floor(t/2),Math.floor(i/2),e-1,s+1):r}Ne(t,i,e){const{width:s,height:n,data:r}=t,h=Math.floor(s*i);return r[Math.floor(n*e)*s+h]}Ge(t){const i=this.layer.getMap();return i?i.altitudeToPoint(t,i.getGLRes()):null}je(t,i,e){t||(t={tiles:{},dirty:!0,complete:!1});const s=this.layer,n=this.getCurrentTileZoom(),r=s.getSpatialReference().getResolution(n),{xmin:h,ymin:o,xmax:a,ymax:l}=i,c=s._getTileConfig();Mi$3.set(h,o).Be(e);const u=c._getTileNum(Mi$3,e,!0);xi$3.set(a,l).Be(e);const f=c._getTileNum(xi$3,e,!0),d=Math.min(u.x,f.x),p=Math.max(u.x,f.x),g=Math.min(u.y,f.y),m=Math.max(u.y,f.y),v=e/r;Mi$3.set(h,o).Be(v),xi$3.set(a,l).Be(v);const w=Ci$3.set(Mi$3.x,Mi$3.y,xi$3.x,xi$3.y),b=(s.options.tileSize||256)+1;w.Ve(w.getWidth()/b),t.array=t.array||new Float32Array(b*b);const _=t.tiles;t.complete=!0,t.array.fill(0);for(let i=d;i<=p;i++)for(let e=g;e<=m;e++){const s=this.layer._getTileId(i,e,n);if(_[s])continue;const r=this.tileCache.get(s);r?(this.Ue(t.array,r,w,b),t.dirty=!0,_[s]=1):(t.dirty=t.dirty||void 0!==t.tiles[s],t.tiles[s]&&delete t.tiles[s],t.complete=!1)}return t}Ue(t,i,e,s){const n=i.info.extent2d,r=n.intersection(e),{xmin:h,ymin:o,xmax:a,ymax:l}=r,{data:c}=i.image,u=c.width,f=e.getWidth()/s,d=Math.floor((h-e.xmin)/f),p=Math.floor((o-e.ymin)/f),g=Math.floor((a-e.xmin)/f)-d,m=Math.floor((l-e.ymin)/f)-p,v=n.getWidth()/u,w=Math.floor((h-n.xmin)/v),b=Math.floor((o-n.ymin)/v),_=Math.floor(f/v);for(let i=0;i<=g;i++)for(let e=0;e<=m;e++){const n=i+d+(p+e)*s;let r=0;for(let t=0;t<_;t++)for(let s=0;s<_;s++){const n=(w+Math.floor(i*_))*u+t+b+Math.floor(e*_)+s;r+=c.data[n]}t[n]=r/Math.max(_,1)}return t}onAdd(){super.onAdd(),this.prepareWorker()}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),this.gt&&(this.gt.dispose(),delete this.gt),this.ze&&this.ze.destroy(),super.onRemove()}prepareWorker(){const t=this.layer.getMap();this.workerConn||(this.workerConn=new gi$3(t.id));const i=this.workerConn;if(!i.isActive())return;const e=this.layer.options||{},s=this.layer.getId();i.addLayer(s,e,(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.setToRedraw(),this.layer.fire("workerready"))}))}createContext(){this.canvas.gl&&this.canvas.gl.wrap?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this.We(),this.ze=this.regl.texture(2,2),this.qe=new gt$6(this.ze),this.renderer=new N$8(this.regl),this.$e()}We(){const t=this.layer,i=t.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};i.preserveDrawingBuffer=!0,i.stencil=!0,this.glOptions=i,this.gl=this.gl||this.ce(this.canvas,i),this.regl=regl_min.exports.createREGL({gl:this.gl,attributes:i,extensions:["OES_element_index_uint"],optionalExtensions:t.options.glExtensions})}ce(t,i){const e=["webgl","experimental-webgl"];let s=null;for(let n=0;n<e.length;++n){try{s=t.getContext(e[n],i)}catch(t){}if(s)break}return s}resizeCanvas(t){this.canvas&&super.resizeCanvas(t)}clearCanvas(){this.canvas&&super.clearCanvas()}Fe(){return this.ze}$e(){const t=this.layer.getMap();this.Xe={projViewMatrix:t.projViewMatrix};const i=this.layer.getSkinCount(),e=[],s={viewport:{x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},colorMask:(t,i)=>!1===i.colorMask?ki$3:Ai$3,stencil:{enable:(t,i)=>i.enableStencil,func:{cmp:()=>"<=",ref:(t,i)=>i.stencilRef},op:{fail:"keep",zfail:"keep",zpass:"replace"}},cull:{enable:!0,face:(t,i)=>i.cullFace},depth:{enable:!0,mask:(t,i)=>this.layer.options.depthMask&&i.depthMask,func:this.layer.options.depthFunc||"<="},blend:{enable:!0,func:{src:this.layer.options.blendSrc,dst:this.layer.options.blendDst},equation:"add"}};this.gt=new ie$5({vert:"#define SHADER_NAME TERRAIN_SKIN\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform mat4 projViewModelMatrix;\nuniform float heightScale;\nvarying vec2 vUv;\nvoid main() {\n    vec3 position = vec3(aPosition.xy, aPosition.z * heightScale);\n    gl_Position = projViewModelMatrix * vec4(position, 1.0);\n    vUv = aTexCoord;\n}",frag:"#define SHADER_NAME TERRAIN_SKIN\nprecision mediump float;\nuniform sampler2D skins[SKIN_COUNT];\nuniform float opacity;\nuniform vec4 debugColor;\nuniform float isParent;\nvarying vec2 vUv;\nvec4 blend(vec4 src, vec4 dst) {\n    return vec4(src.rgb * src.a + dst.rgb * (1.0 - src.a), src.a + (1.0 - src.a) * dst.a);\n}\nvoid main() {\n    vec2 uv = vec2(vUv);\n    uv.y = 1.0 - uv.y;\n    vec4 color = vec4(0.0);\n    for (int i = 0; i < SKIN_COUNT; i++) {\n        color = blend(texture2D(skins[i], uv), color);\n    }\n    gl_FragColor = color * opacity;\n    if (isParent == 1.0) {\n        gl_FragColor *= debugColor;\n    }\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,i){return multiply$5(e,i.projViewMatrix,i.modelMatrix)}},{name:"skins",type:"array",length:i,fn:(t,i)=>i.skinTextures}],extraCommandProps:s})}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}q(){const t=this.getMap().projViewMatrix;let i=this.Ye;return i||(i=this.Ye=this.Ge(100)/100),{projViewMatrix:t,heightScale:i}}});const Ui$3=()=>{};class zi$3 extends t__namespace.Layer{static fromJSON(i){if(!i||"GroupGLLayer"!==i.type)return null;const e=i.layers.map((i=>t__namespace.Layer.fromJSON(i)));return new zi$3(i.id,e,i.options)}constructor(t,i,e){super(t,e),this.layers=i||[],this.layers.forEach((t=>{if(t.getMap())throw new Error(`layer(${t.getId()} is already added on map`)})),this.ts(),this.sortLayersByZIndex(),this.es={}}sortLayersByZIndex(){if(this.layers&&this.layers.length){for(let t=0,i=this.layers.length;t<i;t++)this.layers[t].__group_gl_order=t;this.layers.sort(qi$3)}}setSceneConfig(t){this.options.sceneConfig=t;const i=this.getRenderer();return i&&i.updateSceneConfig(),this}getSceneConfig(){return JSON.parse(JSON.stringify(this.options.sceneConfig||{}))}ct(){return this.options.sceneConfig}getGroundConfig(){const t=this.ct();return t?t.ground:null}getWeatherConfig(){const t=this.ct();return t&&t.weather}addLayer(t,i){if(t.getMap())throw new Error(`layer(${t.getId()}) is already added on map`);if("gl"!==t.options.renderer)throw new Error(`layer(${t.getId()})'s renderer is canvas, not supported to be added to GroupGLLayer`);void 0===i?this.layers.push(t):this.layers.splice(i,0,t),this.ts(),this.sortLayersByZIndex();const e=this.getRenderer();return e?(this.ss(t),e.setToRedraw(),this):this}removeLayer(i){t__namespace.Util.isString(i)&&(i=this.getChildLayer(i));const e=this.layers.indexOf(i);if(e<0)return this;i._doRemove(),this.ns(i),delete this.es[i.getId()],this.layers.splice(e,1);const s=this.getRenderer();return s?(s.setToRedraw(),this):this}Si(){let t=0;for(let i=0;i<this.layers.length;i++)this.layers[i].setPolygonOffset&&this.layers[i].getPolygonOffsetCount&&(t+=this.layers[i].getPolygonOffsetCount());let i=0;for(let e=0;e<this.layers.length;e++)this.layers[e].setPolygonOffset&&this.layers[e].getPolygonOffsetCount&&(this.layers[e].setPolygonOffset(i,t),i+=this.layers[e].getPolygonOffsetCount())}getLayers(){return this.layers}toJSON(){const t=[];if(this.layers)for(let i=0;i<this.layers.length;i++){const e=this.layers[i];e&&e&&e.toJSON&&t.push(e.toJSON())}return{type:this.getJSONType(),id:this.getId(),layers:t,options:this.config()}}onLoadEnd(){this.layers.forEach((t=>{this.ss(t)})),this.options.terrain&&this.rs(),super.onLoadEnd()}ss(t){const i=this.getMap();this.es[t.getId()]=t,t._canvas=this.getRenderer().canvas,t._bindMap(i),t.once("renderercreate",this.hs,this),t.once("remove",(t=>{this.removeLayer(t.target)})),t.load(),this.os(t)}onRemove(){this.as(),this.layers.forEach((t=>{this.ls(t),t._doRemove(),this.ns(t)})),this.es={},this.clearAnalysis(),super.onRemove()}getChildLayer(t){return this.es[t]||null}getLayer(t){return this.getChildLayer(t)}os(t){t.on("show hide",this.cs,this),t.on("idchange",this.us,this)}ns(t){t.off("show hide",this.cs,this),t.off("idchange",this.us,this)}cs(){const t=this.getRenderer();t&&t.setToRedraw()}us(t){const i=t.new,e=t.old,s=this.getLayer(e);delete this.es[e],this.es[i]=s}hs(t){t.renderer.clearCanvas=Wi$3}ts(){const t={};this.layers.forEach((i=>{const e=i.getId();if(t[e])throw new Error(`Duplicate child layer id (${e}) in the GroupGLLayer (${this.getId()})`);t[e]=1}))}addAnalysis(t){this.mi=this.mi||[],this.mi.push(t);const i=this.getRenderer();i&&i.setToRedraw()}removeAnalysis(t){if(this.mi){const i=this.mi.indexOf(t);i>-1&&(this.mi.splice(i,1),t.remove())}const i=this.getRenderer();i&&i.setToRedraw()}clearAnalysis(){this.mi&&(this.mi.forEach((t=>{t.remove()})),this.mi=[]);const t=this.getRenderer();t&&t.setToRedraw()}identify(i,e={}){const s=this.getMap(),n=this.getRenderer();if(!s||!n)return[];const r=s.coordToContainerPoint(new t__namespace.Coordinate(i));return this.identifyAtPoint(r,e)}identifyAtPoint(t,i={}){const e=i.includeInternals,s=this.getLayers(),n=i&&i.childLayers||s,r=this.getMap();if(!r)return[];const h=ot$5(i.count)?1:i.count;let a=[];for(let r=n.length-1;r>=0;r--){const h=n[r];if(s.indexOf(h)<0||!h.identifyAtPoint)continue;const o=h.options.geometryEvents;if(e&&(void 0===o||!1===o||0===o))continue;let l=h.identifyAtPoint(t,i);if(!l||!l.length)continue;if(i.filter&&(l=l.filter((t=>i.filter(t)))),!l.length)continue;const c=h.getId();for(let t=0;t<l.length;t++)l[t]&&(l[t].layer=c);a.push(...l)}if(i.orderByCamera){const t=r.cameraPosition;a.sort(((i,e)=>e.point?i.point?dist$2(i.point,t)-dist$2(e.point,t):1:-1))}return h&&(a=a.slice(0,h)),a}getTerrain(){return this.options.terrain}setTerrain(t){return t===this.options.terrain?this:(this.options.terrain=t,this.getRenderer()?(this.rs(),this):this)}rs(){const t=this.getRenderer();t&&t.setToRedraw();const i=this.options.terrain;if(this.oe){const t=this.oe.options;if(i&&t.urlTemplate===i.urlTemplate&&t.spatialReference===i.spatialReference){for(const t in i)"urlTemplate"!==t&&"spatialReference"!==t&&this.oe.config(t,i[t]);return this}this.fs(),this.as()}if(!i)return this;this.oe=new Vi$3("__terrain_in_group",i),this.ds(),this.oe.on("tileload",this.ps,this),this.ss(this.oe),this.fire("terrainlayercreated")}queryTerrain(t){return this.oe?this.oe.queryTerrain(t):0}queryTerrainByProjCoord(t){return this.oe?this.oe.queryTerrainByProjCoord(t):0}ds(){this.gs||(this.gs={});const t=this.layers,i=[];for(let e=0;e<t.length;e++){if(!t[e])continue;const s=t[e],n=s.getRenderer();n.renderTerrainSkin&&(this.gs[s.getId()]=s.options.background,s.options.background=!1,s.getTiles=()=>this.oe.getSkinTiles(s),s.isTerrainSkin=1,n.drawTile=n.drawTileOnTerrain?(...t)=>n.drawTileOnTerrain(...t):Ui$3,i.push(t[e])),n.setTerrainHelper&&n.setTerrainHelper(this.oe)}this.oe.setSkinLayers(i)}ls(t){if(!t.isTerrainSkin)return;const i=t.getRenderer();if(i&&delete i.drawTile,delete t.getTiles,delete t.isTerrainSkin,this.gs){const i=this.gs[t.getId()];void 0!==i?t.options.background=i:delete t.options.background,delete this.gs[t.getId()]}}fs(){const t=this.layers;for(let i=0;i<t.length;i++)t[i]&&this.ls(t[i]);delete this.gs}ps(){const t=this.getRenderer();t&&t.setToRedraw()}as(){if(this.oe){const t=this.oe;t.off("tileload",this.ps,this),this.ns(t),this.oe._doRemove(),delete this.oe,this.fire("terrainlayerremoved")}}getTerrainLayer(){return this.oe}_bindMap(...t){if(this.options.single){const i=t[0].getLayers();for(let t=0;t<i.length;t++)if(i[t]instanceof zi$3)throw new Error("Only one GroupGLLayer is allowed in a map instance. Set options.single to false if you want to add two or more GroupGLLayers.")}return super._bindMap(...t)}}function Wi$3(){}function qi$3(t,i){const e=t.getZIndex()-i.getZIndex();return 0===e?t.__group_gl_order-i.__group_gl_order:e}zi$3.mergeOptions({renderer:"gl",antialias:!0,extensions:[],single:!0,onlyWebGL1:!1,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_frag_depth","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"],forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,viewMoveThreshold:100,geometryEvents:!0,multiSamples:4}),zi$3.registerJSONType("GroupGLLayer"),zi$3.registerRenderer("gl",class extends t__namespace.renderer.CanvasRenderer{setToRedraw(){this.setRetireFrames(),super.setToRedraw()}onAdd(){super.onAdd(),this.prepareCanvas()}updateSceneConfig(){this.bi&&this.bi.update(),this._i&&this._i.update(),this.yi&&this.yi.update(),this.setToRedraw()}render(...t){this.getMap()&&this.layer.isVisible()&&(this.forEachRenderer((t=>{t._replacedDrawFn||(t.draw=this.Mi(t.draw),t.drawOnInteracting=this.xi(t.drawOnInteracting),t.setToRedraw=this.Ci(t.setToRedraw),t._replacedDrawFn=!0)})),this.prepareRender(),this.prepareCanvas(),this.layer.Si(),this._toRedraw=!1,this.Ti("render",t),this.Oi(),this.ki())}prepareCanvas(){super.prepareCanvas(),this.forEachRenderer((t=>{t.prepareCanvas()}))}drawOnInteracting(...t){this.getMap()&&this.layer.isVisible()&&(this.layer.Si(),this._toRedraw=!1,this.Ti("drawOnInteracting",t),this.Oi(),this.ki())}Ti(t,i){this.Ai="default";const e=this.hasRenderTarget(),s=this.Ei(i);if(e&&(this.Li.renderTarget=this.Fi()),this._i.paint(s),this.drawGround(!0),!e)return void this.Ii("default",null,t,i,!0);const n=this.glCtx,r=this.layer.ct(),h=r&&r.postProcess,o=this.isSSROn(),a=this.isEnableTAA(),l=s.jitter;if(s.jitter=hi$3,n.resetDrawCalls(),this.Ii(a?"fxaaBeforeTaa":"fxaa",this.Ri,t,i),this.Pi=n.getDrawCalls(),o&&this.Hi.drawSSR(this.Di(),this.Ri),a){const e=this.getMap(),r=this.Hi.isTaaNeedRedraw()||this.Ni||e.getRenderer().isViewChanged();s.jitter=r?l:this.Gi.getAverage(),s.onlyUpdateDepthInTaa=!r;let o=this.ji;if(o)o.width===this.Ri.width&&o.height===this.Ri.height||o.resize(this.Ri.width,this.Ri.height);else{const t=this.regl,i=this.li(h,this.Bi);o=this.ji=t.framebuffer(i)}n.resetDrawCalls(),this.Ii("taa",o,t,i),this.Vi=n.getDrawCalls(),delete s.onlyUpdateDepthInTaa,s.jitter=hi$3;let a=this.Ui;if(a)a.width===this.Ri.width&&a.height===this.Ri.height||a.resize(this.Ri.width,this.Ri.height);else{const t=this.regl,i=this.li(h,this.Bi);a=this.Ui=t.framebuffer(i)}n.resetDrawCalls(),this.Ii("fxaaAfterTaa",this.Ui,t,i),this.zi=n.getDrawCalls()}else this.ji&&(this.ji.destroy(),this.Ui.destroy(),delete this.ji,delete this.Ui,delete this.zi);h.bloom&&h.bloom.enable&&(this.Wi=this.Hi.drawBloom(this.Bi)),2===o&&this.Hi.drawSSR(this.Di(),this.Ri,!0),n.resetDrawCalls(),this.Ii("noAa",this.qi,t,i),this.$i=n.getDrawCalls(),n.resetDrawCalls(),this.Ii("point",this.Xi,t,i,!0),this.yi.renderScene(s),this.Yi=n.getDrawCalls()}Ii(t,i,e,s,n){this.Ai=t;const r=this.Ei(s);r.renderMode=this.Ai,r.renderTarget&&(r.renderTarget.fbo=i),n&&(r.isFinalRender=!0),this.forEachRenderer(((n,r)=>{r.isVisible()&&("default"===t||!n.supportRenderMode&&("fxaa"===t||"fxaaAfterTaa"===t)||n.supportRenderMode&&n.supportRenderMode(t))&&(this.clearStencil(n,i),n[e].apply(n,s))}))}Ei(t){let i=t[0];return ui$3(i)||(i=t[1]),i!==this.Ji&&(this.forEachRenderer(((t,i)=>{i.isVisible()&&t.needRetireFrames&&t.needRetireFrames()&&this.setRetireFrames()})),this.Li=this.Ki(i),this.Ji=i,this.Zi=ui$3(t[0])?null:t[0]),this.Li}Oi(){if(!this.isEnableOutline())return;const t=this.Qi(),i=this.glCtx;i.resetDrawCalls(),this.forEachRenderer(((i,e)=>{e.isVisible()&&i.drawOutline&&i.drawOutline(t)})),this.te=i.getDrawCalls()}Qi(){const{width:t,height:i}=this.canvas;let e=this.ie;if(e)t===e.width&&i===e.height||e.resize(t,i);else{const s=this.regl.texture({width:t,height:i,format:"rgba4"});e=this.ie=this.regl.framebuffer({width:t,height:i,colors:[s],depth:!1,stencil:!1})}return e}oi(t){if(this.gi()){const i=this.ee(t);return i.width!==t.width||i.height!==t.height?i.resize(t.width,t.height):this.regl.clear({color:[0,0,0,0],fbo:i}),i.blit(t),i.color[0]}return t.color[0]}Di(){if(this.Bi.subimage)return this.Bi;const{width:t,height:i}=this.Bi;if(!this.se){const e=this.regl,s={depthStencil:e.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:t,height:i,format:"depth stencil"}),colors:[e.renderbuffer({width:t,height:i,format:"rgba4"})],colorFormat:"rgba4",width:t,height:i};this.se=e.framebuffer(s)}return this.se.width===t&&this.se.height===i||this.se.resize(t,i),this.regl.clear({color:[0,0,0,0],depth:1,fbo:this.se}),this.se.blit(this.Ri,256,"nearest"),this.se.depthStencil}ee(t){if(this.ne||(this.ne=[]),!t.re){const i=this.he(!0,t.width,t.height),e=this.regl.framebuffer(i);this.ne.push(e),t.re=e}return t.re}gi(){return 0===this.regl.limits.version.indexOf("WebGL 2.0")&&this.layer.options.antialias}hasRenderTarget(){const t=this.layer.ct(),i=t&&t.postProcess;return!(!i||!i.enable)}testIfNeedRedraw(){if(this._toRedraw)return this._toRedraw=!1,!0;if(this.getMap().isInteracting()&&(this.bi&&this.bi.isEnable()||this._i&&this._i.isEnable()))return!0;if(this.yi&&this.yi.isEnable())return!0;const t=this.layer.oe;if(t){const i=t.getRenderer();if(i&&i.testIfNeedRedraw())return this.ae=!0,!0}const i=this.le();for(const t of i){const i=t.getRenderer();if(i&&i.testIfNeedRedraw())return this.ae=!0,!0}return!1}isRenderComplete(){const t=this.le();for(const i of t){const t=i.getRenderer();if(t&&!t.isRenderComplete())return!1}return!0}mustRenderOnInteracting(){const t=this.le();for(const i of t){const t=i.getRenderer();if(t&&t.mustRenderOnInteracting())return!0}return!1}isCanvasUpdated(){if(super.isCanvasUpdated())return!0;const t=this.le();for(const i of t){const t=i.getRenderer();if(t&&t.isCanvasUpdated())return!0}return!1}isBlank(){if(this.bi&&this.bi.isEnable())return!1;if(this._i&&this._i.isEnable())return!1;const t=this.le();for(const i of t){const t=i.getRenderer();if(t&&!t.isBlank())return!1}return!0}createContext(){const t=this.layer,i=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0};i.preserveDrawingBuffer=!0,i.antialias=!!t.options.antialias,this.glOptions=i;const e=this.gl=this.ce(this.canvas,i);this.ue(e),e.wrap=()=>new i$2(this.gl),this.glCtx=e.wrap(),this.canvas.gl=this.gl,this.reglGL=e.wrap(),this.regl=h$1({gl:this.reglGL,attributes:i,extensions:t.options.extensions,optionalExtensions:t.options.optionalExtensions}),this.gl.regl=this.regl,this.fe=[0,0],this.bi=new xt$5(this.regl,this.layer),this._i=new At$4(this.regl,this.layer);const s=this.layer.getWeatherConfig();this.yi=new Jt$4(this.regl,t,s),this.de=new ni$3(this.regl,t);const n=this.layer.ct()||{},r=n&&n.postProcess;this.Gi=new Ae$4(r&&r.antialias&&r.antialias.jitterRatio||.2),this.Hi=new ti$3(this.regl,this.layer,this.Gi),this.h=new vt$4(this.regl,n,this.layer)}ue(){const t=this.layer,i=this.gl,e=t.options.extensions;e&&e.forEach((t=>{i.getExtension(t)}));const s=t.options.optionalExtensions;s&&s.forEach((t=>{i.getExtension(t)})),this.gl.clearColor(0,0,0,0)}clearCanvas(){super.clearCanvas(),this.pe()}pe(){const t=this.regl;this.Ri&&(t.clear({color:ri$3,depth:1,stencil:255,framebuffer:this.Ri}),t.clear({color:ri$3,framebuffer:this.qi}),t.clear({color:ri$3,framebuffer:this.Xi}),this.ji&&this.Vi&&t.clear({color:ri$3,framebuffer:this.ji}),this.Ui&&this.zi&&t.clear({color:ri$3,framebuffer:this.Ui})),this.ie&&t.clear({color:ri$3,framebuffer:this.ie}),t.clear({color:ri$3,depth:1,stencil:255})}resizeCanvas(){const t=this.canvas.width,i=this.canvas.height;!this.Ri||this.Ri.width===t&&this.Ri.height===i||(super.resizeCanvas(),this.Ri.resize(t,i),this.qi.resize(t,i),this.Xi.resize(t,i),this.ji&&this.ji.resize(t,i),this.Ui&&this.Ui.resize(t,i),this.pe(),this.forEachRenderer((t=>{t.canvas&&t.resizeCanvas()})))}getCanvasImage(){return this.forEachRenderer((t=>{t.getCanvasImage()})),super.getCanvasImage()}le(){return this.layer.getLayers()}forEachRenderer(t){const i=this.le();for(const e of i){if(!e.isVisible()||!e.options.beneathTerrain)continue;const i=e.getRenderer();i&&t(i,e)}const e=this.layer.oe;if(e){const i=e.getRenderer();i&&t(i,e)}for(const e of i){if(!e.isVisible()||e.options.beneathTerrain)continue;const i=e.getRenderer();i&&t(i,e)}}ce(t,i){const e=this.layer.options.onlyWebGL1?["webgl","experimental-webgl"]:["webgl2","webgl","experimental-webgl"];let s=null;for(let n=0;n<e.length;++n){try{s=t.getContext(e[n],i)}catch(t){}if(s)break}return s}clearStencil(t,i){const e={stencil:t.getStencilValue?t.getStencilValue():255};i&&(e.framebuffer=i),this.regl.clear(e)}onRemove(){this.canvas.pickingFBO&&this.canvas.pickingFBO.destroy&&this.canvas.pickingFBO.destroy(),this.ge(),this.bi&&(this.bi.dispose(),delete this.bi),this._i&&(this._i.dispose(),delete this._i),this.h&&(this.h.dispose(),delete this.h),this.Hi&&(this.Hi.dispose(),delete this.Hi),this.ie&&(this.ie.destroy(),delete this.ie),this.yi&&(this.yi.dispose(),delete this.yi),super.onRemove()}ge(){if(this.Ri&&(this.Ri.destroy(),this.qi.destroy(),this.Xi.destroy(),this.ji&&(this.ji.destroy(),delete this.ji),this.Ui&&(this.Ui.destroy(),delete this.Ui),delete this.Ri,delete this.qi,delete this.Xi,this.me&&(this.me.destroy(),delete this.me),this.se&&(this.se.destroy(),delete this.se),this.ne)){for(let t=0;t<this.ne.length;t++)this.ne[t]&&this.ne[t].destroy();delete this.ne}}setRetireFrames(){this.Ni=!0}getFrameTime(){return this.Ji}getFrameEvent(){return this.Zi}getFrameContext(){return this.Li}drawGround(t){const i=this.layer.getGroundConfig();if(!i||!i.enable)return!1;if(!this.bi)return!1;const e=this.getFrameContext(),s=e.jitter;let n;e.jitter=hi$3,e.offsetFactor=2,e.offsetUnits=2,t&&(n=e.sceneFilter,delete e.sceneFilter);const r=this.bi.paint(e);return this.bi.needToRedraw()&&this.setToRedraw(),n&&(e.sceneFilter=n),e.jitter=s,r}Mi(t){const i=this;return function(e,s){return(s=s||i.Li)&&s.renderTarget&&(s.renderTarget.getFramebuffer=fi$3,s.renderTarget.getDepthTexture=di$3),t.call(this,e,s)}}xi(t){const i=this;return function(e,s,n){return(n=n||i.Li)&&n.renderTarget&&(n.renderTarget.getFramebuffer=fi$3,n.renderTarget.getDepthTexture=di$3),t.call(this,e,s,n)}}Ci(t){return function(...i){return t.apply(this,i)}}isEnableSSR(){const t=this.layer.ct(),i=t&&t.postProcess;return i&&i.enable&&i.ssr&&i.ssr.enable}isSSROn(){const t=this.isEnableSSR(),i=this.getMap();if(!t||i.getPitch()<=-.001)return 0;const e=i.projViewMatrix,s=this.Hi.getPrevSsrProjViewMatrix();return s&&exactEquals$5(s,e)?1:2}isEnableTAA(){return!1}isEnableSSAO(){const t=this.layer.ct(),i=t&&t.postProcess;return i&&i.enable&&i.ssao&&i.ssao.enable}isEnableOutline(){const t=this.layer.ct(),i=t&&t.postProcess;return i&&i.enable&&i.outline&&i.outline.enable}isEnableWeather(){const t=this.layer.ct(),i=t&&t.weather;return i&&i.enable}ve(){const t=this.layer.getMap();if(!this.k){this.k={center:t.getCenter(),bearing:t.getBearing(),pitch:t.getPitch(),res:t.getResolution()};let i=!1;if(t.options.lights){const e=t.getLightManager().getDirectionalLight().direction;this.k.lightDirection=copy$4([],e),i=!0}return{viewChanged:!0,lightDirectionChanged:i}}const i=t.getResolution()/this.k.res,e=t.coordToContainerPoint(this.k.center),s=this.layer.options.viewMoveThreshold,n=e._sub(t.width/2,t.height/2).mag()>s||i<.95||i>1.05;let r=!1;if(t.options.lights){const i=t.getLightManager().getDirectionalLight().direction;r=!equals$5(this.k.lightDirection,i),r&&(this.k.lightDirection=copy$4([],i))}return n&&(this.k.center=t.getCenter(),this.k.bearing=t.getBearing(),this.k.pitch=t.getPitch(),this.k.res=t.getResolution()),{viewChanged:n,lightDirectionChanged:r}}Ki(t){const i=this.layer.ct(),e=i&&i.postProcess,s=i&&i.weather,n={timestamp:t,renderMode:this.Ai||"default",includes:{},states:this.ve(),testSceneFilter:t=>!n.sceneFilter||n.sceneFilter(t),isFinalRender:!1,weather:{fog:s&&s.fog}},h=this.Gi;h.setRatio(e&&e.antialias&&e.antialias.jitterRatio||.2);const o=this.isSSROn();let a;if(e&&e.enable){this.isEnableTAA()?((this.getMap().isInteracting()||this.Ni)&&h.reset(),h.getJitter(this.fe),h.frame()):set(this.fe,0,0),n.jitter=this.fe;const t=e.bloom&&e.bloom.enable;t&&o?(n.bloom=1,n.sceneFilter=oi$3):t?(n.bloom=1,n.sceneFilter=ai$3):o&&(n.sceneFilter=li$3),a=this.Fi(),a&&(n.renderTarget=a)}else this.ge();return"noAa"!==this.Ai&&(this.we=this.be(n),this.we&&(n.includes.shadow=1),this._e=this.ye(n)),this.we&&(n.shadow=this.we,n.includes.shadow=1),n.states.includesChanged=this._e,e&&e.enable&&this.Hi&&this.Hi.setContextIncludes(n),n}Me(t){const i=this.le().filter((t=>t.isVisible()));return this.de.paint(t,i)}ye(t){let i=!1;const e=Object.keys(t.includes),s=this.xe;if(s){const t=e.filter((t=>-1===s.indexOf(t))).concat(s.filter((t=>-1===e.indexOf(t))));t.length&&(i=t.reduce(((t,i)=>(t[i]=1,t)),{}))}return this.xe=e,i}be(t){const i=this.layer.ct();if(!i||!i.shadow||!i.shadow.enable)return this.h&&(this.h.dispose(),delete this.h),null;this.h||(this.h=new vt$4(this.regl,this.layer.ct()||{},this.layer));const e={config:i.shadow,defines:this.h.getDefines(),uniformDeclares:vt$4.getUniformDeclares()};return e.renderUniforms=this.Ce(t),e}Ce(t){const i=t.renderTarget&&t.renderTarget.fbo,e=this.layer.ct(),s=[];let n=t.states.lightDirectionChanged||t.states.viewChanged;this.forEachRenderer(((t,i)=>{if(!t.getShadowMeshes||!i.isVisible())return;const e=t.getShadowMeshes();if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t].needUpdateShadow&&(n=!0),e[t].needUpdateShadow=!1,s.push(e[t])})),this.Se||(this.Se=new yt$6),this.Se.setMeshes(s);const r=this.getMap(),h=e.shadow,o=r.getLightManager().getDirectionalLight().direction;return this.h.render(!e.ground||!e.ground.enable,r.projMatrix,r.viewMatrix,h.color,h.opacity,o,this.Se,this.fe,i,n)}Te(t){let i=[];if(this.forEachRenderer(((t,e)=>{if(!t.getShadowMeshes||!e.isVisible())return;const s=t.getShadowMeshes();i=i.concat(s)})),this.bi){const t=this.bi.getRenderMeshes();i=i.concat(t)}const e=this.layer.getWeatherConfig();return this.yi.paint(t,i,e)}Fi(){const t=this.layer.ct(),i=t&&t.postProcess;if(!this.Ri){const t=this.regl;let e=this.Bi;(!e||!e._texture||e._texture.refCount<=0)&&(e=null);const s=this.li(i,e);this.Bi=s.depth||s.depthStencil,this.Ri=t.framebuffer(s);const n=this.li(i,this.Bi);this.qi=t.framebuffer(n);const r=this.li(i,this.Bi);this.Xi=t.framebuffer(r),this.pe()}return{fbo:this.Ri}}he(t,i,e){i=i||this.canvas.width,e=e||this.canvas.height;const s=this.regl,n=this.gi();let r;if(!t&&n)r=s.renderbuffer({width:i,height:e,samples:this.layer.options.multiSamples,format:"rgba8"});else{r=s.texture({min:"nearest",mag:"nearest",type:"uint8",width:i,height:e})}return{width:i,height:e,colors:[r],colorFormat:n?"rgba8":"rgba"}}li(t,i){const{width:e,height:s}=this.canvas,n=this.regl,r=this.he(),h=this.gi(),o=n.hasExtension("WEBGL_depth_texture");if(h){const t=i||n.renderbuffer({width:e,height:s,format:"depth24 stencil8",samples:this.layer.options.multiSamples});r.depthStencil=t}else if(o){const t=i||n.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:e,height:s,format:"depth stencil"});r.depthStencil=t}else{const t=i||n.renderbuffer({width:e,height:s,format:"depth stencil"});r.depthStencil=t}return r}ki(){if(!this.Ri)return void(this.Ni=!1);const t=this.layer.ct(),i=t&&t.postProcess;if(!i||!i.enable)return;this.layer.fire("postprocessstart");const e=this.layer.getMap();let s;if(this.isEnableTAA()){const t=this.Ni||e.getRenderer().isViewChanged();t&&this.layer.fire("taastart");const{outputTex:i,redraw:n}=this.Hi.taa(this.oi(this.ji),this.Di(),{projMatrix:e.projMatrix,needClear:t});s=i,n?this.setToRedraw():this.layer.fire("taaend"),this.Ni=!1}let n=i.sharpen&&i.sharpen.factor;n||0===n||(n=.2);let r=0,h=.2,o=.3,a=1,l=[1,1,0];i.outline&&(r=+!!i.outline.enable,h=pi$3(i.outline,"highlightFactor",h),o=pi$3(i.outline,"outlineFactor",o),a=pi$3(i.outline,"outlineWidth",a),l=pi$3(i.outline,"outlineColor",l));const c=this.isEnableSSAO(),u=i.ssr&&i.ssr.enable,f=i.bloom&&i.bloom.enable,d=f&&this.Wi,p=+!(!i.antialias||!i.antialias.enable),g=this.de.vi(),m=this.yi.ti(),v=c||f||u||g||m;let w=this.me;if(v){if(!w){const t=this.he();this.gi()&&(t.depthStencil=this.regl.renderbuffer({width:this.canvas.width,height:this.canvas.height,samples:this.layer.options.multiSamples,format:"depth24 stencil8"})),w=this.me=this.regl.framebuffer(t)}const{width:t,height:i}=this.canvas;w.width===t&&w.height===i||w.resize(t,i)}else w=null,this.me&&(this.me.destroy(),delete this.me);let b=this.oi(this.Ri);const _=this.$i&&this.oi(this.qi),y=this.Yi&&this.oi(this.Xi);if(this.Hi.fxaa(w,b,!d&&_,!d&&y,s,this.zi&&this.Ui&&this.oi(this.Ui),p,+!(!i.toneMapping||!i.toneMapping.enable),+!(v||!i.sharpen||!i.sharpen.enable),e.getDevicePixelRatio(),n,r&&this.te>0&&this.Qi(),h,o,a,l),w&&(b=this.oi(w)),c&&(this.zi||this.Vi||this.Pi)&&(b=this.Hi.ssao(b,this.Di(),{projMatrix:e.projMatrix,cameraNear:e.cameraNear,cameraFar:e.cameraFar,ssaoBias:i.ssao&&i.ssao.bias||10,ssaoRadius:i.ssao&&i.ssao.radius||100,ssaoIntensity:i.ssao&&i.ssao.intensity||.5})),f&&this.Wi){const t=i.bloom,e=+t.threshold||0,s=pi$3(t,"factor",1),n=pi$3(t,"radius",1);b=this.Hi.bloom(b,_,y,e,s,n,p)}if(u&&(this.Hi.genSsrMipmap(b,this.Di()),this.ae)){const t=this.Ni;this.setToRedraw(),this.Ni=t,this.ae=!1}this.de&&(b=this.Me(b)),this.isEnableWeather()&&(b=this.Te(b)),v&&this.Hi.renderFBOToScreen(b,+!(!i.sharpen||!i.sharpen.enable),n,e.getDevicePixelRatio()),this.layer.fire("postprocessend")}}),zi$3.registerRenderer("canvas",null);class $i$3{constructor(t){this.ms=t,this.D=new gt$6,this.onHDRLoaded=this.vs.bind(this),this.onHDRError=this.ws.bind(this)}getDirectionalLight(){return this.Gt&&this.Gt.directional||{}}getAmbientLight(){return this.Gt&&this.Gt.ambient||{}}getAmbientResource(){return this.bs}setConfig(t){const i=this.Gt;this.Gt=JSON.parse(JSON.stringify(t));let e=!1;if(t&&t.ambient&&t.ambient.resource){if(!(i&&i.ambient&&function(t,i){return!!t.resource&&t.resource.url===i.resource.url}(i.ambient,t.ambient)))return void this._s();this.bs&&(t.ambient.prefilterCubeSize!==i.ambient&&i.ambient.prefilterCubeSize&&this.vs(),e=!0,t.ambient.resource.sh&&(this.bs.sh=t.ambient.resource.sh))}else this.ys(),e=i&&i.ambient&&i.ambient.resource;this.ms.fire("updatelights",{ambientUpdate:e})}Ms(t){const i=t.getLayers();for(let t=0;t<i.length;t++){const e=i[t]&&i[t].getRenderer();if(e&&e.regl)return e.regl}const e=document.createElement("canvas"),s=h$1({canvas:e,attributes:{depth:!1,stencil:!1,alpha:!1}});return s.xs=!0,s}_s(){const t=this.Gt.ambient.resource,i=t&&t.url;if(!i)return;const e=[];let s=0,n=0;const r=()=>{n++,n>=s&&this.Cs(e)},h=function(){throw new Error(`skybox image with url(${this.src}) failed to load, please check the image's url.`)};if(i.top){const{front:t,back:n,right:o,left:a,top:l,bottom:c}=i,u=[t,n,o,a,l,c];s=u.length;for(let t=0;t<s;t++){const i=new Image;i.onload=r,i.onerror=h,i.src=u[t],e[t]=i}}else{this.Ss=new Vt$5({url:t.url,arrayBuffer:!0,hdr:!0,flipY:!0},this.D),this.Ss.once("complete",this.onHDRLoaded),this.Ss.once("error",this.onHDRError)}}dispose(){this.ys()}vs(){this.Ss&&(this.bs=this.Ts(this.Ss),this.ms.fire("updatelights",{ambientUpdate:!0}))}ws(){this.ms.fire("hdrerror")}Cs(t){this.bs=this.Ts(t),this.ms.fire("updatelights",{ambientUpdate:!0})}Ts(t){const i=this.Gt.ambient.resource,e=i.prefilterCubeSize||256,s=this.Ms(this.ms),n=Fm.PBRHelper.createIBLMaps(s,{envTexture:Array.isArray(t)?t:t.getREGLTexture(s),rgbmRange:Array.isArray(t)?9:t.rgbmRange,ignoreSH:!!i.sh,envCubeSize:e,prefilterCubeSize:e,format:"array"});if(i.sh&&(n.sh=i.sh,Array.isArray(n.sh[0]))){const t=n.sh,i=[];for(let e=0;e<t.length;e++)i.push(...t[e]);n.sh=i}return s.xs&&(delete this.Ss,s.destroy()),n}ys(){this.Ss&&(this.Ss.dispose(),delete this.Ss),delete this.bs}}let Xi$3,Yi$3,Ji$3,Ki$3,Zi$3;t$2.Map.include({setLights(t){return this.options.lights=t,this.Os(),this},getLights(){return this.options.lights},Os(){this.ks||(this.ks=new $i$3(this)),this.ks.setConfig(this.getLights())},getLightManager(){return this.ks?this.ks:(this.As||(this.As=!0,console.warn("map's light config is not set, use map.setLights(config) to set lights.")),null)}}),t$2.Map.addOnLoadHook((function(){this.options.lights&&this.Os()}));const Qi$3={color:[0,0,0,0]},te$4={enable:!0};t$2.Map.include({setPostProcessConfig(t){return this.options.postProcessConfig=t,this},getPostProcessConfig(){return this.options.postProcessConfig}});const ie$4=t$2.renderer.MapCanvasRenderer.prototype.drawLayerCanvas;t$2.renderer.MapCanvasRenderer.prototype.drawLayerCanvas=function(){const t=ie$4.apply(this,arguments);return t&&se$4(this,this.canvas),t};const ee$4=t$2.renderer.MapCanvasRenderer.prototype.renderFrame;function se$4(t,i){const e=t.map.getPostProcessConfig();if(!e||!e.enable)return;var s,n;Xi$3||(s=i.width,n=i.height,Xi$3=document.createElement("canvas",s,n),Yi$3=h$1({canvas:Xi$3,attributes:{depth:!1,stencil:!1,alpha:!0,antialias:!1,premultipliedAlpha:!1}}),Ji$3=Yi$3.texture({mag:"linear",min:"linear",mipmap:!1,flipY:!0,width:s,height:n}),Ki$3=Yi$3.texture()),Xi$3.width===i.width&&Xi$3.height===i.height||(Xi$3.width=i.width,Xi$3.height=i.height),Yi$3.clear(Qi$3);const r=e.filmicGrain||te$4;void 0===r.enable&&(r.enable=!0);const h=e.vignette||te$4;void 0===h.enable&&(h.enable=!0);const o=e.colorLUT||te$4;void 0===o.enable&&(o.enable=!0),t.Es||(t.Es={});const a=t.Es;if(o.enable){const i=o.lut;if(!a.lutTexture||a.lutTexture.url!==i){const e=new Image;e.onload=function(){const s={data:e,min:"linear",mag:"linear"},n=a.lutTexture?a.lutTexture.texture(s):Yi$3.texture(s);a.lutTexture={url:i,texture:n},t.setLayerCanvasUpdated()},e.src=i}}const l={enableGrain:+!!r.enable,grainFactor:void 0===r.factor?.15:r.factor,timeGrain:performance.now(),enableVignette:+!!h.enable,lensRadius:h.lensRadius||[.8,.25],frameMod:1,enableLut:+!!o.enable,lookupTable:a.lutTexture?a.lutTexture.texture:Ki$3};Zi$3||(Zi$3=new ti$3(Yi$3)),Zi$3.postprocess(null,l,Ji$3({width:Xi$3.width,height:Xi$3.height,data:i,flipY:!0,mag:"linear",min:"linear",mipmap:!1})),r.enable&&t.setLayerCanvasUpdated(),t.context.drawImage(Xi$3,0,0,Xi$3.width,Xi$3.height)}t$2.renderer.MapCanvasRenderer.prototype.renderFrame=function(){const t=ee$4.apply(this,arguments),i=this.map.getPostProcessConfig(),e=i&&i.filmicGrain;return!e||void 0!==e.enable&&!0!==e.enable||this.setLayerCanvasUpdated(),t};const ne$4=[];function re$3(t){if(!t.properties.showOnlyTimestamp)return;delete t.properties.showOnlyTimestamp;const i=t.properties.oldElementsBeforeHighlight;i&&t.geometry.elements!==i&&(t.geometry.elements.destroy(),t.geometry.setElements(i))}function he$4(t){if(!t.properties.highlightTimestamp)return;const i=t.defines;delete i.HAS_HIGHLIGHT_COLOR,delete i.HAS_HIGHLIGHT_OPACITY,t.setDefines(i),delete t.properties.highlightTimestamp;const e=t.properties.oldElementsBeforeHighlight;e&&t.geometry.elements!==e&&(t.geometry.elements.destroy(),t.geometry.setElements(t.properties.oldElementsBeforeHighlight),delete t.properties.hasInvisible),oe$4(t)}function oe$4(t){if(!t)return;const{hlBloomMesh:i}=t.properties;if(i){const e=i.geometry;e.elements&&e.elements.destroy&&e.elements.destroy(),i.dispose(),delete t.properties.hlBloomMesh}}var ae$4=Object.freeze({__proto__:null,clearShowOnly:re$3,showOnly:function(t,i,e,s,n){const{showOnlyTimestamp:r}=i.properties;if(!e)return void(r&&re$3(i));if(s===r)return;i.properties.showOnlyTimestamp=s;const h=e.keys(),o=[];for(const t of h){if(!n.has(t))continue;const i=n.get(t);i&&ct$5(o,i)}i.properties.oldElementsBeforeHighlight||(i.properties.oldElementsBeforeHighlight=i.geometry.elements),i.geometry.elements!==i.properties.oldElementsBeforeHighlight&&i.geometry.elements.destroy&&i.geometry.elements.destroy();const a={data:o,primitive:i.geometry.getPrimitive()};i.geometry.setElements(t.elements(a)),i.geometry.generateBuffers(t)},clearHighlight:he$4,highlightMesh:function(t,i,e,s,n){const{highlightTimestamp:r}=i.properties;if(!e)return void(r&&he$4(i));if(s===r)return;const o=i.geometry.getVertexCount();let{aHighlightColor:a,aHighlightOpacity:l}=i.geometry.properties;a&&a.fill(0),l&&l.fill(255);let c=!1,f=!1;const p=e.keys();let g=null,m=null;for(const t of p)if(n.has(t)){let i,{color:s,opacity:r,bloom:h,visible:d}=e.get(t);s&&(c||(a||(a=new Uint8Array(4*o)),c=!0),i=dt$5(ne$4,s)),r=ot$5(r)?1:r,r<1&&(f||(l||(l=new Uint8Array(o),l.fill(255)),f=!0)),!1===d&&(m||(m=new Set),m.add(t));const p=n.get(t);if(p)for(let t=0;t<p.length;t++){const e=p[t];i&&set$3(a.subarray(4*e,4*e+4),...i),r<1&&(l[e]=255*r),h&&(g||(g=[]),g.push(e))}}const v=i.defines;if(c?(i.geometry.data.aHighlightColor?i.geometry.updateData("aHighlightColor",a):(i.geometry.data.aHighlightColor=a,i.geometry.generateBuffers(t)),i.geometry.properties.aHighlightColor=a,v.HAS_HIGHLIGHT_COLOR=1):v.HAS_HIGHLIGHT_COLOR&&(i.geometry.updateData("aHighlightColor",a),delete v.HAS_HIGHLIGHT_COLOR),f?(i.geometry.data.aHighlightOpacity?i.geometry.updateData("aHighlightOpacity",l):(i.geometry.data.aHighlightOpacity=l,i.geometry.generateBuffers(t)),i.geometry.properties.aHighlightOpacity=l,v.HAS_HIGHLIGHT_OPACITY=1):v.HAS_HIGHLIGHT_OPACITY&&(i.geometry.updateData("aHighlightOpacity",l),delete v.HAS_HIGHLIGHT_OPACITY),m&&m.size>0){let e=[];n.forEach(((t,i)=>{m.has(i)||ct$5(e,t)})),i.properties.hasInvisible=!0,i.properties.oldElementsBeforeHighlight||(i.properties.oldElementsBeforeHighlight=i.geometry.elements);const s={data:e,primitive:i.geometry.getPrimitive()};i.geometry.elements!==i.properties.oldElementsBeforeHighlight&&i.geometry.elements.destroy&&i.geometry.elements.destroy(),e=t.elements(s),i.geometry.setElements(e),i.geometry.generateBuffers(t)}else i.properties.hasInvisible&&(i.geometry.elements&&i.geometry.elements.destroy&&i.geometry.elements.destroy(),i.geometry.setElements(i.properties.oldElementsBeforeHighlight),delete i.properties.hasInvisible);i.setDefines(v),i.properties.highlightTimestamp=s;let w=i.properties.hlBloomMesh;if(g&&g.length){if(w){const t=copy$5(w.localTransform,i.localTransform),e=copy$5(w.positionMatrix,i.positionMatrix);w.setLocalTransform(t),w.setPositionMatrix(e),i.properties.hlBloomMesh.geometry.setElements(g)}else{const e=new Q$7(i.geometry.data,g,0,i.geometry.desc);e.generateBuffers(t);w=new ft$6(e,i.material,i.config);const n=i.uniforms;for(const t in n)Object.defineProperty(w.uniforms,t,{enumerable:!0,get:function(){return i.getUniform(t)}});const r=ht$5({},i.defines);r.HAS_BLOOM=1;const o=copy$5([],i.localTransform),a=copy$5([],i.positionMatrix);w.setLocalTransform(o),w.setPositionMatrix(a),ht$5(w.properties,i.properties),ht$5(e.properties,i.geometry.properties),w.setDefines(r),w.bloom=1}i.properties.hlBloomMesh=w}else w&&oe$4(i)},deleteHighlightBloomMesh:oe$4});const le$4=[0,0,0,0];class ce$4{constructor(t,i,e,s,n,r){this.renderer=new N$8(t),this.sceneConfig=i,this.i=e,this.Ls=s,this.Fs=n,this.Is=r||{factor:0,units:0},this.s(),this.Rs=[]}render(t,i,e){this.Ps();const s=this.i.getMap();this.renderer.regl.clear({color:le$4,depth:1,stencil:255,framebuffer:this.Hs}),this.renderer.render(this.Ds,i,t,this.Hs);const n=this.i.getRenderer().canvas;this.Rs[0]=n.width,this.Rs[1]=n.height;const r=ht$5({colorRamp:this.Ns,inputTexture:this.Hs,projViewMatrix:s.projViewMatrix,textureOutputSize:this.Rs},i);this.p(),this.renderer.render(this.Gs,r,this.P,e)}dispose(){this.Ds&&(this.Ds.dispose(),delete this.Ds),this.Gs&&(this.Gs.dispose(),delete this.Gs),this.M&&(this.M.geometry.dispose(),this.M.dispose(),delete this.M,delete this.P),this.Hs&&(this.Hs.destroy(),delete this.Hs)}js(){const t=this.Ls;let i=this.Bs,e=this.Vs;e?e.clearRect(0,0,256,1):(i=this.Bs=document.createElement("canvas"),i.width=256,i.height=1,e=this.Vs=i.getContext("2d"));const s=e.createLinearGradient(0,0,256,1);for(let i=0;i<t.length;i++)s.addColorStop(t[i][0],t[i][1]);e.fillStyle=s,e.fillRect(0,0,256,1),this.Ns&&this.Ns.destroy();this.Ns=this.renderer.regl.texture({width:256,height:1,data:i,min:"linear",mag:"linear",premultiplyAlpha:!0})}Ps(){const t=this.i.getRenderer().canvas,i=Math.ceil(t.width/4),e=Math.ceil(t.height/4),s=this.Hs;s.width===i&&s.height===e||s.resize(i,e)}s(){this.js(),this.Us(),this.zs(),this.u()}u(){const t=new Ut$5;t.generateBuffers(this.renderer.regl),this.M=new ft$6(t),this.P=new yt$6([this.M])}p(){const t=this.i.getMap(),i=xt$5.getGroundTransform(this.M.localTransform,t);this.M.setLocalTransform(i)}zs(){const t=this.i.getRenderer().canvas,i=this.renderer.regl,e=i.hasExtension("OES_texture_half_float")?"half float":"float",s=Math.ceil(t.width/4),n=Math.ceil(t.height/4),r=i.texture({width:s,height:n,type:e,min:"linear",mag:"linear",format:"rgba"});this.Hs=i.framebuffer({width:s,height:n,color:[r]})}Us(){const t=this.i.getRenderer().canvas,i=this.sceneConfig.depthRange,e={viewport:{x:0,y:0,width:()=>t?Math.ceil(t.width/4):1,height:()=>t?Math.ceil(t.height/4):1},depth:{enable:!0,func:"always"}};this.Fs&&(e.stencil=this.Fs),this.Ds=new ke$4({extraCommandProps:e}),this.Gs=new Fe$4({x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},{extraCommandProps:{stencil:{enable:!1},depth:{enable:!0,range:i||[0,1],func:"<="},polygonOffset:{enable:!0,offset:this.Is},scissor:{enable:!1}}})}}const ue$4={"clip-inside":.1,"clip-outside":.2,"flat-inside":.3,"flat-outside":.4,color:.5};function fe$4(t){return class extends t{setMask(t){if(!t)return void this.Ws();const i=this.getRenderer(),e=this.getMap(),s=[];let h=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0,u=1/0;for(let i=0;i<t.length;i++){const n=t[i],r=n.polygons;for(let t=0;t<r.length;t++){const i=r[t],f=i.getCoordinates()[0].map((t=>de$4(e,t))),d=i.getSymbol(),{polygonFill:p,polygonOpacity:g}=d,m=ft$5([],p);m[3]=g||.6;const v={maskColor:m,position:f,maskMode:this.qs(n.mode),flatHeight:this.$s(n.flatHeight)||0,heightRange:n.heightRange?[this.$s(n.heightRange[0]),this.$s(n.heightRange[1])]:[0,0]};s.push(v);const w=i.getExtent();w.xmin<h&&(h=w.xmin),w.ymin<o&&(o=w.ymin),w.xmax>a&&(a=w.xmax),w.ymax>l&&(l=w.ymax),v.heightRange[0]<u&&(u=v.heightRange[0]),v.heightRange[1]>c&&(c=v.heightRange[1]),v.flatHeight<u&&(u=v.flatHeight),v.flatHeight>c&&(c=v.flatHeight)}}const{ratio:f,minHeight:d}=this.Xs(s,u,c),p=new t$2.Extent(h,o,a,l),{projViewMatrix:g,mapExtent:m}=this.Ys(p),v=de$4(e,new t$2.Coordinate(m.xmin,m.ymin)),w=de$4(e,new t$2.Coordinate(m.xmax,m.ymax)),b=[v[0],v[1],w[0],w[1]];i?i.setMask(s,b,g,f,d):this.once("renderercreate",(t=>{t.renderer.setMask(s,b,g,f,d)}))}Ws(){const t=this.getRenderer();t?t.clearMask():this.once("renderercreate",(t=>{t.renderer.clearMask()}))}Xs(t,i,e){const s=i,r=Math.abs(e-s);if(0===r)return{ratio:1,minHeight:0};const h=Math.pow(r,-1);for(let i=0;i<t.length;i++)t[i].flatHeight=(t[i].flatHeight-s)*h,t[i].heightRange[0]=(t[i].heightRange[0]-s)*h,t[i].heightRange[1]=(t[i].heightRange[1]-s)*h;return{ratio:h,minHeight:s}}Ys(t){const i=this.getMap(),e=i.getView(),s=i.getFitZoom(t),n=t.getCenter();i.setView({center:n,zoom:s,pitch:0,bearing:0});const r=i.getExtent(),o=copy$5([],i.projViewMatrix);return i.setView(e),{mapExtent:r,projViewMatrix:o}}qs(t){if(!ue$4[t])throw new Error("invalid mask mode type!");return ue$4[t]}$s(t=0){const i=this.getMap(),e=i.getGLRes();return i.altitudeToPoint(t,e)}}}function de$4(t,i,e=0){if(!(t&&i instanceof t$2.Coordinate))return null;const s=t.coordinateToPointAtRes(i,t.getGLRes());return[s.x,s.y,e]}function pe$4(t){return class extends t{clearMask(){delete this.Js.mask_colorExtent,delete this.Js.mask_extent,delete this.Js.mask_modeExtent,delete this.Js.mask_hasFlatOut,delete this.Js.mask_hasClipOut,delete this.Js.mask_heightRatio,delete this.Js.mask_heightOffset,this.Ks&&(this.Ks.dispose(),delete this.Ks),this.setToRedraw()}setMask(t,i,e,s,n){this.viewport||(this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1}),this.Ks?this.Zs(t,i,e,s,n):this.regl?(this.Ks=new xd(this.regl,this.viewport),this.Zs(t,i,e,s,n)):this.layer.once("contextcreate",(()=>{this.Ks=new xd(this.regl,this.viewport),this.Zs(t,i,e,s,n)}),this)}Zs(t,i,e,s,n){this.Ks.setExtentPositions(t);const{colorExtent:r,modeExtent:h}=this.Ks.render(e);this.Js=this.Js||{},this.Js.mask_colorExtent=r,this.Js.mask_extent=i,this.Js.mask_modeExtent=h,this.Js.mask_hasFlatOut=this.Qs(t,.4),this.Js.mask_hasClipOut=this.Qs(t,.2),this.Js.mask_heightRatio=s,this.Js.mask_heightOffset=n,this.setToRedraw()}Qs(t,i){for(let e=0;e<t.length;e++)if(t[e].maskMode===i)return 1;return 0}getMaskUniforms(){return this.Js}getMaskDefines(){return this.tn||(this.tn={}),this.Js&&this.Js.mask_colorExtent?this.tn.HAS_MASK_EXTENT=1:delete this.tn.HAS_MASK_EXTENT,this.tn}}}"undefined"!=typeof window&&window.maptalks&&(window.maptalks.GroupGLLayer=zi$3);const getGlobal=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},globals=getGlobal(),transcoders=globals.gl_trans__coders=globals.gl_trans__coders||{};transcoders.inject=function(chunk){const fnString=chunk.toString(),prefixIndex=fnString.indexOf("{")+1,prefix=fnString.substring(0,prefixIndex),transcoders=globals.gl_trans__coders=globals.gl_trans__coders||{};let injected=`${prefix}\n    const _____getGlobal = ${getGlobal.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const p in transcoders)"inject"!==p&&"getTranscoder"!==p&&"registerTranscoder"!==p&&(injected+='tran_____scoders["'+p+'"] ='+transcoders[p].toString()+"\n;");return injected+="\n"+fnString.substring(prefix.length),injected},transcoders.registerTranscoder=function(name,fn){transcoders[name]=fn},transcoders.getTranscoder=function(name){return transcoders[name]};let canvas;t__namespace.registerWorkerAdapter("@maptalks/terrain",'function(t){var r="undefined"!=typeof Float32Array?Float32Array:Array;function e(){var t=new r(3);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function i(t,e,i){var n=new r(3);return n[0]=t,n[1]=e,n[2]=i,n}function n(){var t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}e(),function(){var t,e=(t=new r(4),r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var s;e(),i(1,0,0),i(0,1,0),n(),n(),s=new r(9),r!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1;\n/*!\n   * @maptalks/gltf-loader v0.27.2\n   * LICENSE : UNLICENSED\n   * (c) 2016-2022 maptalks.org\n   */\nlet a=0;!function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}([]),"undefined"!=typeof TextDecoder&&new TextDecoder("utf-8");const o={get:function(t,r={}){r||(r={});const e=new AbortController,i=e.signal,n=function(t){for(let r=1;r<arguments.length;r++){const e=arguments[r];for(const r in e)t[r]=e[r]}return t}({},r);n.signal=i,n.method||(n.method="GET");const s=fetch(t,n).then(t=>{const e=this.U(t,r.responseType);return e.message?e:e.then(e=>"arraybuffer"===r.responseType?{data:e,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:e).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t})}).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t});return s.xhr=e,s},U:(t,r)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===r?t.arrayBuffer():"json"===r?t.json():t.text(),getArrayBuffer:(t,r={})=>(r||(r={}),r.responseType="arraybuffer",o.get(t,r)),getJSON:function(t,r={}){return r&&r.jsonp?o.jsonp(t):((r=r||{}).responseType="json",o.get(t,r))},jsonp:function(t){const r="_maptalks_jsonp_"+a++;t.match(/\\?/)?t+="&callback="+r:t+="?callback="+r;let e=document.createElement("script");return e.type="text/javascript",e.src=t,new Promise(t=>{window[r]=function(i){document.getElementsByTagName("head")[0].removeChild(e),e=null,delete window[r],t(i)},document.getElementsByTagName("head")[0].appendChild(e)})}};if("undefined"!=typeof TextDecoder&&new TextDecoder("utf-8"),"undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(t){}}"undefined"!=typeof document&&document.createElement("canvas"),function(){function t(t){throw t}var r=void 0,e=!0,i=this;function n(t,e){var n,s=t.split("."),a=i;!(s[0]in a)&&a.execScript&&a.execScript("var "+s[0]);for(;s.length&&(n=s.shift());)s.length||e===r?a=a[n]?a[n]:a[n]={}:a[n]=e}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function a(r,e){this.index="number"==typeof e?e:0,this.i=0,this.buffer=r instanceof(s?Uint8Array:Array)?r:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var t,r=this.buffer,e=r.length,i=new(s?Uint8Array:Array)(e<<1);if(s)i.set(r);else for(t=0;t<e;++t)i[t]=r[t];return this.buffer=i},a.prototype.d=function(t,r,e){var i,n=this.buffer,s=this.index,a=this.i,o=n[s];if(e&&1<r&&(t=8<r?(l[255&t]<<24|l[t>>>8&255]<<16|l[t>>>16&255]<<8|l[t>>>24&255])>>32-r:l[t]>>8-r),8>r+a)o=o<<r|t,a+=r;else for(i=0;i<r;++i)o=o<<1|t>>r-i-1&1,8==++a&&(a=0,n[s++]=l[o],o=0,s===n.length&&(n=this.f()));n[s]=o,this.buffer=n,this.i=a,this.index=s},a.prototype.finish=function(){var t,r=this.buffer,e=this.index;return 0<this.i&&(r[e]<<=8-this.i,r[e]=l[r[e]],e++),s?t=r.subarray(0,e):(r.length=e,t=r),t};var o,c=new(s?Uint8Array:Array)(256);for(o=0;256>o;++o){for(var h=u=o,f=7,u=u>>>1;u;u>>>=1)h<<=1,h|=1&u,--f;c[o]=(h<<f&255)>>>0}var l=c;function y(t){this.buffer=new(s?Uint16Array:Array)(2*t),this.length=0}function d(t){var r,e,i,n,a,o,c,h,f,u,l=t.length,y=0,d=Number.POSITIVE_INFINITY;for(h=0;h<l;++h)t[h]>y&&(y=t[h]),t[h]<d&&(d=t[h]);for(r=1<<y,e=new(s?Uint32Array:Array)(r),i=1,n=0,a=2;i<=y;){for(h=0;h<l;++h)if(t[h]===i){for(o=0,c=n,f=0;f<i;++f)o=o<<1|1&c,c>>=1;for(u=i<<16|h,f=o;f<r;f+=a)e[f]=u;++n}++i,n<<=1,a<<=1}return[e,y,d]}function A(t,r){this.h=p,this.w=0,this.input=s&&t instanceof Array?new Uint8Array(t):t,this.b=0,r&&(r.lazy&&(this.w=r.lazy),"number"==typeof r.compressionType&&(this.h=r.compressionType),r.outputBuffer&&(this.a=s&&r.outputBuffer instanceof Array?new Uint8Array(r.outputBuffer):r.outputBuffer),"number"==typeof r.outputIndex&&(this.b=r.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}y.prototype.getParent=function(t){return 2*((t-2)/4|0)},y.prototype.push=function(t,r){var e,i,n,s=this.buffer;for(e=this.length,s[this.length++]=r,s[this.length++]=t;0<e&&(i=this.getParent(e),s[e]>s[i]);)n=s[e],s[e]=s[i],s[i]=n,n=s[e+1],s[e+1]=s[i+1],s[i+1]=n,e=i;return this.length},y.prototype.pop=function(){var t,r,e,i,n,s=this.buffer;for(r=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],n=0;!((i=2*n+2)>=this.length)&&(i+2<this.length&&s[i+2]>s[i]&&(i+=2),s[i]>s[n]);)e=s[n],s[n]=s[i],s[i]=e,e=s[n+1],s[n+1]=s[i+1],s[i+1]=e,n=i;return{index:t,value:r,length:this.length}};var w,p=2,b={NONE:0,r:1,k:p,N:3},v=[];for(w=0;288>w;w++)switch(!0){case 143>=w:v.push([w+48,8]);break;case 255>=w:v.push([w-144+400,9]);break;case 279>=w:v.push([w-256+0,7]);break;case 287>=w:v.push([w-280+192,8]);break;default:t("invalid literal: "+w)}function k(t,r){this.length=t,this.G=r}A.prototype.j=function(){var i,n,o,c,h=this.input;switch(this.h){case 0:for(o=0,c=h.length;o<c;){var f,u,l,y=n=s?h.subarray(o,o+65535):h.slice(o,o+65535),d=(o+=n.length)===c,A=r,w=r,b=this.a,k=this.b;if(s){for(b=new Uint8Array(this.a.buffer);b.length<=k+y.length+5;)b=new Uint8Array(b.length<<1);b.set(this.a)}if(f=d?1:0,b[k++]=0|f,l=65536+~(u=y.length)&65535,b[k++]=255&u,b[k++]=u>>>8&255,b[k++]=255&l,b[k++]=l>>>8&255,s)b.set(y,k),k+=y.length,b=b.subarray(0,k);else{for(A=0,w=y.length;A<w;++A)b[k++]=y[A];b.length=k}this.b=k,this.a=b}break;case 1:var m=new a(s?new Uint8Array(this.a.buffer):this.a,this.b);m.d(1,1,e),m.d(1,2,e);var U,E,M,F=g(this,h);for(U=0,E=F.length;U<E;U++)if(M=F[U],a.prototype.d.apply(m,v[M]),256<M)m.d(F[++U],F[++U],e),m.d(F[++U],5),m.d(F[++U],F[++U],e);else if(256===M)break;this.a=m.finish(),this.b=this.a.length;break;case p:var D,z,q,C,N,O,S,j,I,W,Z,V,$,_,B,L=new a(s?new Uint8Array(this.a.buffer):this.a,this.b),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=Array(19);for(D=p,L.d(1,1,e),L.d(D,2,e),z=g(this,h),S=T(O=x(this.L,15)),I=T(j=x(this.K,7)),q=286;257<q&&0===O[q-1];q--);for(C=30;1<C&&0===j[C-1];C--);var H,R,Y,J,K,X,Q=q,tt=C,rt=new(s?Uint32Array:Array)(Q+tt),et=new(s?Uint32Array:Array)(316),it=new(s?Uint8Array:Array)(19);for(H=R=0;H<Q;H++)rt[R++]=O[H];for(H=0;H<tt;H++)rt[R++]=j[H];if(!s)for(H=0,J=it.length;H<J;++H)it[H]=0;for(H=K=0,J=rt.length;H<J;H+=R){for(R=1;H+R<J&&rt[H+R]===rt[H];++R);if(Y=R,0===rt[H])if(3>Y)for(;0<Y--;)et[K++]=0,it[0]++;else for(;0<Y;)(X=138>Y?Y:138)>Y-3&&X<Y&&(X=Y-3),10>=X?(et[K++]=17,et[K++]=X-3,it[17]++):(et[K++]=18,et[K++]=X-11,it[18]++),Y-=X;else if(et[K++]=rt[H],it[rt[H]]++,3>--Y)for(;0<Y--;)et[K++]=rt[H],it[rt[H]]++;else for(;0<Y;)(X=6>Y?Y:6)>Y-3&&X<Y&&(X=Y-3),et[K++]=16,et[K++]=X-3,it[16]++,Y-=X}for(i=s?et.subarray(0,K):et.slice(0,K),W=x(it,7),_=0;19>_;_++)G[_]=W[P[_]];for(N=19;4<N&&0===G[N-1];N--);for(Z=T(W),L.d(q-257,5,e),L.d(C-1,5,e),L.d(N-4,4,e),_=0;_<N;_++)L.d(G[_],3,e);for(_=0,B=i.length;_<B;_++)if(V=i[_],L.d(Z[V],W[V],e),16<=V){switch(_++,V){case 16:$=2;break;case 17:$=3;break;case 18:$=7;break;default:t("invalid code: "+V)}L.d(i[_],$,e)}var nt,st,at,ot,ct,ht,ft,ut,lt=[S,O],yt=[I,j];for(ct=lt[0],ht=lt[1],ft=yt[0],ut=yt[1],nt=0,st=z.length;nt<st;++nt)if(at=z[nt],L.d(ct[at],ht[at],e),256<at)L.d(z[++nt],z[++nt],e),ot=z[++nt],L.d(ft[ot],ut[ot],e),L.d(z[++nt],z[++nt],e);else if(256===at)break;this.a=L.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var m=function(){function r(r){switch(!0){case 3===r:return[257,r-3,0];case 4===r:return[258,r-4,0];case 5===r:return[259,r-5,0];case 6===r:return[260,r-6,0];case 7===r:return[261,r-7,0];case 8===r:return[262,r-8,0];case 9===r:return[263,r-9,0];case 10===r:return[264,r-10,0];case 12>=r:return[265,r-11,1];case 14>=r:return[266,r-13,1];case 16>=r:return[267,r-15,1];case 18>=r:return[268,r-17,1];case 22>=r:return[269,r-19,2];case 26>=r:return[270,r-23,2];case 30>=r:return[271,r-27,2];case 34>=r:return[272,r-31,2];case 42>=r:return[273,r-35,3];case 50>=r:return[274,r-43,3];case 58>=r:return[275,r-51,3];case 66>=r:return[276,r-59,3];case 82>=r:return[277,r-67,4];case 98>=r:return[278,r-83,4];case 114>=r:return[279,r-99,4];case 130>=r:return[280,r-115,4];case 162>=r:return[281,r-131,5];case 194>=r:return[282,r-163,5];case 226>=r:return[283,r-195,5];case 257>=r:return[284,r-227,5];case 258===r:return[285,r-258,0];default:t("invalid length: "+r)}}var e,i,n=[];for(e=3;258>=e;e++)i=r(e),n[e]=i[2]<<24|i[1]<<16|i[0];return n}(),U=s?new Uint32Array(m):m;function g(e,i){function n(r,e){var i,n,s,a,o=r.G,c=[],h=0;switch(i=U[r.length],c[h++]=65535&i,c[h++]=i>>16&255,c[h++]=i>>24,!0){case 1===o:n=[0,o-1,0];break;case 2===o:n=[1,o-2,0];break;case 3===o:n=[2,o-3,0];break;case 4===o:n=[3,o-4,0];break;case 6>=o:n=[4,o-5,1];break;case 8>=o:n=[5,o-7,1];break;case 12>=o:n=[6,o-9,2];break;case 16>=o:n=[7,o-13,2];break;case 24>=o:n=[8,o-17,3];break;case 32>=o:n=[9,o-25,3];break;case 48>=o:n=[10,o-33,4];break;case 64>=o:n=[11,o-49,4];break;case 96>=o:n=[12,o-65,5];break;case 128>=o:n=[13,o-97,5];break;case 192>=o:n=[14,o-129,6];break;case 256>=o:n=[15,o-193,6];break;case 384>=o:n=[16,o-257,7];break;case 512>=o:n=[17,o-385,7];break;case 768>=o:n=[18,o-513,8];break;case 1024>=o:n=[19,o-769,8];break;case 1536>=o:n=[20,o-1025,9];break;case 2048>=o:n=[21,o-1537,9];break;case 3072>=o:n=[22,o-2049,10];break;case 4096>=o:n=[23,o-3073,10];break;case 6144>=o:n=[24,o-4097,11];break;case 8192>=o:n=[25,o-6145,11];break;case 12288>=o:n=[26,o-8193,12];break;case 16384>=o:n=[27,o-12289,12];break;case 24576>=o:n=[28,o-16385,13];break;case 32768>=o:n=[29,o-24577,13];break;default:t("invalid distance")}for(i=n,c[h++]=i[0],c[h++]=i[1],c[h++]=i[2],s=0,a=c.length;s<a;++s)w[p++]=c[s];v[c[0]]++,k[c[3]]++,b=r.length+e-1,y=null}var a,o,c,h,f,u,l,y,d,A={},w=s?new Uint16Array(2*i.length):[],p=0,b=0,v=new(s?Uint32Array:Array)(286),k=new(s?Uint32Array:Array)(30),m=e.w;if(!s){for(c=0;285>=c;)v[c++]=0;for(c=0;29>=c;)k[c++]=0}for(v[256]=1,a=0,o=i.length;a<o;++a){for(c=f=0,h=3;c<h&&a+c!==o;++c)f=f<<8|i[a+c];if(A[f]===r&&(A[f]=[]),u=A[f],!(0<b--)){for(;0<u.length&&32768<a-u[0];)u.shift();if(a+3>=o){for(y&&n(y,-1),c=0,h=o-a;c<h;++c)d=i[a+c],w[p++]=d,++v[d];break}0<u.length?(l=E(i,a,u),y?y.length<l.length?(d=i[a-1],w[p++]=d,++v[d],n(l,0)):n(y,-1):l.length<m?y=l:n(l,0)):y?n(y,-1):(d=i[a],w[p++]=d,++v[d])}u.push(a)}return w[p++]=256,v[256]++,e.L=v,e.K=k,s?w.subarray(0,p):w}function E(t,r,e){var i,n,s,a,o,c,h=0,f=t.length;a=0,c=e.length;t:for(;a<c;a++){if(i=e[c-a-1],s=3,3<h){for(o=h;3<o;o--)if(t[i+o-1]!==t[r+o-1])continue t;s=h}for(;258>s&&r+s<f&&t[i+s]===t[r+s];)++s;if(s>h&&(n=i,h=s),258===s)break}return new k(h,r-n)}function x(t,r){var e,i,n,a,o,c=t.length,h=new y(572),f=new(s?Uint8Array:Array)(c);if(!s)for(a=0;a<c;a++)f[a]=0;for(a=0;a<c;++a)0<t[a]&&h.push(a,t[a]);if(e=Array(h.length/2),i=new(s?Uint32Array:Array)(h.length/2),1===e.length)return f[h.pop().index]=1,f;for(a=0,o=h.length/2;a<o;++a)e[a]=h.pop(),i[a]=e[a].value;for(n=function(t,r,e){function i(t){var e=d[t][A[t]];e===r?(i(t+1),i(t+1)):--l[e],++A[t]}var n,a,o,c,h,f=new(s?Uint16Array:Array)(e),u=new(s?Uint8Array:Array)(e),l=new(s?Uint8Array:Array)(r),y=Array(e),d=Array(e),A=Array(e),w=(1<<e)-r,p=1<<e-1;for(f[e-1]=r,a=0;a<e;++a)w<p?u[a]=0:(u[a]=1,w-=p),w<<=1,f[e-2-a]=(f[e-1-a]/2|0)+r;for(f[0]=u[0],y[0]=Array(f[0]),d[0]=Array(f[0]),a=1;a<e;++a)f[a]>2*f[a-1]+u[a]&&(f[a]=2*f[a-1]+u[a]),y[a]=Array(f[a]),d[a]=Array(f[a]);for(n=0;n<r;++n)l[n]=e;for(o=0;o<f[e-1];++o)y[e-1][o]=t[o],d[e-1][o]=o;for(n=0;n<e;++n)A[n]=0;for(1===u[e-1]&&(--l[0],++A[e-1]),a=e-2;0<=a;--a){for(c=n=0,h=A[a+1],o=0;o<f[a];o++)(c=y[a+1][h]+y[a+1][h+1])>t[n]?(y[a][o]=c,d[a][o]=r,h+=2):(y[a][o]=t[n],d[a][o]=n,++n);A[a]=0,1===u[a]&&i(a)}return l}(i,i.length,r),a=0,o=e.length;a<o;++a)f[e[a].index]=n[a];return f}function T(t){var r,e,i,n,a=new(s?Uint16Array:Array)(t.length),o=[],c=[],h=0;for(r=0,e=t.length;r<e;r++)o[t[r]]=1+(0|o[t[r]]);for(r=1,e=16;r<=e;r++)c[r]=h,h+=0|o[r],h<<=1;for(r=0,e=t.length;r<e;r++)for(h=c[t[r]],c[t[r]]+=1,i=a[r]=0,n=t[r];i<n;i++)a[r]=a[r]<<1|1&h,h>>>=1;return a}function M(r,e){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(r):r,this.s=!1,this.n=D,this.B=!1,!e&&(e={})||(e.index&&(this.c=e.index),e.bufferSize&&(this.m=e.bufferSize),e.bufferType&&(this.n=e.bufferType),e.resize&&(this.B=e.resize)),this.n){case F:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.m+258);break;case D:this.b=0,this.a=new(s?Uint8Array:Array)(this.m),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}var F=0,D=1,z={D:F,C:D};M.prototype.p=function(){for(;!this.s;){var i=Y(this,3);switch(1&i&&(this.s=e),i>>>=1){case 0:var n=this.input,a=this.c,o=this.a,c=this.b,h=n.length,f=r,u=o.length,l=r;switch(this.e=this.g=0,a+1>=h&&t(Error("invalid uncompressed block header: LEN")),f=n[a++]|n[a++]<<8,a+1>=h&&t(Error("invalid uncompressed block header: NLEN")),f===~(n[a++]|n[a++]<<8)&&t(Error("invalid uncompressed block header: length verify")),a+f>n.length&&t(Error("input buffer is broken")),this.n){case F:for(;c+f>o.length;){if(f-=l=u-c,s)o.set(n.subarray(a,a+l),c),c+=l,a+=l;else for(;l--;)o[c++]=n[a++];this.b=c,o=this.f(),c=this.b}break;case D:for(;c+f>o.length;)o=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(s)o.set(n.subarray(a,a+f),c),c+=f,a+=f;else for(;f--;)o[c++]=n[a++];this.c=a,this.b=c,this.a=o;break;case 1:this.o(G,R);break;case 2:var y,A,w,p,b=Y(this,5)+257,v=Y(this,5)+1,k=Y(this,4)+4,m=new(s?Uint8Array:Array)(O.length),U=r,g=r,E=r,x=r,T=r;for(T=0;T<k;++T)m[O[T]]=Y(this,3);if(!s)for(T=k,k=m.length;T<k;++T)m[O[T]]=0;for(y=d(m),U=new(s?Uint8Array:Array)(b+v),T=0,p=b+v;T<p;)switch(g=J(this,y),g){case 16:for(x=3+Y(this,2);x--;)U[T++]=E;break;case 17:for(x=3+Y(this,3);x--;)U[T++]=0;E=0;break;case 18:for(x=11+Y(this,7);x--;)U[T++]=0;E=0;break;default:E=U[T++]=g}A=d(s?U.subarray(0,b):U.slice(0,b)),w=d(s?U.subarray(b):U.slice(b)),this.o(A,w);break;default:t(Error("unknown BTYPE: "+i))}}return this.t()};var q,C,N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=s?new Uint16Array(N):N,S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],j=s?new Uint16Array(S):S,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],W=s?new Uint8Array(I):I,Z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],V=s?new Uint16Array(Z):Z,$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_=s?new Uint8Array($):$,B=new(s?Uint8Array:Array)(288);for(q=0,C=B.length;q<C;++q)B[q]=143>=q?8:255>=q?9:279>=q?7:8;var L,P,G=d(B),H=new(s?Uint8Array:Array)(30);for(L=0,P=H.length;L<P;++L)H[L]=5;var R=d(H);function Y(r,e){for(var i,n=r.g,s=r.e,a=r.input,o=r.c,c=a.length;s<e;)o>=c&&t(Error("input buffer is broken")),n|=a[o++]<<s,s+=8;return i=n&(1<<e)-1,r.g=n>>>e,r.e=s-e,r.c=o,i}function J(r,e){for(var i,n,s=r.g,a=r.e,o=r.input,c=r.c,h=o.length,f=e[0],u=e[1];a<u&&!(c>=h);)s|=o[c++]<<a,a+=8;return(n=(i=f[s&(1<<u)-1])>>>16)>a&&t(Error("invalid code length: "+n)),r.g=s>>n,r.e=a-n,r.c=c,65535&i}function K(t){if("string"==typeof t){var r,e,i=t.split("");for(r=0,e=i.length;r<e;r++)i[r]=(255&i[r].charCodeAt(0))>>>0;t=i}for(var n,s=1,a=0,o=t.length,c=0;0<o;){o-=n=1024<o?1024:o;do{a+=s+=t[c++]}while(--n);s%=65521,a%=65521}return(a<<16|s)>>>0}function X(r,e){var i,n;switch(this.input=r,this.c=0,!e&&(e={})||(e.index&&(this.c=e.index),e.verify&&(this.M=e.verify)),i=r[this.c++],n=r[this.c++],15&i){case Q:this.method=Q;break;default:t(Error("unsupported compression method"))}0!=((i<<8)+n)%31&&t(Error("invalid fcheck flag:"+((i<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.A=new M(r,{index:this.c,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}M.prototype.o=function(t,r){var e=this.a,i=this.b;this.u=t;for(var n,s,a,o,c=e.length-258;256!==(n=J(this,t));)if(256>n)i>=c&&(this.b=i,e=this.f(),i=this.b),e[i++]=n;else for(o=j[s=n-257],0<W[s]&&(o+=Y(this,W[s])),n=J(this,r),a=V[n],0<_[n]&&(a+=Y(this,_[n])),i>=c&&(this.b=i,e=this.f(),i=this.b);o--;)e[i]=e[i++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},M.prototype.I=function(t,r){var e=this.a,i=this.b;this.u=t;for(var n,s,a,o,c=e.length;256!==(n=J(this,t));)if(256>n)i>=c&&(c=(e=this.f()).length),e[i++]=n;else for(o=j[s=n-257],0<W[s]&&(o+=Y(this,W[s])),n=J(this,r),a=V[n],0<_[n]&&(a+=Y(this,_[n])),i+o>c&&(c=(e=this.f()).length);o--;)e[i]=e[i++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},M.prototype.f=function(){var t,r,e=new(s?Uint8Array:Array)(this.b-32768),i=this.b-32768,n=this.a;if(s)e.set(n.subarray(32768,e.length));else for(t=0,r=e.length;t<r;++t)e[t]=n[t+32768];if(this.l.push(e),this.q+=e.length,s)n.set(n.subarray(i,i+32768));else for(t=0;32768>t;++t)n[t]=n[i+t];return this.b=32768,n},M.prototype.J=function(t){var r,e,i,n=this.input.length/this.c+1|0,a=this.input,o=this.a;return t&&("number"==typeof t.v&&(n=t.v),"number"==typeof t.F&&(n+=t.F)),2>n?e=(i=(a.length-this.c)/this.u[2]/2*258|0)<o.length?o.length+i:o.length<<1:e=o.length*n,s?(r=new Uint8Array(e)).set(o):r=o,this.a=r},M.prototype.t=function(){var t,r,e,i,n,a=0,o=this.a,c=this.l,h=new(s?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(r=0,e=c.length;r<e;++r)for(i=0,n=(t=c[r]).length;i<n;++i)h[a++]=t[i];for(r=32768,e=this.b;r<e;++r)h[a++]=o[r];return this.l=[],this.buffer=h},M.prototype.H=function(){var t,r=this.b;return s?this.B?(t=new Uint8Array(r)).set(this.a.subarray(0,r)):t=this.a.subarray(0,r):(this.a.length>r&&(this.a.length=r),t=this.a),this.buffer=t},X.prototype.p=function(){var r,e=this.input;return r=this.A.p(),this.c=this.A.c,this.M&&((e[this.c++]<<24|e[this.c++]<<16|e[this.c++]<<8|e[this.c++])>>>0!==K(r)&&t(Error("invalid adler-32 checksum"))),r};var Q=8;function tt(t,r){this.input=t,this.a=new(s?Uint8Array:Array)(32768),this.h=rt.k;var e,i={};for(e in!r&&(r={})||"number"!=typeof r.compressionType||(this.h=r.compressionType),r)i[e]=r[e];i.outputBuffer=this.a,this.z=new A(this.input,i)}var rt=b;function et(t,r){var e,i,s,a;if(Object.keys)e=Object.keys(r);else for(i in e=[],s=0,r)e[s++]=i;for(s=0,a=e.length;s<a;++s)n(t+"."+(i=e[s]),r[i])}tt.prototype.j=function(){var r,e,i,n,a,o,c,h=0;switch(c=this.a,r=Q){case Q:e=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(i=e<<4|r,c[h++]=i,r){case Q:switch(this.h){case rt.NONE:a=0;break;case rt.r:a=1;break;case rt.k:a=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return n=a<<6|0,c[h++]=n|31-(256*i+n)%31,o=K(this.input),this.z.b=h,h=(c=this.z.j()).length,s&&((c=new Uint8Array(c.buffer)).length<=h+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,h+4)),c[h++]=o>>24&255,c[h++]=o>>16&255,c[h++]=o>>8&255,c[h++]=255&o,c},n("Zlib.Inflate",X),n("Zlib.Inflate.prototype.decompress",X.prototype.p),et("Zlib.Inflate.BufferType",{ADAPTIVE:z.C,BLOCK:z.D}),n("Zlib.Deflate",tt),n("Zlib.Deflate.compress",(function(t,r){return new tt(t,r).j()})),n("Zlib.Deflate.prototype.compress",tt.prototype.j),et("Zlib.Deflate.CompressionType",{NONE:rt.NONE,FIXED:rt.r,DYNAMIC:rt.k})}.call(self);class c{constructor(t=257){this.gridSize=t;const r=t-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=r*r*2-2,this.numParentTriangles=this.numTriangles-r*r,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let t=0;t<this.numTriangles;t++){let e=t+2,i=0,n=0,s=0,a=0,o=0,c=0;for(1&e?s=a=o=r:i=n=c=r;(e>>=1)>1;){const t=i+s>>1,r=n+a>>1;1&e?(s=i,a=n,i=o,n=c):(i=s,n=a,s=o,a=c),o=t,c=r}const h=4*t;this.coords[h+0]=i,this.coords[h+1]=n,this.coords[h+2]=s,this.coords[h+3]=a}}createTile(t){return new h(t,this)}}class h{constructor(t,r){const e=r.gridSize;if(t.length!==e*e)throw new Error(`Expected terrain data of length ${e*e} (${e} x ${e}), got ${t.length}.`);this.terrain=t,this.martini=r,this.errors=new Float32Array(t.length),this.update()}update(){const{numTriangles:t,numParentTriangles:r,coords:e,gridSize:i}=this.martini,{terrain:n,errors:s}=this;for(let a=t-1;a>=0;a--){const t=4*a,o=e[t+0],c=e[t+1],h=e[t+2],f=e[t+3],u=o+h>>1,l=c+f>>1,y=u+l-c,d=l+o-u,A=(n[c*i+o]+n[f*i+h])/2,w=l*i+u,p=Math.abs(A-n[w]);if(s[w]=Math.max(s[w],p),a<r){const t=(c+d>>1)*i+(o+y>>1),r=(f+d>>1)*i+(h+y>>1);s[w]=Math.max(s[w],s[t],s[r])}}}getMesh(t=0){const{gridSize:r,indices:e}=this.martini,{errors:i}=this;let n=0,s=0;const a=r-1;function o(a,c,h,f,u,l){const y=a+h>>1,d=c+f>>1;Math.abs(a-u)+Math.abs(c-l)>1&&i[d*r+y]>t?(o(u,l,a,c,y,d),o(h,f,u,l,y,d)):(e[c*r+a]=e[c*r+a]||++n,e[f*r+h]=e[f*r+h]||++n,e[l*r+u]=e[l*r+u]||++n,s++)}e.fill(0),o(0,0,a,a,a,0),o(a,a,0,0,0,a);const c=new Uint16Array(2*n),h=new Uint32Array(3*s);let f=0;function u(n,s,a,o,l,y){const d=n+a>>1,A=s+o>>1;if(Math.abs(n-l)+Math.abs(s-y)>1&&i[A*r+d]>t)u(l,y,n,s,d,A),u(a,o,l,y,d,A);else{const t=e[s*r+n]-1,i=e[o*r+a]-1,u=e[y*r+l]-1;c[2*t]=n,c[2*t+1]=s,c[2*i]=a,c[2*i+1]=o,c[2*u]=l,c[2*u+1]=y,h[f++]=t,h[f++]=i,h[f++]=u}}return u(0,0,a,a,a,0),u(a,a,0,0,0,a),{vertices:c,triangles:h}}getMeshWithSkirts(t=0){const{gridSize:r,indices:e}=this.martini,{errors:i}=this;let n=0,s=0;const a=r-1;let o,c,h=0;const f=[],u=[],l=[],y=[];function d(A,w,p,b,v,k){const m=A+p>>1,U=w+b>>1;Math.abs(A-v)+Math.abs(w-k)>1&&i[U*r+m]>t?(d(v,k,A,w,m,U),d(p,b,v,k,m,U)):(o=w*r+A,c=b*r+p,h=k*r+v,0===e[o]&&(0===A?f.push(n):A===a&&u.push(n),0===w?l.push(n):w===a&&y.push(n),e[o]=++n),0===e[c]&&(0===p?f.push(n):p===a&&u.push(n),0===b?l.push(n):b===a&&y.push(n),e[c]=++n),0===e[h]&&(0===v?f.push(n):v===a&&u.push(n),0===k?l.push(n):k===a&&y.push(n),e[h]=++n),s++)}e.fill(0),d(0,0,a,a,a,0),d(a,a,0,0,0,a);const A=2*(n+f.length+u.length+l.length+y.length),w=3*(s+2*(f.length-1)+2*(u.length-1)+2*(l.length-1)+2*(y.length-1)),p=new Uint16Array(A),b=new Uint32Array(w);let v=0;function k(n,s,a,o,c,h){const f=n+a>>1,u=s+o>>1;if(Math.abs(n-c)+Math.abs(s-h)>1&&i[u*r+f]>t)k(c,h,n,s,f,u),k(a,o,c,h,f,u);else{const t=e[s*r+n]-1,i=e[o*r+a]-1,f=e[h*r+c]-1;p[2*t]=n,p[2*t+1]=s,p[2*i]=a,p[2*i+1]=o,p[2*f]=c,p[2*f+1]=h,b[v++]=t,b[v++]=i,b[v++]=f}}k(0,0,a,a,a,0),k(a,a,0,0,0,a),f.sort((t,r)=>p[2*t+1]-p[2*r+1]),u.sort((t,r)=>p[2*r+1]-p[2*t+1]),l.sort((t,r)=>p[2*r]-p[2*t]),y.sort((t,r)=>p[2*t]-p[2*r]);let m,U,g,E,x=2*n,T=0;function M(t){T=t.length;for(let r=0;r<T-1;r++)m=t[r],U=t[r+1],g=x/2,E=(x+2)/2,p[x++]=p[2*m],p[x++]=p[2*m+1],b[v++]=m,b[v++]=g,b[v++]=U,b[v++]=g,b[v++]=E,b[v++]=U;p[x++]=p[2*t[T-1]],p[x++]=p[2*t[T-1]+1]}return M(f),M(u),M(l),M(y),{vertices:p,triangles:b,numVerticesWithoutSkirts:n,numTrianglesWithoutSkirts:s}}}let f,u=null,l=null;const y={},d=64,A=64,w=3,p=-1e3,b=.001,v=256,k=4,m=.002,U={cesium_request_token:{Accept:"application/json,*/*;q=0.01","Accept-Encoding":"gzip, deflate, br"},tianditu:{"Accept-Encoding":"gzip, deflate, br"},cesium:{"Accept-Encoding":"gzip, deflate, br",Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"},mapbox:{Accept:"image/webp,*/*"}};let g=null;function E(t){const r=new DataView(t),e=new Uint8Array(r.byteLength);let i=0;for(;i<r.byteLength;)e[i]=r.getUint8(i,!0),i++;return function(t){const r=d,e=A,i=r+1,n=e+1,s=w,a=p,o=b,c=v,h=m,f=new Float32Array(i*n);let u=0;for(let l=0;l<i;l++){const i=l>=e?e-1:l;for(let e=0;e<n;e++){let n=0;const l=i*(4*r)+4*(e>=r?r-1:e);for(let r=0;r<s;r++)n=n*c+t[l+r];n=1*(n*o+a),n-=h,f[u]=n,u++}}return f}(function(t){const r=t,e=d,i=A,n=new Uint8Array(e*i*k);let s,a,o,c,h;for(let t=0;t<i;t++)for(let f=0;f<e;f++){c=parseInt(149*t/(i-1)),h=parseInt(149*f/(e-1)),a=2*(150*c+h),s=r[a]+256*r[a+1],(s>1e4||s<-2e3)&&(s=0),o=4*(t*e+f);const u=(s+1e3)/b,l=v;n[o]=u/(l*l),n[o+1]=(u-n[o]*l*l)/l,n[o+2]=u-n[o]*l*l-n[o+1]*l,n[o+3]=255}return n}(function(t){if(t.length<1e3)return;const r=new Zlib.Inflate(t);return r?r.decompress():void 0}(e)))}function x(t){return t>>1^-(1&t)}function T(t){let r=0;const e=3*Float64Array.BYTES_PER_ELEMENT,i=4*Float64Array.BYTES_PER_ELEMENT,n=3*Uint16Array.BYTES_PER_ELEMENT;let s=Uint16Array.BYTES_PER_ELEMENT;const a=new DataView(t);r+=e;const o=a.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT;const c=a.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT,r+=i,r+=e;const h=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const f=new Uint16Array(t,r,3*h);r+=h*n,h>65536&&(s=Uint32Array.BYTES_PER_ELEMENT);!function(t,r,e){const i=t.length;let n=0,s=0,a=0;for(let o=0;o<i;++o)n+=x(t[o]),s+=x(r[o]),t[o]=n,r[o]=s,e&&(a+=x(e[o]),e[o]=a)}(f.subarray(0,h),f.subarray(h,2*h),f.subarray(2*h,3*h)),r%s!=0&&(r+=s-r%s);const u=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const l=h>65536?new Uint32Array(t,r,3*u):new Uint16Array(t,r,3*u);let y=0;const d=l.length;for(let t=0;t<d;++t){const r=l[t];l[t]=y-r,0===r&&++y}const A={minimumHeight:o,maximumHeight:c,quantizedVertices:f,indices:l}.quantizedVertices,w=A.length/3,p=A.subarray(0,w),b=A.subarray(w,2*w),v=A.subarray(2*w,3*w),k=new Float32Array(3*w),m=new Float32Array(2*w);for(let t=0;t<w;++t){const r=p[t]/32767,e=b[t]/32767,i=(U=o,g=c,(1-(E=v[t]/32767))*U+E*g);m[2*t]=r,m[2*t+1]=1-e,k[3*t]=256*r,k[3*t+1]=256*-(1-e),k[3*t+2]=i}var U,g,E;return{positions:k,texcoords:m,triangles:l}}function M(t,r,e,i,n,s,a){"cesium"===e&&(r={"Accept-Encoding":"gzip, deflate, br",Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01",Authorization:"Bearer "+g}),function(t,r,e){const i={method:"GET",referrer:e,headers:r},n=o.getArrayBuffer(t,i),s=n.xhr;return y[t]=s,n.then(r=>(delete y[t],r))}(t,r,origin).then(t=>{if(!t||t.message)a({error:t||{canceled:!0}});else{const r=t.data;let o=null;if("tianditu"===e){o=E(r);const e=z(n,o,i);t.transferables.push(e.positions.buffer,e.texcoords.buffer,e.triangles.buffer),a({data:o,mesh:e},t.transferables)}else if("cesium"===e){o=T(r);const t=[o.positions.buffer,o.texcoords.buffer,o.triangles.buffer];a(o,t)}else"mapbox"===e&&(o=function(t){const r=new self.Blob([new Uint8Array(t)],{type:"image/png"});return self.createImageBitmap(r)}(r),o.then(t=>{const r=function(t){const{width:r,height:e}=t;u||(u=new OffscreenCanvas(1,1),l=u.getContext("2d",{willReadFrequently:!0}));return u.width=r,u.height=e,l.drawImage(t,0,0,r,e),l.getImageData(0,0,r,e)}(t),e=D(r,i);F(n,e,i,s,r,!0,a)}))}}).catch(r=>{delete y[t],a({error:r})})}function F(t,r,e,i,n,s,a){const o=z(t,r.data,e),c=[o.positions.buffer,o.texcoords.buffer,o.triangles.buffer],h={mesh:o};if(s)if(h.data=r,i){const t=D(n,n.width+1);h.data=t,c.push(t.data.buffer)}else c.push(r.data.buffer);a(h,c)}function D(t,r){const{data:e,width:i}=t;let n=1/0,s=-1/0;const a=new Float32Array(r*r),o=Math.round(i/r),c=r-1-1;for(let t=0;t<r;t++)for(let h=0;h<r;h++){const f=t+h*r;let u=0,l=0,y=t,d=h;y>=c&&(y=c),d>=c&&(d=c);for(let t=0;t<o;t++)for(let r=0;r<o;r++){const n=y*o+t+(d*o+r)*i,s=e[4*n],a=e[4*n+1],c=e[4*n+2];0===e[4*n+3]?l+=1:u+=.1*(256*s*256+256*a+c)-1e4}u/=o*o-l||1,u>s&&(s=u),u<n&&(n=u),a[f]=u}return{data:a,width:r,height:r,min:n,max:s}}function z(t,r,e){const i=new c(e).createTile(r).getMeshWithSkirts(t),{triangles:n,vertices:s,numVerticesWithoutSkirts:a,numTrianglesWithoutSkirts:o}=i,h=[],f=[];for(let t=0;t<s.length/2;t++){const i=s[2*t],n=s[2*t+1];h.push(1*i),h.push(1*-n),t>=a?h.push(0):h.push(r[n*e+i]),f.push(i/e),f.push(n/e)}return{positions:new Float32Array(h),texcoords:new Float32Array(f),triangles:n,numTrianglesWithoutSkirts:o}}const q={};t.initialize=function(){},t.onmessage=function(t,r){const e=t.data;if("addLayer"===e.command||"removeLayer"===e.command)f=t.workerId,self.postMessage({type:"<response>",actorId:e.actorId,workerId:f,params:"ok",callback:t.callback});else if("createTerrainMesh"===e.command){const{error:t,terrainHeights:i,terrainWidth:n}=e.params;let s=i;i.width!==n&&(s=function(t,r){const{data:e,width:i}=t,n=q[r]=q[r]||new Float32Array(r*r);let s=1/0,a=-1/0;const o=i>r?Math.round(i/r):Math.round(r/i),c=r-1;for(let t=0;t<r;t++)for(let h=0;h<r;h++){const f=t+h*r;let u=0,l=t,y=h;if(l>=c&&(l=c),y>=c&&(y=c),i>r){for(let t=0;t<o;t++)for(let r=0;r<o;r++){u+=e[l*o+t+(y*o+r)*i]}u/=o*o||1}else{u=e[Math.floor(l/o)+Math.floor(y/o)*i]}u>a&&(a=u),u<s&&(s=u),n[f]=u}return{data:n,width:r,height:r,min:s,max:a}}(i,n)),F(t,s,n,null,null,!1,(t,e)=>{t.data=i,e.push(i.data.buffer),r(t.error,t,e)})}else"fetchTerrain"===e.command?function(t,r){const{url:e,origin:i,type:n,accessToken:s,terrainWidth:a,error:o,maxAvailable:c}=t,h=t.headers||U[n];if("tianditu"===n)M(e,h,n,a,o,c,r);else if("cesium"===n){const t="https://api.cesium.com/v1/assets/1/endpoint?access_token="+s;g?M(e,h,n,a,o,c,r):fetch(t,{responseType:"json",method:"GET",referrer:i,headers:{Accept:"application/json,*/*;q=0.01","Accept-Encoding":"gzip, deflate, br"}}).then(t=>t.json()).then(t=>{g=t.accessToken,M(e,h,n,a,o,c,r)})}else"mapbox"===n&&M(e,h,n,a,o,c,r)}(e.params,(t,e)=>{r(t.error,t,e)}):"abortTerrain"===e.command&&(i=e.params.url,y[i]&&(y[i].abort(),delete y[i]));var i}}'),"undefined"!=typeof console&&console.log("@maptalks/gl v0.81.4");const OPTIONS={width:100,height:10};function getCanvas(){if(!canvas){const{width,height}=OPTIONS;OffscreenCanvas?canvas=new OffscreenCanvas(width,height):(canvas=document.createElement("canvas"),canvas.width=width,canvas.height=height)}return canvas}class ColorIn{constructor(colors,options={}){if(!Array.isArray(colors))return void console.error("colors is not array");if(colors.length<2)return void console.error("colors.length should >1");this.colors=colors;let min=1/0,max=-1/0;for(let i=0,len=colors.length;i<len;i++){const value=colors[i][0];min=Math.min(value,min),max=Math.max(value,max)}this.min=min,this.max=max,this.valueOffset=this.max-this.min,this.options=Object.assign({},OPTIONS,options),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const canvas=getCanvas(),{width,height}=this.options;canvas.width=width,canvas.height=height;const ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);const gradient=ctx.createLinearGradient(0,0,canvas.width,0),{colors,valueOffset}=this;for(let i=0,len=colors.length;i<len;i++){const[stop,color]=colors[i];gradient.addColorStop((stop-this.min)/valueOffset,color)}ctx.fillStyle=gradient,ctx.fillRect(0,0,canvas.width,canvas.height),this.imgData=ctx.getImageData(0,0,canvas.width,canvas.height)}getColor(stop){stop=Math.max(this.min,stop),stop=Math.min(stop,this.max);let x=Math.round((stop-this.min)/this.valueOffset*this.imgData.width);x=Math.min(x,this.imgData.width-1);const idx=4*x;return[this.imgData.data[idx],this.imgData.data[idx+1],this.imgData.data[idx+2],this.imgData.data[idx+3]]}}var colorInCache;function createFunction(parameters,defaultType){var fun,isFeatureConstant,isZoomConstant;if(isFunctionDefinition(parameters)){var innerFun,zoomAndFeatureDependent=parameters.stops&&"object"==typeof parameters.stops[0][0],zoomDependent=zoomAndFeatureDependent||!(zoomAndFeatureDependent||void 0!==parameters.property),type=parameters.type||defaultType||"exponential";if("exponential"===type)innerFun=evaluateExponentialFunction;else if("interval"===type)innerFun=evaluateIntervalFunction;else if("categorical"===type)innerFun=evaluateCategoricalFunction;else if("identity"===type)innerFun=evaluateIdentityFunction;else{if("color-interpolate"!==type)throw new Error('Unknown function type "'+type+'"');innerFun=evaluateColorInterpolateFunction}if(zoomAndFeatureDependent){var featureFunctions={},featureFunctionStops=[];for(let s=0;s<parameters.stops.length;s++){var stop=parameters.stops[s];void 0===featureFunctions[stop[0].zoom]&&(featureFunctions[stop[0].zoom]={zoom:stop[0].zoom,type:parameters.type,property:parameters.property,default:parameters.default,stops:[]}),featureFunctions[stop[0].zoom].stops.push([stop[0].value,stop[1]])}for(let z in featureFunctions)featureFunctionStops.push([featureFunctions[z].zoom,createFunction(featureFunctions[z])]);fun=function(zoom,feature){const value=evaluateExponentialFunction({stops:featureFunctionStops,base:parameters.base},zoom)(zoom,feature);return"function"==typeof value?value(zoom,feature):value},isFeatureConstant=!1,isZoomConstant=!1}else zoomDependent?(fun=function(zoom){const value=innerFun(parameters,zoom);return"function"==typeof value?value(zoom):value},isFeatureConstant=!0,isZoomConstant=!1):(fun=function(zoom,feature){const value=innerFun(parameters,feature?feature[parameters.property]:null);return"function"==typeof value?value(zoom,feature):value},isFeatureConstant=!1,isZoomConstant=!0)}else fun=function(){return parameters},isFeatureConstant=!0,isZoomConstant=!0;return fun.isZoomConstant=isZoomConstant,fun.isFeatureConstant=isFeatureConstant,fun}function evaluateCategoricalFunction(parameters,input){for(let i=0;i<parameters.stops.length;i++)if(input===parameters.stops[i][0])return parameters.stops[i][1];return parameters.default}function evaluateIntervalFunction(parameters,input){for(var i=0;i<parameters.stops.length&&!(input<parameters.stops[i][0]);i++);return parameters.stops[Math.max(i-1,0)][1]}function evaluateExponentialFunction(parameters,input){for(var base=void 0!==parameters.base?parameters.base:1,i=0;!(i>=parameters.stops.length||input<=parameters.stops[i][0]);)i++;return 0===i?parameters.stops[i][1]:i===parameters.stops.length?parameters.stops[i-1][1]:interpolate(input,base,parameters.stops[i-1][0],parameters.stops[i][0],parameters.stops[i-1][1],parameters.stops[i][1])}"function"==typeof Map&&(colorInCache=new Map);const COLORIN_OPTIONS={width:100,height:1};function evaluateColorInterpolateFunction(parameters,input){const stops=parameters.stops;if(stops&&stops.length>1){let colorIn;if(colorInCache){const key=JSON.stringify(stops);if(!colorInCache.has(key)){const colorIn=new ColorIn(stops,COLORIN_OPTIONS);colorInCache.set(key,colorIn)}colorIn=colorInCache.get(key)}else colorIn=new ColorIn(stops,COLORIN_OPTIONS);const[r,g,b,a]=colorIn.getColor(input);return[r/255,g/255,b/255,a/255]}return stops&&1===stops.length?stops[0][1]:null}function evaluateIdentityFunction(parameters,input){return function(a,b,c){return void 0!==a?a:void 0!==b?b:void 0!==c?c:null}(input,parameters.default)}function interpolate(input,base,inputLower,inputUpper,outputLower,outputUpper){return"function"==typeof outputLower?function(){var evaluatedLower=outputLower.apply(void 0,arguments),evaluatedUpper=outputUpper.apply(void 0,arguments);return interpolate(input,base,inputLower,inputUpper,evaluatedLower,evaluatedUpper)}:outputLower.length?function(input,base,inputLower,inputUpper,outputLower,outputUpper){var output=[];for(let i=0;i<outputLower.length;i++)output[i]=interpolateNumber(input,base,inputLower,inputUpper,outputLower[i],outputUpper[i]);return output}(input,base,inputLower,inputUpper,outputLower,outputUpper):interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper)}function interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper){var ratio,difference=inputUpper-inputLower,progress=input-inputLower;return outputLower*(1-(ratio=1===base?progress/difference:(Math.pow(base,progress)-1)/(Math.pow(base,difference)-1)))+outputUpper*ratio}function isFunctionDefinition(obj){return obj&&"object"==typeof obj&&(obj.stops||obj.property&&"identity"===obj.type)}function hasFunctionDefinition(obj){for(const p in obj)if(isFunctionDefinition(obj[p]))return!0;return!1}function interpolated(parameters){return createFunction1(parameters,"exponential")}function piecewiseConstant(parameters){return createFunction1(parameters,"interval")}function loadFunctionTypes(obj,argFn){if(!obj)return null;var hit=!1;if(Array.isArray(obj)){var loaded,multResult=[];for(let i=0;i<obj.length;i++)loaded=loadFunctionTypes(obj[i],argFn),loaded?(multResult.push(loaded),hit=!0):multResult.push(obj[i]);return hit?multResult:obj}var p,result={__fn_types_loaded:!0},props=[];for(p in obj)obj.hasOwnProperty(p)&&props.push(p);const buildFn=function(p){Object.defineProperty(result,p,{get:function(){return this["__fn_"+p]||(this["__fn_"+p]=interpolated(this["_"+p])),this["__fn_"+p].apply(this,argFn())},set:function(v){this["_"+p]=v},configurable:!0,enumerable:!0})};for(let i=0,len=props.length;i<len;i++)p=props[i],isFunctionDefinition(obj[p])?(hit=!0,result["_"+p]=obj[p],buildFn(p)):result[p]=obj[p];return hit?result:obj}function createFunction1(parameters,defaultType){if(!isFunctionDefinition(parameters))return function(){return parameters};let isZoomConstant=!0,isFeatureConstant=!0;const stops=(parameters=JSON.parse(JSON.stringify(parameters))).stops;if(stops)for(let i=0;i<stops.length;i++)if(isFunctionDefinition(stops[i][1])){const fn=createFunction1(stops[i][1],defaultType);isZoomConstant=isZoomConstant&&fn.isZoomConstant,isFeatureConstant=isFeatureConstant&&fn.isFeatureConstant,stops[i]=[stops[i][0],fn]}const fn=createFunction(parameters,defaultType);return fn.isZoomConstant=isZoomConstant&&fn.isZoomConstant,fn.isFeatureConstant=isFeatureConstant&&fn.isFeatureConstant,fn}var pointGeometry=Point;function Point(x,y){this.x=x,this.y=y}function ShelfPack(w,h,options){options=options||{},this.w=w||64,this.h=h||64,this.autoResize=!!options.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function Shelf(y,w,h){this.x=0,this.y=y,this.w=this.free=w,this.h=h}function Bin(id,x,y,w,h,maxw,maxh){this.id=id,this.x=x,this.y=y,this.w=w,this.h=h,this.maxw=maxw||w,this.maxh=maxh||h,this.refcount=0}Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,p){return this.clone()._rotateAround(a,p)},matMult:function(m){return this.clone()._matMult(m)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(other){return this.x===other.x&&this.y===other.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var dx=p.x-this.x,dy=p.y-this.y;return dx*dx+dy*dy},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(x,y){return Math.atan2(this.x*y-this.y*x,this.x*x+this.y*y)},_matMult:function(m){var y=m[2]*this.x+m[3]*this.y;return this.x=m[0]*this.x+m[1]*this.y,this.y=y,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(k){return this.x*=k,this.y*=k,this},_div:function(k){return this.x/=k,this.y/=k,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var y=this.y;return this.y=this.x,this.x=-y,this},_rotate:function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),y=sin*this.x+cos*this.y;return this.x=cos*this.x-sin*this.y,this.y=y,this},_rotateAround:function(angle,p){var cos=Math.cos(angle),sin=Math.sin(angle),y=p.y+sin*(this.x-p.x)+cos*(this.y-p.y);return this.x=p.x+cos*(this.x-p.x)-sin*(this.y-p.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(a){return a instanceof Point?a:Array.isArray(a)?new Point(a[0],a[1]):a},ShelfPack.prototype.pack=function(bins,options){bins=[].concat(bins),options=options||{};for(var w,h,allocation,results=[],i=0;i<bins.length;i++)if(h=bins[i].h||bins[i].height,(w=bins[i].w||bins[i].width)&&h){if(!(allocation=this.packOne(w,h,bins[i].id)))continue;options.inPlace&&(bins[i].x=allocation.x,bins[i].y=allocation.y,bins[i].id=allocation.id),results.push(allocation)}return this.shrink(),results},ShelfPack.prototype.packOne=function(w,h,id){var bin,shelf,waste,i,h1,h2,w1,w2,best={freebin:-1,shelf:-1,waste:1/0},y=0;if("string"==typeof id||"number"==typeof id){if(bin=this.getBin(id))return this.ref(bin),bin;"number"==typeof id&&(this.maxId=Math.max(id,this.maxId))}else id=++this.maxId;for(i=0;i<this.freebins.length;i++){if(h===(bin=this.freebins[i]).maxh&&w===bin.maxw)return this.allocFreebin(i,w,h,id);h>bin.maxh||w>bin.maxw||h<=bin.maxh&&w<=bin.maxw&&(waste=bin.maxw*bin.maxh-w*h)<best.waste&&(best.waste=waste,best.freebin=i)}for(i=0;i<this.shelves.length;i++)if(y+=(shelf=this.shelves[i]).h,!(w>shelf.free)){if(h===shelf.h)return this.allocShelf(i,w,h,id);h>shelf.h||h<shelf.h&&(waste=(shelf.h-h)*w)<best.waste&&(best.freebin=-1,best.waste=waste,best.shelf=i)}return-1!==best.freebin?this.allocFreebin(best.freebin,w,h,id):-1!==best.shelf?this.allocShelf(best.shelf,w,h,id):h<=this.h-y&&w<=this.w?(shelf=new Shelf(y,this.w,h),this.allocShelf(this.shelves.push(shelf)-1,w,h,id)):this.autoResize?(h1=h2=this.h,((w1=w2=this.w)<=h1||w>w1)&&(w2=2*Math.max(w,w1)),(h1<w1||h>h1)&&(h2=2*Math.max(h,h1)),this.resize(w2,h2),this.packOne(w,h,id)):null},ShelfPack.prototype.allocFreebin=function(index,w,h,id){var bin=this.freebins.splice(index,1)[0];return bin.id=id,bin.w=w,bin.h=h,bin.refcount=0,this.bins[id]=bin,this.ref(bin),bin},ShelfPack.prototype.allocShelf=function(index,w,h,id){var bin=this.shelves[index].alloc(w,h,id);return this.bins[id]=bin,this.ref(bin),bin},ShelfPack.prototype.shrink=function(){if(this.shelves.length>0){for(var w2=0,h2=0,j=0;j<this.shelves.length;j++){var shelf=this.shelves[j];h2+=shelf.h,w2=Math.max(shelf.w-shelf.free,w2)}this.resize(w2,h2)}},ShelfPack.prototype.getBin=function(id){return this.bins[id]},ShelfPack.prototype.ref=function(bin){if(1==++bin.refcount){var h=bin.h;this.stats[h]=1+(0|this.stats[h])}return bin.refcount},ShelfPack.prototype.unref=function(bin){return 0===bin.refcount?0:(0==--bin.refcount&&(this.stats[bin.h]--,delete this.bins[bin.id],this.freebins.push(bin)),bin.refcount)},ShelfPack.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},ShelfPack.prototype.resize=function(w,h){this.w=w,this.h=h;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(w);return!0},Shelf.prototype.alloc=function(w,h,id){if(w>this.free||h>this.h)return null;var x=this.x;return this.x+=w,this.free-=w,new Bin(id,x,this.y,w,h,w,this.h)},Shelf.prototype.resize=function(w){return this.free+=w-this.w,this.w=w,!0};var colorString$1={exports:{}},colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},simpleSwizzle={exports:{}},isArrayish=function(obj){return!(!obj||"string"==typeof obj)&&(obj instanceof Array||Array.isArray(obj)||obj.length>=0&&(obj.splice instanceof Function||Object.getOwnPropertyDescriptor(obj,obj.length-1)&&"String"!==obj.constructor.name))},concat=Array.prototype.concat,slice=Array.prototype.slice,swizzle$1=simpleSwizzle.exports=function(args){for(var results=[],i=0,len=args.length;i<len;i++){var arg=args[i];isArrayish(arg)?results=concat.call(results,slice.call(arg)):results.push(arg)}return results};swizzle$1.wrap=function(fn){return function(){return fn(swizzle$1(arguments))}};var colorNames=colorName,swizzle=simpleSwizzle.exports,hasOwnProperty=Object.hasOwnProperty,reverseNames=Object.create(null);for(var name in colorNames)hasOwnProperty.call(colorNames,name)&&(reverseNames[colorNames[name]]=name);var cs$1=colorString$1.exports={to:{},get:{}};function clamp(num,min,max){return Math.min(Math.max(min,num),max)}function hexDouble(num){var str=Math.round(num).toString(16).toUpperCase();return str.length<2?"0"+str:str}cs$1.get=function(string){var val,model;switch(string.substring(0,3).toLowerCase()){case"hsl":val=cs$1.get.hsl(string),model="hsl";break;case"hwb":val=cs$1.get.hwb(string),model="hwb";break;default:val=cs$1.get.rgb(string),model="rgb"}return val?{model,value:val}:null},cs$1.get.rgb=function(string){if(!string)return null;var match,i,hexAlpha,rgb=[0,0,0,1];if(match=string.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(hexAlpha=match[2],match=match[1],i=0;i<3;i++){var i2=2*i;rgb[i]=parseInt(match.slice(i2,i2+2),16)}hexAlpha&&(rgb[3]=parseInt(hexAlpha,16)/255)}else if(match=string.match(/^#([a-f0-9]{3,4})$/i)){for(hexAlpha=(match=match[1])[3],i=0;i<3;i++)rgb[i]=parseInt(match[i]+match[i],16);hexAlpha&&(rgb[3]=parseInt(hexAlpha+hexAlpha,16)/255)}else if(match=string.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)rgb[i]=parseInt(match[i+1],0);match[4]&&(rgb[3]=match[5]?.01*parseFloat(match[4]):parseFloat(match[4]))}else{if(!(match=string.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(match=string.match(/^(\w+)$/))?"transparent"===match[1]?[0,0,0,0]:hasOwnProperty.call(colorNames,match[1])?((rgb=colorNames[match[1]])[3]=1,rgb):null:null;for(i=0;i<3;i++)rgb[i]=Math.round(2.55*parseFloat(match[i+1]));match[4]&&(rgb[3]=match[5]?.01*parseFloat(match[4]):parseFloat(match[4]))}for(i=0;i<3;i++)rgb[i]=clamp(rgb[i],0,255);return rgb[3]=clamp(rgb[3],0,1),rgb},cs$1.get.hsl=function(string){if(!string)return null;var match=string.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs$1.get.hwb=function(string){if(!string)return null;var match=string.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs$1.to.hex=function(){var rgba=swizzle(arguments);return"#"+hexDouble(rgba[0])+hexDouble(rgba[1])+hexDouble(rgba[2])+(rgba[3]<1?hexDouble(Math.round(255*rgba[3])):"")},cs$1.to.rgb=function(){var rgba=swizzle(arguments);return rgba.length<4||1===rgba[3]?"rgb("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+")":"rgba("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+", "+rgba[3]+")"},cs$1.to.rgb.percent=function(){var rgba=swizzle(arguments),r=Math.round(rgba[0]/255*100),g=Math.round(rgba[1]/255*100),b=Math.round(rgba[2]/255*100);return rgba.length<4||1===rgba[3]?"rgb("+r+"%, "+g+"%, "+b+"%)":"rgba("+r+"%, "+g+"%, "+b+"%, "+rgba[3]+")"},cs$1.to.hsl=function(){var hsla=swizzle(arguments);return hsla.length<4||1===hsla[3]?"hsl("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%)":"hsla("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%, "+hsla[3]+")"},cs$1.to.hwb=function(){var hwba=swizzle(arguments),a="";return hwba.length>=4&&1!==hwba[3]&&(a=", "+hwba[3]),"hwb("+hwba[0]+", "+hwba[1]+"%, "+hwba[2]+"%"+a+")"},cs$1.to.keyword=function(rgb){return reverseNames[rgb.slice(0,3)]};var conversions$2={exports:{}},cssKeywords=colorName,reverseKeywords={};for(var key in cssKeywords)cssKeywords.hasOwnProperty(key)&&(reverseKeywords[cssKeywords[key]]=key);var convert$2=conversions$2.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var model in convert$2)if(convert$2.hasOwnProperty(model)){if(!("channels"in convert$2[model]))throw new Error("missing channels property: "+model);if(!("labels"in convert$2[model]))throw new Error("missing channel labels property: "+model);if(convert$2[model].labels.length!==convert$2[model].channels)throw new Error("channel and label counts mismatch: "+model);var channels=convert$2[model].channels,labels=convert$2[model].labels;delete convert$2[model].channels,delete convert$2[model].labels,Object.defineProperty(convert$2[model],"channels",{value:channels}),Object.defineProperty(convert$2[model],"labels",{value:labels})}function comparativeDistance(x,y){return Math.pow(x[0]-y[0],2)+Math.pow(x[1]-y[1],2)+Math.pow(x[2]-y[2],2)}convert$2.rgb.hsl=function(rgb){var h,l,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min;return max===min?h=0:r===max?h=(g-b)/delta:g===max?h=2+(b-r)/delta:b===max&&(h=4+(r-g)/delta),(h=Math.min(60*h,360))<0&&(h+=360),l=(min+max)/2,[h,100*(max===min?0:l<=.5?delta/(max+min):delta/(2-max-min)),100*l]},convert$2.rgb.hsv=function(rgb){var rdif,gdif,bdif,h,s,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,v=Math.max(r,g,b),diff=v-Math.min(r,g,b),diffc=function(c){return(v-c)/6/diff+.5};return 0===diff?h=s=0:(s=diff/v,rdif=diffc(r),gdif=diffc(g),bdif=diffc(b),r===v?h=bdif-gdif:g===v?h=1/3+rdif-bdif:b===v&&(h=2/3+gdif-rdif),h<0?h+=1:h>1&&(h-=1)),[360*h,100*s,100*v]},convert$2.rgb.hwb=function(rgb){var r=rgb[0],g=rgb[1],b=rgb[2];return[convert$2.rgb.hsl(rgb)[0],100*(1/255*Math.min(r,Math.min(g,b))),100*(b=1-1/255*Math.max(r,Math.max(g,b)))]},convert$2.rgb.cmyk=function(rgb){var k,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;return[100*((1-r-(k=Math.min(1-r,1-g,1-b)))/(1-k)||0),100*((1-g-k)/(1-k)||0),100*((1-b-k)/(1-k)||0),100*k]},convert$2.rgb.keyword=function(rgb){var reversed=reverseKeywords[rgb];if(reversed)return reversed;var currentClosestKeyword,currentClosestDistance=1/0;for(var keyword in cssKeywords)if(cssKeywords.hasOwnProperty(keyword)){var distance=comparativeDistance(rgb,cssKeywords[keyword]);distance<currentClosestDistance&&(currentClosestDistance=distance,currentClosestKeyword=keyword)}return currentClosestKeyword},convert$2.keyword.rgb=function(keyword){return cssKeywords[keyword]},convert$2.rgb.xyz=function(rgb){var r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;return[100*(.4124*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.3576*(g=g>.04045?Math.pow((g+.055)/1.055,2.4):g/12.92)+.1805*(b=b>.04045?Math.pow((b+.055)/1.055,2.4):b/12.92)),100*(.2126*r+.7152*g+.0722*b),100*(.0193*r+.1192*g+.9505*b)]},convert$2.rgb.lab=function(rgb){var xyz=convert$2.rgb.xyz(rgb),x=xyz[0],y=xyz[1],z=xyz[2];return y/=100,z/=108.883,x=(x/=95.047)>.008856?Math.pow(x,1/3):7.787*x+16/116,[116*(y=y>.008856?Math.pow(y,1/3):7.787*y+16/116)-16,500*(x-y),200*(y-(z=z>.008856?Math.pow(z,1/3):7.787*z+16/116))]},convert$2.hsl.rgb=function(hsl){var t1,t2,t3,rgb,val,h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100;if(0===s)return[val=255*l,val,val];t1=2*l-(t2=l<.5?l*(1+s):l+s-l*s),rgb=[0,0,0];for(var i=0;i<3;i++)(t3=h+1/3*-(i-1))<0&&t3++,t3>1&&t3--,rgb[i]=255*(val=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1);return rgb},convert$2.hsl.hsv=function(hsl){var h=hsl[0],s=hsl[1]/100,l=hsl[2]/100,smin=s,lmin=Math.max(l,.01);return s*=(l*=2)<=1?l:2-l,smin*=lmin<=1?lmin:2-lmin,[h,100*(0===l?2*smin/(lmin+smin):2*s/(l+s)),100*((l+s)/2)]},convert$2.hsv.rgb=function(hsv){var h=hsv[0]/60,s=hsv[1]/100,v=hsv[2]/100,hi=Math.floor(h)%6,f=h-Math.floor(h),p=255*v*(1-s),q=255*v*(1-s*f),t=255*v*(1-s*(1-f));switch(v*=255,hi){case 0:return[v,t,p];case 1:return[q,v,p];case 2:return[p,v,t];case 3:return[p,q,v];case 4:return[t,p,v];case 5:return[v,p,q]}},convert$2.hsv.hsl=function(hsv){var lmin,sl,l,h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,vmin=Math.max(v,.01);return l=(2-s)*v,sl=s*vmin,[h,100*(sl=(sl/=(lmin=(2-s)*vmin)<=1?lmin:2-lmin)||0),100*(l/=2)]},convert$2.hwb.rgb=function(hwb){var i,v,f,n,r,g,b,h=hwb[0]/360,wh=hwb[1]/100,bl=hwb[2]/100,ratio=wh+bl;switch(ratio>1&&(wh/=ratio,bl/=ratio),f=6*h-(i=Math.floor(6*h)),0!=(1&i)&&(f=1-f),n=wh+f*((v=1-bl)-wh),i){default:case 6:case 0:r=v,g=n,b=wh;break;case 1:r=n,g=v,b=wh;break;case 2:r=wh,g=v,b=n;break;case 3:r=wh,g=n,b=v;break;case 4:r=n,g=wh,b=v;break;case 5:r=v,g=wh,b=n}return[255*r,255*g,255*b]},convert$2.cmyk.rgb=function(cmyk){var m=cmyk[1]/100,y=cmyk[2]/100,k=cmyk[3]/100;return[255*(1-Math.min(1,cmyk[0]/100*(1-k)+k)),255*(1-Math.min(1,m*(1-k)+k)),255*(1-Math.min(1,y*(1-k)+k))]},convert$2.xyz.rgb=function(xyz){var r,g,b,x=xyz[0]/100,y=xyz[1]/100,z=xyz[2]/100;return g=-.9689*x+1.8758*y+.0415*z,b=.0557*x+-.204*y+1.057*z,r=(r=3.2406*x+-1.5372*y+-.4986*z)>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:12.92*g,b=b>.0031308?1.055*Math.pow(b,1/2.4)-.055:12.92*b,[255*(r=Math.min(Math.max(0,r),1)),255*(g=Math.min(Math.max(0,g),1)),255*(b=Math.min(Math.max(0,b),1))]},convert$2.xyz.lab=function(xyz){var x=xyz[0],y=xyz[1],z=xyz[2];return y/=100,z/=108.883,x=(x/=95.047)>.008856?Math.pow(x,1/3):7.787*x+16/116,[116*(y=y>.008856?Math.pow(y,1/3):7.787*y+16/116)-16,500*(x-y),200*(y-(z=z>.008856?Math.pow(z,1/3):7.787*z+16/116))]},convert$2.lab.xyz=function(lab){var x,y,z;x=lab[1]/500+(y=(lab[0]+16)/116),z=y-lab[2]/200;var y2=Math.pow(y,3),x2=Math.pow(x,3),z2=Math.pow(z,3);return y=y2>.008856?y2:(y-16/116)/7.787,x=x2>.008856?x2:(x-16/116)/7.787,z=z2>.008856?z2:(z-16/116)/7.787,[x*=95.047,y*=100,z*=108.883]},convert$2.lab.lch=function(lab){var h,l=lab[0],a=lab[1],b=lab[2];return(h=360*Math.atan2(b,a)/2/Math.PI)<0&&(h+=360),[l,Math.sqrt(a*a+b*b),h]},convert$2.lch.lab=function(lch){var hr,c=lch[1];return hr=lch[2]/360*2*Math.PI,[lch[0],c*Math.cos(hr),c*Math.sin(hr)]},convert$2.rgb.ansi16=function(args){var r=args[0],g=args[1],b=args[2],value=1 in arguments?arguments[1]:convert$2.rgb.hsv(args)[2];if(0===(value=Math.round(value/50)))return 30;var ansi=30+(Math.round(b/255)<<2|Math.round(g/255)<<1|Math.round(r/255));return 2===value&&(ansi+=60),ansi},convert$2.hsv.ansi16=function(args){return convert$2.rgb.ansi16(convert$2.hsv.rgb(args),args[2])},convert$2.rgb.ansi256=function(args){var r=args[0],g=args[1],b=args[2];return r===g&&g===b?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(g/255*5)+Math.round(b/255*5)},convert$2.ansi16.rgb=function(args){var color=args%10;if(0===color||7===color)return args>50&&(color+=3.5),[color=color/10.5*255,color,color];var mult=.5*(1+~~(args>50));return[(1&color)*mult*255,(color>>1&1)*mult*255,(color>>2&1)*mult*255]},convert$2.ansi256.rgb=function(args){if(args>=232){var c=10*(args-232)+8;return[c,c,c]}var rem;return args-=16,[Math.floor(args/36)/5*255,Math.floor((rem=args%36)/6)/5*255,rem%6/5*255]},convert$2.rgb.hex=function(args){var string=(((255&Math.round(args[0]))<<16)+((255&Math.round(args[1]))<<8)+(255&Math.round(args[2]))).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert$2.hex.rgb=function(args){var match=args.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!match)return[0,0,0];var colorString=match[0];3===match[0].length&&(colorString=colorString.split("").map((function(char){return char+char})).join(""));var integer=parseInt(colorString,16);return[integer>>16&255,integer>>8&255,255&integer]},convert$2.rgb.hcg=function(rgb){var hue,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,max=Math.max(Math.max(r,g),b),min=Math.min(Math.min(r,g),b),chroma=max-min;return hue=chroma<=0?0:max===r?(g-b)/chroma%6:max===g?2+(b-r)/chroma:4+(r-g)/chroma+4,hue/=6,[360*(hue%=1),100*chroma,100*(chroma<1?min/(1-chroma):0)]},convert$2.hsl.hcg=function(hsl){var s=hsl[1]/100,l=hsl[2]/100,c=1,f=0;return(c=l<.5?2*s*l:2*s*(1-l))<1&&(f=(l-.5*c)/(1-c)),[hsl[0],100*c,100*f]},convert$2.hsv.hcg=function(hsv){var v=hsv[2]/100,c=hsv[1]/100*v,f=0;return c<1&&(f=(v-c)/(1-c)),[hsv[0],100*c,100*f]},convert$2.hcg.rgb=function(hcg){var c=hcg[1]/100,g=hcg[2]/100;if(0===c)return[255*g,255*g,255*g];var mg,pure=[0,0,0],hi=hcg[0]/360%1*6,v=hi%1,w=1-v;switch(Math.floor(hi)){case 0:pure[0]=1,pure[1]=v,pure[2]=0;break;case 1:pure[0]=w,pure[1]=1,pure[2]=0;break;case 2:pure[0]=0,pure[1]=1,pure[2]=v;break;case 3:pure[0]=0,pure[1]=w,pure[2]=1;break;case 4:pure[0]=v,pure[1]=0,pure[2]=1;break;default:pure[0]=1,pure[1]=0,pure[2]=w}return[255*(c*pure[0]+(mg=(1-c)*g)),255*(c*pure[1]+mg),255*(c*pure[2]+mg)]},convert$2.hcg.hsv=function(hcg){var c=hcg[1]/100,v=c+hcg[2]/100*(1-c),f=0;return v>0&&(f=c/v),[hcg[0],100*f,100*v]},convert$2.hcg.hsl=function(hcg){var c=hcg[1]/100,l=hcg[2]/100*(1-c)+.5*c,s=0;return l>0&&l<.5?s=c/(2*l):l>=.5&&l<1&&(s=c/(2*(1-l))),[hcg[0],100*s,100*l]},convert$2.hcg.hwb=function(hcg){var c=hcg[1]/100,v=c+hcg[2]/100*(1-c);return[hcg[0],100*(v-c),100*(1-v)]},convert$2.hwb.hcg=function(hwb){var v=1-hwb[2]/100,c=v-hwb[1]/100,g=0;return c<1&&(g=(v-c)/(1-c)),[hwb[0],100*c,100*g]},convert$2.apple.rgb=function(apple){return[apple[0]/65535*255,apple[1]/65535*255,apple[2]/65535*255]},convert$2.rgb.apple=function(rgb){return[rgb[0]/255*65535,rgb[1]/255*65535,rgb[2]/255*65535]},convert$2.gray.rgb=function(args){return[args[0]/100*255,args[0]/100*255,args[0]/100*255]},convert$2.gray.hsl=convert$2.gray.hsv=function(args){return[0,0,args[0]]},convert$2.gray.hwb=function(gray){return[0,100,gray[0]]},convert$2.gray.cmyk=function(gray){return[0,0,0,gray[0]]},convert$2.gray.lab=function(gray){return[gray[0],0,0]},convert$2.gray.hex=function(gray){var val=255&Math.round(gray[0]/100*255),string=((val<<16)+(val<<8)+val).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert$2.rgb.gray=function(rgb){return[(rgb[0]+rgb[1]+rgb[2])/3/255*100]};var conversions$1=conversions$2.exports;function deriveBFS(fromModel){var graph=function(){for(var graph={},models=Object.keys(conversions$1),len=models.length,i=0;i<len;i++)graph[models[i]]={distance:-1,parent:null};return graph}(),queue=[fromModel];for(graph[fromModel].distance=0;queue.length;)for(var current=queue.pop(),adjacents=Object.keys(conversions$1[current]),len=adjacents.length,i=0;i<len;i++){var adjacent=adjacents[i],node=graph[adjacent];-1===node.distance&&(node.distance=graph[current].distance+1,node.parent=current,queue.unshift(adjacent))}return graph}function link(from,to){return function(args){return to(from(args))}}function wrapConversion(toModel,graph){for(var path=[graph[toModel].parent,toModel],fn=conversions$1[graph[toModel].parent][toModel],cur=graph[toModel].parent;graph[cur].parent;)path.unshift(graph[cur].parent),fn=link(conversions$1[graph[cur].parent][cur],fn),cur=graph[cur].parent;return fn.conversion=path,fn}var conversions=conversions$2.exports,route=function(fromModel){for(var graph=deriveBFS(fromModel),conversion={},models=Object.keys(graph),len=models.length,i=0;i<len;i++){var toModel=models[i];null!==graph[toModel].parent&&(conversion[toModel]=wrapConversion(toModel,graph))}return conversion},convert$1={};Object.keys(conversions).forEach((function(fromModel){convert$1[fromModel]={},Object.defineProperty(convert$1[fromModel],"channels",{value:conversions[fromModel].channels}),Object.defineProperty(convert$1[fromModel],"labels",{value:conversions[fromModel].labels});var routes=route(fromModel);Object.keys(routes).forEach((function(toModel){var fn=routes[toModel];convert$1[fromModel][toModel]=function(fn){var wrappedFn=function(args){if(null==args)return args;arguments.length>1&&(args=Array.prototype.slice.call(arguments));var result=fn(args);if("object"==typeof result)for(var len=result.length,i=0;i<len;i++)result[i]=Math.round(result[i]);return result};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn}(fn),convert$1[fromModel][toModel].raw=function(fn){var wrappedFn=function(args){return null==args?args:(arguments.length>1&&(args=Array.prototype.slice.call(arguments)),fn(args))};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn}(fn)}))}));var colorString=colorString$1.exports,convert=convert$1,_slice=[].slice,skippedModels=["keyword","gray","hex"],hashedModelKeys={};Object.keys(convert).forEach((function(model){hashedModelKeys[_slice.call(convert[model].labels).sort().join("")]=model}));var limiters={};function Color(obj,model){if(!(this instanceof Color))return new Color(obj,model);if(model&&model in skippedModels&&(model=null),model&&!(model in convert))throw new Error("Unknown model: "+model);var i,channels;if(null==obj)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(obj instanceof Color)this.model=obj.model,this.color=obj.color.slice(),this.valpha=obj.valpha;else if("string"==typeof obj){var result=colorString.get(obj);if(null===result)throw new Error("Unable to parse color from string: "+obj);this.model=result.model,this.color=result.value.slice(0,channels=convert[this.model].channels),this.valpha="number"==typeof result.value[channels]?result.value[channels]:1}else if(obj.length){this.model=model||"rgb";var newArr=_slice.call(obj,0,channels=convert[this.model].channels);this.color=zeroArray(newArr,channels),this.valpha="number"==typeof obj[channels]?obj[channels]:1}else if("number"==typeof obj)obj&=16777215,this.model="rgb",this.color=[obj>>16&255,obj>>8&255,255&obj],this.valpha=1;else{this.valpha=1;var keys=Object.keys(obj);"alpha"in obj&&(keys.splice(keys.indexOf("alpha"),1),this.valpha="number"==typeof obj.alpha?obj.alpha:0);var hashedKeys=keys.sort().join("");if(!(hashedKeys in hashedModelKeys))throw new Error("Unable to parse color from object: "+JSON.stringify(obj));this.model=hashedModelKeys[hashedKeys];var labels=convert[this.model].labels,color=[];for(i=0;i<labels.length;i++)color.push(obj[labels[i]]);this.color=zeroArray(color)}if(limiters[this.model])for(channels=convert[this.model].channels,i=0;i<channels;i++){var limit=limiters[this.model][i];limit&&(this.color[i]=limit(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function getset(model,channel,modifier){return(model=Array.isArray(model)?model:[model]).forEach((function(m){(limiters[m]||(limiters[m]=[]))[channel]=modifier})),model=model[0],function(val){var result;return arguments.length?(modifier&&(val=modifier(val)),(result=this[model]()).color[channel]=val,result):(result=this[model]().color[channel],modifier&&(result=modifier(result)),result)}}function maxfn(max){return function(v){return Math.max(0,Math.min(max,v))}}function assertArray(val){return Array.isArray(val)?val:[val]}function zeroArray(arr,length){for(var i=0;i<length;i++)"number"!=typeof arr[i]&&(arr[i]=0);return arr}Color.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(places){var self=this.model in colorString.to?this:this.rgb(),args=1===(self=self.round("number"==typeof places?places:1)).valpha?self.color:self.color.concat(this.valpha);return colorString.to[self.model](args)},percentString:function(places){var self=this.rgb().round("number"==typeof places?places:1),args=1===self.valpha?self.color:self.color.concat(this.valpha);return colorString.to.rgb.percent(args)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var result={},channels=convert[this.model].channels,labels=convert[this.model].labels,i=0;i<channels;i++)result[labels[i]]=this.color[i];return 1!==this.valpha&&(result.alpha=this.valpha),result},unitArray:function(){var rgb=this.rgb().color;return rgb[0]/=255,rgb[1]/=255,rgb[2]/=255,1!==this.valpha&&rgb.push(this.valpha),rgb},unitObject:function(){var rgb=this.rgb().object();return rgb.r/=255,rgb.g/=255,rgb.b/=255,1!==this.valpha&&(rgb.alpha=this.valpha),rgb},round:function(places){return places=Math.max(places||0,0),new Color(this.color.map(function(places){return function(num){return function(num,places){return Number(num.toFixed(places))}(num,places)}}(places)).concat(this.valpha),this.model)},alpha:function(val){return arguments.length?new Color(this.color.concat(Math.max(0,Math.min(1,val))),this.model):this.valpha},red:getset("rgb",0,maxfn(255)),green:getset("rgb",1,maxfn(255)),blue:getset("rgb",2,maxfn(255)),hue:getset(["hsl","hsv","hsl","hwb","hcg"],0,(function(val){return(val%360+360)%360})),saturationl:getset("hsl",1,maxfn(100)),lightness:getset("hsl",2,maxfn(100)),saturationv:getset("hsv",1,maxfn(100)),value:getset("hsv",2,maxfn(100)),chroma:getset("hcg",1,maxfn(100)),gray:getset("hcg",2,maxfn(100)),white:getset("hwb",1,maxfn(100)),wblack:getset("hwb",2,maxfn(100)),cyan:getset("cmyk",0,maxfn(100)),magenta:getset("cmyk",1,maxfn(100)),yellow:getset("cmyk",2,maxfn(100)),black:getset("cmyk",3,maxfn(100)),x:getset("xyz",0,maxfn(100)),y:getset("xyz",1,maxfn(100)),z:getset("xyz",2,maxfn(100)),l:getset("lab",0,maxfn(100)),a:getset("lab",1),b:getset("lab",2),keyword:function(val){return arguments.length?new Color(val):convert[this.model].keyword(this.color)},hex:function(val){return arguments.length?new Color(val):colorString.to.hex(this.rgb().round().color)},rgbNumber:function(){var rgb=this.rgb().color;return(255&rgb[0])<<16|(255&rgb[1])<<8|255&rgb[2]},luminosity:function(){for(var rgb=this.rgb().color,lum=[],i=0;i<rgb.length;i++){var chan=rgb[i]/255;lum[i]=chan<=.03928?chan/12.92:Math.pow((chan+.055)/1.055,2.4)}return.2126*lum[0]+.7152*lum[1]+.0722*lum[2]},contrast:function(color2){var lum1=this.luminosity(),lum2=color2.luminosity();return lum1>lum2?(lum1+.05)/(lum2+.05):(lum2+.05)/(lum1+.05)},level:function(color2){var contrastRatio=this.contrast(color2);return contrastRatio>=7.1?"AAA":contrastRatio>=4.5?"AA":""},isDark:function(){var rgb=this.rgb().color;return(299*rgb[0]+587*rgb[1]+114*rgb[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var rgb=this.rgb(),i=0;i<3;i++)rgb.color[i]=255-rgb.color[i];return rgb},lighten:function(ratio){var hsl=this.hsl();return hsl.color[2]+=hsl.color[2]*ratio,hsl},darken:function(ratio){var hsl=this.hsl();return hsl.color[2]-=hsl.color[2]*ratio,hsl},saturate:function(ratio){var hsl=this.hsl();return hsl.color[1]+=hsl.color[1]*ratio,hsl},desaturate:function(ratio){var hsl=this.hsl();return hsl.color[1]-=hsl.color[1]*ratio,hsl},whiten:function(ratio){var hwb=this.hwb();return hwb.color[1]+=hwb.color[1]*ratio,hwb},blacken:function(ratio){var hwb=this.hwb();return hwb.color[2]+=hwb.color[2]*ratio,hwb},grayscale:function(){var rgb=this.rgb().color,val=.3*rgb[0]+.59*rgb[1]+.11*rgb[2];return Color.rgb(val,val,val)},fade:function(ratio){return this.alpha(this.valpha-this.valpha*ratio)},opaquer:function(ratio){return this.alpha(this.valpha+this.valpha*ratio)},rotate:function(degrees){var hsl=this.hsl(),hue=hsl.color[0];return hsl.color[0]=hue=(hue=(hue+degrees)%360)<0?360+hue:hue,hsl},mix:function(mixinColor,weight){if(!mixinColor||!mixinColor.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof mixinColor);var color1=mixinColor.rgb(),color2=this.rgb(),p=void 0===weight?.5:weight,w=2*p-1,a=color1.alpha()-color2.alpha(),w1=((w*a==-1?w:(w+a)/(1+w*a))+1)/2,w2=1-w1;return Color.rgb(w1*color1.red()+w2*color2.red(),w1*color1.green()+w2*color2.green(),w1*color1.blue()+w2*color2.blue(),color1.alpha()*p+color2.alpha()*(1-p))}},Object.keys(convert).forEach((function(model){if(-1===skippedModels.indexOf(model)){var channels=convert[model].channels;Color.prototype[model]=function(){if(this.model===model)return new Color(this);if(arguments.length)return new Color(arguments,model);var newAlpha="number"==typeof arguments[channels]?channels:this.valpha;return new Color(assertArray(convert[this.model][model].raw(this.color)).concat(newAlpha),model)},Color[model]=function(color){return"number"==typeof color&&(color=zeroArray(_slice.call(arguments),channels)),new Color(color,model)}}}));var color=Color;
/*!
	    Feature Filter by

	    (c) mapbox 2016 and maptalks 2018
	    www.mapbox.com | www.maptalks.org
	    License: MIT, header required.
	*/const types=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function createFilter(filter){return new Function("f",`var p = (f && f.properties || {}); return ${compile(filter)}`)}function isFeatureFilter(filter){if(!0===filter||!1===filter)return!0;if(!Array.isArray(filter)||0===filter.length)return!1;switch(filter[0]){case"has":case"!has":return 2===filter.length&&("string"==typeof filter[1]||filter[1].property&&filter[1].op);case"in":case"!in":return filter.length>=2&&("string"==typeof filter[1]||filter[1].property&&filter[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===filter.length&&("string"==typeof filter[1]||filter[1].property&&filter[1].op);case"none":case"any":case"all":for(const f of filter.slice(1))if(!isFeatureFilter(f)&&"boolean"!=typeof f)return!1;return!0;case"contains":return!0;default:return!1}}function compile(filter){if(!filter)return"true";const op=filter[0];if(filter.length<=1)return"any"===op?"false":"true";return`(${"=="===op?compileComparisonOp(filter[1],filter[2],"===",!1):"!="===op?compileComparisonOp(filter[1],filter[2],"!==",!1):"<"===op||">"===op||"<="===op||">="===op?compileComparisonOp(filter[1],filter[2],op,!0):"any"===op?compileLogicalOp(filter.slice(1),"||"):"all"===op?compileLogicalOp(filter.slice(1),"&&"):"none"===op?compileNegation(compileLogicalOp(filter.slice(1),"||")):"in"===op?compileInOp(filter[1],filter.slice(2)):"!in"===op?compileNegation(compileInOp(filter[1],filter.slice(2))):"has"===op?compileHasOp(filter[1]):"!has"===op?compileNegation(compileHasOp(filter[1])):"contains"===op?function(property,str,index){const prop=compilePropertyReference(property);return void 0!==index?`(${prop} + '').indexOf("${str}") === ${index}`:`(${prop} + '').indexOf("${str}") >= 0`}(filter[1],filter[2],filter[3]):"true"})`}function compilePropertyReference(property){return"$"===property[0]?"f."+property.substring(1):"p["+JSON.stringify(property)+"]"}function compileComparisonOp(property,value,op,checkType){if("object"==typeof(obj=property)&&obj&&property.op)return function(propertyObj,value,op,checkType){const property=propertyObj.property,funName=propertyObj.op;let left=compilePropertyReference(property);return"length"!==funName?(console.error(`not support ${funName} op`),"false"):(left=`((${left}+='').length)`,getComparisonCode(left,property,value,op,checkType))}(property,value,op,checkType);var obj;return getComparisonCode(compilePropertyReference(property),property,value,op,checkType)}function getComparisonCode(left,property,value,op,checkType){const right="$type"===property?types.indexOf(value):JSON.stringify(value);return(checkType?`typeof ${left}=== typeof ${right}&&`:"")+left+op+right}function compileLogicalOp(expressions,op){return expressions.map(compile).join(op)}function compileInOp(property,values){"$type"===property&&(values=values.map((value=>types.indexOf(value))));const left=JSON.stringify(values.sort(compare)),right=compilePropertyReference(property);return values.length<=200?`${left}.indexOf(${right}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${right}, ${left},0,${values.length-1})`}function compileHasOp(property){return"$id"===property?'"id" in f':`${JSON.stringify(property)} in p`}function compileNegation(expression){return`!(${expression})`}function compare(a,b){return a<b?-1:a>b?1:0}function compileStyle(styles){if(!Array.isArray(styles))return compileStyle([styles]);const compiled=[];for(let i=0;i<styles.length;i++){let filter;filter=!0===styles[i].filter?function(){return!0}:createFilter(styles[i].filter),compiled.push(extend({},styles[i],{filter}))}return compiled}function extend(dest){for(let i=1;i<arguments.length;i++){const src=arguments[i];for(const k in src)dest[k]=src[k]}return dest}var quickselect={exports:{}};!function(module,exports){module.exports=function(){function quickselect(arr,k,left,right,compare){quickselectStep(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}function quickselectStep(arr,k,left,right,compare){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselectStep(arr,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}return quickselect}()}(quickselect);var u$1=quickselect.exports,tinyqueue={exports:{}};function TinyQueue(data,compare){if(!(this instanceof TinyQueue))return new TinyQueue(data,compare);if(this.data=data||[],this.length=this.data.length,this.compare=compare||defaultCompare,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function defaultCompare(a,b){return a<b?-1:a>b?1:0}tinyqueue.exports=TinyQueue,tinyqueue.exports.default=TinyQueue,TinyQueue.prototype={push:function(item){this.data.push(item),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var top=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),top}},peek:function(){return this.data[0]},_up:function(pos){for(var data=this.data,compare=this.compare,item=data[pos];pos>0;){var parent=pos-1>>1,current=data[parent];if(compare(item,current)>=0)break;data[pos]=current,pos=parent}data[pos]=item},_down:function(pos){for(var data=this.data,compare=this.compare,halfLength=this.length>>1,item=data[pos];pos<halfLength;){var left=1+(pos<<1),right=left+1,best=data[left];if(right<this.length&&compare(data[right],best)<0&&(left=right,best=data[right]),compare(best,item)>=0)break;data[pos]=best,pos=left}data[pos]=item}};var earcut$1={exports:{}};function earcut(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;if(hasHoles&&(outerNode=function(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)(list=linkedList(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)outerNode=eliminateHole(queue[i],outerNode);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)(x=data[i])<minX&&(minX=x),(y=data[i+1])<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?32767/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize,0),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function(start,minX,minY,invSize){var p=start;do{0===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1)}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim|0),triangles.push(ear.i/dim|0),triangles.push(next.i/dim|0),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(filterPoints(ear),triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,p=c.next;p!==a;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,minZ=zOrder(x0,y0,minX,minY,invSize),maxZ=zOrder(x1,y1,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim|0),triangles.push(p.i/dim|0),triangles.push(b.i/dim|0),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return filterPoints(p)}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize,0),void earcutLinked(c,triangles,dim,minX,minY,invSize,0)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){var bridge=function(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx&&(qx=x,m=p.x<p.next.x?p:p.next,x===hx))return m}p=p.next}while(p!==outerNode);if(!m)return null;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m;do{hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&(tan=Math.abs(hy-p.y)/(hx-p.x),locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))&&(m=p,tanMin=tan)),p=p.next}while(p!==stop);return m}(hole,outerNode);if(!bridge)return outerNode;var bridgeReverse=splitPolygon(bridge,hole);return filterPoints(bridgeReverse,bridgeReverse.next),filterPoints(bridge,bridge.next)}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=(x-minX)*invSize|0)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=(y-minY)*invSize|0)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){var p=start,leftmost=start;do{(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)>=(ax-px)*(cy-py)&&(ax-px)*(by-py)>=(bx-px)*(ay-py)&&(bx-px)*(cy-py)>=(cx-px)*(by-py)}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&function(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){var o1=sign(area(p1,q1,p2)),o2=sign(area(p1,q1,q2)),o3=sign(area(p2,q2,p1)),o4=sign(area(p2,q2,q1));return o1!==o2&&o3!==o4||(!(0!==o1||!onSegment(p1,p2,q1))||(!(0!==o2||!onSegment(p1,q2,q1))||(!(0!==o3||!onSegment(p2,p1,q2))||!(0!==o4||!onSegment(p2,q1,q2)))))}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign(num){return num>0?1:num<0?-1:0}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}earcut$1.exports=earcut,earcut$1.exports.default=earcut,earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,polygonArea=Math.abs(signedArea(data,0,hasHoles?holeIndices[0]*dim:data.length,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){polygonArea-=Math.abs(signedArea(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&result.holes.push(holeIndex+=data[i-1].length)}return result};
/*!
	 * @maptalks/vector-packer v0.79.1
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.com
	 */
const b$4={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function x$4(e,t={}){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)v$4(i,e.features[r],t,r);else v$4(i,"Feature"===e.type?e:{geometry:e},t);return i}function v$4(e,t,i,r){if(t.geometry&&t.geometry.geometry){var n=t.geometry.coordinates,o=t.geometry.type,a=[],s=t.id;if(i.promoteId?s=t.properties[i.promoteId]:i.generateId&&(s=r||0),"Point"===o)w$5(n,a);else if("MultiPoint"===o)for(var l=0;l<n.length;l++)w$5(n[l],a);else if("LineString"===o)_$3([n],a);else if("MultiLineString"===o){if(i.lineMetrics){for(l=0;l<n.length;l++)k$5(n[l],a=[]),e.push(z$4(s,"LineString",a,t.properties));return}_$3(n,a)}else if("Polygon"===o)_$3(n,a);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)v$4(e,{id:s,geometry:t.geometry.geometries[l],properties:t.properties},i,r);return}return void console.warn(`Input data type(${o}) is not a valid GeoJSON geometry type.`)}for(l=0;l<n.length;l++){var u=[];_$3(n[l],u),a.push(u)}}e.push(z$4(s,o,a,t.properties))}}function w$5(t,i){const r=new pointGeometry(t[0],t[1]);r.z=100*(t[2]||0),i.push([r])}function k$5(t,i){for(let r=0;r<t.length;r++){const n=new pointGeometry(t[r][0],t[r][1]);n.z=100*(t[r][2]||0),i.push(n)}}function _$3(e,t,i,r){for(var n=0;n<e.length;n++){var o=[];k$5(e[n],o),t.push(o)}}function z$4(e,t,i,r){return{id:void 0===e?null:e,type:b$4[t],geometry:i,properties:r}}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 */function A$2(e,{width:t,height:i},r,n){if(n){if(n.length!==t*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(t*i*r);return e.width=t,e.height=i,e.data=n,e}function T$5(e,{width:t,height:i},r){if(t===e.width&&i===e.height)return;const n=A$2({},{width:t,height:i},r);j$5(e,n,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,i)},r),e.width=t,e.height=i,e.data=n.data}function j$5(e,t,i,r,n,o){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,s=t.data;if(a===s)return t;for(let l=0;l<n.height;l++){const u=((i.y+l)*e.width+i.x)*o,c=((r.y+l)*t.width+r.x)*o;for(let e=0;e<n.width*o;e++)s[c+e]=a[u+e]}return t}class F$5{constructor(e,t){A$2(this,e,1,t)}resize(e){T$5(this,e,1)}clone(){return new F$5({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){j$5(e,t,i,r,n,1)}}class P$5{constructor(e,t){A$2(this,e,4,t)}resize(e){T$5(this,e,4)}clone(){return new P$5({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){j$5(e,t,i,r,n,4)}}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 */class S$5{constructor(e,{pixelRatio:t}){this.paddedRect=e,this.pixelRatio=t||1}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class M$5{constructor(e){this.glyphMap=e,this.build()}build(){const e=this.glyphMap,i={},r=new ShelfPack(0,0,{autoResize:!0}),n=[];for(const t in e){const r=e[t],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};n.push(o),i[t]=new S$5(o,r)}if(r.pack(n,{inPlace:!0}),!I$4(r.w)||!I$4(r.h)){const e=C$4(r.w),t=C$4(r.h);r.resize(e,t)}const o=new P$5({width:r.w,height:r.h});for(const t in e){const r=e[t],n=i[t].paddedRect;P$5.copy(r.data,o,{x:0,y:0},{x:n.x+1,y:n.y+1},r.data)}this.image=o,this.positions=i}}function I$4(e){return 0==(e&e-1)&&0!==e}function C$4(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 * TODO 升级为potpack
	 */class D$5{constructor(e){this.glyphMap=e,this.build()}build(){const e=this.glyphMap,i={},r=new ShelfPack(0,0,{autoResize:!0}),n=[];for(const t in e){const r=e[t],o=i[t]={};for(const e in r){const t=r[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};n.push(i),o[e]={rect:i,metrics:t.metrics}}}r.pack(n,{inPlace:!0});const o=new F$5({width:r.w,height:r.h});for(const t in e){const r=e[t];for(const e in r){const n=r[+e];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const a=i[t][e].rect;F$5.copy(n.bitmap,o,{x:0,y:0},{x:a.x+1,y:a.y+1},n.bitmap)}}this.image=o,this.positions=i}}function E$4(e){return e<65536?Uint16Array:Uint32Array}function O$5(e){return(e=Math.abs(e))<128?Int8Array:e<32768?Int16Array:Float32Array}function R$5(e){return e<256?Uint8Array:e<65536?Uint16Array:e<Math.pow(2,32)?Uint32Array:Float64Array}function L$6(e){const t=e.type,i=[];if(1===t||4===t)for(let t=0;t<e.geometry.length;t++)w$5(e.geometry[t],i);else if(2===t)_$3(e.geometry,i);else if(3===t)_$3(e.geometry,i);else if(5===t)_$3(e.geometry,i);else if(6===t)for(let t=0;t<e.geometry.length;t++){const r=[];_$3(e.geometry[t],r),i.push(r)}return e.geometry=i,e}function q$5(e){for(let t=1;t<arguments.length;t++){const i=arguments[t];for(const t in i)e[t]=i[t]}return e}function N$6(e){return null==e}function U$5(e){return"number"==typeof e&&!isNaN(e)}function $$5(e){return"object"==typeof e&&!!e}function W$5(e){return!N$6(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function V$6(e){return!N$6(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}const H$6=Object.prototype.hasOwnProperty;function G$5(e,t){return H$6.call(e,t)}const J$5=Math.PI/180;function B$5(e){return e&&isFunctionDefinition(e)&&e.property}function X$5(e){const{pointAtTileRes:t,tileRatio:i}=e;return t*i}const Y$4={};function K$5(e,t){if(!Array.isArray(t)){if(t&&void 0!==t.r&&void 0!==t.g&&void 0!==t.b)return e[0]=255*t.r,e[1]=255*t.g,e[2]=255*t.b,e[3]=void 0!==t.a?255*t.a:255,e;t=Y$4[t]=Y$4[t]||color(t).unitArray()}for(let i=0;i<t.length;i++)e[i]=255*t[i];return 3===e.length&&e.push(255),e}const Q$5={textFill:1,textSize:1,textOpacity:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1},ee$3={textName:1,markerTextFitPadding:1,markerTextFit:1,lineGradientProperty:1};var te$3=Object.freeze({__proto__:null,now:function(){return Date.now()},extend:q$5,isNil:N$6,isNumber:U$5,isInteger:function(e){return(0|e)===e},isObject:$$5,isString:W$5,isFunction:V$6,hasOwn:G$5,join:function(e,t){return e.join?e.join(t||","):Array.prototype.join.call(e,t||",")},toRadian:function(e){return e*J$5},toDegree:function(e){return e/J$5},evaluate:function(e,t,i){return V$6(e)?e(void 0!==i?i:null,t):e},isFnTypeSymbol:B$5,getAltitudeToLocal:X$5,getTubeSizeScale:function(e){return"centimeter"===e||"cm"===e?1:"millimeter"===e||"mm"===e?.1:100},normalizeColor:K$5,checkIfIdentityZoomDependent:function(e,t,n){if(Array.isArray(n)||(n=Object.values(n)),!n||!n.length)return!1;if(!Q$5[e])return!1;for(let e=0;e<n.length;e++){const o=n[e]&&(n[e].feature||n[e]);if(!o)continue;const a=o.properties&&o.properties[t];if(a&&isFunctionDefinition(a)&&!interpolated(a).isZoomConstant)return!0}return!1},checkIfZoomFnTypeSymbol:function(e){return!!Q$5[e]||!!ee$3[e]}});function ie$3(e){let t=0;for(let i,r,n=0,o=e.length,a=o-1;n<o;a=n++)i=e[n],r=e[a],t+=void 0!==i.x?(r.x-i.x)*(i.y+r.y):(r[0]-i[0])*(i[1]+r[1]);return t}function ne$3(e,t,i){let r=i;return t&&e&&(r=+e[t]),isNaN(r)&&(r=i||0),100*r}function oe$3(e,t,i,r,n,o,a){t||0===t||(t=1);const s=ne$3(e.properties,i,r),l=s*t;let u=(o?100*o:0)||s;return n?u=ne$3(e.properties,n,o):a&&(u=s-ne$3(e.properties,a,o)),u*=t,{altitude:l,height:u}}function ae$3(e,t){return t<1/0&&(e.x<0||e.x>t||e.y<0||e.y>t)}function se$3(e){return null==e}function le$3(e,t,i){if(e===i||e===t)return e;const r=i-t;return((e-t)%r+r)%r+t}function ue$3(e,t){if(!t)return null;const i=new Map;for(let r=0;r<t.length;r++){const n=t[r],o=e[n];let a=i.get(o);a||(a=[],i.set(o,a)),a.push(n)}return i}class ce$3{constructor(e,t,i,r){this.feature=e,this.symbol=t,this.fnTypes=i,this.options=r}getPolygonResource(){let e=this.symbol.polygonPatternFile;const{polygonPatternFileFn:t}=this.fnTypes;return this._getResource(e,t)}getLineResource(){let e=this.symbol.linePatternFile;const{linePatternFileFn:t}=this.fnTypes;return this._getResource(e,t)}_getResource(e,t){return t&&(e=t(this.options.zoom,this.feature.properties)),e}}function pe$3(e,t,i,r){const n=Math.abs(r)>>15,o=n>>1,a=n%2;let s=r%Math.pow(2,15);const l=t+(o<<14)*Math.sign(t),u=i+(a<<14)*Math.sign(i);return e[0]=l,e[1]=u,s=Math.round(s),e[2]=0===s?r<0?-1:0:s,e}const he$3=Math.pow(2,14),de$3=Math.pow(2,15);var fe$3={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Mercator, Natural Earth, Globe, and Winkel Tripel. Terrain, fog, sky and CustomLayerInterface are not supported for projections other than mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) — it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesn’t support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] ≠ value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] ≥ value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] ≤ value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] ∈ {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] ∉ {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 ∧ ... ∧ fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 ∨ ... ∨ fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `¬f0 ∧ ... ∧ ¬fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the fog. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the fog to the color of the sky. A value of zero leaves a sharp transition from fog to sky. Increasing the value blends the color of fog into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0° (0° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0°, directly above, to 180°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carrée projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."},globe:{doc:"A globe projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0° is directly above, at zenith, and 90° at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0° is directly above, at zenith, and 90° at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},me$3="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ye$3(e){var t={exports:{}};return e(t,t.exports),t.exports}function ge$3(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
/*! https://mths.be/punycode v1.3.2 by @mathias */ye$3((function(e,t){!function(i){var r=t&&!t.nodeType&&t,n=e&&!e.nodeType&&e,o="object"==typeof me$3&&me$3;o.global!==o&&o.window!==o&&o.self!==o||(i=o);var a,s,l=2147483647,u=/^xn--/,c=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=Math.floor,f=String.fromCharCode;function m(e){throw RangeError(h[e])}function y(e,t){for(var i=e.length,r=[];i--;)r[i]=t(e[i]);return r}function g(e,t){var i=e.split("@"),r="";return i.length>1&&(r=i[0]+"@",e=i[1]),r+y((e=e.replace(p,".")).split("."),t).join(".")}function b(e){for(var t,i,r=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(i=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),n--):r.push(t);return r}function x(e){return y(e,(function(e){var t="";return e>65535&&(t+=f((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+f(e)})).join("")}function v(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,i){var r=0;for(e=i?d(e/700):e>>1,e+=d(e/t);e>455;r+=36)e=d(e/35);return d(r+36*e/(e+38))}function k(e){var t,i,r,n,o,a,s,u,c,p,h,f=[],y=e.length,g=0,b=128,v=72;for((i=e.lastIndexOf("-"))<0&&(i=0),r=0;r<i;++r)e.charCodeAt(r)>=128&&m("not-basic"),f.push(e.charCodeAt(r));for(n=i>0?i+1:0;n<y;){for(o=g,a=1,s=36;n>=y&&m("invalid-input"),((u=(h=e.charCodeAt(n++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:36)>=36||u>d((l-g)/a))&&m("overflow"),g+=u*a,!(u<(c=s<=v?1:s>=v+26?26:s-v));s+=36)a>d(l/(p=36-c))&&m("overflow"),a*=p;v=w(g-o,t=f.length+1,0==o),d(g/t)>l-b&&m("overflow"),b+=d(g/t),g%=t,f.splice(g++,0,b)}return x(f)}function _(e){var t,i,r,n,o,a,s,u,c,p,h,y,g,x,k,_=[];for(y=(e=b(e)).length,t=128,i=0,o=72,a=0;a<y;++a)(h=e[a])<128&&_.push(f(h));for(r=n=_.length,n&&_.push("-");r<y;){for(s=l,a=0;a<y;++a)(h=e[a])>=t&&h<s&&(s=h);for(s-t>d((l-i)/(g=r+1))&&m("overflow"),i+=(s-t)*g,t=s,a=0;a<y;++a)if((h=e[a])<t&&++i>l&&m("overflow"),h==t){for(u=i,c=36;!(u<(p=c<=o?1:c>=o+26?26:c-o));c+=36)_.push(f(v(p+(k=u-p)%(x=36-p),0))),u=d(k/x);_.push(f(v(u,0))),o=w(i,g,r==n),i=0,++r}++i,++t}return _.join("")}if(a={version:"1.3.2",ucs2:{decode:b,encode:x},decode:k,encode:_,toASCII:function(e){return g(e,(function(e){return c.test(e)?"xn--"+_(e):e}))},toUnicode:function(e){return g(e,(function(e){return u.test(e)?k(e.slice(4).toLowerCase()):e}))}},r&&n)if(e.exports==r)n.exports=a;else for(s in a)a.hasOwnProperty(s)&&(r[s]=a[s]);else i.punycode=a}(me$3)}));var be$3=function(e,t,i,r){i=i||"=";var n={};if("string"!=typeof e||0===e.length)return n;var o=/\+/g;e=e.split(t=t||"&");var a=1e3;r&&"number"==typeof r.maxKeys&&(a=r.maxKeys);var s=e.length;a>0&&s>a&&(s=a);for(var l=0;l<s;++l){var u,c,p,h,d=e[l].replace(o,"%20"),f=d.indexOf(i);f>=0?(u=d.substr(0,f),c=d.substr(f+1)):(u=d,c=""),p=decodeURIComponent(u),h=decodeURIComponent(c),ge$3(n,p)?Array.isArray(n[p])?n[p].push(h):n[p]=[n[p],h]:n[p]=h}return n},xe$3=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},ve$3=function(e,t,i,r){return t=t||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(r){var n=encodeURIComponent(xe$3(r))+i;return Array.isArray(e[r])?e[r].map((function(e){return n+encodeURIComponent(xe$3(e))})).join(t):n+encodeURIComponent(xe$3(e[r]))})).join(t):r?encodeURIComponent(xe$3(r))+i+encodeURIComponent(xe$3(e)):""};function we$3(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}ye$3((function(e,t){t.decode=t.parse=be$3,t.encode=t.stringify=ve$3}));class ke$3 extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class _e$3{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new _e$3(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ze$3={kind:"null"},Ae$3={kind:"number"},Te$3={kind:"string"},je$3={kind:"boolean"},Fe$3={kind:"color"},Pe$3={kind:"object"},Se$3={kind:"value"},Me$3={kind:"collator"},Ie$3={kind:"formatted"},Ce$3={kind:"resolvedImage"};function De$3(e,t){return{kind:"array",itemType:e,N:t}}function Ee$3(e){if("array"===e.kind){const t=Ee$3(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Oe$3=[ze$3,Ae$3,Te$3,je$3,Fe$3,Ie$3,Pe$3,De$3(Se$3),Ce$3];function Re$3(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Re$3(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Oe$3)if(!Re$3(e,t))return null}return`Expected ${Ee$3(e)} but found ${Ee$3(t)} instead.`}function Le$3(e,t){return t.some((t=>t.kind===e.kind))}function qe$3(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var Ne$3=ye$3((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function o(e){return r("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function a(e){return function(e){return e<0?0:e>1?1:e}("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function s(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in i)return i[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=n.indexOf("("),u=n.indexOf(")");if(-1!==l&&u+1===n.length){var c=n.substr(0,l),p=n.substr(l+1,u-(l+1)).split(","),h=1;switch(c){case"rgba":if(4!==p.length)return null;h=a(p.pop());case"rgb":return 3!==p.length?null:[o(p[0]),o(p[1]),o(p[2]),h];case"hsla":if(4!==p.length)return null;h=a(p.pop());case"hsl":if(3!==p.length)return null;var d=(parseFloat(p[0])%360+360)%360/360,f=a(p[1]),m=a(p[2]),y=m<=.5?m*(f+1):m+f-m*f,g=2*m-y;return[r(255*s(g,y,d+1/3)),r(255*s(g,y,d)),r(255*s(g,y,d-1/3)),h];default:return null}}return null}}catch(e){}}));class Ue$3{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof Ue$3)return e;if("string"!=typeof e)return;const t=Ne$3.parseCSSColor(e);return t?new Ue$3(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toArray(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}}Ue$3.black=new Ue$3(0,0,0,1),Ue$3.white=new Ue$3(1,1,1,1),Ue$3.transparent=new Ue$3(0,0,0,0),Ue$3.red=new Ue$3(1,0,0,1),Ue$3.blue=new Ue$3(0,0,1,1);class $e$3{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class We$3{constructor(e,t,i,r,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class Ve$3{constructor(e){this.sections=e}static fromString(e){return new Ve$3([new We$3(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Ve$3?e:Ve$3.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class He$3{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new He$3({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ge$3(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Je$3(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Ue$3)return!0;if(e instanceof $e$3)return!0;if(e instanceof Ve$3)return!0;if(e instanceof He$3)return!0;if(Array.isArray(e)){for(const t of e)if(!Je$3(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Je$3(e[t]))return!1;return!0}return!1}function Be$3(e){if(null===e)return ze$3;if("string"==typeof e)return Te$3;if("boolean"==typeof e)return je$3;if("number"==typeof e)return Ae$3;if(e instanceof Ue$3)return Fe$3;if(e instanceof $e$3)return Me$3;if(e instanceof Ve$3)return Ie$3;if(e instanceof He$3)return Ce$3;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=Be$3(t);if(i){if(i===e)continue;i=Se$3;break}i=e}return De$3(i||Se$3,t)}return Pe$3}function Xe$3(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ue$3||e instanceof Ve$3||e instanceof He$3?e.toString():JSON.stringify(e)}class Ze$3{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Je$3(e[1]))return t.error("invalid value");const i=e[1];let r=Be$3(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new Ze$3(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ue$3?["rgba"].concat(this.value.toArray()):this.value instanceof Ve$3?this.value.serialize():this.value}}class Ye$3{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ke$3={string:Te$3,number:Ae$3,boolean:je$3,object:Pe$3};class Qe$3{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Ke$3)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=Ke$3[i],r++}else n=Se$3;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=De$3(n,o)}else i=Ke$3[n];const o=[];for(;r<e.length;r++){const i=t.parse(e[r],r,Se$3);if(!i)return null;o.push(i)}return new Qe$3(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!Re$3(this.type,Be$3(i)))return i;if(t===this.args.length-1)throw new Ye$3(`Expected value to be of type ${Ee$3(this.type)}, but found ${Ee$3(Be$3(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}class et$4{constructor(e){this.type=Ie$3,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Ae$3),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,De$3(Te$3)),!i))return null;let a=null;if(o["text-color"]&&(a=t.parse(o["text-color"],1,Fe$3),!a))return null;const s=r[r.length-1];s.scale=e,s.font=i,s.textColor=a}else{const o=t.parse(e[i],1,Se$3);if(!o)return null;const a=o.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new et$4(r)}evaluate(e){return new Ve$3(this.sections.map((t=>{const i=t.content.evaluate(e);return Be$3(i)===Ce$3?new We$3("",i,null,null,null):new We$3(Xe$3(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class tt$4{constructor(e){this.type=Ce$3,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Te$3);return i?new tt$4(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=He$3.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const it$4={"to-boolean":je$3,"to-color":Fe$3,"to-number":Ae$3,"to-string":Te$3};class rt$4{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const r=it$4[i],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,Se$3);if(!r)return null;n.push(r)}return new rt$4(r,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof Ue$3)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Ge$3(t[0],t[1],t[2],t[3]),!i))return new Ue$3(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ye$3(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Ye$3(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Ve$3.fromString(Xe$3(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?He$3.fromString(Xe$3(this.args[0].evaluate(e))):Xe$3(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new et$4([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new tt$4(this.args[0]).serialize();const e=["to-"+this.type.kind];return this.eachChild((t=>{e.push(t.serialize())})),e}}const nt$4=["Unknown","Point","LineString","Polygon"];class ot$4{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?nt$4[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ue$3.parse(e)),t}}class at$4{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],r=at$4.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,a=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let s=null;for(const[r,o]of a){s=new Ft$3(t.registry,t.path,null,t.scope);const a=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,o=s.parse(i,1+a.length,n);if(!o){l=!0;break}a.push(o)}if(!l)if(Array.isArray(r)&&r.length!==a.length)s.error(`Expected ${r.length} arguments, but found ${a.length} instead.`);else{for(let e=0;e<a.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=a[e];s.concat(e+1).checkSubtype(t,i.type)}if(0===s.errors.length)return new at$4(i,n,o,a)}}if(1===a.length)t.errors.push(...s.errors);else{const i=(a.length?a:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Ee$3).join(", ")})`:`(${Ee$3(t.type)}...)`;var t})).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(Ee$3(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){at$4.definitions=t;for(const i in t)e[i]=at$4}}class st$4{constructor(e,t,i){this.type=Me$3,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,je$3);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,je$3);if(!n)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,Te$3),!o)?null:new st$4(r,n,o)}evaluate(e){return new $e$3(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function lt$4(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function ut$4(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ct$4(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*8192),Math.round(r*n*8192)]}function pt$4(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],o=e[0]-i[0],a=e[1]-i[1];return r*a-o*n==0&&r*o<=0&&n*a<=0}function ht$4(e,t){let i=!1;for(let a=0,s=t.length;a<s;a++){const s=t[a];for(let t=0,a=s.length;t<a-1;t++){if(pt$4(e,s[t],s[t+1]))return!1;(n=s[t])[1]>(r=e)[1]!=(o=s[t+1])[1]>r[1]&&r[0]<(o[0]-n[0])*(r[1]-n[1])/(o[1]-n[1])+n[0]&&(i=!i)}}var r,n,o;return i}function dt$4(e,t){for(let i=0;i<t.length;i++)if(ht$4(e,t[i]))return!0;return!1}function ft$4(e,t,i,r){const n=r[0]-i[0],o=r[1]-i[1],a=(e[0]-i[0])*o-n*(e[1]-i[1]),s=(t[0]-i[0])*o-n*(t[1]-i[1]);return a>0&&s<0||a<0&&s>0}function mt$4(e,t,i){for(const u of i)for(let i=0;i<u.length-1;++i)if(void 0,void 0,0!=(s=[(a=u[i+1])[0]-(o=u[i])[0],a[1]-o[1]])[0]*(l=[(n=t)[0]-(r=e)[0],n[1]-r[1]])[1]-s[1]*l[0]&&ft$4(r,n,o,a)&&ft$4(o,a,r,n))return!0;var r,n,o,a,s,l;return!1}function yt$4(e,t){for(let i=0;i<e.length;++i)if(!ht$4(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(mt$4(e[i],e[i+1],t))return!1;return!0}function gt$4(e,t){for(let i=0;i<t.length;i++)if(yt$4(e,t[i]))return!0;return!1}function bt$4(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=[];for(let r=0;r<e[n].length;r++){const a=ct$4(e[n][r],i);lt$4(t,a),o.push(a)}r.push(o)}return r}function xt$4(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=bt$4(e[n],t,i);r.push(o)}return r}function vt$3(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}lt$4(t,e)}function wt$4(e,t,i,r){const n=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[];for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];vt$3(r,t,i,n),a.push(r)}return a}function kt$3(e,t,i,r){const n=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[];for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];lt$4(t,i),e.push(i)}a.push(e)}if(t[2]-t[0]<=n/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of a)for(const r of e)vt$3(r,t,i,n)}var s;return a}class _t$4{constructor(e,t){this.type=je$3,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Je$3(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new _t$4(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new _t$4(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new _t$4(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const o=bt$4(t.coordinates,r,n),a=wt$4(e.geometry(),i,r,n);if(!ut$4(i,r))return!1;for(const e of a)if(!ht$4(e,o))return!1}if("MultiPolygon"===t.type){const o=xt$4(t.coordinates,r,n),a=wt$4(e.geometry(),i,r,n);if(!ut$4(i,r))return!1;for(const e of a)if(!dt$4(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const o=bt$4(t.coordinates,r,n),a=kt$3(e.geometry(),i,r,n);if(!ut$4(i,r))return!1;for(const e of a)if(!yt$4(e,o))return!1}if("MultiPolygon"===t.type){const o=xt$4(t.coordinates,r,n),a=kt$3(e.geometry(),i,r,n);if(!ut$4(i,r))return!1;for(const e of a)if(!gt$4(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function zt$3(e){if(e instanceof at$4){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof _t$4)return!1;let t=!0;return e.eachChild((e=>{t&&!zt$3(e)&&(t=!1)})),t}function At$3(e){if(e instanceof at$4&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!At$3(e)&&(t=!1)})),t}function Tt$3(e,t){if(e instanceof at$4&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!Tt$3(e,t)&&(i=!1)})),i}class jt$3{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new jt$3(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ft$3{constructor(e,t=[],i,r=new _e$3,n=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i}parse(e,t,i,r,n={}){return t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new Qe$3(t,[e]):"coerce"===i?new rt$4(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof Ze$3)&&"resolvedImage"!==r.type.kind&&function e(t){if(t instanceof jt$3)return e(t.boundExpression);if(t instanceof at$4&&"error"===t.name)return!1;if(t instanceof st$4)return!1;if(t instanceof _t$4)return!1;const i=t instanceof rt$4||t instanceof Qe$3;let r=!0;return t.eachChild((t=>{r=i?r&&e(t):r&&t instanceof Ze$3})),!!r&&(zt$3(t)&&Tt$3(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}(r)){const e=new ot$4;try{r=new Ze$3(r.type,r.evaluate(e))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new Ft$3(this.registry,r,t||null,n,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new ke$3(i,e))}checkSubtype(e,t){const i=Re$3(e,t);return i&&this.error(i),i}}function Pt$3(e,t){const i=e.length-1;let r,n,o=0,a=i,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),r=e[s],n=e[s+1],r<=t){if(s===i||t<n)return s;o=s+1}else{if(!(r>t))throw new Ye$3("Input is not a number.");a=s-1}return 0}class St$3{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Ae$3);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],a=e[i+1],s=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const u=t.parse(a,l,n);if(!u)return null;n=n||u.type,r.push([o,u])}return new St$3(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[Pt$3(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Mt$3=It$3;function It$3(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=i,this.p2y=r}function Ct$3(e,t,i){return e*(1-i)+t*i}It$3.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},It$3.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},It$3.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},It$3.prototype.solveCurveX=function(e,t){var i,r,n,o,a;for(void 0===t&&(t=1e-6),n=e,a=0;a<8;a++){if(o=this.sampleCurveX(n)-e,Math.abs(o)<t)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=o/s}if((n=e)<(i=0))return i;if(n>(r=1))return r;for(;i<r;){if(o=this.sampleCurveX(n),Math.abs(o-e)<t)return n;e>o?i=n:r=n,n=.5*(r-i)+i}return n},It$3.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var Dt$3=Object.freeze({__proto__:null,number:Ct$3,color:function(e,t,i){return new Ue$3(Ct$3(e.r,t.r,i),Ct$3(e.g,t.g,i),Ct$3(e.b,t.b,i),Ct$3(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,r)=>Ct$3(e,t[r],i)))}});const Et$3=6/29,Ot$3=3*Et$3*Et$3,Rt$3=Math.PI/180,Lt$3=180/Math.PI;function qt$3(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ot$3+4/29}function Nt$3(e){return e>Et$3?e*e*e:Ot$3*(e-4/29)}function Ut$3(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function $t$3(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Wt$3(e){const t=$t$3(e.r),i=$t$3(e.g),r=$t$3(e.b),n=qt$3((.4124564*t+.3575761*i+.1804375*r)/.95047),o=qt$3((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-qt$3((.0193339*t+.119192*i+.9503041*r)/1.08883)),alpha:e.a}}function Vt$3(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Nt$3(t),i=.95047*Nt$3(i),r=1.08883*Nt$3(r),new Ue$3(Ut$3(3.2404542*i-1.5371385*t-.4985314*r),Ut$3(-.969266*i+1.8760108*t+.041556*r),Ut$3(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function Ht$3(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Gt$3={forward:Wt$3,reverse:Vt$3,interpolate:function(e,t,i){return{l:Ct$3(e.l,t.l,i),a:Ct$3(e.a,t.a,i),b:Ct$3(e.b,t.b,i),alpha:Ct$3(e.alpha,t.alpha,i)}}},Jt$3={forward:function(e){const{l:t,a:i,b:r}=Wt$3(e),n=Math.atan2(r,i)*Lt$3;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Rt$3,i=e.c;return Vt$3({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Ht$3(e.h,t.h,i),c:Ct$3(e.c,t.c,i),l:Ct$3(e.l,t.l,i),alpha:Ct$3(e.alpha,t.alpha,i)}}};var Bt$3=Object.freeze({__proto__:null,lab:Gt$3,hcl:Jt$3});class Xt$3{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=Zt$3(t,e.base,i,r);else if("linear"===e.name)n=Zt$3(t,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;n=new Mt$3(o[0],o[1],o[2],o[3]).solve(Zt$3(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error("Unknown interpolation type "+String(r[0]),1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,Ae$3),!n)return null;const a=[];let s=null;"interpolate-hcl"===i||"interpolate-lab"===i?s=Fe$3:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(a.length&&a[a.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const u=t.parse(r,l,s);if(!u)return null;s=s||u.type,a.push([i,u])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new Xt$3(s,i,r,n,a):t.error(`Type ${Ee$3(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const o=Pt$3(t,r),a=Xt$3.interpolationFactor(this.interpolation,r,t[o],t[o+1]),s=i[o].evaluate(e),l=i[o+1].evaluate(e);return"interpolate"===this.operator?Dt$3[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?Jt$3.reverse(Jt$3.interpolate(Jt$3.forward(s),Jt$3.forward(l),a)):Gt$3.reverse(Gt$3.interpolate(Gt$3.forward(s),Gt$3.forward(l),a))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Zt$3(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}class Yt$3{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}const o=r&&n.some((e=>Re$3(r,e.type)));return new Yt$3(o?Se$3:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(e),i&&i instanceof He$3&&!i.available&&(t||(t=i),i=null,r===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class Kt$3{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;i.push([n,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new Kt$3(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}class Qt$3{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ae$3),r=t.parse(e[2],2,De$3(t.expectedType||Se$3));return i&&r?new Qt$3(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Ye$3(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Ye$3(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Ye$3(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ei$2{constructor(e,t){this.type=je$3,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Se$3),r=t.parse(e[2],2,Se$3);return i&&r?Le$3(i.type,[je$3,Te$3,Ae$3,ze$3,Se$3])?new ei$2(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee$3(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!qe$3(t,["boolean","string","number","null"]))throw new Ye$3(`Expected first argument to be of type boolean, string, number or null, but found ${Ee$3(Be$3(t))} instead.`);if(!qe$3(i,["string","array"]))throw new Ye$3(`Expected second argument to be of type array or string, but found ${Ee$3(Be$3(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ti$2{constructor(e,t,i){this.type=Ae$3,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Se$3),r=t.parse(e[2],2,Se$3);if(!i||!r)return null;if(!Le$3(i.type,[je$3,Te$3,Ae$3,ze$3,Se$3]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee$3(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Ae$3);return n?new ti$2(i,r,n):null}return new ti$2(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!qe$3(t,["boolean","string","number","null"]))throw new Ye$3(`Expected first argument to be of type boolean, string, number or null, but found ${Ee$3(Be$3(t))} instead.`);if(!qe$3(i,["string","array"]))throw new Ye$3(`Expected second argument to be of type array or string, but found ${Ee$3(Be$3(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ii$2{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},o=[];for(let a=2;a<e.length-1;a+=2){let s=e[a];const l=e[a+1];Array.isArray(s)||(s=[s]);const u=t.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,Be$3(e)))return null}else i=Be$3(e);if(void 0!==n[String(e)])return u.error("Branch labels must be unique.");n[String(e)]=o.length}const c=t.parse(l,a,r);if(!c)return null;r=r||c.type,o.push(c)}const a=t.parse(e[1],1,Se$3);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,r);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(i,a.type)?null:new ii$2(i,r,a,n,o,s):null}evaluate(e){const t=this.input.evaluate(e);return(Be$3(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const e of t){const t=r[this.cases[e]];void 0===t?(r[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,r]of i)e.push(1===r.length?n(r[0]):r.map(n)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}class ri$2{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const o=t.parse(e[n],n,je$3);if(!o)return null;const a=t.parse(e[n+1],n+1,i);if(!a)return null;r.push([o,a]),i=i||a.type}const n=t.parse(e[e.length-1],e.length-1,i);return n?new ri$2(i,r,n):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class ni$2{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Se$3),r=t.parse(e[2],2,Ae$3);if(!i||!r)return null;if(!Le$3(i.type,[De$3(Se$3),Te$3,Se$3]))return t.error(`Expected first argument to be of type array or string, but found ${Ee$3(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Ae$3);return n?new ni$2(i.type,i,r,n):null}return new ni$2(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!qe$3(t,["string","array"]))throw new Ye$3(`Expected first argument to be of type array or string, but found ${Ee$3(Be$3(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function oi$2(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ai$2(e,t,i,r){return 0===r.compare(t,i)}function si$2(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=je$3,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,Se$3);if(!o)return null;if(!oi$2(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${Ee$3(o.type)}'.`);let a=t.parse(e[2],2,Se$3);if(!a)return null;if(!oi$2(i,a.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${Ee$3(a.type)}'.`);if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error(`Cannot compare types '${Ee$3(o.type)}' and '${Ee$3(a.type)}'.`);r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Qe$3(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Qe$3(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,Me$3),!s)return null}return new n(o,a,s)}evaluate(n){const o=this.lhs.evaluate(n),a=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=Be$3(o),i=Be$3(a);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Ye$3(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=Be$3(o),i=Be$3(a);if("string"!==e.kind||"string"!==i.kind)return t(n,o,a)}return this.collator?i(n,o,a,this.collator.evaluate(n)):t(n,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const li$2=si$2("==",(function(e,t,i){return t===i}),ai$2),ui$2=si$2("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!ai$2(0,t,i,r)})),ci$2=si$2("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),pi$2=si$2(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),hi$2=si$2("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),di$2=si$2(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class fi$2{constructor(e,t,i,r,n){this.type=Te$3,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Ae$3);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,Te$3),!n))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,Te$3),!o))return null;let a=null;if(r["min-fraction-digits"]&&(a=t.parse(r["min-fraction-digits"],1,Ae$3),!a))return null;let s=null;return r["max-fraction-digits"]&&(s=t.parse(r["max-fraction-digits"],1,Ae$3),!s)?null:new fi$2(i,n,o,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class mi$2{constructor(e){this.type=Ae$3,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${Ee$3(i.type)} instead.`):new mi$2(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Ye$3(`Expected value to be of type string or array, but found ${Ee$3(Be$3(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const yi$2={"==":li$2,"!=":ui$2,">":pi$2,"<":ci$2,">=":di$2,"<=":hi$2,array:Qe$3,at:Qt$3,boolean:Qe$3,case:ri$2,coalesce:Yt$3,collator:st$4,format:et$4,image:tt$4,in:ei$2,"index-of":ti$2,interpolate:Xt$3,"interpolate-hcl":Xt$3,"interpolate-lab":Xt$3,length:mi$2,let:Kt$3,literal:Ze$3,match:ii$2,number:Qe$3,"number-format":fi$2,object:Qe$3,slice:ni$2,step:St$3,string:Qe$3,"to-boolean":rt$4,"to-color":rt$4,"to-number":rt$4,"to-string":rt$4,var:jt$3,within:_t$4};function gi$2(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,a=Ge$3(t,i,r,o);if(a)throw new Ye$3(a);return new Ue$3(t/255*o,i/255*o,r/255*o,o)}function bi$2(e,t){return e in t}function xi$2(e,t){const i=t[e];return void 0===i?null:i}function vi$2(e){return{type:e}}function wi$2(e){return{result:"success",value:e}}function ki$2(e){return{result:"error",value:e}}function _i$2(e){return!!e.expression&&e.expression.interpolated}function zi$2(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Ai$2(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Ti$2(e){return e}function ji$2(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Fi$2(e,t,i,r,n){return ji$2(typeof i===n?r[i]:void 0,e.default,t.default)}function Pi$2(e,t,i){if("number"!==zi$2(i))return ji$2(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=Pt$3(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function Si$2(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==zi$2(i))return ji$2(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const o=Pt$3(e.stops.map((e=>e[0])),i),a=function(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],l=e.stops[o+1][1];let u=Dt$3[t.type]||Ti$2;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Bt$3[e.colorSpace];u=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),a))}return"function"==typeof s.evaluate?{evaluate(...e){const t=s.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return u(t,i,a)}}:u(s,l,a)}function Mi$2(e,t,i){return"color"===t.type?i=Ue$3.parse(i):"formatted"===t.type?i=Ve$3.fromString(i.toString()):"resolvedImage"===t.type?i=He$3.fromString(i.toString()):zi$2(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),ji$2(i,e.default,t.default)}at$4.register(yi$2,{error:[{kind:"error"},[Te$3],(e,[t])=>{throw new Ye$3(t.evaluate(e))}],typeof:[Te$3,[Se$3],(e,[t])=>Ee$3(Be$3(t.evaluate(e)))],"to-rgba":[De$3(Ae$3,4),[Fe$3],(e,[t])=>t.evaluate(e).toArray()],rgb:[Fe$3,[Ae$3,Ae$3,Ae$3],gi$2],rgba:[Fe$3,[Ae$3,Ae$3,Ae$3,Ae$3],gi$2],has:{type:je$3,overloads:[[[Te$3],(e,[t])=>bi$2(t.evaluate(e),e.properties())],[[Te$3,Pe$3],(e,[t,i])=>bi$2(t.evaluate(e),i.evaluate(e))]]},get:{type:Se$3,overloads:[[[Te$3],(e,[t])=>xi$2(t.evaluate(e),e.properties())],[[Te$3,Pe$3],(e,[t,i])=>xi$2(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Se$3,[Te$3],(e,[t])=>xi$2(t.evaluate(e),e.featureState||{})],properties:[Pe$3,[],e=>e.properties()],"geometry-type":[Te$3,[],e=>e.geometryType()],id:[Se$3,[],e=>e.id()],zoom:[Ae$3,[],e=>e.globals.zoom],pitch:[Ae$3,[],e=>e.globals.pitch||0],"distance-from-center":[Ae$3,[],e=>e.distanceFromCenter()],"heatmap-density":[Ae$3,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ae$3,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Ae$3,[],e=>e.globals.skyRadialProgress||0],accumulated:[Se$3,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Ae$3,vi$2(Ae$3),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[Ae$3,vi$2(Ae$3),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:Ae$3,overloads:[[[Ae$3,Ae$3],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Ae$3],(e,[t])=>-t.evaluate(e)]]},"/":[Ae$3,[Ae$3,Ae$3],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Ae$3,[Ae$3,Ae$3],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Ae$3,[],()=>Math.LN2],pi:[Ae$3,[],()=>Math.PI],e:[Ae$3,[],()=>Math.E],"^":[Ae$3,[Ae$3,Ae$3],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Ae$3,[Ae$3],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ae$3,[Ae$3],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ae$3,[Ae$3],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ae$3,[Ae$3],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ae$3,[Ae$3],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ae$3,[Ae$3],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ae$3,[Ae$3],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ae$3,[Ae$3],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ae$3,[Ae$3],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ae$3,[Ae$3],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ae$3,vi$2(Ae$3),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Ae$3,vi$2(Ae$3),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Ae$3,[Ae$3],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ae$3,[Ae$3],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ae$3,[Ae$3],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ae$3,[Ae$3],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[je$3,[Te$3,Se$3],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[je$3,[Se$3],(e,[t])=>e.id()===t.value],"filter-type-==":[je$3,[Te$3],(e,[t])=>e.geometryType()===t.value],"filter-<":[je$3,[Te$3,Se$3],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[je$3,[Se$3],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[je$3,[Te$3,Se$3],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[je$3,[Se$3],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[je$3,[Te$3,Se$3],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[je$3,[Se$3],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[je$3,[Te$3,Se$3],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[je$3,[Se$3],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[je$3,[Se$3],(e,[t])=>t.value in e.properties()],"filter-has-id":[je$3,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[je$3,[De$3(Te$3)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[je$3,[De$3(Se$3)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[je$3,[Te$3,De$3(Se$3)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[je$3,[Te$3,De$3(Se$3)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:je$3,overloads:[[[je$3,je$3],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[vi$2(je$3),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:je$3,overloads:[[[je$3,je$3],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[vi$2(je$3),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[je$3,[je$3],(e,[t])=>!t.evaluate(e)],"is-supported-script":[je$3,[Te$3],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Te$3,[Te$3],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Te$3,[Te$3],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Te$3,vi$2(Se$3),(e,t)=>t.map((t=>Xe$3(t.evaluate(e)))).join("")],"resolved-locale":[Te$3,[Me$3],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Ii$2{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ot$4,this._defaultValue=t?function(e){return"color"===e.type&&Ai$2(e.default)?new Ue$3(0,0,0,0):"color"===e.type?Ue$3.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,o,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o,a,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Ye$3(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Ci$2(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in yi$2}function Di$2(e,t){const i=new Ft$3(yi$2,[],t?function(e){const t={color:Fe$3,string:Te$3,number:Ae$3,enum:Te$3,boolean:je$3,formatted:Ie$3,resolvedImage:Ce$3};return"array"===e.type?De$3(t[e.value]||Se$3,e.length):t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?wi$2(new Ii$2(r,t)):ki$2(i.errors)}class Ei$2{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!At$3(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class Oi$2{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!At$3(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?Xt$3.interpolationFactor(this.interpolationType,e,t,i):0}}function Ri$2(e,t){if("error"===(e=Di$2(e,t)).result)return e;const i=e.value.expression,r=zt$3(i);if(!r&&!function(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}(t))return ki$2([new ke$3("","data expressions not supported")]);const n=Tt$3(i,["zoom","pitch","distance-from-center"]);if(!n&&!function(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}(t))return ki$2([new ke$3("","zoom expressions not supported")]);const o=function e(t){let i=null;if(t instanceof Kt$3)i=e(t.result);else if(t instanceof Yt$3){for(const r of t.args)if(i=e(r),i)break}else(t instanceof St$3||t instanceof Xt$3)&&t.input instanceof at$4&&"zoom"===t.input.name&&(i=t);return i instanceof ke$3||t.eachChild((t=>{const r=e(t);r instanceof ke$3?i=r:!i&&r?i=new ke$3("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&r&&i!==r&&(i=new ke$3("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}(i);if(!o&&!n)return ki$2([new ke$3("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof ke$3)return ki$2([o]);if(o instanceof Xt$3&&!_i$2(t))return ki$2([new ke$3("",'"interpolate" expressions cannot be used with this property')]);if(!o)return wi$2(new Ei$2(r?"constant":"source",e.value));return wi$2(new Oi$2(r?"camera":"composite",e.value,o.labels,o instanceof Xt$3?o.interpolation:void 0))}class Li$2{constructor(e,t){this._parameters=e,this._specification=t,we$3(this,function e(t,i){const r="color"===i.type,n=t.stops&&"object"==typeof t.stops[0][0],o=n||!(n||void 0!==t.property),a=t.type||(_i$2(i)?"exponential":"interval");if(r&&((t=we$3({},t)).stops&&(t.stops=t.stops.map((e=>[e[0],Ue$3.parse(e[1])]))),t.default=Ue$3.parse(t.default?t.default:i.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Bt$3[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);let s,l,u;if("exponential"===a)s=Si$2;else if("interval"===a)s=Pi$2;else if("categorical"===a){s=Fi$2,l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];u=typeof t.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);s=Mi$2}if(n){const r={},n=[];for(let e=0;e<t.stops.length;e++){const i=t.stops[e],o=i[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},n.push(o)),r[o].stops.push([i[0].value,i[1]])}const o=[];for(const t of n)o.push([r[t].zoom,e(r[t],i)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:Xt$3.interpolationFactor.bind(void 0,a),zoomStops:o.map((e=>e[0])),evaluate:({zoom:e},r)=>Si$2({stops:o,base:t.base},i,e).evaluate(e,r)}}if(o){const e="exponential"===a?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:e,interpolationFactor:Xt$3.interpolationFactor.bind(void 0,e),zoomStops:t.stops.map((e=>e[0])),evaluate:({zoom:e})=>s(t,i,e,l,u)}}return{kind:"source",evaluate(e,r){const n=r&&r.properties?r.properties[t.property]:void 0;return void 0===n?ji$2(t.default,i.default):s(t,i,n,l,u)}}}(this._parameters,this._specification))}static deserialize(e){return new Li$2(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function qi$2(e){if(Array.isArray(e))return e.map(qi$2);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=qi$2(e[i]);return t}return function(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}(e)}function Ni$2(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ni$2(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function $i$2(e){if(!Array.isArray(e))return!1;if(function(e){return"pitch"===e||"distance-from-center"===e}(e[0]))return!0;for(let t=1;t<e.length;t++)if($i$2(e[t]))return!0;return!1}const Wi$2=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Vi$2(e,t){return e<t?-1:e>t?1:0}function Hi$2(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Gi$2(e[1],e[2],"=="):"!="===t?Xi$2(Gi$2(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Gi$2(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(Hi$2))):"all"===t?["all"].concat(e.slice(1).map(Hi$2)):"none"===t?["all"].concat(e.slice(1).map(Hi$2).map(Xi$2)):"in"===t?Ji$2(e[1],e.slice(2)):"!in"===t?Xi$2(Ji$2(e[1],e.slice(2))):"has"===t?Bi$2(e[1]):"!has"===t?Xi$2(Bi$2(e[1])):"within"!==t||e;var i}function Gi$2(e,t,i){switch(e){case"$type":return["filter-type-"+i,t];case"$id":return["filter-id-"+i,t];default:return["filter-"+i,e,t]}}function Ji$2(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Vi$2)]]:["filter-in-small",e,["literal",t]]}}function Bi$2(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Xi$2(e){return["!",e]}ye$3((function(e,t){var i=function(){var e=function(e,t,i,r){for(i=i||{},r=e.length;r--;i[e[r]]=t);return i},t=[1,12],i=[1,13],r=[1,9],n=[1,10],o=[1,11],a=[1,14],s=[1,15],l=[14,18,22,24],u=[18,22],c=[22,24],p={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(e,t,i,r,n,o,a){var s=o.length-1;switch(n){case 1:this.$=new String(e.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(e),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=o[s-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=o[s-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[o[s-2],o[s]];break;case 16:this.$={},this.$[o[s][0]]=o[s][1];break;case 17:this.$=o[s-2],o[s-2][o[s][0]]=o[s][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[o[s]];break;case 21:this.$=o[s-2],o[s-2].push(o[s])}},table:[{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,12:1,13:2,15:7,16:8,17:a,23:s},{1:[3]},{14:[1,16]},e(l,[2,7]),e(l,[2,8]),e(l,[2,9]),e(l,[2,10]),e(l,[2,11]),e(l,[2,12]),e(l,[2,3]),e(l,[2,4]),e(l,[2,5]),e([14,18,21,22,24],[2,1]),e(l,[2,2]),{3:20,4:t,18:[1,17],19:18,20:19},{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:23,15:7,16:8,17:a,23:s,24:[1,21],25:22},{1:[2,6]},e(l,[2,13]),{18:[1,24],22:[1,25]},e(u,[2,16]),{21:[1,26]},e(l,[2,18]),{22:[1,28],24:[1,27]},e(c,[2,20]),e(l,[2,14]),{3:20,4:t,20:29},{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:30,15:7,16:8,17:a,23:s},e(l,[2,19]),{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:31,15:7,16:8,17:a,23:s},e(u,[2,17]),e(u,[2,15]),e(c,[2,21])],defaultActions:{16:[2,6]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){var t=this,i=[0],r=[null],n=[],o=this.table,a="",s=0,l=0,u=2,c=1,p=n.slice.call(arguments,1),h=Object.create(this.lexer),d={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(d.yy[f]=this.yy[f]);h.setInput(e,d.yy),d.yy.lexer=h,d.yy.parser=this,void 0===h.yylloc&&(h.yylloc={});var m=h.yylloc;n.push(m);var y=h.options&&h.options.ranges;function g(){var e;return"number"!=typeof(e=h.lex()||c)&&(e=t.symbols_[e]||e),e}this.parseError="function"==typeof d.yy.parseError?d.yy.parseError:Object.getPrototypeOf(this).parseError;for(var b,x,v,w,k,_,z,A={};;){if(this.defaultActions[x=i[i.length-1]]?v=this.defaultActions[x]:(null==b&&(b=g()),v=o[x]&&o[x][b]),void 0===v||!v.length||!v[0]){var T="";for(k in z=[],o[x])this.terminals_[k]&&k>u&&z.push("'"+this.terminals_[k]+"'");T=h.showPosition?"Parse error on line "+(s+1)+":\n"+h.showPosition()+"\nExpecting "+z.join(", ")+", got '"+(this.terminals_[b]||b)+"'":"Parse error on line "+(s+1)+": Unexpected "+(b==c?"end of input":"'"+(this.terminals_[b]||b)+"'"),this.parseError(T,{text:h.match,token:this.terminals_[b]||b,line:h.yylineno,loc:m,expected:z})}if(v[0]instanceof Array&&v.length>1)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+b);switch(v[0]){case 1:i.push(b),r.push(h.yytext),n.push(h.yylloc),i.push(v[1]),b=null,l=h.yyleng,a=h.yytext,s=h.yylineno,m=h.yylloc;break;case 2:if(A.$=r[r.length-(_=this.productions_[v[1]][1])],A._$={first_line:n[n.length-(_||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(_||1)].first_column,last_column:n[n.length-1].last_column},y&&(A._$.range=[n[n.length-(_||1)].range[0],n[n.length-1].range[1]]),void 0!==(w=this.performAction.apply(A,[a,l,s,d.yy,v[1],r,n].concat(p))))return w;_&&(i=i.slice(0,-1*_*2),r=r.slice(0,-1*_),n=n.slice(0,-1*_)),i.push(this.productions_[v[1]][0]),r.push(A.$),n.push(A._$),i.push(o[i[i.length-2]][i[i.length-1]]);break;case 3:return!0}}return!0}};function h(){this.yy={}}return p.lexer={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===r.length?this.yylloc.first_column:0)+r[r.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var i,r,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],i=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var o in n)this[o]=n[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,i,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),o=0;o<n.length;o++)if((i=this._input.match(this.rules[n[o]]))&&(!t||i[0].length>t[0].length)){if(t=i,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(i,n[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,n[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,i,r){switch(i){case 0:break;case 1:return 6;case 2:return t.yytext=t.yytext.substr(1,t.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},h.prototype=p,p.Parser=h,new h}();t.parser=i,t.Parser=i.Parser,t.parse=function(){return i.parse.apply(i,arguments)}}));const Zi$2={StyleExpression:Ii$2,isExpression:Ci$2,isExpressionFilter:Ni$2,createExpression:Di$2,createPropertyExpression:Ri$2,normalizePropertyExpression:function(e,t){if(Ai$2(e))return new Li$2(e,t);if(Ci$2(e)){const i=Ri$2(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=Ue$3.parse(e)),{kind:"constant",evaluate:()=>i}}},ZoomConstantExpression:Ei$2,ZoomDependentExpression:Oi$2,StylePropertyFunction:Li$2},{isExpression:Yi$2,createExpression:Ki$2}=Zi$2,Qi$2={};function er$3(e){if(!0===e)return function(){return!0};if(e&&e.condition){if("any"===e.type){const t=e.condition,i=[];for(let e=0;e<t.length;e++)i.push(er$3(t[e]));return(e,t)=>{for(let r=0;r<i.length;r++)if(i[r](e,t))return!0;return!1}}const t=er$3(e.condition);if(N$6(e.layer))return t;const i=t=>t.layer===e.layer;return(e,r)=>i(e)&&t(e,r)}if(isFeatureFilter(e))return createFilter(e);{let t=function(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ni$2(e)||(e=Hi$2(e));const i=e;let r=!0;try{r=function(e){if(!$i$2(e))return e;let t=qi$2(e);return function e(t){let i=!1;const r=[];if("case"===t[0]){for(let e=1;e<t.length-1;e+=2)i=i||$i$2(t[e]),r.push(t[e+1]);r.push(t[t.length-1])}else if("match"===t[0]){i=i||$i$2(t[1]);for(let e=2;e<t.length-1;e+=2)r.push(t[e+1]);r.push(t[t.length-1])}else if("step"===t[0]){i=i||$i$2(t[1]);for(let e=1;e<t.length-1;e+=2)r.push(t[e+1])}i&&(t.length=0,t.push("any",...r));for(let i=1;i<t.length;i++)e(t[i])}(t),t=function e(t){if(!Array.isArray(t))return t;const i=function(e){if(Wi$2.has(e[0]))for(let t=1;t<e.length;t++)if($i$2(e[t]))return!0;return e}(t);return!0===i?i:i.map((t=>e(t)))}(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const n=fe$3["filter_"+t],o=Di$2(r,n);let a=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(e,t,i)=>o.value.evaluate(e,t,{},i);let s=null,l=null;if(r!==i){const e=Di$2(i,n);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(t,i,r,n,o)=>e.value.evaluate(t,i,{},r,void 0,void 0,n,o),l=!zt$3(e.value.expression)}return{filter:a,dynamicFilter:s||void 0,needGeometry:function e(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let i=1;i<t.length;i++)if(e(t[i]))return!0;return!1}(r),needFeature:!!l}}(e);return t=t&&t.filter,(e,i)=>(Qi$2.zoom=i,t&&t(Qi$2,e))}}const tr$3={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function ir$3(e,t){tr$3.type=t||"number";const i=Ki$2(e,tr$3);if("success"!==i.result)throw new Error(`Invalid maplibre spec expression: ${JSON.stringify(e)} (${i.value})`);return i.value}function rr$3(e){return Yi$2(e)}const nr$3={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function or$3(e){return nr$3[e]}const ar$3={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1},sr$3={lineDasharray:1,markerLineDasharray:1,uvScale:1,uvOffset:1};function lr$3(e){return ar$3[e]?"string":or$3(e)?"number":sr$3[e]?"array":"color"}var ur$3=Object.freeze({__proto__:null,compileStyle:function(e=[]){return function e(t){if(!Array.isArray(t))return e([t]);const i=[];for(let e=0;e<t.length;e++){let r;r=!0===t[e].filter?function(){return!0}:er$3(t[e].filter),i.push(q$5({},t[e],{filter:r}))}return i}(e=e.map((e=>{const t=q$5({},e);return t.filter&&t.filter.value&&(t.filter=t.filter.value),t})))},compileFilter:er$3,createExpression:ir$3,isExpression:rr$3,isInterpolated:or$3,getExpressionType:lr$3});const cr$3=[],pr$3={},hr$3={},dr$3={},fr$3=[];class mr$3{static isAtlasLoaded(e,t={}){const{iconAtlas:i}=t;return!!(!e||i&&i.positions[e])}static genFnTypes(e){const t={};for(const i in e)if(rr$3(e[i])){const r=(i+"_Fn_0").trim(),n=(i+"Fn").trim(),o=lr$3(i);t[r]=ir$3(e[i],o),t[n]=(e,i)=>{let n;pr$3.zoom=e,hr$3.properties=i;try{n=t[r].evaluateWithoutErrorHandling(pr$3,hr$3,dr$3,null,fr$3)}catch(e){return null}return n}}else if(B$5(e[i])){const o=(i+"_Fn_0").trim(),a=(i+"Fn").trim();or$3(i)?(t[o]=interpolated(e[i]),t[a]=(e,i)=>{const n=t[o](e,i);return B$5(n)?interpolated(n)(e,i):n}):(t[o]=piecewiseConstant(e[i]),t[a]=(e,i)=>{const r=t[o](e,i);return B$5(r)?piecewiseConstant(r)(e,i):r})}return t}constructor(e,t,i){this.options=i;const n=[];this.symbolDef=t,this.symbol=loadFunctionTypes(t,(()=>(n[0]=i.zoom,n))),this.styledVectors=[],this.properties={},this._fnTypes=i.fnTypes||mr$3.genFnTypes(this.symbolDef),B$5(this.symbolDef.visible)&&(this._visibleFn=interpolated(this.symbolDef.visible)),i.atlas&&(this.iconAtlas=i.atlas.iconAtlas,this.glyphAtlas=i.atlas.glyphAtlas),this.features=this._check(e)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=Math.pow(2,17)||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Int16Array,width:3,name:"aPosition"}]}fillPosition(e,t,i,r){this.needAltitudeAttribute()?(e.aPosition.push(t,i),e.aAltitude.push(r)):(pe$3(cr$3,t,i,r),e.aPosition.push(cr$3[0],cr$3[1],cr$3[2]))}_check(t){if(!t.length)return t;const i="__fea_idx".trim();let r,n=0,o=t[n];for(;!o.geometry;)n++,o=t[n];if(Array.isArray(o.geometry)&&o.properties){let i=o.geometry[0];for(;Array.isArray(i);)i=i[0];i instanceof pointGeometry&&(r=t)}if(!r)if(r=[],Array.isArray(o.geometry))for(let e=0;e<t.length;e++){const i=q$5({},t[e]);r.push(L$6(i))}else for(let e=0;e<t.length;e++){const n=t[e],o=x$4(n);for(let e=0;e<o.length;e++){const t=o[e];t[i]=n[i],r.push(t)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const e="line"===this.symbolDef.textPlacement;let t=0,i=!1;const{textPitchAlignmentFn:n}=this._fnTypes;!n&&e&&"map"===this.symbolDef.textPitchAlignment&&(i=!0);for(let o=0;o<r.length;o++){const a=gr$3(r[o]&&r[o].geometry);if(a>t&&(t=a),e&&!i&&n&&r[o].properties){const e=n(null,r[o].properties);"map"===e&&(i=e)}}this.hasMapPitchAlign=i,this.maxPosZ=t}const a=this.options.order;if(a){const e=[];for(let t=0;t<a.length;t++)a[t]&&e.push(er$3(a[t]));r=r.sort(((t,i)=>{const r=e.length;let n=-1,o=-1;for(let a=0;a<r&&(e[a](t)&&(n=a),e[a](i)&&(o=a),!(n>=0&&n<r&&o>=0&&o<r));a++);return n-o}))}return r}load(e=1){const t="__fea_idx".trim(),i="_debug_info".trim(),r=this._fnTypes,n=this.styledVectors;this.count=0;const a=this.features;if(!a||!a.length)return Promise.resolve(null);const s={},l={},u={zoom:this.options.zoom},c=[],p=loadFunctionTypes(this.symbolDef,(()=>(c[0]=u.zoom,c)));let h=0,d=a.length;const f=this.options.debugIndex;try{for(;h<d;h++){const e=a[h];if(!e||!e.geometry)continue;if(void 0!==f&&e[i].index!==f)continue;e.properties||(e.properties={}),e.properties.$layer=e.layer,e.properties.$type=e.type;const o=this.createStyledVector(e,p,r,u,s,l);o&&o.feature.geometry&&(o.featureIdx=void 0===e[t]?h:e[t],this.count++,n.push(o))}}catch(e){return Promise.reject(e)}return this.options.atlas?Promise.resolve(this.pack(e)):this.loadAtlas(s,l).then((()=>this.pack(e)))}loadAtlas(e,t){return new Promise(((i,r)=>{this.fetchAtlas(e,t,((e,t)=>{if(e)r(e);else{if(t){const{icons:e,glyphs:i}=t;if(e&&Object.keys(e).length){for(const t in e){const i=e[t],{width:r,height:n,data:o}=i.data;i.data=new P$5({width:r,height:n},o)}this.iconAtlas=new M$5(e)}if(i&&Object.keys(i).length){for(const e in i){const t=i[e];for(const e in t){const i=t[e],{width:r,height:n,data:o}=i.bitmap;i.bitmap=new F$5({width:r,height:n},o)}}this.glyphAtlas=new D$5(i)}}i({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}}))}))}fetchAtlas(e,t,i){Object.keys(e).length>0||Object.keys(t).length>0?this.options.requestor(e,t,i):i()}pack(e){if(!this.count)return null;if(null==e)throw new Error("layout scale is undefined");const t=this.createDataPack(this.styledVectors,e);if(!t)return null;t.properties=this.properties,this.empty&&(t.empty=!0);const i=t.buffers;delete t.buffers;const r={data:t,buffers:i};if(this.iconAtlas){const e=r.data.iconAtlas=yr$3(this.iconAtlas);if(e.glyphMap)for(const t in e.glyphMap)i.push(e.glyphMap[t].data.data.buffer);i.push(r.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(r.data.glyphAtlas=yr$3(this.glyphAtlas),i.push(r.data.glyphAtlas.image.data.buffer)),r}createStyledVector(e,t,i,r){return new ce$3(e,t,i,r)}createDataPack(e,t){if(!e||!e.length)return null;this.maxIndex=0,this.maxPos=0,this.maxAltitude=0;const i=this.data={};let r=this.elements=[];const n=this.getFormat(Array.isArray(e[0])?e[0][0].symbol:e[0].symbol),o=this.needAltitudeAttribute()?2:3;for(let e=0;e<n.length;e++)i[n[e].name]=[];let a=[],s=0;const l=[];let u=0,c=!1,p=!0;const h=new Set;for(let r=0,n=e.length;r<n;r++){if(!e[r].feature.geometry)continue;const n=Array.isArray(e[r])?e[r][0].feature.id:e[r].feature.id;p&&(void 0!==hr$3.id?h&&(h.has(hr$3.id)?p=!1:h.add(hr$3.id)):p=!1),U$5(n)&&(Math.abs(n)>u&&(u=Math.abs(n)),n<0&&(c=!0));const d=this.data.aPosition.length;if(Array.isArray(e[r]))for(let i=0;i<e[r].length;i++)this._placeVector(e[r][i],t);else this._placeVector(e[r],t);const f=(i.aPosition.length-d)/o;for(let t=0;t<f;t++)a.push(e[r].featureIdx),U$5(n)&&l.push(n);s=Math.max(s,e[r].featureIdx)}if(this.hasElements()&&!r.length)return null;a=new(R$5(s))(a),n[0].type=this.options.positionType?this.options.positionType:O$5(this.maxPos);const d=this.options.center;if(d&&(d[0]||d[1])){const e=i.aPosition;for(let t=0;t<e.length;t+=o)e[t]-=d[0],e[t+1]-=d[1]}const f=function(e,t){const i={};for(let r=0;r<e.length;r++){const n=e[r],o=n.type,a=n.name;i[a]=o===Array?t[a]:new o(t[a])}return i}(n,i);f.aPickingId=a;const m=[];for(const e in f)m.push(f[e].buffer);r=new(E$4(this.maxIndex))(r),m.push(r.buffer);const y={data:f,isIdUnique:p,is2D:0===this.maxPosZ,indices:this.hasElements()?r:null,positionSize:o,buffers:m,symbolIndex:this.symbolDef.index||{index:0}};if(this._packMarkerPlacement&&(y.markerPlacement=this._packMarkerPlacement),this._packTextPlacement&&(y.textPlacement=this._packTextPlacement),l.length){const e=c?O$5(u):R$5(u);y.featureIds=new e(l),m.push(y.featureIds.buffer)}else y.featureIds=[];return y.pickingIdIndiceMap=ue$3(a,y.indices),y}_placeVector(e,t){this._visibleFn&&!this._visibleFn(this.options.zoom,e.feature.properties)||this.placeVector(e,t,this.formatWidth)}addElements(...e){this.maxIndex=Math.max(this.maxIndex,...e),this.elements.push(...e)}hasElements(){return!0}getAltitude(e){const{altitudeProperty:t,defaultAltitude:i,altitudeScale:r}=this.options;let n=ne$3(e,t,i);return r&&(n*=r),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(n)),n}getIconAtlasMaxValue(){const e=this.iconAtlas.positions;let t=0;for(const i in e)if(G$5(e,i)){const{tl:r,displaySize:n}=e[i],o=Math.max(r[0],r[1],n[0]-1,n[1]-1);o>t&&(t=o)}return t}}function yr$3(e){let t=e.positions,i=e.image&&e.image.format||"alpha";if(e instanceof M$5){t={};for(const i in e.positions){const r=e.positions[i];t[i]={paddedRect:r.paddedRect,pixelRatio:r.pixelRatio,tl:r.tl,br:r.br,displaySize:r.displaySize}}i="rgba"}const r=e.image;return{image:{width:r.width,height:r.height,data:r.data,format:i},glyphMap:e.glyphMap,positions:t}}function gr$3(e){if(!e)return 0;let t=0;if(Array.isArray(e))for(let i=0;i<e.length;i++)if(Array.isArray(e[i])){const r=gr$3(e[i]);r>t&&(t=r)}else{const r=Math.abs(e[i].z||0);r>t&&(t=r)}else{const i=Math.abs(e.z||0);i>t&&(t=i)}return t}function br$3(e,t,i,r){const n="__fn_textSize".trim();let o=e.textSize;if(N$6(t.textSize))return[16,16];e[n]&&(o=e[n]);const a=[];return a[0]=V$6(o)?o(r,i):o,a[1]=a[0],a}function xr$3(e){const t=e.stops;let i=-1/0;for(let e=0;e<t.length;e++){let r=t[e][1];$$5(t[e][1])&&(r=xr$3(t[e][1])),r>i&&(i=r)}return i}function vr$3(e,t,i){return[t||"normal",i||"normal","24px",e||"monospace"].join(" ")}const wr$3=/\{[\w-]+(?:\|[\w-]+)*\}/g;function kr$3(e,t){return W$5(e)?e.replace(wr$3,(function(e){if(!t)return"";if((e=e.substring(1,e.length-1)).indexOf("|")>0){const i=e.split("|");for(let e=0;e<i.length;e++){const r=t[i[e]];if(!N$6(r))return r}return""}const i=t[e];return N$6(i)?"":Array.isArray(i)?i.join():i})):e}var _r$3=Object.freeze({__proto__:null,getSDFFont:vr$3,resolveText:kr$3,resolveVarNames:function(e){return e.match(wr$3)},resolveExpVarNames:function e(t,i){if(2!==i.length||"get"!==i[0])for(let r=0;r<i.length;r++)2===i[r].length&&"get"===i[r][0]?t.push(i[r][1]):Array.isArray(i[r])&&e(t,i[r]);else t.push(i[1])}});const Ur$3=e=>e>=11904&&e<=12031,$r$3=e=>e>=12032&&e<=12255,Wr$3=e=>e>=12272&&e<=12287,Vr$3=e=>e>=12288&&e<=12351,Hr$3=e=>e>=12352&&e<=12447,Gr$3=e=>e>=12448&&e<=12543,Jr$3=e=>e>=12544&&e<=12591,Zr$3=e=>e>=12704&&e<=12735,Yr$3=e=>e>=12736&&e<=12783,Kr$3=e=>e>=12784&&e<=12799,Qr$3=e=>e>=12800&&e<=13055,en$3=e=>e>=13056&&e<=13311,tn$3=e=>e>=13312&&e<=19903,nn$3=e=>e>=19968&&e<=40959,on$3=e=>e>=40960&&e<=42127,an$3=e=>e>=42128&&e<=42191,pn$2=e=>e>=63744&&e<=64255,hn$2=e=>e>=64336&&e<=65023,dn$2=e=>e>=65040&&e<=65055,fn$2=e=>e>=65072&&e<=65103,mn$2=e=>e>=65104&&e<=65135,yn$2=e=>e>=65136&&e<=65279,gn$2=e=>e>=65280&&e<=65519;function bn$2(e){return!((e=>e>=1536&&e<=1791)(e)||(e=>e>=1872&&e<=1919)(e)||(e=>e>=2208&&e<=2303)(e)||hn$2(e)||yn$2(e))}function xn$2(e){return!!(746===e||747===e||!(e<4352)&&(Zr$3(e)||Jr$3(e)||fn$2(e)&&!(e>=65097&&e<=65103)||pn$2(e)||en$3(e)||Ur$3(e)||Yr$3(e)||!(!Vr$3(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||tn$3(e)||nn$3(e)||Qr$3(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||(e=>e>=44032&&e<=55215)(e)||Hr$3(e)||Wr$3(e)||(e=>e>=12688&&e<=12703)(e)||$r$3(e)||Kr$3(e)||Gr$3(e)&&12540!==e||!(!gn$2(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!mn$2(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||dn$2(e)||(e=>e>=19904&&e<=19967)(e)||on$3(e)||an$3(e)))}function vn$2(e){return!(xn$2(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Vr$3(e)||Gr$3(e)||(e=>e>=57344&&e<=63743)(e)||fn$2(e)||mn$2(e)||gn$2(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function wn$2(e){return e>=1424&&e<=2303||hn$2(e)||yn$2(e)}const kn$2=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function _n$2(e){for(const t of kn$2)if(e>=t[0]&&e<=t[1])return!0;return!1}const zn$2={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function jn$2(e,t,i,r,n,o,a,s,l,u){let c=e.trim();2===u&&(c=function(e){let t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,n=e.charCodeAt(i-1)||null;t+=r&&vn$2(r)&&!zn$2[e[i+1]]||n&&vn$2(n)&&!zn$2[e[i-1]]||!zn$2[e[i]]?e[i]:zn$2[e[i]]}return t}(c));const p=[],h={positionedGlyphs:p,text:c,top:s[1],bottom:s[1],left:s[0],right:s[0],writingMode:u};let d;return d=function(e,t){const i=[];let r=0;for(let n=0;n<t.length;n++){const o=t[n];i.push(e.substring(r,o)),r=o}return r<e.length&&i.push(e.substring(r,e.length)),i}(c,function(e,t,i,r){if(!i)return[];if(!e)return[];const n=[],o=function(e,t,i,r){let n=0;for(let i=0;i<e.length;i++){const o=r[e.charCodeAt(i)];o&&(n+=o.metrics.advance+t)}return n/Math.max(1,Math.ceil(n/i))}(e,t,i,r);let a=0;for(let i=0;i<e.length;i++){const l=e.charCodeAt(i),u=r[l];u&&!Fn$2[l]&&(a+=u.metrics.advance+t),i<e.length-1&&(Pn$2[l]||!((s=l)<11904)&&(Zr$3(s)||Jr$3(s)||fn$2(s)||pn$2(s)||en$3(s)||Ur$3(s)||Yr$3(s)||Vr$3(s)||tn$3(s)||nn$3(s)||Qr$3(s)||gn$2(s)||Hr$3(s)||Wr$3(s)||$r$3(s)||Kr$3(s)||Gr$3(s)||dn$2(s)||an$3(s)||on$3(s)))&&n.push(In$2(i+1,a,o,n,Mn$2(l,e.charCodeAt(i+1)),!1))}var s;return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(In$2(e.length,a,o,n,0,!0))}(c,a,i,t)),function(e,t,i,r,n,o,a,s,l){let u=0,c=8,p=0;const h=e.positionedGlyphs,d="right"===o?1:"left"===o?0:.5;for(let e=0;e<i.length;e++){let n=i[e];if(n=n.trim(),!n.length){c-=r;continue}const o=h.length;for(let e=0;e<n.length;e++){const i=n.charCodeAt(e),r=t[i];r&&(xn$2(i)&&1!==a?(32!==i&&h.push({glyph:i,x:u,y:0,vertical:!0}),u+=l+s):(32!==i&&h.push({glyph:i,x:u,y:c,vertical:!1}),u+=r.metrics.advance+s))}h.length!==o&&(p=Math.max(u-s,p),Dn$2(h,t,o,h.length-1,d)),u=0,c-=r}const{horizontalAlign:f,verticalAlign:m}=Cn$2(n);!function(e,t,i,r,n,o,a){const s=(t-i)*n,l=-(-r*a+.5)*o;if(s||l)for(let t=0;t<e.length;t++)e[t].x+=s,e[t].y+=l}(h,d,f,m,p,r,i.length);const y=i.length*r;e.top+=-m*y,e.bottom=e.top+y,e.left+=-f*p,e.right=e.left+p}(h,t,d,r,n,o,u,a,l),!!p.length&&h}const Fn$2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Pn$2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sn$2(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function Mn$2(e,t){let i=0;return 10===e&&(i-=1e4),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function In$2(e,t,i,r,n,o){let a=null,s=Sn$2(t,i,n,o);for(let e=0;e<r.length;e++){const l=r[e],u=Sn$2(t-l.x,i,n,o)+l.badness;u<=s&&(a=l,s=u)}return{index:e,x:t,priorBreak:a,badness:s}}function Cn$2(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Dn$2(e,t,i,r,n){if(!n)return;const o=t[e[r].glyph];if(o){const t=(e[r].x+o.metrics.advance)*n;if(!t)return;for(let n=i;n<=r;n++)e[n].x-=t}}function En$2(e){if(!function(e){for(const t of e)if(wn$2(t.charCodeAt(0)))return!0;return!1}(e))return e;const t=[],i=[],r=[];let n=0,o=0,a=1,s=1;for(const l of e){const e=l.codePointAt(0);_n$2(e)?(r.push(l),n++):(a=wn$2(e)?-1:1,s!==a?(o=n,i.length&&(s>0&&i.reverse(),t.push(...i)),r.length&&(t.splice(o,0,...r),r.length=0),s=a,i.length=0):r.length&&(i.push(...r),r.length=0),i.push(l),n++)}return r.length&&i.push(...r),i.length&&(s>0&&i.reverse(),t.push(...i)),t.reverse().join("")}const On$2=/\{ *([\w_]+) *\}/g;class Rn$2{constructor(e,t,i,r,n){this.feature=e,this.symbolDef=t,this.symbol=i,this.options=n,this._thisReplacer=this._replacer.bind(this),this._fnTypes=r}_replacer(e,t){return this.feature.properties[t]||"default"}getShape(e,t){if(this._shape)return this._shape;const{textHorizontalAlignmentFn:i,textVerticalAlignmentFn:r,markerHorizontalAlignmentFn:n,markerVerticalAlignmentFn:o,textWrapWidthFn:a}=this._fnTypes;let s;const l=this.symbol,u=this.getIconAndGlyph(),c=this.feature.properties;if(u&&u.glyph){const{font:e,text:n}=u.glyph;if(""===n)return null;const o=this.size[0]/24,p=24,h=l.textKeepUpright,d="map"===l.textRotationAlignment&&"line"===l.textPlacement&&!l.isIconText,f=t.glyphMap[e],m=Ln$2(i?i(null,c):l.textHorizontalAlignment,r?r(null,c):l.textVerticalAlignment),y=1.2*p,g=function(e){for(let t=0;t<e.length;t++)if(!bn$2(e.charAt(t).charCodeAt(0)))return!1;return!0}(n),b=g&&l.textLetterSpacing/o||0,x=[l.textDx/o||0,l.textDy/o||0],v=((a?a(null,c):l.textWrapWidth)||10*p)/o;s={},s.horizontal=jn$2(n,f,v,y,m,"center",b,x,p,1),g&&d&&h&&(s.vertical=jn$2(n,f,v,y,m,"center",b,x,p,2))}else if(u&&u.icon){if(!e.positions[u.icon.url])return null;const t=Ln$2(n?n(null,c):l.markerHorizontalAlignment,o?o(null,c):l.markerVerticalAlignment);s=function(e,t){const{horizontalAlign:i,verticalAlign:r}=Cn$2(t),n=-2048*i,o=-2048*r;return{image:e,top:o,bottom:o+2048,left:n,right:n+2048}}(e.positions[u.icon.url],t),this.size||(this.size=s.image.displaySize)}return this._shape=s,s}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:e,markerTypeFn:t,markerPathFn:n,markerWidthFn:o,markerHeightFn:a,markerFillFn:s,markerFillPatternFileFn:l,markerFillOpacityFn:u,markerTextFitFn:c,markerTextFitPaddingFn:p,markerLineColorFn:h,markerLineWidthFn:d,markerLineOpacityFn:f,markerLineDasharrayFn:m,markerLinePatternFileFn:y,markerPathWidthFn:g,markerPathHeightFn:b,textNameFn:x,textFaceNameFn:v,textStyleFn:w,textWeightFn:k}=this._fnTypes,{zoom:_}=this.options,z={},A=this.symbol,T=this.feature.properties,j=e?e(null,T):A.markerFile,F=t?t(null,T):A.markerType,P=j||F||A.markerPath,S=!N$6(this.symbolDef.textName);let M;if(P){M=function(e,t,i,r,n,o){if(N$6(t.markerWidth)&&N$6(t.markerHeight))return null;const a="__fn_markerWidth".trim(),s="__fn_markerHeight".trim();let l=t.markerWidth||0,u=t.markerHeight||0;return $$5(l)&&("identity"!==l.type?l=xr$3(l):(l=e.markerWidth,e[a]&&(l=e[a](r,i)),$$5(l)&&(l="identity"===l.type?n(r,i):xr$3(l)))),$$5(u)&&("identity"!==u.type?u=xr$3(u):(u=e.markerHeight,e[s]&&(u=e[s](r,i)),$$5(u)&&(u="identity"===u.type?o(r,i):xr$3(u)))),[l,u]}(A,this.symbolDef,T,_,o,a)||[0,0];let e=A.markerTextFit;if(c&&(e=c(_,T)),e&&A.text&&"none"!==e){const t=A.text.textSize;let n=A.text.textName;isFunctionDefinition(n)&&(n=interpolated(n)(_,T));const o=kr$3(n,T);if(o){const n="__fn_textSize".trim(),a="__fn_textSize_0".trim();isFunctionDefinition(t)&&!A.text[n]&&(A.text[a]=interpolated(t),A.text[n]=(e,t)=>{const n=A.text[a](e,t);return isFunctionDefinition(n)?interpolated(n)(e,t):n});const s=br$3(A.text,A.text,T,_);if("width"!==e&&"both"!==e||(M[0]=s[0]*o.length),"height"!==e&&"both"!==e||(M[1]=s[1]),s[0]&&s[1]){let e=A.markerTextFitPadding||[0,0,0,0];p&&(e=p(_,T)),M[0]+=e[1]+e[3],M[1]+=e[0]+e[2]}}else M[0]=M[1]=-1}}if(S&&(M=br$3(A,this.symbolDef,T,_)),!M)return z;if(M[0]=Math.ceil(M[0]),M[1]=Math.ceil(M[1]),this.size=M,P&&M[0]>=0&&M[1]>=0){let e;if(F){const t={};if(t.markerType=F,"path"===F&&(t.markerPath=n?n(null,T):A.markerPath,t.markerPathWidth=g?g(null,T):A.markerPathWidth,t.markerPathHeight=b?b(null,T):A.markerPathHeight),o){const e=o(null,T);N$6(e)||(t.markerWidth=e)}else A.markerWidth>=0&&(t.markerWidth=A.markerWidth);if(a){const e=a(null,T);N$6(e)||(t.markerHeight=e)}else A.markerHeight>=0&&(t.markerHeight=A.markerHeight);if(s){const e=s(null,T);N$6(e)||(t.markerFill=e)}else A.markerFill&&(t.markerFill=A.markerFill);if(l){const e=l(null,T);N$6(e)||(t.markerFillPatternFile=e)}else A.markerFillPatternFile&&(t.markerFillPatternFile=A.markerFillPatternFile);if(u){const e=u(null,T);N$6(e)||(t.markerFillOpacity=e)}else A.markerFillOpacity>=0&&(t.markerFillOpacity=A.markerFillOpacity);if(h){const e=h(null,T);N$6(e)||(t.markerLineColor=e)}else A.markerLineColor&&(t.markerLineColor=A.markerLineColor);if(d){const e=d(null,T);N$6(e)||(t.markerLineWidth=e)}else A.markerLineWidth>=0&&(t.markerLineWidth=A.markerLineWidth);if(f){const e=f(null,T);N$6(e)||(t.markerLineOpacity=e)}else A.markerLineOpacity>=0&&(t.markerLineOpacity=A.markerLineOpacity);if(m){const e=m(null,T);N$6(e)||(t.markerLineDasharray=e)}else A.markerLineDasharray&&(t.markerLineDasharray=A.markerLineDasharray);if(y){const e=y(null,T);N$6(e)||(t.markerLinePatternFile=e)}else A.markerLinePatternFile&&(t.markerLinePatternFile=A.markerLinePatternFile);e="vector://"+JSON.stringify(t)}else e=j?j.replace(On$2,this._thisReplacer):A.markerPath?function(e,t,i){if(!e.markerPath)return null;let r=1;const n=function(e){const t={stroke:{stroke:e.markerLineColor,"stroke-width":e.markerLineWidth,"stroke-opacity":e.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:e.markerFill,"fill-opacity":e.markerFillOpacity}};return 0===t.stroke["stroke-width"]&&(t.stroke["stroke-opacity"]=0),t}(e);U$5(e.markerOpacity)&&(r=e.markerOpacity),U$5(e.opacity)&&(r*=e.opacity);const o={};if(n){for(const e in n.stroke)G$5(n.stroke,e)&&(N$6(n.stroke[e])||(o[e]=n.stroke[e]));for(const e in n.fill)G$5(n.fill,e)&&(N$6(n.fill[e])||(o[e]=n.fill[e]))}const a=Array.isArray(e.markerPath)?e.markerPath:[e.markerPath];let s;const l=[];for(let e=0;e<a.length;e++)s=W$5(a[e])?{path:a[e]}:a[e],s=q$5({},s,o),s.d=s.path,delete s.path,l.push(s);const u=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];r<1&&u.push('opacity="'+r+'"'),e.markerPathWidth&&e.markerPathHeight&&u.push('viewBox="0 0 '+e.markerPathWidth+" "+e.markerPathHeight+'"'),u.push('preserveAspectRatio="none"'),t&&u.push('width="'+t+'"'),i&&u.push('height="'+i+'"'),u.push("><defs></defs>");for(let e=0;e<l.length;e++){let t="<path ";for(const i in l[e])G$5(l[e],i)&&(t+=" "+i+'="'+l[e][i]+'"');t+="></path>",u.push(t)}return u.push("</svg>"),"data:image/svg+xml;base64,"+btoa(u.join(" "))}(A,M[0],M[1]):null;z.icon={url:e,size:M}}if(S){const e=x?x(this.options.zoom,T):A.textName;if(e||0===e){const t=vr$3(v?v(null,T):A.textFaceName,w?w(null,T):A.textStyle,k?k(null,T):A.textWeight);let i=kr$3(e,T);i&&i.length&&(i=En$2(i),z.glyph={font:t,text:i})}}return this.iconGlyph=z,z}}function Ln$2(e,t){t&&"middle"!==t||(t="center"),e&&"middle"!==e||(e="center");let i="center"!==t?t:"";return i+="center"!==e?(i.length?"-":"")+e:"",i
/*!
	 * From mapbox-gl-js
	 * MIT License
	 * https://github.com/mapbox/mapbox-gl-js
	 */}function qn$2(t,i,r,n,o){const a=[];let s;for(let l=0;l<t.length;l++){const u=t[l];let c,p=!1;for(let t=0;t<u.length-1;t++){let l=u[t],h=u[t+1];l.x<i&&h.x<i||(l.x<i?(s=l,l=new pointGeometry(i,l.y+(i-l.x)/(h.x-l.x)*(h.y-l.y))._round(),l.z=s.z+(i-s.x)/(h.x-s.x)*(h.z-s.z),p=!0):h.x<i&&(s=h,h=new pointGeometry(i,l.y+(i-l.x)/(h.x-l.x)*(h.y-l.y))._round(),h.z=l.z+(i-l.x)/(s.x-l.x)*(s.z-l.z),p=!0),l.y<r&&h.y<r||(l.y<r?(s=l,l=new pointGeometry(l.x+(r-l.y)/(h.y-l.y)*(h.x-l.x),r)._round(),l.z=s.z+(r-s.y)/(h.y-s.y)*(h.z-s.z),p=!0):h.y<r&&(s=h,h=new pointGeometry(l.x+(r-l.y)/(h.y-l.y)*(h.x-l.x),r)._round(),h.z=l.z+(r-l.y)/(s.y-l.y)*(s.z-l.z),p=!0),l.x>=n&&h.x>=n||(l.x>=n?(s=l,l=new pointGeometry(n,l.y+(n-l.x)/(h.x-l.x)*(h.y-l.y))._round(),l.z=s.z+(n-s.x)/(h.x-s.x)*(h.z-s.z),p=!0):h.x>=n&&(s=h,h=new pointGeometry(n,l.y+(n-l.x)/(h.x-l.x)*(h.y-l.y))._round(),h.z=l.z+(n-l.x)/(s.x-l.x)*(s.z-l.z),p=!0),l.y>=o&&h.y>=o||(l.y>=o?(s=l,l=new pointGeometry(l.x+(o-l.y)/(h.y-l.y)*(h.x-l.x),o)._round(),l.z=s.z+(o-s.y)/(h.y-s.y)*(h.z-s.z),p=!0):h.y>=o&&(s=h,h=new pointGeometry(l.x+(o-l.y)/(h.y-l.y)*(h.x-l.x),o)._round(),h.z=l.z+(o-l.y)/(s.y-l.y)*(s.z-l.z),p=!0),c&&l.equals(c[c.length-1])||(c=[l],a.push(c)),p&&(c.clipped=!0),c.push(h)))))}}return a}class Nn$2 extends pointGeometry{constructor(e,t,i,r){super(e,t),this.angle=i,void 0!==r&&(this.segment=r)}clone(){return new Nn$2(this.x,this.y,this.angle,this.segment)}}
/*!
	 * From mapbox-gl-js
	 * MIT License
	 * https://github.com/mapbox/mapbox-gl-js
	 */function Un$2(e,t,i,r,n){if(void 0===t.segment)return!0;let o=t,a=t.segment+1,s=0;for(;s>-i/2;){if(a--,a<0)return!1;s-=e[a].dist(o),o=e[a]}s+=e[a].dist(e[a+1]),a++;const l=[];let u=0;for(;s<i/2;){const t=e[a],i=e[a+1];if(!i)return!1;let o=e[a-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:o}),u+=o;s-l[0].distance>r;)u-=l.shift().angleDelta;if(u>n)return!1;a++,s+=t.dist(i)}return!0}function $n$2(e,t,i,r,n,o,a,s,l,u,c){const p=function(e,t,i){return e?.6*t*i:0}(r,o,a),h=function(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}(r,n),d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h*a<t/4&&(t=h*a+t/4),function e(t,i,r,n,o,a,s,l,u,c,p){const h=a/2,d=function(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}(t);let f=0,m=i-r,y=[];for(let e=0;e<t.length-1;e++){const i=t[e],s=t[e+1],l=i.dist(s),g=s.angleTo(i);for(;m+r<f+l;){m+=r;const b=(m-f)/l,x=Wn$2(i.x,s.x,b),v=Wn$2(i.y,s.y,b),w=Wn$2(i.z||0,s.z||0,b);if(x>=0&&x<u&&v>=0&&v<u&&m-h>=0&&m+h<=d){const r=new Nn$2(x,v,g,e);r.z=w,c&&(r.axis=[i.y-v,x-i.x],r.angleR=w===(i.z||0)?0:Math.atan(.9*(w-(i.z||0))*p/i.dist(r))),r.line=t,r._round(),n&&!Un$2(t,r,a,n,o)||y.push(r)}}f+=l}return l||y.length||s||(y=e(t,f/2,r,n,o,a,s,!0,u,c,p)),y}(e,d?t/2*s%t:(h/2+2*o)*a*s%t,t,p,i,h*a,d,!1,l,u,c)}function Wn$2(e,t,i){return e*(1-i)+t*i}function Vn$2(e,t){const i=e.length;if(i<=1)return[e];const r=[];let n,o;for(let t=0;t<i;t++){const i=ie$3(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[e[t]]):n.push(e[t]))}if(n&&r.push(n),t>1)for(let e=0;e<r.length;e++)r[e].length<=t||(u$1(r[e],t,1,r[e].length-1,Hn$2),r[e]=r[e].slice(0,t));return r}function Hn$2(e,t){return t.area-e.area}function Gn$2(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function Jn$2(t,i=1,r=!1){let n=1/0,o=1/0,a=-1/0,s=-1/0;const l=t[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<o)&&(o=t.y),(!e||t.x>a)&&(a=t.x),(!e||t.y>s)&&(s=t.y)}const u=Math.min(a-n,s-o);let p=u/2;const h=new tinyqueue.exports(null,Bn$2);if(0===u)return new pointGeometry(n,o);for(let e=n;e<a;e+=u)for(let i=o;i<s;i+=u)h.push(new Xn$2(e+p,i+p,p,t));let d=function(e){let t=0,i=0,r=0;const n=e[0];for(let e=0,o=n.length,a=o-1;e<o;a=e++){const o=n[e],s=n[a],l=o.x*s.y-s.x*o.y;i+=(o.x+s.x)*l,r+=(o.y+s.y)*l,t+=3*l}return new Xn$2(i/t,r/t,0,e)}(t),f=h.length;for(;h.length;){const e=h.pop();(e.d>d.d||!d.d)&&(d=e,r&&console.log("found best %d after %d probes",Math.round(1e4*e.d)/1e4,f)),e.max-d.d<=i||(p=e.h/2,h.push(new Xn$2(e.p.x-p,e.p.y-p,p,t)),h.push(new Xn$2(e.p.x+p,e.p.y-p,p,t)),h.push(new Xn$2(e.p.x-p,e.p.y+p,p,t)),h.push(new Xn$2(e.p.x+p,e.p.y+p,p,t)),f+=4)}return r&&(console.log("num probes: "+f),console.log("best distance: "+d.d)),d.p}function Bn$2(e,t){return t.max-e.max}function Xn$2(t,i,r,n){this.p=new pointGeometry(t,i),this.h=r,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const o=t[n];for(let t=0,n=o.length,a=n-1;t<n;a=t++){const n=o[t],s=o[a];n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(i=!i),r=Math.min(r,Gn$2(e,n,s))}}return(i?1:-1)*Math.sqrt(r)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Zn$2=45*Math.PI/100;function Yn$2(e,t,i,r,n,o,a,s,l){const{feature:u,size:c,symbol:p}=e,h=c?24:0,d=r*(c?c[0]/h:1);if("line"===o){const e=[];let r=u.geometry;n&&(r=qn$2(u.geometry,0,0,n,n));for(let o=0;o<r.length;o++){const u=$n$2(r[o],a,Zn$2,p.isIconText?null:i&&i.vertical||i&&i.horizontal||i,null,h,p.isIconText?1:d,1,n||1/0,s,l);if(p.textPlacement&&!p.isIconText)for(let e=0;e<u.length;e++)u[e].startIndex=t.length/3;if(e.push.apply(e,u),p.textPlacement&&!p.isIconText)for(let e=0;e<r[o].length;e++)t.push(r[o][e].x,r[o][e].y,r[o][e].z||0)}return e}return function(e,t,i,r,n){const o=[];if(3===e.type){const a=Vn$2(e.geometry,0);for(let e=0;e<a.length;e++){const s=a[e];if("vertex"===t)for(let e=0;e<s.length;e++){const t=s[e];for(let a=0;a<t.length;a++)ae$3(t[a],i)||(o.push(t[a]),r&&(0===a?Qn$2(t[a],t[a],t[e+1],n):Qn$2(t[a],t[a-1],t[a],n)))}else if("vertex-first"===t){const e=s[0];e&&e[0]&&!ae$3(e[0],i)&&(o.push(e[0]),r&&Qn$2(e[0],e[0],e[1],n))}else if("vertex-last"===t||"vertex-firstlast"===t){const e=s[0];if("vertex-firstlast"===t&&e&&e[0]&&!ae$3(e[0],i)&&(o.push(e[0]),r&&Qn$2(e[0],e[0],e[1],n)),e&&e[e.length-1]&&!ae$3(e[e.length-1],i)){const t=e.length-1;o.push(e[t]),r&&Qn$2(e[t],e[t-1],e[t],n)}}else{const e=Jn$2(s,16);ae$3(e,i)||o.push(e)}}}else if(2===e.type)for(let a=0;a<e.geometry.length;a++){const s=e.geometry[a];if("vertex"===t)for(let e=0;e<s.length;e++)ae$3(s[e],i)||(o.push(s[e]),r&&(0===e?Qn$2(s[e],s[e],s[e+1],n):Qn$2(s[e],s[e-1],s[e],n)));else if("vertex-last"===t||"vertex-firstlast"===t){if("vertex-firstlast"!==t||ae$3(s[0],i)||(o.push(s[0]),r&&Qn$2(s[0],s[0],s[1],n)),s&&s[s.length-1]&&!ae$3(s[s.length-1],i)){const e=s.length-1;o.push(s[e]),r&&Qn$2(s[e],s[e-1],s[e],n)}}else ae$3(s[0],i)||(o.push(s[0]),r&&Qn$2(s[0],s[0],s[1],n))}else if(1===e.type)for(let t=0;t<e.geometry.length;t++){const n=e.geometry[t];for(let e=0;e<n.length;e++){const t=n[e];ae$3(t,i)||(r&&(t.xRotation=0,t.yRotation=0,t.zRotation=0),o.push(t))}}return o}(u,o,n)}function Qn$2(e,t,i,r){if(e.xRotation||e.yRotation||e.zRotation)return e;const n=i.x-t.x,o=t.y-i.y,a=(i.z-t.z)*r,s=Math.atan2(o,n);e.zRotation=s;const l=Math.atan2(a,Math.sqrt(n*n+o*o));return e.xyRotation=l,e}function eo$2(e,t){const i={},r={},n=[];let o=0;function a(t){n.push(e[t]),o++}function s(e,t,i){const o=r[e];return delete r[e],r[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function l(e,t,r){const o=i[t];return delete i[t],i[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function u(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const p=e[c],h=p.geometry;if(!h)continue;const d=p.properties[t]?p.properties[t].toString():null;if(!d){a(c);continue}const f=u(d,h),m=u(d,h,!0);if(f in r&&m in i&&r[f]!==i[m]){const e=l(f,m,h),t=s(f,m,n[e].geometry);delete i[f],delete r[m],r[u(d,n[t].geometry,!0)]=t,n[e].geometry=null}else f in r?s(f,m,h):m in i?l(f,m,h):(a(c),i[f]=o-1,r[m]=o-1)}return n.filter((e=>e.geometry))}class io$2 extends mr$3{static needMerge(e,t,i){if(!e)return!1;let r="line"===e.textPlacement||"line"===e.markerPlacement;return r||(t.textPlacementFn&&(r="line"===t.textPlacementFn(i)),t.markerPlacementFn&&(r="line"===t.markerPlacementFn(i))),e.mergeOnProperty&&r}static mergeLineFeatures(e,t,i,r){const n="__index".trim();let o=t.textPlacement,a=t.markerPlacement;i.textPlacementFn&&(o=i.textPlacementFn(r)),i.markerPlacementFn&&(a=i.markerPlacementFn(r));const s=function(e,t,i,r,n){const o="__index".trim(),a=mr$3.genFnTypes(t),{mergeOnPropertyFn:s}=a;if(!t.mergeOnProperty||"line"!==r&&"line"!==i)return[];if(!(se$3(l=t.mergeOnProperty)||"string"!=typeof l&&(null===l.constructor||l.constructor!==String)||"line"!==r&&"line"!==i))return[{features:e,property:t.mergeOnProperty}];var l;const u=[],c={},p=[];for(let a=0;a<e.length;a++){e[a][o]=a;const l=e[a].properties=e[a].properties||{};l.$layer=e[a].layer,l.$type=e[a].type;let h=i;"line"!==h&&(h=r);const d=s?s(n,l):t.mergeOnProperty;"line"!==h||se$3(d)?p.push(e[a]):(void 0===c[d]&&(c[d]=u.length,u.push({features:[],property:d})),u[c[d]].features.push(e[a]))}return p.length&&u.push({features:p}),u}(e,t,a,o,r);if(s.length){const t=[];for(let i=0;i<s.length;i++)t.push(s[i].property?eo$2(s[i].features,s[i].property):e);if(1===t.length)return t[0];{let e=[];for(let i=0;i<t.length;i++)e=e.concat(t[i]);return e.sort(((e,t)=>e[n]-t[n])),e}}}static splitPointSymbol(e,t=0){const i=[];if(Array.isArray(e)){const t=e;for(let e=0;e<t.length;e++)t[e]&&i.push(...io$2.splitPointSymbol(t[e],e));return i}let r=null,n=null;for(const t in e)0===t.indexOf("marker")?(r=r||{},r[t]=e[t]):0===t.indexOf("text")&&(n=n||{},n[t]=e[t]);return r&&(r.isIconText=!0,e.mergeOnProperty&&(r.mergeOnProperty=e.mergeOnProperty),i.push(r)),n&&(r&&(n.textPlacement=r.markerPlacement,n.textSpacing=r.markerSpacing,n.isIconText=!0),e.mergeOnProperty&&(n.mergeOnProperty=e.mergeOnProperty),i.push(n)),void 0!==e.visible&&(r&&(r.visible=e.visible),n&&(n.visible=e.visible)),r&&(r.markerTextFit&&n&&(r.text={},r.text.textName=n.textName,r.text.textSize=n.textSize),r.index={index:t,type:0}),n&&(n.index={index:t,type:1}),i}static isAtlasLoaded(e,t){const{icon:i,glyph:r}=e,{iconAtlas:n,glyphAtlas:o}=t;if(i&&(!n||!n.positions[i.url]))return!1;if(r){if(!o||!o.positions[r.font])return!1;const e=o.positions[r.font],{text:t}=r;for(let i=0;i<t.length;i++)if(!e[t.charCodeAt(i)])return!1}return!0}constructor(e,t,i){super(e,t,i),this._textPlacement=t.textPlacement,this._fnTypes.textPlacementFn&&(this._textPlacement=this._fnTypes.textPlacementFn(this.options.zoom))}createStyledVector(e,t,i,r,n,o){const a=new Rn$2(e,this.symbolDef,t,i,r),s=a.getIconAndGlyph();if(s.icon&&!this.options.atlas){const{url:e,size:t}=s.icon;n[e]||(n[e]=s.icon.size),n[e][0]<t[0]&&(n[e][0]=t[0]),n[e][1]<t[1]&&(n[e][1]=t[1])}if(s.glyph&&!this.options.atlas){const{font:e,text:t}=s.glyph,i=o[e]=o[e]||{};for(let e=0;e<t.length;e++)i[t.charCodeAt(e)]=1;"line"===this._textPlacement&&(o.options={isCharsCompact:!1})}return this.options.allowEmptyPack||s.icon||s.glyph?a:null}getFormat(e){const t=void 0!==e.textName,i=t?this.getPackSDFFormat(e):this.getPackMarkerFormat();t?i.push(...this._getTextFnTypeFormats()):i.push(...this._getMarkerFnTypeFormats());const{markerOpacityFn:r,textOpacityFn:n,markerPitchAlignmentFn:o,textPitchAlignmentFn:a,markerRotationAlignmentFn:s,textRotationAlignmentFn:l,markerRotationFn:u,textRotationFn:c,markerAllowOverlapFn:p,textAllowOverlapFn:h,markerIgnorePlacementFn:d,textIgnorePlacementFn:f}=this._fnTypes;return(r||n)&&i.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(o||a)&&i.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(s||l)&&i.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(u||c)&&i.push({type:Uint16Array,width:1,name:"aRotation"}),(p||h||d||f)&&i.push({type:Uint8Array,width:1,name:"aOverlap"}),i}_is3DPitchText(){return this.hasMapPitchAlign}_getTextFnTypeFormats(){const{textFillFn:e,textSizeFn:t,textHaloFillFn:i,textHaloRadiusFn:r,textHaloOpacityFn:n,textDxFn:o,textDyFn:a}=this._fnTypes,s=[];return e&&s.push({type:Uint8Array,width:4,name:"aTextFill"}),t&&s.push({type:Uint8Array,width:1,name:"aTextSize"}),i&&s.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),r&&s.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),n&&s.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),o&&s.push({type:Int8Array,width:1,name:"aTextDx"}),a&&s.push({type:Int8Array,width:1,name:"aTextDy"}),s}_getMarkerFnTypeFormats(){const{markerWidthFn:e,markerHeightFn:t,markerDxFn:i,markerDyFn:r}=this._fnTypes,n=[];return e&&n.push({type:this.options.markerWidthType||Uint8Array,width:1,name:"aMarkerWidth"}),t&&n.push({type:this.options.markerHeightType||Uint8Array,width:1,name:"aMarkerHeight"}),i&&n.push({type:Int8Array,width:1,name:"aMarkerDx"}),r&&n.push({type:Int8Array,width:1,name:"aMarkerDy"}),n}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.lineVertex=[];const e=super.createDataPack.apply(this,arguments);return e?(e.lineVertex=new Int16Array(this.lineVertex),e.buffers.push(e.lineVertex.buffer),e):null}placeVector(t,r){const n=t.getShape(this.iconAtlas,this.glyphAtlas);if(!this.options.allowEmptyPack&&!n)return;const o=this._getAnchors(t,n,r);if(0===o.length)return;const a=this.data,s=this.needAltitudeAttribute()?2:3;let l=this.data.aPosition.length/s;const u=t.symbol,c=t.feature.properties,p="line"===this._textPlacement&&!u.isIconText,h=void 0!==u.textName,d=h&&p&&function(e){let t=0;for(let i=0;i<e.length;i++)if(xn$2(e.charAt(i).charCodeAt(0)))t=0;else if(t++,t>=1)return!1;return!0}(t.getIconAndGlyph().glyph.text)?1:0,{textFillFn:f,textSizeFn:m,textHaloFillFn:y,textHaloRadiusFn:g,textHaloOpacityFn:b,textDxFn:x,textDyFn:v,textPitchAlignmentFn:w,textRotationAlignmentFn:k,textRotationFn:_,textAllowOverlapFn:z,textIgnorePlacementFn:A,textOpacityFn:T,markerWidthFn:j,markerHeightFn:F,markerDxFn:P,markerDyFn:S,markerPitchAlignmentFn:M,markerRotationAlignmentFn:I,markerRotationFn:C,markerAllowOverlapFn:D,markerIgnorePlacementFn:E,markerOpacityFn:O}=this._fnTypes;let R,L,q,N,U,$,W,V,H,G,J,B,X,Z,Y,Q,ee;if(h){const r=t.getIconAndGlyph().glyph.font;R=function(t,i,r){const n=t.positionedGlyphs,o=[];for(let a=0;a<n.length;a++){const s=n[a],l=r[s.glyph];if(!l)continue;const u=l.rect;if(!u)continue;const c=4,p=l.metrics.advance/2,h=l.metrics.height/2,d=i?[s.x+p,0]:[0,0],f=i?[0,s.y-h]:[s.x+p,s.y-h],m=l.metrics.left-c-p+f[0],y=l.metrics.top-c+f[1],g=m+u.w,b=y+u.h,x=new pointGeometry(m,y),v=new pointGeometry(g,y),w=new pointGeometry(m,b),k=new pointGeometry(g,b);if(i&&s.vertical){const t=new pointGeometry(-p,p),i=-Math.PI/2,r=new pointGeometry(5,0);x._rotateAround(i,t)._add(r),v._rotateAround(i,t)._add(r),w._rotateAround(i,t)._add(r),k._rotateAround(i,t)._add(r)}o.push({tl:x,tr:v,bl:w,br:k,tex:u,writingMode:t.writingMode,glyphOffset:d})}return o}(n.horizontal,p,this.glyphAtlas.positions[r]),f&&(L=f(null,c),L=isFunctionDefinition(L)?[0,0,0,0]:K$5([],L)),m&&(q=m(this.options.zoom,c),se$3(q)&&(q=14)),y&&(N=y(null,c),N=K$5([],N)),g&&(U=g(null,c)),b&&($=255*b(null,c)),x&&(W=x(null,c)||0),v&&(V=v(null,c)||0),w&&(X=+("map"===w(null,c))),k&&(Z=+("map"===k(null,c))),_&&(Y=le$3(_(null,c),0,360)*Math.PI/180)}else R=n?function(t){const i=t.image,r=t.top-1/i.pixelRatio,n=t.left-1/i.pixelRatio,o=t.bottom+1/i.pixelRatio,a=t.right+1/i.pixelRatio;let s,l,u,c;return s=new pointGeometry(n,r),l=new pointGeometry(a,r),u=new pointGeometry(a,o),c=new pointGeometry(n,o),[{tl:s,tr:l,bl:c,br:u,tex:{x:i.tl[0],y:i.tl[1],w:i.displaySize[0],h:i.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(n):function(){const t=new pointGeometry(0,0),i=new pointGeometry(0,0),r=new pointGeometry(0,0);return[{tl:t,tr:i,bl:new pointGeometry(0,0),br:r,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),j&&(H=j(null,c)),F&&(G=F(null,c)),P&&(J=P(null,c)),S&&(B=S(null,c)),M&&(X=+("map"===M(null,c))),I&&(Z=+("map"===I(null,c))),C&&(Y=le$3(C(null,c),0,360)*Math.PI/180);const te=D||z;te&&(Q=te(null,c)||0);const ie=E||A;let re;ie&&(ee=ie(null,c)||0);const ne=T||O;ne&&(re=255*ne(this.options.zoom,c));const ue=this.options.EXTENT,ce=R.length,{altitudeScale:pe,altitudeProperty:he,defaultAltitude:de}=this.options,{altitude:fe}=oe$3(t.feature,pe,he,de);for(let e=0;e<o.length;e++){const t=o[e],i=t.z||fe||0;if(ue!==1/0&&ae$3(t,ue))continue;const r=t.x,n=t.y,s=R.length;for(let e=0;e<s;e++){const o=R[e],{tl:s,tr:u,bl:c,br:f,tex:m}=o;this._fillPos(a,r,n,i,10*s.x,10*s.y,m.x,m.y+m.h),h&&this._fillData(a,p,ce,o.glyphOffset,t,d,t.axis,t.angleR),this._fillFnTypeData(a,L,q,N,U,$,W,V,H,G,J,B,re,X,Z,Y,Q,ee),this._fillPos(a,r,n,i,10*u.x,10*u.y,m.x+m.w,m.y+m.h),h&&this._fillData(a,p,ce,o.glyphOffset,t,d,t.axis,t.angleR),this._fillFnTypeData(a,L,q,N,U,$,W,V,H,G,J,B,re,X,Z,Y,Q,ee),this._fillPos(a,r,n,i,10*c.x,10*c.y,m.x,m.y),h&&this._fillData(a,p,ce,o.glyphOffset,t,d,t.axis,t.angleR),this._fillFnTypeData(a,L,q,N,U,$,W,V,H,G,J,B,re,X,Z,Y,Q,ee),this._fillPos(a,r,n,i,10*f.x,10*f.y,m.x+m.w,m.y),h&&this._fillData(a,p,ce,o.glyphOffset,t,d,t.axis,t.angleR),this._fillFnTypeData(a,L,q,N,U,$,W,V,H,G,J,B,re,X,Z,Y,Q,ee),this.addElements(l,l+1,l+2),this.addElements(l+1,l+2,l+3),l+=4;const y=Math.max(Math.abs(r),Math.abs(n),Math.abs(i));y>this.maxPos&&(this.maxPos=y)}}}_fillPos(e,t,i,r,n,o,a,s){this.fillPosition(e,t,i,r),e.aShape.push(n,o),e.aTexCoord.push(a,s)}_fillData(e,t,i,r,n,o,a,s){if(e.aCount.push(i),t){e.aGlyphOffset.push(r[0],r[1]),this._is3DPitchText()&&e.aPitchRotation.push(a[0],a[1],s);const t=n.startIndex;e.aSegment.push(n.segment+t,t,n.line.length),e.aVertical.push(o)}}_fillFnTypeData(e,t,i,r,n,o,a,s,l,u,c,p,h,d,f,m,y,g){const{textFillFn:b,textSizeFn:x,textHaloFillFn:v,textHaloRadiusFn:w,textHaloOpacityFn:k,textDxFn:_,textDyFn:z,textPitchAlignmentFn:A,textRotationAlignmentFn:T,textRotationFn:j,textAllowOverlapFn:F,textIgnorePlacementFn:P,textOpacityFn:S,markerWidthFn:M,markerHeightFn:I,markerDxFn:C,markerDyFn:D,markerPitchAlignmentFn:E,markerRotationAlignmentFn:O,markerRotationFn:R,markerAllowOverlapFn:L,markerIgnorePlacementFn:q,markerOpacityFn:N}=this._fnTypes;b&&e.aTextFill.push(...t),x&&e.aTextSize.push(i),v&&e.aTextHaloFill.push(...r),w&&e.aTextHaloRadius.push(n),k&&e.aTextHaloOpacity.push(o),_&&e.aTextDx.push(a),z&&e.aTextDy.push(s),M&&e.aMarkerWidth.push(l),I&&e.aMarkerHeight.push(u),C&&e.aMarkerDx.push(c),D&&e.aMarkerDy.push(p),(N||S)&&e.aColorOpacity.push(h),(A||E)&&e.aPitchAlign.push(d),(O||T)&&e.aRotationAlign.push(f),(R||j)&&e.aRotation.push(9362*m);const U=L||F,$=q||P;(U||$)&&e.aOverlap.push((U?8:0)+4*y+(($?2:0)+g)),n>0&&(this.properties.hasHalo=1)}_getAnchors(e,t,i){const{feature:r,symbol:n}=e,o=this._getPlacement(e,n),a=r.properties,{markerSpacingFn:s,textSpacingFn:l}=this._fnTypes,u=((s?s(null,a):n.markerSpacing)||(l?l(null,a):n.textSpacing)||250)*i,c=this.options.altitudeToTileScale;return Yn$2(e,this.lineVertex,t,i,this.options.EXTENT,o,u,this._is3DPitchText(),c)}_getPlacement(e,t){let i;return i=this._fnTypes.markerPlacementFn?this._fnTypes.markerPlacementFn(this.options.zoom,e.feature.properties):t.markerPlacement||this._textPlacement,this._packMarkerPlacement||!t.markerPlacement&&!t.isIconText||(this._packMarkerPlacement=i),!this._textPlacement||t.isIconText||this._packTextPlacement||(this._packTextPlacement=i),i}getPackSDFFormat(e){if("line"!==this._textPlacement||e.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const e=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this._is3DPitchText()&&e.push({type:Float32Array,width:3,name:"aPitchRotation"}),e}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}}class ro$2{constructor(e){this.x=e.x,this.y=e.y,this.z=e.z||0}clone(){return new ro$2(this)}_unit(){return this._div(this.mag()),this}_div(e){return this.x/=e,this.y/=e,this.z/=e,this}_perp(){var e=this.y;return this.y=this.x,this.x=-e,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(e){return this.clone()._add(e)}sub(e){return this.clone()._sub(e)}_add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}_sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}mult(e){return this.clone()._mult(e)}_mult(e){return this.x*=e,this.y*=e,this.z*=e,this}dist(e){return Math.sqrt(this.distSqr(e))}distSqr(e){var t=e.x-this.x,i=e.y-this.y,r=e.z-this.z;return t*t+i*i+r*r}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)}}const no$2=Math.cos(Math.PI/180*37.5),oo$2=Math.pow(2,16)/1,ao$2=new pointGeometry,so$2=new pointGeometry,lo$2=new pointGeometry;class uo$2 extends mr$3{constructor(e,t,i){super(e,t,i);let r=!1;const{lineDasharrayFn:n,lineDashColorFn:o}=this._fnTypes;this.hasGradient=this.symbol.lineGradientProperty,n&&(r=function(e,t,i){for(let r=0;r<e.length;r++)if(i(t,e[r].properties))return!0;return!1}(e,this.options.zoom,n),r&&(this.dasharrayFn=n)),this.hasDasharray=ho$2(this.symbol.lineDasharray)||r,this.hasDasharray&&o&&(this.dashColorFn=o)}createStyledVector(e,t,i,r,n){const o=new ce$3(e,t,i,r),a=o.getLineResource();return!this.options.atlas&&a&&(n[a]=[0,0]),o}getFormat(){const{lineWidthFn:e,lineStrokeWidthFn:t,lineStrokeColorFn:i,lineColorFn:r,lineOpacityFn:n,lineDxFn:o,lineDyFn:a,linePatternAnimSpeedFn:s,linePatternGapFn:l}=this._fnTypes,u=[...this.getPositionFormat()];if(u.push(this.iconAtlas||this.hasDasharray?{type:Int8Array,width:3,name:"aExtrude"}:{type:Int8Array,width:2,name:"aExtrude"}),u.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),e&&u.push({type:Uint8Array,width:1,name:"aLineWidth"}),t&&u.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),r&&u.push({type:Uint8Array,width:4,name:"aColor"}),i&&u.push({type:Uint8Array,width:4,name:"aStrokeColor"}),n&&u.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&u.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&u.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const e=this.getIconAtlasMaxValue();u.push({type:e>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(o||a)&&u.push({type:Int8Array,width:2,name:"aLineDxDy"}),(s||l)&&u.push({type:Int8Array,width:2,name:"aLinePattern"}),u}placeVector(e){const{lineJoinFn:t,lineCapFn:r,lineWidthFn:n,lineHeightFn:o,lineStrokeWidthFn:a,lineStrokeColorFn:s,lineColorFn:l,lineOpacityFn:u,lineDxFn:c,lineDyFn:p,linePatternAnimSpeedFn:h,linePatternGapFn:d}=this._fnTypes,f=this.symbol,m=e.feature,y=m.properties;let g=f.lineJoin||"miter",b=f.lineCap||"butt";if(t&&(g=t(this.options.zoom,y)||"miter"),r&&(b=r(this.options.zoom,y)||"butt"),n){let e=n(this.options.zoom,y);N$6(e)&&(e=4),this.feaLineWidth=+e}else this.feaLineWidth=+f.lineWidth;if(o){let e=o(this.options.zoom,y);N$6(e)&&(e=this.feaLineWidth),this.feaLineHeight=+e}else this.feaLineHeight=+f.lineHeight||this.feaLineWidth;if(a){let e=a(this.options.zoom,y);N$6(e)&&(e=0),this.feaLineStrokeWidth=e}else this.feaLineStrokeWidth=f.lineStrokeWidth||0;if(l&&(this.feaColor=l(this.options.zoom,y)||[255,255,255,255],this.feaColor=isFunctionDefinition(this.feaColor)?[0,0,0,0]:K$5([],this.feaColor)),s&&(this.feaStrokeColor=s(this.options.zoom,y)||[0,0,0,255],this.feaStrokeColor=isFunctionDefinition(this.feaStrokeColor)?[0,0,0,0]:K$5([],this.feaStrokeColor)),u){let e=u(this.options.zoom,y);N$6(e)&&(e=1),this.feaOpacity=255*e}if(this.dasharrayFn){let e=this.dasharrayFn(this.options.zoom,y)||[0,0,0,0];if(e.length<4){const t=e;1===e.length?e=[t[0],t[0],t[0],t[0]]:2===e.length?e=[t[0],t[1],t[0],t[1]]:3===e.length&&(e=[t[0],t[1],t[2],t[2]])}this.feaDash=e}if(this.dashColorFn){let e=(this.dashColorFn?this.dashColorFn(this.options.zoom,y):this.symbol.lineDashColor)||[0,0,0,0];e=K$5([],e),this.feaDashColor=e}if(this.iconAtlas){const t=e.getLineResource(),i=this.iconAtlas.glyphMap[t];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],i){const{tl:e,displaySize:i}=this.iconAtlas.positions[t];this.feaTexInfo[0]=e[0]+1,this.feaTexInfo[1]=e[1]+1,this.feaTexInfo[2]=i[0]-3,this.feaTexInfo[3]=i[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(c){let e=c(this.options.zoom,y);N$6(e)&&(e=0),this.feaLineDx=e}if(p){let e=p(this.options.zoom,y);N$6(e)&&(e=0),this.feaLineDy=e}if(h){let e=h(this.options.zoom,y);N$6(e)&&(e=0),0!==e&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=e}if(d){let e=d(this.options.zoom,y);N$6(e)&&(e=0),this.feaLinePatternGap=e}const x=this.options.EXTENT;let v=m.geometry;if(x!==1/0){v=[];const e=[];for(let t=0;t<m.geometry.length;t++){e[0]=m.geometry[t];const i=qn$2(e,-1,-1,x+1,x+1);if(3===m.type&&i.length>1){const e=i[0],t=i[i.length-1];go$2(e[0],t[t.length-1])&&(i[0]=t.concat(e.slice(1)),i.length=i.length-1)}v.push(...i)}}const w=this.needAltitudeAttribute()?2:3;for(let e=0;e<v.length;e++)this.offset=this.data.aPosition.length/w,this._addLine(v[e],m,g,b,2,1.05)}_hasPattern(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}_addLine(e,t,i,r,n,o){const a=this._hasPattern()||ho$2(this.feaDash)||ho$2(this.symbol.lineDasharray),s=this.options.isTube;s&&(e=e.map((e=>new ro$2(e)))),this.overscaling=1;const l=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&t.properties&&U$5(t.properties.mapbox_clip_start)&&U$5(t.properties.mapbox_clip_end)){this.clipStart=+t.properties.mapbox_clip_start,this.clipEnd=+t.properties.mapbox_clip_end;for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance()}const u=3===t.type&&!e.clipped;let c=e.length;for(;c>=2&&go$2(e[c-1],e[c-2]);)c--;let p=0;for(;p<c-1&&go$2(e[p],e[p+1]);)p++;if(c<(u?3:2))return;"bevel"===i&&(n=1.05);const h=this.overscaling<=16?15*l/(512*this.overscaling):0,d={vertexLength:0,primitiveLength:0,currentNormal:null};let f,m,y,g,b;this.e1=this.e2=-1,u&&(f=e[c-2],b=e[p].sub(f)._unit()._perp());for(let t=p;t<c;t++){if(y=t===c-1?u?e[p+1]:void 0:e[t+1],y&&go$2(e[t],y))continue;b&&(g=b),f&&(m=f),f=e[t],b=y?y.sub(f)._unit()._perp():g,d.dir=m?f.sub(m)._unit():y.sub(f)._unit(),g=g||b,d.currentNormal=g;let l=g.add(b);0===l.x&&0===l.y||l._unit();const x=g.x*b.x+g.y*b.y,v=l.x*b.x+l.y*b.y,w=0!==v?1/v:1/0,k=2*Math.sqrt(2-2*v),_=v<no$2&&m&&y,z=g.x*b.y-g.y*b.x>0;if(!s&&_&&t>p){const e=f.dist(m);if(e>2*h){const t=f.sub(f.sub(m)._mult(h/e)._round());t.z=f.z,this.updateDistance(m,t),this.addCurrentVertex(t,g,0,0,d),m=t}}const A=m&&y;d.middleVertex=A;let T=A?i:u?"butt":r;if(A&&"round"===T&&(w<o?T="miter":w<=2&&(T="fakeround")),"miter"===T&&w>n&&!s&&(T="bevel"),"bevel"===T&&(w>2&&(T="flipbevel"),w<n&&(T="miter")),m&&this.updateDistance(m,f),"miter"===T)s?(this.addCurrentVertex(f,g,0,0,d),d.dir=y.sub(f)._unit(),this.addCurrentVertex(f,b,0,0,d)):(l._mult(w),this.addCurrentVertex(f,l,0,0,d),a&&(d.currentNormal=b,this.addCurrentVertex(f,l,0,0,d)));else if("flipbevel"===T){if(w>100)l=b.mult(-1);else{const e=w*g.add(b).mag()/g.sub(b).mag();l._perp()._mult(e*(z?-1:1))}this.addCurrentVertex(f,l,0,0,d),this.addCurrentVertex(f,l.mult(-1),0,0,d)}else if("bevel"===T||"fakeround"===T){const e=-Math.sqrt(w*w-1),t=z?e:0,i=z?0:e;if(m&&this.addCurrentVertex(f,g,t,i,d),"fakeround"===T){const e=Math.round(180*k/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+x*(x*(3.55645-1.43519*x)-3.2452))*e*e+(.848013+x*(.215638*x-1.06021)))}const r=b.sub(g)._mult(i)._add(g)._unit()._mult(z?-1:1);this.addHalfVertex(f,r.x,r.y,!1,z,0,d)}}y&&(d.currentNormal=b,this.addCurrentVertex(f,b,-t,-i,d))}else if("butt"===T)this.addCurrentVertex(f,l,0,0,d);else if("square"===T){const e=m?1:-1;this.addCurrentVertex(f,l,e,e,d)}else"round"===T&&(m&&(this.addCurrentVertex(f,g,0,0,d),this.addCurrentVertex(f,g,1,1,d,!0)),y&&(this.addCurrentVertex(f,b,-1,-1,d,!0),this.addCurrentVertex(f,b,0,0,d)));if(!s&&_&&t<c-1){const e=f.dist(y);if(e>2*h){const t=f.add(y.sub(f)._mult(h/e)._round());t.z=f.z,this.updateDistance(f,t),this.addCurrentVertex(t,b,0,0,d),f=t}}}}addCurrentVertex(e,t,i,r,n,o=!1){const a=t.x+t.y*i,s=t.y-t.x*i,l=t.y*r-t.x,u=-t.y-t.x*r;let c=0,p=0;if(n.middleVertex){ao$2.x=a,ao$2.y=s,so$2.x=l,so$2.y=u;const e=n.currentNormal;if(c=yo$2(e,ao$2),0===i&&0===r)p=-c;else{const t=lo$2;t.x=e.x,t.y=e.y,t._mult(-1),p=yo$2(t,so$2)}}this.addHalfVertex(e,a,s,o,!1,i,n,c),this.addHalfVertex(e,l,u,o,!0,-r,n,p),this.prevVertex&&go$2(e,this.prevVertex)||(this.prevVertex=e),this.distance>oo$2/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,i,r,n,o))}addHalfVertex({x:e,y:t,z:i},r,n,o,a,s,l,u){this.fillData(this.data,e,t,i||0,r,n,o,a,1*this.scaledDistance,u);const c=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,c),l.primitiveLength++),a?this.e2=c:this.e1=c}fillData(e,t,i,r,n,o,a,s,l,u){const{lineWidthFn:c,lineStrokeWidthFn:p,lineStrokeColorFn:h,lineColorFn:d,lineOpacityFn:f,lineDxFn:m,lineDyFn:y,linePatternAnimSpeedFn:g,linePatternGapFn:b}=this._fnTypes;this.fillPosition(e,t,i,r);let x=63*n;x=(Math.sign(x)||1)*((Math.floor(Math.abs(x))>>1<<1)+ +a);let v=63*o;v=(Math.sign(v)||1)*((Math.floor(Math.abs(v))>>1<<1)+ +s),e.aExtrude.push(x,v),(this.iconAtlas||this.hasDasharray)&&e.aExtrude.push(63*u),e.aLinesofar.push(l),c&&e.aLineWidth.push(Math.round(2*this.feaLineWidth)),p&&e.aLineStrokeWidth.push(Math.round(2*this.feaLineStrokeWidth)),d&&e.aColor.push(...this.feaColor),h&&e.aStrokeColor.push(...this.feaStrokeColor),f&&e.aOpacity.push(this.feaOpacity),this.dasharrayFn&&e.aDasharray.push(...this.feaDash),this.dashColorFn&&e.aDashColor.push(...this.feaDashColor),this.iconAtlas&&e.aTexInfo.push(...this.feaTexInfo),(m||y)&&e.aLineDxDy.push(this.feaLineDx||0,this.feaLineDy||0),(g||b)&&e.aLinePattern.push(127*(this.feaPatternAnimSpeed||0),10*(this.feaLinePatternGap||0)),this.maxPos=Math.max(this.maxPos,Math.abs(t)+1,Math.abs(i)+1)}addElements(e,t,i){super.addElements(this.offset+e,this.offset+t,this.offset+i)}_filterPolygonEdges(e){const t=this.options.EXTENT,i=this.elements;for(let r=0;r<i.length;r+=3)t!==1/0&&(po$2(this.data.aPosition,i[r],i[r+1],3,t)||po$2(this.data.aPosition,i[r+1],i[r+2],3,t))||e.push(i[r],i[r+1],i[r+2])}_filterLine(e){if(e.length<=1)return e;const t=[],i=this.options.EXTENT;let r,n=!0;for(r=0;r<e.length-1;r++){const o=co$2(e[r],e[r+1],i);o&&n||(t.push(e[r]),n=o)}return n||t.push(e[r]),t}updateDistance(e,t){if(this.options.isTube){const i=e.dist(t),r=X$5(this.options)*(t.z-e.z);this.distance+=Math.sqrt(i*i+r*r)}else this.distance+=e.dist(t);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(oo$2-1):this.distance}}function co$2(e,t,i){return i!==1/0&&(e.x<0&&t.x<0||e.x>i&&t.x>i||e.y<0&&t.y<0||e.y>i&&t.y>i)}function po$2(e,t,i,r,n){if(n===1/0)return!1;const o=Math.floor(.5*e[t*r]),a=Math.floor(.5*e[t*r+1]),s=Math.floor(.5*e[i*r]),l=Math.floor(.5*e[i*r+1]);return o===s&&(o<0||o>n)&&a!==l||a===l&&(a<0||a>n)&&o!==s}function ho$2(e){if(!Array.isArray(e))return!1;for(let t=0;t<e.length;t++)if(e[t])return!0;return!1}const fo$2=new pointGeometry(0,0),mo$2=new pointGeometry(0,0);function yo$2(e,t){const i=e.mag(),r=t.mag();fo$2.x=t.x,fo$2.y=t.y;const n=e.angleTo(mo$2),o=t.angleTo(mo$2);return Math.sign(o-n)*Math.sqrt(r*r-i*i)}function go$2(e,t){return e.equals(t)&&e.z===t.z}
/*!
	 * from @turf/bboxClip
	 * https://github.com/Turfjs/turf
	 * MIT LICENSE
	 */const _o$2=[],zo$2=[];function Ao$2(t,i){var r,n,o,a,s,l,u;for(n=1;n<=8;n*=2){for(r=[],a=!(jo$2(o=t[t.length-1],i)&n),s=0;s<t.length;s++){if((u=!(jo$2(l=t[s],i)&n))!==a){const t=To$2(o,l,n,i);r.push(void 0!==l.x?new pointGeometry(t[0],t[1]):t)}u&&r.push(l),o=l,a=u}if(!(t=r).length)break}return r}function To$2(e,t,i,r){return _o$2[0]=void 0===e.x?e[0]:e.x,_o$2[1]=void 0===e.y?e[1]:e.y,e=_o$2,zo$2[0]=void 0===t.x?t[0]:t.x,zo$2[1]=void 0===t.y?t[1]:t.y,t=zo$2,8&i?[e[0]+(t[0]-e[0])*(r[3]-e[1])/(t[1]-e[1]),r[3]]:4&i?[e[0]+(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1]),r[1]]:2&i?[r[2],e[1]+(t[1]-e[1])*(r[2]-e[0])/(t[0]-e[0])]:1&i?[r[0],e[1]+(t[1]-e[1])*(r[0]-e[0])/(t[0]-e[0])]:null}function jo$2(e,t){_o$2[0]=void 0===e.x?e[0]:e.x,_o$2[1]=void 0===e.y?e[1]:e.y;var i=0;return(e=_o$2)[0]<t[0]?i|=1:e[0]>t[2]&&(i|=2),e[1]<t[1]?i|=4:e[1]>t[3]&&(i|=8),i}const Fo$2=[0,0,0,0];class Po$2 extends mr$3{constructor(...e){super(...e),this.lineElements=[]}createStyledVector(e,t,i,r,n){const o=new ce$3(e,t,i,r),a=o.getPolygonResource();return!this.options.atlas&&a&&(n[a]=[0,0]),o}getFormat(){const e=[...this.getPositionFormat()],{polygonFillFn:t,polygonOpacityFn:i,uvScaleFn:r,uvOffsetFn:n}=this._fnTypes;if(this.iconAtlas){const t=this.getIconAtlasMaxValue();e.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return t&&e.push({type:Uint8Array,width:4,name:"aColor"}),i&&e.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&e.push({type:Uint16Array,width:2,name:"aUVScale"}),n&&e.push({type:Uint8Array,width:2,name:"aUVOffset"}),e}placeVector(e,t){const i=e.feature;this._addPolygon(i.geometry,i,t)}_addPolygon(e,t){let r,n,o,a;const{polygonFillFn:s,polygonOpacityFn:l,uvScaleFn:u,uvOffsetFn:c}=this._fnTypes,p=t.properties;s&&(r=s(this.options.zoom,p)||set$3([],255,255,255,255),r=isFunctionDefinition(r)?Fo$2:K$5([],r)),l&&(n=l(this.options.zoom,p),N$6(n)&&(n=1),n*=255),u&&(o=u(this.options.zoom,p),N$6(o)&&(o=[1,1]),o=[255*o[0],255*o[1]]),c&&(a=c(this.options.zoom,p),N$6(a)&&(a=[0,0]),a=[255*a[0],255*a[1]]);const f=!!this.iconAtlas,m=Vn$2(e,500),y=[0,0],g=[0,0];if(f){const{polygonPatternFileFn:e}=this._fnTypes,t=e?e(null,p):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[t]){const e=this.iconAtlas.positions[t];y[0]=e.tl[0]+1,y[1]=e.tl[1]+1,g[0]=e.displaySize[0]-3,g[1]=e.displaySize[1]-3}}const b=this.needAltitudeAttribute()?2:3,x=[-1,-1,t.extent+1,t.extent+1];for(let e=0;e<m.length;e++){const t=m[e],i=this.data.aPosition.length/b,s=[],l=[];for(let e=0;e<t.length;e++){let i=t[e];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(i=Ao$2(i,x)),0!==i.length){0!==e&&l.push(s.length/3);for(let e=0;e<i.length;e++){const t=i[e].x,l=i[e].y,u=i[e].z||0;this.fillPosition(this.data,t,l,u),f&&this.data.aTexInfo.push(y[0],y[1],g[0],g[1]),void 0!==r&&this.data.aColor.push(r[0],r[1],r[2],r[3]),void 0!==n&&this.data.aOpacity.push(n),void 0!==o&&this.data.aUVScale.push(o[0],o[1]),void 0!==a&&this.data.aUVOffset.push(a[0],a[1]);const c=Math.abs(t),p=Math.abs(l);c>this.maxPos&&(this.maxPos=c),p>this.maxPos&&(this.maxPos=p),s.push(t,l,u)}}}let u=earcut$1.exports(s,l,3);if(s.length&&!u.length){const e=[];for(let t=0;t<s.length;t+=3)e[t]=s[t],e[t+1]=s[t+2],e[t+2]=s[t+1];if(u=earcut$1.exports(e,l,3),!u.length){for(let t=0;t<s.length;t+=3)e[t]=s[t+1],e[t+1]=s[t+2],e[t+2]=s[t];u=earcut$1.exports(e,l,3)}}for(let e=0;e<u.length;e+=3)this.addElements(i+u[e],i+u[e+1],i+u[e+2])}}}class Ho$2{constructor(e){this.max=e,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(e,t){return this.has(e)?(this.order.splice(this.order.indexOf(e),1),this.data[e]=t,this.order.push(e)):(this.data[e]=t,this.order.push(e),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(e){return e in this.data}keys(){return this.order}getAndRemove(e){if(!this.has(e))return null;const t=this.data[e];return delete this.data[e],this.order.splice(this.order.indexOf(e),1),t}get(e){return this.has(e)?this.data[e]:null}remove(e){return this.has(e)?(delete this.data[e],this.order.splice(this.order.indexOf(e),1),this):this}setMaxSize(e){for(this.max=e;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}}
/*!
	 * based on @mapbox/tiny-sdf
	 * https://github.com/mapbox/tiny-sdf
	 * @License BSD 2-Clause
	 */var Go$2=1e20;function Jo$1(e,t,i,r,n,o,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=n||"sans-serif",this.fontWeight=o||"normal",this.fontStyle=a||"normal",this.radius=i||8;var s=this.size=this.fontSize+2*this.buffer;this.canvas="undefined"==typeof document?new OffscreenCanvas(s,s):document.createElement("canvas"),this.canvas.width=this.canvas.height=s,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.middle=Math.round(s/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Bo$2(e,t,i,r,n,o){for(var a=0;a<t;a++)Xo$2(e,a,t,i,r,n,o);for(var s=0;s<i;s++)Xo$2(e,s*t,1,t,r,n,o)}function Xo$2(e,t,i,r,n,o,a){var s,l,u,c;for(o[0]=0,a[0]=-Go$2,a[1]=Go$2,s=0;s<r;s++)n[s]=e[t+s*i];for(s=1,l=0,u=0;s<r;s++){do{u=(n[s]-n[c=o[l]]+s*s-c*c)/(s-c)/2}while(u<=a[l]&&--l>-1);o[++l]=s,a[l]=u,a[l+1]=Go$2}for(s=0,l=0;s<r;s++){for(;a[l+1]<s;)l++;e[t+s*i]=n[c=o[l]]+(s-c)*(s-c)}}Jo$1.prototype.draw=function(e,t,i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.textBaseline="bottom",this.ctx.fillText(e,this.buffer,i-this.buffer+1);for(var r=this.ctx.getImageData(0,0,t,i),n=new Uint8ClampedArray(t*i),o=0;o<t*i;o++){var a=r.data[4*o+3]/255;this.gridOuter[o]=1===a?0:0===a?Go$2:Math.pow(Math.max(0,.5-a),2),this.gridInner[o]=1===a?Go$2:0===a?0:Math.pow(Math.max(0,a-.5),2)}for(Bo$2(this.gridOuter,t,i,this.f,this.v,this.z),Bo$2(this.gridInner,t,i,this.f,this.v,this.z),o=0;o<t*i;o++){var s=Math.sqrt(this.gridOuter[o])-Math.sqrt(this.gridInner[o]);n[o]=Math.round(255-255*(s/this.radius+this.cutoff))}return n};let Zo$1=0;class Yo$1{constructor(e,t=15,i){this.entries={},this._cachedFont={},this._cache=new Ho$2(2048,(function(){})),this._framer=e,this._limit=t,this._isCompactChars=i}getGlyphs(e,t){if(!e||!Object.keys(e).length)return void t(null,{glyphs:null});const i=this.entries,r=e.options;let n=!0;r&&(n=!1!==r.isCharsCompact),n=n||this._isCompactChars;const o=(r,o,s)=>{let l=0,u=0;for(const t in e)if("options"!==t){i[t]=i[t]||{},o[t]=o[t]||{};for(const c in e[t]){if(u++,u<=r)continue;const e=t.split(" "),p=n&&"normal"===e[0]&&!xn$2(+c),h=t+":"+c+":"+p;let d;if(this._cache.has(h)?d=this._cache.get(h):(d=this._tinySDF(i[t],e,c,p),this._cache.add(h,d),l++),d=Ko$1(d),o[t][c]=d,s.push(d.bitmap.data.buffer),l>this._limit)return void this._framer(a(u,o,s))}}t(null,{glyphs:o,buffers:s})};function a(e,t,i){return()=>{o(e,t,i)}}o(0,{},[])}_tinySDF(e,t,i,r){const n=t[0],o=t[1],a=t.slice(3).join(" ");let s=e.tinySDF,l="normal"!==n?5:2;const u=r?-1:2;if(!s){let t="400";/bolder/i.test(o)?t="1000":/bold/i.test(o)?t="900":/medium/i.test(o)?t="500":/light/i.test(o)&&(t="200"),s=e.tinySDF=new Jo$1(24,l,8,.25,a,t,n)}const c=String.fromCharCode(i),p=s.ctx.measureText(c),h=Math.round(p.width),d=s.draw(String.fromCharCode(i),h+2*l,24+2*l);if(Zo$1<4){const e="undefined"!=typeof document&&document.getElementById("sdf-debug-"+Zo$1++);e&&(e.width=h+2*l,e.height=s.canvas.height,e.getContext("2d").drawImage(s.canvas,0,0))}return{charCode:i,bitmap:{width:h+2*l,height:24+2*l,data:d},metrics:{width:h,height:24,left:0,top:-7-(l-2),advance:h+l+u}}}}function Ko$1(e){const t={width:e.bitmap.width,height:e.bitmap.height,data:new Uint8ClampedArray(e.bitmap.data)};return{charCode:e.charCode,bitmap:t,metrics:q$5({},e.metrics)}}class Qo$1{constructor(e){this.options=e||{},this._requesting={},this._cache=new Ho$2(256,(function(){}));const t=document.createElement("canvas");this.ctx=t.getContext("2d")}getIcons(e,t){if(!e||!Object.keys(e).length)return void t(null,{icons:null});const i=Object.keys(e),r={},n=[];let o=0,a=0;const s=this;function l(e,i){r[e]=s._getCache(e,i),r[e]&&"error"!==r[e]?n.push(r[e].data.data.buffer):delete r[e],a++,a===o&&t(null,{icons:r,buffers:n})}function u(e){const t=s._requesting[e.url];for(let i=0;i<t.length;i++)t[i].call(e,e.url,e.size);delete s._requesting[e.url]}function c(){const e=s.ctx;let t,i;try{t=this.width,i=this.height,this.size[0]=t,this.size[1]=i,s._ensureMaxSize(null,this.size),t=this.size[0],i=this.size[1],e.canvas.width=t,e.canvas.height=i,e.imageSmoothingEnabled=!1,e.drawImage(this,0,0,t,i);const r=e.getImageData(0,0,t,i).data;s._addCache(this.url,r,t,i)}catch(e){console.warn(e)}u(this)}function p(e){console.warn(`failed loading icon(${this.index}) at "${this.url}"`),console.warn(e),s.options.iconErrorUrl?this.src=s.options.iconErrorUrl:(s._addCache(this.url),u(this))}let h,d=!1;for(let t=0;t<i.length;t++){const a=i[t],s=e[a];this._ensureMaxSize(a,s);const u=this._getCache(a,s);if(u&&"error"!==u){r[a]=this._getCache(a,s);continue}if("error"===u)continue;let f,m=a;if(0===a.indexOf("vector://")&&(f=JSON.parse(a.substring("vector://".length)),"path"===f.markerType&&(m=t$2.Util.getMarkerPathBase64(f,f.markerWidth,f.markerHeight))),0===a.indexOf("vector://")&&"path"!==f.markerType){h=h||new t$2.Marker([0,0]);const{markerFill:e,markerLineColor:t}=f;e&&Array.isArray(e)&&(f.markerFill=ea(e)),t&&Array.isArray(t)&&(f.markerLineColor=ea(t)),delete f.markerHorizontalAlignment,delete f.markerVerticalAlignment,delete f.markerDx,delete f.markerDy,delete f.markerPlacement,delete f.markerFile,f.markerWidth=s[0],f.markerHeight=s[1],h.setSymbol(f);const i=h["_getSprite".trim()]();if(i){const e=i.canvas,t=e.width,o=e.height,s=e.getContext("2d").getImageData(0,0,t,o).data;r[a]={data:{data:new Uint8ClampedArray(s),width:t,height:o},url:a},n.push(r[a].data.data.buffer),this._addCache(a,s,t,o)}}else{if(this._requesting[a]){d=!0,o++,this._requesting[a].push(l);continue}this._requesting[a]=[],this._requesting[a].push(l);const e=new Image;e.index=t,e.size=s,e.onload=c,e.onerror=p,e.onabort=p,e.url=a,e.crossOrigin="Anonymous",d=!0,o++,e.src=m}}d||t(null,{icons:r,buffers:n})}_hasCache(e,t,i){const r=this._cache.get(e);return r&&"error"!==r&&r.data.width>=t&&r.data.height>=i}_addCache(e,t,i,r){this._hasCache(e,i,r)||this._cache.add(e,t?{data:{data:t,width:i,height:r},url:e}:"error")}_getCache(e,t){if(!this._hasCache(e,t[0],t[1]))return null;const i=this._cache.get(e);return i?"error"===i?i:{data:{data:new Uint8ClampedArray(i.data.data),width:i.data.width,height:i.data.height},url:i.url}:null}_ensureMaxSize(e,t){if(!t[0]||!t[1])return;const i=this.options.maxSize||2048;let[r,n]=t;const o=r/n;if(e){const t=this._cache.get(e);if(t&&"error"!==t){const{width:e,height:i}=t.data;e>r&&(r=e),i>n&&(n=i)}}r>i&&(n=i/o,r=i),n>i&&(r=i*o,n=i),t[0]=Math.floor(r),t[1]=Math.floor(n)}}function ea(e){return 3===e.length&&e.push(1),e.reduce(((e,t,i)=>e+(i<3?255*t+",":t+")")),"rgba(")}var ta=Object.freeze({__proto__:null,clipPolygon:Ao$2,calculateSignedArea:ie$3,getFeaAltitudeAndHeight:oe$3,generatePickingIndiceIndex:ue$3,convertRTLText:En$2,packPosition:pe$3,unpackPosition:function(e,t,i,r){const n=(Math.sign(t)||1)*(Math.abs(t)%he$3),o=(Math.sign(i)||1)*(Math.abs(i)%he$3),a=Math.floor(Math.abs(t)/he$3),s=Math.floor(Math.abs(i)/he$3);return e[0]=n,e[1]=o,e[2]=Math.sign(r+1e-5)*(2*a+s)*de$3+r,e},convertGeometry:L$6,getPosArrayType:O$5,getUnsignedArrayType:R$5,getIndexArrayType:E$4});const ia={},ra={},na=[];var oa=Object.freeze({__proto__:null,loadSymbolFnTypes:function e(t,n){if(!t)return null;var o=!1;if(Array.isArray(t)){var a,s=[];for(let i=0;i<t.length;i++)(a=e(t[i],n))?(s.push(a),o=!0):s.push(t[i]);return o?s:t}var l={__fn_types_loaded:!0};const u=[];for(const e in t)G$5(t,e)&&u.push(e);const c=function(e){Object.defineProperty(l,e,{get:function(){return this["__fn_"+e]||(this["__fn_"+e]=interpolated(this["_"+e])),this["__fn_"+e].apply(this,n())},set:function(t){this["_"+e]=t},configurable:!0,enumerable:!0})},p={},h=function(e,t){Object.defineProperty(l,e,{get:function(){this["__fn_"+e]||(this["__fn_"+e]=ir$3(this["_"+e],t));const i=n()[0];p.zoom=i;try{return this["__fn_"+e].evaluateWithoutErrorHandling(p,ia,ra,null,na)}catch(e){return null}},set:function(t){this["_"+e]=t},configurable:!0,enumerable:!0})};for(let e=0,r=u.length;e<r;e++){const r=u[e];if(isFunctionDefinition(t[r]))o=!0,l["_"+r]=t[r],c(r);else if(rr$3(t[r])){o=!0;const e=lr$3(r);l["_"+r]=t[r],h(r,e)}else l[r]=t[r]}return o?l:t}});const sa={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textStyle:1,textFaceName:1,textWeight:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1},la={visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},ua={lineDasharray:1};Object.assign(la,sa),Object.assign(ua,sa);
/*!
	* Contains code from jquery.easing
	* BSD License
	* https://github.com/gdsmith/jquery.easing/
	*/
var pow=Math.pow,sqrt=Math.sqrt,sin=Math.sin,cos=Math.cos,PI=Math.PI,c1=1.70158,c2=1.525*c1,c3=c1+1,c4=2*PI/3,c5=2*PI/4.5;function bounceOut(x){var n1=7.5625,d1=2.75;return x<1/d1?n1*x*x:x<2/d1?n1*(x-=1.5/d1)*x+.75:x<2.5/d1?n1*(x-=2.25/d1)*x+.9375:n1*(x-=2.625/d1)*x+.984375}function j$4(easing,x){switch(easing=easing.toLowerCase()){case"swing":return function(x){return easeInQuad(x)}(x);case"easeinquad":return easeInQuad(x);case"easeoutquad":return function(x){return 1-(1-x)*(1-x)}(x);case"easeinoutquad":return function(x){return x<.5?2*x*x:1-pow(-2*x+2,2)/2}(x);case"easeincubic":return function(x){return x*x*x}(x);case"easeoutcubic":return function(x){return 1-pow(1-x,3)}(x);case"easeinoutcubic":return function(x){return x<.5?4*x*x*x:1-pow(-2*x+2,3)/2}(x);case"easeinquart":return function(x){return x*x*x*x}(x);case"easeoutquart":return function(x){return 1-pow(1-x,4)}(x);case"easeinoutquart":return function(x){return x<.5?8*x*x*x*x:1-pow(-2*x+2,4)/2}(x);case"easeinquint":return function(x){return x*x*x*x*x}(x);case"easeoutquint":return function(x){return 1-pow(1-x,5)}(x);case"easeinoutquint":return function(x){return x<.5?16*x*x*x*x*x:1-pow(-2*x+2,5)/2}(x);case"easeinsine":return function(x){return 1-cos(x*PI/2)}(x);case"easeoutsine":return function(x){return sin(x*PI/2)}(x);case"easeinoutsine":return function(x){return-(cos(PI*x)-1)/2}(x);case"easeinexpo":return function(x){return 0===x?0:pow(2,10*x-10)}(x);case"easeoutexpo":return function(x){return 1===x?1:1-pow(2,-10*x)}(x);case"easeinoutexpo":return function(x){return 0===x?0:1===x?1:x<.5?pow(2,20*x-10)/2:(2-pow(2,-20*x+10))/2}(x);case"easeincirc":return function(x){return 1-sqrt(1-pow(x,2))}(x);case"easeoutcirc":return function(x){return sqrt(1-pow(x-1,2))}(x);case"easeinoutcirc":return function(x){return x<.5?(1-sqrt(1-pow(2*x,2)))/2:(sqrt(1-pow(-2*x+2,2))+1)/2}(x);case"easeinelastic":return function(x){return 0===x?0:1===x?1:-pow(2,10*x-10)*sin((10*x-10.75)*c4)}(x);case"easeoutelastic":return function(x){return 0===x?0:1===x?1:pow(2,-10*x)*sin((10*x-.75)*c4)+1}(x);case"easeinoutelastic":return function(x){return 0===x?0:1===x?1:x<.5?-pow(2,20*x-10)*sin((20*x-11.125)*c5)/2:pow(2,-20*x+10)*sin((20*x-11.125)*c5)/2+1}(x);case"easeinback":return function(x){return c3*x*x*x-c1*x*x}(x);case"easeoutback":return function(x){return 1+c3*pow(x-1,3)+c1*pow(x-1,2)}(x);case"easeinoutback":return function(x){return x<.5?pow(2*x,2)*(7.189819*x-c2)/2:(pow(2*x-2,2)*((c2+1)*(2*x-2)+c2)+2)/2}(x);case"easeinbounce":return function(x){return 1-bounceOut(1-x)}(x);case"easeoutbounce":return function(x){return bounceOut(x)}(x);case"easeinoutbounce":return function(x){return x<.5?(1-bounceOut(1-2*x))/2:(1+bounceOut(2*x-1))/2}(x)}throw new Error("Unsupported easing function:"+easing)}function easeInQuad(x){return x*x}function VectorTilePlugin(){}const parentProto=VectorTilePlugin.prototype;parentProto.getType=function(){return Object.getPrototypeOf(this).constructor.type},parentProto.isVisible=function(){throw new Error("to be implemented.")},parentProto.prepareRender=function(){throw new Error("to be implemented.")},parentProto.updateCollision=function(){throw new Error("to be implemented.")},parentProto.supportRenderMode=function(){throw new Error("to be implemented.")},parentProto.startFrame=function(){throw new Error("to be implemented.")},parentProto.endFrame=function(){throw new Error("to be implemented.")},parentProto.paintTile=function(){throw new Error("to be implemented.")},parentProto.getShadowMeshes=function(){throw new Error("to be implemented.")},parentProto.updateSceneConfig=function(){throw new Error("to be implemented.")},parentProto.updateDataConfig=function(){throw new Error("to be implemented.")},parentProto.updateSymbol=function(){throw new Error("to be implemented.")},parentProto.pick=function(){throw new Error("to be implemented.")},parentProto.resize=function(){throw new Error("to be implemented.")},parentProto.deleteTile=function(){throw new Error("to be implemented.")},parentProto.remove=function(){throw new Error("to be implemented.")},parentProto.needToRedraw=function(){throw new Error("to be implemented.")},parentProto.needToRetireFrames=function(){throw new Error("to be implemented.")},parentProto.outline=function(){throw new Error("to be implemented.")},parentProto.outlineAll=function(){throw new Error("to be implemented.")},parentProto.needPolygonOffset=function(){throw new Error("to be implemented.")},parentProto.constructor=VectorTilePlugin;const hasOwn=Object.prototype.hasOwnProperty;function registerAt(VectorTileLayer){VectorTileLayer.registerPlugin(this)}
/*!
	 * @maptalks/vt v0.79.1
	 * LICENSE : undefined
	 * (c) 2016-2023 maptalks.org
	 */VectorTilePlugin.extend=function(type,props){const clazz=function(){this.init&&this.init()},proto=Object.create(parentProto);proto.constructor=clazz,clazz.prototype=proto,clazz.type=type;for(const p in props)hasOwn.call(props,p)&&(clazz.prototype[p]=props[p]);return clazz.registerAt=registerAt.bind(clazz),clazz};const N$5='function(t){let e;const n={width:100,height:10};function i(){if(!e){const{width:t,height:i}=n;OffscreenCanvas?e=new OffscreenCanvas(t,i):(e=document.createElement("canvas"),e.width=t,e.height=i)}return e}class r{constructor(t,e={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let i=1/0,r=-1/0;for(let e=0,n=t.length;e<n;e++){const n=t[e][0];i=Math.min(n,i),r=Math.max(n,r)}this.min=i,this.max=r,this.valueOffset=this.max-this.min,this.options=Object.assign({},n,e),this.t()}getImageData(){return this.imgData}t(){const t=i(),{width:e,height:n}=this.options;t.width=e,t.height=n;const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height);const o=r.createLinearGradient(0,0,t.width,0),{colors:s,valueOffset:a}=this;for(let t=0,e=s.length;t<e;t++){const[e,n]=s[t],i=(e-this.min)/a;o.addColorStop(i,n)}r.fillStyle=o,r.fillRect(0,0,t.width,t.height),this.imgData=r.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t);const e=((t=Math.min(t,this.max))-this.min)/this.valueOffset;let n=Math.round(e*this.imgData.width);n=Math.min(n,this.imgData.width-1);const i=4*n;return[this.imgData.data[i],this.imgData.data[i+1],this.imgData.data[i+2],this.imgData.data[i+3]]}}var o;function s(t,e){for(let n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.default}function a(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function l(t,e){for(var n=void 0!==t.base?t.base:1,i=0;!(i>=t.stops.length||e<=t.stops[i][0]);)i++;return 0===i?t.stops[i][1]:i===t.stops.length?t.stops[i-1][1]:function t(e,n,i,r,o,s){return"function"==typeof o?function(){var a=o.apply(void 0,arguments),l=s.apply(void 0,arguments);return t(e,n,i,r,a,l)}:o.length?function(t,e,n,i,r,o){var s=[];for(let a=0;a<r.length;a++)s[a]=d(t,e,n,i,r[a],o[a]);return s}(e,n,i,r,o,s):d(e,n,i,r,o,s)}(e,n,t.stops[i-1][0],t.stops[i][0],t.stops[i-1][1],t.stops[i][1])}"function"==typeof Map&&(o=new Map);const u={width:100,height:1};function c(t,e){const n=t.stops;if(n&&n.length>1){let t;if(o){const e=JSON.stringify(n);if(!o.has(e)){const t=new r(n,u);o.set(e,t)}t=o.get(e)}else t=new r(n,u);const[i,s,a,l]=t.getColor(e);return[i/255,s/255,a/255,l/255]}return n&&1===n.length?n[0][1]:null}function h(t,e){return function(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:null}(e,t.default)}function d(t,e,n,i,r,o){var s,a=i-n,l=t-n;return r*(1-(s=1===e?l/a:(Math.pow(e,l)-1)/(Math.pow(e,a)-1)))+o*s}function f(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function p(t){return g(t,"exponential")}function m(t){return g(t,"interval")}function y(t,e){if(!t)return null;var n=!1;if(Array.isArray(t)){var i,r=[];for(let o=0;o<t.length;o++)(i=y(t[o],e))?(r.push(i),n=!0):r.push(t[o]);return n?r:t}var o,s={__fn_types_loaded:!0},a=[];for(o in t)t.hasOwnProperty(o)&&a.push(o);const l=function(t){Object.defineProperty(s,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=p(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})};for(let e=0,i=a.length;e<i;e++)f(t[o=a[e]])?(n=!0,s["_"+o]=t[o],l(o)):s[o]=t[o];return n?s:t}function g(t,e){if(!f(t))return function(){return t};let n=!0,i=!0;const r=(t=JSON.parse(JSON.stringify(t))).stops;if(r)for(let t=0;t<r.length;t++)if(f(r[t][1])){const o=g(r[t][1],e);n=n&&o.isZoomConstant,i=i&&o.isFeatureConstant,r[t]=[r[t][0],o]}const o=function t(e,n){var i,r,o;if(f(e)){var u,d=e.stops&&"object"==typeof e.stops[0][0],p=d||void 0!==e.property,m=d||!p,y=e.type||n||"exponential";if("exponential"===y)u=l;else if("interval"===y)u=a;else if("categorical"===y)u=s;else if("identity"===y)u=h;else{if("color-interpolate"!==y)throw new Error(\'Unknown function type "\'+y+\'"\');u=c}if(d){var g={},b=[];for(let t=0;t<e.stops.length;t++){var v=e.stops[t];void 0===g[v[0].zoom]&&(g[v[0].zoom]={zoom:v[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),g[v[0].zoom].stops.push([v[0].value,v[1]])}for(let e in g)b.push([g[e].zoom,t(g[e])]);i=function(t,n){const i=l({stops:b,base:e.base},t)(t,n);return"function"==typeof i?i(t,n):i},r=!1,o=!1}else m?(i=function(t){const n=u(e,t);return"function"==typeof n?n(t):n},r=!0,o=!1):(i=function(t,n){const i=u(e,n?n[e.property]:null);return"function"==typeof i?i(t,n):i},r=!1,o=!0)}else i=function(){return e},r=!0,o=!0;return i.isZoomConstant=o,i.isFeatureConstant=r,i}(t,e);return o.isZoomConstant=n&&o.isZoomConstant,o.isFeatureConstant=i&&o.isFeatureConstant,o}let b=0;const v="function"==typeof Object.assign;function w(t,...e){if(v)return Object.assign(t,...e),t;for(let n=0;n<e.length;n++){const i=e[n];for(const e in i)t[e]=i[e]}return t}function x(t){return!A(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function k(t){return"number"==typeof t&&!isNaN(t)}function M(t){return!A(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function j(t){return!Array.isArray(t)&&"object"==typeof t&&!!t}function A(t){return null==t}function F(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)for(let e=0,i=n.length;e<i;e++)t.push(n[e])}return t.length}function T(t){return f(t)&&t.property}const z="function"==typeof fetch&&"function"==typeof AbortController,S={jsonp:function(t,e){const n="_maptalks_jsonp_"+b++;t.match(/\\?/)?t+="&callback="+n:t+="?callback="+n;let i=document.createElement("script");return i.type="text/javascript",i.src=t,window[n]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(t,e,n){if(M(e)){const t=n;n=e,e=t}(e=e||{}).method&&(e.method=e.method.toUpperCase());const i="POST"===e.method;if(z){const i=new AbortController,r=e;return r.signal=i.signal,r.referrerPolicy=r.referrerPolicy||"origin",r.method=r.method||"GET",fetch(t,r).then(i=>{const r=this.o(i,e.returnJSON,e.responseType);r.message?(r.url=t,n(r)):r.then(t=>{"arraybuffer"===e.responseType?n(null,{data:t,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires"),contentType:i.headers.get("Content-Type")}):n(null,t)}).catch(t=>{t.code&&t.code===DOMException.ABORT_ERR||(console.error(t),n(t))})}).catch(t=>{t.code&&t.code===DOMException.ABORT_ERR||(console.error(t),n(t))}),i}{const r=S.s(n);if(r.open(e.method||"GET",t,!0),e){for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(i?e.body:null),r}},o:(t,e,n)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===n?t.arrayBuffer():e?t.json():t.text(),u:function(t,e){return function(){if(4===t.readyState)if(200===t.status)if("arraybuffer"===t.responseType){0===t.response.byteLength?e({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")})}else e(null,t.responseText);else e({status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`})}},s:function(t){let e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=S.u(e,t),e},getArrayBuffer(t,e,n){if(M(e)){const t=n;n=e,e=t}return e||(e={}),e.responseType="arraybuffer",S.get(t,e,n)}};function _(t,e,n,i,r,o){let s=r-n,a=o-i;if(0!==s||0!==a){const l=((t-n)*s+(e-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return s=t-n,a=e-i,s*s+a*a}function P(t,e,n,i,r,o){const s={id:null==t?null:t,type:e,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};r&&(s.layer=r);return function(t,e){const n=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)I(t,n,e);else if("Polygon"===i)I(t,n[0],e);else if("MultiLineString"===i)for(const i of n)I(t,i,e);else if("MultiPolygon"===i)for(const i of n)I(t,i[0],e)}(s,o?4:3),s}function I(t,e,n){for(let i=0;i<e.length;i+=n)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function O(t,e,n,i){if(i.layer=e,"FeatureCollection"===n.type)for(let e=0;e<n.features.length;e++)q(t,n.features[e],i,e);else"Feature"===n.type?q(t,n,i):q(t,{geometry:n},i)}function q(t,e,n,i){if(!e.geometry)return;const r=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let a=[],l=e.id;if(n.promoteId?l=e.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===o)C(r,a,n);else if("MultiPoint"===o)for(const t of r)C(t,a,n);else if("LineString"===o)R(r,a,s,!1,n);else if("MultiLineString"===o){if(n.lineMetrics){for(const i of r)a=[],R(i,a,s,!1,n),t.push(P(l,"LineString",a,e.properties,n.layer,n.hasAltitude));return}N(r,a,s,!1,n)}else if("Polygon"===o)N(r,a,s,!0,n);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const r of e.geometry.geometries)q(t,{id:l,geometry:r,properties:e.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of r){const e=[];N(t,e,s,!0,n),a.push(e)}}t.push(P(l,o,a,e.properties,n.layer,n.hasAltitude))}function C(t,e,n){e.push(E(t[0]),L(t[1],n.projection),0),n.hasAltitude&&(t.length>2?e.push(t[2]):e.push(0))}function R(t,e,n,i,r){let o,s,a=0;for(let n=0;n<t.length;n++){const l=E(t[n][0]),u=L(t[n][1],r.projection);e.push(l,u,0),r.hasAltitude&&(t[n].length>2?e.push(t[n][2]):e.push(0)),n>0&&(a+=i?(o*u-l*s)/2:Math.sqrt(Math.pow(l-o,2)+Math.pow(u-s,2))),o=l,s=u}const l=r.hasAltitude?4:3,u=e.length-l;e[2]=1,function t(e,n,i,r,o=3){let s=r;const a=i-n>>1;let l,u=i-n;const c=e[n],h=e[n+1],d=e[i],f=e[i+1];for(let t=n+o;t<i;t+=o){const n=_(e[t],e[t+1],c,h,d,f);if(n>s)l=t,s=n;else if(n===s){const e=Math.abs(t-a);e<u&&(l=t,u=e)}}s>r&&(l-n>o&&t(e,n,l,r,o),e[l+2]=s,i-l>o&&t(e,l,i,r,o))}(e,0,u,n,l),e[u+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function N(t,e,n,i,r){for(let o=0;o<t.length;o++){const s=[];R(t[o],s,n,i,r),e.push(s)}}function E(t){return t/360+.5}function L(t,e){switch(e){case"EPSG:4326":return(90-t)/360}const n=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+n)/(1-n))/Math.PI;return i<0?0:i>1?1:i}function D(t,e,n,i,r,o,s,a){if(i/=e,o>=(n/=e)&&s<i)return t;if(s<n||o>=i)return null;const l=[];for(const e of t){const t=e.geometry;let o=e.type;const s=0===r?e.minX:e.minY,u=0===r?e.maxX:e.maxY;if(s>=n&&u<i){l.push(e);continue}if(u<n||s>=i)continue;let c=[];if("Point"===o||"MultiPoint"===o)$(t,c,n,i,r,a.hasAltitude);else if("LineString"===o)U(t,c,n,i,r,!1,a.lineMetrics,a.hasAltitude);else if("MultiLineString"===o)J(t,c,n,i,r,!1,a.hasAltitude);else if("Polygon"===o)J(t,c,n,i,r,!0,a.hasAltitude);else if("MultiPolygon"===o)for(const e of t){const t=[];J(e,t,n,i,r,!0,a.hasAltitude),t.length&&c.push(t)}if(c.length){if(a.lineMetrics&&"LineString"===o){for(const t of c)l.push(P(e.id,o,t,e.tags,e.layer,a.hasAltitude));continue}"LineString"!==o&&"MultiLineString"!==o||(1===c.length?(o="LineString",c=c[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===c.length?"Point":"MultiPoint"),l.push(P(e.id,o,c,e.tags,e.layer,a.hasAltitude))}}return l.length?l:null}function $(t,e,n,i,r,o){const s=o?4:3;for(let a=0;a<t.length;a+=s){const s=t[a+r];s>=n&&s<=i&&(H(e,t[a],t[a+1],t[a+2]),o&&e.push(t[a+3]))}}function U(t,e,n,i,r,o,s,a){let l=W(t);const u=0===r?G:V;let c,h,d=t.start;const f=a?4:3,p=o?t.length:t.length-f;for(let m=0;m<p;m+=f){const y=t[m],g=t[m+1],b=t[m+2];let v,w,x,k;o&&m===p-f?(v=t[0],w=t[1]):(v=t[m+f],w=t[m+f+1]),a&&(x=t[m+3],k=o&&m===p-f?t[3]:t[m+f+3]);const M=0===r?y:g,j=0===r?v:w;let A=!1;s&&(c=Math.sqrt(Math.pow(y-v,2)+Math.pow(g-w,2))),M<n?j>n&&(h=u(l,y,g,v,w,n),a&&l.push(B(x,k,h)),s&&(l.start=d+c*h)):M>i?j<i&&(h=u(l,y,g,v,w,i),a&&l.push(B(x,k,h)),s&&(l.start=d+c*h)):(H(l,y,g,b),a&&l.push(x)),j<n&&M>=n&&(h=u(l,y,g,v,w,n),a&&l.push(B(x,k,h)),A=!0),j>i&&M<=i&&(h=u(l,y,g,v,w,i),a&&l.push(B(x,k,h)),A=!0),!o&&A&&(s&&(l.end=d+c*h),e.push(l),l=W(t)),s&&(d+=c)}let m=t.length-f;if(!o){const e=t[m],o=t[m+1],s=t[m+2],u=0===r?e:o;if(u>=n&&u<=i&&H(l,e,o,s),u>=n&&u<=i&&a){const e=t[m+3];l.push(e)}}m=l.length-f,o&&m>=f&&(l[m]!==l[0]||l[m+1]!==l[1])&&(H(l,l[0],l[1],l[2]),a&&l.push(l[3])),l.length&&e.push(l)}function W(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function J(t,e,n,i,r,o,s){for(const a of t)U(a,e,n,i,r,o,!1,s)}function H(t,e,n,i){t.push(e,n,i)}function G(t,e,n,i,r,o){const s=(o-e)/(i-e);return H(t,o,n+(r-n)*s,1),s}function V(t,e,n,i,r,o){const s=(o-n)/(r-n);return H(t,e+(i-e)*s,o,1),s}function B(t,e,n){return t+(e-t)*n}function Z(t,e,n){const i=[];for(let r=0;r<t.length;r++){const o=t[r],s=o.type;let a;if("Point"===s||"MultiPoint"===s||"LineString"===s)a=Y(o.geometry,e,n);else if("MultiLineString"===s||"Polygon"===s){a=[];for(const t of o.geometry)a.push(Y(t,e,n))}else if("MultiPolygon"===s){a=[];for(const t of o.geometry){const i=[];for(const r of t)i.push(Y(r,e,n));a.push(i)}}i.push(P(o.id,s,a,o.tags,o.layer,n))}return i}function Y(t,e,n){const i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);const r=n?4:3;for(let o=0;o<t.length;o+=r)i.push(t[o]+e,t[o+1],t[o+2]),n&&i.push(t[o+3]);return i}function X(t,e,n){if(t.transformed)return t;const i=1<<t.z,r=t.x,o=t.y,s=n?3:2;for(const a of t.features){const t=a.geometry,l=a.type;if(a.geometry=[],1===l)for(let l=0;l<t.length;l+=s)a.geometry.push(K(t[l],t[l+1],e,i,r,o)),n&&a.geometry[a.geometry.length-1].push(t[l+2]);else for(let l=0;l<t.length;l++){const u=[];for(let a=0;a<t[l].length;a+=s)u.push(K(t[l][a],t[l][a+1],e,i,r,o)),n&&u[u.length-1].push(t[l][a+2]);a.geometry.push(u)}}return t.transformed=!0,t}function K(t,e,n,i,r,o){return[Math.round(n*(t*i-r)),Math.round(n*(e*i-o))]}function Q(t,e,n,i,r){const o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:n,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)tt(s,e,o,r);return s}function tt(t,e,n,i){const r=e.geometry,o=e.type,s=[],a=i.hasAltitude?4:3;if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===o||"MultiPoint"===o)for(let e=0;e<r.length;e+=a)s.push(r[e],r[e+1]),i.hasAltitude&&s.push(r[e+3]),t.numPoints++,t.numSimplified++;else if("LineString"===o)nt(s,r,t,n,!1,!1,i);else if("MultiLineString"===o||"Polygon"===o)for(let e=0;e<r.length;e++)nt(s,r[e],t,n,"Polygon"===o,0===e,i);else if("MultiPolygon"===o)for(let e=0;e<r.length;e++){const o=r[e];for(let e=0;e<o.length;e++)nt(s,o[e],t,n,!0,0===e,i)}if(s.length){let n=e.tags||null;if("LineString"===o&&i.lineMetrics){n={};for(const t in e.tags)n[t]=e.tags[t];n.mapbox_clip_start=r.start/r.size,n.mapbox_clip_end=r.end/r.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:n};e.layer&&(a.layer=e.layer),null!==e.id&&(a.id=e.id),t.features.push(a)}}function et(t,e,n){return 0===t[e+2]&&t[e+3]>0&&n}function nt(t,e,n,i,r,o,s){const a=i*i,{hasAltitude:l,disableFilter:u}=s,c=l?4:3;if(!u&&i>0&&e.size<(r?a:i))return void(n.numPoints+=e.length/c);const h=[];for(let t=0;t<e.length;t+=c)(0===i||e[t+2]>a||et(e,t,l))&&(n.numSimplified++,h.push(e[t],e[t+1]),l&&h.push(e[t+3])),n.numPoints++;r&&function(t,e,n){const i=n?3:2;let r=0;for(let e=0,n=t.length,o=n-i;e<n;o=e,e+=i)r+=(t[e]-t[o])*(t[e+1]+t[o+1]);if(r>0===e){const e=i,r=i-1,o=i-2;for(let s=0,a=t.length;s<a/2;s+=i){const i=t[s],l=t[s+1];let u;n&&(u=t[s+2]),t[s]=t[a-e-s],t[s+1]=t[a-r-s],n&&(t[s+2]=t[a-o-s]),t[a-e-s]=i,t[a-r-s]=l,n&&(t[a-o-s]=u)}}}(h,o,l),t.push(h)}S.getJSON=function(t,e,n){if(M(e)){const t=n;n=e,e=t}const i=function(t,e){const i="string"==typeof e?JSON.parse(e):e||null;n(t,i)};return e&&e.jsonp?S.jsonp(t,i):((e=e||{}).returnJSON=!0,S.get(t,e,i))};const it={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,hasAltitude:!1,disableFilter:!1,debug:0};class rt{constructor(t,e){const n=(e=this.options=function(t,e){for(const n in e)t[n]=e[n];return t}(Object.create(it),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(t,e){const n=[];if(Array.isArray(t)){for(let i=0;i<t.length;i++)O(n,t[i].layer,t[i].data,e);return n}if("FeatureCollection"===t.type)for(let i=0;i<t.features.length;i++)q(n,t.features[i],e,i);else"Feature"===t.type?q(n,t,e):q(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){const n=e.buffer/e.extent;let i=t;const r=D(t,1,-1-n,n,0,-1,2,e),o=D(t,1,1-n,2+n,0,-1,2,e);return(r||o)&&(i=D(t,1,-n,1+n,0,-1,2,e)||[],r&&(i=Z(r,1,e.hasAltitude).concat(i)),o&&(i=i.concat(Z(o,-1,e.hasAltitude)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,n,i,r,o,s){const a=[t,e,n,i],l=this.options,u=l.debug;for(;a.length;){i=a.pop(),n=a.pop(),e=a.pop(),t=a.pop();const c=1<<e,h=ot(e,n,i);let d=this.tiles[h];if(!d&&(u>1&&console.time("creation"),d=this.tiles[h]=Q(t,e,n,i,l),this.tileCoords.push({z:e,x:n,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const t="z"+e;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(d.source=t,null==r){if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===r)continue;if(null!=r){const t=r-e;if(n!==o>>t||i!==s>>t)continue}}if(d.source=null,0===t.length)continue;u>1&&console.time("clipping");const f=.5*l.buffer/l.extent,p=.5-f,m=.5+f,y=1+f;let g=null,b=null,v=null,w=null,x=D(t,c,n-f,n+m,0,d.minX,d.maxX,l),k=D(t,c,n+p,n+y,0,d.minX,d.maxX,l);t=null,x&&(g=D(x,c,i-f,i+m,1,d.minY,d.maxY,l),b=D(x,c,i+p,i+y,1,d.minY,d.maxY,l),x=null),k&&(v=D(k,c,i-f,i+m,1,d.minY,d.maxY,l),w=D(k,c,i+p,i+y,1,d.minY,d.maxY,l),k=null),u>1&&console.timeEnd("clipping"),a.push(g||[],e+1,2*n,2*i),a.push(b||[],e+1,2*n,2*i+1),a.push(v||[],e+1,2*n+1,2*i),a.push(w||[],e+1,2*n+1,2*i+1)}}getTile(t,e,n){t=+t,e=+e,n=+n;const i=this.options,{extent:r,debug:o}=i,{hasAltitude:s}=i;if(t<0||t>24)return null;const a=1<<t,l=ot(t,e=e+a&a-1,n);if(this.tiles[l])return X(this.tiles[l],r,s);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);let u,c=t,h=e,d=n;for(;!u&&c>0;)c--,h>>=1,d>>=1,u=this.tiles[ot(c,h,d)];return u&&u.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,h,d),console.time("drilling down")),this.splitTile(u.source,c,h,d,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[l]?X(this.tiles[l],r,s):null):null}}function ot(t,e,n){return 32*((1<<t)*n+e)+t}function st(t,e,n,i,r,o){const s=n&&Array.isArray(n[0]);for(let a=0,l=n.length;a<l;a++){t[e]=Math.round((s?n[a][0]:n[a].x)*i),t[e+1]=Math.round((s?n[a][1]:n[a].y)*i);let u=r||0;Array.isArray(r)&&(u=r[a]),u=u?Math.round(i*u):0,t[e+2]=u,e+=3,o&&0!==a&&a!==l-1&&(t[e]=t[e-3],t[e+1]=t[e-2],t[e+2]=t[e-1],e+=3)}return e}function at(t,e,n,i){const r=t[3*e],o=t[3*e+1],s=t[3*n],a=t[3*n+1];return r===s&&(r<0||r>i)||o===a&&(o<0||o>i)}class lt{constructor(t,e){this.x=t,this.y=e}clone(){return new lt(this.x,this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}negate(){this.x=-this.x,this.y=-this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}diff(t){return new lt(this.x-t.x,this.y-t.y)}distance(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}orthogonal(){return new lt(this.y,-this.x)}}function ut(t,e,n){const i=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x);return i>1e-5?1:i<-1e-5?2:0}function ct(t,e,n,i){const r=e.x*i.y-e.y*i.x,o=n.x-t.x,s=n.y-t.y,a=(o*i.y-s*i.x)/r;return new lt(t.x+a*e.x,t.y+a*e.y)}const ht=[];function dt(t,e,n){let i=0;const r=[];for(let o=e;o<n;o+=3)ht[i]?(ht[i].x=t[o],ht[i].y=t[o+1]):ht[i]=new lt(t[o],t[o+1]),r.push(ht[i]),i++;const o=function(t){let e;this.UpdateOmbb=function(t,n,i,r,o,s,a,l){const u=ct(t,n,o,s),c=ct(i,r,o,s),h=ct(a,l,t,n),d=ct(a,l,i,r),f=u.distance(c)*u.distance(h);f<this.BestObbArea&&(e=[u,h,d,c],this.BestObbArea=f)},this.BestObbArea=Number.MAX_VALUE;const n=[];for(let e=0;e<t.length;e++)n.push(t[(e+1)%t.length].diff(t[e])),n[e].normalize();const i=new lt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new lt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);let o,s,a,l;for(let e=0;e<t.length;e++){const n=t[e];n.x<i.x&&(i.x=n.x,o=e),n.x>r.x&&(r.x=n.x,s=e),n.y<i.y&&(i.y=n.y,l=e),n.y>r.y&&(r.y=n.y,a=e)}let u=new lt(0,-1),c=new lt(0,1),h=new lt(-1,0),d=new lt(1,0);for(let e=0;e<t.length;e++){const e=[Math.acos(u.dot(n[o])),Math.acos(c.dot(n[s])),Math.acos(h.dot(n[a])),Math.acos(d.dot(n[l]))];switch(e.indexOf(Math.min.apply(Math,e))){case 0:u=n[o].clone(),c=u.clone(),c.negate(),h=u.orthogonal(),d=h.clone(),d.negate(),o=(o+1)%t.length;break;case 1:c=n[s].clone(),u=c.clone(),u.negate(),h=u.orthogonal(),d=h.clone(),d.negate(),s=(s+1)%t.length;break;case 2:h=n[a].clone(),d=h.clone(),d.negate(),u=d.orthogonal(),c=u.clone(),c.negate(),a=(a+1)%t.length;break;case 3:d=n[l].clone(),h=d.clone(),h.negate(),u=d.orthogonal(),c=u.clone(),c.negate(),l=(l+1)%t.length}this.UpdateOmbb(t[o],u,t[s],c,t[a],h,t[l],d)}return e}(function(t){if(t.length<3)return t;let e=t[0];const n=[];for(let n=1;n<t.length;n++)(t[n].x<e.x||Math.abs(t[n].x-e.x)<1e-5&&t[n].y<e.y)&&(e=t[n]);let i=t[0];do{n.unshift(e.clone());for(let n=1;n<t.length;n++){const r=ut(e,i,t[n]);(i.equals(e)||1===r||0===r&&e.distance(t[n])>e.distance(i))&&(i=t[n])}e=i}while(!i.equals(n[n.length-1]));return n}(r)),s=o[0].distance(o[1]),a=o[1].distance(o[2]),l=o.map(t=>[t.x,t.y]);return l.push(+(a>s)),l}var ft="undefined"!=typeof Float32Array?Float32Array:Array;function pt(){var t=new ft(3);return ft!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function mt(t,e,n){var i=new ft(3);return i[0]=t,i[1]=e,i[2]=n,i}function yt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function gt(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function bt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function vt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function wt(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function xt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function kt(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],l=n[2];return t[0]=r*l-o*a,t[1]=o*s-i*l,t[2]=i*a-r*s,t}var Mt=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t};function jt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function At(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function Ft(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Tt(){var t=new ft(4);return ft!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function zt(t,e){var n=e[0]+e[4]+e[8],i=void 0;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*s+s]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*o+s]-e[3*s+o])*i,t[o]=(e[3*o+r]+e[3*r+o])*i,t[s]=(e[3*s+r]+e[3*r+s])*i}return t}pt(),function(){var t,e=(t=new ft(4),ft!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var St,_t=Ft,Pt=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s),t[0]=n*s,t[1]=i*s,t[2]=r*s,t[3]=o*s),t};function It(t,e){var n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)}pt(),mt(1,0,0),mt(0,1,0),Tt(),Tt(),St=new ft(9),ft!=Float32Array&&(St[1]=0,St[2]=0,St[3]=0,St[5]=0,St[6]=0,St[7]=0),St[0]=1,St[4]=1,St[8]=1;var Ot=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)};function qt(t,e,n,i,r,o,s,a,l,u){0===t?function(t,e,n,i,r,o,s,a,l){const u=[0,0];for(let r=t;r<e;r+=3){const t=r/3*2,e=i[r],c=i[r+1];n[t]=u[0]+e*o*s/a,n[t+1]=u[1]-c*o*s/l}}(e,n,i,r,0,s,a,l,u):1===t&&function(t,e,n,i){const r=dt(i,t,e),o=r[4],s=r[o],a=r[o+1],l=r[o+2],u=(a[1]-s[1])/(a[0]-s[0]),c=(l[1]-a[1])/(l[0]-a[0]),h=It(s,a),d=It(a,l);for(let r=t;r<e;r+=3){const t=r/3*2,e=i[r],o=i[r+1];n[t]=Rt(e,o,s,u,h),n[t+1]=-Rt(e,o,a,c,d)}}(e,n,i,r)}!function(){var t=function(){var t=new ft(2);return ft!=Float32Array&&(t[0]=0,t[1]=0),t}()}();const Ct=[];function Rt(t,e,n,i,r){return Ct[0]=(i*i*n[0]+i*(e-n[1])+t)/(i*i+1),Ct[1]=i*(Ct[0]-n[0])+n[1],It(n,Ct)/r}function Nt(t,e,n,i,r){const o=3*e[n-1],s=3*e[n-1]+1,a=t[o],l=t[s];return u=i,c=r,h=a,d=l,Math.sqrt((h-u)*(h-u)+(d-c)*(d-c));var u,c,h,d}"undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self&&self;var Et=Lt;function Lt(t,e){this.x=t,this.y=e}function Dt(t,e,n){n=n||{},this.w=t||64,this.h=e||64,this.autoResize=!!n.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function $t(t,e,n){this.x=0,this.y=t,this.w=this.free=e,this.h=n}function Ut(t,e,n,i,r,o,s){this.id=t,this.x=e,this.y=n,this.w=i,this.h=r,this.maxw=o||i,this.maxh=s||r,this.refcount=0}Lt.prototype={clone:function(){return new Lt(this.x,this.y)},add:function(t){return this.clone().m(t)},sub:function(t){return this.clone().v(t)},multByPoint:function(t){return this.clone().k(t)},divByPoint:function(t){return this.clone().M(t)},mult:function(t){return this.clone().j(t)},div:function(t){return this.clone().A(t)},rotate:function(t){return this.clone().F(t)},rotateAround:function(t,e){return this.clone().T(t,e)},matMult:function(t){return this.clone().S(t)},unit:function(){return this.clone()._()},perp:function(){return this.clone().P()},round:function(){return this.clone().I()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},S:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},m:function(t){return this.x+=t.x,this.y+=t.y,this},v:function(t){return this.x-=t.x,this.y-=t.y,this},j:function(t){return this.x*=t,this.y*=t,this},A:function(t){return this.x/=t,this.y/=t,this},k:function(t){return this.x*=t.x,this.y*=t.y,this},M:function(t){return this.x/=t.x,this.y/=t.y,this},_:function(){return this.A(this.mag()),this},P:function(){var t=this.y;return this.y=this.x,this.x=-t,this},F:function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=i,this.y=r,this},T:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.x+n*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=o,this},I:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Lt.convert=function(t){return t instanceof Lt?t:Array.isArray(t)?new Lt(t[0],t[1]):t},Dt.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var n,i,r,o,s=[],a=0;a<t.length;a++)if(n=t[a].w||t[a].width,i=t[a].h||t[a].height,r=t[a].id,n&&i){if(!(o=this.packOne(n,i,r)))continue;e.inPlace&&(t[a].x=o.x,t[a].y=o.y,t[a].id=o.id),s.push(o)}return this.shrink(),s},Dt.prototype.packOne=function(t,e,n){var i,r,o,s,a,l,u,c,h={freebin:-1,shelf:-1,waste:1/0},d=0;if("string"==typeof n||"number"==typeof n){if(i=this.getBin(n))return this.ref(i),i;"number"==typeof n&&(this.maxId=Math.max(n,this.maxId))}else n=++this.maxId;for(s=0;s<this.freebins.length;s++){if(e===(i=this.freebins[s]).maxh&&t===i.maxw)return this.allocFreebin(s,t,e,n);e>i.maxh||t>i.maxw||e<=i.maxh&&t<=i.maxw&&(o=i.maxw*i.maxh-t*e)<h.waste&&(h.waste=o,h.freebin=s)}for(s=0;s<this.shelves.length;s++)if(d+=(r=this.shelves[s]).h,!(t>r.free)){if(e===r.h)return this.allocShelf(s,t,e,n);e>r.h||e<r.h&&(o=(r.h-e)*t)<h.waste&&(h.freebin=-1,h.waste=o,h.shelf=s)}return-1!==h.freebin?this.allocFreebin(h.freebin,t,e,n):-1!==h.shelf?this.allocShelf(h.shelf,t,e,n):e<=this.h-d&&t<=this.w?(r=new $t(d,this.w,e),this.allocShelf(this.shelves.push(r)-1,t,e,n)):this.autoResize?(a=l=this.h,((u=c=this.w)<=a||t>u)&&(c=2*Math.max(t,u)),(a<u||e>a)&&(l=2*Math.max(e,a)),this.resize(c,l),this.packOne(t,e,n)):null},Dt.prototype.allocFreebin=function(t,e,n,i){var r=this.freebins.splice(t,1)[0];return r.id=i,r.w=e,r.h=n,r.refcount=0,this.bins[i]=r,this.ref(r),r},Dt.prototype.allocShelf=function(t,e,n,i){var r=this.shelves[t].alloc(e,n,i);return this.bins[i]=r,this.ref(r),r},Dt.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,n=0;n<this.shelves.length;n++){var i=this.shelves[n];e+=i.h,t=Math.max(i.w-i.free,t)}this.resize(t,e)}},Dt.prototype.getBin=function(t){return this.bins[t]},Dt.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},Dt.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},Dt.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},Dt.prototype.resize=function(t,e){this.w=t,this.h=e;for(var n=0;n<this.shelves.length;n++)this.shelves[n].resize(t);return!0},$t.prototype.alloc=function(t,e,n){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,new Ut(n,i,this.y,t,e,t,this.h)},$t.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};var Wt={exports:{}},Jt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ht={exports:{}},Gt=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},Vt=Array.prototype.concat,Bt=Array.prototype.slice,Zt=Ht.exports=function(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];Gt(r)?e=Vt.call(e,Bt.call(r)):e.push(r)}return e};Zt.wrap=function(t){return function(){return t(Zt(arguments))}};var Yt=Jt,Xt=Ht.exports,Kt=Object.hasOwnProperty,Qt=Object.create(null);for(var te in Yt)Kt.call(Yt,te)&&(Qt[Yt[te]]=te);var ee=Wt.exports={to:{},get:{}};function ne(t,e,n){return Math.min(Math.max(e,t),n)}function ie(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}ee.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=ee.get.hsl(t),n="hsl";break;case"hwb":e=ee.get.hwb(t),n="hwb";break;default:e=ee.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},ee.get.rgb=function(t){if(!t)return null;var e,n,i,r=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=e[2],e=e[1],n=0;n<3;n++){var o=2*n;r[n]=parseInt(e.slice(o,o+2),16)}i&&(r[3]=parseInt(i,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(i=(e=e[1])[3],n=0;n<3;n++)r[n]=parseInt(e[n]+e[n],16);i&&(r[3]=parseInt(i+i,16)/255)}else if(e=t.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(n=0;n<3;n++)r[n]=parseInt(e[n+1],0);e[4]&&(e[5]?r[3]=.01*parseFloat(e[4]):r[3]=parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(e=t.match(/^(\\w+)$/))?"transparent"===e[1]?[0,0,0,0]:Kt.call(Yt,e[1])?((r=Yt[e[1]])[3]=1,r):null:null;for(n=0;n<3;n++)r[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(e[5]?r[3]=.01*parseFloat(e[4]):r[3]=parseFloat(e[4]))}for(n=0;n<3;n++)r[n]=ne(r[n],0,255);return r[3]=ne(r[3],0,1),r},ee.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,ne(parseFloat(e[2]),0,100),ne(parseFloat(e[3]),0,100),ne(isNaN(n)?1:n,0,1)]}return null},ee.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,ne(parseFloat(e[2]),0,100),ne(parseFloat(e[3]),0,100),ne(isNaN(n)?1:n,0,1)]}return null},ee.to.hex=function(){var t=Xt(arguments);return"#"+ie(t[0])+ie(t[1])+ie(t[2])+(t[3]<1?ie(Math.round(255*t[3])):"")},ee.to.rgb=function(){var t=Xt(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},ee.to.rgb.percent=function(){var t=Xt(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),i=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+i+"%)":"rgba("+e+"%, "+n+"%, "+i+"%, "+t[3]+")"},ee.to.hsl=function(){var t=Xt(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},ee.to.hwb=function(){var t=Xt(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},ee.to.keyword=function(t){return Qt[t.slice(0,3)]};var re={exports:{}},oe=Jt,se={};for(var ae in oe)oe.hasOwnProperty(ae)&&(se[oe[ae]]=ae);var le=re.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var ue in le)if(le.hasOwnProperty(ue)){if(!("channels"in le[ue]))throw new Error("missing channels property: "+ue);if(!("labels"in le[ue]))throw new Error("missing channel labels property: "+ue);if(le[ue].labels.length!==le[ue].channels)throw new Error("channel and label counts mismatch: "+ue);var ce=le[ue].channels,he=le[ue].labels;delete le[ue].channels,delete le[ue].labels,Object.defineProperty(le[ue],"channels",{value:ce}),Object.defineProperty(le[ue],"labels",{value:he})}function de(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}le.rgb.hsl=function(t){var e,n,i=t[0]/255,r=t[1]/255,o=t[2]/255,s=Math.min(i,r,o),a=Math.max(i,r,o),l=a-s;return a===s?e=0:i===a?e=(r-o)/l:r===a?e=2+(o-i)/l:o===a&&(e=4+(i-r)/l),(e=Math.min(60*e,360))<0&&(e+=360),n=(s+a)/2,[e,100*(a===s?0:n<=.5?l/(a+s):l/(2-a-s)),100*n]},le.rgb.hsv=function(t){var e,n,i,r,o,s=t[0]/255,a=t[1]/255,l=t[2]/255,u=Math.max(s,a,l),c=u-Math.min(s,a,l),h=function(t){return(u-t)/6/c+.5};return 0===c?r=o=0:(o=c/u,e=h(s),n=h(a),i=h(l),s===u?r=i-n:a===u?r=1/3+e-i:l===u&&(r=2/3+n-e),r<0?r+=1:r>1&&(r-=1)),[360*r,100*o,100*u]},le.rgb.hwb=function(t){var e=t[0],n=t[1],i=t[2];return[le.rgb.hsl(t)[0],100*(1/255*Math.min(e,Math.min(n,i))),100*(i=1-1/255*Math.max(e,Math.max(n,i)))]},le.rgb.cmyk=function(t){var e,n=t[0]/255,i=t[1]/255,r=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-i,1-r)))/(1-e)||0),100*((1-i-e)/(1-e)||0),100*((1-r-e)/(1-e)||0),100*e]},le.rgb.keyword=function(t){var e=se[t];if(e)return e;var n,i=1/0;for(var r in oe)if(oe.hasOwnProperty(r)){var o=de(t,oe[r]);o<i&&(i=o,n=r)}return n},le.keyword.rgb=function(t){return oe[t]},le.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,i=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*e+.7152*n+.0722*i),100*(.0193*e+.1192*n+.9505*i)]},le.rgb.lab=function(t){var e=le.rgb.xyz(t),n=e[0],i=e[1],r=e[2];return i/=100,r/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},le.hsl.rgb=function(t){var e,n,i,r,o,s=t[0]/360,a=t[1]/100,l=t[2]/100;if(0===a)return[o=255*l,o,o];e=2*l-(n=l<.5?l*(1+a):l+a-l*a),r=[0,0,0];for(var u=0;u<3;u++)(i=s+1/3*-(u-1))<0&&i++,i>1&&i--,o=6*i<1?e+6*(n-e)*i:2*i<1?n:3*i<2?e+(n-e)*(2/3-i)*6:e,r[u]=255*o;return r},le.hsl.hsv=function(t){var e=t[0],n=t[1]/100,i=t[2]/100,r=n,o=Math.max(i,.01);return n*=(i*=2)<=1?i:2-i,r*=o<=1?o:2-o,[e,100*(0===i?2*r/(o+r):2*n/(i+n)),100*((i+n)/2)]},le.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,i=t[2]/100,r=Math.floor(e)%6,o=e-Math.floor(e),s=255*i*(1-n),a=255*i*(1-n*o),l=255*i*(1-n*(1-o));switch(i*=255,r){case 0:return[i,l,s];case 1:return[a,i,s];case 2:return[s,i,l];case 3:return[s,a,i];case 4:return[l,s,i];case 5:return[i,s,a]}},le.hsv.hsl=function(t){var e,n,i,r=t[0],o=t[1]/100,s=t[2]/100,a=Math.max(s,.01);return i=(2-o)*s,n=o*a,[r,100*(n=(n/=(e=(2-o)*a)<=1?e:2-e)||0),100*(i/=2)]},le.hwb.rgb=function(t){var e,n,i,r,o,s,a,l=t[0]/360,u=t[1]/100,c=t[2]/100,h=u+c;switch(h>1&&(u/=h,c/=h),i=6*l-(e=Math.floor(6*l)),0!=(1&e)&&(i=1-i),r=u+i*((n=1-c)-u),e){default:case 6:case 0:o=n,s=r,a=u;break;case 1:o=r,s=n,a=u;break;case 2:o=u,s=n,a=r;break;case 3:o=u,s=r,a=n;break;case 4:o=r,s=u,a=n;break;case 5:o=n,s=u,a=r}return[255*o,255*s,255*a]},le.cmyk.rgb=function(t){var e=t[0]/100,n=t[1]/100,i=t[2]/100,r=t[3]/100;return[255*(1-Math.min(1,e*(1-r)+r)),255*(1-Math.min(1,n*(1-r)+r)),255*(1-Math.min(1,i*(1-r)+r))]},le.xyz.rgb=function(t){var e,n,i,r=t[0]/100,o=t[1]/100,s=t[2]/100;return n=-.9689*r+1.8758*o+.0415*s,i=.0557*r+-.204*o+1.057*s,e=(e=3.2406*r+-1.5372*o+-.4986*s)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(i=Math.min(Math.max(0,i),1))]},le.xyz.lab=function(t){var e=t[0],n=t[1],i=t[2];return n/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},le.lab.xyz=function(t){var e,n,i,r=t[0];e=t[1]/500+(n=(r+16)/116),i=n-t[2]/200;var o=Math.pow(n,3),s=Math.pow(e,3),a=Math.pow(i,3);return n=o>.008856?o:(n-16/116)/7.787,e=s>.008856?s:(e-16/116)/7.787,i=a>.008856?a:(i-16/116)/7.787,[e*=95.047,n*=100,i*=108.883]},le.lab.lch=function(t){var e,n=t[0],i=t[1],r=t[2];return(e=360*Math.atan2(r,i)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(i*i+r*r),e]},le.lch.lab=function(t){var e,n=t[0],i=t[1];return e=t[2]/360*2*Math.PI,[n,i*Math.cos(e),i*Math.sin(e)]},le.rgb.ansi16=function(t){var e=t[0],n=t[1],i=t[2],r=1 in arguments?arguments[1]:le.rgb.hsv(t)[2];if(0===(r=Math.round(r/50)))return 30;var o=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===r&&(o+=60),o},le.hsv.ansi16=function(t){return le.rgb.ansi16(le.hsv.rgb(t),t[2])},le.rgb.ansi256=function(t){var e=t[0],n=t[1],i=t[2];return e===n&&n===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)},le.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},le.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},le.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},le.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var i=parseInt(n,16);return[i>>16&255,i>>8&255,255&i]},le.rgb.hcg=function(t){var e,n=t[0]/255,i=t[1]/255,r=t[2]/255,o=Math.max(Math.max(n,i),r),s=Math.min(Math.min(n,i),r),a=o-s;return e=a<=0?0:o===n?(i-r)/a%6:o===i?2+(r-n)/a:4+(n-i)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?s/(1-a):0)]},le.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,i=1,r=0;return(i=n<.5?2*e*n:2*e*(1-n))<1&&(r=(n-.5*i)/(1-i)),[t[0],100*i,100*r]},le.hsv.hcg=function(t){var e=t[1]/100,n=t[2]/100,i=e*n,r=0;return i<1&&(r=(n-i)/(1-i)),[t[0],100*i,100*r]},le.hcg.rgb=function(t){var e=t[0]/360,n=t[1]/100,i=t[2]/100;if(0===n)return[255*i,255*i,255*i];var r,o=[0,0,0],s=e%1*6,a=s%1,l=1-a;switch(Math.floor(s)){case 0:o[0]=1,o[1]=a,o[2]=0;break;case 1:o[0]=l,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=a;break;case 3:o[0]=0,o[1]=l,o[2]=1;break;case 4:o[0]=a,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=l}return r=(1-n)*i,[255*(n*o[0]+r),255*(n*o[1]+r),255*(n*o[2]+r)]},le.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),i=0;return n>0&&(i=e/n),[t[0],100*i,100*n]},le.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,i=0;return n>0&&n<.5?i=e/(2*n):n>=.5&&n<1&&(i=e/(2*(1-n))),[t[0],100*i,100*n]},le.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},le.hwb.hcg=function(t){var e=t[1]/100,n=1-t[2]/100,i=n-e,r=0;return i<1&&(r=(n-i)/(1-i)),[t[0],100*i,100*r]},le.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},le.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},le.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},le.gray.hsl=le.gray.hsv=function(t){return[0,0,t[0]]},le.gray.hwb=function(t){return[0,100,t[0]]},le.gray.cmyk=function(t){return[0,0,0,t[0]]},le.gray.lab=function(t){return[t[0],0,0]},le.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},le.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var fe=re.exports;function pe(t){var e=function(){for(var t={},e=Object.keys(fe),n=e.length,i=0;i<n;i++)t[e[i]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var i=n.pop(),r=Object.keys(fe[i]),o=r.length,s=0;s<o;s++){var a=r[s],l=e[a];-1===l.distance&&(l.distance=e[i].distance+1,l.parent=i,n.unshift(a))}return e}function me(t,e){return function(n){return e(t(n))}}function ye(t,e){for(var n=[e[t].parent,t],i=fe[e[t].parent][t],r=e[t].parent;e[r].parent;)n.unshift(e[r].parent),i=me(fe[e[r].parent][r],i),r=e[r].parent;return i.conversion=n,i}var ge=re.exports,be=function(t){for(var e=pe(t),n={},i=Object.keys(e),r=i.length,o=0;o<r;o++){var s=i[o];null!==e[s].parent&&(n[s]=ye(s,e))}return n},ve={};Object.keys(ge).forEach((function(t){ve[t]={},Object.defineProperty(ve[t],"channels",{value:ge[t].channels}),Object.defineProperty(ve[t],"labels",{value:ge[t].labels});var e=be(t);Object.keys(e).forEach((function(n){var i=e[n];ve[t][n]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"==typeof n)for(var i=n.length,r=0;r<i;r++)n[r]=Math.round(n[r]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}(i),ve[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(i)}))}));var we=ve,xe=Wt.exports,ke=we,Me=[].slice,je=["keyword","gray","hex"],Ae={};Object.keys(ke).forEach((function(t){Ae[Me.call(ke[t].labels).sort().join("")]=t}));var Fe={};function Te(t,e){if(!(this instanceof Te))return new Te(t,e);if(e&&e in je&&(e=null),e&&!(e in ke))throw new Error("Unknown model: "+e);var n,i;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof Te)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var r=xe.get(t);if(null===r)throw new Error("Unable to parse color from string: "+t);this.model=r.model,i=ke[this.model].channels,this.color=r.value.slice(0,i),this.valpha="number"==typeof r.value[i]?r.value[i]:1}else if(t.length){this.model=e||"rgb",i=ke[this.model].channels;var o=Me.call(t,0,i);this.color=Pe(o,i),this.valpha="number"==typeof t[i]?t[i]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var s=Object.keys(t);"alpha"in t&&(s.splice(s.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=s.sort().join("");if(!(a in Ae))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=Ae[a];var l=ke[this.model].labels,u=[];for(n=0;n<l.length;n++)u.push(t[l[n]]);this.color=Pe(u)}if(Fe[this.model])for(i=ke[this.model].channels,n=0;n<i;n++){var c=Fe[this.model][n];c&&(this.color[n]=c(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function ze(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(Fe[t]||(Fe[t]=[]))[e]=n})),t=t[0],function(i){var r;return arguments.length?(n&&(i=n(i)),(r=this[t]()).color[e]=i,r):(r=this[t]().color[e],n&&(r=n(r)),r)}}function Se(t){return function(e){return Math.max(0,Math.min(t,e))}}function _e(t){return Array.isArray(t)?t:[t]}function Pe(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}Te.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in xe.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return xe.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return xe.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=ke[this.model].channels,n=ke[this.model].labels,i=0;i<e;i++)t[n[i]]=this.color[i];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new Te(this.color.map(function(t){return function(e){return function(t,e){return Number(t.toFixed(e))}(e,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new Te(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:ze("rgb",0,Se(255)),green:ze("rgb",1,Se(255)),blue:ze("rgb",2,Se(255)),hue:ze(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:ze("hsl",1,Se(100)),lightness:ze("hsl",2,Se(100)),saturationv:ze("hsv",1,Se(100)),value:ze("hsv",2,Se(100)),chroma:ze("hcg",1,Se(100)),gray:ze("hcg",2,Se(100)),white:ze("hwb",1,Se(100)),wblack:ze("hwb",2,Se(100)),cyan:ze("cmyk",0,Se(100)),magenta:ze("cmyk",1,Se(100)),yellow:ze("cmyk",2,Se(100)),black:ze("cmyk",3,Se(100)),x:ze("xyz",0,Se(100)),y:ze("xyz",1,Se(100)),z:ze("xyz",2,Se(100)),l:ze("lab",0,Se(100)),a:ze("lab",1),b:ze("lab",2),keyword:function(t){return arguments.length?new Te(t):ke[this.model].keyword(this.color)},hex:function(t){return arguments.length?new Te(t):xe.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var i=t[n]/255;e[n]=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return Te.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n=(n+t)%360)<0?360+n:n,e.color[0]=n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error(\'Argument to "mix" was not a Color instance, but rather an instance of \'+typeof t);var n=t.rgb(),i=this.rgb(),r=void 0===e?.5:e,o=2*r-1,s=n.alpha()-i.alpha(),a=((o*s==-1?o:(o+s)/(1+o*s))+1)/2,l=1-a;return Te.rgb(a*n.red()+l*i.red(),a*n.green()+l*i.green(),a*n.blue()+l*i.blue(),n.alpha()*r+i.alpha()*(1-r))}},Object.keys(ke).forEach((function(t){if(-1===je.indexOf(t)){var e=ke[t].channels;Te.prototype[t]=function(){if(this.model===t)return new Te(this);if(arguments.length)return new Te(arguments,t);var n="number"==typeof arguments[e]?e:this.valpha;return new Te(_e(ke[this.model][t].raw(this.color)).concat(n),t)},Te[t]=function(n){return"number"==typeof n&&(n=Pe(Me.call(arguments),e)),new Te(n,t)}}}));var Ie=Te;\n/*!\n        Feature Filter by\n\n        (c) mapbox 2016 and maptalks 2018\n        www.mapbox.com | www.maptalks.org\n        License: MIT, header required.\n    */const Oe=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function qe(t){if(!t)return"true";const e=t[0];if(t.length<=1)return"any"===e?"false":"true";return`(${"=="===e?Re(t[1],t[2],"===",!1):"!="===e?Re(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?Re(t[1],t[2],e,!0):"any"===e?Ee(t.slice(1),"||"):"all"===e?Ee(t.slice(1),"&&"):"none"===e?$e(Ee(t.slice(1),"||")):"in"===e?Le(t[1],t.slice(2)):"!in"===e?$e(Le(t[1],t.slice(2))):"has"===e?De(t[1]):"!has"===e?$e(De(t[1])):"contains"===e?function(t,e,n){const i=Ce(t);return void 0!==n?`(${i} + \'\').indexOf("${e}") === ${n}`:`(${i} + \'\').indexOf("${e}") >= 0`}(t[1],t[2],t[3]):"true"})`}function Ce(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function Re(t,e,n,i){if("object"==typeof(r=t)&&r&&t.op)return function(t,e,n,i){const r=t.property,o=t.op;let s=Ce(r);return"length"!==o?(console.error(`not support ${o} op`),"false"):(s=`((${s}+=\'\').length)`,Ne(s,r,e,n,i))}(t,e,n,i);var r;return Ne(Ce(t),t,e,n,i)}function Ne(t,e,n,i,r){const o="$type"===e?Oe.indexOf(n):JSON.stringify(n);return(r?`typeof ${t}=== typeof ${o}&&`:"")+t+i+o}function Ee(t,e){return t.map(qe).join(e)}function Le(t,e){"$type"===t&&(e=e.map(t=>Oe.indexOf(t)));const n=JSON.stringify(e.sort(Ue)),i=Ce(t);return e.length<=200?`${n}.indexOf(${i}) !== -1`:`function(v, a, i, j) {\\n        while (i <= j) { var m = (i + j) >> 1;\\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\\n        }\\n    return false; }(${i}, ${n},0,${e.length-1})`}function De(t){return"$id"===t?\'"id" in f\':JSON.stringify(t)+" in p"}function $e(t){return`!(${t})`}function Ue(t,e){return t<e?-1:t>e?1:0}var We={exports:{}};We.exports=function(){function t(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function e(t,e){return t<e?-1:t>e?1:0}return function(n,i,r,o,s){!function e(n,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=i-r+1,u=Math.log(a),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(a-c)/a)*(l-a/2<0?-1:1),d=Math.max(r,Math.floor(i-l*c/a+h)),f=Math.min(o,Math.floor(i+(a-l)*c/a+h));e(n,i,d,f,s)}var p=n[i],m=r,y=o;for(t(n,r,i),s(n[o],p)>0&&t(n,r,o);m<y;){for(t(n,m,y),m++,y--;s(n[m],p)<0;)m++;for(;s(n[y],p)>0;)y--}0===s(n[r],p)?t(n,r,y):(y++,t(n,y,o)),y<=i&&(r=y+1),i<=y&&(o=y-1)}}(n,i,r||0,o||n.length-1,s||e)}}();var Je=We.exports,He={exports:{}};function Ge(t,e){if(!(this instanceof Ge))return new Ge(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||Ve,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this.O(n)}function Ve(t,e){return t<e?-1:t>e?1:0}He.exports=Ge,He.exports.default=Ge,Ge.prototype={push:function(t){this.data.push(t),this.length++,this.q(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this.O(0)),this.data.pop(),t}},peek:function(){return this.data[0]},q:function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var r=t-1>>1,o=e[r];if(n(i,o)>=0)break;e[t]=o,t=r}e[t]=i},O:function(t){for(var e=this.data,n=this.compare,i=this.length>>1,r=e[t];t<i;){var o=1+(t<<1),s=o+1,a=e[o];if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,r)>=0)break;e[t]=a,t=o}e[t]=r}};var Be=He.exports;class Ze{constructor(t,e){this.position=t,this.index=e,this.faces=[],this.neighbors=[]}addUniqueNeighbor(t){-1===this.neighbors.indexOf(t)&&this.neighbors.push(t)}}class Ye{constructor(t,e,n,i){this.a=i.a,this.b=i.b,this.c=i.c,this.v1=t,this.v2=e,this.v3=n,this.normal=[],this.computeNormal(),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(n),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(n),n.faces.push(this),n.addUniqueNeighbor(t),n.addUniqueNeighbor(e)}computeNormal(){const t=this.v1.position,e=this.v2.position,n=this.v3.position,i=kt([],Mt([],n,e),Mt([],t,e));wt(this.normal,i)}hasVertex(t){return t===this.v1||t===this.v2||t===this.v3}}\n/*!\n     * Contains code from google filament\n     * https://github.com/google/filament/\n     * License Apache-2.0\n     */const Xe=[],Ke=[],Qe=[],tn=[];function en(t,e,n){const i=kt(Ke,e,n);t=zt(t,function(t,e,n,i,r,o,s,a,l,u){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=u,t}(Xe,n[0],n[1],n[2],...i,...e));if((t=function(t){return t[3]<0?_t(t,t,-1):t}(t=Pt(t,t)))[3]<1/32767){t[3]=1/32767;const e=Math.sqrt(.9999999990686206);t[0]*=e,t[1]*=e,t[2]*=e}const r=n[3]>0?kt(Qe,n,e):kt(Qe,e,n);return xt(kt(tn,n,e),r)<0&&_t(t,t,-1),t}function nn(t,e){const n=[],i=[];let r=0;for(r=0;r<t.length;r+=3){const e=new Ze([t[r],t[r+1],t[r+2]],r/3);n.push(e)}if(!e.length){const t=e;e=[];for(let n=0;n<t;n++)e.push(n)}for(r=0;r<e.length/3;r++){const t={a:e[3*r],b:e[3*r+1],c:e[3*r+2]};new Ye(n[t.a],n[t.b],n[t.c],t)}const o=[],s=[0,0,0];for(r=0;r<n.length;r++){const t=n[r],e=t.index;gt(s,0,0,0);let a=t.faces.length;for(let e=0;e<a;e++)bt(s,s,t.faces[e].normal);a=a||1,gt(o,a,a,a),vt(s,s,o),i[3*e]=s[0],i[3*e+1]=s[1],i[3*e+2]=s[2]}return i}\n/*!\n     * Contains code from THREE.JS\n     * https://github.com/mrdoob/three.js/\n     * License MIT\n     * \n     * Generate tangents per vertex.\n     */function rn(t,e,n){return t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t}function on(t,e,n){return t[0]=e[n],t[1]=e[n+1],t}var sn={exports:{}};function an(t,e,n){n=n||2;var i,r,o,s,a,l,u,c=e&&e.length,h=c?e[0]*n:t.length,d=ln(t,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(t,e,n,i){var r,o,s,a,l,u=[];for(r=0,o=e.length;r<o;r++)s=e[r]*i,a=r<o-1?e[r+1]*i:t.length,(l=ln(t,s,a,i,!1))===l.next&&(l.steiner=!0),u.push(vn(l));for(u.sort(mn),r=0;r<u.length;r++)n=yn(u[r],n);return n}(t,e,d,n)),t.length>80*n){i=o=t[0],r=s=t[1];for(var p=n;p<h;p+=n)(a=t[p])<i&&(i=a),(l=t[p+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);u=0!==(u=Math.max(o-i,s-r))?32767/u:0}return cn(d,f,n,i,r,u,0),f}function ln(t,e,n,i,r){var o,s;if(r===In(t,e,n,i)>0)for(o=e;o<n;o+=i)s=Sn(o,t[o],t[o+1],s);else for(o=n-i;o>=e;o-=i)s=Sn(o,t[o],t[o+1],s);return s&&Mn(s,s.next)&&(_n(s),s=s.next),s}function un(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!Mn(i,i.next)&&0!==kn(i.prev,i,i.next))i=i.next;else{if(_n(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function cn(t,e,n,i,r,o,s){if(t){!s&&o&&function(t,e,n,i){var r=t;do{0===r.z&&(r.z=bn(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,s,a,l,u=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,i=n,a=0,e=0;e<u&&(a++,i=i.nextZ);e++);for(l=u;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,u*=2}while(s>1)}(r)}(t,i,r,o);for(var a,l,u=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?dn(t,i,r,o):hn(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),_n(t),t=l.next,u=l.next;else if((t=l)===u){s?1===s?cn(t=fn(un(t),e,n),e,n,i,r,o,2):2===s&&pn(t,e,n,i,r,o):cn(un(t),e,n,i,r,o,1);break}}}function hn(t){var e=t.prev,n=t,i=t.next;if(kn(e,n,i)>=0)return!1;for(var r=e.x,o=n.x,s=i.x,a=e.y,l=n.y,u=i.y,c=r<o?r<s?r:s:o<s?o:s,h=a<l?a<u?a:u:l<u?l:u,d=r>o?r>s?r:s:o>s?o:s,f=a>l?a>u?a:u:l>u?l:u,p=i.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=h&&p.y<=f&&wn(r,a,o,l,s,u,p.x,p.y)&&kn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function dn(t,e,n,i){var r=t.prev,o=t,s=t.next;if(kn(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,u=s.x,c=r.y,h=o.y,d=s.y,f=a<l?a<u?a:u:l<u?l:u,p=c<h?c<d?c:d:h<d?h:d,m=a>l?a>u?a:u:l>u?l:u,y=c>h?c>d?c:d:h>d?h:d,g=bn(f,p,e,n,i),b=bn(m,y,e,n,i),v=t.prevZ,w=t.nextZ;v&&v.z>=g&&w&&w.z<=b;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=y&&v!==r&&v!==s&&wn(a,c,l,h,u,d,v.x,v.y)&&kn(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,w.x>=f&&w.x<=m&&w.y>=p&&w.y<=y&&w!==r&&w!==s&&wn(a,c,l,h,u,d,w.x,w.y)&&kn(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;v&&v.z>=g;){if(v.x>=f&&v.x<=m&&v.y>=p&&v.y<=y&&v!==r&&v!==s&&wn(a,c,l,h,u,d,v.x,v.y)&&kn(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=b;){if(w.x>=f&&w.x<=m&&w.y>=p&&w.y<=y&&w!==r&&w!==s&&wn(a,c,l,h,u,d,w.x,w.y)&&kn(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function fn(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!Mn(r,o)&&jn(r,i,i.next,o)&&Tn(r,o)&&Tn(o,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(o.i/n|0),_n(i),_n(i.next),i=t=o),i=i.next}while(i!==t);return un(i)}function pn(t,e,n,i,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&xn(s,a)){var l=zn(s,a);return s=un(s,s.next),l=un(l,l.next),cn(s,e,n,i,r,o,0),void cn(l,e,n,i,r,o,0)}a=a.next}s=s.next}while(s!==t)}function mn(t,e){return t.x-e.x}function yn(t,e){var n=function(t,e){var n,i=e,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==e);if(!n)return null;var l,u=n,c=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&wn(o<h?r:s,o,c,h,o<h?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),Tn(i,t)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&gn(n,i)))&&(n=i,d=l)),i=i.next}while(i!==u);return n}(t,e);if(!n)return e;var i=zn(n,t);return un(i,i.next),un(n,n.next)}function gn(t,e){return kn(t.prev,t,e.prev)<0&&kn(e.next,t,t.next)<0}function bn(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vn(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function wn(t,e,n,i,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(i-a)>=(n-s)*(e-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function xn(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&jn(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Tn(t,e)&&Tn(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(kn(t.prev,t,e.prev)||kn(t,e.prev,e))||Mn(t,e)&&kn(t.prev,t,t.next)>0&&kn(e.prev,e,e.next)>0)}function kn(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Mn(t,e){return t.x===e.x&&t.y===e.y}function jn(t,e,n,i){var r=Fn(kn(t,e,n)),o=Fn(kn(t,e,i)),s=Fn(kn(n,i,t)),a=Fn(kn(n,i,e));return r!==o&&s!==a||(!(0!==r||!An(t,n,e))||(!(0!==o||!An(t,i,e))||(!(0!==s||!An(n,t,i))||!(0!==a||!An(n,e,i)))))}function An(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Fn(t){return t>0?1:t<0?-1:0}function Tn(t,e){return kn(t.prev,t,t.next)<0?kn(t,e,t.next)>=0&&kn(t,t.prev,e)>=0:kn(t,e,t.prev)<0||kn(t,t.next,e)<0}function zn(t,e){var n=new Pn(t.i,t.x,t.y),i=new Pn(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Sn(t,e,n,i){var r=new Pn(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function _n(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Pn(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function In(t,e,n,i){for(var r=0,o=e,s=n-i;o<n;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}sn.exports=an,sn.exports.default=an,an.deviation=function(t,e,n,i){var r=e&&e.length,o=r?e[0]*n:t.length,s=Math.abs(In(t,0,o,n));if(r)for(var a=0,l=e.length;a<l;a++){var u=e[a]*n,c=a<l-1?e[a+1]*n:t.length;s-=Math.abs(In(t,u,c,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,f=i[a+1]*n,p=i[a+2]*n;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},an.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[r][o][s]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};var On=sn.exports;\n/*!\n     * @maptalks/vector-packer v0.79.1\n     * LICENSE : UNLICENSED\n     * (c) 2016-2023 maptalks.com\n     */const qn={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function Cn(t,e={}){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)Rn(n,t.features[i],e,i);else Rn(n,"Feature"===t.type?t:{geometry:t},e);return n}function Rn(t,e,n,i){if(e.geometry&&e.geometry.geometry){var r=e.geometry.coordinates,o=e.geometry.type,s=[],a=e.id;if(n.promoteId?a=e.properties[n.promoteId]:n.generateId&&(a=i||0),"Point"===o)Nn(r,s);else if("MultiPoint"===o)for(var l=0;l<r.length;l++)Nn(r[l],s);else if("LineString"===o)Ln([r],s);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<r.length;l++)En(r[l],s=[]),t.push(Dn(a,"LineString",s,e.properties));return}Ln(r,s)}else if("Polygon"===o)Ln(r,s);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)Rn(t,{id:a,geometry:e.geometry.geometries[l],properties:e.properties},n,i);return}return void console.warn(`Input data type(${o}) is not a valid GeoJSON geometry type.`)}for(l=0;l<r.length;l++){var u=[];Ln(r[l],u),s.push(u)}}t.push(Dn(a,o,s,e.properties))}}function Nn(t,e){const n=new Et(t[0],t[1]);n.z=100*(t[2]||0),e.push([n])}function En(t,e){for(let n=0;n<t.length;n++){const i=new Et(t[n][0],t[n][1]);i.z=100*(t[n][2]||0),e.push(i)}}function Ln(t,e,n,i){for(var r=0;r<t.length;r++){var o=[];En(t[r],o),e.push(o)}}function Dn(t,e,n,i){return{id:void 0===t?null:t,type:qn[e],geometry:n,properties:i}}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */function $n(t,{width:e,height:n},i,r){if(r){if(r.length!==e*n*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=r,t}function Un(t,{width:e,height:n},i){if(e===t.width&&n===t.height)return;const r=$n({},{width:e,height:n},i);Wn(t,r,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,n)},i),t.width=e,t.height=n,t.data=r.data}function Wn(t,e,n,i,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;if(s===a)return e;for(let l=0;l<r.height;l++){const u=((n.y+l)*t.width+n.x)*o,c=((i.y+l)*e.width+i.x)*o;for(let t=0;t<r.width*o;t++)a[c+t]=s[u+t]}return e}class Jn{constructor(t,e){$n(this,t,1,e)}resize(t){Un(this,t,1)}clone(){return new Jn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){Wn(t,e,n,i,r,1)}}class Hn{constructor(t,e){$n(this,t,4,e)}resize(t){Un(this,t,4)}clone(){return new Hn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){Wn(t,e,n,i,r,4)}}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */class Gn{constructor(t,{pixelRatio:e}){this.paddedRect=t,this.pixelRatio=e||1}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Vn{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,e={},n=new Dt(0,0,{autoResize:!0}),i=[];for(const n in t){const r=t[n],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};i.push(o),e[n]=new Gn(o,r)}if(n.pack(i,{inPlace:!0}),!Bn(n.w)||!Bn(n.h)){const t=Zn(n.w),e=Zn(n.h);n.resize(t,e)}const r=new Hn({width:n.w,height:n.h});for(const n in t){const i=t[n],o=e[n].paddedRect;Hn.copy(i.data,r,{x:0,y:0},{x:o.x+1,y:o.y+1},i.data)}this.image=r,this.positions=e}}function Bn(t){return 0==(t&t-1)&&0!==t}function Zn(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     * TODO 升级为potpack\n     */class Yn{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,e={},n=new Dt(0,0,{autoResize:!0}),i=[];for(const n in t){const r=t[n],o=e[n]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const n={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};i.push(n),o[t]={rect:n,metrics:e.metrics}}}n.pack(i,{inPlace:!0});const r=new Jn({width:n.w,height:n.h});for(const n in t){const i=t[n];for(const t in i){const o=i[+t];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const s=e[n][t].rect;Jn.copy(o.bitmap,r,{x:0,y:0},{x:s.x+1,y:s.y+1},o.bitmap)}}this.image=r,this.positions=e}}function Xn(t){return t<65536?Uint16Array:Uint32Array}function Kn(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:Float32Array}function Qn(t){return t<256?Uint8Array:t<65536?Uint16Array:t<Math.pow(2,32)?Uint32Array:Float64Array}function ti(t){const e=t.type,n=[];if(1===e||4===e)for(let e=0;e<t.geometry.length;e++)Nn(t.geometry[e],n);else if(2===e)Ln(t.geometry,n);else if(3===e)Ln(t.geometry,n);else if(5===e)Ln(t.geometry,n);else if(6===e)for(let e=0;e<t.geometry.length;e++){const i=[];Ln(t.geometry[e],i),n.push(i)}return t.geometry=n,t}function ei(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function ni(t){return null==t}function ii(t){return"number"==typeof t&&!isNaN(t)}function ri(t){return"object"==typeof t&&!!t}function oi(t){return!ni(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function si(t){return!ni(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}const ai=Object.prototype.hasOwnProperty;function li(t,e){return ai.call(t,e)}const ui=Math.PI/180;function ci(t){return t&&f(t)&&t.property}function hi(t){const{pointAtTileRes:e,tileRatio:n}=t;return e*n}function di(t){return"centimeter"===t||"cm"===t?1:"millimeter"===t||"mm"===t?.1:100}const fi={};function pi(t,e){if(!Array.isArray(e)){if(e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b)return t[0]=255*e.r,t[1]=255*e.g,t[2]=255*e.b,t[3]=void 0!==e.a?255*e.a:255,t;e=fi[e]=fi[e]||Ie(e).unitArray()}for(let n=0;n<e.length;n++)t[n]=255*e[n];return 3===t.length&&t.push(255),t}const mi={textFill:1,textSize:1,textOpacity:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1},yi={textName:1,markerTextFitPadding:1,markerTextFit:1,lineGradientProperty:1};var gi=Object.freeze({__proto__:null,now:function(){return Date.now()},extend:ei,isNil:ni,isNumber:ii,isInteger:function(t){return(0|t)===t},isObject:ri,isString:oi,isFunction:si,hasOwn:li,join:function(t,e){return t.join?t.join(e||","):Array.prototype.join.call(t,e||",")},toRadian:function(t){return t*ui},toDegree:function(t){return t/ui},evaluate:function(t,e,n){return si(t)?t(void 0!==n?n:null,e):t},isFnTypeSymbol:ci,getAltitudeToLocal:hi,getTubeSizeScale:di,normalizeColor:pi,checkIfIdentityZoomDependent:function(t,e,n){if(Array.isArray(n)||(n=Object.values(n)),!n||!n.length)return!1;if(!mi[t])return!1;for(let t=0;t<n.length;t++){const i=n[t]&&(n[t].feature||n[t]);if(!i)continue;const r=i.properties&&i.properties[e];if(r&&f(r)&&!p(r).isZoomConstant)return!0}return!1},checkIfZoomFnTypeSymbol:function(t){return!!mi[t]||!!yi[t]}});function bi(t){let e=0;for(let n,i,r=0,o=t.length,s=o-1;r<o;s=r++)n=t[r],i=t[s],e+=void 0!==n.x?(i.x-n.x)*(n.y+i.y):(i[0]-n[0])*(n[1]+i[1]);return e}function vi(t,e,n,i,r){const o=t[e*i],s=t[e*i+1],a=t[n*i],l=t[n*i+1];return o===a&&(o<0||o>r)&&s!==l||s===l&&(s<0||s>r)&&o!==a}function wi(t,e,n){let i=n;return e&&t&&(i=+t[e]),isNaN(i)&&(i=n||0),100*i}function xi(t,e,n,i,r,o,s){e||0===e||(e=1);const a=wi(t.properties,n,i),l=a*e;let u=(o?100*o:0)||a;return r?u=wi(t.properties,r,o):s&&(u=a-wi(t.properties,s,o)),u*=e,{altitude:l,height:u}}function ki(t,e){return e<1/0&&(t.x<0||t.x>e||t.y<0||t.y>e)}function Mi(t){return null==t}function ji(t,e,n){if(t===n||t===e)return t;const i=n-e;return((t-e)%i+i)%i+e}function Ai(t,e){if(!e)return null;const n=new Map;for(let i=0;i<e.length;i++){const r=e[i],o=t[r];let s=n.get(o);s||(s=[],n.set(o,s)),s.push(r)}return n}class Fi{constructor(t,e,n,i){this.feature=t,this.symbol=e,this.fnTypes=n,this.options=i}getPolygonResource(){let t=this.symbol.polygonPatternFile;const{polygonPatternFileFn:e}=this.fnTypes;return this.C(t,e)}getLineResource(){let t=this.symbol.linePatternFile;const{linePatternFileFn:e}=this.fnTypes;return this.C(t,e)}C(t,e){return e&&(t=e(this.options.zoom,this.feature.properties)),t}}function Ti(t,e,n,i){const r=Math.abs(i)>>15,o=r>>1,s=r%2;let a=i%Math.pow(2,15);const l=e+(o<<14)*Math.sign(e),u=n+(s<<14)*Math.sign(n);return t[0]=l,t[1]=u,a=Math.round(a),t[2]=0===a?i<0?-1:0:a,t}const zi=Math.pow(2,14),Si=Math.pow(2,15);var _i={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like \'mapbox:\'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:\'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).\',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style\'s `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Mercator, Natural Earth, Globe, and Winkel Tripel. Terrain, fog, sky and CustomLayerInterface are not supported for projections other than mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source\'s bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source\'s tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source\'s bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source\'s tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source\'s bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source\'s tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\\n * `cluster` Is `true` if the point is a cluster \\n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\\n * `point_count` Number of original points grouped into this cluster\\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:\'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) — it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\\n\\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\\n\\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`\'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like \'mapbox:\'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:\'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.\'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line\'s width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line\'s width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line\'s width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line\'s width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don\'t have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol\'s anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text\'s language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text\'s language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol\'s orientation. Note that the property values act as a hint, so that a symbol whose language doesn’t support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single \'vertical\' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either [\'horizontal\', \'vertical\'] or [\'vertical\', \'horizontal\'], the order doesn\'t affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:\'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:\'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:\'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:\'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:\'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:\'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.\',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:\'`["==", key, value]` equality: `feature[key] = value`\'},"!=":{doc:\'`["!=", key, value]` inequality: `feature[key] ≠ value`\'},">":{doc:\'`[">", key, value]` greater than: `feature[key] > value`\'},">=":{doc:\'`[">=", key, value]` greater than or equal: `feature[key] ≥ value`\'},"<":{doc:\'`["<", key, value]` less than: `feature[key] < value`\'},"<=":{doc:\'`["<=", key, value]` less than or equal: `feature[key] ≤ value`\'},in:{doc:\'`["in", key, v0, ..., vn]` set inclusion: `feature[key] ∈ {v0, ..., vn}`\'},"!in":{doc:\'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] ∉ {v0, ..., vn}`\'},all:{doc:\'`["all", f0, ..., fn]` logical `AND`: `f0 ∧ ... ∧ fn`\'},any:{doc:\'`["any", f0, ..., fn]` logical `OR`: `f0 ∨ ... ∨ fn`\'},none:{doc:\'`["none", f0, ..., fn]` logical `NOR`: `¬f0 ∧ ... ∧ ¬fn`\'},has:{doc:\'`["has", key]` `feature[key]` exists\'},"!has":{doc:\'`["!has", key]` `feature[key]` does not exist\'},within:{doc:\'`["within", object]` feature geometry is within object geometry\'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn\'t otherwise available. It is used in the following circumstances:\\n* In categorical functions, when the feature value does not match any of the stop domain values.\\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\\nIf no default is provided, the style property\'s default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:\'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].\',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:\'References variable bound using "let".\',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:\'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\\n - a single literal value; or\\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\\n\\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\\nIf the input type does not match the type of the labels, the result will be the fallback value.\',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`\'image\'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:\'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.\',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:\'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\\n\\nInterpolation types:\\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.\',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:\'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.\',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:\'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.\',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:\'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\\\'image\\\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\\n- `"text-font"`: Overrides the font stack specified by the root layout property.\\n- `"text-color"`: Overrides the color specified by the root paint property.\\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.\',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`\'format\'`](#types-format) expression. A [`\'coalesce\'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `\'image\'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:\'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\\\'image\\\'`](#types-image) expression, `\\\'to-string\\\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.\',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:\'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.\',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color\'s red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature\'s properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature\'s properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:\'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.\',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature\'s state. Returns `null` if the requested property is not present on the feature\'s state. A feature\'s state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\\"feature-state\\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature\'s geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature\'s id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:\'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.\',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:\'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.\',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:\'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.\',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:\'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.\',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line\'s endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the fog. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the fog to the color of the sky. A value of zero leaves a sharp transition from fog to sky. Increasing the value blends the color of fog into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0° (0° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0°, directly above, to 180°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carrée projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."},globe:{doc:"A globe projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color\'s opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry\'s offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion\'s surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry\'s offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry\'s offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line\'s actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line\'s offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won\'t render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:\'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.\',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry\'s offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle\'s stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle\'s stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:\'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.\',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon\'s halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon\'s anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text\'s halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo\'s fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text\'s anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0° is directly above, at zenith, and 90° at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0° is directly above, at zenith, and 90° at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},Pi="undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self?self:{};function Ii(t){var e={exports:{}};return t(e,e.exports),e.exports}function Oi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}\n/*! https://mths.be/punycode v1.3.2 by @mathias */Ii((function(t,e){!function(n){var i=e&&!e.nodeType&&e,r=t&&!t.nodeType&&t,o="object"==typeof Pi&&Pi;o.global!==o&&o.window!==o&&o.self!==o||(n=o);var s,a,l=2147483647,u=/^xn--/,c=/[^\\x20-\\x7E]/,h=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,p=String.fromCharCode;function m(t){throw RangeError(d[t])}function y(t,e){for(var n=t.length,i=[];n--;)i[n]=e(t[n]);return i}function g(t,e){var n=t.split("@"),i="";return n.length>1&&(i=n[0]+"@",t=n[1]),i+y((t=t.replace(h,".")).split("."),e).join(".")}function b(t){for(var e,n,i=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(n=t.charCodeAt(r++)))?i.push(((1023&e)<<10)+(1023&n)+65536):(i.push(e),r--):i.push(e);return i}function v(t){return y(t,(function(t){var e="";return t>65535&&(e+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+p(t)})).join("")}function w(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function x(t,e,n){var i=0;for(t=n?f(t/700):t>>1,t+=f(t/e);t>455;i+=36)t=f(t/35);return f(i+36*t/(t+38))}function k(t){var e,n,i,r,o,s,a,u,c,h,d,p=[],y=t.length,g=0,b=128,w=72;for((n=t.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)t.charCodeAt(i)>=128&&m("not-basic"),p.push(t.charCodeAt(i));for(r=n>0?n+1:0;r<y;){for(o=g,s=1,a=36;r>=y&&m("invalid-input"),((u=(d=t.charCodeAt(r++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:36)>=36||u>f((l-g)/s))&&m("overflow"),g+=u*s,!(u<(c=a<=w?1:a>=w+26?26:a-w));a+=36)s>f(l/(h=36-c))&&m("overflow"),s*=h;w=x(g-o,e=p.length+1,0==o),f(g/e)>l-b&&m("overflow"),b+=f(g/e),g%=e,p.splice(g++,0,b)}return v(p)}function M(t){var e,n,i,r,o,s,a,u,c,h,d,y,g,v,k,M=[];for(y=(t=b(t)).length,e=128,n=0,o=72,s=0;s<y;++s)(d=t[s])<128&&M.push(p(d));for(i=r=M.length,r&&M.push("-");i<y;){for(a=l,s=0;s<y;++s)(d=t[s])>=e&&d<a&&(a=d);for(a-e>f((l-n)/(g=i+1))&&m("overflow"),n+=(a-e)*g,e=a,s=0;s<y;++s)if((d=t[s])<e&&++n>l&&m("overflow"),d==e){for(u=n,c=36;!(u<(h=c<=o?1:c>=o+26?26:c-o));c+=36)M.push(p(w(h+(k=u-h)%(v=36-h),0))),u=f(k/v);M.push(p(w(u,0))),o=x(n,g,i==r),n=0,++i}++n,++e}return M.join("")}if(s={version:"1.3.2",ucs2:{decode:b,encode:v},decode:k,encode:M,toASCII:function(t){return g(t,(function(t){return c.test(t)?"xn--"+M(t):t}))},toUnicode:function(t){return g(t,(function(t){return u.test(t)?k(t.slice(4).toLowerCase()):t}))}},i&&r)if(t.exports==i)r.exports=s;else for(a in s)s.hasOwnProperty(a)&&(i[a]=s[a]);else n.punycode=s}(Pi)}));var qi=function(t,e,n,i){n=n||"=";var r={};if("string"!=typeof t||0===t.length)return r;var o=/\\+/g;t=t.split(e=e||"&");var s=1e3;i&&"number"==typeof i.maxKeys&&(s=i.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var l=0;l<a;++l){var u,c,h,d,f=t[l].replace(o,"%20"),p=f.indexOf(n);p>=0?(u=f.substr(0,p),c=f.substr(p+1)):(u=f,c=""),h=decodeURIComponent(u),d=decodeURIComponent(c),Oi(r,h)?Array.isArray(r[h])?r[h].push(d):r[h]=[r[h],d]:r[h]=d}return r},Ci=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},Ri=function(t,e,n,i){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(i){var r=encodeURIComponent(Ci(i))+n;return Array.isArray(t[i])?t[i].map((function(t){return r+encodeURIComponent(Ci(t))})).join(e):r+encodeURIComponent(Ci(t[i]))})).join(e):i?encodeURIComponent(Ci(i))+n+encodeURIComponent(Ci(t)):""};function Ni(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}Ii((function(t,e){e.decode=e.parse=qi,e.encode=e.stringify=Ri}));class Ei extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Li{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,n]of e)this.bindings[t]=n}concat(t){return new Li(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Di={kind:"null"},$i={kind:"number"},Ui={kind:"string"},Wi={kind:"boolean"},Ji={kind:"color"},Hi={kind:"object"},Gi={kind:"value"},Vi={kind:"collator"},Bi={kind:"formatted"},Zi={kind:"resolvedImage"};function Yi(t,e){return{kind:"array",itemType:t,N:e}}function Xi(t){if("array"===t.kind){const e=Xi(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Ki=[Di,$i,Ui,Wi,Ji,Bi,Hi,Yi(Gi),Zi];function Qi(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Qi(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Ki)if(!Qi(t,e))return null}return`Expected ${Xi(t)} but found ${Xi(e)} instead.`}function tr(t,e){return e.some(e=>e.kind===t.kind)}function er(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}var nr=Ii((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return i("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return function(t){return t<0?0:t>1?1:t}("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function s(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,a=t.replace(/ /g,"").toLowerCase();if(a in n)return n[a].slice();if("#"===a[0])return 4===a.length?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===a.length&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=a.indexOf("("),u=a.indexOf(")");if(-1!==l&&u+1===a.length){var c=a.substr(0,l),h=a.substr(l+1,u-(l+1)).split(","),d=1;switch(c){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=o(h[1]),m=o(h[2]),y=m<=.5?m*(p+1):m+p-m*p,g=2*m-y;return[i(255*s(g,y,f+1/3)),i(255*s(g,y,f)),i(255*s(g,y,f-1/3)),d];default:return null}}return null}}catch(t){}}));class ir{constructor(t,e,n,i=1){this.r=t,this.g=e,this.b=n,this.a=i}static parse(t){if(!t)return;if(t instanceof ir)return t;if("string"!=typeof t)return;const e=nr.parseCSSColor(t);return e?new ir(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,n,i]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(n)},${i})`}toArray(){const{r:t,g:e,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*n/i,i]}}ir.black=new ir(0,0,0,1),ir.white=new ir(1,1,1,1),ir.transparent=new ir(0,0,0,0),ir.red=new ir(1,0,0,1),ir.blue=new ir(0,0,1,1);class rr{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class or{constructor(t,e,n,i,r){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r}}class sr{constructor(t){this.sections=t}static fromString(t){return new sr([new or(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof sr?t:sr.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const n={};e.fontStack&&(n["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(n["font-scale"]=e.scale),e.textColor&&(n["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(n)}return t}}class ar{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ar({name:t,available:!1}):null}serialize(){return["image",this.name]}}function lr(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: \'a\' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")}]: \'r\', \'g\', and \'b\' must be between 0 and 255.`}function ur(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ir)return!0;if(t instanceof rr)return!0;if(t instanceof sr)return!0;if(t instanceof ar)return!0;if(Array.isArray(t)){for(const e of t)if(!ur(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ur(t[e]))return!1;return!0}return!1}function cr(t){if(null===t)return Di;if("string"==typeof t)return Ui;if("boolean"==typeof t)return Wi;if("number"==typeof t)return $i;if(t instanceof ir)return Ji;if(t instanceof rr)return Vi;if(t instanceof sr)return Bi;if(t instanceof ar)return Zi;if(Array.isArray(t)){const e=t.length;let n;for(const e of t){const t=cr(e);if(n){if(n===t)continue;n=Gi;break}n=t}return Yi(n||Gi,e)}return Hi}function hr(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ir||t instanceof sr||t instanceof ar?t.toString():JSON.stringify(t)}class dr{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`\'literal\' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ur(t[1]))return e.error("invalid value");const n=t[1];let i=cr(n);const r=e.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new dr(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ir?["rgba"].concat(this.value.toArray()):this.value instanceof sr?this.value.serialize():this.value}}class fr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const pr={string:Ui,number:$i,boolean:Wi,object:Hi};class mr{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,i=1;const r=t[0];if("array"===r){let r,o;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in pr)||"object"===n)return e.error(\'The item type argument of "array" must be one of string, number, boolean\',1);r=pr[n],i++}else r=Gi;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error(\'The length argument to "array" must be a positive integer literal\',2);o=t[2],i++}n=Yi(r,o)}else n=pr[r];const o=[];for(;i<t.length;i++){const n=e.parse(t[i],i,Gi);if(!n)return null;o.push(n)}return new mr(n,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!Qi(this.type,cr(n)))return n;if(e===this.args.length-1)throw new fr(`Expected value to be of type ${Xi(this.type)}, but found ${Xi(cr(n))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);const i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map(t=>t.serialize()))}}class yr{constructor(t){this.type=Bi,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const i=[];let r=!1;for(let n=1;n<=t.length-1;++n){const o=t[n];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,$i),!t))return null;let n=null;if(o["text-font"]&&(n=e.parse(o["text-font"],1,Yi(Ui)),!n))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,Ji),!s))return null;const a=i[i.length-1];a.scale=t,a.font=n,a.textColor=s}else{const o=e.parse(t[n],1,Gi);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be \'string\', \'value\', \'image\' or \'null\'.");r=!0,i.push({content:o,scale:null,font:null,textColor:null})}}return new yr(i)}evaluate(t){return new sr(this.sections.map(e=>{const n=e.content.evaluate(t);return cr(n)===Zi?new or("",n,null,null,null):new or(hr(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const n={};e.scale&&(n["font-scale"]=e.scale.serialize()),e.font&&(n["text-font"]=e.font.serialize()),e.textColor&&(n["text-color"]=e.textColor.serialize()),t.push(n)}return t}}class gr{constructor(t){this.type=Zi,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Ui);return n?new gr(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=ar.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const br={"to-boolean":Wi,"to-color":Ji,"to-number":$i,"to-string":Ui};class vr{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const i=br[n],r=[];for(let n=1;n<t.length;n++){const i=e.parse(t[n],n,Gi);if(!i)return null;r.push(i)}return new vr(i,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof ir)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:lr(e[0],e[1],e[2],e[3]),!n))return new ir(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new fr(n||`Could not parse color from value \'${"string"==typeof e?e:String(JSON.stringify(e))}\'`)}if("number"===this.type.kind){let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new fr(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?sr.fromString(hr(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ar.fromString(hr(this.args[0].evaluate(t))):hr(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new yr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new gr(this.args[0]).serialize();const t=["to-"+this.type.kind];return this.eachChild(e=>{t.push(e.serialize())}),t}}const wr=["Unknown","Point","LineString","Polygon"];class xr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this.R={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?wr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this.R[t];return e||(e=this.R[t]=ir.parse(t)),e}}class kr{constructor(t,e,n,i){this.name=t,this.type=e,this.L=n,this.args=i}evaluate(t){return this.L(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,e){const n=t[0],i=kr.definitions[n];if(!i)return e.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter(([e])=>!Array.isArray(e)||e.length===t.length-1);let a=null;for(const[i,o]of s){a=new Jr(e.registry,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const n=t[e],r=Array.isArray(i)?i[e-1]:i.type,o=a.parse(n,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(i)&&i.length!==s.length)a.error(`Expected ${i.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(i)?i[t]:i.type,n=s[t];a.concat(t+1).checkSubtype(e,n.type)}if(0===a.errors.length)return new kr(n,r,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const n=(s.length?s:o).map(([t])=>{return e=t,Array.isArray(e)?`(${e.map(Xi).join(", ")})`:`(${Xi(e.type)}...)`;var e}).join(" | "),i=[];for(let n=1;n<t.length;n++){const r=e.parse(t[n],1+i.length);if(!r)return null;i.push(Xi(r.type))}e.error(`Expected arguments of type ${n}, but found (${i.join(", ")}) instead.`)}return null}static register(t,e){kr.definitions=e;for(const n in e)t[n]=kr}}class Mr{constructor(t,e,n){this.type=Vi,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const i=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Wi);if(!i)return null;const r=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Wi);if(!r)return null;let o=null;return n.locale&&(o=e.parse(n.locale,1,Ui),!o)?null:new Mr(i,r,o)}evaluate(t){return new rr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function jr(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ar(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Fr(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*8192),Math.round(i*r*8192)]}function Tr(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],o=t[0]-n[0],s=t[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function zr(t,e){let n=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(Tr(t,a[e],a[e+1]))return!1;(r=a[e])[1]>(i=t)[1]!=(o=a[e+1])[1]>i[1]&&i[0]<(o[0]-r[0])*(i[1]-r[1])/(o[1]-r[1])+r[0]&&(n=!n)}}var i,r,o;return n}function Sr(t,e){for(let n=0;n<e.length;n++)if(zr(t,e[n]))return!0;return!1}function _r(t,e,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(t[0]-n[0])*o-r*(t[1]-n[1]),a=(e[0]-n[0])*o-r*(e[1]-n[1]);return s>0&&a<0||s<0&&a>0}function Pr(t,e,n){for(const u of n)for(let n=0;n<u.length-1;++n)if(void 0,void 0,0!=(a=[(s=u[n+1])[0]-(o=u[n])[0],s[1]-o[1]])[0]*(l=[(r=e)[0]-(i=t)[0],r[1]-i[1]])[1]-a[1]*l[0]&&_r(i,r,o,s)&&_r(o,s,i,r))return!0;var i,r,o,s,a,l;return!1}function Ir(t,e){for(let n=0;n<t.length;++n)if(!zr(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Pr(t[n],t[n+1],e))return!1;return!0}function Or(t,e){for(let n=0;n<e.length;n++)if(Ir(t,e[n]))return!0;return!1}function qr(t,e,n){const i=[];for(let r=0;r<t.length;r++){const o=[];for(let i=0;i<t[r].length;i++){const s=Fr(t[r][i],n);jr(e,s),o.push(s)}i.push(o)}return i}function Cr(t,e,n){const i=[];for(let r=0;r<t.length;r++){const o=qr(t[r],e,n);i.push(o)}return i}function Rr(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}jr(e,t)}function Nr(t,e,n,i){const r=8192*Math.pow(2,i.z),o=[8192*i.x,8192*i.y],s=[];for(const i of t)for(const t of i){const i=[t.x+o[0],t.y+o[1]];Rr(i,e,n,r),s.push(i)}return s}function Er(t,e,n,i){const r=8192*Math.pow(2,i.z),o=[8192*i.x,8192*i.y],s=[];for(const n of t){const t=[];for(const i of n){const n=[i.x+o[0],i.y+o[1]];jr(e,n),t.push(n)}s.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const i of t)Rr(i,e,n,r)}var a;return s}class Lr{constructor(t,e){this.type=Wi,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`\'within\' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ur(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const n=e.features[t].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Lr(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Lr(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Lr(e,e)}return e.error("\'within\' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const o=qr(e.coordinates,i,r),s=Nr(t.geometry(),n,i,r);if(!Ar(n,i))return!1;for(const t of s)if(!zr(t,o))return!1}if("MultiPolygon"===e.type){const o=Cr(e.coordinates,i,r),s=Nr(t.geometry(),n,i,r);if(!Ar(n,i))return!1;for(const t of s)if(!Sr(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const o=qr(e.coordinates,i,r),s=Er(t.geometry(),n,i,r);if(!Ar(n,i))return!1;for(const t of s)if(!Ir(t,o))return!1}if("MultiPolygon"===e.type){const o=Cr(e.coordinates,i,r),s=Er(t.geometry(),n,i,r);if(!Ar(n,i))return!1;for(const t of s)if(!Or(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Dr(t){if(t instanceof kr){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Lr)return!1;let e=!0;return t.eachChild(t=>{e&&!Dr(t)&&(e=!1)}),e}function $r(t){if(t instanceof kr&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!$r(t)&&(e=!1)}),e}function Ur(t,e){if(t instanceof kr&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(t=>{n&&!Ur(t,e)&&(n=!1)}),n}class Wr{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("\'var\' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new Wr(n,e.scope.get(n)):e.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Jr{constructor(t,e=[],n,i=new Li,r=[]){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=i,this.errors=r,this.expectedType=n}parse(t,e,n,i,r={}){return e?this.concat(e,n,i).D(t,r):this.D(t,r)}D(t,e){function n(t,e,n){return"assert"===n?new mr(e,[t]):"coerce"===n?new vr(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error(\'Expected an array with at least one element. If you wanted a literal array, use ["literal", []].\');const i=t[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[i];if(r){let i=r.parse(t,this);if(!i)return null;if(this.expectedType){const t=this.expectedType,r=i.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else i=n(i,t,e.typeAnnotation||"coerce");else i=n(i,t,e.typeAnnotation||"assert")}if(!(i instanceof dr)&&"resolvedImage"!==i.type.kind&&function t(e){if(e instanceof Wr)return t(e.boundExpression);if(e instanceof kr&&"error"===e.name)return!1;if(e instanceof Mr)return!1;if(e instanceof Lr)return!1;const n=e instanceof vr||e instanceof mr;let i=!0;return e.eachChild(e=>{i=n?i&&t(e):i&&e instanceof dr}),!!i&&(Dr(e)&&Ur(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}(i)){const e=new xr;try{i=new dr(i.type,i.evaluate(e))}catch(t){return this.error(t.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"\'undefined\' value invalid. Use null instead.":"object"==typeof t?\'Bare objects invalid. Use ["literal", {...}] instead.\':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,n){const i="number"==typeof t?this.path.concat(t):this.path,r=n?this.scope.concat(n):this.scope;return new Jr(this.registry,i,e||null,r,this.errors)}error(t,...e){const n=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new Ei(n,t))}checkSubtype(t,e){const n=Qi(t,e);return n&&this.error(n),n}}function Hr(t,e){const n=t.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=t[a],r=t[a+1],i<=e){if(a===n||e<r)return a;o=a+1}else{if(!(i>e))throw new fr("Input is not a number.");s=a-1}return 0}class Gr{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,$i);if(!n)return null;const i=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let n=1;n<t.length;n+=2){const o=1===n?-1/0:t[n],s=t[n+1],a=n,l=n+1;if("number"!=typeof o)return e.error(\'Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.\',a);if(i.length&&i[i.length-1][0]>=o)return e.error(\'Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.\',a);const u=e.parse(s,l,r);if(!u)return null;r=r||u.type,i.push([o,u])}return new Gr(r,n,i)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[Hr(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var Vr=Br;function Br(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=n,this.p2y=i}function Zr(t,e,n){return t*(1-n)+e*n}Br.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Br.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Br.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Br.prototype.solveCurveX=function(t,e){var n,i,r,o,s;for(void 0===e&&(e=1e-6),r=t,s=0;s<8;s++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=o/a}if((r=t)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?n=r:i=r,r=.5*(i-n)+n}return r},Br.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var Yr=Object.freeze({__proto__:null,number:Zr,color:function(t,e,n){return new ir(Zr(t.r,e.r,n),Zr(t.g,e.g,n),Zr(t.b,e.b,n),Zr(t.a,e.a,n))},array:function(t,e,n){return t.map((t,i)=>Zr(t,e[i],n))}});const Xr=6/29*3*(6/29),Kr=Math.PI/180,Qr=180/Math.PI;function to(t){return t>.008856451679035631?Math.pow(t,1/3):t/Xr+4/29}function eo(t){return t>6/29?t*t*t:Xr*(t-4/29)}function no(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function io(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ro(t){const e=io(t.r),n=io(t.g),i=io(t.b),r=to((.4124564*e+.3575761*n+.1804375*i)/.95047),o=to((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-to((.0193339*e+.119192*n+.9503041*i)/1.08883)),alpha:t.a}}function oo(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*eo(e),n=.95047*eo(n),i=1.08883*eo(i),new ir(no(3.2404542*n-1.5371385*e-.4985314*i),no(-.969266*n+1.8760108*e+.041556*i),no(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function so(t,e,n){const i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const ao={forward:ro,reverse:oo,interpolate:function(t,e,n){return{l:Zr(t.l,e.l,n),a:Zr(t.a,e.a,n),b:Zr(t.b,e.b,n),alpha:Zr(t.alpha,e.alpha,n)}}},lo={forward:function(t){const{l:e,a:n,b:i}=ro(t),r=Math.atan2(i,n)*Qr;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Kr,n=t.c;return oo({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:so(t.h,e.h,n),c:Zr(t.c,e.c,n),l:Zr(t.l,e.l,n),alpha:Zr(t.alpha,e.alpha,n)}}};var uo=Object.freeze({__proto__:null,lab:ao,hcl:lo});class co{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,n,i){let r=0;if("exponential"===t.name)r=ho(e,t.base,n,i);else if("linear"===t.name)r=ho(e,1,n,i);else if("cubic-bezier"===t.name){const o=t.controlPoints;r=new Vr(o[0],o[1],o[2],o[3]).solve(ho(e,1,n,i))}return r}static parse(t,e){let[n,i,r,...o]=t;if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const t=i[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:t}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);{const t=i.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,$i),!r)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=Ji:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const n=o[t],i=o[t+1],r=t+3,l=t+4;if("number"!=typeof n)return e.error(\'Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.\',r);if(s.length&&s[s.length-1][0]>=n)return e.error(\'Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.\',r);const u=e.parse(i,l,a);if(!u)return null;a=a||u.type,s.push([n,u])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new co(a,n,i,r,s):e.error(`Type ${Xi(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;if(i>=e[r-1])return n[r-1].evaluate(t);const o=Hr(e,i),s=co.interpolationFactor(this.interpolation,i,e[o],e[o+1]),a=n[o].evaluate(t),l=n[o+1].evaluate(t);return"interpolate"===this.operator?Yr[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?lo.reverse(lo.interpolate(lo.forward(a),lo.forward(l),s)):ao.reverse(ao.interpolate(ao.forward(a),ao.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function ho(t,e,n,i){const r=i-n,o=t-n;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}class fo{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let n=null;const i=e.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const i of t.slice(1)){const t=e.parse(i,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,r.push(t)}const o=i&&r.some(t=>Qi(i,t.type));return new fo(o?Gi:n,r)}evaluate(t){let e,n=null,i=0;for(const r of this.args){if(i++,n=r.evaluate(t),n&&n instanceof ar&&!n.available&&(e||(e=n),n=null,i===this.args.length))return e;if(null!==n)break}return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class po{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let i=1;i<t.length-1;i+=2){const r=t[i];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,i);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or \'_\'.",i);const o=e.parse(t[i+1],i+1);if(!o)return null;n.push([r,o])}const i=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return i?new po(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,n]of this.bindings)t.push(e,n.serialize());return t.push(this.result.serialize()),t}}class mo{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,$i),i=e.parse(t[2],2,Yi(e.expectedType||Gi));return n&&i?new mo(i.type.itemType,n,i):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new fr(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new fr(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new fr(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class yo{constructor(t,e){this.type=Wi,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Gi),i=e.parse(t[2],2,Gi);return n&&i?tr(n.type,[Wi,Ui,$i,Di,Gi])?new yo(n,i):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(n.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(null==n)return!1;if(!er(e,["boolean","string","number","null"]))throw new fr(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(cr(e))} instead.`);if(!er(n,["string","array"]))throw new fr(`Expected second argument to be of type array or string, but found ${Xi(cr(n))} instead.`);return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class go{constructor(t,e,n){this.type=$i,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Gi),i=e.parse(t[2],2,Gi);if(!n||!i)return null;if(!tr(n.type,[Wi,Ui,$i,Di,Gi]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(n.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,$i);return r?new go(n,i,r):null}return new go(n,i)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!er(e,["boolean","string","number","null"]))throw new fr(`Expected first argument to be of type boolean, string, number or null, but found ${Xi(cr(e))} instead.`);if(!er(n,["string","array"]))throw new fr(`Expected second argument to be of type array or string, but found ${Xi(cr(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(t);return n.indexOf(e,i)}return n.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class bo{constructor(t,e,n,i,r,o){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const u=e.concat(s);if(0===a.length)return u.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return u.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return u.error("Numeric branch labels must be integer values.");if(n){if(u.checkSubtype(n,cr(t)))return null}else n=cr(t);if(void 0!==r[String(t)])return u.error("Branch labels must be unique.");r[String(t)]=o.length}const c=e.parse(l,s,i);if(!c)return null;i=i||c.type,o.push(c)}const s=e.parse(t[1],1,Gi);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,i);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(n,s.type)?null:new bo(n,i,s,r,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(cr(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),n=[],i={};for(const t of e){const e=i[this.cases[t]];void 0===e?(i[this.cases[t]]=n.length,n.push([this.cases[t],[t]])):n[e][1].push(t)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,i]of n)t.push(1===i.length?r(i[0]):i.map(r)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}class vo{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i=[];for(let r=1;r<t.length-1;r+=2){const o=e.parse(t[r],r,Wi);if(!o)return null;const s=e.parse(t[r+1],r+1,n);if(!s)return null;i.push([o,s]),n=n||s.type}const r=e.parse(t[t.length-1],t.length-1,n);return r?new vo(n,i,r):null}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class wo{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Gi),i=e.parse(t[2],2,$i);if(!n||!i)return null;if(!tr(n.type,[Yi(Gi),Ui,Gi]))return e.error(`Expected first argument to be of type array or string, but found ${Xi(n.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,$i);return r?new wo(n.type,n,i,r):null}return new wo(n.type,n,i)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!er(e,["string","array"]))throw new fr(`Expected first argument to be of type array or string, but found ${Xi(cr(e))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(t);return e.slice(n,i)}return e.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function xo(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ko(t,e,n,i){return 0===i.compare(e,n)}function Mo(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=Wi,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let o=e.parse(t[1],1,Gi);if(!o)return null;if(!xo(n,o.type))return e.concat(1).error(`"${n}" comparisons are not supported for type \'${Xi(o.type)}\'.`);let s=e.parse(t[2],2,Gi);if(!s)return null;if(!xo(n,s.type))return e.concat(2).error(`"${n}" comparisons are not supported for type \'${Xi(s.type)}\'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types \'${Xi(o.type)}\' and \'${Xi(s.type)}\'.`);i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new mr(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new mr(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Vi),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=cr(o),n=cr(s);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new fr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const t=cr(o),n=cr(s);if("string"!==t.kind||"string"!==n.kind)return e(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild(t=>{e.push(t.serialize())}),e}}}const jo=Mo("==",(function(t,e,n){return e===n}),ko),Ao=Mo("!=",(function(t,e,n){return e!==n}),(function(t,e,n,i){return!ko(0,e,n,i)})),Fo=Mo("<",(function(t,e,n){return e<n}),(function(t,e,n,i){return i.compare(e,n)<0})),To=Mo(">",(function(t,e,n){return e>n}),(function(t,e,n,i){return i.compare(e,n)>0})),zo=Mo("<=",(function(t,e,n){return e<=n}),(function(t,e,n,i){return i.compare(e,n)<=0})),So=Mo(">=",(function(t,e,n){return e>=n}),(function(t,e,n,i){return i.compare(e,n)>=0}));class _o{constructor(t,e,n,i,r){this.type=Ui,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,$i);if(!n)return null;const i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=e.parse(i.locale,1,Ui),!r))return null;let o=null;if(i.currency&&(o=e.parse(i.currency,1,Ui),!o))return null;let s=null;if(i["min-fraction-digits"]&&(s=e.parse(i["min-fraction-digits"],1,$i),!s))return null;let a=null;return i["max-fraction-digits"]&&(a=e.parse(i["max-fraction-digits"],1,$i),!a)?null:new _o(n,r,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Po{constructor(t){this.type=$i,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error(`Expected argument of type string or array, but found ${Xi(n.type)} instead.`):new Po(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new fr(`Expected value to be of type string or array, but found ${Xi(cr(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}}const Io={"==":jo,"!=":Ao,">":To,"<":Fo,">=":So,"<=":zo,array:mr,at:mo,boolean:mr,case:vo,coalesce:fo,collator:Mr,format:yr,image:gr,in:yo,"index-of":go,interpolate:co,"interpolate-hcl":co,"interpolate-lab":co,length:Po,let:po,literal:dr,match:bo,number:mr,"number-format":_o,object:mr,slice:wo,step:Gr,string:mr,"to-boolean":vr,"to-color":vr,"to-number":vr,"to-string":vr,var:Wr,within:Lr};function Oo(t,[e,n,i,r]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const o=r?r.evaluate(t):1,s=lr(e,n,i,o);if(s)throw new fr(s);return new ir(e/255*o,n/255*o,i/255*o,o)}function qo(t,e){return t in e}function Co(t,e){const n=e[t];return void 0===n?null:n}function Ro(t){return{type:t}}function No(t){return{result:"success",value:t}}function Eo(t){return{result:"error",value:t}}function Lo(t){return!!t.expression&&t.expression.interpolated}function Do(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function $o(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Uo(t){return t}function Wo(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Jo(t,e,n,i,r){return Wo(typeof n===r?i[n]:void 0,t.default,e.default)}function Ho(t,e,n){if("number"!==Do(n))return Wo(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const r=Hr(t.stops.map(t=>t[0]),n);return t.stops[r][1]}function Go(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==Do(n))return Wo(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const o=Hr(t.stops.map(t=>t[0]),n),s=function(t,e,n,i){const r=i-n,o=t-n;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let u=Yr[e.type]||Uo;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=uo[t.colorSpace];u=(t,n)=>e.reverse(e.interpolate(e.forward(t),e.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==n)return u(e,n,s)}}:u(a,l,s)}function Vo(t,e,n){return"color"===e.type?n=ir.parse(n):"formatted"===e.type?n=sr.fromString(n.toString()):"resolvedImage"===e.type?n=ar.fromString(n.toString()):Do(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),Wo(n,t.default,e.default)}kr.register(Io,{error:[{kind:"error"},[Ui],(t,[e])=>{throw new fr(e.evaluate(t))}],typeof:[Ui,[Gi],(t,[e])=>Xi(cr(e.evaluate(t)))],"to-rgba":[Yi($i,4),[Ji],(t,[e])=>e.evaluate(t).toArray()],rgb:[Ji,[$i,$i,$i],Oo],rgba:[Ji,[$i,$i,$i,$i],Oo],has:{type:Wi,overloads:[[[Ui],(t,[e])=>qo(e.evaluate(t),t.properties())],[[Ui,Hi],(t,[e,n])=>qo(e.evaluate(t),n.evaluate(t))]]},get:{type:Gi,overloads:[[[Ui],(t,[e])=>Co(e.evaluate(t),t.properties())],[[Ui,Hi],(t,[e,n])=>Co(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Gi,[Ui],(t,[e])=>Co(e.evaluate(t),t.featureState||{})],properties:[Hi,[],t=>t.properties()],"geometry-type":[Ui,[],t=>t.geometryType()],id:[Gi,[],t=>t.id()],zoom:[$i,[],t=>t.globals.zoom],pitch:[$i,[],t=>t.globals.pitch||0],"distance-from-center":[$i,[],t=>t.distanceFromCenter()],"heatmap-density":[$i,[],t=>t.globals.heatmapDensity||0],"line-progress":[$i,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[$i,[],t=>t.globals.skyRadialProgress||0],accumulated:[Gi,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[$i,Ro($i),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[$i,Ro($i),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:$i,overloads:[[[$i,$i],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[$i],(t,[e])=>-e.evaluate(t)]]},"/":[$i,[$i,$i],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[$i,[$i,$i],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[$i,[],()=>Math.LN2],pi:[$i,[],()=>Math.PI],e:[$i,[],()=>Math.E],"^":[$i,[$i,$i],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[$i,[$i],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[$i,[$i],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[$i,[$i],(t,[e])=>Math.log(e.evaluate(t))],log2:[$i,[$i],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[$i,[$i],(t,[e])=>Math.sin(e.evaluate(t))],cos:[$i,[$i],(t,[e])=>Math.cos(e.evaluate(t))],tan:[$i,[$i],(t,[e])=>Math.tan(e.evaluate(t))],asin:[$i,[$i],(t,[e])=>Math.asin(e.evaluate(t))],acos:[$i,[$i],(t,[e])=>Math.acos(e.evaluate(t))],atan:[$i,[$i],(t,[e])=>Math.atan(e.evaluate(t))],min:[$i,Ro($i),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[$i,Ro($i),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[$i,[$i],(t,[e])=>Math.abs(e.evaluate(t))],round:[$i,[$i],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[$i,[$i],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[$i,[$i],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Wi,[Ui,Gi],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Wi,[Gi],(t,[e])=>t.id()===e.value],"filter-type-==":[Wi,[Ui],(t,[e])=>t.geometryType()===e.value],"filter-<":[Wi,[Ui,Gi],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[Wi,[Gi],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[Wi,[Ui,Gi],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[Wi,[Gi],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[Wi,[Ui,Gi],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[Wi,[Gi],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[Wi,[Ui,Gi],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[Wi,[Gi],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[Wi,[Gi],(t,[e])=>e.value in t.properties()],"filter-has-id":[Wi,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Wi,[Yi(Ui)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Wi,[Yi(Gi)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Wi,[Ui,Yi(Gi)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Wi,[Ui,Yi(Gi)],(t,[e,n])=>function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Wi,overloads:[[[Wi,Wi],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Ro(Wi),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Wi,overloads:[[[Wi,Wi],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Ro(Wi),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Wi,[Wi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Wi,[Ui],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Ui,[Ui],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ui,[Ui],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ui,Ro(Gi),(t,e)=>e.map(e=>hr(e.evaluate(t))).join("")],"resolved-locale":[Ui,[Vi],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Bo{constructor(t,e){this.expression=t,this.U={},this.W=new xr,this.J=e?function(t){return"color"===t.type&&$o(t.default)?new ir(0,0,0,0):"color"===t.type?ir.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this.H=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,o,s,a){return this.W.globals=t,this.W.feature=e,this.W.featureState=n,this.W.canonical=i,this.W.availableImages=r||null,this.W.formattedSection=o,this.W.featureTileCoord=s||null,this.W.featureDistanceData=a||null,this.expression.evaluate(this.W)}evaluate(t,e,n,i,r,o,s,a){this.W.globals=t,this.W.feature=e||null,this.W.featureState=n||null,this.W.canonical=i,this.W.availableImages=r||null,this.W.formattedSection=o||null,this.W.featureTileCoord=s||null,this.W.featureDistanceData=a||null;try{const t=this.expression.evaluate(this.W);if(null==t||"number"==typeof t&&t!=t)return this.J;if(this.H&&!(t in this.H))throw new fr(`Expected value to be one of ${Object.keys(this.H).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this.U[t.message]||(this.U[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this.J}}}function Zo(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Io}function Yo(t,e){const n=new Jr(Io,[],e?function(t){const e={color:Ji,string:Ui,number:$i,enum:Ui,boolean:Wi,formatted:Bi,resolvedImage:Zi};return"array"===t.type?Yi(e[t.value]||Gi,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?No(new Bo(i,e)):Eo(n.errors)}class Xo{constructor(t,e){this.kind=t,this.G=e,this.isStateDependent="constant"!==t&&!$r(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,o){return this.G.evaluateWithoutErrorHandling(t,e,n,i,r,o)}evaluate(t,e,n,i,r,o){return this.G.evaluate(t,e,n,i,r,o)}}class Ko{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this.G=e,this.isStateDependent="camera"!==t&&!$r(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,o){return this.G.evaluateWithoutErrorHandling(t,e,n,i,r,o)}evaluate(t,e,n,i,r,o){return this.G.evaluate(t,e,n,i,r,o)}interpolationFactor(t,e,n){return this.interpolationType?co.interpolationFactor(this.interpolationType,t,e,n):0}}function Qo(t,e){if("error"===(t=Yo(t,e)).result)return t;const n=t.value.expression,i=Dr(n);if(!i&&!function(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}(e))return Eo([new Ei("","data expressions not supported")]);const r=Ur(n,["zoom","pitch","distance-from-center"]);if(!r&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(e))return Eo([new Ei("","zoom expressions not supported")]);const o=function t(e){let n=null;if(e instanceof po)n=t(e.result);else if(e instanceof fo){for(const i of e.args)if(n=t(i),n)break}else(e instanceof Gr||e instanceof co)&&e.input instanceof kr&&"zoom"===e.input.name&&(n=e);return n instanceof Ei||e.eachChild(e=>{const i=t(e);i instanceof Ei?n=i:!n&&i?n=new Ei("",\'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.\'):n&&i&&n!==i&&(n=new Ei("",\'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.\'))}),n}(n);if(!o&&!r)return Eo([new Ei("",\'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.\')]);if(o instanceof Ei)return Eo([o]);if(o instanceof co&&!Lo(e))return Eo([new Ei("",\'"interpolate" expressions cannot be used with this property\')]);if(!o)return No(new Xo(i?"constant":"source",t.value));const s=o instanceof co?o.interpolation:void 0;return No(new Ko(i?"camera":"composite",t.value,o.labels,s))}class ts{constructor(t,e){this.V=t,this.B=e,Ni(this,function t(e,n){const i="color"===n.type,r=e.stops&&"object"==typeof e.stops[0][0],o=r||!(r||void 0!==e.property),s=e.type||(Lo(n)?"exponential":"interval");if(i&&((e=Ni({},e)).stops&&(e.stops=e.stops.map(t=>[t[0],ir.parse(t[1])])),e.default=ir.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!uo[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);let a,l,u;if("exponential"===s)a=Go;else if("interval"===s)a=Ho;else if("categorical"===s){a=Jo,l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];u=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);a=Vo}if(r){const i={},r=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const o=[];for(const e of r)o.push([i[e].zoom,t(i[e],n)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:co.interpolationFactor.bind(void 0,s),zoomStops:o.map(t=>t[0]),evaluate:({zoom:t},i)=>Go({stops:o,base:e.base},n,t).evaluate(t,i)}}if(o){const t="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:co.interpolationFactor.bind(void 0,t),zoomStops:e.stops.map(t=>t[0]),evaluate:({zoom:t})=>a(e,n,t,l,u)}}return{kind:"source",evaluate(t,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?Wo(e.default,n.default):a(e,n,r,l,u)}}}(this.V,this.B))}static deserialize(t){return new ts(t.V,t.B)}static serialize(t){return{V:t.V,B:t.B}}}function es(t){if(Array.isArray(t))return t.map(es);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=es(t[n]);return e}return function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}(t)}function ns(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ns(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function is(t){if(!Array.isArray(t))return!1;if(function(t){return"pitch"===t||"distance-from-center"===t}(t[0]))return!0;for(let e=1;e<t.length;e++)if(is(t[e]))return!0;return!1}const rs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function os(t,e){return t<e?-1:t>e?1:0}function ss(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?as(t[1],t[2],"=="):"!="===e?cs(as(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?as(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(ss))):"all"===e?["all"].concat(t.slice(1).map(ss)):"none"===e?["all"].concat(t.slice(1).map(ss).map(cs)):"in"===e?ls(t[1],t.slice(2)):"!in"===e?cs(ls(t[1],t.slice(2))):"has"===e?us(t[1]):"!has"===e?cs(us(t[1])):"within"!==e||t;var n}function as(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function ls(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(os)]]:["filter-in-small",t,["literal",e]]}}function us(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function cs(t){return["!",t]}Ii((function(t,e){var n=function(){var t=function(t,e,n,i){for(n=n||{},i=t.length;i--;n[t[i]]=e);return n},e=[1,12],n=[1,13],i=[1,9],r=[1,10],o=[1,11],s=[1,14],a=[1,15],l=[14,18,22,24],u=[18,22],c=[22,24],h={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(t,e,n,i,r,o,s){var a=o.length-1;switch(r){case 1:this.$=new String(t.replace(/\\\\(\\\\|")/g,"$1").replace(/\\\\n/g,"\\n").replace(/\\\\r/g,"\\r").replace(/\\\\t/g,"\\t").replace(/\\\\v/g,"\\v").replace(/\\\\f/g,"\\f").replace(/\\\\b/g,"\\b")),this.$.Z=this.Y.first_line;break;case 2:this.$=new Number(t),this.$.Z=this.Y.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.Z=this.Y.first_line;break;case 5:this.$=new Boolean(!1),this.$.Z=this.Y.first_line;break;case 6:return this.$=o[a-1];case 13:this.$={},Object.defineProperty(this.$,"Z",{value:this.Y.first_line,enumerable:!1});break;case 14:case 19:this.$=o[a-1],Object.defineProperty(this.$,"Z",{value:this.Y.first_line,enumerable:!1});break;case 15:this.$=[o[a-2],o[a]];break;case 16:this.$={},this.$[o[a][0]]=o[a][1];break;case 17:this.$=o[a-2],o[a-2][o[a][0]]=o[a][1];break;case 18:this.$=[],Object.defineProperty(this.$,"Z",{value:this.Y.first_line,enumerable:!1});break;case 20:this.$=[o[a]];break;case 21:this.$=o[a-2],o[a-2].push(o[a])}},table:[{3:5,4:e,5:6,6:n,7:3,8:i,9:4,10:r,11:o,12:1,13:2,15:7,16:8,17:s,23:a},{1:[3]},{14:[1,16]},t(l,[2,7]),t(l,[2,8]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,3]),t(l,[2,4]),t(l,[2,5]),t([14,18,21,22,24],[2,1]),t(l,[2,2]),{3:20,4:e,18:[1,17],19:18,20:19},{3:5,4:e,5:6,6:n,7:3,8:i,9:4,10:r,11:o,13:23,15:7,16:8,17:s,23:a,24:[1,21],25:22},{1:[2,6]},t(l,[2,13]),{18:[1,24],22:[1,25]},t(u,[2,16]),{21:[1,26]},t(l,[2,18]),{22:[1,28],24:[1,27]},t(c,[2,20]),t(l,[2,14]),{3:20,4:e,20:29},{3:5,4:e,5:6,6:n,7:3,8:i,9:4,10:r,11:o,13:30,15:7,16:8,17:s,23:a},t(l,[2,19]),{3:5,4:e,5:6,6:n,7:3,8:i,9:4,10:r,11:o,13:31,15:7,16:8,17:s,23:a},t(u,[2,17]),t(u,[2,15]),t(c,[2,21])],defaultActions:{16:[2,6]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var e=this,n=[0],i=[null],r=[],o=this.table,s="",a=0,l=0,u=2,c=1,h=r.slice.call(arguments,1),d=Object.create(this.lexer),f={yy:{}};for(var p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(f.yy[p]=this.yy[p]);d.setInput(t,f.yy),f.yy.lexer=d,f.yy.parser=this,void 0===d.yylloc&&(d.yylloc={});var m=d.yylloc;r.push(m);var y=d.options&&d.options.ranges;function g(){var t;return"number"!=typeof(t=d.lex()||c)&&(t=e.symbols_[t]||t),t}this.parseError="function"==typeof f.yy.parseError?f.yy.parseError:Object.getPrototypeOf(this).parseError;for(var b,v,w,x,k,M,j,A={};;){if(this.defaultActions[v=n[n.length-1]]?w=this.defaultActions[v]:(null==b&&(b=g()),w=o[v]&&o[v][b]),void 0===w||!w.length||!w[0]){var F="";for(k in j=[],o[v])this.terminals_[k]&&k>u&&j.push("\'"+this.terminals_[k]+"\'");F=d.showPosition?"Parse error on line "+(a+1)+":\\n"+d.showPosition()+"\\nExpecting "+j.join(", ")+", got \'"+(this.terminals_[b]||b)+"\'":"Parse error on line "+(a+1)+": Unexpected "+(b==c?"end of input":"\'"+(this.terminals_[b]||b)+"\'"),this.parseError(F,{text:d.match,token:this.terminals_[b]||b,line:d.yylineno,loc:m,expected:j})}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+b);switch(w[0]){case 1:n.push(b),i.push(d.yytext),r.push(d.yylloc),n.push(w[1]),b=null,l=d.yyleng,s=d.yytext,a=d.yylineno,m=d.yylloc;break;case 2:if(A.$=i[i.length-(M=this.productions_[w[1]][1])],A.Y={first_line:r[r.length-(M||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(M||1)].first_column,last_column:r[r.length-1].last_column},y&&(A.Y.range=[r[r.length-(M||1)].range[0],r[r.length-1].range[1]]),void 0!==(x=this.performAction.apply(A,[s,l,a,f.yy,w[1],i,r].concat(h))))return x;M&&(n=n.slice(0,-1*M*2),i=i.slice(0,-1*M),r=r.slice(0,-1*M)),n.push(this.productions_[w[1]][0]),i.push(A.$),r.push(A.Y),n.push(o[n[n.length-2]][n[n.length-1]]);break;case 3:return!0}}return!0}};function d(){this.yy={}}return h.lexer={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this.X=t,this.K=this.tt=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this.X[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\\r\\n?|\\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this.X=this.X.slice(1),t},unput:function(t){var e=t.length,n=t.split(/(?:\\r\\n?|\\n)/g);this.X=t+this.X,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var i=this.match.split(/(?:\\r\\n?|\\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this.K=!0,this},reject:function(){return this.options.backtrack_lexer?(this.tt=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this.X.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\\n"+e+"^"},test_match:function(t,e){var n,i,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,K:this.K,X:this.X,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(i=t[0].match(/(?:\\r\\n?|\\n).*/g))&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\\r?\\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this.K=!1,this.tt=!1,this.X=this.X.slice(t[0].length),this.matched+=t[0],n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this.X&&(this.done=!1),n)return n;if(this.tt){for(var o in r)this[o]=r[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,n,i;this.X||(this.done=!0),this.K||(this.yytext="",this.match="");for(var r=this.et(),o=0;o<r.length;o++)if((n=this.X.match(this.rules[r[o]]))&&(!e||n[0].length>e[0].length)){if(e=n,i=o,this.options.backtrack_lexer){if(!1!==(t=this.test_match(n,r[o])))return t;if(this.tt){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,r[i]))&&t:""===this.X?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},et:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,n,i){switch(n){case 0:break;case 1:return 6;case 2:return e.yytext=e.yytext.substr(1,e.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\\.[0-9]+)?([eE][-+]?[0-9]+)?\\b)/,/^(?:"(?:\\\\[\\\\"bfnrt/]|\\\\u[a-fA-F0-9]{4}|[^\\\\\\0-\\x09\\x0a-\\x1f"])*")/,/^(?:\\{)/,/^(?:\\})/,/^(?:\\[)/,/^(?:\\])/,/^(?:,)/,/^(?::)/,/^(?:true\\b)/,/^(?:false\\b)/,/^(?:null\\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},d.prototype=h,h.Parser=d,new d}();e.parser=n,e.Parser=n.Parser,e.parse=function(){return n.parse.apply(n,arguments)}}));const hs={StyleExpression:Bo,isExpression:Zo,isExpressionFilter:ns,createExpression:Yo,createPropertyExpression:Qo,normalizePropertyExpression:function(t,e){if($o(t))return new ts(t,e);if(Zo(t)){const n=Qo(t,e);if("error"===n.result)throw new Error(n.value.map(t=>`${t.key}: ${t.message}`).join(", "));return n.value}{let n=t;return"string"==typeof t&&"color"===e.type&&(n=ir.parse(t)),{kind:"constant",evaluate:()=>n}}},ZoomConstantExpression:Xo,ZoomDependentExpression:Ko,StylePropertyFunction:ts},{isExpression:ds,createExpression:fs}=hs,ps={};function ms(t){if(!0===t)return function(){return!0};if(t&&t.condition){if("any"===t.type){const e=t.condition,n=[];for(let t=0;t<e.length;t++)n.push(ms(e[t]));return(t,e)=>{for(let i=0;i<n.length;i++)if(n[i](t,e))return!0;return!1}}const e=ms(t.condition);if(ni(t.layer))return e;const n=e=>e.layer===t.layer;return(t,i)=>n(t)&&e(t,i)}if(function t(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":case"!has":return 2===e.length&&("string"==typeof e[1]||e[1].property&&e[1].op);case"in":case"!in":return e.length>=2&&("string"==typeof e[1]||e[1].property&&e[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===e.length&&("string"==typeof e[1]||e[1].property&&e[1].op);case"none":case"any":case"all":for(const n of e.slice(1))if(!t(n)&&"boolean"!=typeof n)return!1;return!0;case"contains":return!0;default:return!1}}(t))return new Function("f","var p = (f && f.properties || {}); return "+qe(t));{let e=function(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ns(t)||(t=ss(t));const n=t;let i=!0;try{i=function(t){if(!is(t))return t;let e=es(t);return function t(e){let n=!1;const i=[];if("case"===e[0]){for(let t=1;t<e.length-1;t+=2)n=n||is(e[t]),i.push(e[t+1]);i.push(e[e.length-1])}else if("match"===e[0]){n=n||is(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){n=n||is(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}n&&(e.length=0,e.push("any",...i));for(let n=1;n<e.length;n++)t(e[n])}(e),e=function t(e){if(!Array.isArray(e))return e;const n=function(t){if(rs.has(t[0]))for(let e=1;e<t.length;e++)if(is(t[e]))return!0;return t}(e);return!0===n?n:n.map(e=>t(e))}(e),e}(n)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\\nand paste the contents of this message in the report.\\nThank you!\\nFilter Expression:\\n${JSON.stringify(n,null,2)}\\n        `)}const r=_i["filter_"+e],o=Yo(i,r);let s=null;if("error"===o.result)throw new Error(o.value.map(t=>`${t.key}: ${t.message}`).join(", "));s=(t,e,n)=>o.value.evaluate(t,e,{},n);let a=null,l=null;if(i!==n){const t=Yo(n,r);if("error"===t.result)throw new Error(t.value.map(t=>`${t.key}: ${t.message}`).join(", "));a=(e,n,i,r,o)=>t.value.evaluate(e,n,{},i,void 0,void 0,r,o),l=!Dr(t.value.expression)}return s=s,{filter:s,dynamicFilter:a||void 0,needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(i),needFeature:!!l}}(t);return e=e&&e.filter,(t,n)=>(ps.zoom=n,e&&e(ps,t))}}const ys={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function gs(t,e){ys.type=e||"number";const n=fs(t,ys);if("success"!==n.result)throw new Error(`Invalid maplibre spec expression: ${JSON.stringify(t)} (${n.value})`);return n.value}function bs(t){return ds(t)}const vs={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function ws(t){return vs[t]}const xs={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1},ks={lineDasharray:1,markerLineDasharray:1,uvScale:1,uvOffset:1};function Ms(t){return xs[t]?"string":ws(t)?"number":ks[t]?"array":"color"}var js=Object.freeze({__proto__:null,compileStyle:function(t=[]){return function t(e){if(!Array.isArray(e))return t([e]);const n=[];for(let t=0;t<e.length;t++){let i;i=!0===e[t].filter?function(){return!0}:ms(e[t].filter),n.push(ei({},e[t],{filter:i}))}return n}(t=t.map(t=>{const e=ei({},t);return e.filter&&e.filter.value&&(e.filter=e.filter.value),e}))},compileFilter:ms,createExpression:gs,isExpression:bs,isInterpolated:ws,getExpressionType:Ms});const As=[],Fs={},Ts={},zs={},Ss=[];class _s{static isAtlasLoaded(t,e={}){const{iconAtlas:n}=e;return!!(!t||n&&n.positions[t])}static genFnTypes(t){const e={};for(const n in t)if(bs(t[n])){const i=(n+"_Fn_0").trim(),r=(n+"Fn").trim(),o=Ms(n);e[i]=gs(t[n],o),e[r]=(t,n)=>{let r;Fs.zoom=t,Ts.properties=n;try{r=e[i].evaluateWithoutErrorHandling(Fs,Ts,zs,null,Ss)}catch(t){return null}return r}}else if(ci(t[n])){const i=(n+"_Fn_0").trim(),r=(n+"Fn").trim();ws(n)?(e[i]=p(t[n]),e[r]=(t,n)=>{const r=e[i](t,n);return ci(r)?p(r)(t,n):r}):(e[i]=m(t[n]),e[r]=(t,n)=>{const r=e[i](t,n);return ci(r)?m(r)(t,n):r})}return e}constructor(t,e,n){this.options=n;const i=[];this.symbolDef=e,this.symbol=y(e,()=>(i[0]=n.zoom,i)),this.styledVectors=[],this.properties={},this.nt=n.fnTypes||_s.genFnTypes(this.symbolDef),ci(this.symbolDef.visible)&&(this.it=p(this.symbolDef.visible)),n.atlas&&(this.iconAtlas=n.atlas.iconAtlas,this.glyphAtlas=n.atlas.glyphAtlas),this.features=this.rt(t)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=Math.pow(2,17)||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Int16Array,width:3,name:"aPosition"}]}fillPosition(t,e,n,i){this.needAltitudeAttribute()?(t.aPosition.push(e,n),t.aAltitude.push(i)):(Ti(As,e,n,i),t.aPosition.push(As[0],As[1],As[2]))}rt(t){if(!t.length)return t;const e="__fea_idx".trim();let n,i=0,r=t[i];for(;!r.geometry;)i++,r=t[i];if(Array.isArray(r.geometry)&&r.properties){let e=r.geometry[0];for(;Array.isArray(e);)e=e[0];e instanceof Et&&(n=t)}if(!n)if(n=[],Array.isArray(r.geometry))for(let e=0;e<t.length;e++){const i=ei({},t[e]);n.push(ti(i))}else for(let i=0;i<t.length;i++){const r=t[i],o=Cn(r);for(let t=0;t<o.length;t++){const i=o[t];i[e]=r[e],n.push(i)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const t="line"===this.symbolDef.textPlacement;let e=0,i=!1;const{textPitchAlignmentFn:r}=this.nt;!r&&t&&"map"===this.symbolDef.textPitchAlignment&&(i=!0);for(let o=0;o<n.length;o++){const s=Is(n[o]&&n[o].geometry);if(s>e&&(e=s),t&&!i&&r&&n[o].properties){const t=r(null,n[o].properties);"map"===t&&(i=t)}}this.hasMapPitchAlign=i,this.maxPosZ=e}const o=this.options.order;if(o){const t=[];for(let e=0;e<o.length;e++)o[e]&&t.push(ms(o[e]));n=n.sort((e,n)=>{const i=t.length;let r=-1,o=-1;for(let s=0;s<i&&(t[s](e)&&(r=s),t[s](n)&&(o=s),!(r>=0&&r<i&&o>=0&&o<i));s++);return r-o})}return n}load(t=1){const e="__fea_idx".trim(),n="_debug_info".trim(),i=this.nt,r=this.styledVectors;this.count=0;const o=this.features;if(!o||!o.length)return Promise.resolve(null);const s={},a={},l={zoom:this.options.zoom},u=[],c=y(this.symbolDef,()=>(u[0]=l.zoom,u));let h=0,d=o.length;const f=this.options.debugIndex;try{for(;h<d;h++){const t=o[h];if(!t||!t.geometry)continue;if(void 0!==f&&t[n].index!==f)continue;t.properties||(t.properties={}),t.properties.$layer=t.layer,t.properties.$type=t.type;const u=this.createStyledVector(t,c,i,l,s,a);u&&u.feature.geometry&&(u.featureIdx=void 0===t[e]?h:t[e],this.count++,r.push(u))}}catch(t){return Promise.reject(t)}return this.options.atlas?Promise.resolve(this.pack(t)):this.loadAtlas(s,a).then(()=>this.pack(t))}loadAtlas(t,e){return new Promise((n,i)=>{this.fetchAtlas(t,e,(t,e)=>{if(t)i(t);else{if(e){const{icons:t,glyphs:n}=e;if(t&&Object.keys(t).length){for(const e in t){const n=t[e],{width:i,height:r,data:o}=n.data;n.data=new Hn({width:i,height:r},o)}this.iconAtlas=new Vn(t)}if(n&&Object.keys(n).length){for(const t in n){const e=n[t];for(const t in e){const n=e[t],{width:i,height:r,data:o}=n.bitmap;n.bitmap=new Jn({width:i,height:r},o)}}this.glyphAtlas=new Yn(n)}}n({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}})})}fetchAtlas(t,e,n){Object.keys(t).length>0||Object.keys(e).length>0?this.options.requestor(t,e,n):n()}pack(t){if(!this.count)return null;if(null==t)throw new Error("layout scale is undefined");const e=this.createDataPack(this.styledVectors,t);if(!e)return null;e.properties=this.properties,this.empty&&(e.empty=!0);const n=e.buffers;delete e.buffers;const i={data:e,buffers:n};if(this.iconAtlas){const t=i.data.iconAtlas=Ps(this.iconAtlas);if(t.glyphMap)for(const e in t.glyphMap)n.push(t.glyphMap[e].data.data.buffer);n.push(i.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(i.data.glyphAtlas=Ps(this.glyphAtlas),n.push(i.data.glyphAtlas.image.data.buffer)),i}createStyledVector(t,e,n,i){return new Fi(t,e,n,i)}createDataPack(t,e){if(!t||!t.length)return null;this.maxIndex=0,this.maxPos=0,this.maxAltitude=0;const n=this.data={};let i=this.elements=[];const r=this.getFormat(Array.isArray(t[0])?t[0][0].symbol:t[0].symbol),o=this.needAltitudeAttribute()?2:3;for(let t=0;t<r.length;t++)n[r[t].name]=[];let s=[],a=0;const l=[];let u=0,c=!1,h=!0;const d=new Set;for(let i=0,r=t.length;i<r;i++){if(!t[i].feature.geometry)continue;const r=Array.isArray(t[i])?t[i][0].feature.id:t[i].feature.id;h&&(void 0!==Ts.id?d&&(d.has(Ts.id)?h=!1:d.add(Ts.id)):h=!1),ii(r)&&(Math.abs(r)>u&&(u=Math.abs(r)),r<0&&(c=!0));const f=this.data.aPosition.length;if(Array.isArray(t[i]))for(let n=0;n<t[i].length;n++)this.ot(t[i][n],e);else this.ot(t[i],e);const p=(n.aPosition.length-f)/o;for(let e=0;e<p;e++)s.push(t[i].featureIdx),ii(r)&&l.push(r);a=Math.max(a,t[i].featureIdx)}if(this.hasElements()&&!i.length)return null;s=new(Qn(a))(s),r[0].type=this.options.positionType?this.options.positionType:Kn(this.maxPos);const f=this.options.center;if(f&&(f[0]||f[1])){const t=n.aPosition;for(let e=0;e<t.length;e+=o)t[e]-=f[0],t[e+1]-=f[1]}const p=function(t,e){const n={};for(let i=0;i<t.length;i++){const r=t[i],o=r.type,s=r.name;n[s]=o===Array?e[s]:new o(e[s])}return n}(r,n);p.aPickingId=s;const m=[];for(const t in p)m.push(p[t].buffer);i=new(Xn(this.maxIndex))(i),m.push(i.buffer);const y={data:p,isIdUnique:h,is2D:0===this.maxPosZ,indices:this.hasElements()?i:null,positionSize:o,buffers:m,symbolIndex:this.symbolDef.index||{index:0}};if(this.st&&(y.markerPlacement=this.st),this.lt&&(y.textPlacement=this.lt),l.length){const t=c?Kn(u):Qn(u);y.featureIds=new t(l),m.push(y.featureIds.buffer)}else y.featureIds=[];return y.pickingIdIndiceMap=Ai(s,y.indices),y}ot(t,e){this.it&&!this.it(this.options.zoom,t.feature.properties)||this.placeVector(t,e,this.formatWidth)}addElements(...t){this.maxIndex=Math.max(this.maxIndex,...t),this.elements.push(...t)}hasElements(){return!0}getAltitude(t){const{altitudeProperty:e,defaultAltitude:n,altitudeScale:i}=this.options;let r=wi(t,e,n);return i&&(r*=i),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(r)),r}getIconAtlasMaxValue(){const t=this.iconAtlas.positions;let e=0;for(const n in t)if(li(t,n)){const{tl:i,displaySize:r}=t[n],o=Math.max(i[0],i[1],r[0]-1,r[1]-1);o>e&&(e=o)}return e}}function Ps(t){let e=t.positions,n=t.image&&t.image.format||"alpha";if(t instanceof Vn){e={};for(const n in t.positions){const i=t.positions[n];e[n]={paddedRect:i.paddedRect,pixelRatio:i.pixelRatio,tl:i.tl,br:i.br,displaySize:i.displaySize}}n="rgba"}const i=t.image;return{image:{width:i.width,height:i.height,data:i.data,format:n},glyphMap:t.glyphMap,positions:e}}function Is(t){if(!t)return 0;let e=0;if(Array.isArray(t))for(let n=0;n<t.length;n++)if(Array.isArray(t[n])){const i=Is(t[n]);i>e&&(e=i)}else{const i=Math.abs(t[n].z||0);i>e&&(e=i)}else{const n=Math.abs(t.z||0);n>e&&(e=n)}return e}function Os(t,e,n,i){const r="__fn_textSize".trim();let o=t.textSize;if(ni(e.textSize))return[16,16];t[r]&&(o=t[r]);const s=[];return s[0]=si(o)?o(i,n):o,s[1]=s[0],s}function qs(t){const e=t.stops;let n=-1/0;for(let t=0;t<e.length;t++){let i=e[t][1];ri(e[t][1])&&(i=qs(e[t][1])),i>n&&(n=i)}return n}function Cs(t,e,n){return[e||"normal",n||"normal","24px",t||"monospace"].join(" ")}const Rs=/\\{[\\w-]+(?:\\|[\\w-]+)*\\}/g;function Ns(t,e){return oi(t)?t.replace(Rs,(function(t){if(!e)return"";if((t=t.substring(1,t.length-1)).indexOf("|")>0){const n=t.split("|");for(let t=0;t<n.length;t++){const i=e[n[t]];if(!ni(i))return i}return""}const n=e[t];return ni(n)?"":Array.isArray(n)?n.join():n})):t}var Es=Object.freeze({__proto__:null,getSDFFont:Cs,resolveText:Ns,resolveVarNames:function(t){return t.match(Rs)},resolveExpVarNames:function t(e,n){if(2!==n.length||"get"!==n[0])for(let i=0;i<n.length;i++)2===n[i].length&&"get"===n[i][0]?e.push(n[i][1]):Array.isArray(n[i])&&t(e,n[i]);else e.push(n[1])}});const Ls=t=>t>=11904&&t<=12031,Ds=t=>t>=12032&&t<=12255,$s=t=>t>=12272&&t<=12287,Us=t=>t>=12288&&t<=12351,Ws=t=>t>=12352&&t<=12447,Js=t=>t>=12448&&t<=12543,Hs=t=>t>=12544&&t<=12591,Gs=t=>t>=12704&&t<=12735,Vs=t=>t>=12736&&t<=12783,Bs=t=>t>=12784&&t<=12799,Zs=t=>t>=12800&&t<=13055,Ys=t=>t>=13056&&t<=13311,Xs=t=>t>=13312&&t<=19903,Ks=t=>t>=19968&&t<=40959,Qs=t=>t>=40960&&t<=42127,ta=t=>t>=42128&&t<=42191,ea=t=>t>=63744&&t<=64255,na=t=>t>=64336&&t<=65023,ia=t=>t>=65040&&t<=65055,ra=t=>t>=65072&&t<=65103,oa=t=>t>=65104&&t<=65135,sa=t=>t>=65136&&t<=65279,aa=t=>t>=65280&&t<=65519;function la(t){return!((t=>t>=1536&&t<=1791)(t)||(t=>t>=1872&&t<=1919)(t)||(t=>t>=2208&&t<=2303)(t)||na(t)||sa(t))}function ua(t){return!!(746===t||747===t||!(t<4352)&&(Gs(t)||Hs(t)||ra(t)&&!(t>=65097&&t<=65103)||ea(t)||Ys(t)||Ls(t)||Vs(t)||!(!Us(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Xs(t)||Ks(t)||Zs(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||(t=>t>=44032&&t<=55215)(t)||Ws(t)||$s(t)||(t=>t>=12688&&t<=12703)(t)||Ds(t)||Bs(t)||Js(t)&&12540!==t||!(!aa(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!oa(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||ia(t)||(t=>t>=19904&&t<=19967)(t)||Qs(t)||ta(t)))}function ca(t){return!(ua(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Us(t)||Js(t)||(t=>t>=57344&&t<=63743)(t)||ra(t)||oa(t)||aa(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function ha(t){return t>=1424&&t<=2303||na(t)||sa(t)}const da=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function fa(t){for(const e of da)if(t>=e[0]&&t<=e[1])return!0;return!1}const pa={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\\\":"＼","]":"﹈","^":"＾",ut:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function ma(t,e,n,i,r,o,s,a,l,u){let c=t.trim();2===u&&(c=function(t){let e="";for(let n=0;n<t.length;n++){const i=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;e+=i&&ca(i)&&!pa[t[n+1]]||r&&ca(r)&&!pa[t[n-1]]||!pa[t[n]]?t[n]:pa[t[n]]}return e}(c));const h=[],d={positionedGlyphs:h,text:c,top:a[1],bottom:a[1],left:a[0],right:a[0],writingMode:u};let f;return f=function(t,e){const n=[];let i=0;for(let r=0;r<e.length;r++){const o=e[r];n.push(t.substring(i,o)),i=o}return i<t.length&&n.push(t.substring(i,t.length)),n}(c,function(t,e,n,i){if(!n)return[];if(!t)return[];const r=[],o=function(t,e,n,i){let r=0;for(let n=0;n<t.length;n++){const o=i[t.charCodeAt(n)];o&&(r+=o.metrics.advance+e)}return r/Math.max(1,Math.ceil(r/n))}(t,e,n,i);let s=0;for(let n=0;n<t.length;n++){const l=t.charCodeAt(n),u=i[l];u&&!ya[l]&&(s+=u.metrics.advance+e),n<t.length-1&&(ga[l]||!((a=l)<11904)&&(Gs(a)||Hs(a)||ra(a)||ea(a)||Ys(a)||Ls(a)||Vs(a)||Us(a)||Xs(a)||Ks(a)||Zs(a)||aa(a)||Ws(a)||$s(a)||Ds(a)||Bs(a)||Js(a)||ia(a)||ta(a)||Qs(a)))&&r.push(wa(n+1,s,o,r,va(l,t.charCodeAt(n+1)),!1))}var a;return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(wa(t.length,s,o,r,0,!0))}(c,s,n,e)),function(t,e,n,i,r,o,s,a,l){let u=0,c=8,h=0;const d=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5;for(let t=0;t<n.length;t++){let r=n[t];if(r=r.trim(),!r.length){c-=i;continue}const o=d.length;for(let t=0;t<r.length;t++){const n=r.charCodeAt(t),i=e[n];i&&(ua(n)&&1!==s?(32!==n&&d.push({glyph:n,x:u,y:0,vertical:!0}),u+=l+a):(32!==n&&d.push({glyph:n,x:u,y:c,vertical:!1}),u+=i.metrics.advance+a))}d.length!==o&&(h=Math.max(u-a,h),ka(d,e,o,d.length-1,f)),u=0,c-=i}const{horizontalAlign:p,verticalAlign:m}=xa(r);!function(t,e,n,i,r,o,s){const a=(e-n)*r,l=-(-i*s+.5)*o;if(a||l)for(let e=0;e<t.length;e++)t[e].x+=a,t[e].y+=l}(d,f,p,m,h,i,n.length);const y=n.length*i;t.top+=-m*y,t.bottom=t.top+y,t.left+=-p*h,t.right=t.left+h}(d,e,f,i,r,o,u,s,l),!!h.length&&d}const ya={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ga={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ba(t,e,n,i){const r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function va(t,e){let n=0;return 10===t&&(n-=1e4),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function wa(t,e,n,i,r,o){let s=null,a=ba(e,n,r,o);for(let t=0;t<i.length;t++){const l=i[t],u=ba(e-l.x,n,r,o)+l.badness;u<=a&&(s=l,a=u)}return{index:t,x:e,priorBreak:s,badness:a}}function xa(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function ka(t,e,n,i,r){if(!r)return;const o=e[t[i].glyph];if(o){const e=(t[i].x+o.metrics.advance)*r;if(!e)return;for(let r=n;r<=i;r++)t[r].x-=e}}function Ma(t){if(!function(t){for(const e of t)if(ha(e.charCodeAt(0)))return!0;return!1}(t))return t;const e=[],n=[],i=[];let r=0,o=0,s=1,a=1;for(const l of t){const t=l.codePointAt(0);fa(t)?(i.push(l),r++):(s=ha(t)?-1:1,a!==s?(o=r,n.length&&(a>0&&n.reverse(),e.push(...n)),i.length&&(e.splice(o,0,...i),i.length=0),a=s,n.length=0):i.length&&(n.push(...i),i.length=0),n.push(l),r++)}return i.length&&n.push(...i),n.length&&(a>0&&n.reverse(),e.push(...n)),e.reverse().join("")}const ja=/\\{ *([\\w_]+) *\\}/g;class Aa{constructor(t,e,n,i,r){this.feature=t,this.symbolDef=e,this.symbol=n,this.options=r,this.ct=this.ht.bind(this),this.nt=i}ht(t,e){return this.feature.properties[e]||"default"}getShape(t,e){if(this.dt)return this.dt;const{textHorizontalAlignmentFn:n,textVerticalAlignmentFn:i,markerHorizontalAlignmentFn:r,markerVerticalAlignmentFn:o,textWrapWidthFn:s}=this.nt;let a;const l=this.symbol,u=this.getIconAndGlyph(),c=this.feature.properties;if(u&&u.glyph){const{font:t,text:r}=u.glyph;if(""===r)return null;const o=this.size[0]/24,h=24,d=l.textKeepUpright,f="map"===l.textRotationAlignment&&"line"===l.textPlacement&&!l.isIconText,p=e.glyphMap[t],m=Fa(n?n(null,c):l.textHorizontalAlignment,i?i(null,c):l.textVerticalAlignment),y=1.2*h,g=function(t){for(let e=0;e<t.length;e++)if(!la(t.charAt(e).charCodeAt(0)))return!1;return!0}(r),b=g&&l.textLetterSpacing/o||0,v=[l.textDx/o||0,l.textDy/o||0],w=((s?s(null,c):l.textWrapWidth)||10*h)/o;a={},a.horizontal=ma(r,p,w,y,m,"center",b,v,h,1),g&&f&&d&&(a.vertical=ma(r,p,w,y,m,"center",b,v,h,2))}else if(u&&u.icon){if(!t.positions[u.icon.url])return null;const e=Fa(r?r(null,c):l.markerHorizontalAlignment,o?o(null,c):l.markerVerticalAlignment);a=function(t,e){const{horizontalAlign:n,verticalAlign:i}=xa(e),r=-2048*n,o=-2048*i;return{image:t,top:o,bottom:o+2048,left:r,right:r+2048}}(t.positions[u.icon.url],e),this.size||(this.size=a.image.displaySize)}return this.dt=a,a}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:t,markerTypeFn:e,markerPathFn:n,markerWidthFn:i,markerHeightFn:r,markerFillFn:o,markerFillPatternFileFn:s,markerFillOpacityFn:a,markerTextFitFn:l,markerTextFitPaddingFn:u,markerLineColorFn:c,markerLineWidthFn:h,markerLineOpacityFn:d,markerLineDasharrayFn:m,markerLinePatternFileFn:y,markerPathWidthFn:g,markerPathHeightFn:b,textNameFn:v,textFaceNameFn:w,textStyleFn:x,textWeightFn:k}=this.nt,{zoom:M}=this.options,j={},A=this.symbol,F=this.feature.properties,T=t?t(null,F):A.markerFile,z=e?e(null,F):A.markerType,S=T||z||A.markerPath,_=!ni(this.symbolDef.textName);let P;if(S){P=function(t,e,n,i,r,o){if(ni(e.markerWidth)&&ni(e.markerHeight))return null;const s="__fn_markerWidth".trim(),a="__fn_markerHeight".trim();let l=e.markerWidth||0,u=e.markerHeight||0;return ri(l)&&("identity"!==l.type?l=qs(l):(l=t.markerWidth,t[s]&&(l=t[s](i,n)),ri(l)&&(l="identity"===l.type?r(i,n):qs(l)))),ri(u)&&("identity"!==u.type?u=qs(u):(u=t.markerHeight,t[a]&&(u=t[a](i,n)),ri(u)&&(u="identity"===u.type?o(i,n):qs(u)))),[l,u]}(A,this.symbolDef,F,M,i,r)||[0,0];let t=A.markerTextFit;if(l&&(t=l(M,F)),t&&A.text&&"none"!==t){const e=A.text.textSize;let n=A.text.textName;f(n)&&(n=p(n)(M,F));const i=Ns(n,F);if(i){const n="__fn_textSize".trim(),r="__fn_textSize_0".trim();f(e)&&!A.text[n]&&(A.text[r]=p(e),A.text[n]=(t,e)=>{const n=A.text[r](t,e);return f(n)?p(n)(t,e):n});const o=Os(A.text,A.text,F,M);if("width"!==t&&"both"!==t||(P[0]=o[0]*i.length),"height"!==t&&"both"!==t||(P[1]=o[1]),o[0]&&o[1]){let t=A.markerTextFitPadding||[0,0,0,0];u&&(t=u(M,F)),P[0]+=t[1]+t[3],P[1]+=t[0]+t[2]}}else P[0]=P[1]=-1}}if(_&&(P=Os(A,this.symbolDef,F,M)),!P)return j;if(P[0]=Math.ceil(P[0]),P[1]=Math.ceil(P[1]),this.size=P,S&&P[0]>=0&&P[1]>=0){let t;if(z){const e={};if(e.markerType=z,"path"===z&&(e.markerPath=n?n(null,F):A.markerPath,e.markerPathWidth=g?g(null,F):A.markerPathWidth,e.markerPathHeight=b?b(null,F):A.markerPathHeight),i){const t=i(null,F);ni(t)||(e.markerWidth=t)}else A.markerWidth>=0&&(e.markerWidth=A.markerWidth);if(r){const t=r(null,F);ni(t)||(e.markerHeight=t)}else A.markerHeight>=0&&(e.markerHeight=A.markerHeight);if(o){const t=o(null,F);ni(t)||(e.markerFill=t)}else A.markerFill&&(e.markerFill=A.markerFill);if(s){const t=s(null,F);ni(t)||(e.markerFillPatternFile=t)}else A.markerFillPatternFile&&(e.markerFillPatternFile=A.markerFillPatternFile);if(a){const t=a(null,F);ni(t)||(e.markerFillOpacity=t)}else A.markerFillOpacity>=0&&(e.markerFillOpacity=A.markerFillOpacity);if(c){const t=c(null,F);ni(t)||(e.markerLineColor=t)}else A.markerLineColor&&(e.markerLineColor=A.markerLineColor);if(h){const t=h(null,F);ni(t)||(e.markerLineWidth=t)}else A.markerLineWidth>=0&&(e.markerLineWidth=A.markerLineWidth);if(d){const t=d(null,F);ni(t)||(e.markerLineOpacity=t)}else A.markerLineOpacity>=0&&(e.markerLineOpacity=A.markerLineOpacity);if(m){const t=m(null,F);ni(t)||(e.markerLineDasharray=t)}else A.markerLineDasharray&&(e.markerLineDasharray=A.markerLineDasharray);if(y){const t=y(null,F);ni(t)||(e.markerLinePatternFile=t)}else A.markerLinePatternFile&&(e.markerLinePatternFile=A.markerLinePatternFile);t="vector://"+JSON.stringify(e)}else t=T?T.replace(ja,this.ct):A.markerPath?function(t,e,n){if(!t.markerPath)return null;let i=1;const r=function(t){const e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}(t);ii(t.markerOpacity)&&(i=t.markerOpacity),ii(t.opacity)&&(i*=t.opacity);const o={};if(r){for(const t in r.stroke)li(r.stroke,t)&&(ni(r.stroke[t])||(o[t]=r.stroke[t]));for(const t in r.fill)li(r.fill,t)&&(ni(r.fill[t])||(o[t]=r.fill[t]))}const s=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];let a;const l=[];for(let t=0;t<s.length;t++)a=oi(s[t])?{path:s[t]}:s[t],a=ei({},a,o),a.d=a.path,delete a.path,l.push(a);const u=[\'<svg version="1.1"\',\'xmlns="http://www.w3.org/2000/svg"\'];i<1&&u.push(\'opacity="\'+i+\'"\'),t.markerPathWidth&&t.markerPathHeight&&u.push(\'viewBox="0 0 \'+t.markerPathWidth+" "+t.markerPathHeight+\'"\'),u.push(\'preserveAspectRatio="none"\'),e&&u.push(\'width="\'+e+\'"\'),n&&u.push(\'height="\'+n+\'"\'),u.push("><defs></defs>");for(let t=0;t<l.length;t++){let e="<path ";for(const n in l[t])li(l[t],n)&&(e+=" "+n+\'="\'+l[t][n]+\'"\');e+="></path>",u.push(e)}return u.push("</svg>"),"data:image/svg+xml;base64,"+btoa(u.join(" "))}(A,P[0],P[1]):null;j.icon={url:t,size:P}}if(_){const t=v?v(this.options.zoom,F):A.textName;if(t||0===t){const e=Cs(w?w(null,F):A.textFaceName,x?x(null,F):A.textStyle,k?k(null,F):A.textWeight);let n=Ns(t,F);n&&n.length&&(n=Ma(n),j.glyph={font:e,text:n})}}return this.iconGlyph=j,j}}function Fa(t,e){e&&"middle"!==e||(e="center"),t&&"middle"!==t||(t="center");let n="center"!==e?e:"";return n+="center"!==t?(n.length?"-":"")+t:"",n\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */}function Ta(t,e,n,i,r){const o=[];let s;for(let a=0;a<t.length;a++){const l=t[a];let u,c=!1;for(let t=0;t<l.length-1;t++){let a=l[t],h=l[t+1];a.x<e&&h.x<e||(a.x<e?(s=a,a=new Et(e,a.y+(e-a.x)/(h.x-a.x)*(h.y-a.y)).I(),a.z=s.z+(e-s.x)/(h.x-s.x)*(h.z-s.z),c=!0):h.x<e&&(s=h,h=new Et(e,a.y+(e-a.x)/(h.x-a.x)*(h.y-a.y)).I(),h.z=a.z+(e-a.x)/(s.x-a.x)*(s.z-a.z),c=!0),a.y<n&&h.y<n||(a.y<n?(s=a,a=new Et(a.x+(n-a.y)/(h.y-a.y)*(h.x-a.x),n).I(),a.z=s.z+(n-s.y)/(h.y-s.y)*(h.z-s.z),c=!0):h.y<n&&(s=h,h=new Et(a.x+(n-a.y)/(h.y-a.y)*(h.x-a.x),n).I(),h.z=a.z+(n-a.y)/(s.y-a.y)*(s.z-a.z),c=!0),a.x>=i&&h.x>=i||(a.x>=i?(s=a,a=new Et(i,a.y+(i-a.x)/(h.x-a.x)*(h.y-a.y)).I(),a.z=s.z+(i-s.x)/(h.x-s.x)*(h.z-s.z),c=!0):h.x>=i&&(s=h,h=new Et(i,a.y+(i-a.x)/(h.x-a.x)*(h.y-a.y)).I(),h.z=a.z+(i-a.x)/(s.x-a.x)*(s.z-a.z),c=!0),a.y>=r&&h.y>=r||(a.y>=r?(s=a,a=new Et(a.x+(r-a.y)/(h.y-a.y)*(h.x-a.x),r).I(),a.z=s.z+(r-s.y)/(h.y-s.y)*(h.z-s.z),c=!0):h.y>=r&&(s=h,h=new Et(a.x+(r-a.y)/(h.y-a.y)*(h.x-a.x),r).I(),h.z=a.z+(r-a.y)/(s.y-a.y)*(s.z-a.z),c=!0),u&&a.equals(u[u.length-1])||(u=[a],o.push(u)),c&&(u.clipped=!0),u.push(h)))))}}return o}class za extends Et{constructor(t,e,n,i){super(t,e),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new za(this.x,this.y,this.angle,this.segment)}}\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */function Sa(t,e,n,i,r){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let u=0;for(;a<n/2;){const e=t[s],n=t[s+1];if(!n)return!1;let o=t[s-1].angleTo(e)-e.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),u+=o;a-l[0].distance>i;)u-=l.shift().angleDelta;if(u>r)return!1;s++,a+=e.dist(n)}return!0}function _a(t,e,n,i,r,o,s,a,l,u,c){const h=function(t,e,n){return t?.6*e*n:0}(i,o,s),d=function(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}(i,r),f=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-d*s<e/4&&(e=d*s+e/4),function t(e,n,i,r,o,s,a,l,u,c,h){const d=s/2,f=function(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}(e);let p=0,m=n-i,y=[];for(let t=0;t<e.length-1;t++){const n=e[t],a=e[t+1],l=n.dist(a),g=a.angleTo(n);for(;m+i<p+l;){m+=i;const b=(m-p)/l,v=Pa(n.x,a.x,b),w=Pa(n.y,a.y,b),x=Pa(n.z||0,a.z||0,b);if(v>=0&&v<u&&w>=0&&w<u&&m-d>=0&&m+d<=f){const i=new za(v,w,g,t);i.z=x,c&&(i.axis=[n.y-w,v-n.x],i.angleR=x===(n.z||0)?0:Math.atan(.9*(x-(n.z||0))*h/n.dist(i))),i.line=e,i.I(),r&&!Sa(e,i,s,r,o)||y.push(i)}}p+=l}return l||y.length||a||(y=t(e,p/2,i,r,o,s,a,!0,u,c,h)),y}(t,f?e/2*a%e:(d/2+2*o)*s*a%e,e,h,n,d*s,f,!1,l,u,c)}function Pa(t,e,n){return t*(1-n)+e*n}function Ia(t,e){const n=t.length;if(n<=1)return[t];const i=[];let r,o;for(let e=0;e<n;e++){const n=bi(t[e]);0!==n&&(t[e].area=Math.abs(n),void 0===o&&(o=n<0),o===n<0?(r&&i.push(r),r=[t[e]]):r.push(t[e]))}if(r&&i.push(r),e>1)for(let t=0;t<i.length;t++)i[t].length<=e||(Je(i[t],e,1,i[t].length-1,Oa),i[t]=i[t].slice(0,e));return i}function Oa(t,e){return e.area-t.area}function qa(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e).j(r).m(e))}function Ca(t,e=1,n=!1){let i=1/0,r=1/0,o=-1/0,s=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<i)&&(i=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>o)&&(o=e.x),(!t||e.y>s)&&(s=e.y)}const l=Math.min(o-i,s-r);let u=l/2;const c=new Be(null,Ra);if(0===l)return new Et(i,r);for(let e=i;e<o;e+=l)for(let n=r;n<s;n+=l)c.push(new Na(e+u,n+u,u,t));let h=function(t){let e=0,n=0,i=0;const r=t[0];for(let t=0,o=r.length,s=o-1;t<o;s=t++){const o=r[t],a=r[s],l=o.x*a.y-a.x*o.y;n+=(o.x+a.x)*l,i+=(o.y+a.y)*l,e+=3*l}return new Na(n/e,i/e,0,t)}(t),d=c.length;for(;c.length;){const i=c.pop();(i.d>h.d||!h.d)&&(h=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,d)),i.max-h.d<=e||(u=i.h/2,c.push(new Na(i.p.x-u,i.p.y-u,u,t)),c.push(new Na(i.p.x+u,i.p.y-u,u,t)),c.push(new Na(i.p.x-u,i.p.y+u,u,t)),c.push(new Na(i.p.x+u,i.p.y+u,u,t)),d+=4)}return n&&(console.log("num probes: "+d),console.log("best distance: "+h.d)),h.p}function Ra(t,e){return e.max-t.max}function Na(t,e,n,i){this.p=new Et(t,e),this.h=n,this.d=function(t,e){let n=!1,i=1/0;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0,r=o.length,s=r-1;e<r;s=e++){const r=o[e],a=o[s];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,qa(t,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}const Ea=45*Math.PI/100;function La(t,e,n,i,r,o,s,a,l){const{feature:u,size:c,symbol:h}=t,d=c?24:0,f=i*(c?c[0]/d:1);if("line"===o){const t=[];let i=u.geometry;r&&(i=Ta(u.geometry,0,0,r,r));for(let o=0;o<i.length;o++){const u=_a(i[o],s,Ea,h.isIconText?null:n&&n.vertical||n&&n.horizontal||n,null,d,h.isIconText?1:f,1,r||1/0,a,l);if(h.textPlacement&&!h.isIconText)for(let t=0;t<u.length;t++)u[t].startIndex=e.length/3;if(t.push.apply(t,u),h.textPlacement&&!h.isIconText)for(let t=0;t<i[o].length;t++)e.push(i[o][t].x,i[o][t].y,i[o][t].z||0)}return t}return Da(u,o,r)}function Da(t,e,n,i,r){const o=[];if(3===t.type){const s=Ia(t.geometry,0);for(let t=0;t<s.length;t++){const a=s[t];if("vertex"===e)for(let t=0;t<a.length;t++){const e=a[t];for(let s=0;s<e.length;s++)ki(e[s],n)||(o.push(e[s]),i&&(0===s?$a(e[s],e[s],e[t+1],r):$a(e[s],e[s-1],e[s],r)))}else if("vertex-first"===e){const t=a[0];t&&t[0]&&!ki(t[0],n)&&(o.push(t[0]),i&&$a(t[0],t[0],t[1],r))}else if("vertex-last"===e||"vertex-firstlast"===e){const t=a[0];if("vertex-firstlast"===e&&t&&t[0]&&!ki(t[0],n)&&(o.push(t[0]),i&&$a(t[0],t[0],t[1],r)),t&&t[t.length-1]&&!ki(t[t.length-1],n)){const e=t.length-1;o.push(t[e]),i&&$a(t[e],t[e-1],t[e],r)}}else{const t=Ca(a,16);ki(t,n)||o.push(t)}}}else if(2===t.type)for(let s=0;s<t.geometry.length;s++){const a=t.geometry[s];if("vertex"===e)for(let t=0;t<a.length;t++)ki(a[t],n)||(o.push(a[t]),i&&(0===t?$a(a[t],a[t],a[t+1],r):$a(a[t],a[t-1],a[t],r)));else if("vertex-last"===e||"vertex-firstlast"===e){if("vertex-firstlast"!==e||ki(a[0],n)||(o.push(a[0]),i&&$a(a[0],a[0],a[1],r)),a&&a[a.length-1]&&!ki(a[a.length-1],n)){const t=a.length-1;o.push(a[t]),i&&$a(a[t],a[t-1],a[t],r)}}else ki(a[0],n)||(o.push(a[0]),i&&$a(a[0],a[0],a[1],r))}else if(1===t.type)for(let e=0;e<t.geometry.length;e++){const r=t.geometry[e];for(let t=0;t<r.length;t++){const e=r[t];ki(e,n)||(i&&(e.xRotation=0,e.yRotation=0,e.zRotation=0),o.push(e))}}return o}function $a(t,e,n,i){if(t.xRotation||t.yRotation||t.zRotation)return t;const r=n.x-e.x,o=e.y-n.y,s=(n.z-e.z)*i,a=Math.atan2(o,r);t.zRotation=a;const l=Math.atan2(s,Math.sqrt(r*r+o*o));return t.xyRotation=l,t}function Ua(t,e){const n={},i={},r=[];let o=0;function s(e){r.push(t[e]),o++}function a(t,e,n){const o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function l(t,e,i){const o=n[e];return delete n[e],n[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function u(t,e,n){const i=n?e[0][e[0].length-1]:e[0][0];return`${t}:${i.x}:${i.y}`}for(let c=0;c<t.length;c++){const h=t[c],d=h.geometry;if(!d)continue;const f=h.properties[e]?h.properties[e].toString():null;if(!f){s(c);continue}const p=u(f,d),m=u(f,d,!0);if(p in i&&m in n&&i[p]!==n[m]){const t=l(p,m,d),e=a(p,m,r[t].geometry);delete n[p],delete i[m],i[u(f,r[e].geometry,!0)]=e,r[t].geometry=null}else p in i?a(p,m,d):m in n?l(p,m,d):(s(c),n[p]=o-1,i[m]=o-1)}return r.filter(t=>t.geometry)}class Wa extends _s{static needMerge(t,e,n){if(!t)return!1;let i="line"===t.textPlacement||"line"===t.markerPlacement;return i||(e.textPlacementFn&&(i="line"===e.textPlacementFn(n)),e.markerPlacementFn&&(i="line"===e.markerPlacementFn(n))),t.mergeOnProperty&&i}static mergeLineFeatures(t,e,n,i){const r="__index".trim();let o=e.textPlacement,s=e.markerPlacement;n.textPlacementFn&&(o=n.textPlacementFn(i)),n.markerPlacementFn&&(s=n.markerPlacementFn(i));const a=function(t,e,n,i,r){const o="__index".trim(),s=_s.genFnTypes(e),{mergeOnPropertyFn:a}=s;if(!e.mergeOnProperty||"line"!==i&&"line"!==n)return[];if(!(Mi(l=e.mergeOnProperty)||"string"!=typeof l&&(null===l.constructor||l.constructor!==String)||"line"!==i&&"line"!==n))return[{features:t,property:e.mergeOnProperty}];var l;const u=[],c={},h=[];for(let s=0;s<t.length;s++){t[s][o]=s;const l=t[s].properties=t[s].properties||{};l.$layer=t[s].layer,l.$type=t[s].type;let d=n;"line"!==d&&(d=i);const f=a?a(r,l):e.mergeOnProperty;"line"!==d||Mi(f)?h.push(t[s]):(void 0===c[f]&&(c[f]=u.length,u.push({features:[],property:f})),u[c[f]].features.push(t[s]))}return h.length&&u.push({features:h}),u}(t,e,s,o,i);if(a.length){const e=[];for(let n=0;n<a.length;n++)e.push(a[n].property?Ua(a[n].features,a[n].property):t);if(1===e.length)return e[0];{let t=[];for(let n=0;n<e.length;n++)t=t.concat(e[n]);return t.sort((t,e)=>t[r]-e[r]),t}}}static splitPointSymbol(t,e=0){const n=[];if(Array.isArray(t)){const e=t;for(let t=0;t<e.length;t++)e[t]&&n.push(...Wa.splitPointSymbol(e[t],t));return n}let i=null,r=null;for(const e in t)0===e.indexOf("marker")?(i=i||{},i[e]=t[e]):0===e.indexOf("text")&&(r=r||{},r[e]=t[e]);return i&&(i.isIconText=!0,t.mergeOnProperty&&(i.mergeOnProperty=t.mergeOnProperty),n.push(i)),r&&(i&&(r.textPlacement=i.markerPlacement,r.textSpacing=i.markerSpacing,r.isIconText=!0),t.mergeOnProperty&&(r.mergeOnProperty=t.mergeOnProperty),n.push(r)),void 0!==t.visible&&(i&&(i.visible=t.visible),r&&(r.visible=t.visible)),i&&(i.markerTextFit&&r&&(i.text={},i.text.textName=r.textName,i.text.textSize=r.textSize),i.index={index:e,type:0}),r&&(r.index={index:e,type:1}),n}static isAtlasLoaded(t,e){const{icon:n,glyph:i}=t,{iconAtlas:r,glyphAtlas:o}=e;if(n&&(!r||!r.positions[n.url]))return!1;if(i){if(!o||!o.positions[i.font])return!1;const t=o.positions[i.font],{text:e}=i;for(let n=0;n<e.length;n++)if(!t[e.charCodeAt(n)])return!1}return!0}constructor(t,e,n){super(t,e,n),this.ft=e.textPlacement,this.nt.textPlacementFn&&(this.ft=this.nt.textPlacementFn(this.options.zoom))}createStyledVector(t,e,n,i,r,o){const s=new Aa(t,this.symbolDef,e,n,i),a=s.getIconAndGlyph();if(a.icon&&!this.options.atlas){const{url:t,size:e}=a.icon;r[t]||(r[t]=a.icon.size),r[t][0]<e[0]&&(r[t][0]=e[0]),r[t][1]<e[1]&&(r[t][1]=e[1])}if(a.glyph&&!this.options.atlas){const{font:t,text:e}=a.glyph,n=o[t]=o[t]||{};for(let t=0;t<e.length;t++)n[e.charCodeAt(t)]=1;"line"===this.ft&&(o.options={isCharsCompact:!1})}return this.options.allowEmptyPack||a.icon||a.glyph?s:null}getFormat(t){const e=void 0!==t.textName,n=e?this.getPackSDFFormat(t):this.getPackMarkerFormat();e?n.push(...this.pt()):n.push(...this.yt());const{markerOpacityFn:i,textOpacityFn:r,markerPitchAlignmentFn:o,textPitchAlignmentFn:s,markerRotationAlignmentFn:a,textRotationAlignmentFn:l,markerRotationFn:u,textRotationFn:c,markerAllowOverlapFn:h,textAllowOverlapFn:d,markerIgnorePlacementFn:f,textIgnorePlacementFn:p}=this.nt;return(i||r)&&n.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(o||s)&&n.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(a||l)&&n.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(u||c)&&n.push({type:Uint16Array,width:1,name:"aRotation"}),(h||d||f||p)&&n.push({type:Uint8Array,width:1,name:"aOverlap"}),n}gt(){return this.hasMapPitchAlign}pt(){const{textFillFn:t,textSizeFn:e,textHaloFillFn:n,textHaloRadiusFn:i,textHaloOpacityFn:r,textDxFn:o,textDyFn:s}=this.nt,a=[];return t&&a.push({type:Uint8Array,width:4,name:"aTextFill"}),e&&a.push({type:Uint8Array,width:1,name:"aTextSize"}),n&&a.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),i&&a.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),r&&a.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),o&&a.push({type:Int8Array,width:1,name:"aTextDx"}),s&&a.push({type:Int8Array,width:1,name:"aTextDy"}),a}yt(){const{markerWidthFn:t,markerHeightFn:e,markerDxFn:n,markerDyFn:i}=this.nt,r=[];return t&&r.push({type:this.options.markerWidthType||Uint8Array,width:1,name:"aMarkerWidth"}),e&&r.push({type:this.options.markerHeightType||Uint8Array,width:1,name:"aMarkerHeight"}),n&&r.push({type:Int8Array,width:1,name:"aMarkerDx"}),i&&r.push({type:Int8Array,width:1,name:"aMarkerDy"}),r}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.lineVertex=[];const t=super.createDataPack.apply(this,arguments);return t?(t.lineVertex=new Int16Array(this.lineVertex),t.buffers.push(t.lineVertex.buffer),t):null}placeVector(t,e){const n=t.getShape(this.iconAtlas,this.glyphAtlas);if(!this.options.allowEmptyPack&&!n)return;const i=this.bt(t,n,e);if(0===i.length)return;const r=this.data,o=this.needAltitudeAttribute()?2:3;let s=this.data.aPosition.length/o;const a=t.symbol,l=t.feature.properties,u="line"===this.ft&&!a.isIconText,c=void 0!==a.textName,h=c&&u&&function(t){let e=0;for(let n=0;n<t.length;n++)if(ua(t.charAt(n).charCodeAt(0)))e=0;else if(e++,e>=1)return!1;return!0}(t.getIconAndGlyph().glyph.text)?1:0,{textFillFn:d,textSizeFn:p,textHaloFillFn:m,textHaloRadiusFn:y,textHaloOpacityFn:g,textDxFn:b,textDyFn:v,textPitchAlignmentFn:w,textRotationAlignmentFn:x,textRotationFn:k,textAllowOverlapFn:M,textIgnorePlacementFn:j,textOpacityFn:A,markerWidthFn:F,markerHeightFn:T,markerDxFn:z,markerDyFn:S,markerPitchAlignmentFn:_,markerRotationAlignmentFn:P,markerRotationFn:I,markerAllowOverlapFn:O,markerIgnorePlacementFn:q,markerOpacityFn:C}=this.nt;let R,N,E,L,D,$,U,W,J,H,G,V,B,Z,Y,X,K;if(c){const e=t.getIconAndGlyph().glyph.font;R=function(t,e,n){const i=t.positionedGlyphs,r=[];for(let o=0;o<i.length;o++){const s=i[o],a=n[s.glyph];if(!a)continue;const l=a.rect;if(!l)continue;const u=4,c=a.metrics.advance/2,h=a.metrics.height/2,d=e?[s.x+c,0]:[0,0],f=e?[0,s.y-h]:[s.x+c,s.y-h],p=a.metrics.left-u-c+f[0],m=a.metrics.top-u+f[1],y=p+l.w,g=m+l.h,b=new Et(p,m),v=new Et(y,m),w=new Et(p,g),x=new Et(y,g);if(e&&s.vertical){const t=new Et(-c,c),e=-Math.PI/2,n=new Et(5,0);b.T(e,t).m(n),v.T(e,t).m(n),w.T(e,t).m(n),x.T(e,t).m(n)}r.push({tl:b,tr:v,bl:w,br:x,tex:l,writingMode:t.writingMode,glyphOffset:d})}return r}(n.horizontal,u,this.glyphAtlas.positions[e]),d&&(N=d(null,l),N=f(N)?[0,0,0,0]:pi([],N)),p&&(E=p(this.options.zoom,l),Mi(E)&&(E=14)),m&&(L=m(null,l),L=pi([],L)),y&&(D=y(null,l)),g&&($=255*g(null,l)),b&&(U=b(null,l)||0),v&&(W=v(null,l)||0),w&&(B=+("map"===w(null,l))),x&&(Z=+("map"===x(null,l))),k&&(Y=ji(k(null,l),0,360)*Math.PI/180)}else R=n?function(t){const e=t.image,n=t.top-1/e.pixelRatio,i=t.left-1/e.pixelRatio,r=t.bottom+1/e.pixelRatio,o=t.right+1/e.pixelRatio;let s,a,l,u;return s=new Et(i,n),a=new Et(o,n),l=new Et(o,r),u=new Et(i,r),[{tl:s,tr:a,bl:u,br:l,tex:{x:e.tl[0],y:e.tl[1],w:e.displaySize[0],h:e.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(n):function(){const t=new Et(0,0),e=new Et(0,0),n=new Et(0,0);return[{tl:t,tr:e,bl:new Et(0,0),br:n,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),F&&(J=F(null,l)),T&&(H=T(null,l)),z&&(G=z(null,l)),S&&(V=S(null,l)),_&&(B=+("map"===_(null,l))),P&&(Z=+("map"===P(null,l))),I&&(Y=ji(I(null,l),0,360)*Math.PI/180);const Q=O||M;Q&&(X=Q(null,l)||0);const tt=q||j;let et;tt&&(K=tt(null,l)||0);const nt=A||C;nt&&(et=255*nt(this.options.zoom,l));const it=this.options.EXTENT,rt=R.length,{altitudeScale:ot,altitudeProperty:st,defaultAltitude:at}=this.options,{altitude:lt}=xi(t.feature,ot,st,at);for(let t=0;t<i.length;t++){const e=i[t],n=e.z||lt||0;if(it!==1/0&&ki(e,it))continue;const o=e.x,a=e.y,l=R.length;for(let t=0;t<l;t++){const i=R[t],{tl:l,tr:d,bl:f,br:p,tex:m}=i;this.vt(r,o,a,n,10*l.x,10*l.y,m.x,m.y+m.h),c&&this.wt(r,u,rt,i.glyphOffset,e,h,e.axis,e.angleR),this.xt(r,N,E,L,D,$,U,W,J,H,G,V,et,B,Z,Y,X,K),this.vt(r,o,a,n,10*d.x,10*d.y,m.x+m.w,m.y+m.h),c&&this.wt(r,u,rt,i.glyphOffset,e,h,e.axis,e.angleR),this.xt(r,N,E,L,D,$,U,W,J,H,G,V,et,B,Z,Y,X,K),this.vt(r,o,a,n,10*f.x,10*f.y,m.x,m.y),c&&this.wt(r,u,rt,i.glyphOffset,e,h,e.axis,e.angleR),this.xt(r,N,E,L,D,$,U,W,J,H,G,V,et,B,Z,Y,X,K),this.vt(r,o,a,n,10*p.x,10*p.y,m.x+m.w,m.y),c&&this.wt(r,u,rt,i.glyphOffset,e,h,e.axis,e.angleR),this.xt(r,N,E,L,D,$,U,W,J,H,G,V,et,B,Z,Y,X,K),this.addElements(s,s+1,s+2),this.addElements(s+1,s+2,s+3),s+=4;const y=Math.max(Math.abs(o),Math.abs(a),Math.abs(n));y>this.maxPos&&(this.maxPos=y)}}}vt(t,e,n,i,r,o,s,a){this.fillPosition(t,e,n,i),t.aShape.push(r,o),t.aTexCoord.push(s,a)}wt(t,e,n,i,r,o,s,a){if(t.aCount.push(n),e){t.aGlyphOffset.push(i[0],i[1]),this.gt()&&t.aPitchRotation.push(s[0],s[1],a);const e=r.startIndex;t.aSegment.push(r.segment+e,e,r.line.length),t.aVertical.push(o)}}xt(t,e,n,i,r,o,s,a,l,u,c,h,d,f,p,m,y,g){const{textFillFn:b,textSizeFn:v,textHaloFillFn:w,textHaloRadiusFn:x,textHaloOpacityFn:k,textDxFn:M,textDyFn:j,textPitchAlignmentFn:A,textRotationAlignmentFn:F,textRotationFn:T,textAllowOverlapFn:z,textIgnorePlacementFn:S,textOpacityFn:_,markerWidthFn:P,markerHeightFn:I,markerDxFn:O,markerDyFn:q,markerPitchAlignmentFn:C,markerRotationAlignmentFn:R,markerRotationFn:N,markerAllowOverlapFn:E,markerIgnorePlacementFn:L,markerOpacityFn:D}=this.nt;b&&t.aTextFill.push(...e),v&&t.aTextSize.push(n),w&&t.aTextHaloFill.push(...i),x&&t.aTextHaloRadius.push(r),k&&t.aTextHaloOpacity.push(o),M&&t.aTextDx.push(s),j&&t.aTextDy.push(a),P&&t.aMarkerWidth.push(l),I&&t.aMarkerHeight.push(u),O&&t.aMarkerDx.push(c),q&&t.aMarkerDy.push(h),(D||_)&&t.aColorOpacity.push(d),(A||C)&&t.aPitchAlign.push(f),(R||F)&&t.aRotationAlign.push(p),(N||T)&&t.aRotation.push(9362*m);const $=E||z,U=L||S;($||U)&&t.aOverlap.push(($?8:0)+4*y+((U?2:0)+g)),r>0&&(this.properties.hasHalo=1)}bt(t,e,n){const{feature:i,symbol:r}=t,o=this.kt(t,r),s=i.properties,{markerSpacingFn:a,textSpacingFn:l}=this.nt,u=((a?a(null,s):r.markerSpacing)||(l?l(null,s):r.textSpacing)||250)*n,c=this.options.altitudeToTileScale;return La(t,this.lineVertex,e,n,this.options.EXTENT,o,u,this.gt(),c)}kt(t,e){let n;return n=this.nt.markerPlacementFn?this.nt.markerPlacementFn(this.options.zoom,t.feature.properties):e.markerPlacement||this.ft,this.st||!e.markerPlacement&&!e.isIconText||(this.st=n),!this.ft||e.isIconText||this.lt||(this.lt=n),n}getPackSDFFormat(t){if("line"!==this.ft||t.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const t=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this.gt()&&t.push({type:Float32Array,width:3,name:"aPitchRotation"}),t}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}}class Ja{constructor(t){this.x=t.x,this.y=t.y,this.z=t.z||0}clone(){return new Ja(this)}_(){return this.A(this.mag()),this}A(t){return this.x/=t,this.y/=t,this.z/=t,this}P(){var t=this.y;return this.y=this.x,this.x=-t,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(t){return this.clone().m(t)}sub(t){return this.clone().v(t)}m(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}v(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}mult(t){return this.clone().j(t)}j(t){return this.x*=t,this.y*=t,this.z*=t,this}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){var e=t.x-this.x,n=t.y-this.y,i=t.z-this.z;return e*e+n*n+i*i}I(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}}const Ha=Math.cos(Math.PI/180*37.5),Ga=Math.pow(2,16)/1,Va=new Et,Ba=new Et,Za=new Et;class Ya extends _s{constructor(t,e,n){super(t,e,n);let i=!1;const{lineDasharrayFn:r,lineDashColorFn:o}=this.nt;this.hasGradient=this.symbol.lineGradientProperty,r&&(i=function(t,e,n){for(let i=0;i<t.length;i++)if(n(e,t[i].properties))return!0;return!1}(t,this.options.zoom,r),i&&(this.dasharrayFn=r)),this.hasDasharray=Qa(this.symbol.lineDasharray)||i,this.hasDasharray&&o&&(this.dashColorFn=o)}createStyledVector(t,e,n,i,r){const o=new Fi(t,e,n,i),s=o.getLineResource();return!this.options.atlas&&s&&(r[s]=[0,0]),o}getFormat(){const{lineWidthFn:t,lineStrokeWidthFn:e,lineStrokeColorFn:n,lineColorFn:i,lineOpacityFn:r,lineDxFn:o,lineDyFn:s,linePatternAnimSpeedFn:a,linePatternGapFn:l}=this.nt,u=[...this.getPositionFormat()];if(u.push(this.iconAtlas||this.hasDasharray?{type:Int8Array,width:3,name:"aExtrude"}:{type:Int8Array,width:2,name:"aExtrude"}),u.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),t&&u.push({type:Uint8Array,width:1,name:"aLineWidth"}),e&&u.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),i&&u.push({type:Uint8Array,width:4,name:"aColor"}),n&&u.push({type:Uint8Array,width:4,name:"aStrokeColor"}),r&&u.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&u.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&u.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const t=this.getIconAtlasMaxValue();u.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(o||s)&&u.push({type:Int8Array,width:2,name:"aLineDxDy"}),(a||l)&&u.push({type:Int8Array,width:2,name:"aLinePattern"}),u}placeVector(t){const{lineJoinFn:e,lineCapFn:n,lineWidthFn:i,lineHeightFn:r,lineStrokeWidthFn:o,lineStrokeColorFn:s,lineColorFn:a,lineOpacityFn:l,lineDxFn:u,lineDyFn:c,linePatternAnimSpeedFn:h,linePatternGapFn:d}=this.nt,p=this.symbol,m=t.feature,y=m.properties;let g=p.lineJoin||"miter",b=p.lineCap||"butt";if(e&&(g=e(this.options.zoom,y)||"miter"),n&&(b=n(this.options.zoom,y)||"butt"),i){let t=i(this.options.zoom,y);ni(t)&&(t=4),this.feaLineWidth=+t}else this.feaLineWidth=+p.lineWidth;if(r){let t=r(this.options.zoom,y);ni(t)&&(t=this.feaLineWidth),this.feaLineHeight=+t}else this.feaLineHeight=+p.lineHeight||this.feaLineWidth;if(o){let t=o(this.options.zoom,y);ni(t)&&(t=0),this.feaLineStrokeWidth=t}else this.feaLineStrokeWidth=p.lineStrokeWidth||0;if(a&&(this.feaColor=a(this.options.zoom,y)||[255,255,255,255],this.feaColor=f(this.feaColor)?[0,0,0,0]:pi([],this.feaColor)),s&&(this.feaStrokeColor=s(this.options.zoom,y)||[0,0,0,255],this.feaStrokeColor=f(this.feaStrokeColor)?[0,0,0,0]:pi([],this.feaStrokeColor)),l){let t=l(this.options.zoom,y);ni(t)&&(t=1),this.feaOpacity=255*t}if(this.dasharrayFn){let t=this.dasharrayFn(this.options.zoom,y)||[0,0,0,0];if(t.length<4){const e=t;1===t.length?t=[e[0],e[0],e[0],e[0]]:2===t.length?t=[e[0],e[1],e[0],e[1]]:3===t.length&&(t=[e[0],e[1],e[2],e[2]])}this.feaDash=t}if(this.dashColorFn){let t=(this.dashColorFn?this.dashColorFn(this.options.zoom,y):this.symbol.lineDashColor)||[0,0,0,0];t=pi([],t),this.feaDashColor=t}if(this.iconAtlas){const e=t.getLineResource(),n=this.iconAtlas.glyphMap[e];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],n){const{tl:t,displaySize:n}=this.iconAtlas.positions[e];this.feaTexInfo[0]=t[0]+1,this.feaTexInfo[1]=t[1]+1,this.feaTexInfo[2]=n[0]-3,this.feaTexInfo[3]=n[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(u){let t=u(this.options.zoom,y);ni(t)&&(t=0),this.feaLineDx=t}if(c){let t=c(this.options.zoom,y);ni(t)&&(t=0),this.feaLineDy=t}if(h){let t=h(this.options.zoom,y);ni(t)&&(t=0),0!==t&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=t}if(d){let t=d(this.options.zoom,y);ni(t)&&(t=0),this.feaLinePatternGap=t}const v=this.options.EXTENT;let w=m.geometry;if(v!==1/0){w=[];const t=[];for(let e=0;e<m.geometry.length;e++){t[0]=m.geometry[e];const n=Ta(t,-1,-1,v+1,v+1);if(3===m.type&&n.length>1){const t=n[0],e=n[n.length-1];il(t[0],e[e.length-1])&&(n[0]=e.concat(t.slice(1)),n.length=n.length-1)}w.push(...n)}}const x=this.needAltitudeAttribute()?2:3;for(let t=0;t<w.length;t++)this.offset=this.data.aPosition.length/x,this.Mt(w[t],m,g,b,2,1.05)}jt(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}Mt(t,e,n,i,r,o){const s=this.jt()||Qa(this.feaDash)||Qa(this.symbol.lineDasharray),a=this.options.isTube;a&&(t=t.map(t=>new Ja(t))),this.overscaling=1;const l=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&e.properties&&ii(e.properties.mapbox_clip_start)&&ii(e.properties.mapbox_clip_end)){this.clipStart=+e.properties.mapbox_clip_start,this.clipEnd=+e.properties.mapbox_clip_end;for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance()}const u=3===e.type&&!t.clipped;let c=t.length;for(;c>=2&&il(t[c-1],t[c-2]);)c--;let h=0;for(;h<c-1&&il(t[h],t[h+1]);)h++;if(c<(u?3:2))return;"bevel"===n&&(r=1.05);const d=this.overscaling<=16?15*l/(512*this.overscaling):0,f={vertexLength:0,primitiveLength:0,currentNormal:null};let p,m,y,g,b;this.e1=this.e2=-1,u&&(p=t[c-2],b=t[h].sub(p)._().P());for(let e=h;e<c;e++){if(y=e===c-1?u?t[h+1]:void 0:t[e+1],y&&il(t[e],y))continue;b&&(g=b),p&&(m=p),p=t[e],b=y?y.sub(p)._().P():g,f.dir=m?p.sub(m)._():y.sub(p)._(),g=g||b,f.currentNormal=g;let l=g.add(b);0===l.x&&0===l.y||l._();const v=g.x*b.x+g.y*b.y,w=l.x*b.x+l.y*b.y,x=0!==w?1/w:1/0,k=2*Math.sqrt(2-2*w),M=w<Ha&&m&&y,j=g.x*b.y-g.y*b.x>0;if(!a&&M&&e>h){const t=p.dist(m);if(t>2*d){const e=p.sub(p.sub(m).j(d/t).I());e.z=p.z,this.updateDistance(m,e),this.addCurrentVertex(e,g,0,0,f),m=e}}const A=m&&y;f.middleVertex=A;let F=A?n:u?"butt":i;if(A&&"round"===F&&(x<o?F="miter":x<=2&&(F="fakeround")),"miter"===F&&x>r&&!a&&(F="bevel"),"bevel"===F&&(x>2&&(F="flipbevel"),x<r&&(F="miter")),m&&this.updateDistance(m,p),"miter"===F)a?(this.addCurrentVertex(p,g,0,0,f),f.dir=y.sub(p)._(),this.addCurrentVertex(p,b,0,0,f)):(l.j(x),this.addCurrentVertex(p,l,0,0,f),s&&(f.currentNormal=b,this.addCurrentVertex(p,l,0,0,f)));else if("flipbevel"===F){if(x>100)l=b.mult(-1);else{const t=x*g.add(b).mag()/g.sub(b).mag();l.P().j(t*(j?-1:1))}this.addCurrentVertex(p,l,0,0,f),this.addCurrentVertex(p,l.mult(-1),0,0,f)}else if("bevel"===F||"fakeround"===F){const t=-Math.sqrt(x*x-1),e=j?t:0,n=j?0:t;if(m&&this.addCurrentVertex(p,g,e,n,f),"fakeround"===F){const t=Math.round(180*k/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*t*t+(.848013+v*(.215638*v-1.06021)))}const i=b.sub(g).j(n).m(g)._().j(j?-1:1);this.addHalfVertex(p,i.x,i.y,!1,j,0,f)}}y&&(f.currentNormal=b,this.addCurrentVertex(p,b,-e,-n,f))}else if("butt"===F)this.addCurrentVertex(p,l,0,0,f);else if("square"===F){const t=m?1:-1;this.addCurrentVertex(p,l,t,t,f)}else"round"===F&&(m&&(this.addCurrentVertex(p,g,0,0,f),this.addCurrentVertex(p,g,1,1,f,!0)),y&&(this.addCurrentVertex(p,b,-1,-1,f,!0),this.addCurrentVertex(p,b,0,0,f)));if(!a&&M&&e<c-1){const t=p.dist(y);if(t>2*d){const e=p.add(y.sub(p).j(d/t).I());e.z=p.z,this.updateDistance(p,e),this.addCurrentVertex(e,b,0,0,f),p=e}}}}addCurrentVertex(t,e,n,i,r,o=!1){const s=e.x+e.y*n,a=e.y-e.x*n,l=e.y*i-e.x,u=-e.y-e.x*i;let c=0,h=0;if(r.middleVertex){Va.x=s,Va.y=a,Ba.x=l,Ba.y=u;const t=r.currentNormal;if(c=nl(t,Va),0===n&&0===i)h=-c;else{const e=Za;e.x=t.x,e.y=t.y,e.j(-1),h=nl(e,Ba)}}this.addHalfVertex(t,s,a,o,!1,n,r,c),this.addHalfVertex(t,l,u,o,!0,-i,r,h),this.prevVertex&&il(t,this.prevVertex)||(this.prevVertex=t),this.distance>Ga/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,n,i,r,o))}addHalfVertex({x:t,y:e,z:n},i,r,o,s,a,l,u){this.fillData(this.data,t,e,n||0,i,r,o,s,1*this.scaledDistance,u);const c=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,c),l.primitiveLength++),s?this.e2=c:this.e1=c}fillData(t,e,n,i,r,o,s,a,l,u){const{lineWidthFn:c,lineStrokeWidthFn:h,lineStrokeColorFn:d,lineColorFn:f,lineOpacityFn:p,lineDxFn:m,lineDyFn:y,linePatternAnimSpeedFn:g,linePatternGapFn:b}=this.nt;this.fillPosition(t,e,n,i);let v=63*r;v=(Math.sign(v)||1)*((Math.floor(Math.abs(v))>>1<<1)+ +s);let w=63*o;w=(Math.sign(w)||1)*((Math.floor(Math.abs(w))>>1<<1)+ +a),t.aExtrude.push(v,w),(this.iconAtlas||this.hasDasharray)&&t.aExtrude.push(63*u),t.aLinesofar.push(l),c&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),h&&t.aLineStrokeWidth.push(Math.round(2*this.feaLineStrokeWidth)),f&&t.aColor.push(...this.feaColor),d&&t.aStrokeColor.push(...this.feaStrokeColor),p&&t.aOpacity.push(this.feaOpacity),this.dasharrayFn&&t.aDasharray.push(...this.feaDash),this.dashColorFn&&t.aDashColor.push(...this.feaDashColor),this.iconAtlas&&t.aTexInfo.push(...this.feaTexInfo),(m||y)&&t.aLineDxDy.push(this.feaLineDx||0,this.feaLineDy||0),(g||b)&&t.aLinePattern.push(127*(this.feaPatternAnimSpeed||0),10*(this.feaLinePatternGap||0)),this.maxPos=Math.max(this.maxPos,Math.abs(e)+1,Math.abs(n)+1)}addElements(t,e,n){super.addElements(this.offset+t,this.offset+e,this.offset+n)}At(t){const e=this.options.EXTENT,n=this.elements;for(let i=0;i<n.length;i+=3)e!==1/0&&(Ka(this.data.aPosition,n[i],n[i+1],3,e)||Ka(this.data.aPosition,n[i+1],n[i+2],3,e))||t.push(n[i],n[i+1],n[i+2])}Ft(t){if(t.length<=1)return t;const e=[],n=this.options.EXTENT;let i,r=!0;for(i=0;i<t.length-1;i++){const o=Xa(t[i],t[i+1],n);o&&r||(e.push(t[i]),r=o)}return r||e.push(t[i]),e}updateDistance(t,e){if(this.options.isTube){const n=t.dist(e),i=hi(this.options)*(e.z-t.z);this.distance+=Math.sqrt(n*n+i*i)}else this.distance+=t.dist(e);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Ga-1):this.distance}}function Xa(t,e,n){return n!==1/0&&(t.x<0&&e.x<0||t.x>n&&e.x>n||t.y<0&&e.y<0||t.y>n&&e.y>n)}function Ka(t,e,n,i,r){if(r===1/0)return!1;const o=Math.floor(.5*t[e*i]),s=Math.floor(.5*t[e*i+1]),a=Math.floor(.5*t[n*i]),l=Math.floor(.5*t[n*i+1]);return o===a&&(o<0||o>r)&&s!==l||s===l&&(s<0||s>r)&&o!==a}function Qa(t){if(!Array.isArray(t))return!1;for(let e=0;e<t.length;e++)if(t[e])return!0;return!1}const tl=new Et(0,0),el=new Et(0,0);function nl(t,e){const n=t.mag(),i=e.mag();tl.x=e.x,tl.y=e.y;const r=t.angleTo(el),o=e.angleTo(el);return Math.sign(o-r)*Math.sqrt(i*i-n*n)}function il(t,e){return t.equals(e)&&t.z===e.z}class rl extends Ya{constructor(t,e,n){super(t,e,n),this.Tt=n.altitudeProperty}getFormat(){const{lineColorFn:t,lineWidthFn:e}=this.nt,n=[{type:this.maxPosZ>=Math.pow(2,15)?Float32Array:Int16Array,width:3,name:"aPosition"},{type:Uint16Array,width:1,name:"aLinesofar"},{type:Uint8Array,width:1,name:"aUp"},{type:Int16Array,width:3,name:"aExtrudedPosition"},{type:Int8Array,width:2,name:"aExtrude"}];return t&&n.push({type:Uint8Array,width:4,name:"aColor"}),e&&n.push({type:Uint8Array,width:1,name:"aLineWidth"}),this.Tt&&n.push({type:Array,width:1,name:"aLineHeight"}),n}placeVector(t){const e=t.feature;if(this.Tt){const{altitudeScale:t,altitudeProperty:n,defaultAltitude:i,heightProperty:r,defaultHeight:o,minHeightProperty:s}=this.options,{altitude:a,height:l}=xi(e,t,n,i,r,o,s);this.feaAltitude=a,this.feaMinHeight=(a-l)/a*32767,a>this.maxAltitude&&(this.maxAltitude=a)}return super.placeVector(t)}needAltitudeAttribute(){return!1}Mt(t,e,n,i,r,o){const s=this.data.aPosition.length/3;super.Mt(t,e,n,i,r,o);const a=this.data.aPosition.length/3,l=this.data.aPosition.length/3-this.offset;if(3!==e.type&&l>0&&!1!==this.options.side){const t=!1!==this.options.top?1:0,e=t+4;let n=this.data.aPosition.length/3;for(const t in this.data){const e=this.data[t],i=e.length/n;for(let t=0;t<i;t++)e.push(e[s*i+3*i+t])}n=this.data.aPosition.length/3;for(const t in this.data){const i=this.data[t],r=i.length/n;for(let t=0;t<r;t++)i.push(i[s*r+r*e+t])}n=this.data.aPosition.length/3;for(const t in this.data){const i=this.data[t],r=i.length/n;for(let t=0;t<r;t++)i.push(i[s*r+r*(e+3)+t])}super.addElements(t+1,l+1,l),super.addElements(l,l+1,l+2);const i=this.data.aPosition.length/3-this.offset;n=this.data.aPosition.length/3;for(const t in this.data){const e=this.data[t],i=e.length/n;for(let t=0;t<i;t++)e.push(e[a*i-i+t])}n=this.data.aPosition.length/3;for(const t in this.data){const i=this.data[t],r=i.length/n;for(let t=0;t<r;t++)i.push(i[a*r-e*r-r+t])}n=this.data.aPosition.length/3;for(const t in this.data){const i=this.data[t],r=i.length/n;for(let t=0;t<r;t++)i.push(i[a*r-e*r-3*r+t])}super.addElements(i,l-3,i+1),super.addElements(l-3,i+2,i+1)}}fillData(t,e,n,i,r,o,s,a,l){const u=!1!==this.options.top,c=!1!==this.options.side,h=this.feaLineWidth||this.symbol.lineWidth/2*(this.options.EXTENT/this.options.tileSize),d=63*r,f=63*o,p=h*r+e,m=h*o+n;this.zt(t,e,n,r,o,s,a,l,p,m,d,f),c&&(u&&this.zt(t,e,n,r,o,s,a,l,p,m,d,f),this.zt(t,e,n,r,o,s,a,l,p,m,d,f),this.St(t,e,n,r,o,s,a,l,p,m,d,f),this.St(t,e,n,r,o,s,a,l,p,m,d,f)),this.maxPos=Math.max(this.maxPos,Math.abs(e),Math.abs(n))}zt(t,e,n,i,r,o,s,a,l,u,c,h){const{lineColorFn:d,lineWidthFn:f}=this.nt;t.aPosition.push(e,n,32767),t.aLinesofar.push(a),t.aUp.push(+s),t.aExtrudedPosition.push(l,u,1),t.aExtrude.push(c,h),d&&t.aColor.push(...this.feaColor),f&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),this.Tt&&t.aLineHeight.push(this.feaAltitude)}St(t,e,n,i,r,o,s,a,l,u,c,h){const{lineColorFn:d,lineWidthFn:f}=this.nt;t.aPosition.push(e,n,this.feaMinHeight||0),t.aLinesofar.push(a),t.aUp.push(+s),t.aExtrudedPosition.push(l,u,1),t.aExtrude.push(c,h),d&&t.aColor.push(...this.feaColor),f&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),this.Tt&&t.aLineHeight.push(this.feaAltitude)}addElements(t,e,n){const i=!1!==this.options.top,r=!1!==this.options.side,o=(i?1:0)+(r?4:0);if(t*=o,e*=o,this.data.aUp[this.offset+(n*=o)+4]){if(i&&super.addElements(e,t,n),r){const t=i?1:0;super.addElements(e+t,n+t,n+t+2),super.addElements(e+t+1,n+t+1+2,e+t+1+2)}}else if(i&&super.addElements(t,n,e),r){const e=i?1:0;super.addElements(t+e,t+e+2,n+e),super.addElements(t+e+1+2,n+e+1+2,n+e+1)}}createDataPack(t,e){this.maxAltitude=0;const n=super.createDataPack(t,e);if(!n)return n;const{data:i,indices:r}=n;this.getFormat().reduce((t,e)=>(t[e.name]={size:e.width},t),{}).aPickingId={size:1};const{aExtrudedPosition:o,aPosition:s,aLinesofar:a,aUp:l,aExtrude:u,aColor:c,aLineHeight:h,aLineWidth:d}=i,f={},p=nn(o,r);let m,y=!0;for(let t=0;t<p.length;t++)p[t]=-p[t],p[t]%1!=0&&(y=!1);if(!1!==this.options.top&&this.symbol.material&&function(t){for(const e in t)if(e.indexOf("Texture")>=0&&t[e])return!0;return!1}(this.symbol.material)&&(m=function(t,e,n){const i=[];for(let r=0;r<t.length;r+=3){const t=e[r/3];i.push(t/256,n[r/3]?1:0)}return i}(o,a,l)),f.aPosition=s,m&&(f.aTexCoord0=new Float32Array(m)),f.aNormal=y?new Int8Array(p):new Float32Array(p),f.aPickingId=i.aPickingId,f.aExtrude=u,c&&(f.aColor=c),d&&(f.aLineWidth=d),h){const t=Kn(this.maxAltitude);f.aLineHeight=new t(h)}const g=[];for(const t in f)g.push(f[t].buffer);return n.data=f,n.buffers=g,n}}const ol=Math.pow(2,16)/1;class sl extends _s{getFormat(){return[...this.getPositionFormat()]}placeVector(t){const e=t.feature,n=3===e.type,i=e.geometry,r=this.elements;n&&(this.elements=[]);const o=this.needAltitudeAttribute()?2:3;for(let t=0;t<i.length;t++)this.offset=this.data.aPosition.length/o,this.Mt(i[t],e),n&&(this.At(r),this.elements=[]);n&&(this.elements=r)}Mt(t,e){const n=3===e.type;let i=t.length;for(;i>=2&&t[i-1].equals(t[i-2]);)i--;let r,o,s,a=0;for(;a<i-1&&t[a].equals(t[a+1]);)a++;if(!(i<(n?3:2))){this.distance=0,this.vertexLength=0,this.primitiveLength=0,this.e1=this.e2=this.e3=-1,n&&(r=t[i-2]);for(let e=a;e<i;e++)s=n&&e===i-1?t[a+1]:t[e+1],s&&t[e].equals(s)||(r&&(o=r),r=t[e],o&&(this.distance+=r.dist(o)),this.addCurrentVertex(r,this.distance))}}addCurrentVertex(t,e){const n=this.vertexLength++;this.addLineVertex(this.data,t,e),n>=1&&this.addElements(n-1,n),e>ol&&(this.distance=0,this.addCurrentVertex(t,this.distance))}addLineVertex(t,e){this.fillPosition(t,e.x,e.y,e.z||0),this.maxPos=Math.max(this.maxPos,Math.abs(e.x),Math.abs(e.y))}addElements(t,e){super.addElements(this.offset+t,this.offset+e)}At(t){const e=this.options.EXTENT,n=this.elements;for(let i=0;i<n.length;i+=2)vi(this.data.aPosition,n[i],n[i+1],3,e)||t.push(n[i],n[i+1])}}const al=45*Math.PI/100;class ll extends _s{getFormat(){return"line"===this.symbol.markerRotationAlignment?[...this.getPositionFormat(),{type:Float32Array,width:1,name:"aXYRotation"},{type:Float32Array,width:1,name:"aZRotation"}]:[...this.getPositionFormat()]}placeVector(t){const e="line"===this.symbol.markerRotationAlignment,n=this.bt(t,this.symbol.markerSpacing||250,this.symbol.markerPlacement||"point",e);for(let t=0;t<n.length;t++){const i=n[t];this.fillPosition(this.data,i.x,i.y,i.z),e&&(this.data.aXYRotation.push(i.xyRotation||0),this.data.aZRotation.push(i.zRotation||0));const r=Math.max(Math.abs(i.x),Math.abs(i.y));r>this.maxPos&&(this.maxPos=r)}}bt(t,e,n,i){const r=t.feature,o=this.options.EXTENT;if("line"===n){const t=[];let n=r.geometry;o&&(n=Ta(r.geometry,0,0,o,o));for(let i=0;i<n.length;i++){const r=_a(n[i],e,al,null,null,24,1,1,o||1/0);t.push.apply(t,r)}return t}return Da(r,n,o,i,this.options.altitudeToTileScale)}hasElements(){return!1}}\n/*!\n     * from @turf/bboxClip\n     * https://github.com/Turfjs/turf\n     * MIT LICENSE\n     */const ul=[],cl=[];function hl(t,e){var n,i,r,o,s,a,l;for(i=1;i<=8;i*=2){for(n=[],o=!(fl(r=t[t.length-1],e)&i),s=0;s<t.length;s++){if((l=!(fl(a=t[s],e)&i))!==o){const t=dl(r,a,i,e);n.push(void 0!==a.x?new Et(t[0],t[1]):t)}l&&n.push(a),r=a,o=l}if(!(t=n).length)break}return n}function dl(t,e,n,i){return ul[0]=void 0===t.x?t[0]:t.x,ul[1]=void 0===t.y?t[1]:t.y,t=ul,cl[0]=void 0===e.x?e[0]:e.x,cl[1]=void 0===e.y?e[1]:e.y,e=cl,8&n?[t[0]+(e[0]-t[0])*(i[3]-t[1])/(e[1]-t[1]),i[3]]:4&n?[t[0]+(e[0]-t[0])*(i[1]-t[1])/(e[1]-t[1]),i[1]]:2&n?[i[2],t[1]+(e[1]-t[1])*(i[2]-t[0])/(e[0]-t[0])]:1&n?[i[0],t[1]+(e[1]-t[1])*(i[0]-t[0])/(e[0]-t[0])]:null}function fl(t,e){ul[0]=void 0===t.x?t[0]:t.x,ul[1]=void 0===t.y?t[1]:t.y;var n=0;return(t=ul)[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}const pl=[0,0,0,0];class ml extends _s{constructor(...t){super(...t),this.lineElements=[]}createStyledVector(t,e,n,i,r){const o=new Fi(t,e,n,i),s=o.getPolygonResource();return!this.options.atlas&&s&&(r[s]=[0,0]),o}getFormat(){const t=[...this.getPositionFormat()],{polygonFillFn:e,polygonOpacityFn:n,uvScaleFn:i,uvOffsetFn:r}=this.nt;if(this.iconAtlas){const e=this.getIconAtlasMaxValue();t.push({type:e>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return e&&t.push({type:Uint8Array,width:4,name:"aColor"}),n&&t.push({type:Uint8Array,width:1,name:"aOpacity"}),i&&t.push({type:Uint16Array,width:2,name:"aUVScale"}),r&&t.push({type:Uint8Array,width:2,name:"aUVOffset"}),t}placeVector(t,e){const n=t.feature;this._t(n.geometry,n,e)}_t(t,e){let n,i,r,o;const{polygonFillFn:s,polygonOpacityFn:a,uvScaleFn:l,uvOffsetFn:u}=this.nt,c=e.properties;s&&(n=s(this.options.zoom,c)||At([],255,255,255,255),n=f(n)?pl:pi([],n)),a&&(i=a(this.options.zoom,c),ni(i)&&(i=1),i*=255),l&&(r=l(this.options.zoom,c),ni(r)&&(r=[1,1]),r=[255*r[0],255*r[1]]),u&&(o=u(this.options.zoom,c),ni(o)&&(o=[0,0]),o=[255*o[0],255*o[1]]);const h=!!this.iconAtlas,d=Ia(t,500),p=[0,0],m=[0,0];if(h){const{polygonPatternFileFn:t}=this.nt,e=t?t(null,c):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[e]){const t=this.iconAtlas.positions[e];p[0]=t.tl[0]+1,p[1]=t.tl[1]+1,m[0]=t.displaySize[0]-3,m[1]=t.displaySize[1]-3}}const y=this.needAltitudeAttribute()?2:3,g=[-1,-1,e.extent+1,e.extent+1];for(let t=0;t<d.length;t++){const e=d[t],s=this.data.aPosition.length/y,a=[],l=[];for(let t=0;t<e.length;t++){let s=e[t];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(s=hl(s,g)),0!==s.length){0!==t&&l.push(a.length/3);for(let t=0;t<s.length;t++){const e=s[t].x,l=s[t].y,u=s[t].z||0;this.fillPosition(this.data,e,l,u),h&&this.data.aTexInfo.push(p[0],p[1],m[0],m[1]),void 0!==n&&this.data.aColor.push(n[0],n[1],n[2],n[3]),void 0!==i&&this.data.aOpacity.push(i),void 0!==r&&this.data.aUVScale.push(r[0],r[1]),void 0!==o&&this.data.aUVOffset.push(o[0],o[1]);const c=Math.abs(e),d=Math.abs(l);c>this.maxPos&&(this.maxPos=c),d>this.maxPos&&(this.maxPos=d),a.push(e,l,u)}}}let u=On(a,l,3);if(a.length&&!u.length){const t=[];for(let e=0;e<a.length;e+=3)t[e]=a[e],t[e+1]=a[e+2],t[e+2]=a[e+1];if(u=On(t,l,3),!u.length){for(let e=0;e<a.length;e+=3)t[e]=a[e+1],t[e+1]=a[e+2],t[e+2]=a[e];u=On(t,l,3)}}for(let t=0;t<u.length;t+=3)this.addElements(s+u[t],s+u[t+1],s+u[t+2])}}}const yl=[{type:Int16Array,width:3,name:"aPosition"}];class gl extends _s{getFormat(){return yl}placeVector(t,e){const n=this.bt(t,e);if(0===n.length)return;const i=this.data,r=this.getAltitude(t.feature.properties);let o=i.aPosition.length/yl[0].width;for(let t=0;t<n.length;t++){const e=n[t];i.aPosition.push(2*e.x+0,2*e.y+0,r),i.aPosition.push(2*e.x+1,2*e.y+0,r),i.aPosition.push(2*e.x+1,2*e.y+1,r),i.aPosition.push(2*e.x+0,2*e.y+1,r),this.addElements(o,o+1,o+2),this.addElements(o,o+2,o+3),o+=4;const s=Math.max(Math.abs(2*e.x+1),Math.abs(2*e.y+1));s>this.maxPos&&(this.maxPos=s)}}bt(t,e){const{feature:n,symbol:i}=t,r=this.kt(t,i),o=n.properties,{markerSpacingFn:s}=this.nt,a=((s?s(null,o):i.markerSpacing)||250)*e;return La(t,null,null,e,this.options.EXTENT,r,a)}kt(t,e){return this.nt.markerPlacementFn?this.nt.markerPlacementFn(this.options.zoom,t.feature.properties):e.markerPlacement}}class bl extends Ya{constructor(t,e,n){(e=ei({},e)).lineJoin="miter",e.lineCap="butt",super(t,e,n),this.options.radialSegments%2==1&&this.options.radialSegments--}getFormat(){const{lineWidthFn:t,lineColorFn:e,lineOpacityFn:n,linePatternAnimSpeedFn:i,linePatternGapFn:r}=this.nt,o=[...this.getPositionFormat(),{type:Int8Array,size:4,name:"aTubeNormal"},{type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}];if(this.iconAtlas){o.push({type:Int8Array,width:1,name:"aNormalDistance"});const t=this.getIconAtlasMaxValue();o.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return t&&o.push({type:Uint16Array,width:1,name:"aLineWidth"}),e&&o.push({type:Uint8Array,width:4,name:"aColor"}),n&&o.push({type:Uint8Array,width:1,name:"aOpacity"}),i&&o.push({type:Int8Array,width:1,name:"aLinePatternAnimSpeed"}),r&&o.push({type:Int8Array,width:1,name:"aLinePatternGap"}),o}addHalfVertex(t,e,n,i,r,o,s,a){const{x:l,y:u,z:c}=t,h=1*this.scaledDistance,d=this.options.radialSegments/2,{x:f,y:p,z:m}=s.dir,y=function(t,e,n,i,r,o,s,a){gt(vl,n,i,r),gt(wl,o,s,0),kt(xl,vl,wl),wt(wl,wl),wt(xl,xl),kl[e]||(kl[e]=[]);const l=kl[e];for(var u=0;u<e;u++){const t=Math.PI*u/e,n=1-Math.abs(t-0)/(Math.PI/2);l[u]=l[u]||[],Ml(wl,xl,l[u],1,t,n*(a?-1:1))}return l}(0,d,f,p,m,e,n,r);this.prevVertex&&this.fillTubeElements(r),this.fillData(this.data,l,u,c||0,y,r,h,a)}fillTubeElements(t){const e=this.options.radialSegments/2,n=this.needAltitudeAttribute()?2:3,i=this.data.aPosition.length/n;for(let n=0;n<e;n++){const r=n+i-2*e;let o,s;n===e-1&&t?(o=n+i-2*e+1,s=n+i-2*e-2*e+1):(o=n+i+1,s=n+i+1-2*e),super.addElements(n+i-this.offset,o-this.offset,r-this.offset),super.addElements(r-this.offset,o-this.offset,s-this.offset)}}fillData(t,e,n,i,r,o,s,a){const{lineWidthFn:l,lineColorFn:u,lineOpacityFn:c,linePatternAnimSpeedFn:h,linePatternGapFn:d}=this.nt,f=r.length;for(let o=0;o<f;o++){if(this.fillPosition(t,e,n,i),Ft(r[o],r[o],63),t.aTubeNormal.push(...r[o]),t.aLinesofar.push(s),this.iconAtlas&&(t.aNormalDistance.push(63*a),t.aTexInfo.push(...this.feaTexInfo)),l){const e=di(this.options.metric);let n=this.feaLineWidth*e;isNaN(n)&&(n=0),t.aLineWidth.push(Math.round(n))}u&&t.aColor.push(...this.feaColor),c&&t.aOpacity.push(this.feaOpacity),h&&t.aLinePatternAnimSpeed.push(127*(this.feaPatternAnimSpeed||0)),d&&t.aLinePatternGap.push(10*(this.feaLinePatternGap||0))}this.maxPos=Math.max(this.maxPos,Math.abs(e)+1,Math.abs(n)+1)}createDataPack(t,e){const n=super.createDataPack(t,e);return n&&(n.is2D=!1),n}}const vl=[],wl=[],xl=[],kl={};function Ml(t,e,n,i,r,o){return At(n,i*(Math.cos(r)*t[0]+Math.sin(r)*e[0]),i*(Math.cos(r)*t[1]+Math.sin(r)*e[1]),i*(Math.cos(r)*t[2]+Math.sin(r)*e[2]),o),n}class jl extends bl{addHalfVertex(t,e,n,i,r,o,s,a){const{x:l,y:u,z:c}=t,h=1*this.scaledDistance,{x:d,y:f,z:p}=s.dir,m=function(t,e,n,i,r,o,s,a){gt(Fl,n,i,r),gt(Tl,o,s,0),kt(zl,Fl,Tl),wt(Tl,Tl),wt(zl,zl),function(t,e,n){t[0]=e,t[1]=n}(Al,t,e);const l=Ot(Al)/t,u=Math.atan(e/t);let c=Math.PI/2+(Math.PI/2-u);return Sl[0]||(Sl[0]=[]),Ml(Tl,zl,Sl[0],l,c,a?1:-1),c+=2*u,Sl[1]||(Sl[1]=[]),Ml(Tl,zl,Sl[1],l,c,a?1:-1),Sl}(this.feaLineWidth,this.feaLineHeight,d,f,p,e,n,r);this.prevVertex&&this.fillTubeElements(r),this.fillData(this.data,l,u,c||0,m,r,h,a)}}const Al=[],Fl=[],Tl=[],zl=[],Sl=[];var _l=Object.freeze({__proto__:null,clipPolygon:hl,calculateSignedArea:bi,getFeaAltitudeAndHeight:xi,generatePickingIndiceIndex:Ai,convertRTLText:Ma,packPosition:Ti,unpackPosition:function(t,e,n,i){const r=(Math.sign(e)||1)*(Math.abs(e)%zi),o=(Math.sign(n)||1)*(Math.abs(n)%zi),s=Math.floor(Math.abs(e)/zi),a=Math.floor(Math.abs(n)/zi);return t[0]=r,t[1]=o,t[2]=Math.sign(i+1e-5)*(2*s+a)*Si+i,t},convertGeometry:ti,getPosArrayType:Kn,getUnsignedArrayType:Qn,getIndexArrayType:Xn});const Pl={},Il={},Ol=[];Object.freeze({__proto__:null,loadSymbolFnTypes:function t(e,n){if(!e)return null;var i=!1;if(Array.isArray(e)){var r,o=[];for(let s=0;s<e.length;s++)(r=t(e[s],n))?(o.push(r),i=!0):o.push(e[s]);return i?o:e}var s={__fn_types_loaded:!0};const a=[];for(const t in e)li(e,t)&&a.push(t);const l=function(t){Object.defineProperty(s,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=p(this["_"+t])),this["__fn_"+t].apply(this,n())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},u={},c=function(t,e){Object.defineProperty(s,t,{get:function(){this["__fn_"+t]||(this["__fn_"+t]=gs(this["_"+t],e));const i=n()[0];u.zoom=i;try{return this["__fn_"+t].evaluateWithoutErrorHandling(u,Pl,Il,null,Ol)}catch(t){return null}},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})};for(let t=0,n=a.length;t<n;t++){const n=a[t];if(f(e[n]))i=!0,s["_"+n]=e[n],l(n);else if(bs(e[n])){i=!0;const t=Ms(n);s["_"+n]=e[n],c(n,t)}else s[n]=e[n]}return i?s:e}});const ql={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textStyle:1,textFaceName:1,textWeight:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1};Object.assign({visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},ql),Object.assign({lineDasharray:1},ql);function Cl(t,e,n,i,r,o,s,a,l,u,c,h,d,f,p,m){const y=e.length,g=r/3;for(let n=2,i=y;n<i;n+=3)t[r+n-2]=e[n-2],t[r+n-1]=e[n-1],t[r+n-0]=e[n]-o;r+=y;for(let n=2,i=y;n<i;n+=3)t[r+n-2]=e[n-2],t[r+n-1]=e[n-1],t[r+n-0]=e[n]-s;r+=y;for(let n=2,i=y;n<i;n+=3)t[r+n-2]=e[n-2],t[r+n-1]=e[n-1],t[r+n-0]=e[n]-o;r+=y;for(let n=2,i=y;n<i;n+=3)t[r+n-2]=e[n-2],t[r+n-1]=e[n-1],t[r+n-0]=e[n]-s;r+=y,(n=n||[]).push(y/3);for(let e=0;e<n.length;e++){Rl(g+(n[e-1]||0),g+n[e],t,y/3,a,i,l,u,c,h,d,f,p,m)}return r}function Rl(t,e,n,i,r,o,s,a,l,u,c,h,d,f){const p=o.length;let m,y;for(let s=t,a=e;s<a-1;s++)m=s,y=s+1,at(n,m,y,r)||((s-t)%2==1&&(m+=2*i,y+=2*i),o.push(m+i,m,y),o.push(y,y+i,m+i));s&&function(t,e,n,i,r,o,s,a,l,u){let c,h=0,d=0,f=0,p=0;for(let m=r.length-1;m>=0;m--){const y=r[m],g=3*y+1,b=3*y+2,v=i[3*y],w=i[g],x=i[b];h||d||(h=Math.max(i[b],i[3*r[m-2]+2]),d=Math.min(i[b],i[3*r[m-2]+2]),c=h-d);let k=f;const M=m%6;0===t?(5===M&&(p=Nt(i,r,m,v,w)),k=2===M||3===M||4===M?f:f+p):1===t&&(2===M||3===M||4===M?k=0:5===M?(p=Nt(i,r,m,v,w),k=p):k=p);const j=k*a*l/o;let A;A="bottom"===e?x===h?c*u/s:0:x===h?0:c*u/s,n[2*y]=j,n[2*y+1]=A,0===M&&(f+=p)}}(a,l,u,n,o.slice(p,o.length),c[0],c[1],h,d,f)}function Nl(t,e,n,i,r,o,s,a,l,u){void 0===e.top&&(e.top=!0),void 0===e.side&&(e.side=!0);const{altitudeScale:c,altitudeProperty:h,defaultAltitude:d,heightProperty:f,minHeightProperty:y,defaultHeight:g,tangent:b,uv:v,uvScale:w,topUVMode:x,sideUVMode:M,top:j,side:A,textureYOrigin:z,topThickness:S}=e,_=function(t,e,{altitudeScale:n,altitudeProperty:i,defaultAltitude:r,heightProperty:o,minHeightProperty:s,defaultHeight:a},{side:l,top:u,topThickness:c,uvOrigin:h,uv:d,uvSize:f,topUVMode:p,sideUVMode:m,textureYOrigin:y,glScale:g,localScale:b,vScale:v},w){const x=e/t[0].extent,M=[],j=[],A=[],T=[],z=[],S=[],_=!!d,P=!!u,I=!!l,O=_?[]:null;function q(t,n,i,r){if(P){const r=On(T,i,3);if(0===r.length)return n;let o;F(z,T),n+=T.length;for(let e=2,n=r.length;e<n;e+=3)o=r[e-1],r[e-1]=r[e]+t/3,r[e]=o+t/3,r[e-2]+=t/3;F(S,r),_&&qt(p||0,t,n,O,z,0,g,b,f[0],f[1]),c>0&&!I&&(n=Cl(z,T,i,S,n,0,c,e,_,m||0,y,O,f,g,b,v))}return I&&(P&&(c=0),n=Cl(z,T,i,S,n,c,r,e,_,m||0,y,O,f,g,b,v)),n}let C=0,R=0;const N=[-1,-1,e+1,e+1];let E=0,L=t.length;void 0!==w&&(E=w,L=w+1);let D=0,$=!1;for(;E<L;E++){const l=t[E],u=l.id;k(u)&&(Math.abs(u)>D&&(D=Math.abs(u)),u<0&&($=!0));const c=l.geometry,{altitude:h,height:d}=_l.getFeaAltitudeAndHeight(l,n,i,r,o,a,s);C=Math.max(Math.abs(h),C);const f=z.length;let p=R,m=[];T.length=0;for(let t=0,n=c.length;t<n;t++){const i=_l.calculateSignedArea(c[t])<0;!i&&t>0&&(R=q(p,R,m,d*x),T.length=0,m=[],p=R);let r=c[t];if(e!==1/0&&(r=_l.clipPolygon(r,N)),!r.length){t===n-1&&(R=q(p,R,m,d*x));continue}const o=r.length;Array.isArray(r[0])?r[0][0]===r[o-1][0]&&r[0][1]===r[o-1][1]||r.push([r[0][0],r[0][1]]):r[0].x===r[o-1].x&&r[0].y===r[o-1].y||r.push(r[0]),i&&m.push(T.length/3),st(T,T.length,r,x,h),t===n-1&&(R=q(p,R,m,d*x))}const y=z.length-f,g="__fea_idx".trim();for(let t=0;t<y/3;t++)j.push(void 0===l[g]?E:l[g]),M.push(E),k(u)&&A.push(u)}const U=_l.getUnsignedArrayType(j.length?j[j.length-1]:0),W={maxAltitude:C,vertices:new(_l.getPosArrayType(Math.max(512,C)))(z),indices:S,pickingIds:new U(j),featureIndexes:M};if(A.length){const t=$?_l.getPosArrayType(D):_l.getUnsignedArrayType(D);W.featureIds=new t(A)}else W.featureIds=[];return O&&(O.length=z.length/3*2,W.uvs=O),W}(t,n,{altitudeScale:c,altitudeProperty:h,defaultAltitude:d||0,heightProperty:f,minHeightProperty:y,defaultHeight:g||0},{top:j,side:A,topThickness:10*S||0,uv:v||b,uvSize:w?[.5*w[0],.5*w[1]]:[.5,.5],uvOrigin:i,topUVMode:x,sideUVMode:M,textureYOrigin:z,glScale:r,localScale:s,vScale:o},u),P=[],I=new(_l.getIndexArrayType(_.vertices.length/3))(_.indices);delete _.indices,P.push(I.buffer,_.vertices.buffer,_.pickingIds.buffer);const O=nn(_.vertices,I);let q=!0;for(let t=0;t<O.length;t++)O[t]=-O[t],O[t]%1!=0&&(q=!1);if(_.normals=O,b){let t=function(t,e,n,i){const r=t.length/3,o=new Array(4*r),s=[],a=[];for(let t=0;t<r;t++)s[t]=[0,0,0],a[t]=[0,0,0];const l=[0,0,0],u=[0,0,0],c=[0,0,0],h=[0,0],d=[0,0],f=[0,0],p=[0,0,0],m=[0,0,0];function y(e,i,r){rn(l,t,3*e),rn(u,t,3*i),rn(c,t,3*r),on(h,n,2*e),on(d,n,2*i),on(f,n,2*r);const o=u[0]-l[0],y=c[0]-l[0],g=u[1]-l[1],b=c[1]-l[1],v=u[2]-l[2],w=c[2]-l[2],x=d[0]-h[0],k=f[0]-h[0],M=d[1]-h[1],j=f[1]-h[1],A=1/(x*j-k*M);gt(p,(j*o-M*y)*A,(j*g-M*b)*A,(j*v-M*w)*A),gt(m,(x*y-k*o)*A,(x*b-k*g)*A,(x*w-k*v)*A),bt(s[e],s[e],p),bt(s[i],s[i],p),bt(s[r],s[r],p),bt(a[e],a[e],m),bt(a[i],a[i],m),bt(a[r],a[r],m)}for(let t=0,e=i.length;t<e;t+=3)y(i[t+0],i[t+1],i[t+2]);const g=[],b=[],v=[],w=[];let x,k,M;function j(t){rn(v,e,3*t),yt(w,v),k=s[t],yt(g,k),Mt(g,g,function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}(v,v,xt(v,k))),wt(g,g),kt(b,w,k),M=xt(b,a[t]),x=M<0?-1:1,o[4*t]=g[0],o[4*t+1]=g[1],o[4*t+2]=g[2],o[4*t+3]=x}for(let t=0,e=i.length;t<e;t+=3)j(i[t+0]),j(i[t+1]),j(i[t+2]);return o}(_.vertices,_.normals,_.uvs,I);t=function(t,e){const n=new Float32Array(e.length),i=[],r=[],o=[];for(let s=0;s<e.length;s+=4){const a=s/4*3;gt(r,t[a]||0,t[a+1]||0,t[a+2]||0),At(i,e[s]||0,e[s+1]||0,e[s+2]||0,e[s+3]||0),en(o,r,i),jt(n.subarray(s,s+4),o)}return n}(_.normals,t),_.tangents=t,P.push(t.buffer),delete _.normals}if(_.normals&&(_.normals=q?new Int8Array(_.normals):new Float32Array(_.normals),P.push(_.normals.buffer)),_.uvs){const t=_.uvs;_.uvs=new Float32Array(t),P.push(_.uvs.buffer)}const C=function(t,e,n,i){const r={};if(T(e.polygonFill)){const o=m(e.polygonFill),s=new Uint8Array(4*i.length);s.fill(255);for(let e=0;e<i.length;e++){const r=t[i[e]],a=r.properties||{};a.$layer=r.layer,a.$type=r.type;let l=o(n,a);delete a.$layer,delete a.$type,gi.normalizeColor(El,l),s[4*e]=El[0],s[4*e+1]=El[1],s[4*e+2]=El[2],s[4*e+3]=El[3]}r.aColor=s}if(T(e.polygonOpacity)){const o=p(e.polygonOpacity),s=new Uint8Array(i.length);s.fill(255);for(let e=0;e<i.length;e++){const r=t[i[e]],a=r.properties||{};a.$layer=r.layer,a.$type=r.type;const l=o(n,a);delete a.$layer,delete a.$type,s[e]=255*l}r.aOpacity=s}return r}(t,a,l,_.featureIndexes),R={data:{data:{aPosition:_.vertices,aNormal:_.normals,aTexCoord0:_.uvs,aTangent:_.tangents,aPickingId:_.pickingIds},indices:I,properties:{maxAltitude:_.maxAltitude}},buffers:P};return _.featureIds.length?(R.data.featureIds=_.featureIds,P.push(R.data.featureIds.buffer)):R.data.featureIds=[],C.aColor&&(R.data.data.aColor=C.aColor,R.buffers.push(C.aColor.buffer)),C.aOpacity&&(R.data.data.aOpacity=C.aOpacity,R.buffers.push(C.aOpacity.buffer)),R.data.pickingIdIndiceMap=_l.generatePickingIndiceIndex(R.data.data.aPickingId,R.data.indices),R}const El=[];function Ll(t,e,n,i,{altitudeScale:r,altitudeProperty:o,defaultAltitude:s,heightProperty:a,minHeightProperty:l,defaultHeight:u,bottom:c}){const h=c,d=e/t[0].extent,p=2*function(t,e){let n=0;for(let i=0,r=t.length;i<r;i++){const r=t[i];if(k(r.geometry[0][0])){const t=3*r.geometry.length;n+=e?2*t-6:t}else for(let t=0,i=r.geometry.length;t<i;t++){let i=3*r.geometry[t].length;3===r.type&&(i-=3),n+=e?2*i-6:i}}return n}(t)+3*t.length*2,m=[],y=new Int16Array(p),g=new Uint8Array(y.length/3*4);f(n)&&(n=js.compileFilter(n));const b=[];function v(t,n,i){const r=n-t,o=y.subarray(t,n),s=y.subarray(n,n+r);s.set(o);for(let t=2,e=s.length;t<e;t+=3)s[t]=o[t]-i;const a=t/3,l=r/3;let u,c;for(let t=a,n=l+a;t<n;t++)t<n-1?(u=t,c=t+1):(u=t,c=a),at(y,u,c,e)||(b.push(u,c),h&&b.push(u+l,c+l),Dl(y,u,e)||b.push(u,u+l));return n+r}let w=0,x=0;const M="__fea_idx".trim(),j=[];for(let e=0,c=t.length;e<c;e++){const c=t[e],h=c.geometry;if(n){let t;t="function"==typeof n?n(c&&c.properties):n,gi.normalizeColor(j,t)}else gt(j,255,255,255);const f=w/3*4,{altitude:p,height:k}=_l.getFeaAltitudeAndHeight(c,r,o,s,a,u,l);x=Math.max(Math.abs(p),x);let A=w;for(let t=0,e=h.length;t<e;t++){let e=h[t];const n=e.length;e[0][0]===e[n-1][0]&&e[0][1]===e[n-1][1]&&(e=e.slice(0,n-1)),w=st(y,A,e,d,p),w=v(A,w,k*d),A=w}const F=A/3*4;for(let t=f;t<F;t+=4)g[t]=j[0],g[t+1]=j[1],g[t+2]=j[2],g[t+3]=255*(i||1);const T=b.length-m.length;for(let t=0;t<T;t++)m.push(c[M])}const A=b.reduce((t,e)=>Math.max(t,e),0),F=new(_l.getIndexArrayType(A))(b),T=_l.getUnsignedArrayType(t.length);return{aPosition:new(_l.getPosArrayType(Math.max(512,x)))(y),indices:F,aPickingId:new T(m),aColor:g}}function Dl(t,e,n){const i=t[3*e],r=t[3*e+1];return i<0||i>n||r<0||r>n}function $l(t,e,n,i){const r=Ll(t,e,n.lineColor,n.lineOpacity,i),o=[r.aPosition.buffer,r.indices.buffer,r.aPickingId.buffer],s=r.indices;return delete r.indices,{data:{data:r,indices:s},buffers:o}}\n/*!\n        Feature Filter by\n\n        (c) mapbox 2016 and maptalks 2018\n        www.mapbox.com | www.maptalks.org\n        License: MIT, header required.\n    */const Ul=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Wl(t){if(!t)return"true";const e=t[0];if(t.length<=1)return"any"===e?"false":"true";return`(${"=="===e?Hl(t[1],t[2],"===",!1):"!="===e?Hl(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?Hl(t[1],t[2],e,!0):"any"===e?Vl(t.slice(1),"||"):"all"===e?Vl(t.slice(1),"&&"):"none"===e?Yl(Vl(t.slice(1),"||")):"in"===e?Bl(t[1],t.slice(2)):"!in"===e?Yl(Bl(t[1],t.slice(2))):"has"===e?Zl(t[1]):"!has"===e?Yl(Zl(t[1])):"contains"===e?function(t,e,n){const i=Jl(t);return void 0!==n?`(${i} + \'\').indexOf("${e}") === ${n}`:`(${i} + \'\').indexOf("${e}") >= 0`}(t[1],t[2],t[3]):"true"})`}function Jl(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function Hl(t,e,n,i){if("object"==typeof(r=t)&&r&&t.op)return function(t,e,n,i){const r=t.property,o=t.op;let s=Jl(r);return"length"!==o?(console.error(`not support ${o} op`),"false"):(s=`((${s}+=\'\').length)`,Gl(s,r,e,n,i))}(t,e,n,i);var r;return Gl(Jl(t),t,e,n,i)}function Gl(t,e,n,i,r){const o="$type"===e?Ul.indexOf(n):JSON.stringify(n);return(r?`typeof ${t}=== typeof ${o}&&`:"")+t+i+o}function Vl(t,e){return t.map(Wl).join(e)}function Bl(t,e){"$type"===t&&(e=e.map(t=>Ul.indexOf(t)));const n=JSON.stringify(e.sort(Xl)),i=Jl(t);return e.length<=200?`${n}.indexOf(${i}) !== -1`:`function(v, a, i, j) {\\n        while (i <= j) { var m = (i + j) >> 1;\\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\\n        }\\n    return false; }(${i}, ${n},0,${e.length-1})`}function Zl(t){return"$id"===t?\'"id" in f\':JSON.stringify(t)+" in p"}function Yl(t){return`!(${t})`}function Xl(t,e){return t<e?-1:t>e?1:0}const Kl="__original_properties",Ql="__fn-type_properties";class tu{constructor(t,e,n,i,r){this.id=t,this.options=e,this.upload=n,this.Pt(e.style),this.requests={},this.It=i,this.Ot=0,this.loadings=r}updateStyle(t,e){this.options.style=t,this.Ot=t.styleCounter,this.Pt(t),e()}updateOptions(t,e){this.options=w(this.options,t),e()}loadTile(t,e){const n=this.loadings,i=t.tileInfo.url,r=this.options.debugTile;if(r){const{x:n,y:i,z:o}=t.tileInfo;let s=!1;for(let t=0;t<r.length;t++)if(n===r[t].x&&i===r[t].y&&o===r[t].z){s=!0;break}if(!s)return void e()}n[i]?n[i].push({context:t,callback:e,ref:this}):(n[i]=[{context:t,callback:e,ref:this}],this.requests[i]=this.getTileFeatures(t,(e,r,o,s)=>{const a=n[i];if(delete n[i],this.checkIfCanceled(i))return delete this.requests[i],void this.qt(a,null,{canceled:!0});if(delete this.requests[i],this.options.debug&&r)for(let e=0;e<r.length;e++)r[e]._debug_info={index:e,id:r[e].id,tileId:t.tileInfo.id};if(e)this.qt(a,e);else if(r&&r.length){if(a)for(let t=0;t<a.length;t++)this.Ct.call(a[t].ref,a[t].context,a[t].callback,i,o,r,s)}else this.qt(a)}))}Ct(t,e,n,i,r,o){this.Rt(i,r,t).then(n=>{n.canceled?e(null,{canceled:!0}):(n.data.style=t.styleCounter,o&&w(n.data,o),e(null,n.data,n.buffers))}).catch(t=>{e(t)})}abortTile(t,e){delete this.requests[t],this.Nt(t),e()}Nt(t){const e=this.loadings[t];if(e)for(let t=0;t<e.length;t++)e[t].callback(null,{canceled:!0});delete this.loadings[t]}qt(t,e,n){if(t)for(let i=0;i<t.length;i++)t[i].callback(e,n)}checkIfCanceled(t){return!this.requests[t]}onRemove(){this.loadings={}}fetchIconGlyphs(t,e,n){this.upload("fetchIconGlyphs",{icons:t,glyphs:e},null,n)}Rt(t,e,n){if(!e.length)return Promise.resolve({data:null,buffers:[]});const{glScale:i,tileInfo:r}=n,o=!this.options.style.style.length&&!this.options.style.featureStyle.length;let s=this.pluginConfig.slice(0);o&&(s=this.Et(t)),this.featurePlugins&&F(s,this.featurePlugins);const a={};for(let t=0;t<s.length;t++)au(e,n.tileInfo.z,s[t],a);const l=[],u=[];for(let t=0;t<e.length;t++){const n=e[t],i=a[t];if(i){u.fill(null);let t=0;for(const e in i){let r=0;const o=i[e].values();for(const t of o){let i=u[r];i||(i=hu(n),u[r]=i),i.properties[e]=t,r++}r>t&&(t=r)}for(let e=0;e<t;e++)l.push(u[e])}else l.push(n)}const c=(e=l)[0].extent,h=r.z,d={x:r.extent2d.xmin*i,y:r.extent2d.ymax*i},f=[],p=[],m=[],y=this.options,g=[],b={},v=[Promise.resolve(n.styleCounter)];let x=0,k=-1;const M=[];let j=!1;for(let t=0;t<s.length;t++){k++;const i=s[t];i.type!==x&&(k=0,x=i.type);const a=0===i.type?f:p;if(i.symbol&&!1===i.symbol.visible){a[k]=null;continue}pu(i.symbol,M,t),j=j||M[t]&&M[t].size>0;const{tileFeatures:l,tileFeaIndexes:u}=this.Lt(h,i.type,i.filter,e,b,t);if(!l.length){a[k]=null;continue}const y=u[u.length-1],w=_l.getIndexArrayType(y);a[k]={styledFeatures:new w(u)},m.push({idx:t,typeIdx:k}),g.push(a[k].styledFeatures.buffer);const A={extent:c,zoom:h,tilePoint:d,...n};if(this.options.debugTile){const t=this.options.debugTile;for(let e=0;e<t.length;e++){const{x:n,y:i,z:o}=t[e];if(r.x===n&&r.y===i&&r.z===o){A.debugIndex=t[e].index;break}}}let F=this.Dt(l,i,A);o&&(F=F.then(t=>{if(!t)return null;if(t.data)t.data.layer=l[0].layer;else if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e]&&t[e].data&&(t[e].data.layer=l[0].layer);return t})),v.push(F)}return Promise.all(v).then(([n,...i])=>{function r(t,e){if(void 0===t.data.ref&&(t.data.type=s[m[e].idx].renderPlugin.dataConfig.type,t.data.filter=s[m[e].idx].filter.def,t.buffers&&t.buffers.length))for(let e=0;e<t.buffers.length;e++)g.push(t.buffers[e])}if(n!==this.Ot)return{canceled:!0};for(let t=0;t<i.length;t++){if(!i[t])continue;const e=i[t],n=0===s[m[t].idx].type?f:p;if(Array.isArray(e)){const i=[];for(let n=0;n<e.length;n++)e[n]&&(r(e[n],t),(void 0===e[n].data.ref||e[e[n].data.ref])&&i.push(e[n].data));i.length&&(n[m[t].typeIdx].data=i)}else r(e,t),n[m[t].typeIdx].data=e.data}const o={},a=t;if(y.features||y.schema||j){let t,n=!1;for(let i=0,r=e.length;i<r;i++)if(t=e[i],a[t.layer].properties||(a[t.layer].properties=iu(t.properties)),t&&(y.features||j&&b[i]))if("id"===y.features)o[i]=t.id;else{y.pickingGeometry||delete t.geometry,delete t.extent,delete t.properties.$layer,delete t.properties.$type,delete t.__index;const e=t.originalFeature;if(e){const e=t.properties,n=w({},t.originalFeature);delete e[Kl],n.customProps=w({},e),t=n}const r=w({},t);if(!y.features){const r=b[i];for(let i=0;i<r.length;i++){const r=M[i];r&&r.forEach(i=>{const r=e?e.properties:t.properties;r[Ql]||(r[Ql]=new Set),r[Ql].add(i),n=!0})}}o[i]=r}if(n)for(const t in o){const e=o[t];if(e.properties[Ql]){const t=e.properties[Ql];delete e.properties[Ql];for(const n in e.properties)t.has(n)||delete e.properties[n]}}}return{data:{schema:a,data:f,featureData:p,extent:c,features:o},buffers:g}}).catch(t=>{console.error(t)})}Dt(t,e,n){let i=t;const r=e.renderPlugin.dataConfig,o=e.symbol,s=this.options.tileSize,{extent:a,glScale:l,zScale:u,zoom:c,tilePoint:h,pointAtTileRes:d}=n,f=a/s,p=r.type,m=n.debugIndex;let y=w({},r,{EXTENT:a,zoom:c,debugIndex:m,features:this.options.features});if("3d-extrusion"===p){const t=ru(o);return t&&(r.uv=1,2===t&&(r.tangent=1)),Promise.all([Promise.resolve(Nl(i,r,a,h,l,u,this.options.tileSize/a,o,c,m))])}if("3d-wireframe"===p)return Promise.all([Promise.resolve($l(i,a,o,r))]);if("point"===p){y=w(y,{requestor:this.fetchIconGlyphs.bind(this),altitudeToTileScale:u*a/this.options.tileSize/l});const t=Wa.splitPointSymbol(o),e=_s.genFnTypes(t[0]);return Wa.needMerge(t[0],e,c)&&(i=Wa.mergeLineFeatures(i,t[0],e,c)),Promise.all(t.map((t,n)=>(0===n?y.fnTypes=e:delete y.fnTypes,new Wa(i,t,y).load(f))))}if("native-point"===p){const t=u*a/this.options.tileSize/l;return y.altitudeToTileScale=t,ou(i,o,y,ll,a/s)}if("line"===p)return y=w(y,{requestor:this.fetchIconGlyphs.bind(this),tileRatio:f}),ou(i,o,y,Ya);if("native-line"===p)return ou(i,o,y,sl);if("fill"===p)return y=w(y,{requestor:this.fetchIconGlyphs.bind(this)}),ou(i,o,y,ml);if("line-extrusion"===p){delete o.lineGradientProperty,o.lineJoin="miter",o.lineCap="butt";const t=ru(o);if(t&&(r.uv=1,2===t&&(r.tangent=1)),y=w(y,{tileSize:s,zScale:u,glScale:l}),t){const t=[];if(!1!==r.top){const e=w({},y);e.side=!1,t.push(new rl(i,o,e))}return!1!==r.side&&(y.side=!0,y.top=!1,t.push(new rl(i,o,y))),Promise.all(t.map(t=>t.load()))}return Promise.all([new rl(i,o,y).load()])}if("circle"===p)return ou(i,o,y,gl);if("round-tube"===p||"square-tube"===p){const t="round-tube"===p?bl:jl;return y=w(y,{requestor:this.fetchIconGlyphs.bind(this),radialSegments:"round-tube"===p?r.radialSegments||8:4,pointAtTileRes:d,tileRatio:f,isTube:!0}),ou(i,o,y,t)}return Promise.resolve([])}Lt(t,e,n,i,r,o){const s="__fea_idx".trim(),a=[],l=[],u=i.length;for(let c=0;c<u;c++)if((1===e||void 0===i[c].id||!this.styledFeatures[i[c].id])&&((!n.def||"default"===n.def)&&!r[c]||!0===n.def||n.def&&(void 0!==n.def.condition||Array.isArray(n.def))&&n(i[c],t))){const t=i[c];if(void 0===t[s]&&(t[s]=c),r[c]||(r[c]=[]),r[c].push(o),l.push(t),a.push(c),1===e)break}return{tileFeatures:l,tileFeaIndexes:a}}Pt(t){const{style:e,featureStyle:n}=t,i={};n.forEach(t=>{Array.isArray(t.id)?(t.id.forEach(t=>{i[t]=1}),t.filter=["in","$id",...t.id]):(i[t.id]=1,t.filter=["==","$id",t.id])});const r=js.compileStyle(e);for(let t=0;t<e.length;t++)r[t].filter&&(r[t].filter.def=e[t].filter?e[t].filter.value||e[t].filter:void 0),r[t].type=0;const o=[],s=js.compileStyle(n);for(let t=0;t<n.length;t++)s[t].type=1,s[t].filter.def=n[t].filter?n[t].filter.value||n[t].filter:void 0,s[t].renderPlugin&&o.push(s[t]);this.pluginConfig=r,this.featurePlugins=o,this.styledFeatures=i}Et(t){let e=this.$t;this.$t||(e=this.$t={});const n=["","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"],i=[];for(const o in t){const s=o;if(!e[o]){const i=[];for(let e=0;e<t[o].types.length;e++){const a=t[o].types[e],l=["all",["==","$layer",s],["==","$type",n[a]]],u={filter:(r=l,new Function("f","var p = (f && f.properties || {}); return "+Wl(r))),renderPlugin:eu(a),symbol:nu(a)};u.filter.def=l,u.type=0,i.push(u)}e[s]=i}i.push(...e[s])}var r;return i}}function eu(t){switch(t){case 1:return{type:"native-point",dataConfig:{type:"native-point",only2D:!0}};case 2:return{type:"native-line",dataConfig:{type:"native-line",only2D:!0}};case 3:return{type:"fill",dataConfig:{type:"fill",only2D:!0}}}return null}function nu(t){switch(t){case 1:return{markerFill:"#f00",markerSize:10};case 2:return{lineColor:"#fff"};case 3:return{polygonFill:"#00f",polygonOpacity:.4}}return null}function iu(t){if(Array.isArray(t)||!j(t))return{};const e={};for(const n in t){const i=t[n];x(i)?e[n]="string":k(i)?e[n]="number":!0===i||!1===i?e[n]="boolean":Array.isArray(i)?e[n]="array":e[n]="object"}return e}function ru(t){if(!t)return 0;let e=0;for(const n in t){if(("normalTexture"===n||"bumpTexture"===n)&&t[n])return 2;if(n.indexOf("Texture")>0&&t[n])e=1;else if(j(t[n])){const i=ru(t[n]);if(2===i)return i;1===i&&(e=1)}}return e}function ou(t,e,n,i,r){const o={},s=Array.isArray(e)?e:[e];let a=-1;for(let t=0;t<s.length;t++)o[t]=su(s[t]),!o[t]&&s[t]&&-1===a&&(a=t);const l=[];for(let e=0;e<s.length;e++)s[e]&&(s[e].index={index:e},o[e]||e===a?l.push(new i(t,s[e],n).load(r)):l.push({data:{ref:a,symbolIndex:{index:e}}}));return Promise.all(l)}function su(t){if(!t)return 0;for(const e in t)if(T(t[e]))return 1;return 0}function au(t,e,n,i){const r=n.customProperties;if(!r)return t;if(r)for(let t=0;t<r.length;t++)r[t].fn=js.compileFilter(r[t].filter);for(let n=0;n<r.length;n++)for(let o=0,s=t.length;o<s;o++)if(r[n].fn(t[o],e))for(const t in r[n].properties){const e=r[n].properties[t];A(e)||(i[o]||(i[o]={}),i[o][t]||(i[o][t]=new Set),i[o][t].add(e))}}const lu={get:(t,e)=>e in t?t[e]:t.originalFeature[e],has:(t,e)=>e in t||e in t.originalFeature},uu={get:function(t,e){return e in t?t[e]:t[Kl][e]},has:(t,e)=>e in t||e in t[Kl]},cu={};function hu(t){const e={};e.originalFeature=t;const n=new Proxy(e,lu);return n.properties=new Proxy({},uu),n.properties[Kl]=t.properties||cu,n}function du(t,e,n){t[e]||(t[e]=new Set),t[e].add(n)}const fu=[];function pu(t,e,n){if(!t)return fu;for(const i in t){if(!t[i]||!gi.checkIfZoomFnTypeSymbol(i))continue;if(T(t[i]))du(e,n,t[i].property);else{if("lineGradientProperty"===i){du(e,n,t[i]);continue}if("textName"===i)if(x(t[i])){const r=Es.resolveVarNames(t[i]);if(r)for(let t=0;t<r.length;t++)du(e,n,r[t])}else if(js.isExpression(t[i])){const r=[];Es.resolveExpVarNames(r,t[i]);for(let t=0;t<r.length;t++)du(e,n,r[t])}}const r=t[i].stops;if(r&&r.length)for(let t=0;t<r.length;t++)T(r[t][1])&&du(e,t,r[t][1].property)}return e[n]}function mu(t,e){yu(t.geometry,e)}function yu(t,e){if(t)switch(t.type){case"Point":gu(t.coordinates,e);break;case"MultiPoint":case"LineString":bu(t.coordinates,e);break;case"MultiLineString":!function(t,e){for(let n=0,i=t.length;n<i;n++)bu(t[n],e)}(t.coordinates,e);break;case"Polygon":vu(t.coordinates,e);break;case"MultiPolygon":!function(t,e){for(let n=0,i=t.length;n<i;n++)vu(t[n],e)}(t.coordinates,e);break;case"GeometryCollection":const n=t.geometries.length;for(let i=0;i<n;i++)yu(t.geometries[i],e)}}function gu(t,e){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function bu(t,e){for(let n=0,i=t.length;n<i;n++)gu(t[n],e)}function vu(t,e){t.length&&bu(t[0],e)}class wu extends tu{constructor(t,e,n,i,r,o){super(t,e,n,i,r),(e=e||{}).extent||(e.extent=8192),this.zoomOffset=0,e.tileSize&&(this.zoomOffset=-function(t){if(Math.log2)return Math.log2(t);const e=Math.log(t)*Math.LOG2E,n=Math.round(e);return Math.abs(n-e)<1e-14?n:e}(e.tileSize/256)),this.setData(e.data,o)}setData(t,e){if(delete this.index,!t)return void e();const n={maxZoom:24,tolerance:this.options.simplifyTolerance,extent:this.options.extent,buffer:this.options.tileBuffer||64,hasAltitude:!!this.options.hasAltitude,debug:0,lineMetrics:!0,indexMaxZoom:5,indexMaxPoints:1e5,disableFilter:!0};if(this.options.projection&&(n.projection=this.options.projection),x(t)&&"{"!=t.substring(0,1)||t.url)S.getJSON(t.url?t.url:t,t.url?t:{},(t,i)=>{if(t&&e(t),!i)return void e(null,{extent:null,idMap:{}});const r=i,{first1000:o,idMap:s}=this.Ut(r);this.Wt(o,s,r,n,e)});else{"string"==typeof t&&(t=JSON.parse(t));const i=Array.isArray(t)?t:t.features;let r=i;i&&i.length>1e3&&(r=i.slice(0,1e3)),this.Wt(r,null,t,n,e)}}Wt(t,e,n,i,r){try{const o=t&&t.length?function(t){let e=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const n=t.features.length;for(let i=0;i<n;i++)mu(t.features[i],e);break;case"Feature":mu(t,e);break;default:yu(t,e)}return e}({type:"FeatureCollection",features:t}):null;this.index=function(t,e){return new rt(t,e)}(n,this.options.geojsonvt||i),r(null,{extent:o,idMap:e})}catch(t){console.warn(t),r({error:t.message})}}Ut(t){const e=[],n={};let i=0;function r(t){t&&("Feature"!==t.type||t.geometry)&&(void 0!==t.id&&null!==t.id||(t.id=i++),n[t.id]=w({},t),t.geometry?(n[t.id].geometry=w({},t.geometry),n[t.id].geometry.coordinates=null):t.coordinates&&(n[t.id].coordinates=null),e.length<1e3&&e.push(t))}return Array.isArray(t)?t.forEach(t=>{r(t)}):t.features&&t.features.forEach(t=>{r(t)}),{first1000:e,idMap:n}}getTileFeatures(t,e){const n=t.tileInfo,i=[];if(!this.index)return setTimeout((function(){e({loading:!0})}),1),1;const r=this.index.getTile(n.z+this.zoomOffset,n.x,n.y);if(!r||0===r.features.length)return setTimeout((function(){e(null,i,[])}),1),1;const o=[];for(let t=0,e=r.features.length;t<e;t++){const e=r.features[t];let n=e.layer;void 0===n&&(n="0"),o[n]={types:{}};o[n].types[e.type]=1,e.tags=e.tags||{},e.geometry.converted||(_l.convertGeometry(e),e.geometry.converted=1),i.push({type:e.type,layer:n,id:e.id,geometry:e.geometry,properties:e.tags,extent:this.options.extent})}for(const t in o)o[t].types=Object.keys(o[t].types).map(t=>+t);return setTimeout((function(){e(null,i,o)}),1),1}onRemove(){super.onRemove(),delete this.index}}var xu={\n/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nread:function(t,e,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,u=l>>1,c=-7,h=n?r-1:0,d=n?-1:1,f=t[e+h];for(h+=d,o=f&(1<<-c)-1,f>>=-c,c+=a;c>0;o=256*o+t[e+h],h+=d,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=i;c>0;s=256*s+t[e+h],h+=d,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),o-=u}return(f?-1:1)*s*Math.pow(2,o-i)},write:function(t,e,n,i,r,o){var s,a,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,p=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=c?(a=0,s=c):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[n+f]=255&a,f+=p,a/=256,r-=8);for(s=s<<r|a,u+=r;u>0;t[n+f]=255&s,f+=p,s/=256,u-=8);t[n+f-p]|=128*m}},ku=ju,Mu=xu;function ju(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ju.Varint=0,ju.Fixed64=1,ju.Bytes=2,ju.Fixed32=5;var Au="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Fu(t){return t.type===ju.Bytes?t.readVarint()+t.pos:t.pos+1}function Tu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function zu(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function Su(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function _u(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Pu(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Iu(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Ou(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function qu(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Cu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Ru(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Nu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Eu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Lu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Du(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ju.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Eu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Du(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Eu(this.buf,this.pos)+4294967296*Eu(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=Eu(this.buf,this.pos)+4294967296*Du(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Mu.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Mu.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(t,e,n){var i,r,o=n.buf;if(r=o[n.pos++],i=(112&r)>>4,r<128)return Tu(t,i,e);if(r=o[n.pos++],i|=(127&r)<<3,r<128)return Tu(t,i,e);if(r=o[n.pos++],i|=(127&r)<<10,r<128)return Tu(t,i,e);if(r=o[n.pos++],i|=(127&r)<<17,r<128)return Tu(t,i,e);if(r=o[n.pos++],i|=(127&r)<<24,r<128)return Tu(t,i,e);if(r=o[n.pos++],i|=(1&r)<<31,r<128)return Tu(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Au?function(t,e,n){return Au.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){var i="",r=e;for(;r<n;){var o,s,a,l=t[r],u=null,c=l>239?4:l>223?3:l>191?2:1;if(r+c>n)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[r+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=t[r+1],s=t[r+2],128==(192&o)&&128==(192&s)&&((u=(15&l)<<12|(63&o)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=t[r+1],s=t[r+2],a=t[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((u=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),r+=c}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ju.Bytes)return t.push(this.readVarint(e));var n=Fu(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ju.Bytes)return t.push(this.readSVarint());var e=Fu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ju.Bytes)return t.push(this.readBoolean());var e=Fu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ju.Bytes)return t.push(this.readFloat());var e=Fu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ju.Bytes)return t.push(this.readDouble());var e=Fu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ju.Bytes)return t.push(this.readFixed32());var e=Fu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ju.Bytes)return t.push(this.readSFixed32());var e=Fu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ju.Bytes)return t.push(this.readFixed64());var e=Fu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ju.Bytes)return t.push(this.readSFixed64());var e=Fu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ju.Varint)for(;this.buf[this.pos++]>127;);else if(e===ju.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ju.Fixed32)this.pos+=4;else{if(e!==ju.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Lu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Lu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Lu(this.buf,-1&t,this.pos),Lu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Lu(this.buf,-1&t,this.pos),Lu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,i;t>=0?(n=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn\'t fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;if(e.buf[e.pos++]|=n|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var i,r,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):r=i;continue}if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(t[n++]=239,t[n++]=191,t[n++]=189,r=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&zu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Mu.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Mu.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&zu(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,ju.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Su,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,_u,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Ou,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Pu,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Iu,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,qu,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Cu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Ru,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Nu,e)},writeBytesField:function(t,e){this.writeTag(t,ju.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ju.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ju.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ju.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ju.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ju.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ju.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ju.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ju.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ju.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var $u=Et,Uu=Wu;function Wu(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this.Jt=t,this.Ht=-1,this.Gt=i,this.Vt=r,t.readFields(Ju,this,e)}function Ju(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){var n=t.readVarint()+t.pos;for(;t.pos<n;){var i=e.Gt[t.readVarint()],r=e.Vt[t.readVarint()];e.properties[i]=r}}(n,e):3==t?e.type=n.readVarint():4==t&&(e.Ht=n.pos)}function Hu(t){for(var e,n,i=0,r=0,o=t.length,s=o-1;r<o;s=r++)e=t[r],i+=((n=t[s]).x-e.x)*(e.y+n.y);return i}Wu.types=["Unknown","Point","LineString","Polygon"],Wu.prototype.loadGeometry=function(){var t=this.Jt;t.pos=this.Ht;for(var e,n=t.readVarint()+t.pos,i=1,r=0,o=0,s=0,a=[];t.pos<n;){if(r<=0){var l=t.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)o+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&a.push(e),e=[]),e.push(new $u(o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&a.push(e),a},Wu.prototype.bbox=function(){var t=this.Jt;t.pos=this.Ht;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,u=-1/0;t.pos<e;){if(i<=0){var c=t.readVarint();n=7&c,i=c>>3}if(i--,1===n||2===n)(r+=t.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,l,a,u]},Wu.prototype.toGeoJSON=function(t,e,n){var i,r,o=this.extent*Math.pow(2,n),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),u=Wu.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e],i=180-360*(n.y+a)/o;t[e]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];c(l=h);break;case 2:for(i=0;i<l.length;i++)c(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var n,i,r=[],o=0;o<e;o++){var s=Hu(t[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(n&&r.push(n),n=[t[o]]):n.push(t[o]))}n&&r.push(n);return r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)c(l[i][r])}1===l.length?l=l[0]:u="Multi"+u;var d={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Gu=Uu,Vu=Bu;function Bu(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this.Jt=t,this.Gt=[],this.Vt=[],this.Bt=[],t.readFields(Zu,this,e),this.length=this.Bt.length}function Zu(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e.Bt.push(n.pos):3===t?e.Gt.push(n.readString()):4===t&&e.Vt.push(function(t){var e=null,n=t.readVarint()+t.pos;for(;t.pos<n;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(n))}Bu.prototype.feature=function(t){if(t<0||t>=this.Bt.length)throw new Error("feature index out of bounds");this.Jt.pos=this.Bt[t];var e=this.Jt.readVarint()+this.Jt.pos;return new Gu(this.Jt,e,this.extent,this.Gt,this.Vt)};var Yu=Vu;function Xu(t,e,n){if(3===t){var i=new Yu(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var Ku=function(t,e){this.layers=t.readFields(Xu,{},e)};class Qu extends tu{constructor(t,e,n,i,r,o){super(t,e,n,i,r),e=e||{},o()}getTileFeatures(t,e){const n=t.tileInfo.url,i=t.fetchOptions;if(this.It.has(n)){const{err:t,data:i}=this.It.get(n);return setTimeout(()=>{this.Zt(n,t,i,e)},1)}return S.getArrayBuffer(n,i,(t,i)=>{t?t.loading||this.It.add(n,{err:t,data:i&&i.data}):i&&i.data&&this.It.add(n,{err:null,data:i.data}),this.Zt(n,t,i&&i.data,e)})}Zt(t,e,n,i){if(e)return void i(e);let r;try{r=new Ku(new ku(n))}catch(e){return void i(e.message,[],[])}const o=[];if(!r.layers)return void i(null,o,[]);const s={};let a;for(const t in r.layers)if(l=r.layers,u=t,Object.prototype.hasOwnProperty.call(l,u)){s[t]={types:{}};const n=s[t].types;for(let i=0,s=r.layers[t].length;i<s;i++)try{a=r.layers[t].feature(i),n[a.type]=1;const e={type:a.type,layer:t,geometry:a.loadGeometry(),properties:a.properties,extent:a.extent};void 0!==a.id&&(e.id=a.id),o.push(e)}catch(e){console.warn("error when load vt geometry:",e)}}var l,u;for(const t in s)s[t].types=Object.keys(s[t].types).map(t=>+t);i(null,o,s,{byteLength:n.byteLength})}abortTile(t,e){const n=this.requests[t];delete this.requests[t],n&&n.abort&&n.abort(),this.Nt(t),e()}onRemove(){super.onRemove();for(const t in this.requests){const e=this.requests[t];e&&e.abort&&e.abort()}this.requests={}}}let tc=0;const ec=new class{constructor(t){this.max=t,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(t,e){return this.has(t)?(this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t)):(this.data[t]=e,this.order.push(t),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(t){return t in this.data}keys(){return this.order}getAndRemove(t){if(!this.has(t))return null;const e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e}get(t){return this.has(t)?this.data[t]:null}remove(t){return this.has(t)?(delete this.data[t],this.order.splice(this.order.indexOf(t),1),this):this}setMaxSize(t){for(this.max=t;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}}(32);class nc{constructor(t){this.Yt={},this.Xt={},this.workerId=t}addLayer({actorId:t,mapId:e,layerId:n,params:i},r){if(this.Kt(e,n))return;const o=this.Qt(e,n),s=i.type,a=i.options,l=this.send.bind(this,t);this.Yt[o]="GeoJSONVectorTileLayer"===s?new wu(n,a,l,ec,{},r):new Qu(n,a,l,ec,{},r)}removeLayer({mapId:t,layerId:e},n){const i=this.Kt(t,e),r=this.Qt(t,e);delete this.Yt[r],i&&i.onRemove(n)}loadTile({mapId:t,layerId:e,params:n},i){const r=this.Kt(t,e);r&&r.loadTile(n,i)}abortTile({mapId:t,layerId:e,params:n},i){const r=this.Kt(t,e);r&&r.abortTile&&r.abortTile(n.url,i)}removeTile({mapId:t,layerId:e,params:n},i){const r=this.Kt(t,e);r&&r.removeTile(n,i)}updateStyle({mapId:t,layerId:e,params:n},i){const r=this.Kt(t,e);r&&r.updateStyle(n,i)}updateOptions({mapId:t,layerId:e,params:n},i){const r=this.Kt(t,e);r&&r.updateOptions(n,i)}setData({mapId:t,layerId:e,params:n},i){const r=this.Kt(t,e);r&&r.setData(n.data,i)}receive(t){const e=t.callback,n=this.Xt[e];delete this.Xt[e],n&&t.error?n(new Error(t.error)):n&&n(null,t.data)}send(t,e,n,i,r){const o=r?`${t}-${tc++}`:null;r&&(this.Xt[o]=r),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:e,params:n,callback:String(o)},i||[])}Qt(t,e){return`${t}-${e}`}Kt(t,e){const n=this.Qt(t,e);return this.Yt[n]}te(){ec.reset()}}t.initialize=function(){},t.onmessage=function(t,e){const n=t.data;if(this.dispatcher||(this.dispatcher=new nc(t.workerId)),"<response>"===t.type)this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t);else{const i=n.command;this.dispatcher[i]({actorId:t.actorId,mapId:n.mapId,layerId:n.layerId,params:n.params},(t,n,r)=>{t&&404!==t.status&&console.error(i,t),e(t,n,r)})}},Object.defineProperty(t,"ee",{value:!0})}';let L$5=0;function H$5(){return L$5++}const V$5="function"==typeof Object.assign;function U$4(t,...e){if(V$5)return Object.assign(t,...e),t;for(let n=0;n<e.length;n++){const i=e[n];for(const e in i)t[e]=i[e]}return t}function G$4(t){return!q$4(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function W$4(t){return!q$4(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function q$4(t){return null==t}function $$4(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)for(let e=0,i=n.length;e<i;e++)t.push(n[e])}return t.length}function B$4(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function X$4(t,e){let n;return n=e.altitudeToPoint?e.altitudeToPoint(100,t):e.distanceToPointAtRes(100,0,t).x,n/100/100}const Y$3=["GeoJSONVectorTileLayer"];class J$4 extends t__namespace.worker.Actor{constructor(t,e){super(t);const n=e.getMap().id;this.t=e,this.i=n,this.o="vt_"+H$5();const i=e.getJSONType();this.s=Y$3.indexOf(i)>=0,this.l={},this.h=new Qo$1({iconErrorUrl:e.options.iconErrorUrl,maxSize:e.options.maxIconSize});const r=!e.getRenderer().isEnableWorkAround("win-intel-gpu-crash");this.u=new Yo$1((t=>{e.getMap().getRenderer().callInNextFrame(t)}),e.options.glyphSdfLimitPerFrame,r)}initialize(t){t(null)}addLayer(t){const e=this.t,n=e.getWorkerOptions()||{},i=this.o,r=e.getJSONType(),o={mapId:this.i,layerId:i,command:"addLayer",params:{type:r,options:n}};this.s?(void 0===this.l[i]&&(this.l[i]=this.getDedicatedWorker()),this.send(o,null,t,this.l[i])):this.broadcast(o,null,t)}abortTile(t,e){const n=this.o,i={mapId:this.i,layerId:n,command:"abortTile",params:{url:t}};this.s?(void 0===this.l[n]&&(this.l[n]=this.getDedicatedWorker()),this.send(i,null,e,this.l[n])):this.broadcast(i,null,e)}removeLayer(t){const e=this.o,n={mapId:this.i,layerId:e,command:"removeLayer"};this.s?(void 0!==this.l[e]&&this.send(n,null,t,this.l[e]),delete this.l[e]):this.broadcast(n,null,t)}updateStyle(t,e){const n=this.o,i={mapId:this.i,layerId:n,command:"updateStyle",params:t};this.s?void 0!==this.l[n]&&this.send(i,null,e,this.l[n]):this.broadcast(i,null,e)}updateOptions(t,e){const n=this.o,i={mapId:this.i,layerId:n,command:"updateOptions",params:t};this.s?void 0!==this.l[n]&&this.send(i,null,e,this.l[n]):this.broadcast(i,null,e)}loadTile(t,e){const n=U$4({},t);n.tileInfo=function(t){const e={};for(const n in t)null!=t[n]&&(e[n]=t[n].toJSON?t[n].toJSON():t[n]);return e}(t.tileInfo);const i=this.o,r={mapId:this.i,layerId:i,command:"loadTile",params:n},{x:o,y:s}=t.tileInfo;this.send(r,null,e,void 0===this.l[i]?this.workers[(o+s)%this.workers.length].id:this.l[i])}remove(){super.remove(),this.l={}}fetchIconGlyphs({icons:t,glyphs:e},n){this.u.getGlyphs(e,((e,i)=>{if(e)throw e;const r=i.buffers||[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&e.buffers.length&&r.push(...e.buffers),n(null,{icons:e.icons,glyphs:i.glyphs},r)}))}))}setData(t,e){const n=this.o;this.send({mapId:this.i,layerId:n,command:"setData",params:{data:t}},null,e,this.l[n])}p(t){return t.id}}const Z$4={},K$4={collision:!0,fading:!1,fadingDuration:224,fadeInDelay:600,fadeOutDelay:100,uniquePlacement:!1,depthFunc:"always"};class Q$4{constructor(t,e,n){this.m=t,this.v=e,this.A=n||[0,1,0]}draw(t,e,n,i,r){if(this.k||this._(),!this.T){this.T=this.m.buffer(tt$3(i));this.S=this.m.buffer(et$3(i,i/n))}if(i!==this.M){const t=i/n;this.T(tt$3(i)),this.S(et$3(i,t))}this.M=i;let o=this.P;if(!o){const t=this.v.getDevicePixelRatio()>1?2:1;o=this.P=document.createElement("canvas"),o.width=512*t,o.height=64*t;const e=o.getContext("2d");e.font="36px monospace",e.scale(t,t),this.I=this.m.texture({width:o.width,height:o.height,data:o})}const s=o.getContext("2d");s.clearRect(0,0,o.width,o.height),s.fillStyle=`rgba(${this.A.map((t=>255*t)).join()})`,s.fillText(t,20,36),this.I({width:o.width,height:o.height,data:o}),this.k({transform:e,data:this.T,texData:this.O,debugLine:1,primitive:"lines",framebuffer:r||null,image:this.I,count:8}),this.k({transform:e,data:this.S,texData:this.O,debugLine:0,primitive:"triangle strip",framebuffer:r||null,image:this.I,count:4})}delete(){this.I&&(this.I.destroy(),delete this.I),this.O&&(this.O.destroy(),delete this.O),this.T&&(this.T.destroy(),this.S.destroy(),delete this.T,delete this.S),this.k&&(this.k.destroy(),delete this.k)}_(){this.O=this.m.buffer(new Uint8Array([0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1])),this.k=this.m({vert:"\n                attribute vec2 aPosition;\n                attribute vec2 aTexCoord;\n                uniform mat4 transform;\n\n                varying vec2 vTexCoord;\n                void main()\n                {\n                    gl_Position = transform * vec4(aPosition, 0.0, 1.0);\n                    vTexCoord = aTexCoord;\n                }\n            ",frag:"\n                precision mediump float;\n                uniform sampler2D uImage;\n                uniform vec3 uColor;\n                uniform float uOpacity;\n                uniform float uDebugLine;\n\n                varying vec2 vTexCoord;\n\n                void main()\n                {\n                    if (uDebugLine == 1.) {\n                        gl_FragColor = vec4(uColor, 1.0) * uOpacity;\n                    } else {\n                        gl_FragColor = texture2D(uImage, vTexCoord) * uOpacity;\n                    }\n                    gl_FragColor *= gl_FragColor.a;\n                }\n            ",attributes:{aPosition:this.m.prop("data"),aTexCoord:this.m.prop("texData")},uniforms:{transform:this.m.prop("transform"),uColor:this.A,uOpacity:1,uDebugLine:this.m.prop("debugLine"),uImage:this.m.prop("image")},count:this.m.prop("count"),primitive:this.m.prop("primitive"),depth:{enable:!1,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},stencil:{enable:!1},viewport:{x:0,y:0,width:()=>this.v.getRenderer().canvas.width,height:()=>this.v.getRenderer().canvas.height},framebuffer:this.m.prop("framebuffer")})}}function tt$3(t){return new Uint16Array([0,0,0,t,0,t,t,t,t,t,t,0,t,0,0,0])}function et$3(t,e){return new Uint16Array([0,t-64*e,0,t,512*e,t-64*e,512*e,t])}const nt$3=new Uint8Array([0,0,0,1,1,0,1,0,0,1,1,1]),it$3=[];class rt$3{constructor(t,e,i){this.m=t,(this.C=new Q$7({aPosition:nt$3},null,nt$3.length/2,{positionSize:2})).generateBuffers(t),this.F=new yt$6,this.j=[],this.R=0,this.D=e,this.v=i,this._(t)}start(){this.R=0,this.F.clear()}add(t,e,n){const o=this.N(n);o.setUniform("ref",t),set$4(it$3,e,e,1);const s=o.localTransform;fromScaling(s,it$3),mul$5(s,n,s),o.setLocalTransform(s),this.F.addMesh(o)}render(t){this.L.render(this.H,{projViewMatrix:this.v.projViewMatrix},this.F,t)}N(){const t=this.R++;return this.j[t]||(this.j[t]=new ft$6(this.C)),this.j[t]}_(t){const e=this.D,i={viewport:{x:0,y:0,width:()=>e.width,height:()=>e.height},stencil:{enable:!0,mask:255,func:{cmp:"always",ref:(t,e)=>e.ref,mask:255},op:{fail:"replace",zfail:"replace",zpass:"replace"}},depth:{enable:!0,func:"always",mask:!1},colorMask:[!1,!1,!1,!1]};this.H=new ie$5({vert:"\n#define SHADER_NAME TILE_STENCIL_VERT\nattribute vec2 aPosition;\nuniform mat4 projViewModelMatrix;\n\nvoid main()\n{\n    gl_Position = projViewModelMatrix * vec4(aPosition, 0.0, 1.0);\n}\n",frag:"\n#define SHADER_NAME TILE_STENCIL_FRAG\nvoid main()\n{\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 0.1);\n}\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:i}),this.L=new N$8(t)}remove(){this.C.dispose();for(let t=0;t<this.j.length;t++)this.j[t].dispose();this.j.length=0,this.H.dispose()}}const ot$3="__fea_idx".trim();function st$3(t,e,n,i,r){const o={};if(function(t){if(!t)return!1;for(const e in t)if(null!=t[e])return!0;return!1}(t))for(let s=0,a=(e||t).length;s<a;s++){let a=e?t[e[s]]:t[s];"id"===r.options.features&&r.getFeature&&(a=r.getFeature(a),a.layer=n),a.customProps&&(a=ct$3(a)),o[e?e[s]:a[ot$3]]={feature:a,symbol:i}}return o}const at$3="__original_properties",lt$3={get:function(t,e){return e in t?t[e]:t[at$3][e]},has:function(t,e){return e in t||e in t[at$3]}},ht$3={};function ct$3(t){const e=t.properties;if(e&&e[at$3])return t;const n=t.customProps;return n[at$3]=e||ht$3,t.properties=new Proxy(n,lt$3),t}const ut$3=[],ft$3=[0,0,0,0],dt$3=new t__namespace.Point(0,0),pt$3={color:ft$3,depth:1,stencil:0},mt$3=t=>t.isTerrainSkin(),yt$3=t=>t.isTerrainVector();class gt$3 extends t__namespace.renderer.TileLayerCanvasRenderer{supportRenderMode(){return!0}constructor(t){super(t),this.ready=!1,this.V=0,this.U={},this.G={},this.W={}}getTileLevelValue(t,e){if(this.isBackTile(t.id)){const n=t.z;return n-e>=0?0:e-n}return 0}getWorkerConnection(){return this.q}getStyleCounter(){return this.V}setStyle(t){if(this.$&&this.$.update(),this.q){this.V++,this.B();const e=this.layer.X();e.styleCounter=this.V,this.q.updateStyle(e,(e=>{if(e)throw new Error(e);t||(this.Y=!0,this.J(),this.setToRedraw()),this.layer.fire("refreshstyle")}))}else this.J()}B(){if(this.Z)for(const t in this.Z){const e=this.Z[t];e&&this.deleteTile(e)}this.Z=this.tilesInView;const t=this.tileCache;for(const e in this.Z){const n=this.Z[e];n&&n.info&&t.getAndRemove(n.info.id)}t.reset(),this.tilesInView={},this.tilesLoading={},this.U={},this._parentTiles=[],this._childTiles=[]}updateOptions(t){this.q&&this.q.updateOptions(this.layer.getWorkerOptions(),(e=>{if(e)throw new Error(e);(t.features||t.pickingGeometry||t.altitudeProperty)&&(this.clear(),this.K(),this.J()),this.setToRedraw()}))}updateSceneConfig(t,e,n){const i=0===t?this.tt():this.et();if(!i||!i[e])return;this.Y=!0;const r=this.layer.X(),o=this.layer.nt(t,r);i[e].config=o[e].renderPlugin,i[e].updateSceneConfig({sceneConfig:n}),this.setToRedraw()}updateDataConfig(t,e,n,i){const r=0===t?this.tt():this.et();r&&r[e]&&(this.Y=!0,r[e].updateDataConfig(n,i)?this.setStyle():this.setToRedraw())}updateSymbol(t,e,n){const i=0===t?this.tt():this.et();if(!i||!i[e])return!1;const r=this.layer.X(),o=this.layer.nt(t,r),s=i[e];s.style=o[e];const a=s.updateSymbol(n,o[e].symbol);return!a&&function t(e){if(Array.isArray(e)){const n=e;for(let e=0;e<n.length;e++)if(t(n[e]))return!0}for(const t in e)if(isFunctionDefinition(e[t])||ur$3.isExpression(e[t]))return!0;return!1}(n)&&this.setStyle(!0),this.setToRedraw(),a}needToRedraw(){const t=super.needToRedraw();if(!t){const t=this.it();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRedraw())return!0}return t}needRetireFrames(){if(this.Y)return!0;const t=this.it();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRetireFrames())return!0;return!1}needToRefreshTerrainTile(){const t=this.it();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRefreshTerrainTile())return!0;return!1}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;if(t)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const{gl:t,regl:e,attributes:n}=this.rt(this.canvas);this.gl=t,this.regl=e,this.glOptions=n}if(t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.ot=new Q$4(this.regl,this.getMap()),this.st(),this.$=new xt$5(this.regl,this.layer),!this.consumeTile){const t=this.getMap().VERSION;throw new Error(`Incompatible version of maptalks: ${t}, upgrade maptalks >= v1.0.0-rc.14`)}}rt(t){const e=this.layer,n=e.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};n.preserveDrawingBuffer=!0,n.stencil=!0;const i=this.lt(t,n);return{gl:i,attributes:n,regl:h$1({gl:i,attributes:n,extensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],optionalExtensions:e.options.glExtensions||["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_draw_buffers","EXT_shader_texture_lod","EXT_frag_depth"]})}}st(){this.q||(this.q=new J$4("@maptalks/vt",this.layer)),this.q.addLayer(((t,e)=>{this.layer&&(this.ready=!0,this.layer.onWorkerReady(t,e),this.layer.fire("workerready"),this.setToRedraw())}))}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear(this.glOptions.depth?{color:ft$3,depth:1,stencil:0}:{color:ft$3,stencil:0})}isDrawable(){return!0}checkResources(){return ut$3}_drawTiles(t,e,n,i,r){if(super._drawTiles(t,e,n,i,r),this.Z)if(Object.keys(this.Z).length)for(const t in this.Z){const e=this.Z[t];this.tileCache.has(e.id)||this._drawTile(e.info,e.image,r)}else this.ht(),delete this.Z}ht(){const t=this.V,e=[],n=[];for(const n in this.G)+n!==t&&(e.push(n),this.tt(n).forEach((t=>{t.remove()})));for(const e in this.W)+e!==t&&(n.push(e),this.et(e).forEach((t=>{t.remove()})));for(let t=0;t<e.length;t++)delete this.G[e[t]];for(let t=0;t<n.length;t++)delete this.W[n[t]]}draw(t,e){this.ct!==t&&(this.Y=!1,this.ut());const n=this.layer;if(this.prepareCanvas(),!this.ready||!n.ready)return void this.completeRender();let i=this.G[this.V];i||(this.J(),i=this.tt());const r=this.et();n.isDefaultRender()||i.length||r.length?(n.options.collision&&(n.clearCollisionIndex(),n.clearBackgroundCollisionIndex()),this.ft=t,this.dt=this.pt(this.getMap().getGLRes()),this.yt=e||{},this.gt(t),super.draw(t),this.ct!==t&&this.vt(t),this.bt(t),this.completeRender(),this.ct=t):this.completeRender()}ut(){this.it().forEach(((t,e)=>{t.renderIndex=e}))}vt(){const t=this.it();this.xt=[];let e=+!!this.layer.getGroundConfig().enable;t.forEach(((t,n)=>{t.isVisible()&&xt$3(t)&&(this.xt[n]=e,t.needPolygonOffset()&&e++)})),this.wt=e}getFrameTimestamp(){return this.ft}drawOnInteracting(t,e,n){this.draw(e,n)}drawOutline(t){(this.At||this.kt)&&(this.kt?this.paintOutlineAll(t):this.At.forEach((e=>{this[e[0]](t,...e[1])})))}getAnalysisMeshes(){return this.getShadowMeshes()}getShadowMeshes(){const t=[];return this._t().forEach((e=>{if(!e)return;if(!this.Tt(e))return;const n=e.getShadowMeshes();if(Array.isArray(n))for(let e=0;e<n.length;e++)t.push(n[e])})),t}isForeground(t){return!(!this.St||!this.St[t.properties.tile.id])}isTileNearCamera(e){const n=this.layer;let i=n._getTileZoom(this.getMap().getZoom());const r=n.getMinZoom(),o=n.getMaxZoom();return i=t__namespace.Util.clamp(i,r,o),i-e.properties.tile.z<=1}isBackTile(t){return!(!this.Mt||!this.Mt[t])}loadTile(t){const{url:e}=t,n=this.U[e];if(n)n.keys[t.id]||(n.tiles.push(t),n.keys[t.id]=1);else{const n=this.getTilePointAtTileRes(t.z),i=this.getTileGLScale(t.z);this.U[e]={keys:{},tiles:[t]},this.U[e].keys[t.id]=1;this.q.loadTile({tileInfo:t,glScale:i,zScale:this.dt,pointAtTileRes:n,fetchOptions:this.layer.options.fetchOptions,styleCounter:this.V},this.Pt.bind(this,e))}return{}}getTileGLScale(t){const e=this.getMap();return this.layer.getSpatialReference().getResolution(t)/e.getGLRes()}getTilePointAtTileRes(t){const e=this.getMap(),n=this.layer.getSpatialReference();return e.distanceToPointAtRes(100,100,n.getResolution(t)).x/1e4}Pt(t,e,n){if(!this.U[t])return;if(n&&n.canceled)return;const i=this.layer,r=i.isDefaultRender(),{tiles:o}=this.U[t];if(delete this.U[t],e){if(e.status&&404===e.status)for(let t=0;t<o.length;t++){this.onTileError(Z$4,o[t])}return}if(!n){for(let t=0;t<o.length;t++){this.consumeTile({It:!0},o[t])}return}if(n.style!==this.V)return;let s=!1;const a=n.features,l=[];for(let t=0;t<n.data.length;t++){const e=n.data[t];if(!e||!e.data||!e.styledFeatures.length)continue;const{isUpdated:i,layer:r}=this.Ot(0,t,e,a,l);l.push(r),i&&(s=i)}for(let t=0;t<n.featureData.length;t++){const e=n.featureData[t];e&&e.data&&e.styledFeatures.length&&this.Ot(1,t,e,a)}s&&i.Ct();const c=this.layer.getDataSchema(o[0].z);if(this.Et(c,n.schema),delete n.features,r&&n.data.length!==l.length){const t=n.data;n.data=[];for(let e=0;e<t.length;e++)t[e]&&t[e].features&&n.data.push(t[e])}n.layers=l;for(let t=0;t<o.length;t++){const e=o[t];if(0===t&&i.options.debugTileData){const{x:t,y:n,z:r}=e;console.log("tile",{layerId:i.getId(),x:t,y:n,z:r,layers:wt$3(Object.values(a))})}const r=0===t?n:vt$2(n);for(let t=0;t<r.data.length;t++){if(!r.data[t])continue;const n=r.data[t].features;for(const t in n)n[t].tile=e}e.extent=r&&r.extent,this.onTileLoad(r,e)}this.layer.fire("datareceived",{url:t})}Ot(t,e,n,i){const{style:r,isUpdated:o}=this.Ft(t,e,n.data),s=this.layer,a=s.isDefaultRender(),h=st$3(i,n.styledFeatures,e,r.symbol,s);delete n.styledFeatures,n.features=h;let c=n.data;return Array.isArray(c)&&(c=c[0]),{isUpdated:o,layer:a?{layer:c.layer,type:c.type}:null}}Et(t,e){for(const n in e){t[n]||(t[n]={types:e[n].types,properties:{}});const i=e[n].properties,r=t[n].properties;for(const t in i)(!r[t]||r[t]&&"object"!==i[t]&&"object"===r[t])&&(r[t]=i[t])}}Ft(t,e,n){Array.isArray(n)&&(n=n[0]);const i=this.layer;let r,o=!1;if(i.isDefaultRender()&&0===t){let t=this.zt;t||(t=this.zt={});const e=n.layer,i=n.type;t[e]||(t[e]=[]);const s=("plugin_"+i).trim();t[e][s]?r=t[e][s]:(r=this.jt(i),r.filter=n.filter,t[e].push(r),t[e][s]=r,o=!0)}else{const s=i.X(),a=i.nt(t,s),l=this.tt();if(r=a[e],!r.renderPlugin){o=!0;const{plugin:t,symbol:i,renderPlugin:s}=this.jt(n.type);l[e]=t,r.symbol=i,r.renderPlugin=s}}return{style:r,isUpdated:o}}it(t){const e=t&&t.style;let n=this.tt(e)||[];this.layer.isDefaultRender()&&this.zt&&(n=[],t?t.layers&&t.layers.forEach((t=>{const e=("plugin_"+t.type).trim();n.push(this.zt[t.layer][e].plugin)})):Object.keys(this.zt).forEach((t=>{for(let e=0;e<this.zt[t].length;e++)n.push(this.zt[t][e].plugin)})));const i=this.et(e);return i&&i.length&&(n=n.slice(),$$4(n,i)),n}_t(){if(this.layer.isDefaultRender()&&this.zt){const t=[];return Object.keys(this.zt).forEach((e=>{for(let n=0;n<this.zt[e].length;n++)t.push(this.zt[e][n].plugin)})),t}const t=[];for(const e in this.G)t.push(...this.G[e]);for(const e in this.W)t.push(...this.W[e]);return t}tt(t){return q$4(t)&&(t=this.V),this.G[t]||ut$3}et(t){return q$4(t)&&(t=this.V),this.W[t]||ut$3}gt(t,e){const n=!!this.Rt,i=this.layer.isDefaultRender()&&this.zt,r=this.yt;this._t().forEach(((o,s)=>{if(!o||e&&!e(o))return;if(!this.Tt(s))return;const c={regl:this.regl,layer:this.layer,symbol:i?o.defaultSymbol:o.style&&o.style.symbol,gl:this.gl,isRenderingTerrain:n,sceneConfig:o.config?o.config.sceneConfig:null,dataConfig:o.config?o.config.dataConfig:null,pluginIndex:s,timestamp:t};r&&U$4(c,r),o.startFrame(c)}))}bt(t){const e=this.yt,n=e.renderMode,i=e&&e.renderTarget&&e.renderTarget.fbo,r=this.getMap().cameraPosition,o=this._t(),s=!!this.Rt;o.forEach(this.layer.options.collision?e=>{if(!this.Tt(e)||!xt$3(e))return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(s&&!yt$3(e))return;const i=this.Dt(e,0,r,t);e.prepareRender(i),e.updateCollision(i)}:e=>{if(!this.Tt(e)||!xt$3(e))return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(s&&!yt$3(e))return;const i=this.Dt(e,0,r,t);e.prepareRender(i)});const a=!e.timestamp||e.isFinalRender;let h=!1;if(this.ct!==e.timestamp){const e=-this.layer.getPolygonOffset(),n=this.Dt(null,e,r,t);n.offsetFactor=n.offsetUnits=e,this.$.paint(n)}o.forEach(((e,o)=>{if(!this.Nt(e))return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(s&&!yt$3(e))return;this.regl.clear({stencil:255,fbo:i}),this.isEnableTileStencil()&&e.painter&&!e.painter.needClearStencil()&&this.Lt(i);const l=this.Dt(e,this.xt[o]||0,r,t),c=e.endFrame(l);c&&c.redraw&&this.setToRedraw(),h=!0})),h&&this.layer.fire("canvasisdirty"),a&&this.Ht()}getPolygonOffsetCount(){return this.wt||0}Ht(){if(this.layer.options.debug){const t=this.yt,e=[],n=this.getMap().projViewMatrix;for(const i in this.tilesInView){const o=this.tilesInView[i].info,s=o.transform,a=this.tilesInView[i].image.extent,l=t&&t.renderTarget;if(s&&a){const t=this.getDebugInfo(o.id),i=multiply$5(e,n,s);this.ot.draw(t,i,this.layer.options.tileSize,a,l&&l.fbo)}}}}Nt(t){if(!t)return!0;const e=this.yt,n=this.Tt(t),i=e&&e.states&&e.states.includesChanged,r=this.Vt(t.painter.scene.getMeshes());return n&&(i||r)?r?2:1:0}Dt(t,e,n,i){const r=!!this.Rt,o=r&&t&&mt$3(t),l={regl:this.regl,layer:this.layer,gl:this.gl,isRenderingTerrain:r,isRenderingTerrainSkin:o,sceneConfig:t&&t.config.sceneConfig,pluginIndex:t&&t.renderIndex,polygonOffsetIndex:e,cameraPosition:n,timestamp:i},h=this.yt;return h&&U$4(l,h),l}Vt(t){if(!t)return!1;const e=this.yt&&this.yt.sceneFilter;return e?t.filter((t=>e(t)||t.properties.hlBloomMesh&&e(t.properties.hlBloomMesh))).length>0:t.length>0}Lt(t){const e=this.isEnableTileStencil(),n=this.getCurrentTileZoom();let i=this.Ut;i||(i=this.Ut=new rt$3(this.regl,this.canvas,this.getMap())),i.start();const{tiles:r}=this.Gt;let{parentTiles:o,childTiles:s}=this.Gt,a=1;s=s.sort(bt$3);for(let t=0;t<s.length;t++)this.Wt(s[t].info,e?a:this.getTileLevelValue(s[t].info.z,n)),a++;o=o.sort(bt$3);for(let t=0;t<o.length;t++)this.Wt(o[t].info,e?a:this.getTileLevelValue(o[t].info.z,n)),a++;const l=r.sort(bt$3);for(let t=l.length-1;t>=0;t--)this.Wt(l[t].info,e?a:this.getTileLevelValue(l[t].info.z,n)),a++;i.render(t)}Wt(t,e){const n=dt$3.set(t.extent2d.xmin,t.extent2d.ymax),i=t.transform=t.transform||this.calculateTileMatrix(n,t.z,t.extent);t.stencilRef=e,this.Ut.add(e,t.extent,i)}onDrawTileStart(t){super.onDrawTileStart(t);const{tiles:e,childTiles:n,parentTiles:i}=t;this.St={},this.Mt={};for(let t=0;t<e.length;t++)this.St[e[t].info.id]=1;for(let t=0;t<n.length;t++)this.Mt[n[t].info.id]=1;for(let t=0;t<i.length;t++)this.Mt[i[t].info.id]=1;this.Gt=t}isEnableTileStencil(){const t=this.it();for(let e=0;e<t.length;e++)if(t[e]&&t[e].painter&&!t[e].painter.isOnly2D())return!1;return!0}setTerrainHelper(t){this.Rt=t}getTerrainHelper(){return this.Rt}drawTileOnTerrain(t,e){gt$3.prototype.drawTile.call(this,t,e)}createTerrainTexture(t){const e=this.layer.getTileSize().width,n=2*e,i=2*e,r=t.texture({min:"linear",mag:"linear",type:"uint8",width:n,height:i,flipY:!0});this.qt||(this.qt=t.renderbuffer({width:n,height:i,format:"depth24 stencil8"}));const o={width:n,height:i,colors:[r],colorFormat:"rgba"};o.depthStencil=this.qt;const s=t.framebuffer(o);return s.colorTex=r,s}deleteTerrainTexture(t){t.destroy(),t.colorTex&&(t.colorTex.destroy(),delete t.colorTex)}renderTerrainSkin(t,e,n){const i=this.ct,r=this.yt,o=this.layer.getTileSize().width;this.gt(i);for(let e=0;e<n.length;e++){const i=n[e].texture;this.yt={renderTarget:{fbo:i}},pt$3.framebuffer=i,t.clear(pt$3),this.yt.viewport=At$2(o),this.$t(n[e].tile,i)}this.Bt(n),this.yt=r}$t(t){const{info:e,image:n}=t;this.drawTile(e,n,mt$3)}Bt(t){const e=this._t(),n=this.getMap().cameraPosition,i=this.ct||0;e.forEach(this.layer.options.collision?t=>{if(!this.Tt(t)||!xt$3(t))return;if(!mt$3(t)||!this.layer.options.awareOfTerrain)return;const e=this.Dt(t,0,n,i);e.isRenderingTerrainSkin=!0,t.prepareRender(e),t.updateCollision(e)}:t=>{if(!this.Tt(t)||!xt$3(t))return;if(!mt$3(t)||!this.layer.options.awareOfTerrain)return;const e=this.Dt(t,0,n,i);e.isRenderingTerrainSkin=!0,t.prepareRender(e)}),e.forEach(((e,n)=>{if(!this.Nt(e)||!mt$3(e))return;for(let e=0;e<t.length;e++){this.regl.clear({stencil:255,framebuffer:t[e].texture})}const r=this.Dt(e,this.xt[n]||0,[0,0,0],this.ct);r.isRenderingTerrainSkin=!0,e.endFrame(r)}))}drawTile(t,e,n){if(!e.cache)return;const i=!!this.Rt,r=e.cache,o=dt$3.set(t.extent2d.xmin,t.extent2d.ymax),s=t.transform=t.transform||this.calculateTileMatrix(o,t.z,t.extent),a=t.tileTranslationMatrix=t.tileTranslationMatrix||this.calculateTileTranslationMatrix(o,t.z),l=t.terrainTransform=t.terrainTransform||this.calculateTerrainTileMatrix(o,t.z,t.extent),h=this.yt,c=[];$$4(c,e.data),$$4(c,e.featureData),this.it(e).forEach(((o,u)=>{if(!o||n&&!n(o))return;if(!c[u])return;if(!r[u])return;const f=i&&mt$3(o),m={regl:this.regl,layer:this.layer,gl:this.gl,sceneConfig:o.config.sceneConfig,pluginIndex:u,tileCache:r[u],tileData:c[u],tileTransform:f?l:s,tileVectorTransform:s,tileTranslationMatrix:a,tileExtent:e.extent,timestamp:this.ft,tileInfo:t,tileZoom:this._tileZoom,bloom:this.yt&&this.yt.bloom,isRenderingTerrain:i,isRenderingTerrainSkin:f};h&&U$4(m,h);const y=o.paintTile(m);!this.Y&&(y.retire||y.redraw)&&o.supportRenderMode("taa")&&(this.Y=!0),y.redraw&&this.setToRedraw()})),e&&e.style===this.V&&this.Xt(t),this.setCanvasUpdated()}Yt(t,e){if(!e.loadTime||e.It)return;let n=e.cache;n||(n=e.cache={});const i=!!this.Rt,r=dt$3.set(t.extent2d.xmin,t.extent2d.ymax),o=t.transform=t.transform||this.calculateTileMatrix(r,t.z,e.extent),s=t.tileTranslationMatrix=t.tileTranslationMatrix||this.calculateTileTranslationMatrix(r,t.z),a=t.terrainTransform=t.terrainTransform||this.calculateTerrainTileMatrix(r,t.z,t.extent),l=[];$$4(l,e.data),$$4(l,e.featureData),this.it(e).forEach(((r,h)=>{if(!r)return;if(!l[h])return;const c=i&&mt$3(r),u=this.regl,f=this.gl;n[h]||(n[h]={});const p=r.createTile({regl:u,layer:this.layer,gl:f,sceneConfig:r.config.sceneConfig,pluginIndex:h,tileCache:n[h],tileData:l[h],tileTransform:c?a:o,tileVectorTransform:o,isRenderingTerrain:i,isRenderingTerrainSkin:c,tileTranslationMatrix:s,tileExtent:e.extent,timestamp:this.ft,tileInfo:t,tileZoom:this._tileZoom});n[h].geometry&&(e.data[h]=1),!this.Y&&p.retire&&r.supportRenderMode("taa")&&(this.Y=!0)}))}checkTileInQueue(t){return t.style===this.V}pick(t,e,n){const i=[];return this.layer.isVisible()?(this.it().forEach((r=>{if(!r)return;if(!this.Tt(r))return;const o=r.pick(t,e,n.tolerance);o&&(o.type=r.getType(),i.push(o))})),i):i}deleteTile(t){if(t){if(t.image&&!t.image.It){const n=this.tt(t.image&&t.image.style);n&&n.forEach(((e,n)=>{e&&e.deleteTile({pluginIndex:n,regl:this.regl,layer:this.layer,gl:this.gl,tileCache:t.image.cache?t.image.cache[n]:{},tileInfo:t.info,tileData:t.image})})),t.image.cache={}}super.deleteTile(t)}}abortTileLoading(t,e){e&&e.url&&(this.q&&this.q.abortTile(e.url),delete this.U[e.url]),super.abortTileLoading(t,e)}resizeCanvas(t){super.resizeCanvas(t);const e=this.canvas;e&&(!this.pickingFBO||this.pickingFBO.width===e.width&&this.pickingFBO.height===e.height||(this.pickingFBO.resize(e.width,e.height),this.it().forEach((t=>{t&&t.resize(e.width,e.height)}))))}onRemove(){this.Ut&&this.Ut.remove(),this.q&&(this.q.removeLayer((t=>{if(t)throw t})),this.q.remove(),delete this.q),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.ot&&this.ot.delete(),this.qt&&(this.qt.destroy(),delete this.qt),super.onRemove&&super.onRemove(),this.K()}K(){this._t().forEach((t=>{t.remove()})),this.plugins={}}hitDetect(t){if(!this.gl||!this.layer.options.hitDetect)return!1;const e=this.gl,n=new Uint8Array(4);return e.readPixels(t.x,this.canvas.height-t.y,1,1,e.RGBA,e.UNSIGNED_BYTE,n),n[3]>0}J(){const{style:t,featureStyle:e}=this.layer.X(),n=t.map(((t,e)=>{const n=t.renderPlugin;if(!n)return null;if(!n.type)throw new Error("invalid plugin type for style at "+e);const i=this.Jt(n);return i.styleCounter=this.V,i.style=t,i})),i=[];e.forEach(((t,e)=>{const n=t.renderPlugin;if(!n)return null;if(!n.type)throw new Error("invalid plugin type for features at "+e);const r=this.Jt(n);return r.style=t,r.styleCounter=this.V,i.push(r),r}));const r=this.V;return this.G[r]=n,this.W[r]=i,this.layer.fire("pluginsinited"),(this.Zt&&this.Zt.size||this.layer.Zt)&&(this.layer.Zt&&this.layer.Kt(),this.getMap().getRenderer().callInNextFrame((()=>{this.it().forEach((t=>{t.highlight(this.Zt)}))}))),n}Jt(t){const e=this.layer.constructor.getPlugins()[t.type];if(!e)throw new Error(`Plugin for (${t.type}) is not loaded.`);const n=new e;return n.config=t,n.config.sceneConfig||(n.config.sceneConfig={}),n}lt(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let r=0;r<n.length;++r){try{i=t.getContext(n[r],e)}catch(t){}if(i)break}return i}pt(t){return X$4(t,this.getMap())}debugFBO(t,e){const n=document.getElementById(t),i=e.width,r=e.height;n.width=i,n.height=r;const o=n.getContext("2d"),s=this.regl.read({framebuffer:e}),a=r/2|0,l=4*i;for(let t=0;t<s.length;t++)s[t]*=255;const h=new Uint8Array(4*i);for(let t=0;t<a;++t){const e=t*l,n=(r-t-1)*l;h.set(s.subarray(e,e+l)),s.copyWithin(e,n,n+l),s.set(h,n)}const c=new ImageData(i,r);c.data.set(s),o.putImageData(c,0,0)}jt(t){let e;switch(t){case"native-line":e={type:"native-line",dataConfig:{type:"native-line",only2D:!0}};break;case"native-point":e={type:"native-point",dataConfig:{type:"native-point",only2D:!0}};break;case"fill":e={type:"fill",dataConfig:{type:"fill",only2D:!0},sceneConfig:{antialias:!0}};break;default:e=null}const n=function(t){switch(t){case"native-point":return{markerFill:"#f00",markerSize:6,markerOpacity:.5};case"native-line":return{lineColor:"#bbb",lineOpacity:.5};case"fill":return{polygonFill:"#76a6f0",polygonOpacity:.8}}return null}(t),i=this.Jt(e);return i.defaultSymbol=n,{plugin:i,symbol:n,renderPlugin:e}}Tt(){return!0}isEnableWorkAround(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&function(t){const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&"undefined"!=typeof navigator){const n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),i="Win32"===navigator.platform||"Win64"===navigator.platform;if(n&&n.toLowerCase().indexOf("intel")>=0&&i)return!0}return!1}(this.gl)}getZScale(){return this.dt}outline(t,e){e&&(Array.isArray(e)||(e=[e]),this.At||(this.At=[]),this.At.push(["paintOutline",[t,e]]),this.setToRedraw())}outlineFeatures(t){t&&(Array.isArray(t)||(t=[t]),this.At||(this.At=[]),this.At.push(["paintOutline",[null,t]]),this.setToRedraw())}outlineBatch(t){this.At||(this.At=[]),this.At.push(["paintBatchOutline",[t]]),this.setToRedraw()}outlineAll(){this.kt=!0,this.setToRedraw()}paintOutlineAll(t){const e=this.it();for(let n=0;n<e.length;n++)e[n].outlineAll(t)}paintOutline(t,e,n){if(!q$4(e)){const i=e,r=this.it();if(!r[i]||r[i].painter&&!r[i].painter.isVisible())return;return void r[i].outline(t,n)}const i=this.it();for(let e=0;e<n.length;e++){const r=n[e];for(let e=0;e<i.length;e++)i[e].style&&i[e].style.id===r&&i[e].outline(t,[r])}}paintBatchOutline(t,e){const n=this.it();!n[e]||n[e].painter&&!n[e].painter.isVisible()||n[e].outlineAll(t)}cancelOutline(){delete this.At,delete this.kt,this.setToRedraw()}setZIndex(){return this.setToRedraw(),this.Y=!0,super.setZIndex.apply(this,arguments)}consumeTile(t,e){t.It&&this.Xt(e),super.consumeTile(t,e),this.Yt(e,t)}onTileError(t,e){this.Xt(e),super.onTileError(t,e)}Xt(t){const{id:e}=t;if(this.Z&&this.Z[e]){this.deleteTile(this.Z[e]),delete this.Z[e]}}highlight(t){if(this.Zt||(this.Zt=new Map),Array.isArray(t))for(let e=0;e<t.length;e++)q$4(t[e].name)&&!q$4(t[e].id)&&(t[e]=U$4({},t[e]),t[e].name=t[e].id),this.Zt.set(t[e].name,t[e]);else q$4(t.name)&&!q$4(t.id)&&((t=U$4({},t)).name=t.id),this.Zt.set(t.name,t);this.it().forEach((t=>{t.highlight(this.Zt)}))}cancelHighlight(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.Zt.delete(t[e]);else this.Zt.delete(t);this.it().forEach((t=>{t.highlight(this.Zt)}))}cancelAllHighlight(){delete this.Zt,this.it().forEach((t=>{t.cancelAllHighlight()}))}}function vt$2(t){let e;Array.isArray(t.data)?(e=[],$$4(e,t.data)):(e={},U$4(e,t.data));const n=U$4({},t);return n.data=e,n}function bt$3(t,e){return e.info.z-t.info.z}function xt$3(t){const e=t.painter&&t.painter.scene&&t.painter.scene.getMeshes();return e&&e.length}function wt$3(t){const e={};for(let n=0;n<t.length;n++){const i=t[n].layer||"default";e[i]||(e[i]=[]),e[i].push(t[n])}return e}function At$2(t){return{x:0,y:0,width:2*t,height:2*t}}function kt$2(t,e,n){for(let i=0;i<t.length;i++){const r=t[i],o=U$4({},r),{renderPlugin:s}=r,a=U$4({},s);a.sceneConfig&&!Object.keys(a.sceneConfig).length&&delete a.sceneConfig;let l=-1;for(let t=n.length-1;t>=0;t--)if(fastDeepEqual(a,n[t])){l=t;break}l<0&&(l=n.length,n.push(a)),o.renderPlugin=l,e.push(o)}}gt$3.include({calculateTileMatrix:function(){const t=new Array(3),e=new Array(3),n=new Array(3);return function(o,s,a){const l=this.getTileGLScale(s),h=o,c=this.layer.options.tileSize,u=identity$2([]);return scale$5(u,u,set$4(t,l,l,this.dt)),translate$1(u,u,set$4(e,h.x,h.y,0)),scale$5(u,u,set$4(n,c/a,-c/a,1)),u}}(),calculateTerrainTileMatrix:function(){const t=new Array(3);return function(e,n,o){const s=identity$2([]),a=o/2;return scale$5(s,s,set$4(t,1/a,-1/a,0)),translate$1(s,s,set$4(t,-a,-a,0)),s}}(),calculateTileTranslationMatrix:function(){const t=new Array(3);return function(e,n){const o=this.getTileGLScale(n),s=e,a=identity$2([]);return translate$1(a,a,set$4(t,s.x*o,s.y*o,0)),a}}()});const _t$3="function"==typeof fetch&&"function"==typeof AbortController,Tt$2={jsonp:function(t,e){const n="_maptalks_jsonp_"+H$5();t.match(/\?/)?t+="&callback="+n:t+="?callback="+n;let i=document.createElement("script");return i.type="text/javascript",i.src=t,window[n]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(t,e,n){if(W$4(e)){const t=n;n=e,e=t}(e=e||{}).method&&(e.method=e.method.toUpperCase());const i="POST"===e.method;if(_t$3){const i=new AbortController,r=e;return r.signal=i.signal,r.referrerPolicy=r.referrerPolicy||"origin",r.method=r.method||"GET",fetch(t,r).then((i=>{const r=this.Qt(i,e.returnJSON,e.responseType);r.message?(r.url=t,n(r)):r.then((t=>{n(null,"arraybuffer"===e.responseType?{data:t,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires"),contentType:i.headers.get("Content-Type")}:t)})).catch((t=>{t.code&&t.code===DOMException.ABORT_ERR||(console.error(t),n(t))}))})).catch((t=>{t.code&&t.code===DOMException.ABORT_ERR||(console.error(t),n(t))})),i}{const r=Tt$2.te(n);if(r.open(e.method||"GET",t,!0),e){for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(i?e.body:null),r}},Qt:(t,e,n)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===n?t.arrayBuffer():e?t.json():t.text(),ee:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e({status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}))}},te:function(t){let e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=Tt$2.ee(e,t),e},getArrayBuffer(t,e,n){if(W$4(e)){const t=n;n=e,e=t}return e||(e={}),e.responseType="arraybuffer",Tt$2.get(t,e,n)},getJSON:function(t,e,n){if(W$4(e)){const t=n;n=e,e=t}const i=function(t,e){const i="string"==typeof e?JSON.parse(e):e||null;n(t,i)};return e&&e.jsonp?Tt$2.jsonp(t,i):((e=e||{}).returnJSON=!0,Tt$2.get(t,e,i))}},St$2=new t__namespace.Point(0,0),Mt$2=new t__namespace.Coordinate(0,0),Pt$2=new t__namespace.Coordinate(0,0),It$2=[0,0],Ot$2={renderer:"gl",altitudeProperty:"altitude",forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,tileSize:512,tileSystem:[1,-1,-6378137*Math.PI,6378137*Math.PI],features:!1,schema:!1,cascadeTiles:!0,collision:!0,picking:!0,pickingPoint:!1,pickingGeometry:!1,glyphSdfLimitPerFrame:15,tileLimitPerFrame:1,maxCacheSize:72,antialias:!1,iconErrorUrl:null,collisionFrameLimit:1.5,defaultRendering:!0,textGamma:1,maxIconSize:254,workarounds:{"win-intel-gpu-crash":!1},pyramidMode:1,styleScale:1,spatialReference:"preset-vt-3857",enableAltitude:!0,fadeAnimation:!1,debugTileData:!1,fetchOptions:null,awareOfTerrain:!0};class Ct$2 extends t__namespace.TileLayer{constructor(t,e){super(t,e),this.VERSION=Ct$2.VERSION;this.setStyle(e&&e.style)}onAdd(){const t=this.getMap(),e=this.getSpatialReference().toJSON().projection,n=t.getSpatialReference().toJSON().projection;if((e&&e.toLowerCase())!==(n&&n.toLowerCase()))throw new Error(`VectorTileLayer's projection(${e}) must be the same with map(${n}).`)}onWorkerReady(){}onConfig(t){const e=this.getRenderer();e&&e.updateOptions(t)}getWorkerOptions(){const t=this.getMap();return{debug:this.options.debug,debugTile:this.options.debugTile,altitudeProperty:this.options.altitudeProperty,tileSize:this.options.tileSize,baseRes:t.getGLRes(),style:this.isDefaultRender()?{style:[],featureStyle:[]}:this.X(),features:this.options.debugTileData||this.options.features,schema:this.options.schema,pickingGeometry:this.options.pickingGeometry}}setStyle(t){if(t&&(G$4(t)||t.url)){const e=t,n=e.lastIndexOf("/"),i=n<0?".":e.substring(0,n);return this.ready=!1,Tt$2.getJSON(t.url?t.url:t,t.url?t:{},((t,n)=>{if(t)throw this.setStyle([]),t;let r;n.style?(r=n,r.$root||(r.$root=i)):r={$root:i,style:n},this.options.style=e,this.ne(r)})),this}return this.options.style=t,this.ne(t),this}ie(t,e,n,i,r){const o=i/this.options.tileSize,s=St$2.set(n.x+e.x/o,n.y-e.y/o);return this.getMap()._pointToPrjAtRes(s,r,t)}queryTilePointTerrain(t,e,n,i){const r=this.getRenderer(),o=r&&r.getTerrainHelper();if(!r||!o)return It$2[0]=0,It$2[1]=0,It$2;const s=this.ie(Pt$2,t,e,n,i);return o.queryTerrainByProjCoord(s)}ne(t){if(this.re=null,t&&t.$root){let e=t.$root;e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),this.re=e,this.oe=function(t){return"{$root}"===t?e:null}}this.ready=!0,t=t||[],Array.isArray(t)?t={style:t}:t.renderPlugin&&(t={style:[t]}),t=function(t){if(!t.plugins)return t;const{plugins:e,styles:n}=t;let{style:i,featureStyle:r}=n;i=i||[],r=r||[];const o=new Array(i.length);for(let t=0;t<i.length;t++)o[t]=U$4({},i[t]),o[t].renderPlugin=e[i[t].renderPlugin];const s=new Array(r.length);for(let t=0;t<r.length;t++)s[t]=U$4({},r[t]),s[t].renderPlugin=e[r[t].renderPlugin];const a={style:o,featureStyle:s};return t.$root&&(a.$root=t.$root),a}(t=JSON.parse(JSON.stringify(t))),this.se=t.featureStyle||[],this.ae=function(t){if(!t||!Array.isArray(t))return[];const e=[];for(let n=0;n<t.length;n++){const i=t[n].style;if(i&&Array.isArray(i)&&i.length)for(let r=0;r<i.length;r++){const o=U$4({},t[n],i[r]);i[r].le=e.length,delete o.style,e.push(o)}else e.push(U$4({},t[n]))}return e}(t.featureStyle),this.he=t.style||[];const e=t.background||{};this.ce={enable:e.enable||!1,color:Ft$2(e.color)||[0,0,0,0],opacity:zt$2(e.opacity,1),patternFile:e.patternFile,depthRange:e.depthRange},this.validateStyle(),this.oe&&this.ue(),this.Ct();const n=this.getRenderer();n&&n.setStyle(),this.fire("setstyle",{style:this.getStyle(),computedStyle:this.getComputedStyle()})}getPolygonOffsetCount(){const t=this.getRenderer();return t?t.getPolygonOffsetCount():0}getPolygonOffset(){return this.fe||0}setPolygonOffset(t,e){return this.fe=t,this.de=e,this}getTotalPolygonOffset(){return this.de}outlineAll(){const t=this.getRenderer();return t?(t.outlineAll(),this):this}outline(t,e){const n=this.getRenderer();return n?(n.outline(t,e),this):this}outlineBatch(t){const e=this.getRenderer();return e?(e.outlineBatch(t),this):this}outlineFeatures(t){const e=this.getRenderer();return e?(e.outlineFeatures(t),this):this}cancelOutline(){const t=this.getRenderer();return t?(t.cancelOutline(),this):this}highlight(t){this.pe(t);const e=this.getRenderer();return e?(e.highlight(t),this):(this.Zt||(this.Zt=[]),this.Zt.push(t),this)}pe(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.pe(t[e]);else{if(t.filter){if(!this.options.features)throw new Error("options.features must be turned on to support filter in highlight");if(!t.name)throw new Error("A name is required for highlight with filter")}if(q$4(t.filter)&&q$4(t.id))throw new Error("id or filter must be provided for highlight")}}Kt(){if(this.Zt){for(let t=0;t<this.Zt.length;t++)this.highlight(this.Zt[t]);delete this.Zt}}cancelHighlight(t){const e=this.getRenderer();return e?(e.cancelHighlight(t),this):this}cancelAllHighlight(){const t=this.getRenderer();return t?(t.cancelAllHighlight(),this):this}ue(){t__namespace.Util.convertStylePath(this.he,this.oe),t__namespace.Util.convertStylePath(this.ae,this.oe)}updateSceneConfig(t,e){return this.me(0,t,e)}updateFeatureSceneConfig(t,e,n){return this.me(1,t,n,e)}me(t,e,n,i){const r=this.nt(t);if(!r)return this;let o,s=e;if(r[e].renderPlugin.sceneConfig||(r[e].renderPlugin.sceneConfig={}),U$4(r[e].renderPlugin.sceneConfig,n),void 0!==i){jt$2(this.se,e,i),s=this.se[e].style[i].le;const t=r[s].renderPlugin;t.sceneConfig||(t.sceneConfig={}),o=t.sceneConfig}else Rt$2(r,e),o=r[e].renderPlugin.sceneConfig;if(U$4(o,n),Array.isArray(this.options.style)){const t=this.options.style[e].renderPlugin;t.sceneConfig||(t.sceneConfig={}),U$4(t.sceneConfig,n)}else{const r=this.nt(t,this.options.style);let o;void 0!==i?(jt$2(r,e,i),o=r[e].style[i].renderPlugin):(Rt$2(r,e),o=r[e].renderPlugin),o.sceneConfig||(o.sceneConfig={}),U$4(o.sceneConfig,n)}const a=this.getRenderer();return a&&a.updateSceneConfig(t,s,n),0===t?this.fire("updatesceneconfig",{index:e,sceneConfig:n}):1===t&&this.fire("updatefeaturesceneconfig",{index:e,styleIdx:i,sceneConfig:n}),this}updateDataConfig(t,e){return this.ye(0,t,e)}updateFeatureDataConfig(t,e,n){return this.ye(1,t,n,e)}ye(t,e,n,i){const r=this.nt(t);if(!r)return this;let o,s=e;void 0!==i?(jt$2(this.se,e,i),s=this.se[e].style[i].le,o=r[s].renderPlugin.dataConfig):(Rt$2(r,e),o=r[e].renderPlugin.dataConfig);const a=U$4({},o);if(U$4(o,n),Array.isArray(this.options.style))U$4(this.options.style[e].renderPlugin.dataConfig,n);else{const r=this.nt(t,this.options.style);let o;void 0!==i?(jt$2(r,e,i),o=r[e].style[i].renderPlugin):(Rt$2(r,e),o=r[e].renderPlugin),o.dataConfig||(o.dataConfig={}),U$4(o.dataConfig,n)}const l=this.getRenderer();return l&&l.updateDataConfig(t,s,n,a),0===t?this.fire("updatedataconfig",{index:e,dataConfig:n}):1===t&&this.fire("updatefeaturedataconfig",{index:e,styleIdx:i,dataConfig:n}),this}updateSymbol(t,e){return G$4(t)&&(t=this.ge(t)),this.ve(0,t,e)}updateFeatureSymbol(t,e,n){return this.ve(1,t,n,e)}ve(e,n,i,r){const o=this.nt(e);if(!o)return this;let s=n;void 0!==r&&(jt$2(this.se,n,r),s=this.se[n].style[r].le);const a=o[s];if(!a)throw new Error("No style defined at "+n);const l=this,h=this.oe;function c(i,o,s){if(!i)return!1;h&&(i=JSON.parse(JSON.stringify(i)),t__namespace.Util.parseSymbolPath(i,h));const a=Object.keys(i);let c=!1;for(let t=0;t<a.length;t++){const e=a[t];if(Et$2(o[e])||Et$2(i[e])){c=!0;break}}for(const e in i)B$4(i,e)&&(!t__namespace.Util.isObject(i[e])||Array.isArray(i[e])||i[e].stops?o[e]=i[e]:(o[e]||(o[e]={}),U$4(o[e],i[e])));let u=l.options.style;if(G$4(u))return c;Array.isArray(u)||(u=l.nt(e,l.options.style));const f=JSON.parse(JSON.stringify(o));return void 0!==r?(jt$2(u,n,r),void 0===s?u[n].style[r].symbol=f:u[n].style[r].symbol[s]=f):(Rt$2(u,n),void 0===s?u[n].symbol=f:u[n].symbol[s]=f),c}const u=this.getRenderer();if(!u)return c(),this.Ct(),this;let f=!1;const d=a.symbol;if(Array.isArray(i))for(let t=0;t<i.length;t++){const e=c(i[t],d[t],t);e&&(f=e)}else c(i,d);return this.Ct(),f?u.setStyle():(f=u.updateSymbol(e,s,i),f&&u.setStyle()),0===e?this.fire("updatesymbol",{index:n,symbol:i}):1===e&&this.fire("updatefeaturesymbol",{index:n,featureStyleIndex:r,symbol:i}),this}nt(t,e){return e?0===t?e.style:e.featureStyle:0===t?this.he:this.ae}isDefaultRender(){return!!this.be&&this.options.defaultRendering}validateStyle(){this.be=!1;let t=this.he;this.options.style||(this.be=!0,t=this.he=[]),Array.isArray(t)||(t=this.he=[t]);for(let e=0;e<t.length;e++){let n=t[e].filter;if(n&&n.value&&(n=n.value),void 0!==n&&"default"!==n&&!0!==n&&!Array.isArray(n)&&void 0===n.condition)throw new Error(`Invalid filter at ${e} : ${JSON.stringify(n)}`)}}getStyle(){return this.options.style?JSON.parse(JSON.stringify(this.options.style)):null}ge(t){const e=this.he;if(!e)return-1;for(let n=0;n<e.length;n++)if(e[n].name===t)return n;throw new Error("No style defined with name: "+t)}getGroundConfig(){this.xe||(this.xe={enable:!0,renderPlugin:{type:"fill",sceneConfig:{}},symbol:{polygonFill:[0,0,0,0],polygonOpacity:1}});const t=this.X().background||{};return this.xe.enable=t.enable,this.xe.symbol.polygonFill=t.color,this.xe.symbol.polygonOpacity=t.opacity,this.xe.symbol.polygonPatternFile=t.patternFile,this.xe.renderPlugin.sceneConfig.depthRange=t.depthRange,this.xe}getComputedStyle(){return JSON.parse(JSON.stringify(this.X()))}X(){return{background:this.ce,style:this.he||[],featureStyle:this.ae||[]}}identify(e,n={}){const i=this.getMap(),r=this.getRenderer();if(!i||!r)return[];const o=i.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(o,n)}identifyAtPoint(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=n.getDevicePixelRatio(),o=i.pick(t.x*r,t.y*r,e);return this.options.features&&"id"!==this.options.features?this.we(o):o}we(t){if(!this.getRenderer())return t;const e=this._getTileConfig(),n=this.getSpatialReference();for(let i=0;i<t.length;i++){let r=t[i];if(!r||!r.data)continue;const{tile:o}=r.data,{x:s,y:a,z:l,extent:h}=o,c=n.getResolution(l),u=e.getTilePointNW(s,a,c),f=r.data.feature&&r.data.feature.geometry;if(f){r.data=U$4({},r.data),r.data.feature=U$4({},r.data.feature);const t=r.data.feature.type;r.data.feature.type="Feature",r.data.feature.geometry=this.Ae(t,f,u,h,c)}}return t}Ae(t,e,n,i,r){let o,s;if(1===t)e.length<=1?(o="Point",s=this.ke(e,n,i,r)[0]||[]):(o="MultiPoint",s=this.ke(e,n,i,r));else if(2===t)e.length<=1?(o="LineString",s=this.ke(e,n,i,r)[0]||[]):(o="MultiLineString",s=this.ke(e,n,i,r));else if(3===t){let t;s=[];let a=0;for(let o=0;o<e.length;o++)ta.calculateSignedArea(e[o])>0&&(a++,t&&t.length&&s.push(t),t=[]),t.push(this.ke(e[o],n,i,r));t.length&&s.push(t),a<=1?(o="Polygon",s=s[0]):o="MultiPolygon"}return{type:o,coordinates:s}}ke(t,e,n,i){const r=n/this.options.tileSize,o=this.getMap(),s=[];for(let a=0;a<t.length;a++)Array.isArray(t[a])?s.push(this.ke(t[a],e,n,i)):(St$2.x=e.x+t[a].x/r,St$2.y=e.y-t[a].y/r,o.pointAtResToCoord(St$2,i,Mt$2),s.push(Mt$2.toArray()));return s}getBackgroundCollisionIndex(){return this._e||(this._e=new t__namespace.CollisionIndex),this._e}clearBackgroundCollisionIndex(){return this._e&&this._e.clear(),this}getDataSchema(t){return this.Te||(this.Te={}),q$4(t)||this.Te[t]||(this.Te[t]={}),q$4(t)?this.Te:this.Te[t]}onRemove(){super.onRemove()}static fromJSON(t){return t&&"VectorTileLayer"===t.type?new Ct$2(t.id,t.options):null}Ct(){}static registerPlugin(t){Ct$2.plugins||(Ct$2.plugins={}),Ct$2.plugins[t.type]=t}static getPlugins(){return Ct$2.plugins||{}}static compressStyleJSON(t){return Array.isArray(t)&&t.length?function(t){Array.isArray(t)&&(t={style:t,featureStyle:[]});const e=[],n=[],i=[];kt$2(t.style,e,i),kt$2(t.featureStyle,n,i);const r={plugins:i,styles:{style:e,featureStyle:n}};return t.$root&&(r.$root=t.$root),r}(t):t}}function Et$2(t){return!(!t||!t.properties)}function Ft$2(t){return t?(Array.isArray(t)||(t=color(t).unitArray()),3===t.length&&t.push(1),t):null}function zt$2(t,e){return null==t?e:t}function jt$2(t,e,n){if(!t[e]||!t[e].style||!t[e].style[n])throw new Error(`No plugin defined at feature style of ${e} - ${n}`)}function Rt$2(t,e){if(!t[e])throw new Error("No plugin defined at style of "+e)}Ct$2.prototype._getTileZoom=function(e){return e=Math.floor(e),t__namespace.TileLayer.prototype._getTileZoom.call(this,e)},Ct$2.registerJSONType("VectorTileLayer"),Ct$2.mergeOptions(Ot$2),Ct$2.registerRenderer("gl",gt$3),Ct$2.registerRenderer("canvas",null);class Dt$2 extends Ct$2{getTileUrl(t,e,n){const i=this.getMap().getResolution(n);return super.getTileUrl(t,e,function(t){return 19-Math.log(t/Nt$2)/Math.LN2}(i))}static fromJSON(t){return t&&"MapboxVectorTileLayer"===t.type?new Dt$2(t.id,t.options):null}}Dt$2.registerJSONType("MapboxVectorTileLayer");const Nt$2=12756274*Math.PI/(256*Math.pow(2,20));class Lt$2 extends Ct$2{constructor(t,e={}){e.spatialReference=null,super(t,e),this.setData(e.data)}getWorkerOptions(){const t=super.getWorkerOptions();let e=this.options.data;return e=G$4(e)||e&&e.url?Vt$2(e):this.features,t.data=e,t.tileBuffer=this.options.tileBuffer,t.extent=this.options.extent,t.hasAltitude=this.options.enableAltitude,t.simplifyTolerance=this.options.simplifyTolerance,t.projection=this.getSpatialReference().getProjection().code,t}_initTileConfig(){const t=this.getSpatialReference();t&&t.getProjection()&&"EPSG:4326"===t.getProjection().code&&(this.options.tileSystem=[1,-1,-180,90]),super._initTileConfig()}setData(t){return this.options.data=t,t&&(G$4(t)||t.url)?(!!this.getRenderer()&&this.Se(),this):(this.Me(t),this.Se(),this)}Me(t){return this.options.convertFn&&(t=new Function("data",this.options.convertFn+"\nreturn convert(data)")(t)),this.features=t,this.Pe(),this}Se(){const t=this.getRenderer();if(t){const e=t.getWorkerConnection();if(e){let n=this.options.data;n=G$4(n)||n.url?Vt$2(n):this.features,e.setData(n,((e,n)=>{t.clear(),this.onWorkerReady(null,n),t.setToRedraw()}))}}}getExtent(){return this.Ie}onWorkerReady(t,e){t?this.fire("dataerror",{error:t}):(e&&(e.extent&&this.Oe(e.extent),e.idMap&&(this.Ce=e.idMap)),this.fire("dataload",{extent:e&&e.extent}))}Oe(e){this.Ie=new t__namespace.Extent(...e)}Ee(t,e){G$4(t)?Tt$2.getJSON(t,e):Tt$2.getJSON(t.url,t,e)}getData(){return this.features||null}getTileUrl(t,e,n){return this.getId()+","+t+","+e+","+n}getFeature(t){return this.Ce[t]}static fromJSON(t){return t&&"GeoJSONVectorTileLayer"===t.type?new Lt$2(t.id,t.options):null}Pe(){if(!this.features)return;if(this.features=JSON.parse(JSON.stringify(this.features)),!this.features)return;let t=0;this.Ce={};const e=this.features;Array.isArray(e)?e.forEach((e=>{e&&(null!=e.id||(e.id=t++),this.Ce[e.id]=e)})):e.features&&e.features.forEach((e=>{e&&(null!=e.id||(e.id=t++),this.Ce[e.id]=e)}))}}function Ht$2(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}function Vt$2(t){return t.url?t.url=Ht$2(t.url):t=Ht$2(t),t}Lt$2.registerJSONType("GeoJSONVectorTileLayer"),Lt$2.mergeOptions({features:"id",tileBuffer:64,extent:8192,pyramidMode:1,simplifyTolerance:3});class Ut$2 extends t__namespace.OverlayLayer{static registerPainter(t,e){Ut$2.painters||(Ut$2.painters={}),Ut$2.painters[t]=e}static get3DPainterClass(t){return Ut$2.painters[t]}updateSymbol(t,e){if(!this.options.style)throw new Error("can't call update symbol when style is not set");const n=Array.isArray(this.options.style)?this.options.style:this.options.style.style;if(!n[t])throw new Error("invalid style at "+t);return U$4(n[t].symbol,e),this.setStyle(this.options.style),this}getPolygonOffsetCount(){return 1}getPolygonOffset(){return this.fe||0}setPolygonOffset(t,e){return this.fe=t,this.de=e,this}getTotalPolygonOffset(){return this.de}identify(e,n={}){const i=this.getMap(),r=this.getRenderer();if(!i||!r)return[];const o=i.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(o,n)}identifyAtPoint(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=this.getMap().getDevicePixelRatio();return i.pick(t.x*r,t.y*r,e)}getComputedStyle(){return{style:this.getStyle()||[]}}outlineAll(){const t=this.getRenderer();return t?(t.outlineAll(),this):this}outline(t){if(!Array.isArray(t)||!t.length)return this;const e=this.getRenderer();return e?(e.outline(t),this):this}cancelOutline(){const t=this.getRenderer();return t?(t.cancelOutline(),this):this}toJSON(){const t={type:this.getJSONType(),id:this.getId(),options:this.config(),geometries:[]},e=this.getGeometries();for(let n=0,i=e.length;n<i;n++){const i=e[n].toJSON();t.geometries.push(i)}return t}}Ut$2.mergeOptions({picking:!0,renderer:"gl",collision:!1,textGamma:1,geometryEvents:!0,styleScale:1,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,meshRenderOrder:0,enableBloom:!1,workarounds:{"win-intel-gpu-crash":!0}});const Gt$2={markerFile:{type:"identity",default:void 0,property:"_symbol_markerFile"},markerWidth:{type:"identity",default:20,property:"_symbol_markerWidth"},markerHeight:{type:"identity",default:20,property:"_symbol_markerHeight"},markerPathWidth:{type:"identity",default:20,property:"_symbol_markerPathWidth"},markerPathHeight:{type:"identity",default:20,property:"_symbol_markerPathHeight"},markerDx:{type:"identity",default:void 0,property:"_symbol_markerDx"},markerDy:{type:"identity",default:void 0,property:"_symbol_markerDy"},markerType:{type:"identity",default:void 0,property:"_symbol_markerType"},markerPath:{type:"identity",default:void 0,property:"_symbol_markerPath"},markerFill:{type:"identity",default:void 0,property:"_symbol_markerFill"},markerFillPatternFile:{type:"identity",default:void 0,property:"_symbol_markerFillPatternFile"},markerFillOpacity:{type:"identity",default:void 0,property:"_symbol_markerFillOpacity"},markerLineColor:{type:"identity",default:void 0,property:"_symbol_markerLineColor"},markerLineWidth:{type:"identity",default:void 0,property:"_symbol_markerLineWidth"},markerLineOpacity:{type:"identity",default:void 0,property:"_symbol_markerLineOpacity"},markerLineDasharray:{type:"identity",default:void 0,property:"_symbol_markerLineDasharray"},markerLinePatternFile:{type:"identity",default:void 0,property:"_symbol_markerLinePatternFile"},markerVerticalAlignment:{type:"identity",default:"top",property:"_symbol_markerVerticalAlignment"},markerHorizontalAlignment:{type:"identity",default:"middle",property:"_symbol_markerHorizontalAlignment"},markerOpacity:{type:"identity",default:1,property:"_symbol_markerOpacity"},markerPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_markerPitchAlignment"},markerRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_markerRotationAlignment"},markerRotation:{type:"identity",default:0,property:"_symbol_markerRotation"},markerAllowOverlap:{type:"identity",default:0,property:"_symbol_markerAllowOverlap"},markerIgnorePlacement:{type:"identity",default:0,property:"_symbol_markerIgnorePlacement"},markerTextFit:{type:"identity",default:null,property:"_symbol_markerTextFit"},markerSpacing:{type:"identity",default:250,property:"_symbol_markerSpacing"},markerTextFitPadding:{type:"identity",default:null,property:"_symbol_markerTextFitPadding"},markerPlacement:{type:"identity",default:"point",property:"_symbol_markerPlacement"}},Wt$2={textName:{type:"identity",default:void 0,property:"_symbol_textName"},textFaceName:{type:"identity",default:void 0,property:"_symbol_textFaceName"},textWeight:{type:"identity",default:void 0,property:"_symbol_textWeight"},textStyle:{type:"identity",default:void 0,property:"_symbol_textStyle"},textWrapWidth:{type:"identity",default:void 0,property:"_symbol_textWrapWidth"},textHorizontalAlignment:{type:"identity",default:void 0,property:"_symbol_textHorizontalAlignment"},textVerticalAlignment:{type:"identity",default:void 0,property:"_symbol_textVerticalAlignment"},textFill:{type:"identity",default:void 0,property:"_symbol_textFill"},textSize:{type:"identity",default:void 0,property:"_symbol_textSize"},textHaloRadius:{type:"identity",default:void 0,property:"_symbol_textHaloRadius"},textHaloFill:{type:"identity",default:void 0,property:"_symbol_textHaloFill"},textHaloOpacity:{type:"identity",default:1,property:"_symbol_textHaloOpacity"},textDx:{type:"identity",default:void 0,property:"_symbol_textDx"},textDy:{type:"identity",default:void 0,property:"_symbol_textDy"},textOpacity:{type:"identity",default:1,property:"_symbol_textOpacity"},textPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_textPitchAlignment"},textRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_textRotationAlignment"},textRotation:{type:"identity",default:0,property:"_symbol_textRotation"},textAllowOverlap:{type:"identity",default:0,property:"_symbol_textAllowOverlap"},textIgnorePlacement:{type:"identity",default:0,property:"_symbol_textIgnorePlacement"},textSpacing:{type:"identity",default:250,property:"_symbol_textSpacing"},textPlacement:{type:"identity",default:"point",property:"_symbol_textPlacement"}},qt$2={lineWidth:{type:"identity",default:2,property:"_symbol_lineWidth"},lineStrokeWidth:{type:"identity",default:0,property:"_symbol_lineStrokeWidth"},lineColor:{type:"identity",default:[1,1,1,1],property:"_symbol_lineColor"},lineStrokeColor:{type:"identity",default:[0,0,0,0],property:"_symbol_lineStrokeColor"},lineDx:{type:"identity",default:0,property:"_symbol_lineDx"},lineDy:{type:"identity",default:0,property:"_symbol_lineDy"},linePatternFile:{type:"identity",default:void 0,property:"_symbol_linePatternFile"},linePatternAnimSpeed:{type:"identity",default:0,property:"_symbol_linePatternAnimSpeed"},linePatternGap:{type:"identity",default:0,property:"_symbol_linePatternGap"},lineOpacity:{type:"identity",default:1,property:"_symbol_lineOpacity"},lineJoin:{type:"identity",default:void 0,property:"_symbol_lineJoin"},lineCap:{type:"identity",default:void 0,property:"_symbol_lineCap"},lineDasharray:{type:"identity",default:void 0,property:"_symbol_lineDasharray"},lineDashColor:{type:"identity",default:void 0,property:"_symbol_lineDashColor"}},$t$2=new t__namespace.Point(0,0),Bt$2="_vector3dlayer_id",Xt$2="_line_gradient_property".trim();function Yt$2(e,n,i){const r="__fea_idx".trim(),o=e.getMap(),s=o.getGLRes();let a=e.getCoordinates();const l=[];let h=1;if(e instanceof t__namespace.Marker||e instanceof t__namespace.MultiPoint){e instanceof t__namespace.Marker&&(a=[a]);for(let t=0;t<a.length;t++)o.coordToPointAtRes(a[t],s,$t$2),l.push([$t$2.x,$t$2.y,a[t].z||0])}else if(e instanceof t__namespace.LineString||e instanceof t__namespace.MultiLineString){h=2,e instanceof t__namespace.LineString&&(a=[a]);for(let t=0;t<a.length;t++){l[t]=[];for(let e=0;e<a[t].length;e++)o.coordToPointAtRes(a[t][e],s,$t$2),l[t].push([$t$2.x,$t$2.y,a[t][e].z||0])}}else if(e instanceof t__namespace.Polygon||e instanceof t__namespace.MultiPolygon){h=3,e instanceof t__namespace.Polygon&&(a=[a]);let n=0;for(let t=0;t<a.length;t++)for(let e=0;e<a[t].length;e++){l[n]=[];for(let i=0;i<a[t][e].length;i++)o.coordToPointAtRes(a[t][e][i],s,$t$2),l[n].push([$t$2.x,$t$2.y,a[t][e][i].z||0]);n++}}const c=e.getProperties()?Object.assign({},e.getProperties()):{},u=e._getInternalSymbol(),f=i?Array.isArray(i)?i[0][r]:i[r]:n.id++;if(Array.isArray(u)&&u.length){const t=[],o=u.length;for(let s=0;s<o;s++){const a=s===o-1?c:U$4({},c),d=Jt$2(u[s],a);for(const t in u[s])B$4(u[s],t)&&(a[("_symbol_"+t).trim()]=u[s][t]);d&&(u[s].lineGradientProperty=d);const p=i&&i[s]?i[s][r]:n.pickingId++,m={type:h,id:f,properties:a,visible:e.isVisible(),geometry:l,extent:1/0};m[r]=p,t.push(m)}return t}if(u){const t=Jt$2(u,c);for(const t in u)B$4(u,t)&&(c[("_symbol_"+t).trim()]=u[t]);t&&(u.lineGradientProperty=t)}const d=i?i.id:n.pickingId++,p={type:h,id:f,properties:c,visible:e.isVisible(),geometry:l,extent:1/0};return p[r]=d,p}function Jt$2(t,e){const n=t.lineGradientProperty;return n&&(e[Xt$2]=e[n],e.mapbox_clip_start=0,e.mapbox_clip_end=1,delete e[n]),n}let Zt$2=1;const Kt$2="_symbol_".trim(),Qt$2="__fea_idx".trim();let te$2=new Float32Array(1);const ee$2=[];class ne$2 extends t__namespace.renderer.CanvasRenderer{constructor(...t){super(...t),this.features={},this.Fe={},this.R=0,this.ze={},this.je={},this.Re={},this.De={},this.Ne={},this.Le=!0,this.He={id:0,pickingId:0},this.Ve=U$4({},Gt$2,Wt$2),this.Ue={}}hasNoAARendering(){return!0}needToRedraw(){return super.needToRedraw()||this.painter&&this.painter.needToRedraw()||this.Ge&&this.Ge.needToRedraw()||this.We&&this.We.needToRedraw()}getAnalysisMeshes(){return ee$2}getRayCastData(){return null}draw(t,e){const n=this.layer;if(this.prepareCanvas(),this.dt=this.pt(this.getMap().getGLRes()),this.Le)this.buildMesh(),this.qe(),this.$e(),this.Ue={},this.Be=!1,this.Le=!1,this.Xe=!1;else if(this.Be){const t=this.atlas,e=this.Ye,n=this.Je;delete this.atlas,delete this.Ye,delete this.Je,this.buildMesh(t),this.qe(e),this.$e(n),this.Be=!1,this.Xe=!1}else if(this.Xe){const t=this.Je;delete this.Je,this.$e(t),this.Xe=!1}if(!this.meshes&&!this.Ze&&!this.Ke)return void this.completeRender();this.Qe&&(this.tn(),this.Qe=!1),this.en(),this.ft=t,this.yt=e||{};const i=this.yt.renderMode,r=!i||"default"===i,o=this.nn();let s=0;0===this.layer.options.meshRenderOrder&&this.in(o,s++,i),this.Ke&&(r||this.We.supportRenderMode(i))&&(this.We.startFrame(o),this.We.addMesh(this.Ke,null,{bloom:this.yt.bloom}),this.We.prepareRender(o),o.polygonOffsetIndex=s++,this.We.render(o)),1===this.layer.options.meshRenderOrder&&this.in(o,s++,i),this.Ze&&(r||this.Ge.supportRenderMode(i))&&(n.options.collision&&n.clearCollisionIndex(),this.Ge.startFrame(o),this.Ge.addMesh(this.Ze,null,{bloom:this.yt.bloom}),this.Ge.prepareRender(o),n.options.collision&&this.Ge.updateCollision(o),this.Ge.render(o)),(r||e&&e.isFinalRender)&&(this.completeRender(),this.layer.fire("canvasisdirty"))}in(t,e,n){this.painter&&this.meshes&&(!n||"default"===n||this.painter.supportRenderMode(n))&&(this.painter.startFrame(t),this.painter.addMesh(this.meshes,null,{bloom:t&&t.bloom}),this.painter.prepareRender(t),t.polygonOffsetIndex=e++,this.painter.render(t))}supportRenderMode(){return!0}isForeground(){return!0}nn(){const t={regl:this.regl,layer:this.layer,symbol:this.rn,gl:this.gl,sceneConfig:this.layer.options.sceneConfig,pluginIndex:0,cameraPosition:this.getMap().cameraPosition,timestamp:this.getFrameTimestamp()};return this.yt&&U$4(t,this.yt),t}drawOnInteracting(t,e,n){this.draw(e,n)}getFrameTimestamp(){return this.ft}sn(t,e){(t=t||e)===e&&(e=null);const n=[],i=[0,0,0,0];this.layer._sortGeometries();const r=this.layer.getGeometries();for(let o=0;o<r.length;o++){const s=r[o][Bt$2];if(!this.features[s])continue;const a=this.features[s];if(Array.isArray(a))for(let r=0;r<a.length;r++){const o=a[r],s=o[Qt$2];(!t||t[s]||e&&(!e||e[s]))&&(o.visible||(this.Qe=!0),this.an(o.geometry,i),n.push(o))}else{a.visible||(this.Qe=!0);const r=a[Qt$2];if(t&&!t[r]&&(!e||e&&!e[r]))continue;this.an(a.geometry,i),n.push(a)}}if(n.length||(this.meshes&&this.painter&&(this.painter.deleteMesh(this.meshes),delete this.meshes),this.Ze&&(this.Ge.deleteMesh(this.Ze),delete this.Ze),this.Ke&&(this.We.deleteMesh(this.Ke),delete this.Ke)),i[3]&&(i[0]/=i[3],i[1]/=i[3]),isNaN(i[0])||isNaN(i[1]))throw new Error("invalid geometry coordinates for "+this.layer.getJSONType());return{features:n,center:i}}buildMesh(){}createVectorPacks(t,e,n,i,r,o){return t&&i&&i.length?new e(i,n,{zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.requestor,atlas:r,center:o,positionType:Float32Array}).load():Promise.resolve(null)}createMesh(t,e,n,o,s,a){const l=[],h=[];return this.createVectorPacks(t,e,n,o,s,a).then((e=>{if(!e)return null;const s=t.createGeometries([e.data],st$3(o,null,0,n,this.layer));for(let t=0;t<s.length;t++)this.ln(s[t].geometry);const c=identity$2([]);translate$1(c,c,set$4(h,a[0],a[1],0)),scale$5(c,c,set$4(l,1,1,this.dt));const u=t.createMeshes(s,c,{tilePoint:[a[0],a[1]]});for(let t=0;t<u.length;t++){const e=u[t];e.properties.level=0;const n=e.defines;n.ENABLE_TILE_STENCIL=1,e.setDefines(n),e.properties.meshKey=this.layer.getId()}return{meshes:u,atlas:{iconAtlas:e.data.iconAtlas}}}))}an(t,e){for(let n=0;n<t.length;n++)if(Array.isArray(t[n][0]))for(let i=0;i<t[n].length;i++)if(Array.isArray(t[n][i][0]))for(let r=0;r<t[n][i].length;r++)isNaN(+t[n][i][r][0])||isNaN(+t[n][i][r][1])||(e[0]+=t[n][i][r][0],e[1]+=t[n][i][r][1],e[3]+=1);else isNaN(+t[n][i][0])||isNaN(+t[n][i][1])||(e[0]+=t[n][i][0],e[1]+=t[n][i][1],e[3]+=1);else isNaN(+t[n][0])||isNaN(+t[n][1])||(e[0]+=t[n][0],e[1]+=t[n][1],e[3]+=1)}ln(t){const e=this.getMap(),n=t.properties;Object.defineProperty(n,"tileResolution",{enumerable:!0,get:function(){return e.getGLRes()}}),n.tileRatio=1,n.z=1,n.tileExtent=1,n.elements=t.elements,n.aPickingId=t.data.aPickingId}hn(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&re$2(this.gl)}prepareRequestors(){if(this.h)return;const t=this.layer;this.h=new Qo$1({iconErrorUrl:t.options.iconErrorUrl});const e=!this.hn("win-intel-gpu-crash");this.u=new Yo$1((e=>{t.getMap().getRenderer().callInNextFrame(e)}),t.options.glyphSdfLimitPerFrame,e),this.requestor=this.cn.bind(this),this.un=this.dn.bind(this)}cn(t,e,n){const i=[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&i.push(...e.buffers),n(null,{icons:e.icons},i)}))}dn(t,e,n){this.u.getGlyphs(e,((e,i)=>{if(e)throw e;const r=i.buffers||[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&e.buffers.length&&r.push(...e.buffers),n(null,{icons:e.icons,glyphs:i.glyphs},r)}))}))}qe(t){const e=Object.keys(this.Re),n=Object.keys(this.De);if(!e.length&&!n.length)return void(this.Ze&&(this.Ge.deleteMesh(this.Ze),delete this.Ze));const{features:o,center:s}=this.sn(this.Re,this.De),a=[],l=[];for(let t=0;t<o.length;t++){const e=o[t][Qt$2];this.Re[e]&&a.push(o[t]),this.De[e]&&l.push(o[t])}if(!a.length&&!l.length)return void(this.Ze&&(this.Ge.deleteMesh(this.Ze),delete this.Ze));const h=this.Qe;this.pn=s;const c=this.mn(a,l,t,s);this.Ye={};const u=[],f=[];this.yn=!0,Promise.all(c).then((t=>{if(this.Ze&&(this.Ge.deleteMesh(this.Ze),delete this.Ze),!t||!t.length)return void this.setToRedraw();const e=this.Ge.createGeometries(t.map((t=>(t&&t.data&&(t.data.isIdUnique=!0),t&&t.data))),this.ze);for(let n=0;n<e.length;n++)this.ln(e[n].geometry,t[n]&&t[n].data);const n=t[0]&&t[0].data.iconAtlas,o=t[0]&&t[0].data.glyphAtlas||t[1]&&t[1].data.glyphAtlas;n&&(this.Ye.iconAtlas=n),o&&(this.Ye.glyphAtlas=o);const a=identity$2([]);translate$1(a,a,set$4(f,s[0],s[1],0)),scale$5(a,a,set$4(u,1,1,this.dt));const l=this.Ge.createMeshes(e,a);for(let t=0;t<l.length;t++)l[t].geometry.properties.originElements=l[t].geometry.properties.elements.slice(),l[t].properties.level=0,l[t].material.set("flipY",1),l[t].properties.meshKey=Zt$2++;this.Ze=l,h&&(this.Qe=!0),this.yn=!1,this.setToRedraw()}))}tn(){if(this.Ze&&(this.gn(this.Ze[0],this.Re),this.gn(this.Ze[1],this.De)),this.Ke)for(let t=0;t<this.Ke.length;t++)this.gn(this.Ke[t],this.Ne);if(this.meshes)for(let t=0;t<this.meshes.length;t++)this.gn(this.meshes[t],this.ze)}gn(t,e){if(!t)return;const{aPickingId:n,originElements:i}=t.geometry.properties,r=[];for(let t=0;t<i.length;t++){const o=n[i[t]];e[o]&&e[o].feature.visible&&r.push(i[t])}const o=t.geometry.properties.elements=new i.constructor(r);t.geometry.setElements(o)}mn(t,e,n,i){const r={zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.un,atlas:n,center:i,positionType:Float32Array,defaultAltitude:0,forceAltitudeAttribute:!0,markerWidthType:Uint16Array,markerHeightType:Uint16Array},o=U$4({},r);return r.allowEmptyPack=1,io$2.splitPointSymbol(this.Ve).map(((n,i)=>new io$2(0===i?t:e,n,0===i?r:o).load()))}updateMesh(){}vn(t){const e=t._getInternalSymbol(),n={zoom:this.getMap().getZoom()},i=this.bn(t);if(!this.Ze)return!1;let r=this.features[i];Array.isArray(r)||(r=[r]);const o=[],s=[],a=[],l=this.getMap().getZoom();let h,c;h=Array.isArray(e)?e.map((t=>t?loadFunctionTypes(t,(()=>(o[0]=l,o))):t)):loadFunctionTypes(e,(()=>(o[0]=l,o))),c=Array.isArray(e)?e.map((t=>t?mr$3.genFnTypes(t):t)):mr$3.genFnTypes(e);for(let t=0;t<r.length;t++){if(!r[t])continue;const i=Array.isArray(e)?e[t]:e,o=Array.isArray(h)?h[t]:h,s=Array.isArray(c)?c[t]:c,a=new Rn$2(r,i,o,s,n).getIconAndGlyph();if(!this.Ye||!io$2.isAtlasLoaded(a,this.Ye))return this.xn(),this.setToRedraw(),!1}for(let t=0;t<r.length;t++){const e=r[t][Qt$2];this.Re[e]&&s.push(r[t]),this.De[e]&&a.push(r[t])}const u=r[0].id,f=this.mn(s,a,this.Ye,this.pn),d=this.Ze;return Promise.all(f).then((t=>{for(let e=0;e<t.length;e++){if(!t[e])continue;t[e].data&&(t[e].data.isIdUnique=!0);const n=d[e],i=n.geometry.properties.aFeaIds.indexOf(u);if(i<0)continue;const r=t[e].data.featureIds.length;for(const o in t[e].data.data){if("aPickingId"===o)continue;const s=t[e].data.data[o];n.geometry.updateSubData(o,s,i*s.length/r)}}this.setToRedraw()})),!0}wn(t){return this.An(t,this.Ke,this.Je,this.kn,this.We,uo$2,qt$2,this._n)}An(t,e,n,i,r,o,s,a){if(!e)return!1;if(!n)return this.xn(),this.setToRedraw(),!1;const l=t._getInternalSymbol(),h={zoom:this.getMap().getZoom()};let u=this.features[t[Bt$2]];Array.isArray(u)||(u=[u]);const f=[];for(let t=0;t<u.length;t++){const e=u[t];if(!e)continue;const i=Array.isArray(l)?l[t]:l,r=mr$3.genFnTypes(i),s=new ce$3(u,i,r,h),a=o===uo$2?s.getLineResource():s.getPolygonResource();if(!mr$3.isAtlasLoaded(a,n[t]))return this.xn(),this.setToRedraw(),!1;f.push(e)}const d=u[0].id,p=a.call(this,f);for(let t=0;t<p.length;t++)if(p[t].length){const n=e.filter((e=>e.feaGroupIndex===t));if(!n.length)return this.xn(),this.setToRedraw(),!1;if(n[0].geometry.properties.aFeaIds.indexOf(d)<0)return this.xn(),this.setToRedraw(),!1}const m=U$4({},s),y=p.map((t=>this.createVectorPacks(r,o,m,t,n[0],i)));return Promise.all(y).then((t=>{for(let n=0;n<t.length;n++){let i;if(Array.isArray(e)){for(let t=0;t<e.length;t++)if(e[t].feaGroupIndex===n){i=e[t];break}}else i=e;if(!i)continue;const r=i.geometry.properties.aFeaIds,o=r.indexOf(d);if(!(o<0)){if(t[n]){const e=t[n].data.featureIds.length,r=t[n].data.data;for(const t in r)if(B$4(r,t)){const n=r[t];i.geometry.updateSubData(t,n,o*n.length/e)}}else{let t=o+1;for(;r[t]===d;)t++;const e=t-o,n=i.geometry.desc.positionSize;te$2.length!==3*e&&(te$2=new Float32Array(e*n),te$2.fill(-1/0,0)),i.geometry.updateSubData(i.geometry.desc.positionAttribute,te$2,o*n)}this.layer.fire("updatemesh"),this.setToRedraw()}}})),!0}$e(t){if(!Object.keys(this.Ne).length)return void(this.Ke&&(this.We.deleteMesh(this.Ke),delete this.Ke));const{features:e,center:n}=this.sn(this.Ne);if(!e.length)return;const i=this.Qe;this.kn=n;const r=this._n(e),o=U$4({},qt$2),s=r.map(((e,i)=>this.createMesh(this.We,uo$2,o,e,t&&t[i],n)));this.Tn=!0,Promise.all(s).then((t=>{this.Ke&&this.We.deleteMesh(this.Ke);const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i]&&t[i].meshes;if(r){for(let t=0;t<r.length;t++){const n=r[t];n.feaGroupIndex=i,e.push(n),n.geometry.properties.originElements=n.geometry.properties.elements.slice()}n[i]=t[i].atlas}}this.Ke=e,this.Je=n,i&&(this.Qe=i),this.Tn=!1,this.setToRedraw()}))}_n(t){const e=(Kt$2+"lineDasharray").trim(),n=(Kt$2+"linePatternFile").trim(),i=[],r=[],o=[];for(let s=0;s<t.length;s++){const a=t[s],l=a.properties&&a.properties[e];l&&ce$2(l)?o.push(a):a.properties&&a.properties[n]?r.push(a):i.push(a)}return[r,o,i]}Sn(){this.Be=!0,this.setToRedraw()}xn(){this.Le=!0,this.setToRedraw()}Mn(t){const e=this.layer.getId();for(let n=0;n<t.length;n++){const i=t[n];let r=!1;for(let t=0;t<this.GeometryTypes.length;t++)if(i instanceof this.GeometryTypes[t]){r=!0;break}if(!r)throw new Error(`${i.getJSONType()} can't be added to ${this.layer.getJSONType()}(id:${e}).`);this.bn(i)}}bn(t){void 0===t[Bt$2]&&(t[Bt$2]=this.R++);const e=t[Bt$2];this.features[e]&&this.Pn(e),this.features[e]=Yt$2(t,this.He,this.features[e]);return this.In(this.features[e],e),this.Fe[e]=t,e}In(t,e){if(!t)return;const n=Array.isArray(t)?t[0].id:t.id;if(this.je[n]=t,Array.isArray(t))for(let n=0;n<t.length;n++){const i=t[n][Qt$2];t[n][Bt$2]=e,this.ze[i]={feature:t[n]},this.ze[i][Bt$2]=e;const r={feature:t[n]};oe$2(t[n])&&(this.Re[i]=r),se$2(t[n])&&(this.De[i]=r),he$2(t[n])&&(this.Ne[i]=r)}else{t[Bt$2]=e;const n={feature:t},i=t[Qt$2];oe$2(t)&&(this.Re[i]=n),se$2(t)&&(this.De[i]=n),he$2(t)&&(this.Ne[i]=n),this.ze[i]=n}}Pn(t){const e=this.features[t];if(e)if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=e[t][Qt$2];delete this.je[e[t].id],delete this.ze[n],delete this.Re[n],delete this.De[n],delete this.Ne[n]}else{const t=e[Qt$2];delete this.je[e.id],delete this.ze[t],delete this.Re[t],delete this.De[t],delete this.Ne[t]}}pick(t,e,n){const i=[];return this.layer.isVisible()?([this.painter,this.Ge,this.We].forEach((r=>{if(!r)return;const o=r.pick(t,e,n.tolerance);if(o&&o.data&&o.data.feature){i.push(this.Fe[o.data.feature[Bt$2]])}})),i):i}On(t){const n=this.features[t[Bt$2]];return Array.isArray(n)?n[0][Qt$2]:n[Qt$2]}en(){let t=!1;for(const e in this.Ue){const n=this.Ue[e],i=this.On(n);if(!this.yn&&(this.Re[i]||this.De[i])){const e=this.vn(n);t=t||e}if(!this.Tn&&this.Ne[i]){const e=this.wn(n);t=t||e}if(!this.Cn){const e=this.updateMesh(n);t=t||e}}this.Ue={},t&&(ie$2(this),this.layer.fire("partialupdate"))}En(t){this.bn(t),this.xn(),ie$2(this)}onGeometryAdd(t){this.setToRedraw(),this.canvas&&t&&t.length&&(this.Mn(t),this.xn(),ie$2(this))}onGeometryRemove(t){if(t&&t.length){for(let e=0;e<t.length;e++){const n=t[e][Bt$2];void 0!==n&&(delete this.Fe[n],this.Pn(n),delete this.features[n])}this.xn(),ie$2(this)}}onGeometrySymbolChange(t){const e=t.target._getParent()||t.target,n=t.properties;for(const t in n)if(B$4(n,t)&&ua[t])return void this.En(e);const i=e[Bt$2],r=e._getInternalSymbol(),o=this.features[i];if(this.bn(e),o)if(function(t,e){return Array.isArray(t)?!!Array.isArray(e)&&t.length===e.length:!Array.isArray(e)}(r,o)){if(Array.isArray(r)){for(let t=0;t<r.length;t++)if(!ue$2(r[t],o[t]))return void this.En(e)}else if(!ue$2(r,o))return void this.En(e);this.onGeometryPositionChange(t)}else this.En(e);else this.En(e)}onGeometryShapeChange(t){const e=t.target._getParent()||t.target,n=Yt$2(e,{id:0}).geometry,r=this.features[e[Bt$2]];if(function t(e,n){if(e.length!==n.length)return!1;if(Array.isArray(e[0])&&Array.isArray(n[0])){for(let i=0;i<e.length;i++)if(!t(e[0],n[0]))return!1}else if(Array.isArray(e[0])||Array.isArray(n[0]))return!1;return!0}(n,(Array.isArray(r)?r[0]:r).geometry))return this.Ke&&(this.Xe=!0),void this.onGeometryPositionChange(t);this.Mn([e]),this.Sn(),ie$2(this)}onGeometryPositionChange(t){const e=t.target._getParent()||t.target,n=e[Bt$2];this.Mn([e]),this.Ue[n]=e,ie$2(this)}onGeometryZIndexChange(){this.xn()}onGeometryShow(t){this.Fn(t)}onGeometryHide(t){this.Fn(t)}Fn(t){const e=t.target,i=this.features[e[Bt$2]];if(i){const t=e.isVisible();if(Array.isArray(i)){if(t===i[0].visible)return;for(let e=0;e<i.length;e++)i[e].visible=t}else{if(t===i.visible)return;i.visible=t}this.zn(),ie$2(this)}}zn(){this.Qe=!0}onGeometryPropertiesChange(t){const e=t.target,n=e[Bt$2];this.features[n]=Yt$2(e,this.He),this.In(this.features[n],n),this.xn(),ie$2(this)}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;t?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this.rt(),t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.prepareRequestors(),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=this.createPainter();const e=Ut$2.get3DPainterClass("icon"),n=U$4({},Gt$2,Wt$2);this.jn(n,"markerBloom"),this.jn(n,"textBloom");const i=U$4({},K$4,this.layer.options.sceneConfig||{});this.Ge=new e(this.regl,this.layer,n,i,0),this.Ge.setTextShaderDefines({REVERSE_MAP_ROTATION_ON_PITCH:1});const r=Ut$2.get3DPainterClass("line"),o=U$4({},qt$2);this.jn(o,"lineBloom"),this.We=new r(this.regl,this.layer,o,this.layer.options.sceneConfig,0),this.layer.getGeometries()&&this.onGeometryAdd(this.layer.getGeometries())}jn(t,e){const n=this.layer;Object.defineProperty(t,e,{enumerable:!0,get:function(){return n&&n.options.enableBloom}})}createPainter(){}rt(){const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0,antialias:!1};t.preserveDrawingBuffer=!0,t.stencil=!0,this.glOptions=t,this.gl=this.gl||this.lt(this.canvas,t),this.regl=h$1({gl:this.gl,attributes:t,extensions:z$6.WEBGL_EXTENSIONS,optionalExtensions:z$6.WEBGL_OPTIONAL_EXTENSIONS})}lt(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let r=0;r<n.length;++r){try{i=t.getContext(n[r],e)}catch(t){}if(i)break}return i}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:255})}resizeCanvas(t){super.resizeCanvas(t);const e=this.canvas;e&&(!this.pickingFBO||this.pickingFBO.width===e.width&&this.pickingFBO.height===e.height||this.pickingFBO.resize(e.width,e.height),this.painter&&this.painter.resize(e.width,e.height))}onRemove(){super.onRemove(),this.painter&&this.painter.delete(),this.Ge&&this.Ge.delete(),this.We&&this.We.delete()}drawOutline(t){if(this.kt&&(this.painter&&this.painter.outlineAll(t),this.Ge.outlineAll(t),this.We.outlineAll(t)),this.Rn)for(let e=0;e<this.Rn.length;e++)this.painter&&this.painter.outline(t,this.Rn[e]),this.Ge.outline(t,this.Rn[e]),this.We.outline(t,this.Rn[e])}outlineAll(){this.kt=!0,this.setToRedraw()}outline(t){this.Rn||(this.Rn=[]);const e=[];for(let n=0;n<t.length;n++){const i=this.layer.getGeometryById(t[n]);if(i){const t=this.features[i[Bt$2]];if(Array.isArray(t))for(let n=0;n<t.length;n++)e.push(t[n].id);else e.push(t.id)}}this.Rn.push(e),this.setToRedraw()}cancelOutline(){delete this.kt,delete this.Rn,this.setToRedraw()}isEnableWorkAround(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&re$2(this.gl)}pt(t){return X$4(t,this.getMap())}}function ie$2(t){t.setToRedraw()}function re$2(t){const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&"undefined"!=typeof navigator){const n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),i="Win32"===navigator.platform||"Win64"===navigator.platform;if(n&&n.toLowerCase().indexOf("intel")>=0&&i)return!0}return!1}function oe$2({properties:t}){const e=(Kt$2+"markerFile").trim(),n=(Kt$2+"markerType").trim();return t[e]||t[n]}function se$2({properties:t}){return t[(Kt$2+"textName").trim()]}const ae$2=(Kt$2+"lineWidth").trim(),le$2="_line_gradient_property".trim();function he$2(t){return 2===t.type&&!t.properties[le$2]&&void 0!==t.properties[ae$2]||3===t.type&&void 0!==t.properties[ae$2]}function ce$2(t){if(!Array.isArray(t))return 0;let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function ue$2(t,e){if(Object.keys(t).sort().join()!==Object.keys(e.properties||{}).filter((t=>0===t.indexOf(Kt$2))).map((t=>t.substring(Kt$2.length))).sort().join())return!1;for(const n in t)if(B$4(t,n)){const i=(Kt$2+n).trim();if(isFunctionDefinition(t[n])!==isFunctionDefinition(e.properties[i]))return!1}return!0}function fe$2(e,n,i){if(!e||e.type!==n)return null;const r=new i(e.id,e.options),o=e.geometries,s=[];for(let e=0;e<o.length;e++){const n=t__namespace.Geometry.fromJSON(o[e]);n&&s.push(n)}return r.addGeometry(s),r}const de$2={glyphSdfLimitPerFrame:15,iconErrorUrl:null,workarounds:{"win-intel-gpu-crash":!0},collision:!1,collisionFrameLimit:1,sceneConfig:K$4};class pe$2 extends Ut$2{static fromJSON(t){return fe$2(t,"PointLayer",pe$2)}}pe$2.mergeOptions(de$2),pe$2.registerJSONType("PointLayer"),pe$2.registerRenderer("canvas",null),pe$2.registerRenderer("gl",class extends ne$2{constructor(...e){super(...e),this.GeometryTypes=[t__namespace.Marker,t__namespace.MultiPoint]}onGeometryAdd(t){t&&(Array.isArray(t)?t.forEach((t=>{t.options.maxMarkerWidth=t.options.maxMarkerHeight=255})):t.options.maxMarkerWidth=t.options.maxMarkerHeight=255,super.onGeometryAdd(t))}});class me$2 extends Ut$2{static fromJSON(t){return fe$2(t,"LineStringLayer",me$2)}}me$2.mergeOptions({meshRenderOrder:1}),me$2.registerJSONType("LineStringLayer");const ye$2="_line_gradient_property".trim();me$2.registerRenderer("gl",class extends ne$2{constructor(...e){super(...e),this.GeometryTypes=[t__namespace.LineString,t__namespace.MultiLineString]}createPainter(){const t=Ut$2.get3DPainterClass("line-gradient");return this.painterSymbol=U$4({},{lineGradientProperty:ye$2},qt$2),this.jn(this.painterSymbol,"lineBloom"),new t(this.regl,this.layer,this.painterSymbol,this.layer.options.sceneConfig,0)}buildMesh(){let{features:t,center:e}=this.sn();if(t=t.filter((t=>!!t.properties[ye$2])),!t.length)return;const n=this.Qe;this.Dn=e;const i=U$4({},this.painterSymbol),r=this.createMesh(this.painter,uo$2,i,t,null,e);this.Cn=!0,r.then((t=>{this.meshes&&this.painter.deleteMesh(this.meshes);const e=[],i=t&&t.meshes;if(i){e.push(...i);for(let t=0;t<i.length;t++)i[t].feaGroupIndex=0,i[t].geometry.properties.originElements=i[t].geometry.properties.elements.slice()}this.meshes=e,n&&(this.Qe=n),this.Cn=!1,this.setToRedraw()}))}}),me$2.registerRenderer("canvas",null);class ge$2 extends Ut$2{static fromJSON(t){return fe$2(t,"PolygonLayer",ge$2)}}ge$2.registerJSONType("PolygonLayer");const ve$2={polygonFill:{type:"identity",default:void 0,property:"_symbol_polygonFill"},polygonPatternFile:{type:"identity",default:void 0,property:"_symbol_polygonPatternFile"},polygonOpacity:{type:"identity",default:1,property:"_symbol_polygonOpacity"},uvScale:{type:"identity",default:[1,1],property:"_symbol_uvScale"},uvOffset:{type:"identity",default:[0,0],property:"_symbol_uvOffset"}};ge$2.registerRenderer("gl",class extends ne$2{constructor(...e){super(...e),this.PackClass=Po$2,this.GeometryTypes=[t__namespace.Polygon,t__namespace.MultiPolygon]}buildMesh(t){const{features:e,center:n}=this.sn();if(!e.length)return;const i=this.Qe;this.Dn=n;const r=this.Nn(e),o=U$4({},ve$2),s=r.map(((e,i)=>this.createMesh(this.painter,Po$2,o,e,t&&t[i],n)));this.Cn=!0,Promise.all(s).then((t=>{this.meshes&&this.painter.deleteMesh(this.meshes);const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i]&&t[i].meshes;if(r){e.push(...r);for(let t=0;t<r.length;t++)r[t].feaGroupIndex=i,r[t].geometry.properties.originElements=r[t].geometry.properties.elements.slice(),1===i&&(r[t].transparent=!0);n[i]=t[i].atlas}}this.meshes=e,this.atlas=n,i&&(this.Qe=i),this.Cn=!1,this.setToRedraw()}))}getAnalysisMeshes(){return this.painter.getAnalysisMeshes()}getRayCastData(t,e){const n=this.painter.getRayCastData(t,e);if(!n||!n.feature)return null;return this.Fe[n.feature[Bt$2]]}Nn(t){const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i];r.properties&&r.properties._symbol_polygonOpacity<1?n.push(r):e.push(r)}return[e,n]}createPainter(){const t=Ut$2.get3DPainterClass("fill");return this.painterSymbol=U$4({},ve$2),this.jn(this.painterSymbol,"polygonBloom"),new t(this.regl,this.layer,this.painterSymbol,this.layer.options.sceneConfig,0)}updateMesh(t){return this.An(t,this.meshes,this.atlas,this.Dn,this.painter,Po$2,ve$2,this.Nn)}}),ge$2.registerRenderer("canvas",null);const be$2={redraw:!1,retire:!1},xe$2=[];let we$2=1;function Ae$2(t,e){return VectorTilePlugin.extend(t,{init:function(){this.Ln={}},isVisible(){return this.painter&&this.painter.isVisible()},supportRenderMode:function(t){return this.painter.supportRenderMode(t)},startFrame:function(t){const r=t.sceneConfig;let a=this.painter;if(!a){a=this.painter=new e(t.regl,t.layer,t.symbol,r,t.pluginIndex,t.dataConfig)}this.Ln||(this.Ln={});const l=r.excludes;this.Hn?l!==this.Hn&&(this.Vn=l?createFilter(l):null,this.Hn=l):l&&(this.Hn=l),a.startFrame(t),this.Un={}},updateCollision:function(t){const e=this.painter;return e&&e.isVisible()?e.updateCollision(t):null},prepareRender:function(t){const e=this.painter;return e&&e.isVisible()?e.prepareRender(t):null},endFrame:function(t){const e=this.painter;return e&&e.isVisible()?e.render(t):null},getShadowMeshes(){const t=this.painter;return t&&t.getShadowMeshes&&t.getShadowMeshes()||xe$2},createTile:function(t){const{tileCache:e,tileData:n}=t;let i=!1;const r=this.painter;if(!r)return{retire:i};const o=this.Gn(t);let s=e.geometry;if(!s){const o=n.features,a=n.data;if(!a||!a.length)return{retire:i};const l=a;if(this.painter.colorSymbol&&!function(t){if(!t)return!0;for(const e in t)return!1;return!0}(o))for(let t=0;t<a.length;t++){const e=this.Wn(o,a[t].data.aPickingId,a[t].indices,a[t].data.aPosition,a[t].positionSize);a[t].data.aColor=e}s=e.geometry=r.createGeometries(l,o);for(let e=0;e<s.length;e++)s[e]&&s[e].geometry&&(i=!0,s[e].geometry.properties.features=o,this.ln(s[e].geometry,t))}let a=this.N(o);if(!a){const{meshes:e,retire:n}=this.qn(s,t);i||(i=n),a=e}return{retire:i}},qn(t,e){const{layer:n,tileInfo:i,tileExtent:r,tileTransform:o,tileTranslationMatrix:s,tileVectorTransform:a,tileZoom:l,sceneConfig:h}=e;let c=!1;const d=this.painter.createMeshes(t,o,{tileExtent:r,tilePoint:[i.extent2d.xmin,i.extent2d.ymax],tileZoom:l,tileTranslationMatrix:s,tileVectorTransform:a},e);if(d.length){const t=n.getRenderer().isEnableTileStencil();for(let n=0;n<d.length;n++)d[n]&&(c=!0,this.$n(d[n],o,e.timestamp,we$2++,t));h.animation&&(d.Bn=e.timestamp);const i=this.Gn(e);this.Ln[i]=d}return{meshes:d,retire:c}},paintTile:function(t){const{tileCache:e,tileInfo:n,tileZoom:i,sceneConfig:r}=t,o=this.painter;if(!o)return be$2;let s=e.geometry;if(!s)return be$2;let a=!1;const l=this.Gn(t);let h=this.N(l);if(!h){const{meshes:e,retire:n}=this.qn(s,t);a||(a=n),h=e}if(!h.length)return be$2;const c=o.getTileLevelValue(n,i);h.forEach((t=>{t.properties.tile=n,t.properties.level=c}));let u=!1;if(!this.Un[l]){let e=null,n=r.animation;if(n){const i=t.sceneConfig.animationDuration||800,r=(t.timestamp-h.Bn)/i;h.Bn-h[0].properties.createTime<i&&r<1&&(!0!==n&&1!==n||(n="linear"),e="linear"===n?r:j$4(n,r),u=!0)}o.addMesh(h,e,t),this.Un[l]=1}return{redraw:u,retire:a}},$n:function(t,e,n,i,r){if(t.properties.tileTransform=e,t.properties.createTime=n,t.properties.meshKey=i,t.needUpdateShadow=!0,r){const e=t.defines||{};e.ENABLE_TILE_STENCIL=1,t.setDefines(e),Object.defineProperty(t.uniforms,"stencilRef",{enumerable:!0,get:function(){return t.properties.tile?t.properties.tile.stencilRef:255}})}},ln:function(t,e){const{layer:n,tileInfo:i}=e,r=n.getMap(),o=(n.getSpatialReference?n.getSpatialReference():r.getSpatialReference()).getResolution(i.z),s=e.tileExtent/n.options.tileSize;t.properties.tileResolution=o,t.properties.tileRatio=s,t.properties.z=i.z,t.properties.tileExtent=e.tileExtent},updateSceneConfig:function(t){const e=this.painter;e&&e.updateSceneConfig(t.sceneConfig)},updateDataConfig:function(t,e){const n=this.painter;return!n||n.updateDataConfig(t,e)},updateSymbol:function(t,e){const n=this.painter;if(!n)return!1;if(n.shouldDeleteMeshOnUpdateSymbol(t)){if(this.Ln)for(const t in this.Ln)n.deleteMesh(this.Ln[t],!0);delete this.Ln,delete this.Un}return n.updateSymbol(t,e)},pick:function(t,e,n){return this.painter&&this.painter.pick?this.painter.pick(t,e,n):null},deleteTile:function(t){if(!this.Ln)return;const e=this.Gn(t),n=this.Ln[e];n&&this.painter&&this.painter.deleteMesh(n),delete this.Ln[e],this.Un&&delete this.Un[e]},remove:function(){const t=this.painter;if(t&&this.Ln){for(const e in this.Ln)t.deleteMesh(this.Ln[e]);t.delete(),delete this.painter}delete this.Ln,delete this.Un},resize:function(t,e){const n=this.painter;n&&n.resize(t,e)},needToRedraw:function(){return!!this.painter&&this.painter.needToRedraw()},needToRetireFrames:function(){return!!this.painter&&this.painter.needToRetireFrames()},needToRefreshTerrainTile:function(){return!!this.painter&&this.painter.needToRefreshTerrainTile()},isTerrainSkin:function(){return!!this.painter&&this.painter.isTerrainSkin()},isTerrainVector:function(){return!!this.painter&&this.painter.isTerrainVector()},Wn:function(t,e,n,i,r=3){if(!i||!t||!e.length)return null;const o=new Uint8Array(i.length/r*4);let s,a;const l=this.painter.colorSymbol,h={};let c;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(s=t[i].symbol,a=h[i],!a)if(l){let e;e="function"==typeof l?l(t[i].feature&&t[i].feature.properties):l,e=color(e),a=h[i]=e.array()}else a=h[i]=[255,255,255];c=4*n,o[c]=a[0],o[c+1]=a[1],o[c+2]=a[2],o[c+3]=255*(s[this.painter.opacitySymbol]||1)}return o},Gn:function(t){const e=t.tileInfo;return e.meshKey||(e.meshKey=we$2++),e.meshKey},N:function(t){return this.Ln[t]},Xn(t,e){if(Array.isArray(t))t.forEach(((t,n)=>{const{features:i}=t.properties;this.Yn(t,e[n],i)}));else{const{features:n}=t.properties;this.Yn(t,Array.isArray(e)?e[0]:e,n)}},Yn(t,e,n){const i=e.featureIndexes||e.data.featureIndexes;if(i)if(this.Vn){const r=e.indices;let o=null,s=!1;const a=[];for(let t=0;t<r.length;t++){const e=n[i[r[t]]];null!==o&&o===r[t]||(s=this.Vn(e.feature),o=r[t]),s||a.push(r[t])}t.setElements(new e.indices.constructor(a))}else t.setElements(e.indices)},outline(t,e){const n=this.painter;n&&n.outline(t,e)},outlineAll(t){const e=this.painter;e&&e.outlineAll(t)},needPolygonOffset(){const t=this.painter;return t&&t.needPolygonOffset()},highlight(t){const e=this.painter;return e&&e.highlight(t)},cancelAllHighlight(){const t=this.painter;return t&&t.cancelAllHighlight()}})}class ke$2{constructor(){this.Jn=1}write(t,e){const n=t.gl,i=this.Jn++;return t.stencilFunc(n.ALWAYS,i,255),t.draw(e),i}start(t){const e=t.gl;e.clearStencil(255),e.clear(e.STENCIL_BUFFER_BIT),this.Jn=1,t.start()}end(t){t.end()}}function _e$2(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function Te$2(t,e,n){return Math.min(n,Math.max(e,t))}function Se$2(t,e,n){if(t===n||t===e)return t;const i=n-e;return((t-e)%i+i)%i+e}function Me$2(t){return null==t}function Pe$2(t){return JSON.parse(JSON.stringify(t))}function Ie$2(t,e,n,i,r,o){Object.defineProperty(t,e,{enumerable:!0,get:function(){const t=Me$2(n[i])||isFunctionDefinition(n[i])?r:n[i];return o?o(t):t}})}const Oe$2=[];function Ce$2(t){for(let e=0;e<t.length;e++)Oe$2[e]=t[e],Oe$2[e]*=255;return 3===t.length&&(Oe$2[3]=255),Oe$2}function Ee$2(t,e=4){return Fe$2.bind(this,t,e)}function Fe$2(t,e,n){if(Array.isArray(n))return 3===n.length&&4===e&&n.push(1),n;if(t&&t[n])return t[n];if(void 0!==n.r&&void 0!==n.g&&void 0!==n.b&&void 0!==n.a)return[n.r,n.g,n.b,n.a];const i=color(n).unitArray();return 3===i.length&&4===e&&i.push(1),t&&(t[n]=i),i}function ze$2(t,e,n,i){if(t.fill)t.fill(e,n,i);else for(let r=n;r<i;r++)t[r]=e}function je$2(t){return"number"==typeof t&&!isNaN(t)}function Re$2(t){return t&&(t.markerFile||t.markerType)&&void 0!==t.textName}function De$2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ne$2(t){const e=[t[0]];let n=t[0];for(let i=1;i<t.length;i++)t[i]!==n&&(e.push(t[i]),n=t[i]);return e}function Le$2(t){return!t||(void 0!==t.empty||(t.empty=function(t){for(const e in t)return!1;return!0}(t)),t.empty)}const He$2="_fn_type_";function Ve$2(t,e,n){if(!Le$2(t.properties.features))for(let i=0;i<n.length;i++){const{symbolName:r}=n[i];(t.Zn=t.Zn||{})[r]=e[r],Ue$2(t,e,n[i])}}function Ue$2(t,e,n){const i=function(t){const e=t.properties;let n=e.aPickingId;return n||(n=e.aPickingId=new t.data.aPickingId.constructor(t.data.aPickingId)),n}(t),{attrName:r,symbolName:o,related:s}=n;let a=t.data[r];return a?Ze$2(e[o])||function(t,e){if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(Ze$2(e[t[n]]))return!0;return!1}(s,e)?(Ze$2(e[o])&&Ge$2(t,e,n),a):(a&&a.buffer&&a.buffer.destroy&&a.buffer.destroy(),delete t.data[r],We$2(t,r),null):Ze$2(e[o])?(a=t.data[r]=new n.type(n.width*i.length),function(t,e,n,i){const{attrName:r}=i,o=(He$2+r+"Index").trim();Ge$2(e,n,i);Ye$2(e,e.properties[o],i)}(0,t,e,n),a):null}function Ge$2(t,e,n){const{attrName:i,symbolName:r}=n,o=t.properties,s=(He$2+i+"Index").trim(),a=(He$2+i).trim();if(o[s]&&o[a])return;const l=function(t){if(!t)return Xe$2;const e=[];for(let n=0;n<t.length;n++)isFunctionDefinition(t[n][1])&&!interpolated(t[n][1]).isZoomConstant&&e.push(t[n][0]);return e}(e[r].stops),h="identity"===e[r].type&&te$3.checkIfIdentityZoomDependent(r,e[r].property,o.features);if(!h&&!l.length)return void We$2(t,i);const{features:c,aPickingId:u}=o,f=function(t,e,n,i,r){const o=[];let s=0,a=e[0];for(let l=1,h=e.length;l<h;l++)e[l]===a&&l!==h-1||((r||Be$2(t[a].feature,n,i))&&o.push(s,l===h-1?h:l),a=e[l],s=l);return o}(c,u,e[r].property,l,h);if(!f.length)return void We$2(t,i);const d=t.data[i];o[s]=f,o[a]=d.BYTES_PER_ELEMENT?new d.constructor(d):new n.type(d.length)}function We$2(t,e){const n=t.properties,i=(He$2+e+"Index").trim(),r=(He$2+e).trim();delete n[i],delete n[r]}function qe$2(t,e,n,i,r){if(!i)return;const o=i.geometry;if(o&&!Le$2(o.properties.features)){for(let s=0;s<n.length;s++){const a=n[s],l=a.attrName;if(!$e$2(o,e,a)){const{aPickingId:t}=o.properties;if(!t||o.Kn===r)continue;const e=(He$2+l+"Index").trim(),n=o.properties[e];if(!n)continue;Ye$2(o,n,a);continue}const h=Ue$2(o,e,a),c=a.define;if(h){const e=(He$2+l+"Index").trim();if(Ye$2(o,o.properties[e],a),c){const t=i.defines;t[c]=1,i.setDefines(t)}o.generateBuffers(t)}else if(c){const t=i.defines;t[c]&&(delete t[c],i.setDefines(t))}}o.Kn=r}}function $e$2(t,e,n){const i=e[n.symbolName],r=t.Zn;return i!==r[n.symbolName]&&(r[n.symbolName]=i,!0)}function Be$2(t,e,n){for(let i=0;i<n.length;i++)if("$"===e[0]&&t[e.substring(1)]===n[i]||t.properties[e]===n[i])return!0;return!1}const Xe$2=[];function Ye$2(t,e,n){const{attrName:i,evaluate:r}=n,{aPickingId:o,features:s}=t.properties;let a;if(e){const n=(He$2+i).trim();a=t.properties[n];const l=a.length/o.length,h=e.length;for(let n=0;n<h;n+=2){const i=e[n],h=e[n+1];let c=s[o[i]];c&&c.feature&&Je$2(a,c,r,i,h,l,t)}}else{if(a=t.data[i],function(t){return Array.isArray(t)||t.constructor===Float32Array||t.constructor===Float64Array||t.constructor===Uint8Array||t.constructor===Int8Array||t.constructor===Uint16Array||t.constructor===Int16Array||t.constructor===Uint32Array||t.constructor===Int32Array||t.constructor===Uint8ClampedArray}(a))a.dirty=!0;else{const e=(He$2+i).trim();a=t.properties[e],a||(a=t.properties[e]=new n.type(n.width*o.length),a.dirty=!0)}const e=a.length/o.length,l=o.length;let h=0;for(let n=0;n<l;n++){if(o[n]===o[h]&&n<l-1)continue;let i=s[o[h]];i&&i.feature&&(Je$2(a,i,r,h,n===l-1?l:n,e,t),h=n)}}a.dirty&&(t.updateData(i,a),a.dirty=!1)}function Je$2(t,e,n,i,r,o,s){const a=(e=e.feature).properties||{};void 0===a.$layer&&(e.properties||(e.properties=a),a.$layer=e.layer,a.$type=e.type);const l=n(a,s,t,i*o);if(Array.isArray(l)){let e=!1;for(let n=0;n<o;n++)if(t[i*o+n]!==l[n]){e=!0;break}if(e){for(let e=i*o;e<r*o;e+=o)t.set(l,e);t.dirty=!0}}else t[i]!==l&&(ze$2(t,l,i,r),t.dirty=!0)}function Ze$2(t){return te$3.isFnTypeSymbol(t)}const{loginIBLResOnCanvas:Ke$2,logoutIBLResOnCanvas:Qe$2,getIBLResOnCanvas:tn$2}=Fm.PBRUtils,en$2=[],nn$2=[],rn$2=new t__namespace.Point(0,0),on$2=new t__namespace.Point(0,0),sn$2=[],an$2=t=>0===t.properties.level,ln$1=t=>t.properties.level>0;class hn$1{constructor(t,e,i,r,o,s){this.Qn=!0,this.regl=t,this.layer=e,this.canvas=t._gl.canvas,this.sceneConfig=r||{},this.dataConfig=s||{},this.pluginIndex=o,this.scene=new yt$6,this.pickingFBO=e.getRenderer().pickingFBO,this.ti=new ke$2,this.level0Filter=an$2,this.levelNFilter=ln$1,this.loginTextureCache(),this.symbolDef=Array.isArray(i)?i.map((t=>Pe$2(t))):[Pe$2(i)],this.ei(),this.pickingViewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.sortByCommandKey=cn$1.bind(this),this.colorCache={}}getMap(){return this.layer?this.layer.getMap():null}getTileLevelValue(t,e){const n=this.layer.getRenderer();return n.getTileLevelValue&&n.getTileLevelValue(t,e)||0}isVisible(){const{minZoom:t,maxZoom:e}=this.sceneConfig,n=this.getMap().getZoom();if(!Me$2(t)&&n<t)return!1;if(!Me$2(e)&&n>e)return!1;const i=this.ni;if(i.length)for(let t=0;t<i.length;t++)if(i[t]&&!i[t].isFeatureConstant)return!0;const r=this.getSymbols();for(let t=0;t<r.length;t++){const e=r[t].visible;if(!1!==e&&0!==e)return!0}return!1}isMeshVisible(t){const e=t&&t.properties&&t.properties.symbolIndex;if(!e)return!1;const n=this.ni,i=e.index;let r;if(n[i]){if(!n[i].isFeatureConstant)return!0;r=n[i](this.getMap().getZoom())}else r=this.getSymbol(e).visible;return!1!==r&&0!==r}isAnimating(){return!1}needToRedraw(){return this.isAnimating()||this.ii}needToRetireFrames(){return this.Y}needToRefreshTerrainTile(){return this.isAnimating()}isTerrainSkin(){return this.layer.options.awareOfTerrain}isTerrainVector(){return!1}fillIncludes(t,e,n){const i=n&&n.includes;if(i)for(const r in i)i[r]&&(n[r].uniformDeclares&&e.push(...n[r].uniformDeclares),n[r].defines&&_e$2(t,n[r].defines))}setIncludeUniformValues(t,e){const n=e&&e.includes;if(n)for(const i in n)n[i]&&e[i].renderUniforms&&_e$2(t,e[i].renderUniforms)}createGeometries(t,e){if(!t.length)return sn$2;const n=[];for(let i=0;i<t.length;i++)if(t[i])if(void 0!==t[i].ref)n.push(n[t[i].ref]?{geometry:n[t[i].ref].geometry,symbolIndex:t[i].symbolIndex,ref:t[i].ref}:null);else{t[i]&&!t[i].is2D&&(this.Qn=!1);const r=this.createGeometry(t[i],e,i);if(r&&r.geometry){const o=r.geometry.properties,{pickingIdMap:s,idPickingMap:a,hasFeaIds:l}=this.ri(t[i]);l&&(o.feaIdPickingMap=s,o.feaPickingIdMap=a),o.symbolIndex=r.symbolIndex,o.features=e,o.is2D=t[i].is2D,this.postCreateGeometry(r,n)}n.push(r)}return n}isOnly2D(){return this.Qn}postCreateGeometry(){}ri(t){if(!t)return{};if(Array.isArray(t)&&!(t=t[0]))return{};const e=t.featureIds,n={},i={},r=e&&e.length;if(r)for(let r=0;r<e.length;r++){const o=t.data.aPickingId[r];void 0===n[o]&&(n[o]=e[r],i[e[r]]||(i[e[r]]=[]),i[e[r]].push(t.data.aPickingId[r]))}return{hasFeaIds:r,idPickingMap:n,pickingIdMap:i}}createGeometry(){throw new Error("not implemented")}createMeshes(t,e,n,i){const r=this.layer.options.awareOfTerrain,o=[];for(let s=0;s<t.length;s++){if(!t[s])continue;if(r&&i&&i.isRenderingTerrain&&this.isTerrainVector()){const e=t[s];this.oi(e&&e.geometry,i)}let a=this.createMesh(t[s],e,n,i||{});Array.isArray(a)?(a=a.filter((t=>!!t)),o.push(...a)):a&&o.push(a)}return o}createMesh(){throw new Error("not implemented")}getAltitudeOffsetMatrix(){const t=100*(this.dataConfig.altitudeOffset||0),e=identity$2([]);return set$4(nn$2,0,0,t),translate$1(e,e,nn$2),e}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).bloom}addMesh(t,e,n){const i=this.getRenderFBO(n);t=t.filter((t=>this.isMeshVisible(t)));const r=!(!n||!n.bloom);t.forEach((t=>{const e=this.isBloom(t)&&r;t.bloom=e;let o=!1;const s=t.defines||{};!!s.HAS_BLOOM!==e&&(o=!0,e?s.HAS_BLOOM=1:delete s.HAS_BLOOM),t.geometry.data.aTerrainAltitude&&this.oi(t.geometry,n),t.geometry.data.aTerrainAltitude&&!s.HAS_TERRAIN_ALTITUDE&&(s.HAS_TERRAIN_ALTITUDE=1,o=!0),o&&t.setDefines(s),i?t.setUniform("framebuffer",i):delete t.uniforms.framebuffer,this.si(t)})),this.scene.addMesh(t)}updateCollision(){}render(t){return this.pluginIndex=t.pluginIndex,this.polygonOffsetIndex=t.polygonOffsetIndex,this.paint(t)}prepareRender(t){if(this.ct===t.timestamp)return;if(this.ct=t.timestamp,!this.createFnTypeConfig)return;const e=this.scene.getMeshes();if(!e||!e.length)return;const n=this.getMap().getZoom();for(let t=0;t<e.length;t++){if(!e[t]||!e[t].geometry)continue;const{symbolIndex:i}=e[t].properties,r=this.getSymbolDef(i);if(!r)continue;const o=this.getFnTypeConfig(i);qe$2(this.regl,r,o,e[t],n)}}paint(t){const e=this.layer.getMap();if(!e)return{redraw:!1};this.ai=t;const n=this.getUniformValues(e,t);return this.callShader(n,t),{redraw:this.ii}}setToRedraw(t){t&&(this.Y=t),this.ii=!0}callShader(t,e){this.callCurrentTileShader(t,e),this.callBackgroundTileShader(t,e)}callCurrentTileShader(t,e){this.shader&&(this.shader.filter=e&&e.sceneFilter?[this.level0Filter,e.sceneFilter]:this.level0Filter),this.callRenderer(this.shader,t,e)}callBackgroundTileShader(t,e){this.shader&&(this.shader.filter=e&&e.sceneFilter?[this.levelNFilter,e.sceneFilter]:this.levelNFilter),this.scene.getMeshes().sort(un$1),this.callRenderer(this.shader,t,e)}callRenderer(t,e,n){const i=this.scene.getMeshes(),r=[];i.forEach((t=>{t.properties.hlBloomMesh&&n&&n.bloom&&r.push(t.properties.hlBloomMesh),r.push(t)})),this.scene.setMeshes(r),this.renderer.render(t,e,this.scene,this.getRenderFBO(n)),this.scene.setMeshes(i)}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}needPolygonOffset(){return!1}getPolygonOffset(){const t=this.layer;return{factor:(e,n)=>n.meshConfig.ssr?1:-(t.getPolygonOffset()+(this.polygonOffsetIndex||0)),units:(e,n)=>n.meshConfig.ssr?1:-(t.getPolygonOffset()+(this.polygonOffsetIndex||0))}}getBlendFunc(){return{src:()=>this.sceneConfig.blendSrc||"src alpha",dst:()=>this.sceneConfig.blendDst||"one minus src alpha"}}pick(t,e,n=3){if(!this.layer.options.picking||!1===this.sceneConfig.picking)return null;if(!this.pickingFBO||!this.picking)return null;const i=this.getMap(),r=this.getUniformValues(i);for(let o=0;o<this.picking.length;o++){const s=this.picking[o];s.render(this.scene.getMeshes(),r,!0);let a={};s.getRenderedMeshes().length&&(a=s.pick(t,e,n,r,{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:this.layer.options.pickingPoint&&!1!==this.sceneConfig.pickingPoint,logDepthBufFC:2/(Math.log(i.cameraFar+1)/Math.LN2)}));const{meshId:l,pickingId:h,point:c}=a,u=(0===l||l)&&s.getMeshAt(l);if(!u||!u.geometry)continue;let f=u.geometry.properties;return f.features||(f=u.properties),c&&c.length&&(c[0]=Math.round(1e5*c[0])/1e5,c[1]=Math.round(1e5*c[1])/1e5,c[2]=Math.round(1e5*c[2])/1e5),{data:this.li(f&&f.features&&f.features[h]),point:c,coordinate:a.coordinate,plugin:this.pluginIndex}}return null}li(t){const e=t&&t.feature;if(!e||!e.customProps)return t;const n=_e$2({},t);return n.feature=_e$2({},t.feature),delete n.feature.customProps,n.feature.properties=_e$2({},e.properties,e.properties[at$3]),delete n.feature.properties[at$3],n}updateSceneConfig(){}updateDataConfig(){return!0}deleteMesh(t,e){if(t)if(this.scene.removeMesh(t),Array.isArray(t))for(let n=0;n<t.length;n++){if(!t[n].isValid())continue;const i=t[n].geometry;!e&&i&&i.dispose(),t[n].material&&t[n].material.dispose(),t[n].dispose(),ae$4.deleteHighlightBloomMesh(t[n])}else{if(!t.isValid())return;!e&&t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),t.dispose(),ae$4.deleteHighlightBloomMesh(t)}}startFrame(t){this.hi||(this.init(t),this.hi=!0),this.ct!==t.timestamp&&(this.ii=!1,this.Y=!1),this.scene.clear()}resize(){}delete(){if(this.scene.clear(),this.shader&&this.shader.dispose(),this.picking){for(let t=0;t<this.picking.length;t++)this.picking[t].dispose();delete this.picking}if(this.ci){for(let t=0;t<this.ci.length;t++)this.ci[t].dispose();delete this.ci}this.logoutTextureCache()}updateSymbol(t,e){const n=this.supportRenderMode("taa");Array.isArray(t)||(t=[t],e=[e]);let i=!1;for(let n=0;n<t.length;n++)if(t[n]){const r=this.ui(n,t[n],e[n]);r&&(i=r)}return delete this.fi,this.setToRedraw(n),i}di(t,e){for(const n in e)if(De$2(e,n)){if(te$3.isFnTypeSymbol(e[n])&&!this.layer.options.features&&(!t[n]||t[n].property!==e[n].property))return!0;if(la[n]&&!fastDeepEqual(e[n],t[n]))return!0}return!1}ui(t,e,n){if(!this.pi)return!1;const i=this.di(this.symbolDef[t]||{},n);this.symbolDef[t]=Pe$2(n);const r=this.pi[t];for(const t in r)delete r[t];const o=this.getMap(),s=[],a=oa.loadSymbolFnTypes(this.symbolDef[t],(()=>(s[0]=o.getZoom(),s)));for(const t in a){const e=Object.getOwnPropertyDescriptor(a,t);e.get?Object.defineProperty(r,t,{get:e.get,set:e.set,configurable:!0,enumerable:!0}):r[t]=a[t]}return isFunctionDefinition(n.visible)&&(this.ni[t]=interpolated(n.visible)),i}getSymbolDef(t){return this.symbolDef[t.index]}getSymbols(){return this.pi}getSymbol(t){return this.pi[t.index]}ei(){const t=this.getMap(),e=[],n=()=>(e[0]=t.getZoom(),e);this.pi=[],this.ni=[];for(let t=0;t<this.symbolDef.length;t++)this.pi[t]=oa.loadSymbolFnTypes(_e$2({},this.symbolDef[t]),n),this.symbolDef[t]&&isFunctionDefinition(this.symbolDef[t].visible)&&(this.ni[t]=interpolated(this.symbolDef[t].visible))}getFnTypeConfig(t){this.fi||(this.fi=[]);const e=t.index;if(!this.fi[e]){const n=this.getSymbolDef(t),i=this.getMap();this.fi[e]=this.createFnTypeConfig(i,n)}return this.fi[e]}mi(){delete this.fi}loginTextureCache(){const t="__gl_textures".trim(),e=this.getMap();e[t]||(e[t]={count:0}),e[t].count++}logoutTextureCache(){const t="__gl_textures".trim(),e=this.getMap(),n=this.yi;if(n)for(const i in n)De$2(n,i)&&e[t][i]&&(e[t][i].count--,e[t][i].count<=0&&delete e[t][i]);e[t].count--,e[t].count<=0&&(e[t]={})}getCachedTexture(t){const e="__gl_textures".trim(),n=this.getMap()[e][t];return n?n.data:null}addCachedTexture(t,e){const n="__gl_textures".trim(),i=this.getMap();let r=i[n][t];r?r.data=e:r=i[n][t]={data:e,count:0},this.yi||(this.yi={}),r.data.then||this.yi[t]||(r.count++,this.yi[t]=1)}disposeCachedTexture(t){let e;if(e="string"==typeof t?t:t.url,!this.yi||!this.yi[e])return;const n="__gl_textures".trim();delete this.yi[e];const i=this.getMap();i[n][e]&&(i[n][e].count--,i[n][e].count<=0&&delete i[n][e])}shouldDeleteMeshOnUpdateSymbol(){return!1}needClearStencil(){return!1}supportRenderMode(t){return"taa"===t||"fxaa"===t}gi(t){const e=this.scene.getMeshes();if(!e.length)return;const n=e.map((t=>({transform:t.localTransform,level:t.properties.level,mesh:t}))).sort(this.vi),i=this.getMap().projViewMatrix;this.ti.start(t);const o={};for(let e=0;e<n.length;e++){const s=n[e].mesh;let a=o[s.properties.tile.id];void 0===a&&(multiply$5(en$2,i,n[e].transform),a=this.ti.write(t,en$2),o[s.properties.tile.id]=a),s.setUniform("ref",a)}this.ti.end(t),this.regl.bi()}vi(t,e){return e.level-t.level}outline(t,e){const n={};for(let i=0;i<e.length;i++)Me$2(e[i])||n[e[i]]||(this.xi(t,e[i]),n[e[i]]=1)}xi(t,e){if(!this.picking)return;if(this.wi||(this.wi=new yt$6),!this.ci&&(this.Ai(),!this.ci))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const i=this.getUniformValues(this.getMap(),this.ai),r=this.ki(e);if(r.length)for(let n=0;n<r.length;n++){const o=r[n].geometry.properties.feaIdPickingMap;if(o){const s=o[e];if(s){const e={};this.wi.setMeshes(r[n]);for(let n=0;n<s.length;n++){const r=s[n];if(!e[r]){e[r]=1,i.highlightPickingId=r;for(let e=0;e<this.ci.length;e++)this.renderer.render(this.ci[e],i,this.wi,t)}}}}}}ki(t){const e=[],n=this.scene.getMeshes();for(let i=0;i<n.length;i++){const r=n[i],o=r.geometry.properties.feaIdPickingMap;o&&void 0!==o[t]&&e.push(r)}return e}outlineAll(t){if(!this.picking)return;if(!this.ci&&(this.Ai(),!this.ci))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const e=this.getUniformValues(this.getMap(),this.ai);e.highlightPickingId=-1;for(let n=0;n<this.ci.length;n++)this.renderer.render(this.ci[n],e,this.scene,t)}Ai(){if(!this.picking)return;const t=this.layer.getRenderer().canvas;this.ci=[];for(let e=0;e<this.picking.length;e++){const i=this.picking[e].getPickingVert(),r={ENABLE_PICKING:1,HAS_PICKING_ID:1},o=this.picking[e].getUniformDeclares().slice(0);void 0!==o.uPickingId&&(r.HAS_PICKING_ID=2),this.ci[e]=new ie$5({vert:i,frag:"precision highp float;\nuniform float highlightPickingId;\nvarying float vPickingId;\nvoid main() {\n  if(highlightPickingId < .0 || floor(highlightPickingId + .5) == floor(vPickingId + .5)) {\n    gl_FragColor = vec4(1.);\n  } else {\n    discard;\n  }\n}",uniforms:o,defines:r,extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height},depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this.ci[e].filter=this.picking[e].filter}}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}updateIBLDefines(t){const e=t.shaderDefines;let n=!1;this.hasIBL()?e[["HAS_IBL_LIGHTING"]]||(e.HAS_IBL_LIGHTING=1,n=!0):e[["HAS_IBL_LIGHTING"]]&&(delete e.HAS_IBL_LIGHTING,n=!0),n&&(t.shaderDefines=e)}getIBLRes(){const t=this.layer.getRenderer().canvas;return tn$2(t)}createIBLTextures(){const t=this.layer.getRenderer().canvas;Ke$2(t,this.regl,this.getMap()),this.setToRedraw(!0),this.layer.fire("iblupdated")}disposeIBLTextures(){const t=this.layer.getRenderer().canvas;Qe$2(t,this.getMap())}evaluateInFnTypeConfig(t,e,n,i,r){let o=this._i;o||(o=this._i={});const s=function(t){let e=0;const n=t&&t.length||0;if(!n)return e;let i;for(let r=0;r<n;r++)i=t.charCodeAt(r),e=(e<<5)-e+i,e&=e;return e}(JSON.stringify(t));let a=o[s];return a||(a=o[s]=r?piecewiseConstant(t):interpolated(t)),a(n.getZoom(),i)}highlight(t){this.Zt=t,this.Ti=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}cancelAllHighlight(){this.Zt=null,this.Ti=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}Si(t,e){const{featureIds:n,pickingIdIndiceMap:i}=e;t.properties.aFeaIds=n,t.properties.pickingIdIndiceMap=i}si(t){const{pickingIdIndiceMap:e}=t.geometry.properties,n=this.Zt?function(t,e,n){const{aPickingId:i,feaIdPickingMap:r,features:o}=t.geometry.properties,s=new Map,a=n.keys();for(const t of a){const a=n.get(t);if(a)if(Me$2(a.id)){if(a.filter){let t=null;for(let n=0;n<i.length;n++){i[n]!==t&&(t=i[n]);const r=o[t];a.filter(r&&r.feature,e)&&s.set(t,a)}}}else{const t=r[a.id];if(!t||!t.length)continue;for(let e=0;e<t.length;e++)s.set(t[e],a)}}return s}(t,this.layer,this.Zt):null;ae$4.highlightMesh(this.regl,t,n,this.Ti,e)}oi(t,e){if(!t)return;let n=t.properties.aAnchor;if(!n){const{aPosition:e}=t.data;n=t.properties.aAnchor=e.slice(0)}let i=t.properties.aTerrainAltitude;i||(i=t.properties.aTerrainAltitude=new Float32Array(n.length/t.desc.positionSize)),t.data.aTerrainAltitude?i.dirty&&t.updateData("aTerrainAltitude",i):t.data.aTerrainAltitude=i,i.dirty=!1,this.Mi(i,n,e.tileInfo,0,i.length-1)}Mi(t,e,n,i,r){const{res:o,extent:s,extent2d:a}=n,{xmin:l,ymax:h}=a,c=rn$2.set(l,h),u=e.length/t.length;let f=t.queryResult;f||(f=t.queryResult=new Map);for(let n=i;n<=r;n++){on$2.set(e[n*u],e[n*u+1]);const i=on$2[0]+on$2[1]*s;let r=f.get(i);if(r||0===r){t[n]!==r&&(t[n]=r,t.dirty=!0);continue}const a=this.layer.queryTilePointTerrain(on$2,c,s,o);r=a[0]||0,t[n]!==r&&(t[n]=r,t.dirty=!0),a[1]&&f.set(i,r)}}}function cn$1(t,e){const n=t&&t.getCommandKey(this.regl)||"",i=e&&e.getCommandKey(this.regl)||"";return n.localeCompare(i)}function un$1(t,e){return t.properties.level-e.properties.level}class fn$1 extends hn$1{createGeometry(t,e){if(!t.data)return{geometry:null,symbolIndex:t.symbolIndex};t.iconAtlas&&t.iconAtlas.image&&(t.iconAtlas.image.dataType=t.type,t.iconAtlas.image.type="icon"),t.glyphAtlas&&t.glyphAtlas.image&&(t.glyphAtlas.image.type="glyph");const i=_e$2({},t.data),r={primitive:this.getPrimitive(),positionSize:t.positionSize};i.aAltitude&&(r.altitudeAttribute="aAltitude");const o=new Q$7(i,t.indices,0,r);return o.properties={features:e},t.iconAtlas&&(o.properties.iconAtlas=t.iconAtlas.image),t.glyphAtlas&&(o.properties.glyphAtlas=t.glyphAtlas.image),Le$2(e)||(o.properties.aFeaIds=t.featureIds,this.Si(o,t)),t.markerPlacement&&(o.properties.markerPlacement=t.markerPlacement),t.textPlacement&&(o.properties.textPlacement=t.textPlacement),_e$2(o.properties,t.properties),{geometry:o,symbolIndex:t.symbolIndex}}getRayCastData(t,e){const{features:n,aFeaIds:i}=t.geometry.properties;return n&&i?n[i[e]]:null}getPrimitive(){return"triangles"}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}supportRenderMode(t){return"noAa"===t}drawDebugAtlas(t){if(document.getElementById("MAPTALKS_ICON_DEBUG")){const e=document.getElementById("MAPTALKS_ICON_DEBUG");let n;if(e.width=t.width,e.height=t.height,e.style.width=t.width+"px",e.style.height=t.height+"px","alpha"===t.format){n=new Uint8ClampedArray(4*t.data.length);for(let e=0;e<t.data.length;e++)n[4*e+3]=t.data[e]}else n=new Uint8ClampedArray(t.data);const i=e.getContext("2d");i.imageSmoothingEnabled=!1,i.putImageData(new ImageData(n,t.width,t.height),0,0)}}}var dn$1="#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#include <fbo_picking_vert>\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n  fbo_picking_setData(gl_Position.w, true);\n}";function pn$1(t,e,n){const r={width:e.width,height:e.height,data:e.data,format:e.format,mag:"linear",min:"linear",flipY:n,premultiplyAlpha:!0};if("icon"===e.type){const t="point"!==e.dataType?"repeat":"clamp";r.wrapS=t,r.wrapT=t}return t.texture(r)}const mn$1=identity$2([]),yn$1={polygonFill:[1,1,1,1],polygonOpacity:1,uvScale:[1,1],uvOffset:[0,0]},gn$1=[];class vn$1 extends fn$1{prepareSymbol(t){const e=t.polygonFill;Array.isArray(e)&&(3===e.length&&e.push(1),t.polygonFill=e.map((t=>255*t)))}supportRenderMode(t){return this.sceneConfig.antialias||void 0===this.sceneConfig.antialias?"fxaa"===t||"fxaaBeforeTaa"===t:super.supportRenderMode(t)}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).polygonBloom}needPolygonOffset(){return!0}getAnalysisMeshes(){return this.isVisible()?this.scene.getMeshes().filter((t=>0===t.properties.level)):gn$1}createMesh(t,e,i){const{tilePoint:r}=i,{geometry:o,symbolIndex:s,ref:a}=t,l=o.data.aPosition instanceof Int16Array,h={tileExtent:o.properties.tileExtent,tileRatio:o.properties.tileRatio},c=this.getSymbol(s);if(Ie$2(h,"polygonFill",c,"polygonFill",yn$1.polygonFill,Ee$2(this.colorCache)),Ie$2(h,"polygonOpacity",c,"polygonOpacity",yn$1.polygonOpacity),Ie$2(h,"uvScale",c,"uvScale",yn$1.uvScale),Ie$2(h,"uvOffset",c,"uvOffset",yn$1.uvOffset),void 0===a){const t=this.getSymbolDef(s),e=this.getFnTypeConfig(s);Ve$2(o,t,e),o.generateBuffers(this.regl)}const u=o.properties.iconAtlas;if(u&&o.data.aTexInfo){const t=this.getMap();h.tilePoint=r,Object.defineProperty(h,"tileScale",{enumerable:!0,get:function(){return o.properties.tileResolution/t.getResolution()}}),h.polygonPatternFile=pn$1(this.regl,u,!1),h.atlasSize=[u.width,u.height],this.drawDebugAtlas(u)}const f=new tt$6(h,yn$1),d=new ft$6(o,f,{castShadow:!1,picking:!0}),p={};return u&&o.data.aTexInfo&&(p.HAS_PATTERN=1),o.data.aAltitude&&(p.HAS_ALTITUDE=1),o.data.aColor&&(p.HAS_COLOR=1),o.data.aOpacity&&(p.HAS_OPACITY=1),o.data.aUVScale&&(p.HAS_UV_SCALE=1),o.data.aUVOffset&&(p.HAS_UV_OFFSET=1),l&&(p.IS_VT=1),d.setDefines(p),d.setLocalTransform(e),d.properties.symbolIndex=s,d}createFnTypeConfig(t,e){const n=piecewiseConstant(e.polygonFill),i=interpolated(e.polygonOpacity),r=interpolated(e.uvScale),o=interpolated(e.uvOffset),s=new Uint8Array(1),a=new Uint16Array(1);return[{attrName:"aColor",symbolName:"polygonFill",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=Ce$2(r),r}},{attrName:"aOpacity",symbolName:"polygonOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),s[0]=255*r,s[0]}},{attrName:"aUVScale",symbolName:"uvScale",type:Uint16Array,width:2,define:"HAS_UV_SCALE",evaluate:e=>{let n=r(t.getZoom(),e);return a[0]=10*n,a[0]}},{attrName:"aUVOffset",symbolName:"uvOffset",type:Uint8Array,width:2,define:"HAS_UV_OFFSET",evaluate:e=>{let n=o(t.getZoom(),e);return s[0]=255*n,s[0]}}]}paint(t){t.states&&t.states.includesChanged.shadow&&(this.shader.dispose(),this.Pi(t)),super.paint(t)}init(t){const i=this.canvas,o={x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,e)=>e.viewport?e.viewport.width:i?i.width:1,height:(t,e)=>e.viewport?e.viewport.height:i?i.height:1};this.renderer=new N$8(this.regl);const s=!!(t&&t.isRenderingTerrain&&this.isTerrainSkin()),a=this.layer.getRenderer(),l={viewport:o,stencil:{enable:()=>!(s||!a.isEnableTileStencil||!a.isEnableTileStencil()),func:{cmp:()=>a.isEnableTileStencil&&a.isEnableTileStencil()?"=":"<=",ref:(t,e)=>a.isEnableTileStencil&&a.isEnableTileStencil()?e.stencilRef:e.level},op:{fail:"keep",zfail:"keep",zpass:()=>a.isEnableTileStencil&&a.isEnableTileStencil()?"zero":"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:(t,e)=>{if(!Me$2(this.sceneConfig.depthMask))return!!this.sceneConfig.depthMask;if(e.meshConfig.transparent)return!1;const n=e.polygonOpacity;return!(je$2(n)&&n<1)},func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};if(this.Pi(t,l),this.pickingFBO){const t=[];this.picking=[new Am(this.renderer,{vert:dn$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return multiply$5(t,n.projViewMatrix,n.modelMatrix),t}}],extraCommandProps:l},this.pickingFBO,this.getMap())]}}Pi(t,e){const i=[],o=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],s={};this.fillIncludes(s,o,t),this.shader=new ie$5({vert:"#define SHADER_NAME FILL\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef IS_VT\nuniform mat4 modelMatrix;\n#endif\n#ifdef HAS_PATTERN\nattribute vec4 aTexInfo;\nuniform vec2 tilePoint;\n#ifdef IS_VT\nuniform float tileRatio;\nuniform float tileScale;\n#else\nuniform float glScale;\n#endif\n#ifdef HAS_UV_SCALE\nattribute vec2 aUVScale;\nvarying vec2 vUVScale;\n#endif\n#ifdef HAS_UV_OFFSET\nattribute vec2 aUVOffset;\nvarying vec2 vUVOffset;\n#endif\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d, vec2 e) {\n  vTexInfo = vec4(aTexInfo.xy, e);\n#ifdef IS_VT\nfloat f = d.x / e.x;\n  float h = d.y / e.y;\n  return vec2(f, h);\n#else\nfloat f = (d.x - tilePoint.x) * glScale / e.x;\n  float h = (d.y - tilePoint.y) * glScale / e.y;\n  return vec2(f, -h);\n#endif\n}\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <vt_position_vert>\n#include <highlight_vert>\nvoid main() {\n  vec3 i = unpackVTPosition();\n  vec4 j = vec4(i, 1.);\n  gl_Position = projViewModelMatrix * j;\n#ifdef HAS_PATTERN\nvec2 k = aTexInfo.zw + 1.;\n#ifdef IS_VT\nvec2 l = mod((tilePoint) * tileScale * vec2(1., -1.) / k, 1.);\n  vTexCoord = l + c(i.xy * tileScale / tileRatio, k);\n#else\nvec4 m = modelMatrix * j;\n  vTexCoord = c(m.xy, k);\n#endif\n#ifdef HAS_UV_SCALE\nvUVScale = aUVScale / 255.;\n#endif\n#ifdef HAS_UV_OFFSET\nvUVOffset = aUVOffset / 255.;\n#endif\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\nhighlight_setVarying();\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(j);\n#endif\n}",frag:"#define SHADER_NAME FILL\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n#ifdef HAS_UV_SCALE\nvarying vec2 vUVScale;\n#else\nuniform vec2 uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvarying vec2 vUVOffset;\n#else\nuniform vec2 uvOffset;\n#endif\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D polygonPatternFile;\nuniform vec2 atlasSize;\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c() {\n  \n#ifdef HAS_UV_SCALE\nvec2 d = vUVScale;\n#else\nvec2 d = uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvec2 e = vUVOffset;\n#else\nvec2 e = uvOffset;\n#endif\nvec2 f = mod(vTexCoord * d + e, 1.);\n  vec2 h = vTexInfo.xy;\n  vec2 i = vTexInfo.zw;\n  return (h + f * i) / atlasSize;\n}\n#endif\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#include <highlight_frag>\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float polygonOpacity;\n#endif\nuniform float tileExtent;\nvoid main() {\n  \n#ifdef HAS_COLOR\nvec4 j = vColor;\n#else\nvec4 j = polygonFill;\n#endif\n#ifdef HAS_PATTERN\nif(vTexInfo.z * vTexInfo.w > 1.) {\n    vec2 f = c();\n    j = texture2D(polygonPatternFile, f);\n  }\n#endif\n#ifdef HAS_OPACITY\ngl_FragColor = j * vOpacity;\n#else\ngl_FragColor = j * polygonOpacity;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat k = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, k);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:o,defines:s,extraCommandProps:e})}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i={projViewMatrix:n?mn$1:t.projViewMatrix,glScale:e&&e.isRenderingTerrainSkin?1:1/t.getGLScale(),viewport:n&&e&&e.viewport};return this.setIncludeUniformValues(i,e),i}}var bn$1="#define SHADER_NAME LINE\n#define AA_CLIP_LIMIT 2.0\n#define AA_LINE_WIDTH 16.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY)\nattribute vec3 aExtrude;\n#else\nattribute vec2 aExtrude;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nattribute float aLinesofar;\nvarying highp float vLinesofar;\n#endif\nuniform float cameraToCenterDistance;\n#if defined(HAS_STROKE_WIDTH)\nattribute float aLineStrokeWidth;\n#else\nuniform float lineStrokeWidth;\n#endif\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\nuniform float tileResolution;\nuniform float resolution;\nuniform float tileRatio;\nuniform float isRenderingTerrain;\n#if defined(HAS_LINE_DX) || defined(HAS_LINE_DY)\nattribute vec2 aLineDxDy;\n#endif\n#ifndef HAS_LINE_DX\nuniform float lineDx;\n#endif\n#ifndef HAS_LINE_DY\nuniform float lineDy;\n#endif\nuniform vec2 canvasSize;\nuniform float layerScale;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef USE_LINE_OFFSET\nattribute vec2 aExtrudeOffset;\n#endif\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#ifndef PICKING_MODE\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_PATTERN\n#if defined(HAS_PATTERN_ANIM) || defined(HAS_PATTERN_GAP)\nattribute vec2 aLinePattern;\n#endif\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#endif\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nattribute vec4 aDasharray;\nvarying vec4 vDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nattribute vec4 aDashColor;\nvarying vec4 vDashColor;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nattribute vec4 aStrokeColor;\nvarying vec4 vStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\n#ifdef HAS_GRADIENT\nattribute float aGradIndex;\nvarying float vGradIndex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvarying vec3 vVertex;\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  float d = mod(abs(aExtrude.x), 2.);\n  float e = mod(abs(aExtrude.y), 2.);\n  vNormal = vec2(d, e * 2. - 1.);\n  vec4 f = vec4(c, 1.);\n  vec4 h = projViewModelMatrix * positionMatrix * f;\n  if(isRenderingTerrain == 1.) {\n    vVertex = (positionMatrix * f).xyz;\n  } else {\n    vVertex = (modelMatrix * positionMatrix * f).xyz;\n  }\n#ifdef HAS_STROKE_WIDTH\nfloat i = aLineStrokeWidth / 2. * layerScale;\n#else\nfloat i = lineStrokeWidth;\n#endif\n#ifdef HAS_LINE_WIDTH\nfloat j = aLineWidth / 2. * layerScale;\n#else\nfloat j = lineWidth * layerScale;\n#endif\nfloat k = j / 2. + i;\n  float l = sign(i) * j / 2.;\n  float m = l + sign(l) * ANTIALIASING;\n  float n = k + sign(k) * ANTIALIASING;\n#ifdef USE_LINE_OFFSET\nvec2 o = lineOffset * (vNormal.y * (aExtrude.xy - aExtrudeOffset) + aExtrudeOffset);\n  vec2 u = (n * aExtrude.xy + o) / EXTRUDE_SCALE;\n#else\nvec2 v = aExtrude.xy / EXTRUDE_SCALE;\n  vec2 u = n * v;\n#endif\nfloat A;\n  A = tileResolution / resolution;\n  vec4 B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n  gl_Position = projViewModelMatrix * positionMatrix * B;\n  if(isRenderingTerrain == .0) {\n    float C = min(AA_CLIP_LIMIT / canvasSize.x, AA_CLIP_LIMIT / canvasSize.y);\n    float D = distance(gl_Position.xy / gl_Position.w, h.xy / h.w) - C;\n    if(D * j < .0) {\n      float E = -D / C;\n      float F = E * E * E * E * AA_LINE_WIDTH;\n      u += F * v;\n      n += F / 6.;\n      B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n      gl_Position = projViewModelMatrix * positionMatrix * B;\n    }\n  }\n#ifdef HAS_LINE_DX\nfloat G = aLineDxDy[0];\n#else\nfloat G = lineDx;\n#endif\n#ifdef HAS_LINE_DY\nfloat H = aLineDxDy[1];\n#else\nfloat H = lineDy;\n#endif\nfloat I = gl_Position.w;\n  gl_Position.xy += vec2(G, H) * 2. / canvasSize * I;\n#ifndef PICKING_MODE\nvWidth = vec2(n, m);\n  if(isRenderingTerrain == 1.) {\n    vGammaScale = 1.;\n  } else {\n    vGammaScale = I / cameraToCenterDistance;\n  }\n#ifndef ENABLE_TILE_STENCIL\nvPosition = c.xy;\n#ifdef USE_LINE_OFFSET\nvPosition += tileRatio * o / EXTRUDE_SCALE;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT)\n#ifdef HAS_GRADIENT\nvLinesofar = aLinesofar / MAX_LINE_DISTANCE;\n  vGradIndex = aGradIndex;\n#else\nfloat J = aLinesofar - k * aExtrude.z / EXTRUDE_SCALE / A * tileRatio;\n  vLinesofar = J / tileRatio * A;\n#endif\n#endif\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nvColor = aColor;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvDasharray = aDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvDashColor = aDashColor / 255.;\n#endif\n#endif\n#ifdef HAS_PATTERN\nvTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n#ifdef HAS_PATTERN_ANIM\nvLinePatternAnimSpeed = aLinePattern[0] / 127.;\n#endif\n#ifdef HAS_PATTERN_GAP\nvLinePatternGap = aLinePattern[1] / 10.0;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nvStrokeColor = aStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(B);\n#endif\nhighlight_setVarying();\n#else\nfbo_picking_setData(I, true);\n#endif\n}";const xn$1=identity$2([]),wn$1=[];class An$2 extends fn$1{prepareSymbol(t){const e=t.lineColor;Array.isArray(e)&&(3===e.length&&e.push(1),t.lineColor=e.map((t=>255*t)));const n=t.lineStrokeColor;Array.isArray(n)&&(3===n.length&&n.push(1),t.lineStrokeColor=n.map((t=>255*t)));const i=t.lineDashColor;Array.isArray(i)&&(3===i.length&&i.push(1),t.lineDashColor=i.map((t=>255*t)))}needToRefreshTerrainTile(){return!0}isAnimating(){if(this.Ii)return!0;const t=this.getSymbols(),e=this.sceneConfig.trailAnimation;if(e&&e.enable)return!0;for(let e=0;e<t.length;e++)if(t[e].linePatternFile&&t[e].linePatternAnimSpeed)return!0;return!1}needToRedraw(){return!!super.needToRedraw()||!!this.isAnimating()}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).lineBloom}needPolygonOffset(){return!0}createMesh(t,e){if(!t.geometry)return null;const{geometry:i,symbolIndex:r,ref:o}=t,s=this.getSymbolDef(r);void 0===o&&Ve$2(i,s,this.getFnTypeConfig(r));const a=this.getSymbol(r),l={tileResolution:i.properties.tileResolution,tileRatio:i.properties.tileRatio,tileExtent:i.properties.tileExtent};this.setLineUniforms(a,l),Ie$2(l,"lineColor",a,"lineColor","#fff",Ee$2(this.colorCache)),Ie$2(l,"linePatterGapColor",a,"linePatterGapColor",[0,0,0,0],Ee$2(this.colorCache)),Ie$2(l,"lineStrokeColor",a,"lineStrokeColor",[0,0,0,0],Ee$2(this.colorCache)),Ie$2(l,"lineDasharray",a,"lineDasharray",[0,0,0,0],(t=>{let e;if(t&&t.length){const n=t;1===t.length?e=[n[0],n[0],n[0],n[0]]:2===t.length?e=[n[0],n[1],n[0],n[1]]:3===t.length?e=[n[0],n[1],n[2],n[2]]:4===t.length?e=t:t.length>4&&(e=t.slice(0,4))}return e||[0,0,0,0]})),Ie$2(l,"lineDashColor",a,"lineDashColor",[0,0,0,0],Ee$2(this.colorCache));const h=i.properties.iconAtlas,c=i.data.aPosition instanceof Int16Array;h&&(l.linePatternFile=pn$1(this.regl,h,!1),l.atlasSize=h?[h.width,h.height]:[0,0],l.flipY=c?-1:1,this.drawDebugAtlas(h)),void 0===o&&i.generateBuffers(this.regl);const u=new tt$6(l),f=new ft$6(i,u,{castShadow:!1,picking:!0});f.setLocalTransform(e),f.positionMatrix=this.getAltitudeOffsetMatrix();const d={};return h&&(d.HAS_PATTERN=1),f.properties.symbolIndex=r,this.Oi(f,d),i.data.aColor&&(d.HAS_COLOR=1),i.data.aStrokeColor&&(d.HAS_STROKE_COLOR=1),this.setMeshDefines(d,i,s),i.data.aAltitude&&(d.HAS_ALTITUDE=1),f.setDefines(d),f}addMesh(...t){delete this.Ii;const e=t[0];Array.isArray(e)&&e.forEach((t=>{this.Ci(t)})),super.addMesh(...t)}Ci(t){if(!t.geometry.aLineWidth&&t.material.get("lineWidth")<=0||!t.geometry.aOpacity&&t.material.get("lineOpacity")<=0)return;const e=t.defines;this.Oi(t,e),t.setDefines(e),t.geometry.properties.hasPatternAnim&&(this.Ii=1)}Oi(t,e){const n=t.geometry,i=this.getSymbol(t.properties.symbolIndex);n.data.aDasharray||Array.isArray(i.lineDasharray)&&i.lineDasharray.reduce(((t,e)=>t+e),0)>0?(e.HAS_DASHARRAY=1,n.data.aDasharray&&(e.HAS_DASHARRAY_ATTR=1),n.data.aDashColor&&(e.HAS_DASHARRAY_COLOR=1)):e.HAS_DASHARRAY&&delete e.HAS_DASHARRAY}setLineUniforms(t,e){Ie$2(e,"lineWidth",t,"lineWidth",2),Ie$2(e,"lineOpacity",t,"lineOpacity",1),Ie$2(e,"lineStrokeWidth",t,"lineStrokeWidth",0),Ie$2(e,"lineBlur",t,"lineBlur",.7),Ie$2(e,"lineOffset",t,"lineOffset",0),Ie$2(e,"lineDx",t,"lineDx",0),Ie$2(e,"lineDy",t,"lineDy",0),Ie$2(e,"linePatternAnimSpeed",t,"linePatternAnimSpeed",0),Ie$2(e,"linePatternGap",t,"linePatternGap",0)}setMeshDefines(t,e,n){e.data.aOpacity&&(t.HAS_OPACITY=1),e.data.aLineWidth&&(t.HAS_LINE_WIDTH=1),e.data.aLineStrokeWidth&&(t.HAS_STROKE_WIDTH=1),Ze$2(n.lineDx)&&(t.HAS_LINE_DX=1),Ze$2(n.lineDy)&&(t.HAS_LINE_DY=1),Ze$2(n.linePatternAnimSpeed)&&(t.HAS_PATTERN_ANIM=1),Ze$2(n.linePatternGap)&&(t.HAS_PATTERN_GAP=1)}paint(t){t.states&&t.states.includesChanged.shadow&&(this.shader.dispose(),this.createShader(t)),super.paint(t)}createFnTypeConfig(t,e){const n=piecewiseConstant(e.lineColor),i=piecewiseConstant(e.aLinePatternAnimSpeed),r=piecewiseConstant(e.aLinePatternGap),o=this.createShapeFnTypeConfigs(t,e),s=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=Ce$2(r),r}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(e,n,r,o)=>{let a=i(t.getZoom(),e);return Me$2(a)&&(a=0),0!==a&&(n.properties.hasPatternAnim=1),s[0]=a/127,s[1]=r[o+1],s[0]}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(e,n,i,o)=>{let a=r(t.getZoom(),e);return Me$2(a)&&(a=0),s[1]=10*a,s[0]=i[o],s[0]}}].concat(o)}createShapeFnTypeConfigs(t,e){const n=interpolated(e.lineWidth),i=interpolated(e.lineOpacity),r=interpolated(e.lineStrokeWidth),o=interpolated(e.lineDx),s=interpolated(e.lineDy),a=new Uint16Array(1),l=new Int8Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e)),a[0]=Math.round(2*r),a[0]}},{attrName:"aLineStrokeWidth",symbolName:"lineStrokeWidth",type:Uint8Array,width:1,define:"HAS_STROKE_WIDTH",evaluate:e=>{const n=r(t.getZoom(),e);return a[0]=Math.round(2*n),a[0]}},{attrName:"aLineDxDy",symbolName:"lineDx",type:Int8Array,width:2,define:"HAS_LINE_DX",evaluate:e=>{const n=o(t.getZoom(),e);return l[0]=n,l[0]}},{attrName:"aLineDxDy",symbolName:"lineDy",type:Int8Array,width:2,define:"HAS_LINE_DY",evaluate:e=>{const n=s(t.getZoom(),e);return l[0]=n,l[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),a[0]=255*r,a[0]}}]}updateSceneConfig(t){t.trailAnimation&&this.createShader(this.Ei)}init(t){this.renderer=new N$8(this.regl),this.createShader(t),this.pickingFBO&&(this.picking=[new Am(this.renderer,{vert:"#define PICKING_MODE 1\n"+bn$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO,this.getMap())])}createShader(t){this.Ei=t;const e=[],i={};this.fillIncludes(i,e,t),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(i.HAS_TRAIL=1);const o=[];e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5(o,e.projViewMatrix,e.modelMatrix),o}}),this.shader=new ie$5({vert:bn$1,frag:"#define SHADER_NAME LINE\n#define DEVICE_PIXEL_RATIO 1.0\nprecision highp float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform lowp float blendSrcIsOne;\nuniform lowp float lineBlur;\nuniform float isRenderingTerrain;\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform lowp vec4 lineColor;\n#endif\n#include <highlight_frag>\n#ifdef HAS_STROKE_COLOR\nvarying vec4 vStrokeColor;\n#else\nuniform lowp vec4 lineStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatterGapColor;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d) {\n  vec2 e = mod(d, 1.);\n  vec2 f = vTexInfo.xy;\n  vec2 h = vTexInfo.zw;\n  return (f + e * h) / atlasSize;\n}\n#endif\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\nuniform float tileExtent;\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvarying vec4 vDasharray;\n#else\nuniform vec4 lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvarying vec4 vDashColor;\n#else\nuniform vec4 lineDashColor;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nvarying highp float vLinesofar;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\n#endif\n#if defined(HAS_TRAIL) || defined(HAS_PATTERN)\nuniform float currentTime;\n#endif\nfloat i(float j, float k) {\n  float l = k / 2.;\n  float m = abs(j - l);\n  float n = (.1 + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  return clamp(min(m + n, l - m) / n, .0, 1.);\n}\nvarying vec3 vVertex;\nuniform vec3 cameraPosition;\nuniform float cameraToCenterDistance;\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat o = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(o == .0) {\n    discard;\n  }\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nfloat u = vLinesofar;\n#endif\nfloat v = length(vNormal) * vWidth.s;\n#ifdef HAS_PATTERN\nvec2 h = vTexInfo.zw;\n  float A = sign(h.x * h.y);\n  float B = mix(lineBlur, .0, A);\n#else\nfloat B = lineBlur;\n#endif\nfloat n = (B + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float C = clamp(min(v - (vWidth.t - n), vWidth.s - v) / n, .0, 1.);\n#ifdef HAS_COLOR\nvec4 D = vColor / 255.;\n#else\nvec4 D = lineColor;\n#endif\n#ifdef HAS_PATTERN\nif(A == 1.) {\n    \n#ifdef HAS_PATTERN_GAP\nfloat E = vLinePatternGap;\n#else\nfloat E = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat F = vLinePatternAnimSpeed;\n#else\nfloat F = linePatternAnimSpeed;\n#endif\nfloat G = ceil(h.x * vWidth.s * 2. / h.y);\n    float H = G * (1. + E);\n    u += mod(currentTime * -F * .2, H);\n    float I = mod(u / H, 1.);\n    float J = mod((flipY * vNormal.y + 1.) / 2., 1.);\n    vec4 K = texture2D(linePatternFile, c(vec2(I * (1. + E), J)));\n    float L = clamp(sign(1. / (1. + E) - I) + .000001, .0, 1.);\n    K = mix(linePatterGapColor, K, L);\n    D *= K;\n  }\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvec4 M = vDasharray;\n#else\nvec4 M = lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvec4 N = vDashColor;\n#else\nvec4 N = lineDashColor;\n#endif\nfloat k = M[0] + M[1] + M[2] + M[3];\n  float j = mod(u, k);\n  float O = max(sign(M[0] - j), .0);\n  float P = j - M[0] - M[1];\n  float Q = max(sign(P), .0) * max(sign(M[2] - P), .0);\n  float R = O + Q;\n  float S = i(j, M[0]);\n  float T = i(P, M[2]);\n  float U = S * O + T * Q;\n  D = D * (1. - U) + N * U;\n#endif\n#ifdef HAS_STROKE_COLOR\nvec4 V = vStrokeColor / 255.;\n#else\nvec4 V = lineStrokeColor;\n#endif\nV = mix(D, V, sign(vWidth.t));\n  D = V * C + max(sign(vWidth.t - v), .0) * D * (1. - C);\n#ifdef HAS_TRAIL\nfloat W = mod(u - currentTime * trailSpeed * .1, trailCircle);\n  float X = W < trailLength ? mix(.0, 1., W / trailLength) : .0;\n  D *= X;\n#endif\n#ifdef HAS_OPACITY\nfloat Y = vOpacity;\n#else\nfloat Y = lineOpacity;\n#endif\ngl_FragColor = D * Y;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat Z = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, Z);\n#endif\nfloat ba;\n  if(isRenderingTerrain == 1.) {\n    ba = 1.;\n  } else {\n    ba = clamp(cameraToCenterDistance * 1.5 / distance(vVertex, cameraPosition), .0, 1.);\n  }\n  if(blendSrcIsOne == 1.) {\n    gl_FragColor *= gl_FragColor.a;\n  }\n  gl_FragColor *= ba;\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:e,defines:i,extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.layer.getRenderer().isEnableTileStencil&&this.layer.getRenderer().isEnableTileStencil(),e=this.canvas;return{viewport:{x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,n)=>n.viewport?n.viewport.width:e?e.width:1,height:(t,n)=>n.viewport?n.viewport.height:e?e.height:1},stencil:{enable:!1,func:{cmp:()=>t?"=":"<=",ref:(e,n)=>t?n.stencilRef:n.level},op:{fail:"keep",zfail:"keep",zpass:()=>t?"zero":"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!1,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getBlendFunc(){return{src:()=>this.sceneConfig.blendSrc||"one",dst:()=>this.sceneConfig.blendDst||"one minus src alpha"}}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i=this.layer.options.tileSize,r=n?xn$1:t.projViewMatrix,o=t.viewMatrix,s=t.cameraToCenterDistance,a=t.getResolution(),h=set(wn$1,t.width,t.height);n&&set(h,i,i);const c=this.sceneConfig.trailAnimation||{},u={layerScale:this.layer.options.styleScale||1,projViewMatrix:r,viewMatrix:o,cameraToCenterDistance:s,resolution:a,canvasSize:h,trailSpeed:c.speed||1,trailLength:c.trailLength||500,trailCircle:c.trailCircle||1e3,currentTime:this.layer.getRenderer().getFrameTimestamp()||0,blendSrcIsOne:+!("one"!==this.sceneConfig.blendSrc),cameraPosition:t.cameraPosition,viewport:n&&e&&e.viewport,isRenderingTerrain:+!!n};return this.setIncludeUniformValues(u,e),u}}class kn$1 extends An$2{postCreateGeometry(t){const{symbolIndex:e,geometry:n}=t,{features:i}=n.properties,r=this.getSymbol(e).lineGradientProperty,o=n.data.aPickingId,s=new Uint8Array(o.length),a=[];let l=o[0];const h=i[l].feature.properties;a.push(h&&h[r]||0);for(let t=1;t<o.length;t++)o[t]!==l&&(l=o[t],a.push(h&&h[r]||0)),s[t]=a.length-1;n.data.aGradIndex=s,n.properties.gradients=a}createMesh(t,e){const{geometry:i,symbolIndex:r,ref:o}=t,s=this.getSymbolDef(r);void 0===o&&Ve$2(i,s,this.getFnTypeConfig(r));const a={tileResolution:i.properties.tileResolution,tileRatio:i.properties.tileRatio,tileExtent:i.properties.tileExtent},l=this.getSymbol(r);this.setLineUniforms(l,a);const h=i.properties.gradients;let c=2*h.length;Tn$1(c)||(c=Sn$1(c));const u=this.regl.texture({width:256,height:c,data:_n$1(h),format:"rgba",mag:"linear",min:"linear",flipY:!1});a.lineGradientTexture=u,a.lineGradientTextureHeight=u.height,void 0===o&&i.generateBuffers(this.regl);const f=new tt$6(a),d=new ft$6(i,f,{castShadow:!1,picking:!0});d.setLocalTransform(e);const p={HAS_GRADIENT:1};return this.setMeshDefines(p,i,s),d.setDefines(p),d.properties.symbolIndex=r,d}createFnTypeConfig(t,e){return this.createShapeFnTypeConfigs(t,e)}createShader(t){this.Ei=t;const e=[],i={};this.fillIncludes(i,e,t),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(i.HAS_TRAIL=1);const o=[];e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5(o,e.projViewMatrix,e.modelMatrix),o}}),this.shader=new ie$5({vert:bn$1,frag:"#define SHADER_NAME LINE_GRADIENT\n#define DEVICE_PIXEL_RATIO 1.0\n#define MAX_LINE_COUNT 128.0\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\nuniform lowp float lineBlur;\nuniform float lineGradientTextureHeight;\nuniform float tileExtent;\nuniform sampler2D lineGradientTexture;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\nvarying highp float vLinesofar;\nvarying float vGradIndex;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\nuniform float currentTime;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat c = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(c == .0) {\n    discard;\n  }\n#endif\nfloat d = length(vNormal) * vWidth.s;\n  float e = (lineBlur + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float f = clamp(min(d - (vWidth.t - e), vWidth.s - d) / e, .0, 1.);\n  float h = vLinesofar;\n  vec4 i = texture2D(lineGradientTexture, vec2(h, (vGradIndex * 2. + .5) / lineGradientTextureHeight)) * f;\n  i *= max(sign(MAX_LINE_COUNT - vGradIndex), .0);\n#ifdef HAS_TRAIL\nfloat j = mod(h - currentTime * trailSpeed * .1, trailCircle);\n  float k = j < trailLength ? mix(.0, 1., j / trailLength) : .0;\n  i *= k;\n#endif\n#ifdef HAS_OPACITY\nfloat l = vOpacity;\n#else\nfloat l = lineOpacity;\n#endif\ngl_FragColor = i * l;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat m = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, m);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:e,defines:i,extraCommandProps:this.getExtraCommandProps()})}}function _n$1(t){t.length>128&&(console.warn("Line count in a tile exceeds maximum limit (128) for line-gradient render plugin."),t=t.slice(0,128));const e=document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=2*t.length,Tn$1(e.height)||(e.height=Sn$1(2*t.length));for(let e=0;e<t.length;e++){const i=t[e],r=n.createLinearGradient(0,0,256,0);for(let t=0;t<i.length;t+=2)r.addColorStop(+i[t],i[t+1]);n.fillStyle=r;const o=e%256;n.fillRect(0,2*o,256,2*o+2)}return n.canvas}function Tn$1(t){return 0==(t&t-1)&&0!==t}function Sn$1(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}class Mn$1{constructor(t){this.j=t||[],this.properties={}}set meshes(t){this.j=t}get meshes(){return this.j}}const Cn$1=new Uint8Array(1),En$1=[],Fn$1={collides:0,boxes:[]};class zn$1 extends fn$1{createGeometry(...t){const e=super.createGeometry(...t);if(!e||!e.geometry)return e;const{geometry:n}=e,i=t[0];return n.properties.collideIds=i.featureIds&&i.featureIds.length&&i.isIdUnique?i.featureIds:i.data.aPickingId,n.properties.uniqueCollideIds=Ne$2(n.properties.collideIds),e}supportRenderMode(t){const e=this.sceneConfig.renderToPointRenderTarget;return e||void 0===e?"point"===t:"fxaa"===t||"fxaaAfterTaa"===t}startMeshCollision(t){const{meshKey:e}=t.properties,{renderer:n}=this.Fi,i=n.isForeground(t instanceof Mn$1?t.meshes[0]:t);if(t.properties.isForeground=i,t instanceof Mn$1&&t.meshes.length)for(let e=0;e<t.meshes.length;e++)t.meshes[e].properties.isForeground=i;this.zi=performance.now(),this.ji=this.Ri(),this.Di=this.Ni(e)}endMeshCollision(t){const e=this.Li.tags[t];if(this.ji&&e&&this.Di){const t=this.getMap();e.anchor0=t.containerPointToCoord(this.Hi),e.anchor1=t.containerPointToCoord(this.Vi),e.anchor0.z=t.getZoom(),e.anchor0.width=t.width,e.anchor0.height=t.height}this.getMap().collisionFrameTime+=performance.now()-this.zi}Ni(t){const e=this.getMap(),n=e.getZoom(),[i,r]=this.Ui(t);return!i||!r||i.z!==n||i.width!==e.width||i.height!==e.height||i.distanceTo(this.Hi)>2||r.distanceTo(this.Vi)>2}Gi(){const e=this.getMap();this.Wi={},this.Hi=new t__namespace.Point(e.width/2,e.height/3),this.Vi=new t__namespace.Point(e.width/2,2*e.height/3),delete this.ji,this.Li||(this.Li={tags:{}}),this.Fi={layer:this.layer,renderer:this.layer.getRenderer(),frameTimestamp:this.layer.getRenderer().getFrameTimestamp(),map:this.getMap(),zoom:e.getZoom(),collisionTags:this.Li.tags,isEnableUniquePlacement:this.isEnableUniquePlacement()}}qi(){this.$i=this.isEnableCollision()}Bi(t,e){const n=this.Li;return n.tags[t]&&n.tags[t][e]}Xi(t,e,n){const i=this.Li;i.tags[t]=i.tags[t]||[],i.tags[t][e]=n}Ri(){const t=this.getMap();if(!t.isInteracting())return!0;return t.collisionFrameTime<=this.layer.options.collisionFrameLimit}Ui(t){const e="__meshAnchorKey".trim(),n=this.Li.tags[t];if(n&&n.anchor0){const{anchor0:t,anchor1:i}=n,r=t[e]=t[e]||t.x+","+t.y,o=i[e]=i[e]||i.x+","+i.y;let s=this.Wi[r],a=this.Wi[o];if(!s||!a){const e=this.getMap();s=this.Wi[r]=e.coordToContainerPoint(t),a=this.Wi[o]=e.coordToContainerPoint(i)}return s.z=t.z,En$1[0]=s,En$1[1]=a,s.width=t.width,s.height=t.height,En$1}return En$1[0]=En$1[1]=null,En$1}updateBoxCollisionFading(t,e,n,i,r){const{layer:o,renderer:s,zoom:a,collisionTags:l,isEnableUniquePlacement:h}=this.Fi,{meshKey:c,isForeground:u}=e.properties;if(h&&this.Yi(c,r))return!1;const f=n.length;let d=l[c]&&l[c][r];const p=d,m=this.Ji&&d;if((!m||0===d.collides)&&t){const t=m&&0===d.collides;if(this.ji||t)if((this.Di||d&&d.z!==a)&&(d=null),d){if(d.boxes&&d.boxes.length){const{boxes:t,isAllowOverlap:e}=d;let n=0;if(!e){let e=0;for(let i=0;i<t.length;i++)if(!n){const r=this.isCollides(t[i]);if(-1===r)e++;else if(1===r){n=1;break}}e===t.length&&(n=-1)}d.collides=n}}else{d=p||{collides:0,boxes:[]},d.boxes.length=0,d.z=a;let t=0;for(let e=0;e<f;e++){const{mesh:o,allElements:s,boxCount:a,start:l,end:h}=n[e],c=this.Zi(o,s,a,l,h,i,r);c.isAllowOverlap&&(d.isAllowOverlap=1),0===t&&(t=c.collides),c.boxes&&d.boxes.push(...c.boxes)}d.collides=t,this.Xi(c,r,d)}}let y=t&&d&&0===d.collides,g=1,v=!1;if(this.sceneConfig.fading){const t=this.Ki(e);if(this.Qi)t[r]=y?1:-1;else if(u&&delete e.tr,g=this.er(u,y,t,r),u?(g>0&&(y=!0),v=this.isBoxFading(e,r),v&&this.setToRedraw()):y||(this.nr(t,r),g=0),y){const n=e.tr;if(n&&1===g&&t[r]>0){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;Me$2(e)&&(e=224),Me$2(t)&&(t=100);const i=Te$2(1-(s.getFrameTimestamp()-n-t)/e,0,1);g*=i,i>0&&this.setToRedraw()}}}if(d&&o.options.debugCollision&&this.addCollisionDebugBox(d.boxes,d.collides?0:1),y||v){const{mesh:t,start:e}=n[0],i=this.getSymbol(t.properties.symbolIndex);!this.ir(i,t,e)&&d&&d.boxes&&this.rr(d.boxes,t)}if(y){const t=Cn$1[0]=255*g;for(let e=0;e<f;e++){const{mesh:i,allElements:r,start:o,end:s,boxIndex:a}=n[e];this.setCollisionOpacity(i,r,t,o,s,a)}}return y&&g>0}isMeshIterable(){return!0}setCollisionOpacity(t,e,n,i,r){this.or(t,n,e[i],e[r-1])}or(t,e,n,i){const{aOpacity:r}=t.geometry.properties;if(!r)return;const o=n;if(r[o]!==e){const t=i;for(let n=o;n<=t;n++)r[n]=e;r.dirty=!0}}isBoxFading(t,e){const{frameTimestamp:n}=this.Fi;let i=this.sceneConfig.fadingDuration;return Me$2(i)&&(i=224),n-Math.abs(this.Ki(t)[e])<i}Zi(t,e,n,i,r,o,s){const a=this.getSymbol(t.properties.symbolIndex),l=this.ir(a,t,e[i]),h=this.sr(a,t,e[i]);if(!this.isEnableCollision()||l&&h)return Fn$1;const c=this.isBoxCollides(t,e,n,i,r,o,s);return h&&(c.collides=0,c.isAllowOverlap=1),c}ir(t,e,n){if(!this.isEnableCollision())return!0;const i=e.geometry.properties.aOverlap;if(!i)return 1==+t[this.propIgnorePlacement];const r=i[n];return r<2?1==+t[this.propIgnorePlacement]:r%8%2}sr(t,e,n){if(!this.isEnableCollision())return!0;const i=e.geometry.properties.aOverlap;if(!i)return 1==+t[this.propAllowOverlap];const r=i[n];return r<2?1==+t[this.propAllowOverlap]:(r>>2)%2}rr(t){if(Array.isArray(t[0]))for(let e=0;e<t.length;e++)this.insertCollisionBox(t[e]);else this.insertCollisionBox(t)}er(t,e,n,i){let{fadingDuration:r,fadeInDelay:o,fadeOutDelay:s}=this.sceneConfig;Me$2(r)&&(r=224),Me$2(o)&&(o=600),Me$2(s)&&(s=100);const{frameTimestamp:a}=this.Fi;let l=n[i],h=e?1:0;if(!l)return e&&t&&(n[i]=a+o),0;if(a<Math.abs(l)&&(!e&&l>0||e&&l<0)){const t=a-r;n[i]=l=e?t:-t}return a-Math.abs(l)<r?h=l>0?(a-l)/r:1-(a+l)/r:e?(l<0&&(n[i]=l=a+o),h=(a-l)/r):(l>0&&(n[i]=l=-(a+s)),h=1-(a+l)/r),(h<0||h>1)&&(h=Te$2(h,0,1)),h}Ki(t){this.ar||(this.ar={});const{meshKey:e}=t.properties;if(!this.ar[e]){const{frameTimestamp:t}=this.Fi;this.ar[e]={timestamp:t}}return this.ar[e]}lr(t){if(!this.hr)return void(this.hr=t);const e=this.scene.getMeshes();if(e&&e.length){for(let n=0;n<e.length;n++){const i=this.Ki(e[n]);i.timestamp<this.hr?delete e[n]._fading_timestamps:i.timestamp=t}this.hr=t}}nr(t,e){if(!t)return;const{frameTimestamp:n}=this.Fi;let{fadingDuration:i}=this.sceneConfig;Me$2(i)&&(i=224),t[e]=-(n-i-1)}deleteMesh(t,e){if(t){if(Array.isArray(t))for(let e=0;e<t.length;e++){const n=t[e].properties.meshKey;this.Li&&delete this.Li.tags[n],this.ar&&delete this.ar[n]}else{const e=t.properties.meshKey;this.Li&&delete this.Li.tags[e],this.ar&&delete this.ar[e]}super.deleteMesh(t,e)}}delete(t){this.cr&&(this.cr.geometry.dispose(),this.ur.dispose(),this.cr.dispose(),delete this.cr,delete this.ur,delete this.dr),delete this.Li,super.delete(t)}isCollides(t){const e=this.layer;return e.getMap().isOffscreen(t)?-1:+e.getCollisionIndex().collides(t)}insertCollisionBox(t){this.layer.getCollisionIndex().insertBox(t)}addCollisionDebugBox(t,e){if(t&&t.length)if(Array.isArray(t[0]))for(let n=0;n<t.length;n++){this.pr(t[n],e)}else this.pr(t,e)}pr(t,e){if(!t)return;const n=this.mr=this.mr||{aPosition:[],aVisible:[],indices:[]};if(this.getMap().isOffscreen(t))return;const i=n.aPosition.length/2;n.aPosition.push(t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]),n.aVisible.push(e,e,e,e),n.indices.push(i,i+1,i+1,i+2,i+2,i+3,i+3,i)}yr(){return this.isEnableCollision()||this.$i}updateCollision(t){super.updateCollision(t),this.Gi(),this.gr(),this.vr&&this.vr.length&&(this.br(),this.vr&&(this.setToRedraw(),this.scene.addMesh(this.vr))),(this.getMap().isZooming()||this.vr&&this.vr.length)&&(this.xr(),this.wr(this.scene.getMeshes()))}paint(t){const e=super.paint(t);return this.Ar(t),!1===this.ji&&this.setToRedraw(),e}shouldIgnoreBackground(){return!this.getMap().isZooming()&&!this.vr}gr(){const t=this.getMap(),e=t.isZooming();if(!e&&this.Ji){const t=this.layer.getRenderer();this.vr=this.scene.getMeshes().filter((e=>!t.isForeground(e)&&!e.properties.isLinePlacement))}else e&&!this.Ji&&(this.kr=t.getResolution());if(e)this._r&&(clearTimeout(this._r),delete this.Qi,delete this._r),this.Qi=this.kr&&t.getResolution()>this.kr;else if(this.Ji&&!this._r){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;Me$2(t)&&(t=100),Me$2(e)&&(e=224),this._r=setTimeout((()=>{delete this.Qi,delete this._r}),t+e+1)}this.Ji=e}Ar(t){if(!this.mr||!this.layer.options.debugCollision)return;this.dr||this.Tr();const{aPosition:e,aVisible:i,indices:r}=this.mr;if(!this.cr){const t=new Q$7({aPosition:[],aVisible:[]},[],0,{positionSize:2,primitive:"lines"});this.cr=new ft$6(t),this.Sr=new yt$6,this.Sr.addMesh(this.cr)}const o=this.cr.geometry;o.updateData("aPosition",new Float32Array(e)),o.updateData("aVisible",new Uint8Array(i)),o.setElements(r),this.dr.render(this.ur,{size:[this.canvas.width,this.canvas.height]},this.Sr,this.getRenderFBO(t)),delete this.mr}Tr(){this.dr=new N$8(this.regl);const e=this.canvas;this.ur=new ie$5({vert:"attribute vec2 aPosition;\nattribute float aVisible;\nuniform vec2 size;\nvarying vec4 vColor;\nvoid main() {\n  vec2 c = (aPosition / size - .5) * 2. * vec2(1., -1.);\n  gl_Position = vec4(c, .0, 1.);\n  vColor = mix(vec4(1., .0, .0, 1.5) * .5, vec4(.0, 1., .0, 1.) * .4, aVisible);\n}",frag:"precision mediump float;\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vec4(vColor.rgb, .5);\n}",uniforms:["size"],extraCommandProps:{viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},depth:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}})}br(){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;Me$2(t)&&(t=100),Me$2(e)&&(e=224);const n=this.layer.getRenderer(),i=n.getCurrentTileZoom(),r=n.getFrameTimestamp(),o=[];for(let s=0;s<this.vr.length;s++){const a=this.vr[s],l=a.properties.tile;!a.tr&&n.isBackTile(l.id)&&(a.tr=r);a.properties.level=l.z-i>0?2*(l.z-i)-1:2*(i-l.z),n.isForeground(a)||a.tr&&r-a.tr>t+e?delete a.tr:o.push(a)}delete this.vr,o.length&&(this.vr=o)}isEnableCollision(){return this.layer.options.collision&&!!this.sceneConfig.collision}isEnableUniquePlacement(){return this.isEnableCollision()&&this.sceneConfig.uniquePlacement}isMeshUniquePlaced(t){return this.isMeshIterable(t)}xr(){if(!this.isEnableUniquePlacement())return;const t=this.scene.getMeshes(),e=(t,e,n,i)=>{const{start:r,end:o}=e[0],s=t.geometry.properties,a=s.elements;let l=s.uniquePlacements;if(l||(l=s.uniquePlacements=[]),void 0===l[i]){const e=this.getUniqueEntryKey(t,a[r],i);l[i]=e?{key:e,index:i,start:a[r],end:a[o-1]}:null}};for(let n=0;n<t.length;n++){const i=t[n];this.isMeshUniquePlaced(i)&&this.forEachBox(i,e)}}wr(t){if(!this.isEnableUniquePlacement())return;const e=this.getMap().getZoom();let n=!this.Mr||this.Pr!==e;if(!n)for(let e=0;e<t.length;e++)if(!this.Mr[t[e].properties.meshKey]){n=!0;break}if(!n)return;this.Pr=e,this.Ir={},this.Mr={},t=t.sort(Rn$1);const i=this.getMap().getGLScale(),r={};for(let e=0;e<t.length;e++){const n=t[e];if(!n.geometry)continue;const{meshKey:o}=n.properties;this.Mr[o]=1;const{uniquePlacements:s}=n.geometry.properties;if(s)for(let t=0;t<s.length;t++){if(!s[t])continue;const{key:e,index:o}=s[t],a=this.Ki(n),l=jn$1(e,i),h=r[l];if(h){const t=h.length,e=h[t-3].properties.meshKey,i=h[t-2],r=h[t-1];this.Ir[e]=this.Ir[e]||{},this.Ir[e][r]=1,this.Or(a,o,i,r),h.push(n,a,o)}else r[l]=[n,a,o]}}for(const t in r){const e=r[t];if(e.length<=6)continue;const n=e.length,i=e[n-2][e[n-1]];if(e[1][e[2]]!==i)for(let t=0;t<n-6;t+=3)e[t+1][e[t+2]]=i}}Or(t,e,n,i){if(void 0!==n[i])if(void 0===t[e])t[e]=n[i];else{let r=t[e];Math.abs(n[i])>Math.abs(r)?t[e]=n[i]:n[i]=t[e]}else void 0!==t[e]&&(n[i]=t[e])}Yi(t,e){return this.Ir&&this.Ir[t]&&this.Ir[t][e]}Cr(t,e){const{symbolIndex:n}=t.properties,i=n.type||0;let r=t.properties._collidesBoxes;r||(r=t.properties._collidesBoxes=[]);let o=r[n.index];o||(o=t.properties._collidesBoxes=[]),o[i]||(o[i]=[]),o=o[i];const s=e/6;if(!o[s]){const t=[];o[s]={boxes:t,collision:{boxes:t}}}return o[s]}Er(t){let e=this.Fr;if(e||(e=this.Fr=[]),!e[t]){e[t]=[];for(let n=0;n<t;n++)e[t][n]={}}return e[t]}zr(t){return!t||!t.geometry||!(!t.geometry.properties.glyphAtlas||!t.material.get("isHalo")||t.geometry.data.aTextHaloRadius&&t.geometry.properties.hasHalo)&&(!(!t.geometry.data.aTextHaloRadius||t.geometry.properties.hasHalo)||!this.getSymbol(t.geometry.properties.symbolIndex).textHaloRadius)}}function jn$1(t,e){return Math.round(t[0]/e/10)*Math.round(t[1]/e/10)*(t[2]?Math.round(t[2]/10):1)+"-"+t[3]}function Rn$1(t,e){const n=e.properties.level-t.properties.level;return 0===n?t.properties.meshKey-e.properties.meshKey:n}var Dn$1="#include <gl2_vert>\n#define SHADER_NAME MARKER\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_MARKER_WIDTH\nattribute float aMarkerWidth;\n#else\nuniform float markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nattribute float aMarkerHeight;\n#else\nuniform float markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nattribute float aMarkerDx;\n#else\nuniform float markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nattribute float aMarkerDy;\n#else\nuniform float markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#ifdef HAS_ROTATION\nattribute float aRotation;\n#else\nuniform float markerRotation;\n#endif\n#ifdef HAS_PAD_OFFSET\nattribute float aPadOffsetX;\nattribute float aPadOffsetY;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float markerPerspectiveRatio;\nuniform vec2 iconSize;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\n#include <vt_position_vert>\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vOpacity;\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_MARKER_WIDTH\nfloat d = aMarkerWidth;\n#else\nfloat d = markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nfloat e = aMarkerHeight;\n#else\nfloat e = markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nfloat f = aMarkerDx;\n#else\nfloat f = markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nfloat h = aMarkerDy;\n#else\nfloat h = markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat i = aPitchAlign;\n#else\nfloat i = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat j = aRotationAlign;\n#else\nfloat j = rotateWithMap;\n#endif\ngl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  float k = gl_Position.w;\n  float l;\n  if(isRenderingTerrain == 1.) {\n    l = 1.;\n  } else {\n    float m = (1. - cameraToCenterDistance / k) * markerPerspectiveRatio;\n    l = clamp(.5 + .5 * (1. - m), .0, 4.);\n  }\n#ifdef HAS_ROTATION\nfloat n = -aRotation / 9362. - mapRotation * j;\n#else\nfloat n = -markerRotation - mapRotation * j;\n#endif\nif(i == 1.) {\n    n += mapRotation;\n  }\n  float o = sin(n);\n  float u = cos(n);\n  mat2 v = mat2(u, -1. * o, o, u);\n  vec2 A = (aShape / 10.0);\n  if(i == 1. && flipY == .0) {\n    A *= vec2(1., -1.);\n  }\n#ifdef HAS_PAD_OFFSET\nA = (A / iconSize * vec2(d, e) + vec2(aPadOffsetX - 1., aPadOffsetY)) * layerScale;\n#else\nA = A / iconSize * vec2(d, e) * layerScale;\n#endif\nA = v * A;\n  if(i == .0) {\n    vec2 B = A * 2. / canvasSize;\n    gl_Position.xy += B * l * k;\n  } else {\n    float C;\n    if(isRenderingTerrain == 1.) {\n      C = 1.;\n    } else {\n      C = k / cameraToCenterDistance;\n    }\n    vec2 B = A;\n    gl_Position = projViewModelMatrix * positionMatrix * vec4(c + vec3(B, .0) * tileRatio / zoomScale * C * l, 1.);\n  }\n  gl_Position.xy += vec2(f, -h) * 2. / canvasSize * k;\n#ifndef PICKING_MODE\nvTexCoord = aTexCoord / texSize;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool D = aOpacity == 255.;\n#else\nbool D = true;\n#endif\nfbo_picking_setData(gl_Position.w, D);\n#endif\n}";const Nn$1=[];function Ln$1(t,e,n,i,r){return set$3(Nn$1,e[0],e[1],e[2],1),transformMat4$1(Nn$1,Nn$1,n),t[2]=Nn$1[3],scale$3(Nn$1,Nn$1,1/Nn$1[3]),t[0]=(Nn$1[0]+1)*i/2,t[1]=(1-Nn$1[1])*r/2,t}const Hn$1=[],Vn$1=[],Un$1=[],Gn$1=[],Wn$1=[],qn$1=[];function $n$1(t,e,n,r,o,s,a,c,u,f,d,p,m,y){const{tileRatio:g,tileResolution:v}=u,b=g/(v/f.getResolution())*(d/f.cameraToCenterDistance)*p;scale(n,n,b),scale(r,r,b),scale(o,o,b),scale(s,s,b),set$4(Hn$1,n[0],n[1],m?n[2]/y:0),set$4(Vn$1,r[0],r[1],m?r[2]/y:0),set$4(Un$1,o[0],o[1],m?o[2]/y:0),set$4(Gn$1,s[0],s[1],m?s[2]/y:0),add$4(Hn$1,Hn$1,e),add$4(Vn$1,Vn$1,e),add$4(Un$1,Un$1,e),add$4(Gn$1,Gn$1,e),Ln$1(n,Hn$1,a,f.width,f.height),Ln$1(r,Vn$1,a,f.width,f.height),Ln$1(o,Un$1,a,f.width,f.height),Ln$1(s,Gn$1,a,f.width,f.height),set(Wn$1,Math.min(n[0],r[0],o[0],s[0]),Math.min(n[1],r[1],o[1],s[1])),set(qn$1,Math.max(n[0],r[0],o[0],s[0]),Math.max(n[1],r[1],o[1],s[1])),set$3(t,Wn$1[0]+c[0],Wn$1[1]+c[1],qn$1[0]+c[0],qn$1[1]+c[1])}function Bn$1(t,e,n,i,r,o,s,a){1!==a&&(scale(n,n,a),scale(i,i,a),scale(r,r,a),scale(o,o,a)),set(Wn$1,Math.min(n[0],i[0],r[0],o[0]),Math.min(n[1],i[1],r[1],o[1])),set(qn$1,Math.max(n[0],i[0],r[0],o[0]),Math.max(n[1],i[1],r[1],o[1])),set$3(t,e[0]+Wn$1[0]+s[0],e[1]+Wn$1[1]-s[1],e[0]+qn$1[0]+s[0],e[1]+qn$1[1]-s[1])}function Xn$1(t,e,n,i,r){e-=n*i,1===r&&(e+=n);const o=Math.sin(e),s=Math.cos(e);return set$8(t,s,-o,o,s)}const Yn$1=[],Jn$1=[],Zn$1=[],Kn$1=[],Qn$1=[],ti$1=[],ei$1=[],ni$1=[],ii$1=[1,-1],ri$1=[1,1];function oi$1(t,e,n,r,o){const s=e.material.uniforms,a=o.cameraToCenterDistance,h=e.geometry.properties,c=this.getSymbol(h.symbolIndex),u=e.geometry.desc.positionSize,f=h.aAnchor,d=set$4(Yn$1,f[n*u],f[n*u+1],2===u?0:f[n*u+2]);let p=Ln$1(Jn$1,d,r,o.width,o.height);const m=p[2];let y=1;s.markerPerspectiveRatio&&(y=Te$2(.5+.5*(1-(1-a/m)*s.markerPerspectiveRatio),0,4));const{aShape:g,aMarkerDx:v,aMarkerDy:b,aMarkerWidth:x,aMarkerHeight:w,aPitchAlign:A,aRotationAlign:k,aRotation:_}=h,M=A?A[n]:s.pitchWithMap,P=k?k[n]:s.rotateWithMap,I=set(ni$1,(v?v[n]:c.markerDx)||0,-((b?b[n]:c.markerDy)||0));let O=set(Kn$1,g[2*n]/10,g[2*n+1]/10),C=set(Qn$1,g[2*n+2]/10,g[2*n+3]/10),E=set(ti$1,g[2*n+4]/10,g[2*n+5]/10),F=set(ei$1,g[2*n+6]/10,g[2*n+7]/10);0===s.flipY&&1===M&&(multiply(O,O,ii$1),multiply(C,C,ii$1),multiply(E,E,ii$1),multiply(F,F,ii$1));let z=x?x[n]:c.markerWidth;Me$2(z)&&(z=15);let j=w?w[n]:c.markerHeight;Me$2(j)&&(j=15);const R=set(ri$1,z/2048,j/2048);mul(O,O,R),mul(C,C,R),mul(E,E,R),mul(F,F,R);const D=-(_?_[n]/9362:-(c.markerRotation||0)*Math.PI/180),N=o.getBearing()*Math.PI/180;if(N*P||D){const t=Xn$1(Zn$1,D,N,P,M);O=transformMat2(O,O,t),C=transformMat2(C,C,t),E=transformMat2(E,E,t),F=transformMat2(F,F,t)}return 1===M?$n$1(t,d,O,C,E,F,r,I,s,o,m,y):(multiply(O,O,ii$1),multiply(C,C,ii$1),multiply(E,E,ii$1),multiply(F,F,ii$1),Bn$1(t,p,O,C,E,F,I,y)),t}const si$1=[],ai$1=[],li$1=[],hi$1=[],ci$1=[],ui$1=[],fi$1=[1,-1];function di$1(t,e,n,r,o,s,a,h,c){const u=r.material.uniforms,f=c.cameraToCenterDistance,d=r.geometry.properties,p=this.getSymbol(d.symbolIndex),m="line"===p.textPlacement&&!Re$2(p),y=n[2];let g=1;u.textPerspectiveRatio&&(g=Te$2(.5+.5*(1-(1-f/y)*u.textPerspectiveRatio),0,4));const{aTextDx:v,aTextDy:b,aPitchAlign:x,aRotationAlign:w,aRotation:A}=r.geometry.properties,T=x?x[a]:u.pitchWithMap,S=w?w[a]:u.rotateWithMap,M=set(ui$1,(v?v[a]:p.textDx)||0,-((b?b[a]:p.textDy)||0));if(m){const{aOffset:r,aShape:o}=d,s=r.length!==o.length;let f,p,m,v;if(s?(f=set$4(ai$1,r[3*a]/10,r[3*a+1]/10,r[3*a+2]/10),p=set$4(li$1,r[3*a+3]/10,r[3*a+4]/10,r[3*a+5]/10),m=set$4(hi$1,r[3*a+6]/10,r[3*a+7]/10,r[3*a+8]/10),v=set$4(ci$1,r[3*a+9]/10,r[3*a+10]/10,r[3*a+11]/10)):(f=set(ai$1,r[2*a]/10,r[2*a+1]/10),p=set(li$1,r[2*a+2]/10,r[2*a+3]/10),m=set(hi$1,r[2*a+4]/10,r[2*a+5]/10),v=set(ci$1,r[2*a+6]/10,r[2*a+7]/10)),1===T){const n=X$4(c.getResolution(),c);$n$1(t,e,f,p,m,v,h,M,u,c,y,g,s,n)}else multiply(f,f,fi$1),multiply(p,p,fi$1),multiply(m,m,fi$1),multiply(v,v,fi$1),Bn$1(t,n,f,p,m,v,M,g)}else{const{aShape:i}=d;let r=set(ai$1,i[2*a]/10,i[2*a+1]/10),s=set(li$1,i[2*a+2]/10,i[2*a+3]/10),f=set(hi$1,i[2*a+4]/10,i[2*a+5]/10),v=set(ci$1,i[2*a+6]/10,i[2*a+7]/10);0===u.flipY&&1===T&&(multiply(r,r,fi$1),multiply(s,s,fi$1),multiply(f,f,fi$1),multiply(v,v,fi$1));const b=A?A[a]/9362:(p.textRotation||0)*Math.PI/180,x=m?0:c.getBearing()*Math.PI/180;if(b||x){const t=Xn$1(si$1,b,x,S,T);r=transformMat2(r,r,t),s=transformMat2(s,s,t),f=transformMat2(f,f,t),v=transformMat2(v,v,t)}const w=o/24;scale(r,r,w),scale(s,s,w),scale(f,f,w),scale(v,v,w),1===T?$n$1(t,e,r,s,f,v,h,M,u,c,y,g):Bn$1(t,n,r,s,f,v,M,g)}return t[0]-=(s=s||0)+1,t[1]-=s+1,t[2]+=s+1,t[3]+=s+1,t}function pi$1(t,e,n){const r=e.geometry.desc.positionSize,{aAnchor:o,aAltitude:s}=e.geometry.properties,a=n*r;return s?set$4(t,o[a],o[a+1],s[n]):3===r?ta.unpackPosition(t,o[a],o[a+1],o[a+2]):set$4(t,o[a],o[a+1],0)}const mi$1={textFill:[0,0,0,1],textOpacity:1,textPitchAlignment:0,textRotationAlignment:0,textHaloRadius:0,textHaloFill:[1,1,1,1],textHaloBlur:0,textHaloOpacity:1,textPerspectiveRatio:0,textSize:14,textDx:0,textDy:0,textRotation:0};function yi$1(t,e,i,r,o,s,a,l,h){const c=[];if(e.isDisposed()||0===e.data.aPosition.length)return c;const u=e.properties.glyphAtlas;if(!u)return c;if(0===r.textSize||0===r.textOpacity)return c;if(Ve$2(e,r,s),!e.properties.aCount){gi$1.call(this,e,a||h,l);const{aTextSize:t,aTextDx:n,aTextDy:i,aPitchAlign:r,aRotationAlign:o,aRotation:s,aOverlap:c,aAltitude:u}=e.data;if(t){const n=(He$2+"aTextSize").trim();e.properties.aTextSize=e.properties[n]||new t.constructor(t)}if(n){const t=(He$2+"aTextDx").trim();e.properties.aTextDx=e.properties[t]||new n.constructor(n)}if(i){const t=(He$2+"aTextDy").trim();e.properties.aTextDy=e.properties[t]||new i.constructor(i)}if(r){const t=(He$2+"aPitchAlign").trim();e.properties.aPitchAlign=e.properties[t]||new r.constructor(r)}if(o){const t=(He$2+"aRotationAlign").trim();e.properties.aRotationAlign=e.properties[t]||new o.constructor(o)}if(s){const t=(He$2+"aRotation").trim();e.properties.aRotation=e.properties[t]||new s.constructor(s)}if(c){const t=(He$2+"aOverlap").trim();e.properties.aOverlap=e.properties[t]||new c.constructor(c)}if(u){const t=(He$2+"aAltitude").trim();e.properties.aAltitude=e.properties[t]||new u.constructor(u)}}const f=pn$1(t,u,!1),d={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio,texture:f,texSize:[u.width,u.height]};vi$1(e,d,o);let p=!1;o.textOpacity<1&&(p=!0),e.properties.memorySize=e.getMemorySize(),e.generateBuffers(t,{excludeElementsInVAO:!0});const m=new tt$6(d,mi$1),y=new ft$6(e,m,{disableVAO:!0,transparent:p,castShadow:!1,picking:!0});if(y.setLocalTransform(i),d.isHalo&&(y.properties.isHalo=!0),a&&y.setDefines({ENABLE_COLLISION:1}),c.push(y),d.isHalo){const t={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio,texture:f,texSize:[u.width,u.height],isHalo:0};vi$1(e,t,o);const r=new tt$6(t,mi$1),s=new ft$6(e,r,{disableVAO:!0,transparent:p,castShadow:!1,picking:!0});Object.defineProperty(s.properties,"textSize",{enumerable:!0,get:function(){return t.textSize}}),a&&s.setDefines({ENABLE_COLLISION:1}),s.setLocalTransform(i),c.push(s)}return c.forEach((t=>{const n=t.defines||{};e.data.aTextFill&&(n.HAS_TEXT_FILL=1),e.data.aTextSize&&(n.HAS_TEXT_SIZE=1),e.data.aColorOpacity&&(n.HAS_OPACITY=1),e.data.aTextHaloFill&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_FILL=1),e.data.aTextHaloRadius&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_RADIUS=1),e.data.aTextHaloOpacity&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_OPACITY=1),e.data.aTextDx&&(n.HAS_TEXT_DX=1),e.data.aTextDy&&(n.HAS_TEXT_DY=1),e.data.aPitchAlign&&(n.HAS_PITCH_ALIGN=1),e.data.aRotationAlign&&(n.HAS_ROTATION_ALIGN=1),e.data.aRotation&&(n.HAS_ROTATION=1),e.data.aAltitude&&(n.HAS_ALTITUDE=1),e.properties.aOffset&&e.properties.aShape&&e.properties.aOffset.length!==e.properties.aShape.length&&(n.HAS_OFFSET_Z=1),t.setDefines(n),t.properties.symbolIndex=e.properties.symbolIndex})),c}function gi$1(t,e,n){const i=this.getSymbol(t.properties.symbolIndex),r="line"===t.properties.textPlacement&&!Re$2(i),{aPosition:o,aShape:s}=t.data,a=o.length/t.desc.positionSize;if(t.properties.aPickingId=t.data.aPickingId,t.properties.aCount=t.data.aCount,delete t.data.aCount,(e||r)&&(t.properties.aAnchor=o,t.properties.aShape=s),t.properties.visElemts||(t.properties.elements=t.elements,t.properties.visElemts=new t.elements.constructor(t.elements.length)),r){const{aVertical:e,aSegment:n,aGlyphOffset:i,aPitchRotation:r}=t.data,o=!!r;t.properties.aGlyphOffset=i,t.properties.aPitchRotation=r,t.properties.aSegment=n,t.properties.aVertical=e,delete t.data.aSegment,delete t.data.aVertical,delete t.data.aGlyphOffset,delete t.data.aPitchRotation;const a=s.length/2*(o?3:2);t.data.aOffset={usage:"dynamic",data:new Int16Array(a)},t.properties.aOffset=new Int16Array(a)}if(e){t.data.aOpacity={usage:"dynamic",data:new Uint8Array(a)},t.properties.aOpacity=new Uint8Array(a),n&&(t.properties.aOpacity.fill(255,0),t.data.aOpacity.data.fill(255,0));const{aTextHaloRadius:e}=t.data;if(e&&!t.properties.aTextHaloRadius){const n=(He$2+"aTextHaloRadius").trim();t.properties.aTextHaloRadius=t.properties[n]||new e.constructor(e)}}}function vi$1(t,e,n){void 0===e.isHalo&&(e.isHalo=1),Ie$2(e,"textOpacity",n,"textOpacity",mi$1.textOpacity),Ie$2(e,"textFill",n,"textFill",mi$1.textFill,Ee$2()),Ie$2(e,"textHaloFill",n,"textHaloFill",mi$1.textHaloFill,Ee$2()),Ie$2(e,"textHaloBlur",n,"textHaloBlur",mi$1.textHaloBlur),Ie$2(e,"textHaloRadius",n,"textHaloRadius",mi$1.textHaloRadius),Ie$2(e,"textHaloOpacity",n,"textHaloOpacity",mi$1.textHaloOpacity),Ie$2(e,"textPerspectiveRatio",n,"textPerspectiveRatio",mi$1.textPerspectiveRatio,(e=>"line"===t.properties.textPlacement?1:e)),Ie$2(e,"rotateWithMap",n,"textRotationAlignment",mi$1.textRotationAlignment,(t=>+("map"===t))),Ie$2(e,"pitchWithMap",n,"textPitchAlignment",mi$1.textPitchAlignment,(t=>+("map"===t))),Ie$2(e,"textSize",n,"textSize",mi$1.textSize),Ie$2(e,"textDx",n,"textDx",mi$1.textDx),Ie$2(e,"textDy",n,"textDy",mi$1.textDy),Ie$2(e,"textRotation",n,"textRotation",mi$1.textRotation,(t=>t*Math.PI/180))}function bi$1(t,e){const n=[];return{uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5(n,e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!1,mask:255,func:{cmp:"<",ref:(t,e)=>2*e.level+(e.isHalo||0)+1,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:e.depthRange||[0,1],func:e.depthFunc||"always",mask:!1},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}}function xi$1(t,e){const n=interpolated(e.textFill),i=interpolated(e.textSize),r=interpolated(e.textHaloFill),o=interpolated(e.textHaloRadius),s=interpolated(e.textHaloOpacity),a=interpolated(e.textDx),l=interpolated(e.textDy),h=interpolated(e.textOpacity),c=piecewiseConstant(e.textPitchAlignment),u=piecewiseConstant(e.textRotationAlignment),f=interpolated(e.textRotation),d=piecewiseConstant(e.textAllowOverlapFn),m=piecewiseConstant(e.textIgnorePlacement),v={},b=new Int16Array(1),x=new Uint16Array(1);return[{attrName:"aTextFill",symbolName:"textFill",define:"HAS_TEXT_FILL",type:Uint8Array,width:4,evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=v[r]=v[r]||color(r).unitArray()),r=Ce$2(r),r}},{attrName:"aTextSize",symbolName:"textSize",define:"HAS_TEXT_SIZE",type:Uint8Array,width:1,evaluate:(e,n)=>{let r=i(t.getZoom(),e)||mi$1.textSize;return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),b[0]=r,b[0]}},{attrName:"aTextHaloFill",symbolName:"textHaloFill",define:"HAS_TEXT_HALO_FILL",type:Uint8Array,width:4,evaluate:e=>{let n=r(t.getZoom(),e);return Array.isArray(n)||(n=v[n]=v[n]||color(n).unitArray()),n=Ce$2(n),n}},{attrName:"aTextHaloRadius",symbolName:"textHaloRadius",define:"HAS_TEXT_HALO_RADIUS",type:Uint8Array,width:1,evaluate:e=>{const n=o(t.getZoom(),e);return b[0]=n,b[0]}},{attrName:"aTextHaloOpacity",symbolName:"textHaloOpacity",define:"HAS_TEXT_HALO_OPACITY",type:Uint8Array,width:1,evaluate:e=>{const n=s(t.getZoom(),e);return b[0]=n,b[0]}},{attrName:"aTextDx",symbolName:"textDx",define:"HAS_TEXT_DX",type:Uint8Array,width:1,evaluate:e=>{const n=a(t.getZoom(),e);return b[0]=n,b[0]}},{attrName:"aTextDy",symbolName:"textDy",define:"HAS_TEXT_DY",type:Uint8Array,width:1,evaluate:e=>{const n=l(t.getZoom(),e);return b[0]=n,b[0]}},{attrName:"aColorOpacity",symbolName:"textOpacity",define:"HAS_OPACITY",type:Uint8Array,width:1,evaluate:(e,n)=>{let i=h(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),b[0]=255*i,b[0]}},{attrName:"aPitchAlign",symbolName:"textPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:e=>+("map"===c(t.getZoom(),e))},{attrName:"aRotationAlign",symbolName:"textRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:e=>+("map"===u(t.getZoom(),e))},{attrName:"aRotation",symbolName:"textRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:e=>{const n=Se$2(f(t.getZoom(),e),0,360)*Math.PI/180;return x[0]=9362*n,x[0]}},{attrName:"aOverlap",symbolName:"textAllowOverlap",type:Uint8Array,width:1,evaluate:n=>{let i=d(t.getZoom(),n)||0,r=(m?m(t.getZoom(),n):e.textIgnorePlacement)||0;return i=1<<3+4*i,r=(m?2:0)+r,i+r}},{attrName:"aOverlap",symbolName:"textIgnorePlacement",type:Uint8Array,width:1,evaluate:n=>{let i=(d?d(t.getZoom(),n):e.textAllowOverlap)||0,r=m(t.getZoom(),n)||0;return i=(d?8:0)+4*i,r=1<<1+r,i+r}}]}const wi$1=[],Ai$1=[],ki$1=[],_i$1=[];function Ti$1(t,e,n,i,r,o,s){t=1===t?1:0;const a=this.getMap(),l=e.geometry.properties,h=this.getSymbol(l.symbolIndex),c="line"===l.textPlacement&&!Re$2(h),{aTextSize:u,aTextHaloRadius:f,aShape:d}=l;let p=u?u[n[r]]:e.properties.textSize;null==p&&(p=mi$1.textSize);const m=f?f[n[r]]:e.properties.textHaloRadius,y=pi$1(ki$1,e,n[r]),g=Ln$1(_i$1,y,s,a.width,a.height),v=i,{boxes:b,collision:x}=this.Cr(e,r);let w=0;if(c||1===e.material.uniforms.rotateWithMap||h.textRotation){let i=0;for(let o=r;o<r+6*v;o+=6){const r=b[w]=b[w]||[];w++;const l=di$1.call(this,r,y,g,e,p,m,n[o],s,a);if(!t){const e=this.isCollides(l);1===e?t=1:-1===e&&i++}}i===v&&(t=-1)}else{let i=n[r],l=d[2*i+1];for(let h=r;h<o;h+=6){const r=d[2*n[h]+1];if(l!==r||h===o-6){const c=n[h===o-6?h:h-6],u=di$1.call(this,wi$1,y,g,e,p,m,i,s,a),f=di$1.call(this,Ai$1,y,g,e,p,m,c,s,a),d=b[w]=b[w]||[];w++,d[0]=Math.min(u[0],f[0]),d[1]=Math.min(u[1],f[1]),d[2]=Math.max(u[2],f[2]),d[3]=Math.max(u[3],f[3]),i=n[h],l=r,!t&&this.isCollides(d)&&(t=1)}}}return x.collides=t,x}function Si$1(t,e){const n=function(t,e){const{aPickingId:n,features:i}=t.geometry.properties,r=n[e];return(i&&i[r]&&i[r].feature).label}(t,e);return n?function(t,e,n){if(!n)return null;const i=t.localTransform,r=pi$1(Mi$1,t,e);set$3(Pi$1,r[0],r[1],r[2],1);const o=transformMat4$1(Pi$1,Pi$1,i);let s=0;for(let t=0;t<n.length;t++)s+=n.charCodeAt(t);return[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2]),s]}(t,e,n):null}const Mi$1=[],Pi$1=[];var Ii$1="#define SHADER_NAME TEXT\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#if defined(HAS_ROTATION)\nattribute float aRotation;\n#else\nuniform float textRotation;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float glyphSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_SIZE\nfloat d = aTextSize * layerScale;\n#else\nfloat d = textSize * layerScale;\n#endif\n#ifdef HAS_TEXT_DX\nfloat e = aTextDx;\n#else\nfloat e = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat f = aTextDy;\n#else\nfloat f = textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat i = aRotationAlign;\n#else\nfloat i = rotateWithMap;\n#endif\nvec2 j = aShape / 10.0;\n  if(h == 1. && flipY == .0) {\n    j = j * vec2(1., -1.);\n  }\n  vec2 k = aTexCoord;\n  gl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  float l = gl_Position.w;\n  float m;\n  if(isRenderingTerrain == 1.) {\n    m = 1.;\n  } else {\n    float n = (1. - cameraToCenterDistance / l) * textPerspectiveRatio;\n    m = clamp(.5 + .5 * (1. - n), .0, 4.);\n  }\n#ifdef HAS_ROTATION\nfloat o = -aRotation / 9362. - mapRotation * i;\n#else\nfloat o = -textRotation - mapRotation * i;\n#endif\nif(h == 1.) {\n    \n#ifdef REVERSE_MAP_ROTATION_ON_PITCH\no += mapRotation;\n#else\no -= mapRotation;\n#endif\n  }\n  float u = sin(o);\n  float v = cos(o);\n  mat2 A = mat2(v, -1. * u, u, v);\n  j = A * (j / glyphSize * d);\n  float B;\n  if(isRenderingTerrain == 1.) {\n    B = 1.;\n  } else {\n    B = l / cameraToCenterDistance;\n  }\n  if(h == .0) {\n    vec2 C = j * 2. / canvasSize;\n    gl_Position.xy += C * m * l;\n  } else {\n    float D;\n    if(isRenderingTerrain == 1.) {\n      D = tileRatio;\n    } else {\n      D = tileRatio / zoomScale * B * m;\n    }\n    vec2 C = j;\n    gl_Position = projViewModelMatrix * positionMatrix * vec4(c + vec3(C, .0) * D, 1.);\n  }\n  gl_Position.xy += vec2(e, -f) * 2. / canvasSize * l;\n#ifndef PICKING_MODE\nif(h == .0) {\n    vGammaScale = mix(1., B, textPerspectiveRatio);\n  } else {\n    vGammaScale = B + mapPitch / 4.;\n  }\n  vTexCoord = k / texSize;\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vSize = d;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool E = aOpacity == 255.;\n#else\nbool E = true;\n#endif\nfbo_picking_setData(gl_Position.w, E);\n#endif\n}",Oi$1="#define SHADER_NAME TEXT\n#define HAS_HIGHLIGHT_COLOR_POINT 1\n#define SDF_PX 8.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define EDGE_GAMMA 0.105 / DEVICE_PIXEL_RATIO\nprecision mediump float;\nuniform sampler2D texture;\nuniform float textOpacity;\nuniform highp float gammaScale;\nuniform int isHalo;\nuniform highp float textHaloBlur;\n#ifdef HAS_TEXT_HALO_OPACITY\nvarying float vTextHaloOpacity;\n#else\nuniform float textHaloOpacity;\n#endif\nvarying vec2 vTexCoord;\nvarying float vSize;\nvarying float vGammaScale;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nvarying vec4 vTextFill;\n#else\nuniform vec4 textFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvarying vec4 vTextHaloFill;\n#else\nuniform vec4 textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvarying float vTextHaloRadius;\n#else\nuniform highp float textHaloRadius;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifdef HAS_TEXT_FILL\nvec4 c = vTextFill;\n#else\nvec4 c = textFill;\n#endif\nfloat d = vSize / 24.;\n  lowp vec4 e = c;\n  highp float f = EDGE_GAMMA / (d * gammaScale);\n  lowp float h = 185. / 256.;\n  if(isHalo == 1) {\n    \n#ifdef HAS_TEXT_HALO_FILL\nvec4 i = vTextHaloFill;\n#else\nvec4 i = textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nfloat j = vTextHaloRadius;\n#else\nfloat j = textHaloRadius;\n#endif\ne = i;\n    f = (textHaloBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (d * gammaScale);\n    h = (6. - j / d) / SDF_PX;\n#ifdef HAS_TEXT_HALO_OPACITY\nfloat k = vTextHaloOpacity / 255.;\n#else\nfloat k = textHaloOpacity;\n#endif\ne *= k * 1.25;\n  }\n  float l = texture2D(texture, vTexCoord).a;\n  highp float m = f * vGammaScale * .7;\n  float n = clamp(smoothstep(h - m, h + m, l), .0, 1.);\n  gl_FragColor = e * (n * textOpacity * vOpacity);\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}";const Ci$1=new Uint16Array(1),Ei$1=new Int8Array(1);function zi$1(t,e){const n=interpolated(e.markerWidth),i=interpolated(e.markerHeight),r=interpolated(e.markerDx),o=interpolated(e.markerDy),s=interpolated(e.markerOpacity),a=interpolated(e.markerTextFit),l=piecewiseConstant(e.markerPitchAlignment),h=piecewiseConstant(e.markerRotationAlignment),c=interpolated(e.markerRotation),u=piecewiseConstant(e.markerAllowOverlapFn),f=piecewiseConstant(e.markerIgnorePlacement),d=new Int16Array(1),m=new Uint16Array(1);return[{attrName:"aMarkerWidth",symbolName:"markerWidth",type:Uint8Array,width:1,define:"HAS_MARKER_WIDTH",evaluate:(i,r,o,s)=>{const l=o[s],h=e.markerTextFit,c=a?a(t.getZoom(),i):h;if("both"===c||"width"===c)return l;let u=n(t.getZoom(),i);return isFunctionDefinition(u)&&(u=this.evaluateInFnTypeConfig(u,r,t,i)),d[0]=u,d[0]}},{attrName:"aMarkerHeight",symbolName:"markerHeight",type:Uint8Array,width:1,define:"HAS_MARKER_HEIGHT",evaluate:(n,r,o,s)=>{const l=o[s],h=e.markerTextFit,c=a?a(t.getZoom(),n):h;if("both"===c||"height"===c)return l;let u=i(t.getZoom(),n);return isFunctionDefinition(u)&&(u=this.evaluateInFnTypeConfig(u,r,t,n)),d[0]=u,d[0]}},{attrName:"aMarkerDx",symbolName:"markerDx",type:Uint8Array,width:1,define:"HAS_MARKER_DX",evaluate:(e,n)=>{let i=r(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),d[0]=i,d[0]}},{attrName:"aMarkerDy",symbolName:"markerDy",type:Uint8Array,width:1,define:"HAS_MARKER_DY",evaluate:(e,n)=>{let i=o(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),d[0]=i,d[0]}},{attrName:"aColorOpacity",symbolName:"markerOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let i=s(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),d[0]=255*i,d[0]}},{attrName:"aPitchAlign",symbolName:"markerPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:e=>+("map"===l(t.getZoom(),e))},{attrName:"aRotationAlign",symbolName:"markerRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:e=>+("map"===h(t.getZoom(),e))},{attrName:"aRotation",symbolName:"markerRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:e=>{const n=Se$2(c(t.getZoom(),e),0,360)*Math.PI/180;return m[0]=9362*n,m[0]}},{attrName:"aOverlap",symbolName:"markerAllowOverlap",type:Uint8Array,width:1,evaluate:n=>{let i=u(t.getZoom(),n)||0,r=(f?f(t.getZoom(),n):e.markerIgnorePlacement)||0;return i=1<<3+4*i,r=(f?2:0)+r,i+r}},{attrName:"aOverlap",symbolName:"markerIgnorePlacement",type:Uint8Array,width:1,evaluate:n=>{let i=(u?u(t.getZoom(),n):e.markerAllowOverlap)||0,r=f(t.getZoom(),n)||0;return i=(u?8:0)+4*i,r=2+r,i+r}}]}function ji$1(t,e,n,i){if(!n||!i||"none"===i)return;const r=function(t,e,n){let i=t.properties.textFitFn;isFunctionDefinition(n)&&(i=t.properties.textFitFn=piecewiseConstant(n));const r="none"!==n,o=[],s=t.getElements(),a=t.data.aPickingId;let l,h,c;e&&(l=e.getElements(),h=e.data.aPickingId,c=e.data.aCount);const u=t.properties.features;let f;if(e){let t=l[0];f={pickingId:h[t],start:0,end:6*c[t]}}let d=!1,m=!1,y=0;const v=[];for(let t=0;t<s.length;t+=6){const p=a[s[t]];if(!d&&f)for(;f.pickingId<p&&f.end<l.length;){const t=f.end,e=l[t];f.start=t,f.end=t+6*c[e],f.pickingId=h[e]}if(!d&&f&&f.pickingId<p&&(d=!0,!r)){if(!m)return[];for(let e=t;e<s.length;e+=6)o[y++]=[-1,-1];return o}const g=u[p]&&u[p].feature,b=g&&g.properties||{};b.$layer=g&&g.layer,b.$type=g&&g.type;const x=i?i(null,b):n;if(delete b.$layer,delete b.$type,f&&p===f.pickingId){o[y++]=[f.start,f.end];const t=f.end,e=l[t];f.start=t,f.end=t+6*c[e],f.pickingId=h[e],m=!0}else if(x&&"none"!==x)for(let e=t;e<t+6;e++)v.push(e);else o[y++]=[-1,-1]}if(v.length)if(v.length===s.length)t.setElements([]);else{const e=[];let n=0,i=v[n];for(let t=0;t<s.length;t++)t<i?e.push(s[t]):t===i&&(n++,i=v[n]);t.setElements(new s.constructor(e))}return m?o:[]}(e,n,i);if(e.getElements().length&&r.length&&(e.properties.labelIndex=r,r.length&&i&&"none"!==i&&n)){const i=function(t,e){const n=[],i=t.properties.labelIndex,{aShape:r}=e.data;let o=!1;for(let t=0;t<i.length;t++){const[s,a]=i[t];if(-1===s)n.push(0,0,0,0);else{o=!0;let t=1/0,i=1/0,l=-1/0,h=-1/0;const c=e.elements;for(let e=s;e<a;e++){const n=c[e],o=r[2*n],s=r[2*n+1];o<t&&(t=o),o>l&&(l=o),s<i&&(i=s),s>h&&(h=s)}n.push(t,i,l,h)}}return o?n:[]}(e,n);i.length&&(e.properties.labelShape=i,Ri$1.call(this,t,e,n))}}function Ri$1(t,e){const n=this.getSymbolDef(e.properties.symbolIndex),i=n.markerTextFit,r=e.properties;let o="both"===i||"width"===i,s="both"===i||"height"===i;if(isFunctionDefinition(n.markerTextFit)){let t=e.properties.textFitFn;t||(t=e.properties.textFitFn=interpolated(n.markerTextFit));const{features:i}=e.properties,a=e.properties.elements||e.elements,{aPickingId:l}=e.data,h=[],c=[];let u=!0;for(let e=0;e<a.length;e+=6){const n=i[l[a[e]]],r=n&&n.feature||{},o=r.properties||{};o.$layer=r.layer,o.$type=r.type;let s=t(null,o);isFunctionDefinition(s)&&(s=(o.textFitFn=o.textFitFn||interpolated(s))(null,o)),delete o.$layer,delete o.$type,"both"===s?(h.push(e/6),c.push(e/6)):"width"===s?(u=!1,h.push(e/6)):"height"===s&&(u=!1,c.push(e/6))}u?(r.fitIcons=h,o=!0,s=!0):(h.length&&(r.fitWidthIcons=h,o=!0),c.length&&(r.fitHeightIcons=c,s=!0))}r.aPickingId||(r.aPickingId=new e.data.aPickingId.constructor(e.data.aPickingId));const{aMarkerWidth:a,aMarkerHeight:l,aPickingId:h}=r,c=h.length;if(o)if(a){const t=e.data.aMarkerWidth;e.data.aMarkerWidth=new Uint16Array(t),r.aMarkerWidth=new Uint16Array(t);const n=(He$2+"aMarkerWidth").trim();r[n]&&(r[n]=r.aMarkerWidth)}else{const t=this.getSymbol(e.properties.symbolIndex).markerWidth||0;r.aMarkerWidth=new Uint16Array(c),r.aMarkerWidth.fill(t),t&&(r.aMarkerWidth.dirty=!0),e.data.aMarkerWidth=new Uint16Array(c)}if(s)if(l){const t=e.data.aMarkerHeight;e.data.aMarkerHeight=new Uint16Array(t),r.aMarkerHeight=new Uint16Array(t);const n=(He$2+"aMarkerHeight").trim();r[n]&&(r[n]=r.aMarkerHeight)}else{const t=this.getSymbol(e.properties.symbolIndex).markerHeight||0;r.aMarkerHeight=new Uint16Array(c),r.aMarkerHeight.fill(t),t&&(r.aMarkerHeight.dirty=!0),e.data.aMarkerHeight=new Uint16Array(c)}const u=this.getSymbolDef(e.properties.textGeo.properties.symbolIndex),f=interpolated(u.textSize);Ni$1.call(this,t,e),(!isFunctionDefinition(u.textSize)||f.isZoomConstant&&f.isFeatureConstant)&&(r.isFitConstant=!0)}const Di$1=[0,0,0,0];function Ni$1(t,e){const n=e.properties.textGeo;if(!n)return;const i=n.properties,r=e.properties;if(r.isFitConstant||!r.labelShape||!r.labelShape.length)return;const o=this.getSymbolDef(e.properties.symbolIndex),s=this.getSymbolDef(n.properties.symbolIndex).textSize;let a;isFunctionDefinition(s)&&(a=i.jr?i.jr:i.jr=interpolated(s));const l=o.markerTextFitPadding||Di$1;let h;isFunctionDefinition(l)&&(h=r.Rr?r.Rr:r.Rr=piecewiseConstant(l));const c=t.getZoom(),{fitIcons:u,fitWidthIcons:f,fitHeightIcons:d}=r,{aMarkerWidth:m,aMarkerHeight:v,labelShape:b}=r,x=r.elements||e.elements,{features:w,aPickingId:A}=r,k=(t,e,n,i)=>{const o=b[4*e],u=b[4*e+1],f=b[4*e+2],d=b[4*e+3];if(!(o||u||f||d))return;const x=A[t],k=w[x]&&w[x].feature,_=k&&k.properties||{};_.$layer=k&&k.layer,_.$type=k&&k.type;let T=a?a(c,_):s;isFunctionDefinition(T)&&(T=(_.textSizeFn=_.textSizeFn||interpolated(T))(c,_)),T/=24;let S,M,P=h&&h(c,_)||l;if(isFunctionDefinition(P)&&(P=(_.fitPaddingFn=_.fitPaddingFn||piecewiseConstant(P))(c,_)),P=P||Di$1,P[0]===P[2]&&P[1]===P[3]||(S=r.aPadOffsetX,M=r.aPadOffsetY,S||(S=r.aPadOffsetX=new Int8Array(m.length),M=r.aPadOffsetY=new Int8Array(m.length))),delete _.$layer,delete _.$type,m&&n){const e=Math.abs((f-o)/10*T)+(P[1]+P[3]||0);if(Ci$1[0]=e,m[t]!==Ci$1[0]&&(ze$2(m,Ci$1[0],t,t+4),m.dirty=!0),S){const e=(P[1]+P[3])/2-P[3];Ei$1[0]=e,S[t]!==Ei$1[0]&&(ze$2(S,e,t,t+4),S.dirty=!0)}}if(v&&i){const e=Math.abs((d-u)/10*T)+(P[0]+P[2]||0);if(Ci$1[0]=e,v[t]!==Ci$1[0]&&(ze$2(v,Ci$1[0],t,t+4),v.dirty=!0),M){const e=P[0]-(P[0]+P[2])/2;Ei$1[0]=e,M[t]!==Ei$1[0]&&(ze$2(M,e,t,t+4),M.dirty=!0)}}};if(u||f||d){if(u)for(let t=0;t<u.length;t++){const e=u[t];k(x[6*e],e,!0,!0)}else if(f||d){if(f)for(let t=0;t<f.length;t++){const e=f[t];k(x[6*e],e,!0,!1)}if(d)for(let t=0;t<d.length;t++){const e=d[t];k(x[6*e],e,!1,!0)}}}else for(let t=0;t<x.length;t+=6){k(x[t],t/6,!0,!0)}const{aPadOffsetX:_,aPadOffsetY:T}=r;_&&(e.data.aPadOffsetX=_,e.data.aPadOffsetY=T)}const Li$1=function(t){const e=this.layer.getRenderer();return!this.zr(t)&&e.isForeground(t)&&!!t.geometry.properties.iconAtlas&&!t.geometry.properties.isEmpty},Hi$1=function(t){const e=this.layer.getRenderer();return!(this.zr(t)||e.isForeground(t)||!t.geometry.properties.iconAtlas||t.geometry.properties.isEmpty)},Vi$1=function(t){const e=this.layer.getRenderer();return!this.zr(t)&&e.isForeground(t)&&!!t.geometry.properties.glyphAtlas},Ui$1=function(t){const e=this.layer.getRenderer();return!this.zr(t)&&!e.isForeground(t)&&!!t.geometry.properties.glyphAtlas},Gi$1=[],Wi$1={colliides:-1},qi$1=[2048,2048],$i$1=identity$2([]),Bi$1=[];class Xi$1 extends zn$1{constructor(t,e,n,i,r,o){super(t,e,n,i,r,o),this.propAllowOverlap="markerAllowOverlap",this.propIgnorePlacement="markerIgnorePlacement",this.fi={},this.isLabelCollides=Ti$1.bind(this),this.Dr=Li$1.bind(this),this.Nr=Hi$1.bind(this),this.Lr=Vi$1.bind(this),this.Hr=Ui$1.bind(this),this.Vr=[]}needToRefreshTerrainTile(){for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t].markerPitchAlignment;if("map"===e||isFunctionDefinition(e)||ur$3.isExpression(e))return!0}return!1}isTerrainVector(){return this.layer.options.awareOfTerrain&&!this.needToRefreshTerrainTile()}isTerrainSkin(){return super.isTerrainSkin()&&this.needToRefreshTerrainTile()}setTextShaderDefines(t){this.Ur=t}createFnTypeConfig(t,e){return{icon:zi$1.call(this,t,e),text:xi$1.call(this,t,e)}}startFrame(...t){return this.Vr.length=0,super.startFrame(...t)}createGeometry(t,e){return t&&t.empty&&(t.data={aPosition:new Uint8Array(t.data.aPosition),aPickingId:t.data.aPickingId}),super.createGeometry(t,e)}postCreateGeometry(t,e){const{geometry:n,symbolIndex:i}=t,r=this.getSymbolDef(i),o=this.getFnTypeConfig(i);if(this.Gr(n))n.properties.iconAtlas?this.drawDebugAtlas(n.properties.iconAtlas):n.properties.isEmpty=!0,function(t,e,n){Ve$2(t,e,n),function(t){const{aMarkerWidth:e,aMarkerHeight:n,aMarkerDx:i,aMarkerDy:r,aPitchAlign:o,aRotationAlign:s,aRotation:a,aOverlap:l}=t.data;if(e){const n=(He$2+"aMarkerWidth").trim();t.properties.aMarkerWidth=t.properties[n]||new e.constructor(e)}if(n){const e=(He$2+"aMarkerHeight").trim();t.properties.aMarkerHeight=t.properties[e]||new n.constructor(n)}if(i){const e=(He$2+"aMarkerDx").trim();t.properties.aMarkerDx=t.properties[e]||new i.constructor(i)}if(r){const e=(He$2+"aMarkerDy").trim();t.properties.aMarkerDy=t.properties[e]||new r.constructor(r)}if(o){const e=(He$2+"aPitchAlign").trim();t.properties.aPitchAlign=t.properties[e]||new o.constructor(o)}if(s){const e=(He$2+"aRotationAlign").trim();t.properties.aRotationAlign=t.properties[e]||new s.constructor(s)}if(a){const e=(He$2+"aRotation").trim();t.properties.aRotation=t.properties[e]||new a.constructor(a)}if(l){const e=(He$2+"aOverlap").trim();t.properties.aOverlap=t.properties[e]||new l.constructor(l)}}(t)}(n,r,o.icon);else if(this.Wr(n)&&Re$2(r)){const t=e[e.length-1];if(t){const{geometry:e,symbolIndex:o}=t;if(e&&o.index===i.index){const t=this.getMap(),i=r.markerTextFit;e.properties.textGeo=n,ji$1.call(this,t,e,n,i)}}}}qr(t){if(!this.layer.options.collision)return;const{collideIds:e,elements:n,aCount:i}=t.properties;if(!e)return;const r=e,o={};if(!n)return void(t.properties.collideBoxIndex=o);let s=0,a=n[0],l=0,h=r[a],c=1;i&&(c=i[n[l]]);for(let t=0;t<=n.length;t+=6)a=n[t],r[a]===h&&t!==n.length||(o[h]=[l,t,(t-l)/(6*c),s++],h=r[a],l=t,i&&(c=i[n[l]]));t.properties.collideBoxIndex=o}createMesh(t,e,i,r){const o=this.isEnableCollision(),s=this.layer,{geometry:a,symbolIndex:l}=t;a.properties.symbolIndex=l;const h=this.getSymbolDef(l),c=this.getSymbol(l),u=this.getFnTypeConfig(l),f=[];if(this.Gr(a)){const t=function(t,e,i,r,o,s,a,l,h){if(e.isDisposed()||0===e.data.aPosition.length)return null;const c=e.properties.iconAtlas;if(!c&&!e.properties.isEmpty)return null;const u={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio};
//!geometry.properties.aAnchor 以避免重复创建collision数据
if((a||h)&&!e.properties.aShape){const{aPosition:t,aShape:n}=e.data,i=e.data.aPosition.length/e.desc.positionSize,r=new Uint8Array(i);l&&r.fill(255,0),e.data.aOpacity={usage:"dynamic",data:r},e.properties.aOpacity=new Uint8Array(i),l&&e.properties.aOpacity.fill(255,0),e.properties.aAnchor=t,e.properties.aShape=n}e.properties.visElemts||(e.properties.elements=e.elements,e.properties.visElemts=new e.elements.constructor(e.elements.length)),Ie$2(u,"markerOpacity",o,"markerOpacity",1),Ie$2(u,"markerPerspectiveRatio",o,"markerPerspectiveRatio",o.markerTextFit?0:1),Ie$2(u,"markerWidth",o,"markerWidth",15),Ie$2(u,"markerHeight",o,"markerHeight",15),Ie$2(u,"markerDx",o,"markerDx",0),Ie$2(u,"markerDy",o,"markerDy",0),Ie$2(u,"markerRotation",o,"markerRotation",0,(t=>t*Math.PI/180)),Ie$2(u,"pitchWithMap",o,"markerPitchAlignment",0,(t=>"map"===t?1:0)),Ie$2(u,"rotateWithMap",o,"markerRotationAlignment",0,(t=>"map"===t?1:0)),u.iconTex=c?pn$1(t,c,!1):null,u.texSize=c?[c.width,c.height]:[0,0],e.generateBuffers(t,{excludeElementsInVAO:!0});const f=new tt$6(u),d=new ft$6(e,f,{disableVAO:!0,transparent:!0,castShadow:!1,picking:!0}),p={};return a&&(p.ENABLE_COLLISION=1),e.data.aMarkerWidth&&(p.HAS_MARKER_WIDTH=1),e.data.aMarkerHeight&&(p.HAS_MARKER_HEIGHT=1),e.data.aColorOpacity&&(p.HAS_OPACITY=1),e.data.aMarkerDx&&(p.HAS_MARKER_DX=1),e.data.aMarkerDy&&(p.HAS_MARKER_DY=1),e.data.aPitchAlign&&(p.HAS_PITCH_ALIGN=1),e.data.aRotationAlign&&(p.HAS_ROTATION_ALIGN=1),e.data.aRotation&&(p.HAS_ROTATION=1),e.data.aPadOffsetX&&(p.HAS_PAD_OFFSET=1),e.data.aAltitude&&(p.HAS_ALTITUDE=1),d.setDefines(p),d.setLocalTransform(i),d.properties.symbolIndex=e.properties.symbolIndex,d}(this.regl,a,e,0,c,0,s.options.collision,!o,this.isEnableUniquePlacement());t&&(t.positionMatrix=this.getAltitudeOffsetMatrix(),delete t.geometry.properties.glyphAtlas,f.push(t))}else if(this.Wr(a)){const t=yi$1.call(this,this.regl,a,e,h,c,u.text,s.options.collision,!o,this.isEnableUniquePlacement());t.length&&(t.forEach((t=>{t.positionMatrix=this.getAltitudeOffsetMatrix(),delete t.geometry.properties.iconAtlas})),f.push(...t))}return"line"===a.properties.markerPlacement&&this.$r(a,r),"line"===a.properties.markerPlacement&&f.forEach((t=>t.properties.isLinePlacement=!0)),this.qr(a),f}$r(t,e){const{collideIds:n}=t.properties,i=new Uint16Array(n.length);if(this.Gr(t)){let r=0;for(let t=0;t<n.length;t+=4)i.fill(r++,t,t+4);t.properties.collideIds=i,t.properties.uniqueCollideIds=Ne$2(i),e.markerCollideMap={old:n,new:i}}else if(this.Wr(t)){const{collideIds:n,aCount:i}=t.properties;if(!i)return;if(e.markerCollideMap){const{markerCollideMap:r}=e;let o=r.new[r.new.length-1],s=0,a=n[0],l=e.markerCollideMap.old.indexOf(a),h=i[0];for(let t=0;t<n.length;){const r=n[t];a!==r&&(a=r,l=e.markerCollideMap.old.indexOf(a),s=0);const c=-1===l?++o:e.markerCollideMap.new[l+4*s],u=t+4*h;n.fill(c,t,u),t+=4*h,s++,u<n.length&&(h=i[u])}t.properties.uniqueCollideIds=Ne$2(n)}else{let e=0,r=i[0];for(let t=0;t<n.length;){const o=t+4*r;n.fill(e++,t,o),t+=4*r,o<n.length&&(r=i[o])}t.properties.uniqueCollideIds=Ne$2(n)}}}addMesh(t){if(this.yr()&&t.length>0){const e=new Mn$1(t);e.properties.uniqueCollideIds=t[0].geometry.properties.uniqueCollideIds,e.properties.meshKey=t[0].properties.meshKey,e.properties.level=t[0].properties.level,this.Vr.push(e)}for(let e=0;e<t.length;e++){if(!this.isMeshIterable(t[e]))continue;const n=t[e].geometry,{symbolIndex:i}=n.properties;Re$2(this.getSymbolDef(i))&&Ni$1.call(this,this.getMap(),n)}const e=this.getMap().getZoom();for(let n=0;n<t.length;n++){if(!this.isMeshIterable(t[n]))continue;const i=t[n].geometry,{symbolIndex:r}=i.properties,o=this.getSymbolDef(r),s=this.getFnTypeConfig(r);qe$2(this.regl,o,0===r.type?s.icon:s.text,t[n],e);const{aMarkerWidth:a,aMarkerHeight:l,aPadOffsetX:h,aPadOffsetY:c}=i.properties;a&&a.dirty&&(i.updateData("aMarkerWidth",a),a.dirty=!1),l&&l.dirty&&(i.updateData("aMarkerHeight",l),l.dirty=!1),h&&h.dirty&&(i.updateData("aPadOffsetX",h),h.dirty=!1),c&&c.dirty&&(i.updateData("aPadOffsetY",c),c.dirty=!1)}super.addMesh(...arguments)}updateCollision(t){if(!this.yr())return;super.updateCollision(t);const e=this.scene.getMeshes();e&&e.length?(this.Br(t.timestamp),this.Vr=[],this.qi()):this.qi()}callCurrentTileShader(t,e){this.shader.filter=e.sceneFilter?[this.Dr,e.sceneFilter]:this.Dr,this.callRenderer(this.shader,t,e),this.Xr.filter=e.sceneFilter?[this.Lr,e.sceneFilter]:this.Lr,this.callRenderer(this.Xr,t,e)}callBackgroundTileShader(t,e){this.shader.filter=e.sceneFilter?[this.Nr,e.sceneFilter]:this.Nr,this.callRenderer(this.shader,t,e),this.Xr.filter=e.sceneFilter?[this.Hr,e.sceneFilter]:this.Hr,this.callRenderer(this.Xr,t,e)}isMeshIterable(t){return t&&t.geometry&&!t.geometry.properties.isEmpty&&t.material&&!t.material.get("isHalo")&&this.isMeshVisible(t)&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(t))}Br(){if(!this.yr())return;let t=this.Vr;t&&t.length&&this.Yr(t)}Jr(t,e,n,i){return this.updateBoxCollisionFading(!0,t,e,n,i)}isEnableUniquePlacement(){return this.isEnableCollision()&&!0===this.sceneConfig.uniquePlacement}Yr(t){const e=this.layer.getRenderer();t=t.sort(Yi$1);for(let n=0;n<t.length;n++){const i=t[n];if(!i||!i.meshes.length)continue;let r=!1;if(1===i.meshes.length)r=this.isMeshIterable(i.meshes[0]);else for(let t=0;t<i.meshes.length;t++)if(this.isMeshIterable(i.meshes[t])){r=!0;break}if(!r)continue;const o=e.isForeground(i.meshes[0]);if(this.shouldIgnoreBackground()&&!o)continue;const s=i.properties.meshKey;this.startMeshCollision(i),this.Zr(i),this.forEachBox(i,this.Jr),this.Kr(i),this.endMeshCollision(s);for(let t=0;t<i.meshes.length;t++)this.Qr(i.meshes[t])}}Qr(t){const e=t&&t.geometry&&t.geometry.properties.aOpacity;e&&e.dirty&&(t.geometry.updateData("aOpacity",e),e.dirty=!1)}forEachBox(t,e){const n=t.properties.uniqueCollideIds;if(!n)return;const i={boxIndex:0},r=n.length;for(let o=0;o<r;o++)this.to(t,n[o],e,i)}to(t,e,n,i){const o=this.getMap(),{collideBoxIndex:s}=t.meshes[0].geometry.properties;if(!s||!s[e])return!1;const a=multiply$5(Gi$1,o.projViewMatrix,t.meshes[0].localTransform);let l,h=!1;const c=t.meshes;let u=0;for(let t=0;t<c.length;t++){if(!this.isMeshIterable(c[t]))continue;const{collideBoxIndex:n}=c[t].geometry.properties;n[e]&&u++}if(!u)return!1;l=this.Er(u);let f=0;for(let t=0;t<c.length;t++){if(!this.isMeshIterable(c[t]))continue;h=!0;const i=c[t].geometry.properties,{elements:r,aCount:o,collideBoxIndex:s}=i,a=s[e];if(!a)continue;const[u,d,p]=a;let m=1;o&&(m=o[r[u]]);const y=u+0*m*6;l[f].mesh=c[t],l[f].start=y,l[f].end=d,l[f].boxCount=i.glyphAtlas?m:p,l[f].allElements=r,f++}return!!h&&(n.call(this,t,l,a,i.boxIndex++)&&this.eo(t,e),!0)}Zr(t){const e=t.meshes;for(let t=0;t<e.length;t++){const n=e[t],i=n&&n.geometry;i&&(i.properties.visElemts.count=0)}}eo(t,e){const n=t.meshes;for(let t=0;t<n.length;t++){const i=n[t];if(i.properties.isHalo)continue;const r=i&&i.geometry;if(!r||r.properties.isEmpty)continue;const{collideBoxIndex:o,elements:s,visElemts:a}=r.properties,l=o[e];if(!l)continue;const[h,c]=l;let u=a.count;for(let t=h;t<c;t++)a[u++]=s[t];a.count=u}}Kr(t){const e=t.meshes;for(let t=0;t<e.length;t++){const n=e[t],i=n&&n.geometry;if(!i)continue;const{visElemts:r}=i.properties;i.setElements(r,r.count)}}isBoxCollides(t,e,n,i,r,o){if(this.Wr(t.geometry))return Ti$1.call(this,0,t,e,n,i,r,o);if(t.geometry.properties.isEmpty)return Wi$1;const s=this.getMap(),{boxes:a,collision:l}=this.Cr(t,i);let h=0,c=0,u=0;for(let n=i;n<r;n+=6){const i=a[u]=a[u]||[];u++;const r=oi$1.call(this,i,t,e[n],o,s);if(!h){const t=this.isCollides(r);1===t?h=1:-1===t&&c++}}return c===n&&(h=-1),l.collides=h,l}deleteMesh(t,e){t&&(t instanceof Mn$1&&(t=t.meshes),e&&(Array.isArray(t)?t.forEach((t=>{t&&t.material&&delete t.material.uniforms.iconTex})):t.material&&delete t.material.uniforms.iconTex),super.deleteMesh(t,e))}isBloom(t){const e=t&&t.material&&!Me$2(t.material.get("markerOpacity")),n=this.getSymbol(t.properties.symbolIndex);return!!(e?n.markerBloom:n.textBloom)}init(){const e=this.canvas;this.renderer=new N$8(this.regl);const i={viewport:{x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,n)=>n.viewport?n.viewport.width:e?e.width:1,height:(t,n)=>n.viewport?n.viewport.height:e?e.height:1},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},depth:{enable:!0,range:()=>this.sceneConfig.depthRange||[0,1],func:()=>this.sceneConfig.depthFunc||"always",mask:!!Me$2(this.sceneConfig.depthMask)||this.sceneConfig.depthMask},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};this.shader=new ie$5({vert:Dn$1,frag:"#define SHADER_NAME MARKER\n#define HAS_HIGHLIGHT_COLOR_POINT 1\nprecision mediump float;\n#include <gl2_frag>\nuniform sampler2D iconTex;\nuniform lowp float markerOpacity;\nuniform lowp float blendSrcIsOne;\n#include <highlight_frag>\nvarying vec2 vTexCoord;\nvarying float vOpacity;\nvoid main() {\n  vec4 c = texture2D(iconTex, vTexCoord) * markerOpacity * vOpacity;\n  if(c.a < .05) {\n    discard;\n  }\n  glFragColor = c;\n  glFragColor = highlight_blendColor(glFragColor);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:i}),this.shader.version=300;const{uniforms:o,extraCommandProps:s}=bi$1.call(this,e,this.sceneConfig);if(this.Xr=new ie$5({vert:Ii$1,frag:Oi$1,uniforms:o,extraCommandProps:s,defines:this.Ur||{}}),this.pickingFBO){const t=new Am(this.renderer,{vert:"#define PICKING_MODE 1\n"+Dn$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:i},this.pickingFBO,this.getMap());t.filter=t=>!!t.geometry.properties.iconAtlas;const e=new Am(this.renderer,{vert:"#define PICKING_MODE 1\n"+Ii$1,uniforms:o,extraCommandProps:s},this.pickingFBO,this.getMap());e.filter=t=>!!t.geometry.properties.glyphAtlas,this.picking=[t,e]}}getBlendFunc(){return{src:()=>this.sceneConfig.blendSrc||1,dst:()=>this.sceneConfig.blendDst||"one minus src alpha"}}getUniformValues(e,n){const i=n&&n.isRenderingTerrainSkin,r=this.layer.options.tileSize,o=i?$i$1:e.projViewMatrix,s=e.cameraToCenterDistance,a=set(Bi$1,e.width,e.height);i&&set(a,r,r);const h=this.getBlendFunc(),c=t__namespace.Util.isFunction(h.src)?h.src():h.src;return{layerScale:this.layer.options.styleScale||1,mapPitch:e.getPitch()*Math.PI/180,mapRotation:e.getBearing()*Math.PI/180,projViewMatrix:o,cameraToCenterDistance:s,canvasSize:a,iconSize:qi$1,resolution:e.getResolution(),glyphSize:24,gammaScale:1,blendSrcIsOne:+!("one"!==c&&1!==c),viewport:i&&n&&n.viewport,isRenderingTerrain:+!!i}}getUniqueEntryKey(t,e){if(!this.Wr(t.geometry))return null;const{elements:n}=t.geometry.properties;return Si$1(t,n[e])}Gr(t){const{symbolIndex:e}=t.properties;return 0===e.type}Wr(t){const{symbolIndex:e}=t.properties;return 1===e.type}}function Yi$1(t,e){return t.properties.level-e.properties.level||t.properties.meshKey-e.properties.meshKey}var Ji$1=Zi$1;function Zi$1(t,e){this.x=t,this.y=e}Zi$1.prototype={clone:function(){return new Zi$1(this.x,this.y)},add:function(t){return this.clone().no(t)},sub:function(t){return this.clone().io(t)},multByPoint:function(t){return this.clone().ro(t)},divByPoint:function(t){return this.clone().oo(t)},mult:function(t){return this.clone().so(t)},div:function(t){return this.clone().ao(t)},rotate:function(t){return this.clone().lo(t)},rotateAround:function(t,e){return this.clone().ho(t,e)},matMult:function(t){return this.clone().co(t)},unit:function(){return this.clone().uo()},perp:function(){return this.clone().fo()},round:function(){return this.clone().do()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},co:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},no:function(t){return this.x+=t.x,this.y+=t.y,this},io:function(t){return this.x-=t.x,this.y-=t.y,this},so:function(t){return this.x*=t,this.y*=t,this},ao:function(t){return this.x/=t,this.y/=t,this},ro:function(t){return this.x*=t.x,this.y*=t.y,this},oo:function(t){return this.x/=t.x,this.y/=t.y,this},uo:function(){return this.ao(this.mag()),this},fo:function(){var t=this.y;return this.y=this.x,this.x=-t,this},lo:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},ho:function(t,e){var n=Math.cos(t),i=Math.sin(t),o=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=o,this},do:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Zi$1.convert=function(t){return t instanceof Zi$1?t:Array.isArray(t)?new Zi$1(t[0],t[1]):t};const Ki$1=[],Qi$1=[],tr$2=[],er$2=new t__namespace.Point(0,0),nr$2=[];function ir$2(t,e,n,r,o){const s=r.getMap(),{res:a,extent:l,extent2d:h}=e.properties.tile,{xmin:c,ymax:u}=h,f=er$2.set(c,u),d=r.queryTilePointTerrain(n,f,l,a)[0]||0;if(d){let e=set$4(nr$2,n.x,n.y,0);return e[2]+=100*d,e=Ln$1(t,e,o,s.width,s.height),e}return t[0]=n.x,t[1]=n.y,t}const rr$2=[],or$2=[],sr$2=[];function ar$2(t,e,n,r,o,s,a,h,c,u,f,d,p){const{aGlyphOffset:m,aSegment:y,aTextDx:g,aTextDy:v,symbolIndex:b}=e.geometry.properties,x=this.getSymbol(b),k=set(sr$2,(g?g[o]:x.textDx)||0,(v?v[o]:x.textDy)||0),_=set(rr$2,m[2*o],m[2*o+1]),T=set$4(or$2,y[3*o],y[3*o+1],y[3*o+2]);return function(t,e,n,i,r,o,s,a,l,h,c,u,f,d,p,m,y,g){p||(p=i);const v=e.geometry.properties.line,b=o[0]*u,x=f?b-s:b+s;let w=x>0?1:-1,A=0;f&&(w*=-1,A=Math.PI),w<0&&(A+=Math.PI);const k=h+c,_=Math.abs(x);let T=w>0?l:l+1,S=Ji$1.convert(i),M=Ji$1.convert(i),P=Ji$1.convert(r),I=Ji$1.convert(r),O=0,C=0;for(;O+C<=_;){if(T+=w,T<h||T>=k)return null;M.x=S.x,M.y=S.y,I.x=P.x,I.y=P.y,S.x=n[3*T],S.y=n[3*T+1],P.x=v[3*T],P.y=v[3*T+1],O+=C,C=M.dist(S)/d}const E=(_-O)/C,F=m&&m.getRenderer(),z=F&&F.getTerrainHelper();if(!g&&z){let n=P.sub(I).mult(E).no(I);S=ir$2(Ki$1,e,P,m,y),M=ir$2(Qi$1,e,I,m,y),n=ir$2(tr$2,e,n,m,y);const i=A+Math.atan2(S[1]-M[1],S[0]-M[0]);return t[0]=(n[0]-p[0])/d,t[1]=(n[1]-p[1])/d,t[2]=i,t}const j=S.sub(M),R=j.mult(E).no(M);R.no(j.uo().fo().so(a*w));const D=A+Math.atan2(S.y-M.y,S.x-M.x);return t[0]=(R.x-i[0])/d,t[1]=(R.y-i[1])/d,t[2]=D,t}(t,e,r,s,a,_,k[0],k[1],T[0],T[1],T[2],n/24,c,h,u,f,d,p)}const lr$2=[],hr$2=[];function cr$2(t,e,n,r,o,s,a,h,c,u,f,d){const{aVertical:p}=n.geometry.properties,m=p[s];let y,g,v=ar$2.call(this,lr$2,n,r,o,s,h,c,u,!1);if(!v)return null;if(copy$4(t,v),v=ar$2.call(this,hr$2,n,r,o,a,h,c,u,!1),!v)return null;if(copy$4(e,v),d&&(transformMat2(lr$2,lr$2,d),transformMat2(hr$2,hr$2,d)),m){const t=Math.abs(hr$2[1]-lr$2[1]),e=Math.abs(hr$2[0]-lr$2[0])*f;g=lr$2[0]>hr$2[0]?1:0,t>e?(y=1,g=lr$2[1]<hr$2[1]?0:1):y=0}else y=0,g=lr$2[0]>hr$2[0]?1:0;return 2*g+y}var ur$2="#define SHADER_NAME TEXT_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aTexCoord;\n#ifdef HAS_OFFSET_Z\nattribute vec3 aOffset;\nuniform float altitudeScale;\n#else\nattribute vec2 aOffset;\n#endif\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\nuniform float zoomScale;\nuniform float cameraToCenterDistance;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform float mapPitch;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\nuniform float textPitchFilter;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_DX\nfloat d = aTextDx;\n#else\nfloat d = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat e = aTextDy;\n#else\nfloat e = textDy;\n#endif\n#ifdef HAS_TEXT_SIZE\nfloat f = aTextSize * layerScale;\n#else\nfloat f = textSize * layerScale;\n#endif\n#ifdef HAS_PITCH_ALIGN\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\ngl_Position = projViewModelMatrix * vec4(c, 1.);\n  float i = gl_Position.w;\n  float j = i / cameraToCenterDistance;\n  float k;\n  if(isRenderingTerrain == 1.) {\n    k = 1.;\n  } else {\n    float l = (1. - cameraToCenterDistance / i) * textPerspectiveRatio;\n    k = clamp(.5 + .5 * (1. - l), .0, 4.);\n  }\n#ifdef HAS_OFFSET_Z\nvec3 m = aOffset / 10.0;\n  m[2] /= altitudeScale;\n#else\nvec3 m = vec3(aOffset / 10.0, .0);\n#endif\nvec2 n = aTexCoord;\n  if(h == 1.) {\n    float o;\n    if(isRenderingTerrain == 1.) {\n      o = tileRatio;\n    } else {\n      o = tileRatio / zoomScale * j * k;\n    }\n    m.xy *= o;\n    gl_Position = projViewModelMatrix * vec4(c + m, 1.);\n  } else {\n    gl_Position.xy += m.xy * 2. / canvasSize * k * i;\n  }\n  gl_Position.xy += vec2(d, -e) * 2. / canvasSize * i;\n  if(textPitchFilter > .0) {\n    if(textPitchFilter == 1. && h == .0 || textPitchFilter == 2. && h == 1.) {\n      gl_Position = vec4(-9999., -9999., .0, 1.);\n    }\n  }\n#ifndef PICKING_MODE\nif(h == 1.) {\n    vGammaScale = j + mapPitch / 4.;\n  } else {\n    vGammaScale = mix(1., j, textPerspectiveRatio);\n  }\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vTexCoord = n / texSize;\n  vSize = f;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool u = aOpacity == 255.;\n#else\nbool u = true;\n#endif\nfbo_picking_setData(gl_Position.w, u);\n#endif\n}";const fr$2=function(t){const e=this.layer.getRenderer();return!this.zr(t)&&e.isTileNearCamera(t)&&"line"!==t.geometry.properties.textPlacement},dr$2=function(t){const e=this.layer.getRenderer();return!this.zr(t)&&!e.isForeground(t)&&"line"!==t.geometry.properties.textPlacement},pr$2=function(t){const e=this.layer.getRenderer();return!this.zr(t)&&e.isTileNearCamera(t)&&"line"===t.geometry.properties.textPlacement},mr$2=function(t){const e=this.layer.getRenderer(),n=t.properties.tile.z,i=e.getCurrentTileZoom();return!this.zr(t)&&!e.isForeground(t)&&"line"===t.geometry.properties.textPlacement&&n<i},yr$2=[0,0,3],gr$2=[],vr$2=[],br$2=[],xr$2=[],wr$2=[],Ar$2=[],kr$2=[],_r$2=[],Tr$2=[],Sr$2=[1,-1],Mr$2=new Int16Array(3),Pr$2=[],Ir$2=[],Or$2=[],Cr$2=[],Er$2=[],Fr$2=[],zr$2=[],jr$2={},Rr$2={},Dr$2={},Nr$2=[],Lr$2=[],Hr$2=identity$2([]);class Vr$2 extends zn$1{constructor(t,e,n,i,r,o){super(t,e,n,i,r,o),this.propAllowOverlap="textAllowOverlap",this.propIgnorePlacement="textIgnorePlacement",this.colorCache={},this.po=fr$2.bind(this),this.mo=dr$2.bind(this),this.yo=pr$2.bind(this),this.vo=mr$2.bind(this),this.isLabelCollides=Ti$1.bind(this),this.bo()}needToRefreshTerrainTile(){for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t].textPitchAlignment;if("map"===e||isFunctionDefinition(e)||ur$3.isExpression(e))return!0}return!1}isTerrainVector(){return this.dataConfig.awareOfTerrain&&!this.needToRefreshTerrainTile()}isTerrainSkin(){return super.isTerrainSkin()&&this.needToRefreshTerrainTile()}bo(){this.xo=[];for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t];if(ur$3.isExpression(e.textName)){const n=ur$3.createExpression(e.textName,"string");this.xo[t]=(t,e)=>{let i;jr$2.zoom=t,Rr$2.properties=e;try{i=n.evaluateWithoutErrorHandling(jr$2,Rr$2,Dr$2,null,Nr$2)}catch(t){i=null}return i}}else isFunctionDefinition(e.textName)&&(this.xo[t]=interpolated(e.textName))}}updateSymbol(...t){const e=super.updateSymbol(...t);return this.bo(),e}shouldDeleteMeshOnUpdateSymbol(t){if(!Array.isArray(t))return(0===t.textHaloRadius||0===this.symbolDef[0].textHaloRadius)&&t.textHaloRadius!==this.symbolDef[0].textHaloRadius;for(let e=0;e<t.length;e++)if(t[e]&&(0===t[e].textHaloRadius||0===this.symbolDef[e].textHaloRadius)&&t[e].textHaloRadius!==this.symbolDef[e].textHaloRadius)return!0;return!1}createFnTypeConfig(t,e){return xi$1(t,e)}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).textBloom}createGeometry(t,e,n){const i=t;if(!i.glyphAtlas)return null;const r=super.createGeometry(i,e);if(!r||!r.geometry)return null;const{geometry:o}=r;return o.properties.glyphAtlas&&this.drawDebugAtlas(o.properties.glyphAtlas),o&&i.lineVertex&&(o.properties.line=i.lineVertex,o.properties.line.id=n),r}createMesh(t,e,{tileVectorTransform:n}){const i=this.isEnableCollision(),r=this.isEnableUniquePlacement(),{geometry:o,symbolIndex:s}=t;o.properties.symbolIndex=s;const a=this.getSymbol(s),l=this.getSymbolDef(s),h=this.getFnTypeConfig(s),c=yi$1.call(this,this.regl,o,e,l,a,h,this.layer.options.collision,!i,r);return c.length&&("line"===o.properties.textPlacement?this.wo=!0:this.Ao=!0),c.forEach((t=>{t.positionMatrix=this.getAltitudeOffsetMatrix(),t.properties.tileVectorTransform=n})),c}updateCollision(t){super.updateCollision(t);const e=this.scene.getMeshes();e&&e.length?(this.ko={},this._o(t.timestamp),this.qi()):this.qi()}callCurrentTileShader(t,e){this.shader.filter=e.sceneFilter?[this.po,e.sceneFilter]:this.po,this.callRenderer(this.shader,t,e),this.To.filter=e.sceneFilter?[this.yo,e.sceneFilter]:this.yo,this.callRenderer(this.To,t,e)}callBackgroundTileShader(t,e){this.shader.filter=e.sceneFilter?[this.mo,e.sceneFilter]:this.mo,this.callRenderer(this.shader,t,e),this.To.filter=e.sceneFilter?[this.vo,e.sceneFilter]:this.vo,this.callRenderer(this.To,t,e)}callRenderer(t,e,n){n&&n.isRenderingTerrain&&isFunctionDefinition(this.symbolDef.textPitchAlignment)&&(e.textPitchFilter=n.isRenderingTerrainSkin?1:2),super.callRenderer(t,e,n)}_o(){let t=this.scene.getMeshes();if(!t||!t.length)return;const e=-this.getMap().getBearing()*Math.PI/180,n=fromRotation$4(br$2,e),i=(t,e,n,i)=>{const{start:r,end:o,mesh:s,allElements:a}=e[0];if(this.updateBoxCollisionFading(!0,s,e,n,i)){let e=t.count;for(let n=r;n<o;n++)t[e++]=a[n];t.count=e}},r=this.yr(),o=this.layer.getRenderer();t=t.sort(Gr$2);for(let e=0;e<t.length;e++){const s=t[e];if(!this.isMeshIterable(s))continue;if(!o.isTileNearCamera(s)){const{visElemts:t}=s.geometry.properties;t&&(t.count=0),s.geometry.setElements(t,0);continue}const a=s.geometry,l=this.getSymbol(s.properties.symbolIndex);s.properties.textHaloRadius=Me$2(l.textHaloRadius)?mi$1.textHaloRadius:l.textHaloRadius;const h=s.properties.meshKey;if("line"===a.properties.textPlacement){if(!a.properties.line)continue;r&&this.startMeshCollision(s),this.So(s,n);const{aOffset:t,aOpacity:e}=a.properties;t.dirty&&(a.updateData("aOffset",t),t.dirty=!1),e&&e.dirty&&(a.updateData("aOpacity",e),e.dirty=!1),r&&this.endMeshCollision(h)}else if(r){this.startMeshCollision(s);const{elements:t,aOpacity:e,visElemts:n}=a.properties;n.count=0,this.forEachBox(s,((t,e,r,o,s)=>{i(n,e,r,o)})),e&&e.dirty&&a.updateData("aOpacity",e);const o=!n.count&&!a.count;n.count===t.length&&a.count===t.length||o||a.setElements(n,n.count),this.endMeshCollision(h)}}}isMeshIterable(t){return t.isValid()&&t.material&&!t.material.get("isHalo")&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(t))}isMeshUniquePlaced(t){return!!this.isMeshIterable(t)&&"line"!==this.getSymbol(t.properties.symbolIndex).textPlacement}getUniqueEntryKey(t,e){return Si$1(t,e)}So(t,e){const n=this.getMap(),i=t.geometry,o=i.properties;let s=o.line;if(!s)return;const a=1===t.material.uniforms.pitchWithMap,l=o.elements;if(!a){const e=multiply$5(gr$2,n.projViewMatrix,t.localTransform),i=s.id+"-"+e.join();let a;this.ko[i]?s=this.ko[i]:(a=o.projectedLine=o.projectedLine||new Array(s.length),s=this.Mo(a,s,e,n.width,n.height),this.ko[i]=a)}const h=this.yr(),c=i.properties.visElemts=i.properties.visElemts||new l.constructor(l.length);h&&(c.count=0),this.forEachBox(t,((t,n,i,r)=>{const{start:o,end:u}=n[0];let f=this.Po(t,l,o,u,s,i,a?e:null,r);if(h&&(f=this.updateBoxCollisionFading(f,t,n,i,r),f)){let t=c.count;for(let e=o;e<u;e++)c[t++]=l[e];c.count=t}}));const u=t.geometry.properties.aAltitude;u&&u.dirty&&(i.updateData("aAltitude",u),u.dirty=!1),!h||c.count===l.length&&i.count===c.count||i.setElements(c,c.count)}Mo(t,e,n,i,r){return function(t,e,n,i,r){const o=[];for(let s=0;s<e.length;s+=3)set$3(o,e[s],e[s+1],e[s+2],1),Ln$1(o,o,n,i,r),t[s]=o[0],t[s+1]=o[1],t[s+2]=e[s+2];return t}(t,e,n,i,r)}forEachBox(t,e){const n=this.getMap(),i=multiply$5(gr$2,n.projViewMatrix,t.properties.tileVectorTransform),{collideIds:o,aCount:s,features:a,elements:l}=t.geometry.properties,h=o;if(!h)return;const c=this.isEnableUniquePlacement(),u=this.Er(1);u[0].allElements=l,u[0].mesh=t;let f=0,d=l[0],p=0,m=h[d];for(let n=0;n<=l.length;n+=6)if(d=l[n],h[d]!==m||n===l.length){const r=a[m]&&a[m].feature;if(c&&this.isMeshUniquePlaced(t)&&r&&!r.label){const e=r.properties||{};e.$layer=r.layer,e.$type=r.type;const{symbolIndex:n}=t.properties,i=n&&this.xo[n.index]?this.xo[n.index](t.properties.z,e):this.getSymbol(t.properties.symbolIndex).textName,o=_r$3.resolveText(i,e);delete e.$layer,delete e.$type,r.label=o}const o=n,y=s[l[p]];for(let n=p;n<o;n+=6*y)u[0].start=n,u[0].end=n+6*y,u[0].boxCount=y,e.call(this,t,u,i,f++);m=h[d],p=n}}Po(t,e,n,o,s,a,c){const f=this.layer.getRenderer(),d=t.material.uniforms,p=1===d.pitchWithMap,m=!p&&f.getTerrainHelper&&f.getTerrainHelper(),y=this.yr(),g=this.getMap(),v=t.geometry,b=v.desc.positionSize,{aShape:x,aOffset:A,aAnchor:k,aAltitude:_,aPitchRotation:T}=v.properties,S=v.properties.aTextSize,M=!c,P=e[n],I=P*b;let O;O=v.data.aAltitude?set$4(xr$2,k[I],k[I+1],_[P]):ta.unpackPosition(xr$2,k[I],k[I+1],k[I+2]);const C=Ln$1(wr$2,O,a,g.width,g.height);set$3(Ar$2,C[0],C[1]);const E=v.properties.aTerrainAltitude;let F;if(E){const t=100*E[P];t?(F=set$4(Lr$2,...O),F[2]=t,F=Ln$1(F,F,a,g.width,g.height)):F=Ar$2}else F=Ar$2;if(g.isOffscreen(F))return y||Ur$2(A,e,n,o),!1;M&&(O=C);const z=M?1:v.properties.tileExtent/this.layer.options.tileSize;let j=!0;const R=e[n],D=e[o-1],N=S?S[R]:t.properties.textSize,L=this.Io(t,N,s,R,D,O,xr$2,z,c);if(null===L)return Ur$2(A,e,n,o),!1;const H=D-R<=3,V=Math.floor(L/2),U=L%2;for(let h=n;h<o;h+=6){const c=e[h];let f;if(f=V||h!==n||H||m?V||h!==o-6||H||m?ar$2.call(this,vr$2,t,N,s,c,O,xr$2,z,V,F,this.layer,a,p):zr$2:Fr$2,!f){j=!1,y||Ur$2(A,e,n,o);break}let g=f[2];U&&(g-=Math.PI/2);const v=Xn$1(kr$2,g,0,d.rotateWithMap,d.pitchWithMap),b=A.length>x.length;let w;if(b){set$4(Cr$2,T[3*c],T[3*c+1],0);const t=normalize$4(Cr$2,Cr$2),e=-T[3*c+2];if(e){const n=setAxisAngle(Pr$2,t,e);fromTranslation$1(Ir$2,yr$2),fromQuat(Or$2,n),w=multiply$5(Or$2,Or$2,Ir$2)}}for(let t=0;t<4;t++){const e=2*(c+t);set(_r$2,x[e]/10,x[e+1]/10),scale(_r$2,_r$2,N/24),transformMat2(_r$2,_r$2,v),p?(multiply(_r$2,_r$2,Sr$2),add(Tr$2,_r$2,f),b&&(Tr$2[2]=0,w&&transformMat4$2(Tr$2,Tr$2,w))):(multiply(Tr$2,f,Sr$2),add(Tr$2,_r$2,Tr$2)),Mr$2[0]=10*Tr$2[0],Mr$2[1]=10*Tr$2[1],b&&(Mr$2[2]=10*Tr$2[2]);const n=(b?3:2)*(c+t);(A[n]!==Mr$2[0]||A[n+1]!==Mr$2[1]||b&&A[n+2]!==Mr$2[2])&&(A.dirty=!0,A[n]=Mr$2[0],A[n+1]=Mr$2[1],b&&(A[n+2]=Mr$2[2]))}}return j}Io(t,e,n,i,r,o,s,a,l){const h=r-i<=3,c=this.getMap();return h?0:cr$2.call(this,Fr$2,zr$2,t,e,n,i,r,o,s,a,c.width/c.height,l)}isBoxCollides(t,e,n,i,r,o){return this.isLabelCollides(0,t,e,n,i,r,o)}deleteMesh(t,e){t&&(e&&(Array.isArray(t)?t.forEach((t=>{t&&t.material&&delete t.material.uniforms.texture})):t.material&&delete t.material.uniforms.texture),super.deleteMesh(t,e))}delete(){super.delete(),this.To.dispose(),delete this.ko,this.Oo&&this.Oo.dispose()}needClearStencil(){return!0}init(){this.renderer=new N$8(this.regl);const{uniforms:e,extraCommandProps:i}=bi$1.call(this,this.canvas,this.sceneConfig),r=this.canvas,o={x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,e)=>e.viewport?e.viewport.width:r?r.width:1,height:(t,e)=>e.viewport?e.viewport.height:r?r.height:1};i.viewport=o,this.shader=new ie$5({vert:Ii$1,frag:Oi$1,uniforms:e,extraCommandProps:i});let s=i;if(this.layer.getRenderer().isEnableWorkAround("win-intel-gpu-crash")&&(s=_e$2({},i),s.stencil=_e$2({},i.stencil),s.stencil.enable=!0),this.To=new ie$5({vert:ur$2,frag:Oi$1,uniforms:e,extraCommandProps:s}),this.pickingFBO){const t=new Am(this.renderer,{vert:"#define PICKING_MODE 1\n"+Ii$1,uniforms:e,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap());t.filter=t=>"line"!==this.getSymbol(t.properties.symbolIndex).textPlacement;const i=new Am(this.renderer,{vert:"#define PICKING_MODE 1\n"+ur$2,uniforms:e,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap());i.filter=t=>"line"===t.geometry.properties.textPlacement,this.picking=[t,i]}}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i=this.layer.options.tileSize,r=n?Hr$2:t.projViewMatrix,o=t.cameraToCenterDistance,s=set(Er$2,t.width,t.height);n&&set(s,i,i);const a=X$4(t.getResolution(),t);return{layerScale:this.layer.options.styleScale||1,mapPitch:t.getPitch()*Math.PI/180,mapRotation:t.getBearing()*Math.PI/180,projViewMatrix:r,viewMatrix:t.viewMatrix,cameraToCenterDistance:o,canvasSize:s,glyphSize:24,gammaScale:1*(this.layer.options.textGamma||1),resolution:t.getResolution(),altitudeScale:a,viewport:n&&e&&e.viewport,textPitchFilter:0,isRenderingTerrain:+!!n}}}function Ur$2(t,e,n,i){for(let r=n;r<i;r+=6){const n=e[r];for(let e=0;e<4;e++){const i=3*(n+e);(t[i]||t[i+1]||t[i+2])&&(t.dirty=!0,t[i]=0,t[i+1]=0,t[i+2]=0)}}}function Gr$2(t,e){const n=t.properties.level-e.properties.level;return 0===n?t.properties.meshKey-e.properties.meshKey:n}var Wr$2="#define SHADER_NAME NATIVE_POINT\n#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float markerSize;\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  gl_PointSize = markerSize;\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const qr$2={markerFill:[0,0,0],markerOpacity:1,markerSize:10};class $r$2 extends fn$1{getPrimitive(){return"points"}isTerrainSkin(){return!1}isTerrainVector(){return this.layer.options.awareOfTerrain}createMesh(t,e){const{geometry:i,symbolIndex:r,ref:o}=t,s=this.getSymbol(r);void 0===o&&i.generateBuffers(this.regl);const a={};Ie$2(a,"markerOpacity",s,"markerOpacity",1),Ie$2(a,"markerSize",s,"markerSize",10),Ie$2(a,"markerFill",s,"markerFill","#000",Ee$2(this.colorCache,3));const l=new tt$6(a,qr$2);l.createDefines=()=>"square"!==s.markerType?{USE_CIRCLE:1}:null,l.appendDefines=t=>("square"!==s.markerType&&(t.USE_CIRCLE=1),t);const h=new ft$6(i,l,{castShadow:!1,picking:!0}),c={};return h.geometry.data.aAltitude&&(c.HAS_ALTITUDE=1),h.setDefines(c),h.positionMatrix=this.getAltitudeOffsetMatrix(),h.setLocalTransform(e),h.properties.symbolIndex=r,h}init(){this.renderer=new N$8(this.regl);const e=[],i={vert:Wr$2,frag:"#define SHADER_NAME NATIVE_POINT\nprecision mediump float;\n#include <gl2_frag>\n#ifdef USE_CIRCLE\n#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#define STANDARD_DERIVATIVES_ENABLED 1\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define STANDARD_DERIVATIVES_ENABLED 1\n#endif\n#endif\nuniform vec3 markerFill;\nuniform float markerOpacity;\nvoid main() {\n  float c = 1.;\n#ifdef USE_CIRCLE\nfloat r = .0, d = .0;\n  vec2 e = 2. * gl_PointCoord - 1.;\n  r = dot(e, e);\n  if(r > 1.) {\n    discard;\n  }\n#ifdef STANDARD_DERIVATIVES_ENABLED\nd = fwidth(r);\n  c = 1. - smoothstep(1. - d, 1. + d, r);\n#endif\n#endif\nglFragColor = vec4(markerFill, 1.) * markerOpacity * c;\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,n){return multiply$5(e,n.projViewMatrix,n.modelMatrix),e}}],defines:null,extraCommandProps:{viewport:{x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},depth:{enable:!0,mask:!1,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"always"},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"}}};if(this.shader=new ie$5(i),this.shader.version=300,this.pickingFBO){const t=[];this.picking=[new Am(this.renderer,{vert:"#define PICKING_MODE 1\n"+Wr$2,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return multiply$5(t,n.projViewMatrix,n.modelMatrix),t}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())]}}getUniformValues(t){return{projViewMatrix:t.projViewMatrix}}}var Br$2="#define SHADER_NAME NATIVE_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\n#else\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const Xr$2=identity$2([]);class Yr$2 extends fn$1{constructor(t,e,n,i,r,o){if(super(t,e,n,i,r,o),this.primitive="lines",isFunctionDefinition(this.symbolDef.lineColor)){const t=e.getMap(),n=piecewiseConstant(this.symbolDef.lineColor);this.colorSymbol=e=>n(t.getZoom(),e)}}needPolygonOffset(){return!0}createMesh(t,e){const{geometry:i,symbolIndex:r,ref:o}=t,s=this.getSymbol(r),a=this.getMeshUniforms(i,s);void 0===o&&i.generateBuffers(this.regl);const l=new tt$6(a),h=new ft$6(i,l,{castShadow:!1,picking:!0});h.setLocalTransform(e),h.properties.symbolIndex=r;const c={};return h.geometry.data.aAltitude&&(c.HAS_ALTITUDE=1),h.setDefines(c),h}getMeshUniforms(t,e){const n={};return Ie$2(n,"lineColor",e,"lineColor","#000",Ee$2(this.colorCache)),Ie$2(n,"lineOpacity",e,"lineOpacity",1),n}init(t){const e=this.layer.getRenderer().isEnableTileStencil()&&(!t||!t.isRenderingTerrain||!this.isTerrainSkin());this.renderer=new N$8(this.regl);const o=this.canvas,s={x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,e)=>e.viewport?e.viewport.width:o?o.width:1,height:(t,e)=>e.viewport?e.viewport.height:o?o.height:1},a=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],h={vert:Br$2,frag:"#define SHADER_NAME NATIVE_LINE\nprecision mediump float;\nuniform float lineOpacity;\nuniform vec4 lineColor;\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#endif\nvoid main() {\n  gl_FragColor = lineColor * lineOpacity;\n#if defined(HAS_COLOR)\ngl_FragColor *= vColor;\n#endif\n}",uniforms:a,defines:null,extraCommandProps:{viewport:s,stencil:{enable:!0,mask:255,func:{cmp:()=>e?"=":"<=",ref:(t,n)=>e?n.stencilRef:n.level,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}};this.shader=new ie$5(h),this.pickingFBO&&(this.picking=[new Am(this.renderer,{vert:"#define PICKING_MODE 1\n"+Br$2,uniforms:a,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())])}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin;return{projViewMatrix:n?Xr$2:t.projViewMatrix,viewport:n&&e&&e.viewport}}getPrimitive(){return"lines"}}const Jr$2=[0,0],Zr$2=[1,1,1],Kr$2=[1,1,1,1],Qr$2=[0,0],to$1=[];class eo$1 extends hn$1{supportRenderMode(t){return this.isAnimating()?"fxaa"===t||"fxaaAfterTaa"===t:"taa"===t||"fxaa"===t}isAnimating(){return!1}createMesh(t,e,{tilePoint:i,tileZoom:o}){if(!this.material)return this.setToRedraw(),null;const{geometry:s,symbolIndex:a}=t,l=new ft$6(s,this.material);if(this.sceneConfig.animation){Zr$2[2]=.01;const t=[];fromScaling(t,Zr$2),multiply$5(t,e,t),e=t}const h=this.getSymbolDef(a),c=this.getFnTypeConfig(a);Ve$2(s,h,c);const u=this.getShader(),f=u.getGeometryDefines?u.getGeometryDefines(s):{},d=this.getSymbol(a);if(s.data.aExtrude){f.IS_LINE_EXTRUSION=1;const{tileResolution:t,tileRatio:e}=s.properties,n=this.getMap();Object.defineProperty(l.uniforms,"linePixelScale",{enumerable:!0,get:function(){return e*n.getResolution()/t}}),Ie$2(l.uniforms,"lineWidth",d,"lineWidth",4),Ie$2(l.uniforms,"lineOpacity",d,"lineOpacity",1),Ie$2(l.uniforms,"lineColor",d,"lineColor","#fff",Ee$2(this.colorCache)),Object.defineProperty(l.uniforms,"lineHeight",{enumerable:!0,get:()=>{const t=this.dataConfig.defaultAltitude*(this.dataConfig.altitudeScale||1);return je$2(t)?t:0}})}else Ie$2(l.uniforms,"polygonFill",d,"polygonFill",Kr$2,Ee$2(this.colorCache)),Ie$2(l.uniforms,"polygonOpacity",d,"polygonOpacity",1);if(s.data.aColor&&(f.HAS_COLOR=1),s.data.aLineWidth&&(f.HAS_LINE_WIDTH=1),s.data.aLineHeight&&(f.HAS_LINE_HEIGHT=1),s.data.aOpacity){const t=s.data.aOpacity;for(let e=0;e<t.length;e++)if(t[e]<255){s.properties.hasAlpha=!0;break}}s.generateBuffers(this.regl),l.setDefines(f),l.setPositionMatrix(this.getAltitudeOffsetMatrix()),l.setLocalTransform(e),(s.properties.maxAltitude<=0||l.properties.level>=3)&&(l.castShadow=!1),l.setUniform("maxAltitude",l.geometry.properties.maxAltitude);const p=this.getMap(),m=p.getGLRes(),y=this.layer.getSpatialReference&&this.layer.getSpatialReference(),g=(y?y.getResolution(o):p.getResolution(o))/m;return Object.defineProperty(l.uniforms,"uvOrigin",{enumerable:!0,get:()=>{if(this.dataConfig.side)return Jr$2;const t=this.getSymbol(a).material.uvScale||[1,1],e=this.dataConfig.dataUVScale||[1,1];return[t[0]*i[0]*g/(.5*e[0]),t[1]*i[1]*g/(.5*e[1])]}}),Object.defineProperty(l.uniforms,"uvOffset",{enumerable:!0,get:()=>{const t=this.getUVOffsetAnim(),e=this.getUVOffset(t);return this.material&&this.material.get("noiseTexture")&&(e[0]*=-1),e}}),Object.defineProperty(l.uniforms,"hasAlpha",{enumerable:!0,get:()=>{const t=this.getSymbol(a);return s.properties.hasAlpha||t.polygonOpacity<1||t.lineOpacity<1}}),l.properties.symbolIndex=a,l}getShadowMeshes(){if(!this.isVisible())return to$1;this.shadowCount=this.scene.getMeshes().length;const t=this.scene.getMeshes().filter((t=>0===t.properties.level));for(let e=0;e<t.length;e++){const n=t[e];n.material!==this.material&&n.setMaterial(this.material)}return t}getUVOffsetAnim(){const t=this.getSymbols()[0];return t.material&&t.material.uvOffsetAnim}getUVOffset(t){const e=this.getSymbols()[0],n=e.material&&e.material.uvOffset||Qr$2,i=this.layer.getRenderer().getFrameTimestamp(),r=[n[0],n[1]],o=!!e.material&&e.material.noiseTexture,s=o?5e5:1e3,a=o?256:1;return t&&t[0]&&(r[0]=i*t[0]%s/s*a),t&&t[1]&&(r[1]=i*t[1]%s/s*a),r}needPolygonOffset(){return this.Co}startFrame(...t){return delete this.Co,super.startFrame(...t)}addMesh(t,e){t.forEach((t=>{this.Ci(t,e)})),super.addMesh(...arguments)}Ci(t,e){if(null!==e){const n=t.localTransform;0===e&&(e=.01),Zr$2[2]=e,fromScaling(n,Zr$2),multiply$5(n,t.properties.tileTransform,n),t.setLocalTransform(n)}else t.setLocalTransform(t.properties.tileTransform);t.material!==this.material&&t.setMaterial(this.material),t.geometry.properties.maxAltitude<=0&&(this.Co=!0),t.ssr=this.getSymbol(t.properties.symbolIndex).ssr?1:0}deleteMesh(t,e){if(t)if(this.scene.removeMesh(t),Array.isArray(t))for(let n=0;n<t.length;n++)e||t[n].geometry.dispose(),t[n].dispose();else e||t.geometry.dispose(),t.dispose()}updateDataConfig(t,e){return!("line-extrusion"===this.dataConfig.type&&!t.altitudeProperty&&!e.altitudeProperty)}createFnTypeConfig(t,e){const n=piecewiseConstant(e.polygonFill||e.lineColor),i=interpolated(e.polygonOpacity||e.lineOpacity),r=interpolated(e.lineWidth),o=new Uint8Array(1),s=new Uint16Array(1);return[{attrName:"aColor",type:Uint8Array,width:4,symbolName:e.polygonFill?"polygonFill":e.lineColor?"lineColor":"polygonFill",define:"HAS_COLOR",evaluate:e=>{let i=n(t.getZoom(),e);return Array.isArray(i)||(i=this.colorCache[i]=this.colorCache[i]||color(i).unitArray()),i=Ce$2(i),i}},{attrName:"aOpacity",type:Uint8Array,width:1,symbolName:e.polygonOpacity?"polygonOpacity":e.lineOpacity?"lineOpacity":"polygonOpacity",evaluate:(e,n)=>{const r=i(t.getZoom(),e);return o[0]=255*r,o[0]<255&&(n.properties.hasAlpha=!0),o[0]}},{attrName:"aLineWidth",type:Uint8Array,width:1,symbolName:"lineWidth",define:"HAS_LINE_WIDTH",evaluate:e=>{const n=r(t.getZoom(),e);return s[0]=Math.round(2*n),s[0]}}]}getPolygonOffset(){return{enable:(t,e)=>0===e.maxAltitude,offset:super.getPolygonOffset()}}updateSymbol(t,e){let n=!1;t&&t.material&&(n=function(t,e){for(const n in e)if(io$1[n]&&e[n]!==t[n]&&(!t[n]||!e[n]))return!0;return!1}(this.symbolDef[0].material||{},t.material));const i=super.updateSymbol(t,e);return t&&t.material&&this.Eo(t.material),n||i}di(t,e){return no$1(t)!==no$1(e)}}function no$1(t){if(!t||!t.material)return!1;for(const e in t.material)if(e.indexOf("Texture")>0&&t.material[e])return!0;return!1}const io$1={normalTexture:1,bumpTexture:1};class ro$1 extends eo$1{createGeometry(t){const e=t.data,i=this.getSymbols()[0];if(i.material&&i.material.extrusionOpacity){const t=new Uint8Array(e.aPosition.length/3);for(let n=0;n<e.aPosition.length;n+=3)t[n/3]=e.aPosition[n+2]>0?0:1;e.aExtrusionOpacity=t}const r=new Q$7(e,t.indices);return _e$2(r.properties,t.properties),this.Si(r,t),{geometry:r,symbolIndex:{index:0}}}updateSceneConfig(t){let e;if(this.sceneConfig.cullFace!==t.cullFace&&(e=!0),_e$2(this.sceneConfig,t),e){const t=this.getShaderConfig();this.shader.dispose(),this.shader=new ae$5(t)}this.setToRedraw()}getShader(){return this.shader}delete(t){this.getMap().off("updatelights",this.Fo,this),super.delete(t),this.material.dispose()}init(){this.getMap().on("updatelights",this.Fo,this);this.renderer=new N$8(this.regl);const e=this.getShaderConfig();this.shader=new ae$5(e),this.Eo();const i={vert:this.getPickingVert(),uniforms:["projViewMatrix","modelMatrix","positionMatrix",{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:this.pickingViewport}};this.picking=[new Am(this.renderer,i,this.layer.getRenderer().pickingFBO,this.getMap())]}Fo(){this.setToRedraw()}getShaderConfig(){const t=this.canvas;return{extraCommandProps:{cull:{enable:()=>void 0===this.sceneConfig.cullFace||!!this.sceneConfig.cullFace,face:()=>{let t=this.sceneConfig.cullFace;return!0===t&&(t="back"),t||"back"}},stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},polygonOffset:this.getPolygonOffset()}}}Eo(){this.material&&this.material.dispose();const t=this.getSymbols()[0].material,e={};for(const n in t)De$2(t,n)&&(e[n]=t[n]);this.material=new rt$6(e)}getUniformValues(t,e){const n=t.viewMatrix,i=t.projMatrix,r=t.cameraPosition,o=this.zo(),s=_e$2({viewMatrix:n,projMatrix:i,cameraPosition:r,projViewMatrix:t.projViewMatrix},o);s.halton=e&&e.jitter?e.jitter:[0,0];const a=this.layer.getRenderer().canvas;return s.outSize=[a.width,a.height],s}getPickingVert(){return"\n            attribute vec3 aPosition;\n            uniform mat4 projViewModelMatrix;\n            uniform mat4 modelMatrix;\n            uniform mat4 positionMatrix;\n            //引入fbo picking的vert相关函数\n            #include <fbo_picking_vert>\n            #include <get_output>\n            void main()\n            {\n                mat4 localPositionMatrix = getPositionMatrix();\n                vec4 localPosition = getPosition(aPosition);\n\n                gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n                //传入gl_Position的depth值\n                fbo_picking_setData(gl_Position.w, true);\n            }\n        "}zo(){const t=this.getMap().getLightManager(),e=t&&t.getAmbientLight()||{},n=t&&t.getDirectionalLight()||{};return{ambientColor:e.color||[.2,.2,.2],light0_diffuse:[...n.color||[.1,.1,.1],1],lightSpecular:n.specular||[.8,.8,.8],light0_viewDirection:n.direction||[1,1,-1]}}}const oo$1=[1,1,1];class so$1 extends hn$1{createGeometry(t){const{data:e,indices:i}=t,r=new Q$7(e,i,0,{primitive:"lines"});return r.generateBuffers(this.regl),{geometry:r,symbolIndex:{index:0}}}createMesh(t,e){const{geometry:i}=t,o=new ft$6(i);if(o.castShadow=!1,this.sceneConfig.animation){oo$1[2]=.01;const t=[];fromScaling(t,oo$1),multiply$5(t,e,t),e=t}return o.setLocalTransform(e),o.properties.symbolIndex={index:0},o}addMesh(t,e){if(!t.length)return this;let n;null!==e?(0===e&&(e=.01),n=t[0].localTransform,oo$1[2]=e,fromScaling(n,oo$1),multiply$5(n,t[0].properties.tileTransform,n)):n=t[0].properties.tileTransform;for(let e=0;e<t.length;e++)t[e].setLocalTransform(n);return this.scene.addMesh(t),this}init(){const t=this.regl;this.scene=new yt$6,this.renderer=new N$8(t);const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},i={vert:"\n    attribute vec3 aPosition;\n    attribute vec4 aColor;\n\n    uniform mat4 projViewModelMatrix;\n    uniform vec2 outSize;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n        vColor = aColor / 255.0;\n    }\n",frag:"\n    #ifdef GL_ES\n        precision lowp float;\n    #endif\n\n    uniform float opacity;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_FragColor = vColor * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},viewport:e}};this.shader=new ie$5(i)}getUniformValues(t){const e=this.sceneConfig.opacity||.3,n=this.layer.getRenderer().canvas;return{projViewMatrix:t.projViewMatrix,outSize:[n.width,n.height],opacity:e}}}const{getPBRUniforms:ao$1}=Fm.PBRUtils;class lo$1 extends eo$1{constructor(...t){super(...t),this.jo=new gt$6,this.scene.sortFunction=this.sortByCommandKey}supportRenderMode(t){return this.getSymbols()[0].ssr?"fxaa"===t||"fxaaAfterTaa"===t:super.supportRenderMode(t)}isAnimating(){const t=this.Ro();if(t&&(t[0]||t[1]))return!0}needToRedraw(){const t=this.Ro();return!(!t||!t[0]&&!t[1])||super.needToRedraw()}Ro(){const t=this.getSymbols()[0];return t.material&&t.material.uvOffsetAnim}createGeometry(t){if(!t.data||!t.data.aPosition||!t.data.aPosition.length)return null;const e={uv0Attribute:"aTexCoord0"};t.aAltitude&&(e.altitudeAttribute="aAltitude");const i=new Q$7(t.data,t.indices,0,e);return _e$2(i.properties,t.properties),this.Si(i,t),{geometry:i,symbolIndex:{index:0}}}paint(t){const e=!!t.shadow;t.states&&t.states.includesChanged&&(this.shader.dispose(),delete this.shader,this.Do.dispose(),delete this.Do,this.Pi(t));let n=!!t.ssr&&this.getSymbols()[0].ssr;const i=this.shader,r=i.shaderDefines;if(n){const e=_e$2({},r,t.ssr.defines);i.shaderDefines=e}if(t.onlyUpdateDepthInTaa&&(this.shader=this.Do,!n&&this.No&&(this.shader=i,this.setToRedraw(!0))),this.updateIBLDefines(i),super.paint(t),void 0!==this.shadowCount&&e){const t=this.scene.getMeshes().length;this.shadowCount!==t&&this.setToRedraw()}this.shader=i,n&&(i.shaderDefines=r),delete this.shadowCount;const o=this.Ro();if(o&&(o[0]||o[1]))this.material.set("uvOffset",[0,0]);else{const t=this.getUVOffset(o);this.material.set("uvOffset",t)}this.No=n}updateSceneConfig(t){_e$2(this.sceneConfig,t),this.setToRedraw()}delete(){super.delete(),this.disposeIBLTextures(),this.material.dispose(),this.Do&&(this.Do.dispose(),delete this.Do)}init(t){this.getMap().on("updatelights",this.Lo,this),this.createIBLTextures(),this.Ei=this.Ei||t;this.renderer=new N$8(this.regl),this.Ho=this.Vo.bind(this),this.Uo=this.disposeCachedTexture.bind(this),this.Go=this.Wo.bind(this),this.Eo(),this.Pi(t);const i={vert:"\n                #include <gl2_vert>\n                attribute vec3 aPosition;\n                uniform mat4 projViewModelMatrix;\n                uniform mat4 positionMatrix;\n                //引入fbo picking的vert相关函数\n                #include <line_extrusion_vert>\n                #include <get_output>\n                #include <fbo_picking_vert>\n                void main() {\n                    mat4 localPositionMatrix = getPositionMatrix();\n                    #ifdef IS_LINE_EXTRUSION\n                        vec3 linePosition = getLineExtrudePosition(aPosition);\n                        vec4 localVertex = getPosition(linePosition);\n                    #else\n                        vec4 localVertex = getPosition(aPosition);\n                    #endif\n\n                    gl_Position = projViewModelMatrix * localPositionMatrix * localVertex;\n                    fbo_picking_setData(gl_Position.w, true);\n                }\n            ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.pickingViewport,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="}}};this.picking=[new Am(this.renderer,i,this.layer.getRenderer().pickingFBO,this.getMap())]}Pi(t){const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},i={},r=[];r.push(...Ie$4.getUniformDeclares()),this.fillIncludes(i,r,t);const o={cull:{enable:()=>void 0===this.sceneConfig.cullFace||!!this.sceneConfig.cullFace,face:this.sceneConfig.cullFace||"back"},stencil:{enable:(t,e)=>void 0===e.hasAlpha||!!e.hasAlpha,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},viewport:e,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:(t,e)=>void 0===e.hasAlpha||!!e.hasAlpha,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:this.getPolygonOffset()},s={uniforms:r,defines:this.qo(i),extraCommandProps:o};this.shader=new Fm.StandardShader(s),s.frag="\n            precision mediump float;\n            #include <gl2_frag>\n            void main() {\n                glFragColor = vec4(0.0);\n                #if __VERSION__ == 100\n                    gl_FragColor = glFragColor;\n                #endif\n            }\n        ",this.Do=new Fm.StandardShader(s)}Vo({resources:t}){for(let e=0;e<t.length;e++)this.addCachedTexture(t[e].url,t[e].data);this.setToRedraw(!0)}Wo(){this.setToRedraw(!0)}Eo(t){const e=this.dataConfig,i=t||this.getSymbols()[0].material,r={};let o=!1;for(const t in i)if(De$2(i,t))if(t.indexOf("Texture")>0){let s=i[t];if(!s){r[t]=void 0;continue}const a="string"==typeof s?s:s.url,l=this.getCachedTexture(a);l?l.then?a===s?s={promise:l,wrap:"repeat"}:s.promise=l:a===s?s={data:l,wrap:"repeat"}:s.data=l:a===s&&(s={url:a,wrap:"repeat"}),s.flipY=!e.side||"bottom"===this.dataConfig.textureYOrigin,r[t]=new Vt$5(s,this.jo),r[t].once("complete",this.Ho),r[t].once("disposed",this.Uo),r[t].promise&&this.addCachedTexture(a,r[t].promise),o=!0}else r[t]=i[t];if(this.material){for(let t in r)this.material.set(t,r[t]);this.setToRedraw(!0)}else this.material=new Fm.StandardMaterial(r),this.material.once("complete",this.Go);o||this.Wo()}getShader(){return this.shader}getUniformValues(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=ao$1(t,n,i,e&&e.ssr,e&&e.jitter);return this.setIncludeUniformValues(r,e),r}qo(t){return this.hasIBL()?t.HAS_IBL_LIGHTING=1:delete t.HAS_IBL_LIGHTING,t}Lo(){if(!this.shader)return;const t=this.shader.shaderDefines;this.qo(t),this.shader.shaderDefines=t}}var ho$1="#include <gl2_vert>\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\nuniform mat4 projViewModelMatrix;\nuniform vec2 centiMeterToLocal;\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec4 aTubeNormal;\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#include <vt_position_vert>\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#else\nuniform mat4 modelViewMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelMatrix;\n#if defined(HAS_PATTERN)\nuniform float resolution;\nuniform float tileResolution;\nuniform float tileRatio;\nattribute float aLinesofar;\nvarying highp float vLinesofar;\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvarying float vPatternHeight;\nattribute float aNormalDistance;\n#if defined(HAS_PATTERN_ANIM)\nattribute float aLinePatternAnimSpeed;\nvarying float vLinePatternAnimSpeed;\n#endif\n#if defined(HAS_PATTERN_GAP)\nattribute float aLinePatternGap;\nvarying float vLinePatternGap;\n#endif\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\nvarying vec3 vModelVertex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\nvoid main() {\n  \n#ifdef HAS_LINE_WIDTH\nfloat c = aLineWidth;\n#else\nfloat c = lineWidth;\n#endif\nfloat d = c / 2.;\n  vec3 e = aTubeNormal.xyz / EXTRUDE_SCALE;\n  vec3 f = unpackVTPosition();\n  vec4 h = vec4(f, 1.);\n  h.xy += e.xy * d * centiMeterToLocal;\n  h.z += e.z * d;\n  gl_Position = projViewModelMatrix * h;\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#else\nvViewVertex = modelViewMatrix * h;\n  vec3 i = normalize(e);\n  vModelNormal = modelNormalMatrix * i;\n  vModelVertex = (modelMatrix * h).xyz;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(h);\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\n#ifdef HAS_PATTERN\nfloat j = tileResolution / resolution;\n  float k = aLinesofar - d * centiMeterToLocal.y * aNormalDistance / EXTRUDE_SCALE;\n  vLinesofar = k / tileRatio * j;\n  vTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n  vPatternHeight = c * centiMeterToLocal.x / tileRatio * j;\n  vNormalY = aTubeNormal.w / EXTRUDE_SCALE;\n#if defined(HAS_PATTERN_ANIM)\nvLinePatternAnimSpeed = aLinePatternAnimSpeed / 127.;\n#endif\n#if defined(HAS_PATTERN_GAP)\nvLinePatternGap = aLinePatternGap / 10.0;\n#endif\n#endif\nhighlight_setVarying();\n#endif\n}";const{getPBRUniforms:co$1}=Fm.PBRUtils;class uo$1 extends fn$1{needToRedraw(){return super.needToRedraw()||this.isAnimating()}supportRenderMode(t){return this.isAnimating()?"fxaa"===t||"fxaaAfterTaa"===t:"taa"===t||"fxaa"===t}isAnimating(){if(this.Ii)return!0;const t=this.getSymbols();for(let e=0;e<t.length;e++)if(t[e].linePatternFile&&t[e].linePatternAnimSpeed)return!0;return!1}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).lineBloom}createMesh(t,e){if(!t.geometry)return null;const i=this.getMap(),{geometry:r,symbolIndex:o,ref:s}=t,a=this.getSymbolDef(o);void 0===s&&Ve$2(r,a,this.getFnTypeConfig(o));const l=this.getSymbol(o),{tileResolution:h,tileRatio:c}=r.properties,u={tileResolution:h,tileRatio:c};Ie$2(u,"lineColor",l,"lineColor","#fff",Ee$2(this.colorCache)),Ie$2(u,"linePatternGapColor",l,"linePatternGapColor",[1,1,1,1],Ee$2(this.colorCache)),Ie$2(u,"lineWidth",l,"lineWidth",2,(t=>te$3.getTubeSizeScale(this.dataConfig.metric)*t)),Ie$2(u,"lineOpacity",l,"lineOpacity",1),Ie$2(u,"linePatternAnimSpeed",l,"linePatternAnimSpeed",0),Ie$2(u,"linePatternGap",l,"linePatternGap",0),Ie$2(u,"metallicFactor",l,"metallicFactor",0),Ie$2(u,"roughnessFactor",l,"roughnessFactor",.4),Ie$2(u,"emissiveFactor",l,"emissiveFactor",[0,0,0]),Ie$2(u,"uvScale",l,"uvScale",[1,1]);const f=r.properties.iconAtlas,d=r.data.aPosition instanceof Int16Array;f&&(u.linePatternFile=pn$1(this.regl,f,!1),u.atlasSize=f?[f.width,f.height]:[0,0],u.flipY=d?-1:1,this.drawDebugAtlas(f)),void 0===s&&r.generateBuffers(this.regl);const p=new Fm.StandardMaterial(u),m=new ft$6(r,p,{castShadow:!1,picking:!0}),y=i.distanceToPointAtRes(100,100,r.properties.tileResolution)._multi(c/1e4).toArray();m.setUniform("centiMeterToLocal",y),m.setLocalTransform(e);const g={IS_LINE_EXTRUSION:1};return"square-tube"===this.dataConfig.type&&(g.IS_SQUARE_TUBE=1),f&&(g.HAS_PATTERN=1),m.properties.symbolIndex=o,r.data.aColor&&(g.HAS_COLOR=1),this.setMeshDefines(g,r,a),r.data.aAltitude&&(g.HAS_ALTITUDE=1),m.setDefines(g),m}setMeshDefines(t,e,n){e.data.aOpacity&&(t.HAS_OPACITY=1),e.data.aLineWidth&&(t.HAS_LINE_WIDTH=1),Ze$2(n.linePatternAnimSpeed)&&(t.HAS_PATTERN_ANIM=1),Ze$2(n.linePatternGap)&&(t.HAS_PATTERN_GAP=1)}paint(t){t.states&&t.states.includesChanged.shadow&&(this.shader.dispose(),this.createShader(t)),super.paint(t)}init(t){this.getMap().on("updatelights",this.Lo,this),this.createIBLTextures();if(this.renderer=new N$8(this.regl),this.createShader(t),this.pickingFBO){const t=[];this.picking=[new Am(this.renderer,{vert:"#define PICKING_MODE 1\n"+ho$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}},{name:"modelNormalMatrix",type:"function",fn:(e,n)=>fromMat4$1(t,n.modelMatrix)}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO,this.getMap())]}}createShader(t){this.Ei=t;const e=[],i={};this.fillIncludes(i,e,t),e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}),this.shader=new Fm.StandardShader({vert:ho$1,uniforms:e,defines:this.qo(i),extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.canvas;return{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!0,func:{cmp:()=>"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},cull:{enable:()=>!!this.sceneConfig.cullFace,face:this.sceneConfig.cullFace||"back"},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!0,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=co$1(t,n,i,null,e&&e.jitter),s=t.viewMatrix;return r.projViewMatrix=t.projViewMatrix,r.viewMatrix=s,r.resolution=t.getResolution(),r.currentTime=this.layer.getRenderer().getFrameTimestamp()||0,this.setIncludeUniformValues(r,e),r}createFnTypeConfig(t,e){const n=piecewiseConstant(e.lineColor),i=piecewiseConstant(e.aLinePatternAnimSpeed),r=piecewiseConstant(e.aLinePatternGap),o=this.createShapeFnTypeConfigs(t,e),s=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=Ce$2(r),r}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(e,n,r,o)=>{let a=i(t.getZoom(),e);return Me$2(a)&&(a=0),0!==a&&(n.properties.hasPatternAnim=1),s[0]=a/127,s[1]=r[o+1],s[0]}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(e,n,i,o)=>{let a=r(t.getZoom(),e);return Me$2(a)&&(a=0),s[1]=10*a,s[0]=i[o],s[0]}}].concat(o)}createShapeFnTypeConfigs(t,e){const n=interpolated(e.lineWidth),i=interpolated(e.lineOpacity),r=new Uint16Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(e,i)=>{let o=n(t.getZoom(),e);return isFunctionDefinition(o)&&(o=this.evaluateInFnTypeConfig(o,i,t,e)),r[0]=Math.round(2*o),r[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let o=i(t.getZoom(),e);return isFunctionDefinition(o)&&(o=this.evaluateInFnTypeConfig(o,n,t,e)),r[0]=255*o,r[0]}}]}qo(t){return this.hasIBL()?t.HAS_IBL_LIGHTING=1:delete t.HAS_IBL_LIGHTING,t}Lo(){if(!this.shader)return;const t=this.shader.shaderDefines;this.qo(t),this.shader.shaderDefines=t}delete(){super.delete(),this.disposeIBLTextures(),this.shader&&(this.shader.dispose(),delete this.shader)}}const fo$1=[],po$1=[],mo$1=[],yo$1=[],go$1=[],vo$1=[0,0,0],bo$1=[0,0,0],xo$1=[1,1,1],wo$1=[],Ao$1=[1,1,1,1],ko$1=[],_o$1=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],To$1=t=>class extends t{constructor(t,e,i,r,o,s){super(t,e,i,r,o,s),this.$o=!1,this.scene.sortFunction=this.sortByCommandKey,this.Bo=[],this.Xo=new Vd(t),this.Yo(),this.Jo()}isAnimating(){const t=this.getSymbols();for(let e=0;e<t.length;e++)if(t[e]&&this.Zo[e]&&this.Ko(e))return!0;return!1}createGeometry(t,e){const{data:n,positionSize:i}=t;return{geometry:{properties:_e$2({},t.properties),data:n,positionSize:i,features:e},symbolIndex:t.symbolIndex}}getFnTypeConfig(){return wo$1}createMesh(t,e,{tileTranslationMatrix:o,tileExtent:s}){if(!this.$o)return null;const a=this.getMap(),{geometry:l}=t,{positionSize:h,features:c}=l,{aPosition:u,aPickingId:f,aXYRotation:d,aZRotation:p}=l.data,m=u.length/h;if(0===m)return null;const y={instance_vectorA:new Float32Array(4*m),instance_vectorB:new Float32Array(4*m),instance_vectorC:new Float32Array(4*m),aPickingId:[]},g=this.Qo(y,o,s,l.properties.z,u,d,p,h,f,c),v={};for(const t in y)v[t]={buffer:this.regl.buffer({dimension:y[t].length/m,data:y[t]}),divisor:1};const b=this.ts(),x=[],w=this.getSymbols();for(let t=0;t<w.length;t++){const e=w[t],s=this.Bo[t];if(!s)continue;const{fixSizeOnZoom:l}=e;let h=identity$2([]);b||(h=this.es(h));let u=0;s.forEach((t=>{const{geometry:n,nodeMatrix:i}=t,o=multiply$5(ko$1,h,i),s=n.boundingBox.copy();s.transform(o);const a=this.ns(s,e);a>u&&(u=a)}));const f=[0,0,u],d=s.map((s=>{const{geometry:u,nodeMatrix:d,materialInfo:p,skin:b,morphWeights:x,extraInfo:w}=s,A=new(this.getMaterialClazz(p))(p),k={},_=new dt$6(v,m,u,A,{transparent:!1,picking:!0});b&&(_.setUniform("jointTexture",b.jointTexture),_.setUniform("jointTextureSize",b.jointTextureSize),_.setUniform("numJoints",b.numJoints),_.setUniform("skinAnimation",0),k.HAS_SKIN=1),x&&(_.setUniform("morphWeights",x),k.HAS_MORPH=1),_.setUniform("hasAlpha",w.alphaMode&&"BLEND"===w.alphaMode.toUpperCase()),Ie$2(_.uniforms,"polygonFill",e,"markerFill",Ao$1,Ee$2(this.colorCache)),Ie$2(_.uniforms,"polygonOpacity",e,"markerOpacity",1);const T=multiply$5([],_o$1,d);multiply$5(T,h,T);const S=[];fromTranslation$1(S,f),multiply$5(T,S,T),_.setPositionMatrix((()=>{if(je$2(l)){const t=a.getGLScale()/a.getGLScale(l);return set$4(fo$1,t,t,t),fromScaling(S,fo$1),multiply$5(S,S,T)}return T}));const M=translate$1([],o,g);return _.setLocalTransform(M),u.generateBuffers(this.regl,{excludeElementsInVAO:!0}),y.instance_color&&(k.HAS_INSTANCE_COLOR=1),_.properties.features=c,_.setDefines(k),_.properties.symbolIndex={index:t},_}));x.push(...d)}return x.insContext={instanceData:y,tileTranslationMatrix:o,tileExtent:s,aPosition:u,positionSize:h},x}ns(t,e){const n=e.anchorZ||"bottom";let i=0;return"bottom"===n?i=-t.min[2]:"top"===n?i=-t.max[2]:"center"===n&&(i=-(t.min[2]+t.max[2])/2),i}addMesh(t){if(!t)return null;if(t[0].properties.level>2)return null;for(let e=0;e<t.length;e++){if(!t[e]||!t[e].geometry)continue;const n=this.Ko(t[e].properties.symbolIndex.index);t[e].setUniform("skinAnimation",+n)}return this.scene.addMesh(t),this}prepareRender(t){const e=this.getSymbols();let n=!1;for(let i=0;i<e.length;i++){const r=e[i];if(r&&this.Zo[i]&&(this.Ko(i)&&this.Zo[i])){n||(n=!0);let e=r.speed;const o=!!r.loop;Me$2(e)&&(e=1),this.Zo[i].updateAnimation(t.timestamp,o,e)}}n&&this.setToRedraw(!0),super.prepareRender(t)}getShadowMeshes(){return this.isVisible()?(this.shadowCount=this.scene.getMeshes().length,this.scene.getMeshes().filter((t=>0===t.properties.level))):wo$1}Ko(t){const e=this.getSymbols()[t];return e&&e.animation&&this.Zo[t]&&this.Zo[t].hasSkinAnimation()}Qo(t,e,n,o,s,a,l,h,c,u){function f(e,n,i,r){t[e][4*n]=i[r],t[e][4*n+1]=i[r+4],t[e][4*n+2]=i[r+8],t[e][4*n+3]=i[r+12]}const d=s.length/h,p=this.layer.options.tileSize/n*this.layer.getRenderer().getTileGLScale(o),m=this.layer.getRenderer().getZScale(),y=100*(this.dataConfig.altitudeOffset||0);let g=1/0,v=1/0,b=1/0,x=-1/0,w=-1/0,A=-1/0;const k=[];for(let t=0;t<d;t++){const e=set$4(k,s[t*h]*p,-s[t*h+1]*p,2===h?0:(s[t*h+2]+y)*m);e[0]<g&&(g=e[0]),e[0]>x&&(x=e[0]),e[1]<v&&(v=e[1]),e[1]>w&&(w=e[1]),e[2]<b&&(b=e[2]),e[2]>A&&(A=e[2])}const _=g+x/2,T=v+w/2,S=b+A/2,M=[],P=this.ts(),I=[0,0,1];for(let e=0;e<d;e++){const n=s[e*h],o=s[e*h+1],d=set$4(k,n*p-_,-o*p-T,2===h?0:(s[e*h+2]+y)*m-S),g=a&&a[e]||0,v=l&&l[e]||0;if(g||v){fromRotation$1(M,v,I);const t=set$4(fo$1,n,o,0);rotate$1(M,M,g,normalize$4(t,cross$1(t,t,I)));multiply$5(M,fromTranslation$1(ko$1,d),M)}else fromTranslation$1(M,d);if(P){multiply$5(M,M,this.es(ko$1,u,c,e))}f("instance_vectorA",e,M,0),f("instance_vectorB",e,M,1),f("instance_vectorC",e,M,2),t.aPickingId[e]=e}return set$4(k,_,T,S),k}rs(){if(!this.os){const t=this.getMap();this.os=100*X$4(t.getGLRes(),t)}return this.os}es(t,e,n,r){const o=this.getMap(),s=this.symbolDef[0],a=this.rs();let l=s.translationX||0,h=s.translationY||0,c=s.translationZ||0,u=s.rotationX||0,f=s.rotationY||0,d=s.rotationZ||0,p=s.scaleX||0,m=s.scaleY||0,y=s.scaleZ||0;const v=e&&e[n&&n[r]],b=o.getZoom(),x=v&&v.feature&&v.feature.properties;this.ss&&(l=this.ss(b,x)),this.as&&(h=this.as(b,x)),this.ls&&(c=this.ls(b,x));const w=set$4(po$1,l*a,h*a,c*a);this.hs&&(u=this.hs(b,x)),this.cs&&(f=this.cs(b,x)),this.us&&(d=this.us(b,x));const A=set$4(mo$1,u,f,d);this.fs&&(p=this.fs(b,x)),this.ds&&(m=this.ds(b,x)),this.ps&&(y=this.ps(b,x));const k=set$4(yo$1,p,m,y);return this.ms(t,w,A,k)}getShaderConfig(){const t=super.getShaderConfig();return t.positionAttribute="POSITION",t.normalAttribute="NORMAL",t}init(t){super.init(t),this.Jo()}Yo(){const t=this.symbolDef[0];isFunctionDefinition(t.translationX)&&(this.ss=interpolated(t.translationX)),isFunctionDefinition(t.translationY)&&(this.as=interpolated(t.translationY)),isFunctionDefinition(t.translationZ)&&(this.ls=interpolated(t.translationZ)),isFunctionDefinition(t.rotationX)&&(this.hs=interpolated(t.rotationX)),isFunctionDefinition(t.rotationY)&&(this.cs=interpolated(t.rotationY)),isFunctionDefinition(t.rotationZ)&&(this.us=interpolated(t.rotationZ)),isFunctionDefinition(t.scaleX)&&(this.fs=interpolated(t.scaleX)),isFunctionDefinition(t.scaleY)&&(this.ds=interpolated(t.scaleY)),isFunctionDefinition(t.scaleZ)&&(this.ps=interpolated(t.scaleZ))}ts(){return!!(this.ss&&!this.ss.isFeatureConstant||this.as&&!this.as.isFeatureConstant||this.ls&&!this.ls.isFeatureConstant||this.hs&&!this.hs.isFeatureConstant||this.cs&&!this.cs.isFeatureConstant||this.us&&!this.us.isFeatureConstant||this.fs&&!this.fs.isFeatureConstant||this.ds&&!this.ds.isFeatureConstant||this.ps&&!this.ps.isFeatureConstant)}Jo(){if(this.Zo)return;this.Zo=[];const t=this.getSymbols();this.ys=0;for(let e=0;e<t.length;e++){const n=t[e].url||"pyramid";this.Xo.loginGLTF(n);const i=this.Xo.getGLTF(n);if(i.then)i.then((n=>{if(!n.gltfPack)return this.ys++,void(this.ys>=t.length&&(this.$o=!0,this.setToRedraw(!0)));const{gltfPack:i}=n;this.Zo[e]=[i],this.Bo[e]=i.getMeshesInfo(),this.ys++,this.ys>=t.length&&(this.$o=!0),this.setToRedraw(!0)}));else{const{gltfPack:t}=i;t&&(this.Zo[e]=[t],this.Bo[e]=t.getMeshesInfo(),this.ys++)}}this.ys>=t.length&&(this.$o=!0)}getPickingVert(){return"\n    attribute vec3 aPosition;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 modelMatrix;\n    uniform mat4 positionMatrix;\n    //引入fbo picking的vert相关函数\n    #include <fbo_picking_vert>\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        //传入gl_Position的depth值\n        fbo_picking_setData(gl_Position.w, true);\n    }"}deleteMesh(t){if(t){this.scene.removeMesh(t);for(let e=0;e<t.length;e++)t[e].disposeInstanceData(),t[e].dispose()}}delete(){super.delete();const t=this.getSymbols();for(let e=0;e<t.length;e++){this.Xo.logoutGLTF(t[e].url||"pyramid")}}ms(t,e,n,o){const s=set$4(fo$1,...e||vo$1),a=n||bo$1,l=o||xo$1;return fromRotationTranslationScale(t,fromEuler(go$1,a[0],a[1],a[2]),s,l)}};class So$1 extends(To$1(ro$1)){getMaterialClazz(t){return t.diffuseFactor?lt$6:rt$6}}class Mo$1 extends(To$1(lo$1)){getMaterialClazz(t){return t.specularGlossinessTexture||t.diffuseTexture?Fm.StandardSpecularGlossinessMaterial:Fm.StandardMaterial}}const{getPBRUniforms:Po$1}=Fm.PBRUtils,Io$1={color:[2.0303,2.028,2.028],direction:[0,-.2717,-1]},Oo$1={index:0},Co$1=[0,0,0],Eo$1=[2,2];class Fo$1 extends fn$1{supportRenderMode(t){return"fxaa"===t||"fxaaBeforeTaa"===t}needPolygonOffset(){return!0}needToRedraw(){return!!super.needToRedraw()||this.getSymbol(Oo$1).animation}createMesh(t,e){const{geometry:i}=t;i.generateBuffers(this.regl);const r=new ft$6(i,null,{castShadow:!1,picking:!0});return r.properties.symbolIndex=Oo$1,r.setLocalTransform(e),r}callShader(t,e){super.callShader(t,e),this.transformWater();const n=this.gs(this.getMap(),e);this.renderer.render(this.vs,n,this.bs,this.getRenderFBO(e))}addMesh(t,e){this.Ci(t,e),super.addMesh(...arguments)}Ci(t){const e=this.getSymbol(Oo$1).ssr;for(let n=0;n<t.length;n++)t[n].ssr=e?1:0}paint(t){t.states&&t.states.includesChanged&&(this.shader.dispose(),this.vs.dispose(),this.Pi(t));const e=!!t.ssr&&this.getSymbol(Oo$1).ssr,n=this.vs,i=n.shaderDefines;if(e){const e=_e$2({},i,t.ssr.defines);n.shaderDefines=e}this.updateIBLDefines(n),this.xs.ssr=e?1:0,super.paint(t),e&&(n.shaderDefines=i)}init(t){this.createIBLTextures();this.renderer=new N$8(this.regl),this.createGround(),this.Pi(t),this.pickingFBO&&(this.picking=[new Am(this.renderer,{vert:dn$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())]),this.ws()}ws(){const t=this.regl;this.As||(this.As=t.texture(2));const e=this.getSymbol({index:0}),n=e.texWaveNormal,i=this.getCachedTexture(n),r=this;if(i)this.ks||(i.isLoading?setTimeout((()=>{this.shader&&this.ws()}),20):this.ks=this._s(t,i));else{const e=new Image;e.isLoading=!0,e.onload=function(){delete this.isLoading,r.ks=r._s(t,this),r.setToRedraw()},e.onerror=()=>{console.error("invalid water wave normal texture:"+n)},this.addCachedTexture(n,e),e.src=n}const o=e.texWavePerturbation,s=this.getCachedTexture(o);if(s)this.Ts||(s.isLoading?setTimeout((()=>{this.ws()}),20):this.Ts=this._s(t,s));else{const e=new Image;e.isLoading=!0,e.onload=function(){delete this.isLoading,r.Ts=r._s(t,this),r.setToRedraw()},e.onerror=()=>{console.error("invalid water wave perturbation texture:"+o)},this.addCachedTexture(o,e),e.src=o}}_s(t,e){return this.As?t.texture({width:e.width,height:e.height,mag:"linear",min:"linear mipmap linear",wrapS:"repeat",wrapT:"repeat",flipY:!0,data:e}):null}Pi(t){const e=this.canvas,i=[],o=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}},{name:"modelViewNormalMatrix",type:"function",fn:(t,e)=>{const n=multiply$5([],e.viewMatrix,e.modelMatrix),i=invert$2(n,n);return fromMat4$1([],transpose(i,i))}},{name:"modelViewMatrix",type:"function",fn:(t,e)=>multiply$5([],e.viewMatrix,e.modelMatrix)},{name:"uEnvironmentTransform",type:"function",fn:(t,e)=>fromRotation$2(i,Math.PI*(e.environmentOrientation||0)/180)}],s={TIME_NOISE_TEXTURE_REPEAT:.3737};this.fillIncludes(s,o,t);const a={x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1};this.shader=new ie$5({vert:"\n                attribute vec3 aPosition;\n\n                uniform mat4 projViewModelMatrix;\n\n                void main() {\n                    gl_Position = projViewModelMatrix * vec4(aPosition, 1.);\n                }\n            ",frag:"\n    #define SHADER_NAME WATER_STENCIL\n    precision mediump float;\n    void main() {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{viewport:a,colorMask:[!1,!1,!1,!1],stencil:{enable:!0,mask:255,func:{cmp:"<=",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}});const h={viewport:a,stencil:{enable:!0,mask:255,func:{cmp:"==",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!1}};o.push(...Ie$4.getUniformDeclares()),this.vs=new ie$5({vert:"#define SHADER_NAME WATER\nuniform mat4 modelMatrix;\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform vec2 uvOffset;\nuniform vec2 noiseUvOffset;\nuniform vec2 uvScale;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\n#ifdef HAS_SSR\nuniform mat4 modelViewMatrix;\nvarying vec4 vViewVertex;\n#endif\n#include <highlight_vert>\nmat3 c(in vec3 d) {\n  vec3 t = normalize(cross(d, vec3(.0, 1., .0)));\n  vec3 e = normalize(cross(d, t));\n  return mat3(t, e, d);\n}\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_vert>\n#endif\nconst vec3 f = vec3(0., 0., 1.);\nvoid main(void) {\n  vec4 h = vec4(aPosition, 1.);\n  vec4 i = modelMatrix * h;\n  vPos = i.xyz;\n  vTbnMatrix = c(f);\n  gl_Position = projViewModelMatrix * h;\n  vUv = aTexCoord * uvScale + uvOffset;\n  vNoiseUv = aTexCoord * uvScale * TIME_NOISE_TEXTURE_REPEAT + noiseUvOffset;\n#ifdef HAS_SSR\nvec4 j = modelViewMatrix * h;\n  vViewVertex = j;\n#endif\n#if defined(HAS_SHADOWING)\nshadow_computeShadowPars(h);\n#endif\nhighlight_setVarying();\n}",frag:"#define SHADER_NAME WATER\nprecision highp float;\nprecision highp sampler2D;\n#include <hsv_frag>\nuniform vec3 hsv;\nuniform float contrast;\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform sampler2D brdfLUT;\nuniform float rgbmRange;\nuniform mat3 uEnvironmentTransform;\nuniform vec3 diffuseSPH[9];\nvec3 c(const in vec3 d) {\n  vec3 e = uEnvironmentTransform * d;\n  float x = e.x;\n  float y = e.y;\n  float z = e.z;\n  vec3 f = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    f = hsv_apply(f, hdrHSV);\n  }\n  return max(f, vec3(.0));\n}\nvec3 h(const in vec3 i, const in float j, const in float k, const in float l) {\n  vec4 rgba = texture2D(brdfLUT, vec2(k, j));\n  float b = (rgba[3] * 65280.0 + rgba[2] * 255.);\n  float a = (rgba[1] * 65280.0 + rgba[0] * 255.);\n  const float m = 1. / 65535.;\n  return (i * a + b * l) * m;\n}\n#else\nuniform vec3 ambientColor;\n#endif\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nvec3 o(const in vec4 u, const in float v) {\n  if(v <= .0)\n    return u.rgb;\n  return v * u.rgb * u.a;\n}\n#ifdef HAS_SSR\nvarying vec4 vViewVertex;\nuniform mat3 modelViewNormalMatrix;\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nuniform vec2 cameraNearFar;\nfloat A(const in vec4 B) {\n  return B.r + B.g / 255.;\n}\nfloat C(const in vec2 D, const in float E) {\n  vec3 F = vec3(.06711056, .00583715, 52.9829189);\n  return fract(F.z * fract(dot(D.xy + E * vec2(47., 17.) * .695, F.xy))) * .5;\n}\nvec3 G(const in float H, const in float I, const in vec2 J) {\n  float K = min(I - .01, H);\n  float L = floor(K);\n  float M = min(I, L + 1.);\n  float N = pow(2., M);\n  vec2 O = 2. * N / J;\n  if(K - L > .5)\n    N *= 2.;\n  return vec3(O, N);\n}\nvec2 P(const in vec2 Q, const in vec3 R) {\n  vec2 S = max(R.xy, min(1. - R.xy, Q));\n  return vec2(2. * S.x, R.z - 1. - S.y) / R.z;\n}\nvec3 T(const in mat4 U, const in vec3 V) {\n  vec4 W = U * vec4(V, 1.);\n  return vec3(.5 + .5 * W.xy / W.w, W.w);\n}\nvec3 X(const in float Y, const in vec2 S) {\n  return texture2D(TextureReflected, S).rgb;\n}\nfloat Z(float ba) {\n  highp mat4 U = projMatrix;\n  highp float z = ba * 2. - 1.;\n  return -U[3].z / (z + U[2].z);\n}\nfloat bb(const vec2 S) {\n  float ba = A(texture2D(TextureDepth, S));\n  return ba;\n}\nvec3 bc(const in float E, const in vec3 bd, const in vec3 be, const in vec3 bf, const in vec3 bg, const in float bh) {\n  vec2 bi;\n  bi.x = C(gl_FragCoord.yx, E);\n  bi.y = fract(bi.x * 52.9829189);\n  bi.y = mix(bi.y, 1., .7);\n  float bj = 2. * 3.14159 * bi.x;\n  float bk = pow(max(bi.y, .000001), bh / (2. - bh));\n  float bl = sqrt(1. - bk * bk);\n  vec3 bm = vec3(bl * cos(bj), bl * sin(bj), bk);\n  bm = bm.x * bd + bm.y * be + bm.z * bf;\n  return normalize((2. * dot(bg, bm)) * bm - bg);\n}\nfloat bn(const in float E) {\n  return (C(gl_FragCoord.xy, E) - .5);\n}\nvec3 bo(const in vec3 bp, const in float bq, const in vec3 br) {\n  vec3 bs = T(projMatrix, vViewVertex.xyz + br * bq);\n  bs.z = 1. / bs.z;\n  bs -= bp;\n  float bt = min(1., .99 * (1. - bp.x) / max(1e-5, bs.x));\n  float bu = min(1., .99 * (1. - bp.y) / max(1e-5, bs.y));\n  float bv = min(1., .99 * bp.x / max(1e-5, -bs.x));\n  float bw = min(1., .99 * bp.y / max(1e-5, -bs.y));\n  return bs * min(bt, bu) * min(bv, bw);\n}\nfloat bx(const in vec3 bp, const in vec3 bs, inout float by, inout float bz) {\n  float bA = (bz + by) * .5;\n  vec3 bB = bp + bs * bA;\n  float z = bb(bB.xy);\n  float ba = Z(z);\n  float bC = -1. / bB.z;\n  by = ba > bC ? by : bA;\n  bz = ba > bC ? bA : bz;\n  return bA;\n}\nvec4 bD(const in vec3 bp, const in float bq, in float bE, const in vec3 br, const in float j, const in float E) {\n  const int bF = 20;\n  float bG = 1. / float(bF);\n  bE *= bG;\n  vec3 bs = bo(bp, bq, br);\n  float bH = bG;\n  vec3 bI = vec3(.0, bH, 1.);\n  vec3 bB;\n  float z, ba, bC, bJ, bK, bL;\n  bool bM;\n  float bN = 1.;\n  float bA;\n  for(int bO = 0; bO < bF; bO++) {\n    bB = bp + bs * bI.y;\n    z = bb(bB.xy);\n    ba = Z(z);\n    bC = -1. / bB.z;\n    bJ = bC - ba;\n    bJ *= clamp(sign(abs(bJ) - bq * bG * bG), .0, 1.);\n    bM = abs(bJ + bE) < bE;\n    bK = clamp(bI.x / (bI.x - bJ), .0, 1.);\n    bL = bM ? bI.y + bK * bG - bG : 1.;\n    bI.z = min(bI.z, bL);\n    bI.x = bJ;\n    if(bM) {\n      float by = bI.y - bG;\n      float bz = bI.y;\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bN = bA;\n      break;\n    }\n    bI.y += bG;\n  }\n  return vec4(bp + bs * bN, 1. - bN);\n}\nvec3 bP(in vec4 bQ, const in float bR, const in vec3 bS, const in vec3 bT, const in float j) {\n  vec4 bU = mix(outputFovInfo[0], outputFovInfo[1], bQ.x);\n  bQ.xyz = vec3(mix(bU.xy, bU.zw, bQ.y), 1.) * -1. / bQ.z;\n  bQ.xyz = (reprojViewProjMatrix * vec4(bQ.xyz, 1.)).xyw;\n  bQ.xy /= bQ.z;\n  float bV = clamp(6. - 6. * max(abs(bQ.x), abs(bQ.y)), .0, 1.);\n  bQ.xy = .5 + .5 * bQ.xy;\n  return vec3(bQ.xy, 1.);\n}\nvec3 ssr(const in vec3 bS, const in vec3 bT, const in float j, const in vec3 d, const in vec3 bg) {\n  float bW = .0;\n  vec4 f = vec4(.0);\n  float bh = j * j;\n  bh = bh * bh;\n  vec3 bX = abs(d.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 bd = normalize(cross(bX, d));\n  vec3 be = cross(d, bd);\n  float bR = ssrFactor * clamp(-4. * dot(bg, d) + 3.8, .0, 1.);\n  bR *= clamp(4.7 - j * 5., .0, 1.);\n  vec3 bp = T(projMatrix, vViewVertex.xyz);\n  bp.z = 1. / bp.z;\n  vec3 br = bc(bW, bd, be, d, bg, bh);\n  float bq = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, br.z * .5 + .5);\n  float bE = .5 * bq;\n  vec4 bQ;\n  if(dot(br, d) > .001 && bR > .0) {\n    bQ = bD(bp, bq, bE, br, j, bW);\n    if(bQ.w > .0)\n      return bP(bQ, bR, bS, bT, j);\n    \n  }\n  return vec3(.0);\n}\n#endif\nconst vec3 bY = vec3(0., 0., 1.);\nuniform mat4 viewMatrix;\nuniform sampler2D normalTexture;\nuniform sampler2D heightTexture;\nuniform vec4 waveParams;\nuniform vec2 waterDir;\nuniform vec4 waterBaseColor;\nuniform vec3 lightDirection;\nuniform vec3 lightColor;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\nfloat bZ(vec3 e, float ca) {\n  float cb = max(.015, ca);\n  return max((e.x + e.y) * .3303545 / cb + .3303545, .0);\n}\nconst vec2 cc = vec2(6. / 25., 5. / 24.);\nvec2 cd(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rg - 1.;\n}\nfloat cf(vec2 S) {\n  return texture2D(heightTexture, S).b;\n}\nvec3 cg(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rgb - 1.;\n}\nfloat ch(vec2 S, float ci) {\n  return fract(ci);\n}\nfloat cj(vec2 S, float ci) {\n  float ck = ch(S, ci);\n  return 1. - abs(1. - 2. * ck);\n}\nvec3 cl(sampler2D cm, vec2 S, float ci, float cn) {\n  float co = waveParams[2];\n  float cp = waveParams[3];\n  vec2 cq = cd(cm, S) * co;\n  float ck = ch(S, ci + cn);\n  float cr = cj(S, ci + cn);\n  vec2 f = S;\n  f -= cq * (ck + cp);\n  f += cn;\n  f += (ci - ck) * cc;\n  return vec3(f, cr);\n}\nconst float cs = 7.77;\nvec3 ct(sampler2D cu, sampler2D cv, vec2 cw, vec2 cx, float ci) {\n  float ca = waveParams[0];\n  vec2 cy = ci * -cx;\n  float cz = cf(vNoiseUv) * cs;\n  vec3 cA = cl(cv, cw + cy, ci + cz, .0);\n  vec3 cB = cl(cv, cw + cy, ci + cz, .5);\n  vec3 cC = cg(cu, cA.xy) * cA.z;\n  vec3 cD = cg(cu, cB.xy) * cB.z;\n  vec3 cE = normalize(cC + cD);\n  cE.xy *= ca;\n  cE.z = sqrt(1. - dot(cE.xy, cE.xy));\n  return cE;\n}\nvec4 cF(vec2 cw, float cG) {\n  float cH = waveParams[1];\n  vec3 d = ct(normalTexture, heightTexture, cw * cH, waterDir, cG);\n  float cI = bZ(d, waveParams[0]);\n  return vec4(d, cI);\n}\nconst float cJ = 3.141592653589793;\nconst float cK = 1. / cJ;\nconst float cL = .3183098861837907;\nconst float cM = 1.570796326794897;\nconst float cN = .4;\nfloat cO = 2.2;\nvec3 cP(float cQ, vec3 cR, float l) {\n  return cR + (l - cR) * pow(1. - cQ, 5.);\n}\nfloat cS(float cT, float j) {\n  float cU = j * j;\n  float cV = cT * cT;\n  float cW = pow((cV * (cU - 1.) + 1.), cO) * cJ;\n  return cU / cW;\n}\nfloat cX(float cY) {\n  return .25 / (cY * cY);\n}\nvec3 cZ(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float da = 2.2;\nconst float db = .4545454545;\nvec4 dc(vec4 u) {\n  return vec4(pow(u.rgb, vec3(db)), u.w);\n}\nvec3 dd(vec3 u) {\n  return pow(u, vec3(da));\n}\nconst vec3 de = vec3(.02, 1., 5.);\nconst vec2 df = vec2(.02, .1);\nconst float j = .06;\nconst float dg = 1.7;\nconst vec3 dh = vec3(0, .6, .9);\nconst vec3 di = vec3(.72, .92, 1.);\nconst float dj = .65;\nconst float dk = 300000.0;\nconst float dl = 500000.0;\nconst float dm = .775;\nconst float dn = .8;\nPBRShadingWater dp;\nvec3 dq(in PBRShadingWater dr, float j, vec3 ds, float dt) {\n  vec3 du = cP(dr.VdotH, ds, dt);\n  float dv = cS(dr.NdotH, j);\n  float dw = cX(dr.LdotH);\n  float dx = mix(j + .045, j + .385, 1. - dr.VdotH);\n  float dy = 1.2;\n  float dz = cS(dr.NdotH, dx) * dy;\n  return ((dv + dz) * dw) * du;\n}\nvec3 dA(float dg, float dB, vec3 dh, float dC) {\n  return dg * (.075 * dh * pow(dB, 4.) + 50. * pow(dB, 23.)) * dC;\n}\nvec3 dD(in float bk, in vec3 dE, in vec3 dF) {\n  float dG = pow((1. - bk), de[2]);\n  return mix(dF, dE, dG);\n}\nvec3 dH(in vec3 e, in vec3 dI, in float dJ, in float j) {\n  \n#ifdef HAS_IBL_LIGHTING\nvec3 dK = reflect(-dI, e);\n  vec4 dL = textureCube(prefilterMap, uEnvironmentTransform * dK);\n  float dM = clamp(1. + dot(dK, e), .0, 1.);\n  dL *= dM * dM;\n  vec3 i = o(dL, rgbmRange);\n  vec3 dN = c(e);\n  float l = clamp(50.0 * waterBaseColor.g, .0, 1.);\n  vec3 dO = h(waterBaseColor.rgb, j, dot(e, dI), l);\n  return i * dO + dN;\n#else\nvec3 dP = dd(di);\n  vec3 dQ = dd(dh);\n  vec3 di = dD(dJ, dP, dQ);\n  return di;\n#endif\n}\nvec3 dR(in vec3 e, in vec3 dI, in vec3 dS, vec3 u, in vec3 dT, in vec3 dU, in float dV, float dW, vec3 dX) {\n  float dY = 0.;\n  vec3 dZ = dd(u);\n  vec3 bm = normalize(dS + dI);\n  dp.NdotL = clamp(dot(e, dS), .0, 1.);\n  dp.NdotV = clamp(dot(e, dI), .001, 1.);\n  dp.VdotN = clamp(dot(dI, e), .001, 1.);\n  dp.NdotH = clamp(dot(e, bm), .0, 1.);\n  dp.VdotH = clamp(dot(dI, bm), .0, 1.);\n  dp.LdotH = clamp(dot(dS, bm), .0, 1.);\n  float dJ = max(dot(dU, dI), .0);\n  vec3 di = dH(e, dI, dJ, j);\n  float ea = max(dot(dU, dS), .0);\n  float eb = .1 + ea * .9;\n  di *= eb;\n  float ec = clamp(dV, .8, 1.);\n  vec3 ed = cP(dp.VdotN, vec3(de[0]), de[1]);\n  vec3 ee = ed * di * ec;\n  vec3 ef = dZ * mix(di, ea * dT * cK, 2. / 3.) * ec;\n  vec3 i = vec3(.0);\n  if(dJ > .0 && ea > .0) {\n    vec3 eg = dq(dp, j, vec3(df[0]), df[1]);\n    vec3 eh = dT * cK * dV;\n    i = dp.NdotL * eh * eg;\n  }\n  vec3 cI = vec3(.0);\n  if(dJ > .0) {\n    cI = dA(dg, dW, dh, eb);\n  }\n  vec3 ei = vec3(.0);\n#ifdef HAS_SSR\nfloat ej = smoothstep(dl, dk, -dX.z);\n  mat4 ek = viewMatrix;\n  vec4 el = vec4(dX.xyz, 1.);\n  vec3 em = normalize(el.xyz);\n  vec4 en = ek * vec4(e, .0);\n  vec3 eo = normalize(en.xyz);\n  vec4 ep = ek * vec4(dU, .0);\n  float eq = pow(max(dot(-em, ep.xyz), .0), cN);\n  vec3 er = mix(ep.xyz, eo, eq);\n  vec3 es = ssr(vec3(.0), vec3(1.), j, normalize(er), -normalize(vViewVertex.xyz));\n  if(es.z > .0) {\n    vec2 et = smoothstep(.3, .6, abs(vec2(.5) - es.xy));\n    dY = dm * clamp(1. - 1.3 * et.y, .0, 1.) * ej;\n    vec3 eu = X(.0, es.xy);\n    ei = dd(eu) * dY * ed.y * dj;\n  }\n#endif\nfloat ev = mix(dn, dn * .5, dY);\n  return cZ((1. - dY) * ee + ei + ef * ev + i + cI);\n}\nvoid main() {\n  vec3 dU = bY;\n  vec4 ew = cF(vUv, timeElapsed);\n  vec3 e = normalize(vTbnMatrix * ew.xyz);\n  vec3 dI = -normalize(vPos - camPos);\n  vec3 dS = normalize(-lightDirection);\n#if defined(HAS_SHADOWING)\nfloat dV = shadow_computeShadow();\n#else\nfloat dV = 1.;\n#endif\nvec4 ex = viewMatrix * vec4(vPos, 1.);\n  vec4 ey = vec4(dR(e, dI, dS, waterBaseColor.rgb, lightColor, dU, dV, ew.w, ex.xyz), waterBaseColor.a);\n  gl_FragColor = dc(ey);\n  if(contrast != 1.) {\n    gl_FragColor = contrastMatrix(contrast) * gl_FragColor;\n  }\n  if(length(hsv) > .0) {\n    gl_FragColor = hsv_apply(gl_FragColor, hsv);\n  }\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}",defines:s,uniforms:o,extraCommandProps:h})}needClearStencil(){return!0}getUniformValues(t){return{projViewMatrix:t.projViewMatrix}}gs(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=Po$1(t,n,i,e&&e.ssr,e&&e.jitter),o=t.getLightManager();let s=o&&o.getDirectionalLight()||{};const a=o&&o.getAmbientLight()||{},l=this.getSymbol(Oo$1),c=this.Ss=this.Ss||[],u=this.Ms=this.Ms||[];return set$3(u,.09,l.uvScale||3,.03,-.5),_e$2(r,{ambientColor:a.color||[.2,.2,.2],viewMatrix:t.viewMatrix,lightDirection:s.direction||Io$1.direction,lightColor:s.color||Io$1.color,camPos:t.cameraPosition,timeElapsed:l.animation?(this.layer.getRenderer().getFrameTimestamp()||0)/(1/(l.waterSpeed||1)*1e4):0,normalTexture:this.ks||this.As,heightTexture:this.Ts||this.As,waveParams:u,waterDir:zo$1(c,l.waterDirection||0),waterBaseColor:l.waterBaseColor||[.1451,.2588,.4863,1],contrast:l.contrast||1,hsv:l.hsv||Co$1}),this.setIncludeUniformValues(r,e),e&&e.ssr&&e.ssr.renderUniforms&&_e$2(r,e.ssr.renderUniforms),r}delete(){super.delete(),this.As&&(this.As.destroy(),delete this.As),this.ks&&this.ks.destroy(),this.Ts&&this.Ts.destroy(),this.shader&&(this.shader.dispose(),delete this.shader),this.vs&&this.vs.dispose(),this.xs&&(this.xs.geometry.dispose(),this.xs.material&&this.xs.material.dispose(),this.xs.dispose(),delete this.xs),this.disposeIBLTextures()}createGround(){const t=new Ut$5;t.data.aTexCoord=new Uint8Array([0,1,1,1,0,0,1,0]),t.generateBuffers(this.renderer.regl),this.xs=new ft$6(t,null,{castShadow:!1}),this.bs=new yt$6([this.xs])}transformWater(){const t=this.getMap(),e=xt$5.getGroundTransform(this.xs.localTransform,t);this.xs.setLocalTransform(e);const n=t._get2DExtentAtRes(t.getGLRes()),i=n.getWidth(),r=n.getHeight(),s=t.cameraLookAt,h=(s[0]-i)/Eo$1[0],c=(s[1]+r)/Eo$1[1],d=.3737*h%1,p=.3737*c%1,m=i/Eo$1[0]*2,y=r/Eo$1[1]*2;this.xs.setUniform("uvOffset",[h%1,c%1]),this.xs.setUniform("noiseUvOffset",[d,p]),this.xs.setUniform("uvScale",[m,-y])}}function zo$1(t,e){return e=Math.PI*e/180,t[0]=Math.sin(e),t[1]=Math.cos(e),t}const jo$1=Ae$2("fill",vn$1);jo$1.registerAt(Ct$2);const Ro$1=Ae$2("line",An$2);Ro$1.registerAt(Ct$2);const Do$1=Ae$2("line-gradient",kn$1);Do$1.registerAt(Ct$2);const No$1=Ae$2("icon",Xi$1);No$1.registerAt(Ct$2);const Lo$1=Ae$2("text",Vr$2);Lo$1.registerAt(Ct$2);const Ho$1=Ae$2("native-line",Yr$2);Ho$1.registerAt(Ct$2),Ae$2("native-point",$r$2).registerAt(Ct$2);const Vo$1=Ae$2("phong",ro$1);Vo$1.registerAt(Ct$2);const Uo$1=Ae$2("wireframe",so$1);Uo$1.registerAt(Ct$2);const Go$1=Ae$2("lit",lo$1);Go$1.registerAt(Ct$2);const Wo$1=Ae$2("tube",uo$1);Wo$1.registerAt(Ct$2);const qo$1=Ae$2("gltf-phong",So$1);qo$1.registerAt(Ct$2);const $o$1=Ae$2("gltf-lit",Mo$1);$o$1.registerAt(Ct$2);const Bo$1=Ae$2("heatmap",class extends fn$1{createFnTypeConfig(t,e){const n=interpolated(e.heatWeight),i=new Int16Array(1);return[{attrName:"aWeight",symbolName:"heatWeight",type:Uint8Array,size:1,evaluate:e=>{const r=n(t.getZoom(),e);return i[0]=r,i[0]}}]}createMesh(t,e){const{geometry:i,symbolIndex:r,ref:o}=t;void 0===o&&Ve$2(i,this.getSymbolDef(r),this.getFnTypeConfig(r));const s=this.getSymbol(r),a={tileRatio:i.properties.tileRatio,dataResolution:i.properties.tileResolution};Ie$2(a,"heatmapIntensity",s,"heatmapIntensity",1),Ie$2(a,"heatmapRadius",s,"heatmapRadius",6),Ie$2(a,"heatmapWeight",s,"heatmapWeight",1),Ie$2(a,"heatmapOpacity",s,"heatmapOpacity",1),i.generateBuffers(this.regl);const l=new tt$6(a),h=new ft$6(i,l,{transparent:!0,castShadow:!1,picking:!0}),c={};return i.data.aWeight&&(c.HAS_HEAT_WEIGHT=1),h.setDefines(c),h.setLocalTransform(e),h.properties.symbolIndex=r,h}callRenderer(t,e,n){const i=this.getRenderFBO(n);this.Ps.render(this.scene,e,i)}getUniformValues(t){const e=this.getSymbol({index:0}),{projViewMatrix:n}=t;return{glScale:1/t.getGLScale(),resolution:t.getResolution(),projViewMatrix:n,heatmapOpacity:e.heatmapOpacity}}getHeatmapMeshes(){return this.scene.getMeshes()}delete(){super.delete(...arguments),this.Ps.dispose(),delete this.Ps}init(){this.renderer=new N$8(this.regl);const e=this.getPolygonOffset(),i=this.getSymbols()[0];this.Ps=new ce$4(this.regl,this.sceneConfig,this.layer,i.heatmapColor,null,e)}});Bo$1.registerAt(Ct$2);const Xo$1=Ae$2("water",Fo$1);if(Xo$1.registerAt(Ct$2),Ut$2.registerPainter("lit",lo$1),Ut$2.registerPainter("icon",Xi$1),Ut$2.registerPainter("fill",vn$1),Ut$2.registerPainter("line",An$2),Ut$2.registerPainter("line-gradient",kn$1),Ut$2.registerPainter("water",Fo$1),Ut$2.registerPainter("tube",uo$1),Xt$5.register("vt_position_vert","#ifdef HAS_TERRAIN_ALTITUDE\nattribute float aTerrainAltitude;\n#endif\n#ifdef HAS_ALTITUDE\n    vec3 unpackVTPosition() {\n        return vec3(aPosition, aAltitude);\n    }\n#else\n    float position_modValue = 16384.0;\n    float position_delta = 0.00001;\n    vec3 unpackVTPosition() {\n        float z = aPosition.z;\n        vec2 pos = sign(aPosition.xy + position_delta) * mod(abs(aPosition.xy), position_modValue);\n        vec2 highs = floor(abs(aPosition.xy) / position_modValue);\n        float altitude = sign(z + position_delta) * (highs.x * 2.0 + highs.y) * pow(2.0, 15.0) + z;\n        #ifdef HAS_TERRAIN_ALTITUDE\n            altitude += aTerrainAltitude * 100.0;\n        #endif\n        return vec3(pos, altitude);\n    }\n#endif"),Ct$2.VERSION="0.79.1",Ut$2.VERSION="0.79.1",create$5(),transcoders){const n=t__namespace.Map.VERSION;if(n.indexOf("1.0.0-beta")>=0||n.indexOf("1.0.0-alpha")>=0){const n=transcoders.inject(N$5);t__namespace.registerWorkerAdapter("@maptalks/vt",n)}else t__namespace.registerWorkerAdapter("@maptalks/vt",(function(){return transcoders.inject(N$5)}))}else t__namespace.registerWorkerAdapter("@maptalks/vt",N$5);"undefined"!=typeof console&&console.log("@maptalks/vt v0.79.1");for(
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/
var planes$1=[],i$1=0;i$1<6;i$1++)planes$1[i$1]=[];var p$5=[];function intersectsBox$1(matrix,box,mask){setPlanes$1(matrix);for(var i=0;i<6;i++)if(!mask||"0"!==mask.charAt(i)){var plane=planes$1[i];if(p$5[0]=plane[0]>0?box[1][0]:box[0][0],p$5[1]=plane[1]>0?box[1][1]:box[0][1],p$5[2]=plane[2]>0?box[1][2]:box[0][2],distanceToPoint$1(plane,p$5)<0)return!1}return!0}function intersectsPlane(plane,box){var center=box,halfAxes=box,normalX=plane[0],normalY=plane[1],normalZ=plane[2],radEffective=Math.abs(normalX*halfAxes[3]+normalY*halfAxes[6]+normalZ*halfAxes[9])+Math.abs(normalX*halfAxes[4]+normalY*halfAxes[7]+normalZ*halfAxes[10])+Math.abs(normalX*halfAxes[5]+normalY*halfAxes[8]+normalZ*halfAxes[11]),distanceToPlane=distanceToPoint$1(plane,center);return!(distanceToPlane<=-radEffective)}function setPlanes$1(m){var me0=m[0],me1=m[1],me2=m[2],me3=m[3],me4=m[4],me5=m[5],me6=m[6],me7=m[7],me8=m[8],me9=m[9],me10=m[10],me11=m[11],me12=m[12],me13=m[13],me14=m[14],me15=m[15];setComponents$1(planes$1[0],me3-me0,me7-me4,me11-me8,me15-me12),setComponents$1(planes$1[1],me3+me0,me7+me4,me11+me8,me15+me12),setComponents$1(planes$1[2],me3+me1,me7+me5,me11+me9,me15+me13),setComponents$1(planes$1[3],me3-me1,me7-me5,me11-me9,me15-me13),setComponents$1(planes$1[4],me3-me2,me7-me6,me11-me10,me15-me14),setComponents$1(planes$1[5],me3+me2,me7+me6,me11+me10,me15+me14)}function setComponents$1(out,x,y,z,w){var inverseNormalLength=1/Math.sqrt(x*x+y*y+z*z);return out[0]=x*inverseNormalLength,out[1]=y*inverseNormalLength,out[2]=z*inverseNormalLength,out[3]=w*inverseNormalLength,out}function distanceToPoint$1(plane,p){return plane[0]*p[0]+plane[1]*p[1]+plane[2]*p[2]+plane[3]}
/*!
	 * @maptalks/3dtiles v0.23.1
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.org
	 */const m$3='function(t){var e=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function A(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function i(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e,r){var n=e[0],A=e[1],i=e[2],o=e[3],s=e[4],a=e[5],B=e[6],E=e[7],c=e[8],C=e[9],f=e[10],l=e[11],u=e[12],_=e[13],D=e[14],R=e[15],I=r[0],T=r[1],h=r[2],F=r[3];return t[0]=I*n+T*s+h*c+F*u,t[1]=I*A+T*a+h*C+F*_,t[2]=I*i+T*B+h*f+F*D,t[3]=I*o+T*E+h*l+F*R,I=r[4],T=r[5],h=r[6],F=r[7],t[4]=I*n+T*s+h*c+F*u,t[5]=I*A+T*a+h*C+F*_,t[6]=I*i+T*B+h*f+F*D,t[7]=I*o+T*E+h*l+F*R,I=r[8],T=r[9],h=r[10],F=r[11],t[8]=I*n+T*s+h*c+F*u,t[9]=I*A+T*a+h*C+F*_,t[10]=I*i+T*B+h*f+F*D,t[11]=I*o+T*E+h*l+F*R,I=r[12],T=r[13],h=r[14],F=r[15],t[12]=I*n+T*s+h*c+F*u,t[13]=I*A+T*a+h*C+F*_,t[14]=I*i+T*B+h*f+F*D,t[15]=I*o+T*E+h*l+F*R,t}function s(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function a(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B(t,e){var r=e[0],n=e[1],A=e[2],i=e[3],o=r+r,s=n+n,a=A+A,B=r*o,E=n*o,c=n*s,C=A*o,f=A*s,l=A*a,u=i*o,_=i*s,D=i*a;return t[0]=1-c-l,t[1]=E+D,t[2]=C-_,t[3]=0,t[4]=E-D,t[5]=1-B-l,t[6]=f+u,t[7]=0,t[8]=C+_,t[9]=f-u,t[10]=1-B-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function E(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function c(){var t=new r(3);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function C(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function f(t,e,n){var A=new r(3);return A[0]=t,A[1]=e,A[2]=n,A}function l(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function u(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function _(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function D(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function R(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function I(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function T(t,e){var r=e[0]-t[0],n=e[1]-t[1],A=e[2]-t[2];return Math.sqrt(r*r+n*n+A*A)}function h(t,e){var r=e[0],n=e[1],A=e[2],i=r*r+n*n+A*A;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t}function F(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function P(t,e,r){var n=e[0],A=e[1],i=e[2],o=r[0],s=r[1],a=r[2];return t[0]=A*a-i*s,t[1]=i*o-n*a,t[2]=n*s-A*o,t}function L(t,e,r){var n=e[0],A=e[1],i=e[2],o=r[3]*n+r[7]*A+r[11]*i+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*A+r[8]*i+r[12])/o,t[1]=(r[1]*n+r[5]*A+r[9]*i+r[13])/o,t[2]=(r[2]*n+r[6]*A+r[10]*i+r[14])/o,t}var O=D,y=R,M=C;function N(t,e,r,n,A){return t[0]=e,t[1]=r,t[2]=n,t[3]=A,t}function S(){var t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function d(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function U(t,r,n,A){var i=r[0],o=r[1],s=r[2],a=r[3],B=n[0],E=n[1],c=n[2],C=n[3],f=void 0,l=void 0,u=void 0,_=void 0,D=void 0;return(l=i*B+o*E+s*c+a*C)<0&&(l=-l,B=-B,E=-E,c=-c,C=-C),1-l>e?(f=Math.acos(l),u=Math.sin(f),_=Math.sin((1-A)*f)/u,D=Math.sin(A*f)/u):(_=1-A,D=A),t[0]=_*i+D*B,t[1]=_*o+D*E,t[2]=_*s+D*c,t[3]=_*a+D*C,t}c(),function(){var t,e=(t=new r(4),r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var G,m=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};c(),f(1,0,0),f(0,1,0),S(),S(),G=new r(9),r!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1;\n/*!\n   * @maptalks/gltf-loader v0.27.2\n   * LICENSE : UNLICENSED\n   * (c) 2016-2022 maptalks.org\n   */\nlet b=0;function p(t){return null==t}function w(t){return!p(t)}function H(t){for(let e=1;e<arguments.length;e++){const r=arguments[e];for(const e in r)t[e]=r[e]}return t}function K(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView\'s component type: "+t)}function g(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function V(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),r=e.length,n=new Uint8Array(r);for(let t=0;t<r;t++)n[t]=e.charCodeAt(t);return n.buffer}const X=[],J=[],v=[],Z=[0,0,0],x=d([]),k=[1,1,1];function W(t,e,r,n,A,i,o){const s=K(o);if((0===A||A===n*s.BYTES_PER_ELEMENT)&&i%s.BYTES_PER_ELEMENT==0){const A=new s(e,i,r*n);return t.set(A),t}0===A&&(A=n*s.BYTES_PER_ELEMENT);const a=new Uint8Array(n*s.BYTES_PER_ELEMENT);for(let o=0;o<r;o++){let r=null;const B=new Uint8Array(e,A*o+i,n*s.BYTES_PER_ELEMENT);a.set(B),r=new s(a.buffer,0,n);for(let e=0;e<n;e++)t[o*n+e]=r[e]}return t}const Q="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function j(t,e,r){const n=new Uint8Array(t,e,r);return Q.decode(n)}const Y={get:function(t,e={}){e||(e={});const r=new AbortController,n=r.signal,A=H({},e);A.signal=n,A.method||(A.method="GET");const i=fetch(t,A).then((t=>{const r=this.t(t,e.responseType);return r.message?r:r.then((r=>"arraybuffer"===e.responseType?{data:r,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:r)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return i.xhr=r,i},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={})=>(e||(e={}),e.responseType="arraybuffer",Y.get(t,e)),getJSON:function(t,e={}){return e&&e.jsonp?Y.jsonp(t):((e=e||{}).responseType="json",Y.get(t,e))},jsonp:function(t){const e="_maptalks_jsonp_"+b++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let r=document.createElement("script");return r.type="text/javascript",r.src=t,new Promise((t=>{window[e]=function(n){document.getElementsByTagName("head")[0].removeChild(r),r=null,delete window[e],t(n)},document.getElementsByTagName("head")[0].appendChild(r)}))}};class z{constructor(t,e,r){this.A=t,this.decoders=e,this.i=r,this.images={},this.o={}}requestImageFromBufferURI(t,e,r){if(this.buffers[t.id]){const n=this.buffers[t.id],A=this.B(e,n);return this.getImageByBuffer(A,r)}if(this.o[t.id])return this.o[t.id].then((()=>{const n=this.buffers[t.id],A=this.B(e,n);return this.getImageByBuffer(A,r)}));if(g(t.uri)){const n=this.buffers[t.id]=V(t.uri),A=this.B(e,n);return this.getImageByBuffer(A,r)}return this.o[t.id]=Y.getArrayBuffer(t.uri,null).then((n=>{const A=this.buffers[t.id]=n.data,i=this.B(e,A);return this.getImageByBuffer(i,r)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const r=this.decoders;if(r[e.mimeType])return r[e.mimeType](t,{supportedFormats:this.i});if("image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType)return console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null);{const r=new Blob([t],{type:e.mimeType}),n=URL.createObjectURL(r);return this.C(e.id,n)}}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.o[t.id]?this.o[t.id].then((()=>this.images[t.id])):this.o[t.id]=this.C(t.id,e)}C(t,e){return new Promise(((r,n)=>{this.A(e,((A,i)=>{A?n(A):(URL.revokeObjectURL(e),this.images[t]=i,r(this.images[t]))}))}))}}const q=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16];class ${constructor(t,e,r){this.rootPath=t,this.gltf=e,this.l=!1,this.glbBuffer=r,this.buffers={},this.requests={},this.accessors={},this.u()}_(t,e){const r=this.gltf,n=r.accessors[e];if(void 0===n.bufferView)return this.accessors[n.id]=this.D(t,e,null,0),Promise.resolve(this.accessors[n.id]);if(n&&this.accessors[n.id])return Promise.resolve(this.accessors[n.id]);const A=r.bufferViews[n.bufferView];return this.I(A).then((r=>{const{buffer:A,byteOffset:i}=r;return this.accessors[n.id]=this.D(t,e,A,i)}))}I(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then((()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(g(e.uri)){const t=this.buffers[e.id]=V(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const r=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||r?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=Y.getArrayBuffer(t,null).then((n=>(r&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=n.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}D(t,e,r,n=0){const A=this.gltf,i=A.accessors[e],o=void 0!==i.bufferView?A.bufferViews[i.bufferView]:{},s=(o.byteOffset||0)+n,a=this.T(i.type),B=K(i.componentType),E=o.byteStride||0,c={array:void 0,name:t,accessorName:e,byteLength:i.count*a*B.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:a};if(i.min&&(c.min=i.min),i.max&&(c.max=i.max),r)if(this.l)c.byteStride=E,c.byteOffset=s+(i.byteOffset||0),!E||E===a*B.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(c.array=this.h(r,i.count,a,s+(i.byteOffset||0),B),c.array.buffer.byteLength===c.byteLength&&(c.byteOffset=0)):c.array=new Uint8Array(r,s,o.byteLength);else if(i.interleaved){c.byteStride=0,c.byteOffset=0;const t=new B(i.count*a);c.array=W(t,r,i.count,a,E,s+(i.byteOffset||0),i.componentType)}else c.byteStride=0,c.array=this.h(r,i.count,a,s+(i.byteOffset||0),B),c.byteOffset=c.array.byteOffset;else{c.array=new B(i.count);const t=c.min||c.max;t&&(c.array[0]=t[0],c.array[1]=t[1],c.array[2]=t[2])}return c}u(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let r=0;r<t.length;r++)e!==r&&t[e].bufferView===t[r].bufferView&&(t[e].interleaved=t[r].interleaved=!0);else for(const e in t)for(const r in t)e!==r&&t[e].bufferView===t[r].bufferView&&(t[e].interleaved=t[r].interleaved=!0)}h(t,e,r,n,A){return n%A.BYTES_PER_ELEMENT!=0&&(t=t.slice(n,n+e*r*A.BYTES_PER_ELEMENT),n=0),new A(t,n,r*e)}T(t){const e=q.indexOf(t);return q[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,r=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:r}=e;return this.I(e).then((n=>{const{buffer:A,byteOffset:i}=n,o=j(A,i+(e.byteOffset||0),r);return t.content=o,t}))}if(t.uri){if(g(t.uri)){const e=V(t.uri),r=j(e,0,e.byteLength);return t.content=r,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return Y.get(e).then((e=>(t.content=e,t)))}}return Promise.resolve(t)}));return Promise.all(r).then((()=>t))}}class tt extends z{constructor(t,e,r,n,A,i){super(n,A,i),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=r,this.accessor=new $(t,e,r)}iterate(t,e){const r=this.gltf[e];if(!r)return;let n=0;for(const e in r)t(e,r[e],n++)}createNode(t){const e={};if(w(t.name)&&(e.name=t.name),w(t.children)&&(e.children=t.children),w(t.jointName)&&(e.jointName=t.jointName),w(t.matrix)&&(e.matrix=t.matrix),w(t.rotation)&&(e.rotation=t.rotation),w(t.scale)&&(e.scale=t.scale),w(t.translation)&&(e.translation=t.translation),w(t.extras)&&(e.extras=t.extras),w(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=s(X,e.translation||Z),n=B(J,e.rotation||x),A=a(v,e.scale||k);return o(A,n,A),o(t,r,A)}return i(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}F(t){const e={};for(const r in t){const n=t[r];let A,i;n.instanceTechnique&&n.instanceTechnique.values?(A=n.instanceTechnique,i=A.values.diffuse):(A=n,i=A.values.tex||A.values.diffuseTex||A.values.diffuse);const o={baseColorTexture:{index:i}};n.name&&(o.name=n.name),n.extensions&&(o.extensions=n.extensions),n.extras&&(o.extras=n.extras),e[r]=o}return e}P(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const r=this.gltf.bufferViews[e.bufferView],n=(r.byteOffset||0)+this.glbBuffer.byteOffset,A=r.byteLength,i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,n,A);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}L(t){const e=this.gltf.textures[t];if(!e)return null;const r=this.gltf.images[e.source];return this.P(r).then((t=>{const n=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extras:r.extras},sampler:n}}))}getBaseColorTexture(t){const e=this.gltf.materials[t];let r,n;if(e.instanceTechnique&&e.instanceTechnique.values?(r=e.instanceTechnique,n=r.values.diffuse):(r=e,n=r.values.tex||r.values.diffuseTex||r.values.diffuse),void 0===n||void 0===this.gltf.textures)return null;const A=this.gltf.textures[n];if(!A)return null;const i=this.gltf.samplers[A.sampler];return{format:A.format||6408,internalFormat:A.internalFormat||6408,type:A.type||5121,sampler:i,source:this.gltf.images[A.source]}}getMaterial(){return null}getAnimations(){return null}}class et extends z{constructor(t,e,r,n,A,i){super(n,A,i),this.rootPath=t,this.gltf=e,this.glbBuffer=r,this.buffers={},this.requests={},this.accessor=new $(t,e,r)}iterate(t,e){const r=this.gltf[e];if(r)for(let e=0;e<r.length;e++)t(e,r[e],e)}createNode(t){const e={};return H(e,t),!w(t.weights)&&this.gltf.meshes&&w(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}L(t){const e=this.gltf.textures[t];if(!e)return null;const r=this.gltf.images[e.source];return this.P(r).then((t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};H(n,e);const A=w(e.sampler)?this.gltf.samplers[e.sampler]:void 0;return A&&(n.sampler=A),t.format&&(n.format=t.format),n}))}P(t){if(!w(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],r=this.gltf.buffers[e.buffer];if(r.uri)return this.requestImageFromBufferURI(r,e,t);if(this.glbBuffer)return this.O(e,t)}return null}O(t,e){const r=this.B(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(r,e)}B(t,e,r){r=r||0;const n=t.byteOffset+r,A=t.byteLength;return new Uint8Array(e,n,A)}M(t,e){const r=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)r[e]=String.fromCharCode(t[e]);return r.join(""),"data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(r)))}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let r=0;r<e.length;r++)t[r].samplers=e[r];return t}))}getSamplers(t){const e=[];for(let r=0;r<t.length;r++)(w(t[r].input)||w(t[r].output))&&(e.push(this.accessor._("input",t[r].input)),e.push(this.accessor._("output",t[r].output)));return Promise.all(e).then((e=>{for(let r=0;r<e.length/2;r++)t[r].input=e[2*r],t[r].output=e[2*r+1],t[r].interpolation||(t[r].interpolation="LINEAR");return t}))}}const rt="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class nt{static read(t,e=0,r=0){r||(r=t.byteLength);const n=new DataView(t,e,r),A=n.getUint32(4,!0);if(1===A)return nt.readV1(n,e);if(2===A)return nt.readV2(t,e);throw new Error("Unsupported glb version : "+A)}static readV1(t,e){const r=t.getUint32(8,!0),n=t.getUint32(12,!0);if(r!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb\'s byte length.");const A=At(t.buffer,20+e,n);return{json:JSON.parse(A),glbBuffer:{byteOffset:20+e+n,buffer:t.buffer,byteLength:r}}}static readV2(t,e){let r,n,A;const i=new DataView(t,e+12);let o=0;for(;o<i.byteLength;){const s=i.getUint32(o,!0);o+=4;const a=i.getUint32(o,!0);if(o+=4,1313821514===a)r=At(t,e+12+o,s);else if(5130562===a){A=e+12+o,n=s;break}o+=s}return{json:JSON.parse(r),glbBuffer:{byteOffset:A,buffer:t,byteLength:n}}}}function At(t,e,r){if(rt){const n=new Uint8Array(t,e,r);return rt.decode(n)}return function(t){const e=t.length;let r="";for(let n=0;n<e;){let A=t[n++];if(128&A){let r=it[A>>3&7];if(!(64&A)||!r||n+r>e)return null;for(A&=63>>r;r>0;r-=1){const e=t[n++];if(128!=(192&e))return null;A=A<<6|63&e}}r+=String.fromCharCode(A)}return r}(new Uint8Array(t,e,r))}const it=[1,1,1,1,2,2,3,0],ot=[0,0,0],st=[0,0,0,1],at=[1,1,1],Bt={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},Et={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},ct={N(t,e,r,n,A,i,o,s){const a=w(t)?e.animations:[e.animations[0]],B={};for(let e=0;e<a.length;e++){const E=a[e],c=E.name||e;if(w(t)&&c!==t)continue;const C=E.channelsMap[r];if(C)for(let t=0;t<C.length;t++){const e=C[t];"translation"===e.target.path?(this.S(A,E.samplers[e.sampler],n,1),B.translation=l(ot,A)):"rotation"===e.target.path?(this.U(i,E.samplers[e.sampler],n,1),B.rotation=m(st,i)):"scale"===e.target.path?(this.S(o,E.samplers[e.sampler],n,1),B.scale=l(at,o)):"weights"===e.target.path&&s&&(this.S(s,E.samplers[e.sampler],n,s.length),B.weights=s)}}return B},S(t,e,r,n){switch(e.interpolation){case"LINEAR":{const A=this.G(Et,e,r,1*n);A&&(t=function(t,e,r,n){for(let A=0;A<t.length;A++)t[A]=e[A]+n*(r[A]-e[A]);return t}(t,A.PREVIOUS,A.NEXT,A.INTERPOLATION));break}case"STEP":{const A=this.G(Et,e,r,1*n);A&&(t=function(t,e){for(let r=0;r<t.length;r++)t[r]=e[r];return t}(t,...A.PREVIOUS));break}case"CUBICSPLINE":{const A=this.G(Et,e,r,3*n);A&&(t=this.m(t,A,e.input.array,3*n));break}}return t},U(t,e,r){switch(e.interpolation){case"LINEAR":{const n=this.G(Et,e,r,1);n&&U(t,n.PREVIOUS,n.NEXT,n.INTERPOLATION);break}case"STEP":{const n=this.G(Et,e,r,1);n&&(t=N(t,...n.PREVIOUS));break}case"CUBICSPLINE":{const n=this.G(Et,e,r,3);if(n){for(let t=0;t<n.PREVIOUS.length;t++)n.PREVIOUS[t]=Math.acos(n.PREVIOUS[t]),n.NEXT[t]=Math.acos(n.NEXT[t]);t=this.m(t,n,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},p(t,e){const r=t.length;let n,A,i,o=0,s=r-1,a=Math.floor((o+s)/2);for(;o<=r-1&&s>=0;){if(o===s)return null;if(t[a]<=e&&e<=t[a+1]){const r=t[a];return n=a,A=a+1,i=(e-r)/(t[a+1]-r),{preIndx:n,nextIndex:A,interpolation:i}}e<t[a]?(s=a,a=Math.floor((o+s)/2)):t[a+1]<e&&(o=a,a=Math.floor((o+s)/2))}return null},G(t,e,r,n){const A=e.input.array,i=e.output.array,o=e.output.itemSize;(r<A[0]||r>A[A.length-1])&&(r=Math.max(A[0],Math.min(A[A.length-1],r))),r===A[A.length-1]&&(r=A[0]);const s=this.p(A,r);if(!s||!s.nextIndex)return null;const{preIndx:a,nextIndex:B,interpolation:E}=s;t.PREINDEX=a,t.NEXTINDEX=B,t.INTERPOLATION=E;const c=o*n;return t.PREVIOUS=i.subarray(t.PREINDEX*c,(t.PREINDEX+1)*c),t.NEXT=i.subarray(t.NEXTINDEX*c,(t.NEXTINDEX+1)*c),t},m(t,e,r,n){const A=e.INTERPOLATION,i=r[e.PREINDEX],o=r[e.NEXTINDEX];for(let r=0;r<3;r++){const s=e.PREVIOUS[n+r],a=(o-i)*e.PREVIOUS[2*n+r],B=e.NEXT[3+r],E=(o-i)*e.NEXT[r],c=(2*Math.pow(A,3)-3*Math.pow(A,2)+1)*s+(Math.pow(A,3)-2*Math.pow(A,2)+A)*a+(2*-Math.pow(A,3)+3*Math.pow(A,2))*B+(Math.pow(A,3)-Math.pow(A,2))*E;t[r]=c}return t},getAnimationClip(t,e,r,n){const A=t.nodes[e]&&t.nodes[e].weights;return u(ot,...Bt.TRANSLATION),N(st,...Bt.ROTATION),u(at,...Bt.SCALE),this.N(n,t,e,r,ot,st,at,A)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,r)=>{let n=-1/0,A=1/0;const i=e.channels;for(let t=0;t<i.length;t++){const r=i[t],o=e.samplers[r.sampler].input.array;o[o.length-1]>n&&(n=o[o.length-1]),o[0]<A&&(A=o[0])}const o=e.name||r;t.timeSpan[o]={max:n,min:A}})),t.timeSpan},getTimeSpanByName(t,e){const r=this.getTimeSpan(t);return r?w(e)?r[e]:r[Object.keys(r)[0]]:null}};let Ct=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(Te){}t&&"undefined"!=typeof createImageBitmap&&(Ct=!0)}const ft="undefined"==typeof document?null:document.createElement("canvas");class lt{constructor(t,e,r){if(this.options=r||{},this.options.decoders||(this.options.decoders={}),e.buffer instanceof ArrayBuffer){const{json:r,glbBuffer:n}=nt.read(e.buffer,e.byteOffset,e.byteLength);this.H(t,r,n)}else this.H(t,e);this.K=new $(this.rootPath,this.gltf,this.glbBuffer),this.V()}V(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}X(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.K.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){t=t||{};const e=this.J(t),r=this.v(),n=this.Z(),A=this.X();return Promise.all([e,r,n,A]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const r=e[t];r.channelsMap={};for(let t=0;t<r.channels.length;t++){const e=r.channels[t];r.channelsMap[e.target.node]||(r.channelsMap[e.target.node]=[]),r.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:r}=this.gltf;for(let r=0;r<e.length;r++)e[r].uri&&e[r].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[r].uri});for(let e=0;e<r.length;e++)r[e].uri&&r[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:r[e].uri})}return t}static getAnimationClip(t,e,r,n){return ct.getAnimationClip(t,e,r,n)}static getAnimationTimeSpan(t,e){return ct.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return K(t)}static readInterleavedArray(t,e,r,n,A,i,o){return W(t,e,r,n,A,i,o)}H(t,e,r){this.gltf=e,this.glbBuffer=r,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=Ct?Rt.bind(this):this.options.requestImage||ut,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new et(t,e,r,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((t,e,r)=>{e.id="buffer_"+r}),"buffers"),this.adapter.iterate(((t,e,r)=>{e.id="image_"+r}),"images"),this.adapter.iterate(((t,e,r)=>{e.id="accessor_"+r}),"accessors")):(this.adapter=new tt(t,e,r,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate(((t,e,r)=>{e.id="accessor_"+r}),"accessors"),this.adapter.iterate(((t,e,r)=>{e.id="image_"+r}),"images"))}k(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(r=t.children[0])&&isFinite(r)||function(t){return!p(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}(t.children[0])))return t;const n=t.children.map((t=>{const r=e[t];return r.nodeIndex=t,this.k(r,e)}));t.children=n}var r;return t}J(t){return this.W(t).then((t=>{const e=this.scenes=[];let r;for(const e in t)t[e]=this.k(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate(((n,A,i)=>{const o={};A.name&&(o.name=A.name),A.nodes&&(o.nodes=A.nodes.map((e=>t[e]))),this.gltf.scene===n&&(r=i),e.push(o)}),"scenes");const n={asset:this.gltf.asset,scene:r,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins};if(this.gltf.extensions&&(n.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.F(this.gltf.materials);n.materials=t}return n}))}W(t){return this.j(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,r)=>{const n=this.adapter.createNode(r,this.meshes,this.skins);t[e]=n}),"nodes"),t}))}Y(){this.skins=[];const t=[];return this.adapter.iterate(((e,r,n)=>{t.push(this.q(r).then((t=>{t.index=n,this.skins.push(t)})))}),"skins"),t}q(t){const e=t.inverseBindMatrices;return this.adapter.accessor._("inverseBindMatrices",e).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}v(){const t=this.gltf.animations;return w(t)?this.adapter.getAnimations(t):null}j(t){this.meshes={};let e=[];return this.adapter.iterate(((r,n,A)=>{e.push(this.$(n,t).then((t=>{t.index=A,this.meshes[r]=t})))}),"meshes"),e=e.concat(this.Y()),Promise.all(e)}$(t,e){const r=t.primitives.map((t=>this.tt(t,e))).filter((t=>!!t));return Promise.all(r).then((e=>{const r={};return H(r,t),r.primitives=e,r}))}Z(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const r in t)e.push(this.adapter.L(r));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const r=e[t].image.array;if(e[t]&&r){let t;t=r instanceof ImageBitmap?r:r.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const r={},n=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(r[n[t]]=e[t]);return r}return e}))}tt(t,e){let r;const n=[],A=t.extensions;if(w(t.targets))for(let e=0;e<t.targets.length;e++){const r=t.targets[e];for(const t in r){const A=this.adapter.accessor._(`morphTargets_${t}_${e}`,r[t]);A&&n.push(A)}}if(A&&A.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:i,attributes:o}=A.KHR_draco_mesh_compression,s=this.gltf.bufferViews[i],a=this.K.I(s).then((r=>{const{buffer:n,byteOffset:A}=r;let{byteOffset:i,byteLength:a}=s;i||(i=0);const B=new DataView(n,A+i,a),E={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(B,E).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));n.push(a),r=Promise.all(n)}else{const e=t.attributes;for(const t in e){const r=this.adapter.accessor._(t,e[t]);r&&n.push(r)}if(w(t.indices)){const e=this.adapter.accessor._("indices",t.indices);e&&n.push(e)}r=Promise.all(n)}return r.then((e=>{if(A&&A.KHR_draco_mesh_compression){const r=t.targets?t.targets.length:0;e[r]=e[r].concat(e.slice(0,r)),e=e[r]}let r,n;const i={attributes:e.reduce(((t,e)=>{if("indices"===e.name)r=e;else if(e.name.indexOf("morphTargets_")>-1)n=n||{},n[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0],{itemSize:n,array:A}=e,i=A.length/n;for(let e=0;e<i;e++)for(let i=0;i<n;i++){const o=e*n+i;A[o]<t[i]&&(t[i]=A[o]),A[o]>r[i]&&(r[i]=A[o])}if(e.quantization){const n=e.quantization,A=n.range/(1<<n.quantizationBits),i=n.minValues;I(t,t,A),_(t,t,i),I(r,r,A),_(r,r,i)}e.min=t,e.max=r}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return r&&(i.indices=r),n&&(i.morphTargets=n),i.mode=w(t.mode)?t.mode:4,w(t.extras)&&(i.extras=t.extras),i}))}}function ut(t,e){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!ft)return void e(new Error("There is no canvas to draw image!"));ft.width=r.width,ft.height=r.height;const t=ft.getContext("2d",{willReadFrequently:!0});t.drawImage(r,0,0,r.width,r.height);const n=t.getImageData(0,0,r.width,r.height),A={width:r.width,height:r.height,data:new Uint8Array(n.data)};e(null,A)},r.onerror=function(t){e(t)},r.src=t}let _t,Dt;function Rt(t,e){_t||(_t=new OffscreenCanvas(2,2),Dt=_t.getContext("2d",{willReadFrequently:!0})),fetch(t).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then((t=>{let{width:r,height:n}=t;It(r)||(r=Tt(r)),It(n)||(n=Tt(n));const A=this.options.maxTextureSize;A&&(r=Math.min(A,r),n=Math.min(A,n)),_t.width=r,_t.height=n,Dt.drawImage(t,0,0,r,n),t.close();const i=Dt.getImageData(0,0,r,n);e(null,{width:r,height:n,data:new Uint8Array(i.data)})})).catch((t=>{console.warn(t),e(t)}))}function It(t){return 0==(t&t-1)&&0!==t}function Tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function ht(t){return"object"==typeof t&&!!t}function Ft(t){return t*Math.PI/180}function Pt(t){return t/Math.PI*180}function Lt(t){return Math.sign?Math.sign(t):0===(t=+t)||isNaN(t)?Number(t):t>0?1:-1}const Ot=[1,1,1,1,2,2,3,0];function yt(t){const e=t.length;let r="";for(let n=0;n<e;){let A=t[n++];if(128&A){let r=Ot[A>>3&7];if(!(64&A)||!r||n+r>e)return null;for(A&=63>>r;r>0;r-=1){const e=t[n++];if(128!=(192&e))return null;A=A<<6|63&e}}r+=String.fromCharCode(A)}return r}const Mt=new Array(3),Nt=new Array(3),St=[40680631590769,40680631590769,40408299984661.445];const dt=[1/6378137,1/6378137,1/6356752.314245179],Ut=[1/40680631590769,1/40680631590769,1/40408299984661.445],Gt=new Array(3),mt=new Array(3),bt=new Array(3);function pt(t,e){const r=Ut,n=function(t,e,r,n,A){const i=e[0],o=e[1],s=e[2],a=r[0],B=r[1],E=r[2],c=i*i*a*a,C=o*o*B*B,f=s*s*E*E,l=c+C+f,u=Math.sqrt(1/l),_=I(wt,e,u);if(l<A)return isFinite(u)?_:void 0;const D=n[0],R=n[1],T=n[2],h=Ht;h[0]=_[0]*D*2,h[1]=_[1]*R*2,h[2]=_[2]*T*2;let F,P,L,O,y,M,N,S,d,U,G,m=(1-u)*gt(e)/(.5*gt(h)),b=0;do{m-=b,L=1/(1+m*D),O=1/(1+m*R),y=1/(1+m*T),M=L*L,N=O*O,S=y*y,d=M*L,U=N*O,G=S*y,F=c*M+C*N+f*S-1,P=c*d*D+C*U*R+f*G*T;b=F/(-2*P)}while(Math.abs(F)>Kt);return t[0]=i*L,t[1]=o*O,t[2]=s*y,t}(Gt,e,dt,r,.1);let A=y(mt,n,r);A=Vt(A,A);const i=O(bt,e,n),o=Math.atan2(A[1],A[0]),s=Math.asin(A[2]),a=Lt(F(i,e))*gt(i);return t[0]=Pt(o),t[1]=Pt(s),t[2]=a,t}const wt=new Array(3),Ht=new Array(3),Kt=1e-12;function gt(t){return C(t)}function Vt(t,e){const r=e[0],n=e[1],A=e[2];let i=r*r+n*n+A*A;return i>0&&(i=Math.sqrt(i),t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i),t}const Xt=1e-14;function Jt(t,e,r,n){r=r||0,n=n||r;var A=Math.abs(t-e);return A<=n||A<=r*Math.max(Math.abs(t),Math.abs(e))}function vt(t,e){let r="";for(let n=0;n<4;n++){const A=t.getUint8(e+n);r+=String.fromCharCode(A)}return r}const Zt="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function xt(t,e,r){const n=new Uint8Array(t,e,r);return Zt?JSON.parse(Zt.decode(n)):JSON.parse(yt(n))}function kt(t,e,r){const n=new Uint8Array(t,e,r);return Zt?JSON.parse(Zt.decode(n)):JSON.parse(yt(n))}function Wt(t,e,r){return{offset:e,byteLength:r}}function Qt(t,e,r,n){const{byteOffset:A,componentType:i,type:o}=t,{ctor:s,type:a}=function(t){return zt[t]}(i||"UNSIGNED_SHORT"),B=function(t){if(!t)return 1;return Yt[t]}(o);return{byteStride:0,byteOffset:A+r,itemSize:B,count:n*B,componentType:a,array:new s(e,r+A,n*B)}}function jt(t,e,r,n){const A=Qt(t,e,r,n);return A.array.buffer.byteLength!==e.byteLength&&(A.array=A.array.slice()),A}const Yt={"SCALAR":1,"VEC2":2,"VEC3":3,"VEC4":4};const zt={"BYTE":{ctor:Int8Array,type:5120,name:"Int8Array"},"UNSIGNED_BYTE":{ctor:Uint8Array,type:5121,name:"Uint8Array"},"SHORT":{ctor:Int16Array,type:5122,name:"Int16Array"},"UNSIGNED_SHORT":{ctor:Uint16Array,type:5123,name:"Uint16Array"},"INT":{ctor:Int32Array,type:5124,name:"Int32Array"},"UNSIGNED_INT":{ctor:Uint32Array,type:5125,name:"Uint32Array"},"FLOAT":{ctor:Float32Array,type:5126,name:"Float32Array"},"DOUBLE":{ctor:Float64Array,type:5126,name:"Float64Array"}};function qt(t){for(let e in zt)if(t===zt[e].ctor)return zt[e].type;throw new Error("unrecognized ctor:"+t)}function $t(t,e,r,n){const A=t,i=e.length/3;for(let t=0;t<i;t++)A[3*t]=e[3*t]/65535*n[0]+r[0],A[3*t+1]=e[3*t+1]/65535*n[1]+r[1],A[3*t+2]=e[3*t+2]/65535*n[2]+r[2];return A}function te(t,e,r){let n=t.getUint32(12,!0),A=t.getUint32(16,!0),i=t.getUint32(20,!0),o=t.getUint32(24,!0);const s=t.buffer;let a,B,E={},c={};n>0&&(E=xt(s,e,n),e+=n),A>0&&(a=function(t,e,r){return{offset:e,byteLength:r}}(0,e,A),e+=A),i>0&&(c=kt(s,e,i),e+=i);const C=Wt(0,e,o);return B=s.slice(C.offset,C.offset+C.byteLength),r.push(B),{featureTable:E,featureTableBin:a,batchTable:c,batchTableBin:B}}var ee={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},re={},ne={east:[],north:[],up:[],west:[],south:[],down:[]},Ae=[],ie=[],oe=[];const se=[0,0,0];const ae=(Ce={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}}[Be="east"][Ee="north"],re[fe=Be+Ee]?ce=re[fe]:(ce=function(t,r,n){if(function(t,r){var n=t[0],A=t[1],i=t[2],o=r[0],s=r[1],a=r[2];return Math.abs(n-o)<=e*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(A-s)<=e*Math.max(1,Math.abs(A),Math.abs(s))&&Math.abs(i-a)<=e*Math.max(1,Math.abs(i),Math.abs(a))}(t,se))l(Ae,ee[Be]),l(ie,ee[Ee]),l(oe,ee[Ce]);else if(Jt(t[0],0,Xt)&&Jt(t[1],0,Xt)){var A=Lt(t[2]);l(Ae,ee[Be]),"east"!==Be&&"west"!==Be&&I(Ae,Ae,A),l(ie,ee[Ee]),"east"!==Ee&&"west"!==Ee&&I(ie,ie,A),l(oe,ee[Ce]),"east"!==Ce&&"west"!==Ce&&I(oe,oe,A)}else{!function(t,e){R(e,t,Ut),h(e,e)}(t,ne.up);var i=ne.up,o=ne.east;o[0]=-t[1],o[1]=t[0],o[2]=0,h(ne.east,o),P(ne.north,i,o),I(ne.down,ne.up,-1),I(ne.west,ne.east,-1),I(ne.south,ne.north,-1),Ae=ne[Be],ie=ne[Ee],oe=ne[Ce]}return n[0]=Ae[0],n[1]=Ae[1],n[2]=Ae[2],n[3]=0,n[4]=ie[0],n[5]=ie[1],n[6]=ie[2],n[7]=0,n[8]=oe[0],n[9]=oe[1],n[10]=oe[2],n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},re[fe]=ce),ce);var Be,Ee,ce,Ce,fe;const le={5120:Int8Array,5122:Int16Array,5124:Int32Array,5121:Uint8Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ue(t){return le[t]}function _e(t){for(let e in le)if(t===le[e])return+e;throw new Error("unrecognized ctor:"+t)}function De(t){return 1===t?"FLOAT":"VEC"+t}\n/*!\n   * @maptalks/gl v0.81.2\n   * LICENSE : UNLICENSED\n   * (c) 2016-2023 maptalks.com\n   */const Re=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},Ie=Re(),Te=Ie.gl_trans__coders=Ie.gl_trans__coders||{};Te.inject=function(t){const e=t.toString(),r=e.indexOf("{")+1,n=e.substring(0,r),A=Ie.gl_trans__coders=Ie.gl_trans__coders||{};let i=`${n}\\n    const _____getGlobal = ${Re.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals[\'gl_trans__coders\'] = g___lobals[\'gl_trans__coders\'] || {};`;for(const t in A)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(i+=\'tran_____scoders["\'+t+\'"] =\'+A[t].toString()+"\\n;");return i+="\\n"+e.substring(n.length),i},Te.registerTranscoder=function(t,e){Te[t]=e},Te.getTranscoder=function(t){return Te[t]};let he=null;function Fe(){return he||(he={"image/crn":Te.crn&&Te.crn(),"image/ktx2":Te.ktx2&&Te.ktx2(),"image/cttf":Te.ktx2&&Te.ktx2(),"draco":Te.draco&&Te.draco()}),he}class Pe{constructor(t,e,r){this.A=t,this.et=e||lt,this.i=r,this.rt=Fe()}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,r=0,n=0,A){return e?(n||(n=e.byteLength),this.nt(t,e,r,n,A)):Y.getArrayBuffer(t,{}).then((e=>{const A=e.data;return n||(n=A.byteLength),this.nt(t,A,r,n)}))}nt(t,e,r,n,A){const i=A&&A.maxTextureSize,o=this.At(e,r,n,t);if(o.error)return Promise.resolve(o);const s=t.substring(0,t.lastIndexOf("/")),a=new this.et(s,o.glb,{transferable:!0,requestImage:this.A,decoders:this.rt,supportedFormats:this.i,maxTextureSize:i});return a.load({skipAttributeTransform:!1}).then((e=>{e.url=`${t}-${r}-${n}`;const A=a.transferables;for(let t=0;t<o.transferables.length;t++)A.indexOf(o.transferables[t])<0&&A.push(o.transferables[t]);return{magic:"b3dm",count:o.count,transferables:A,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,gltf:e}}))}At(t,e,r,n){const A=new DataView(t,e,r),i=A.getUint32(4,!0);if(1!==i){const t="Unsupported b3dm version: "+i+", url:"+n;return console.warn(t),{error:t}}if(A.getUint32(8,!0)!==A.byteLength){const t="Length in b3dm header is inconsistent with b3dm\'s byte length, url: "+n;return console.warn(t),{error:t}}let o,s=A.getUint32(12,!0),a=A.getUint32(16,!0),B=A.getUint32(20,!0),E=A.getUint32(24,!0),c=28+e;B>=570425344?(c-=8,o=s,B=a,E=0,s=0,a=0):E>=570425344&&(c-=4,o=B,B=s,E=a,s=0,a=0);const C=[t];let f,l,u;if(s>0?(f=xt(t,c,s),c+=s,o=f.BATCH_LENGTH):f={"BATCH_LENGTH":o},a>0&&(c+=a),B>0&&(l=kt(t,c,B),c+=B,E>0)){const e=Wt(0,c,E);u=t.slice(e.offset,e.offset+e.byteLength),c+=E,C.push(u)}const _=f.BATCH_LENGTH,D={};if(f&&f.BATCH_ID){D.BATCH_ID=jt(f.BATCH_ID,t,undefined.offset,_);const e=D.BATCH_ID.array&&D.BATCH_ID.array.buffer;e&&C.indexOf(e)<0&&C.push(e)}return{count:o,transferables:C,featureTable:f,batchTable:l,batchTableBin:u,b3dm:D,glb:{buffer:t,byteOffset:c,byteLength:A.byteLength+A.byteOffset-c}}}it(){return null}}class Le{constructor(t,e,r,n){this.A=t,this.et=e||lt,this.i=r,this.rt=Fe(),this.ot=n}load(t,e,r=0,n=0,A){return e?(n||(n=e.byteLength),this.nt(t,e,r,n,A)):Y.getArrayBuffer(t,{}).then((e=>{const A=e.data;return n||(n=A.byteLength),this.nt(t,A,r,n)}))}nt(t,e,r,n,A){return this.st(t,e,r,n,A).then((({gltf:A,transferables:i})=>{const o=this.Bt(e,r,n,t);if(o.error)return Promise.resolve(o);for(let t=0;t<i.length;t++)-1===o.transferables.indexOf(i[t])&&o.transferables.push(i[t]);return delete A.transferables,Promise.resolve({magic:"i3dm",count:o.count,transferables:o.transferables,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,i3dm:o.i3dm,gltf:A})}))}st(t,e,r,n,A){const i=A&&A.maxTextureSize,o={transferable:!0,requestImage:this.A,decoders:this.rt,supportedFormats:this.i,maxTextureSize:i},s=new DataView(e,r,n),a=32+s.getUint32(12,!0)+s.getUint32(16,!0)+s.getUint32(20,!0)+s.getUint32(24,!0);if(0===s.getUint32(28,!0)){let n=yt(new Uint8Array(e,a+r,s.byteLength-a));-1==n.indexOf("://")&&(n=t.substring(0,t.lastIndexOf("/"))+"/"+n);return n.indexOf(".glb")>0?Y.getArrayBuffer(n,{}).then((t=>this.Et(n,{buffer:t.data,byteOffset:0},o))):Y.getJSON(n,{}).then((t=>this.Et(n,t,o)))}{const n={buffer:e,byteOffset:a+r,byteLength:s.byteLength-a};return this.Et(t,n,o)}}Et(t,e,r){const n=t.substring(0,t.lastIndexOf("/")),A=new this.et(n,e,r);return A.load({skipAttributeTransform:!0}).then((r=>{let n=0,i=0;return e.buffer&&(n=e.byteOffset||0,i=e.byteLength||0),r.url=`${t}-${n}-${i}`,{transferables:A.transferables,gltf:r}}))}Bt(t,e,r,n){const A=new DataView(t,e,r),i=A.getUint32(4,!0);if(1!==i){const t="Unsupported pnts version: "+i+", url:"+n;return console.warn(t),{error:t}}if(A.getUint32(8,!0)!==A.byteLength){const t="Length in pnts header is inconsistent with pnts\'s byte length, url: "+n;return console.warn(t),{error:t}}const o=[t],{featureTable:s,featureTableBin:a,batchTable:B,batchTableBin:E}=te(A,32+e,o),c={},C=s.INSTANCES_LENGTH;if(s.POSITION){const{byteOffset:e}=s.POSITION;c.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:C,componentType:5126,array:new Float32Array(t,e+a.offset,3*C).slice()},o.push(c.POSITION.array.buffer)}else if(s.POSITION_QUANTIZED){const e=s.QUANTIZED_VOLUME_OFFSET,r=s.QUANTIZED_VOLUME_SCALE,{byteOffset:n}=s.POSITION_QUANTIZED;c.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:C,componentType:5126,array:this.ct(new Uint16Array(t,n+a.offset,3*C),e,r)},o.push(c.POSITION.array.buffer)}if(s.BATCH_ID){c.BATCH_ID=jt(s.BATCH_ID,t,a.offset,C);const e=c.BATCH_ID.array&&c.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}if(s.NORMAL_UP){let{byteOffset:e}=s.NORMAL_UP;c.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:C,componentType:5126,array:new Float32Array(t,e+a.offset,3*C).slice()},o.push(c.NORMAL_UP.array.buffer),e=s.NORMAL_RIGHT.byteOffset,c.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:C,componentType:5126,array:new Float32Array(t,e+a.offset,3*C).slice()},o.push(c.NORMAL_RIGHT.array.buffer)}else if(s.NORMAL_UP_OCT32P){let{byteOffset:e}=s.NORMAL_UP_OCT32P;c.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:C,componentType:5126,array:this.Ct(new Uint16Array(t,e+a.offset,2*C))},o.push(c.NORMAL_UP.array.buffer),e=s.NORMAL_RIGHT_OCT32P.byteOffset,c.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:C,componentType:5126,array:this.Ct(new Uint16Array(t,e+a.offset,2*C))},o.push(c.NORMAL_RIGHT.array.buffer)}if(s.SCALE){const{byteOffset:e}=s.SCALE;c.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:C,componentType:5126,array:new Float32Array(t,e+a.offset,C).slice()},o.push(c.SCALE.array.buffer)}else if(s.SCALE_NON_UNIFORM){const{byteOffset:e}=s.SCALE_NON_UNIFORM;c.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:C,componentType:5126,array:new Float32Array(t,e+a.offset,3*C).slice()},o.push(c.SCALE_NON_UNIFORM.array.buffer)}return{count:C,batchTable:B,batchTableBin:E,featureTable:s,i3dm:c,transferables:o}}Ct(t){const e=t.length/2,r=new Float32Array(3*e),n=[];for(let A=0;A<e;A++)Oe(n,t[2*A],t[2*A+1],65535),r[3*A]=n[0],r[3*A+1]=n[1],r[3*A+2]=n[2];return r}ct(t,e,r){return $t(new Float32Array(t.length),t,e,r)}it(){return null}}function Oe(t,e,r,n){if(t[0]=ye(e,n),t[1]=ye(r,n),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*Me(e),t[1]=(1-Math.abs(e))*Me(t[1])}return h(t,t)}function ye(t,e){return e=function(t,e){if(null!=t)return t;return e}(e,255),function(t,e,r){return t<e?e:t>r?r:t}(t,0,e)/e*2-1}function Me(t){return t<0?-1:1}class Ne{constructor(){}load(t,e,r=0,n=0){return e?(n||(n=e.byteLength),this.nt(t,e,r,n)):Y.getArrayBuffer(t,{}).then((e=>{const A=e.data;return n||(n=A.byteLength),this.nt(t,A,r,n)}))}nt(t,e,r,n){return this.ft(e,r,n,t).then((t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts}))}ft(t,e,r,n){const A=new DataView(t,e,r),i=A.getUint32(4,!0);if(1!==i){const t="Unsupported pnts version: "+i+", url:"+n;return console.warn(t),{error:t}}if(A.getUint32(8,!0)!==A.byteLength){const t="Length in pnts header is inconsistent with pnts\'s byte length, url: "+n;return console.warn(t),{error:t}}const o=[t],{featureTable:s,featureTableBin:a,batchTable:B,batchTableBin:E}=te(A,e+28,o),c=s.QUANTIZED_VOLUME_OFFSET,C=s.QUANTIZED_VOLUME_SCALE,f=s.POINTS_LENGTH;let l,u={};if(s.extensions&&s.extensions["3DTILES_draco_point_compression"]){u=s.extensions["3DTILES_draco_point_compression"],l=new DataView(t,u.byteOffset+a.offset,u.byteLength);const e={attributes:u.properties,useUniqueIDs:!1};return this.lt||(this.lt=Fe().draco),this.lt(l,e).then((e=>{const r=e.attributes;!s.POSITION&&!s.POSITION_QUANTIZED||r.POSITION||r.POSITION_QUANTIZED||(r.POSITION=s.POSITION,r.POSITION_QUANTIZED=s.POSITION_QUANTIZED),!(s.RGB||s.RGBA||s.RGB565)||r.RGB||r.RGBA||r.RGB565||(r.RGB=s.RGB,r.RGBA=s.RGBA,r.RGB565=s.RGB565),!s.NORMAL&&!s.NORMAL_OCT16P||r.NORMAL||r.NORMAL_OCT16P||(r.NORMAL=s.NORMAL,r.NORMAL_OCT16P=s.NORMAL_OCT16P);const n=this.ut(t,e.attributes,a.offset,f,o,c,C);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;n.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:qt(t.constructor),array:t},o.push(t.buffer)}else if(s.BATCH_ID||Object.keys(B).length){s.BATCH_ID?n.BATCH_ID=jt(s.BATCH_ID,t,a.offset,f):n.BATCH_ID=Se(f);const e=n.BATCH_ID.array&&n.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return{count:f,batchTable:B,batchTableBin:E,featureTable:s,pnts:n,transferables:o}}))}const _=this.ut(t,s,a.offset,f,o,c,C);if(s.BATCH_ID||Object.keys(B).length){s.BATCH_ID?_.BATCH_ID=jt(s.BATCH_ID,t,a.offset,f):_.BATCH_ID=Se(f);const e=_.BATCH_ID.array&&_.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return Promise.resolve({count:f,batchTable:B,batchTableBin:E,featureTable:s,pnts:_,transferables:o})}ut(t,e,r,n,A,i,o){const s={};if(e.POSITION){let{byteOffset:i,array:o}=e.POSITION;i=i||0;const a=o?0:r;if(!o){const e=t.slice(i+a,i+a+3*n*4);o=new Float32Array(e)}s.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:o},A.push(o.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:a,array:B}=e.POSITION_QUANTIZED;a=a||0;const E=B?0:r;s.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:this.ct(B||new Uint16Array(t,a+E,3*n),i,o)},A.push(s.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:i,array:o}=e.RGBA;i=i||0;const a=o?0:r;if(!o){const e=t.slice(i+a,i+a+4*n);o=new Uint8Array(e)}s.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:n,componentType:5121,array:o},A.push(o.buffer)}else if(e.RGB){let{byteOffset:i,array:o}=e.RGB;i=i||0;const a=o?0:r;if(!o){const e=t.slice(i+a,i+a+3*n);o=new Uint8Array(e)}s.RGB={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5121,array:o},A.push(o.buffer)}else if(e.RGB565){let{byteOffset:i,array:o}=e.RGB565;i=i||0;const a=o?0:r;if(!o){const e=t.slice(i+a,i+a+2*n);o=new Uint16Array(e)}s.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:n,componentType:5123,array:o},A.push(o.buffer)}if(e.NORMAL){let{byteOffset:i,array:o}=e.NORMAL;i=i||0;const a=o?0:r;if(!o){const e=t.slice(i+a,i+a+3*n*4);o=new Float32Array(e)}s.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:o},A.push(o.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:i,array:o}=e.NORMAL_OCT16P;i=i||0;const a=o?0:r;if(!o){const e=t.slice(i+a,i+a+2*n);o=new Uint8Array(e)}s.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:n,componentType:5121,array:o},A.push(o.buffer)}return s}ct(t,e,r){return $t(new Float32Array(t.length),t,e,r)}it(){return null}}function Se(t){const e=(r=t)<256?Uint8Array:r<65536?Uint16Array:Uint32Array;var r;const n=new e(t);for(let e=0;e<t;e++)n[e]=e;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:qt(e),array:n}}class de{constructor(t,e,r,n){this.i=r,this.A=t,this.et=e||lt,this.ot=n}load(t,e,r=0,n=0,A){return e?this.nt(t,e,r,n,A):Y.getArrayBuffer(t,{}).then((e=>{const A=e.data;return this.nt(t,A,r,n)}))}nt(t,e,r,n,A){n||(n=e.byteLength);const i=this._t(e,t,r,n),o=[];for(let r=0;r<i.length;r++){let n;if("b3dm"===i[r].magic)n=new Pe(this.A,this.et,this.i);else if("i3dm"===i[r].magic)n=new Le(this.A,this.et,this.i,this.ot);else if("pnts"===i[r].magic)n=new Ne;else{if("cmpt"!==i[r].magic){console.warn("Unsupported magic in CMPT tile:",i[r].magic);continue}n=new de(this.A,this.et,this.i,this.ot)}o.push(n.load(t,e,i[r].offset,i[r].byteLength,A).then((t=>t)))}return Promise.all(o).then((t=>({magic:"cmpt",tiles:t})))}_t(t,e,r,n){const A=new DataView(t,r,n),i=A.getUint32(4,!0);if(1!==i){const t="Unsupported cmpt version: "+i+", url:"+e;return console.warn(t),{error:t}}if(16===A.byteLength)return[];const o=[],s=A.getUint32(12,!0);let a=16;for(let e=0;e<s;e++){const e=vt(A,a),n=A.getUint32(a+8,!0);o.push({magic:e,buffer:t,offset:a+r,byteLength:n}),a+=n}return o}}function Ue(t,e){if(t.scenes&&t.scenes.length)for(let r=0,n=t.scenes.length;r<n;r++){const n=t.scenes[r].nodes;for(let r=0,A=n.length;r<A;r++){const A=[];Ke(n[r],A,t,e)}}}const Ge=[],me=[],be=[],pe=[0,0,0],we=d([]),He=[1,1,1];function Ke(t,e,r,n){const A=e.slice(0);if(t.matrix)A.push(t.matrix);else if(t.rotation||t.translation||t.scale){const e=s(Ge,t.translation||pe),r=B(me,t.rotation||we),n=a(be,t.scale||He);o(n,r,n);const i=o([],e,n);A.push(i)}if(t.children&&t.children.length)for(let e=0,i=t.children.length;e<i;e++)Ke(t.children[e],A,r,n);if(void 0!==t.mesh){const e=t.mesh,i=r.meshes[e];if(i){const t=A.slice(0),o=i.primitives;for(let A=0,i=o.length;A<i;A++){const i=o[A];i&&(i.matrices=t,n(i,e,A,r))}}}}function ge(t,e){let{componentType:r,byteOffset:n,byteStride:A,count:i,itemSize:o}=t;const s=t.array.buffer,a=r?lt.getTypedArrayCtor(r):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,A=A||0,i=i||t.array.length/o,(!A||A===o*a.BYTES_PER_ELEMENT)&&n%a.BYTES_PER_ELEMENT==0){const t=new a(s,n,i*o);for(let r=0;r<i*o;r+=o){e(new a(t.buffer,n+r*a.BYTES_PER_ELEMENT,o),r/o)}return}const B=new Uint8Array(o*a.BYTES_PER_ELEMENT);A||(A=o*a.BYTES_PER_ELEMENT);for(let t=0;t<i;t++){const r=new Uint8Array(s,A*t+n,o*a.BYTES_PER_ELEMENT);B.set(r);e(new a(B.buffer),t),r.set(B)}}const Ve=[],Xe=[];function Je(t){"3.0"===t.version&&(t=function(t){const e=JSON.parse(JSON.stringify(t)),r=e.rootTiles;for(let t=0;t<r.length;t++){const{boundingbox:e}=r[t],{center:n,xExtent:A,yExtent:i,zExtent:o}=e,s={x:2*n.x-A.x,y:2*n.y-i.y,z:2*n.z-o.z},a={x:A.x,y:i.y,z:o.z};e.min=s,e.max=a}return e.tiles=r,e}(t));const e={asset:{version:"1.0",gltfUpAxis:"Z",s3mType:t.dataType},extensions:t.extensions,geometricError:0,root:{boundingVolume:{},content:{uri:""},transform:[],geometricError:0,refine:"REPLACE",children:[]}},r=t.position.x,n=t.position.y,i=t.position.z,o=function(t,e,r,n){const A=St,i=Math.cos(r);Mt[0]=i*Math.cos(e),Mt[1]=i*Math.sin(e),Mt[2]=Math.sin(r),Vt(Mt,Mt),R(Nt,A,Mt);const o=Math.sqrt(F(Mt,Nt));var s,a,B;return a=Nt,B=o,(s=Nt)[0]=a[0]/B,s[1]=a[1]/B,s[2]=a[2]/B,I(Mt,Mt,n),_(t,Nt,Mt)}([],Ft(r),Ft(n),i),s=ae(o,null,[]);e.root.transform=A([],s);const a=[];for(let r=0,n=t.tiles.length;r<n;r++)if(t.tiles[r].boundingbox){const n=t.tiles[r].boundingbox;u(Ve,n.min.x,n.min.y,n.min.z),u(Xe,n.max.x,n.max.y,n.max.z);const A={center:[0,0,0],radius:0};ve(Ve,Xe,A),e.root.children.push({boundingVolume:{sphere:[...A.center,A.radius]},content:{uri:t.tiles[r].url},geometricError:70,refine:"REPLACE"}),a.push(A)}else if(t.tiles[r].boundingsphere){const{boundingsphere:n}=t.tiles[r],A={center:[n.center.x,n.center.y,n.center.z],radius:n.radius};e.root.children.push({boundingVolume:{sphere:[...A.center,A.radius]},content:{uri:t.tiles[r].url},geometricError:70,refine:"REPLACE"}),a.push(A)}const B=function(t,e){if(0===t.length)return e;const r=t.length;if(1===r)return function(t,e){return l(e.center,t.center),e.radius=t.radius,e}(t[0],e);if(2===r)return function(t,e,r){const n=t.center,A=t.radius,i=e.center,o=e.radius,s=D(xe,i,n),a=or(s);if(A>=a+o)return t.clone(r),r;if(o>=a+A)return e.clone(r),r;const B=.5*(A+a+o),E=I(ke,s,(-A+B)/a);return _(E,E,n),l(r.center,E),r.radius=B,r}(t[0],t[1],e);const n=[];for(let e=0;e<r;e++)n.push(t[e].center);const A=(e=function(t,e){if(0===t.length)return e.center=u(e.center,0,0,0),e.radius=0,e;const r=l($e,t[0]),n=l(We,r),A=l(Qe,r),i=l(je,r),o=l(Ye,r),s=l(ze,r),a=l(qe,r),B=t.length;for(let e=1;e<B;e++){l(r,t[e]);const B=r[0],E=r[1],c=r[2];B<n[0]&&l(n,r),B>o[0]&&l(o,r),E<A[1]&&l(A,r),E>s[1]&&l(s,r),c<i[2]&&l(i,r),c>a[2]&&l(a,r)}const E=ir(D(tr,o,n)),c=ir(D(tr,s,A)),C=ir(D(tr,a,i));let f=n,_=o,R=E;c>R&&(R=c,f=A,_=s);C>R&&(R=C,f=i,_=a);const I=er;I[0]=.5*(f[0]+_[0]),I[1]=.5*(f[1]+_[1]),I[2]=.5*(f[2]+_[2]);let T=ir(D(tr,_,I)),h=Math.sqrt(T);const F=rr;F[0]=n[0],F[1]=A[1],F[2]=i[2];const P=nr;P[0]=o[0],P[1]=s[1],P[2]=a[2];const L=Ze(F,P,Ar);let O=0;for(let e=0;e<B;e++){l(r,t[e]);const n=or(D(tr,r,L));n>O&&(O=n);const A=ir(D(tr,r,I));if(A>T){const t=Math.sqrt(A);h=.5*(h+t),T=h*h;const e=t-h;I[0]=(h*I[0]+e*r[0])/t,I[1]=(h*I[1]+e*r[1])/t,I[2]=(h*I[2]+e*r[2])/t}}h<O?(l(e.center,I),e.radius=h):(l(e.center,L),e.radius=O);return e}(n,e)).center;let i=e.radius;for(let e=0;e<r;e++){const r=t[e];i=Math.max(i,T(A,r.center)+r.radius)}return e.radius=i,e}(a,{center:[0,0,0],radius:0});return e.root.boundingVolume.sphere=[...B.center,B.radius],e}function ve(t,e,r){var n=Ze(t,e,r.center);return r.radius=T(n,e),r}function Ze(t,e,r){return r[0]=.5*(t[0]+e[0]),r[1]=.5*(t[1]+e[1]),r[2]=.5*(t[2]+e[2]),r}const xe=[],ke=[];const We=[],Qe=[],je=[],Ye=[],ze=[],qe=[],$e=[],tr=[],er=[],rr=[],nr=[],Ar=[];function ir(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function or(t){return Math.hypot(t[0],t[1],t[2])}\n/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function sr(t){let e=t.length;for(;--e>=0;)t[e]=0}const ar=256,Br=286,Er=30,cr=15,Cr=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fr=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),lr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ur=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_r=new Array(576);sr(_r);const Dr=new Array(60);sr(Dr);const Rr=new Array(512);sr(Rr);const Ir=new Array(256);sr(Ir);const Tr=new Array(29);sr(Tr);const hr=new Array(Er);function Fr(t,e,r,n,A){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=A,this.has_stree=t&&t.length}let Pr,Lr,Or;function yr(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}sr(hr);const Mr=t=>t<256?Rr[t]:Rr[256+(t>>>7)],Nr=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Sr=(t,e,r)=>{t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,Nr(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},dr=(t,e,r)=>{Sr(t,r[2*e],r[2*e+1])},Ur=(t,e)=>{let r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1},Gr=(t,e,r)=>{const n=new Array(16);let A,i,o=0;for(A=1;A<=cr;A++)o=o+r[A-1]<<1,n[A]=o;for(i=0;i<=e;i++){let e=t[2*i+1];0!==e&&(t[2*i]=Ur(n[e]++,e))}},mr=t=>{let e;for(e=0;e<Br;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Er;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},br=t=>{t.bi_valid>8?Nr(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},pr=(t,e,r,n)=>{const A=2*e,i=2*r;return t[A]<t[i]||t[A]===t[i]&&n[e]<=n[r]},wr=(t,e,r)=>{const n=t.heap[r];let A=r<<1;for(;A<=t.heap_len&&(A<t.heap_len&&pr(e,t.heap[A+1],t.heap[A],t.depth)&&A++,!pr(e,n,t.heap[A],t.depth));)t.heap[r]=t.heap[A],r=A,A<<=1;t.heap[r]=n},Hr=(t,e,r)=>{let n,A,i,o,s=0;if(0!==t.sym_next)do{n=255&t.pending_buf[t.sym_buf+s++],n+=(255&t.pending_buf[t.sym_buf+s++])<<8,A=t.pending_buf[t.sym_buf+s++],0===n?dr(t,A,e):(i=Ir[A],dr(t,i+ar+1,e),o=Cr[i],0!==o&&(A-=Tr[i],Sr(t,A,o)),n--,i=Mr(n),dr(t,i,r),o=fr[i],0!==o&&(n-=hr[i],Sr(t,n,o)))}while(s<t.sym_next);dr(t,256,e)},Kr=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,A=e.stat_desc.has_stree,i=e.stat_desc.elems;let o,s,a,B=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<i;o++)0!==r[2*o]?(t.heap[++t.heap_len]=B=o,t.depth[o]=0):r[2*o+1]=0;for(;t.heap_len<2;)a=t.heap[++t.heap_len]=B<2?++B:0,r[2*a]=1,t.depth[a]=0,t.opt_len--,A&&(t.static_len-=n[2*a+1]);for(e.max_code=B,o=t.heap_len>>1;o>=1;o--)wr(t,r,o);a=i;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],wr(t,r,1),s=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=s,r[2*a]=r[2*o]+r[2*s],t.depth[a]=(t.depth[o]>=t.depth[s]?t.depth[o]:t.depth[s])+1,r[2*o+1]=r[2*s+1]=a,t.heap[1]=a++,wr(t,r,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const r=e.dyn_tree,n=e.max_code,A=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,s=e.stat_desc.extra_base,a=e.stat_desc.max_length;let B,E,c,C,f,l,u=0;for(C=0;C<=cr;C++)t.bl_count[C]=0;for(r[2*t.heap[t.heap_max]+1]=0,B=t.heap_max+1;B<573;B++)E=t.heap[B],C=r[2*r[2*E+1]+1]+1,C>a&&(C=a,u++),r[2*E+1]=C,E>n||(t.bl_count[C]++,f=0,E>=s&&(f=o[E-s]),l=r[2*E],t.opt_len+=l*(C+f),i&&(t.static_len+=l*(A[2*E+1]+f)));if(0!==u){do{for(C=a-1;0===t.bl_count[C];)C--;t.bl_count[C]--,t.bl_count[C+1]+=2,t.bl_count[a]--,u-=2}while(u>0);for(C=a;0!==C;C--)for(E=t.bl_count[C];0!==E;)c=t.heap[--B],c>n||(r[2*c+1]!==C&&(t.opt_len+=(C-r[2*c+1])*r[2*c],r[2*c+1]=C),E--)}})(t,e),Gr(r,B,t.bl_count)},gr=(t,e,r)=>{let n,A,i=-1,o=e[1],s=0,a=7,B=4;for(0===o&&(a=138,B=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)A=o,o=e[2*(n+1)+1],++s<a&&A===o||(s<B?t.bl_tree[2*A]+=s:0!==A?(A!==i&&t.bl_tree[2*A]++,t.bl_tree[32]++):s<=10?t.bl_tree[34]++:t.bl_tree[36]++,s=0,i=A,0===o?(a=138,B=3):A===o?(a=6,B=3):(a=7,B=4))},Vr=(t,e,r)=>{let n,A,i=-1,o=e[1],s=0,a=7,B=4;for(0===o&&(a=138,B=3),n=0;n<=r;n++)if(A=o,o=e[2*(n+1)+1],!(++s<a&&A===o)){if(s<B)do{dr(t,A,t.bl_tree)}while(0!=--s);else 0!==A?(A!==i&&(dr(t,A,t.bl_tree),s--),dr(t,16,t.bl_tree),Sr(t,s-3,2)):s<=10?(dr(t,17,t.bl_tree),Sr(t,s-3,3)):(dr(t,18,t.bl_tree),Sr(t,s-11,7));s=0,i=A,0===o?(a=138,B=3):A===o?(a=6,B=3):(a=7,B=4)}};let Xr=!1;const Jr=(t,e,r,n)=>{Sr(t,0+(n?1:0),3),br(t),Nr(t,r),Nr(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r};var vr=t=>{Xr||((()=>{let t,e,r,n,A;const i=new Array(16);for(r=0,n=0;n<28;n++)for(Tr[n]=r,t=0;t<1<<Cr[n];t++)Ir[r++]=n;for(Ir[r-1]=n,A=0,n=0;n<16;n++)for(hr[n]=A,t=0;t<1<<fr[n];t++)Rr[A++]=n;for(A>>=7;n<Er;n++)for(hr[n]=A<<7,t=0;t<1<<fr[n]-7;t++)Rr[256+A++]=n;for(e=0;e<=cr;e++)i[e]=0;for(t=0;t<=143;)_r[2*t+1]=8,t++,i[8]++;for(;t<=255;)_r[2*t+1]=9,t++,i[9]++;for(;t<=279;)_r[2*t+1]=7,t++,i[7]++;for(;t<=287;)_r[2*t+1]=8,t++,i[8]++;for(Gr(_r,287,i),t=0;t<Er;t++)Dr[2*t+1]=5,Dr[2*t]=Ur(t,5);Pr=new Fr(_r,Cr,257,Br,cr),Lr=new Fr(Dr,fr,0,Er,cr),Or=new Fr(new Array(0),lr,0,19,7)})(),Xr=!0),t.l_desc=new yr(t.dyn_ltree,Pr),t.d_desc=new yr(t.dyn_dtree,Lr),t.bl_desc=new yr(t.bl_tree,Or),t.bi_buf=0,t.bi_valid=0,mr(t)},Zr=(t,e,r,n)=>{let A,i,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<ar;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),Kr(t,t.l_desc),Kr(t,t.d_desc),o=(t=>{let e;for(gr(t,t.dyn_ltree,t.l_desc.max_code),gr(t,t.dyn_dtree,t.d_desc.max_code),Kr(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*ur[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),A=t.opt_len+3+7>>>3,i=t.static_len+3+7>>>3,i<=A&&(A=i)):A=i=r+5,r+4<=A&&-1!==e?Jr(t,e,r,n):4===t.strategy||i===A?(Sr(t,2+(n?1:0),3),Hr(t,_r,Dr)):(Sr(t,4+(n?1:0),3),((t,e,r,n)=>{let A;for(Sr(t,e-257,5),Sr(t,r-1,5),Sr(t,n-4,4),A=0;A<n;A++)Sr(t,t.bl_tree[2*ur[A]+1],3);Vr(t,t.dyn_ltree,e-1),Vr(t,t.dyn_dtree,r-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Hr(t,t.dyn_ltree,t.dyn_dtree)),mr(t),n&&br(t)},xr={Dt:vr,Rt:Jr,It:Zr,Tt:(t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(Ir[r]+ar+1)]++,t.dyn_dtree[2*Mr(e)]++),t.sym_next===t.sym_end),ht:t=>{Sr(t,2,3),dr(t,256,_r),(t=>{16===t.bi_valid?(Nr(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var kr=(t,e,r,n)=>{let A=65535&t|0,i=t>>>16&65535|0,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{A=A+e[n++]|0,i=i+A|0}while(--o);A%=65521,i%=65521}return A|i<<16|0};const Wr=new Uint32Array((()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e})());var Qr=(t,e,r,n)=>{const A=Wr,i=n+r;t^=-1;for(let r=n;r<i;r++)t=t>>>8^A[255&(t^e[r])];return-1^t},jr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Yr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{Dt:zr,Rt:qr,It:$r,Tt:tn,ht:en}=xr,{Z_NO_FLUSH:rn,Z_PARTIAL_FLUSH:nn,Z_FULL_FLUSH:An,Z_FINISH:on,Z_BLOCK:sn,Z_OK:an,Z_STREAM_END:Bn,Z_STREAM_ERROR:En,Z_DATA_ERROR:cn,Z_BUF_ERROR:Cn,Z_DEFAULT_COMPRESSION:fn,Z_FILTERED:ln,Z_HUFFMAN_ONLY:un,Z_RLE:_n,Z_FIXED:Dn,Z_DEFAULT_STRATEGY:Rn,Z_UNKNOWN:In,Z_DEFLATED:Tn}=Yr,hn=286,Fn=30,Pn=19,Ln=2*hn+1,On=15,yn=258,Mn=262,Nn=42,Sn=113,dn=666,Un=(t,e)=>(t.msg=jr[e],e),Gn=t=>2*t-(t>4?9:0),mn=t=>{let e=t.length;for(;--e>=0;)t[e]=0},bn=t=>{let e,r,n,A=t.w_size;e=t.hash_size,n=e;do{r=t.head[--n],t.head[n]=r>=A?r-A:0}while(--e);e=A,n=e;do{r=t.prev[--n],t.prev[n]=r>=A?r-A:0}while(--e)};let pn=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const wn=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))},Hn=(t,e)=>{$r(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,wn(t.strm)},Kn=(t,e)=>{t.pending_buf[t.pending++]=e},gn=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Vn=(t,e,r,n)=>{let A=t.avail_in;return A>n&&(A=n),0===A?0:(t.avail_in-=A,e.set(t.input.subarray(t.next_in,t.next_in+A),r),1===t.state.wrap?t.adler=kr(t.adler,e,A,r):2===t.state.wrap&&(t.adler=Qr(t.adler,e,A,r)),t.next_in+=A,t.total_in+=A,A)},Xn=(t,e)=>{let r,n,A=t.max_chain_length,i=t.strstart,o=t.prev_length,s=t.nice_match;const a=t.strstart>t.w_size-Mn?t.strstart-(t.w_size-Mn):0,B=t.window,E=t.w_mask,c=t.prev,C=t.strstart+yn;let f=B[i+o-1],l=B[i+o];t.prev_length>=t.good_match&&(A>>=2),s>t.lookahead&&(s=t.lookahead);do{if(r=e,B[r+o]===l&&B[r+o-1]===f&&B[r]===B[i]&&B[++r]===B[i+1]){i+=2,r++;do{}while(B[++i]===B[++r]&&B[++i]===B[++r]&&B[++i]===B[++r]&&B[++i]===B[++r]&&B[++i]===B[++r]&&B[++i]===B[++r]&&B[++i]===B[++r]&&B[++i]===B[++r]&&i<C);if(n=yn-(C-i),i=C-yn,n>o){if(t.match_start=e,o=n,n>=s)break;f=B[i+o-1],l=B[i+o]}}}while((e=c[e&E])>a&&0!=--A);return o<=t.lookahead?o:t.lookahead},Jn=t=>{const e=t.w_size;let r,n,A;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Mn)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),bn(t),n+=e),0===t.strm.avail_in)break;if(r=Vn(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=3)for(A=t.strstart-t.insert,t.ins_h=t.window[A],t.ins_h=pn(t,t.ins_h,t.window[A+1]);t.insert&&(t.ins_h=pn(t,t.ins_h,t.window[A+3-1]),t.prev[A&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=A,A++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Mn&&0!==t.strm.avail_in)},vn=(t,e)=>{let r,n,A,i=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,s=t.strm.avail_in;do{if(r=65535,A=t.bi_valid+42>>3,t.strm.avail_out<A)break;if(A=t.strm.avail_out-A,n=t.strstart-t.block_start,r>n+t.strm.avail_in&&(r=n+t.strm.avail_in),r>A&&(r=A),r<i&&(0===r&&e!==on||e===rn||r!==n+t.strm.avail_in))break;o=e===on&&r===n+t.strm.avail_in?1:0,qr(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,wn(t.strm),n&&(n>r&&(n=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,r-=n),r&&(Vn(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(0===o);return s-=t.strm.avail_in,s&&(s>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=s&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-s,t.strm.next_in),t.strstart),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:e!==rn&&e!==on&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(A=t.window_size-t.strstart,t.strm.avail_in>A&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,A+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),A>t.strm.avail_in&&(A=t.strm.avail_in),A&&(Vn(t.strm,t.window,t.strstart,A),t.strstart+=A,t.insert+=A>t.w_size-t.insert?t.w_size-t.insert:A),t.high_water<t.strstart&&(t.high_water=t.strstart),A=t.bi_valid+42>>3,A=t.pending_buf_size-A>65535?65535:t.pending_buf_size-A,i=A>t.w_size?t.w_size:A,n=t.strstart-t.block_start,(n>=i||(n||e===on)&&e!==rn&&0===t.strm.avail_in&&n<=A)&&(r=n>A?A:n,o=e===on&&0===t.strm.avail_in&&r===n?1:0,qr(t,t.block_start,r,o),t.block_start+=r,wn(t.strm)),o?3:1)},Zn=(t,e)=>{let r,n;for(;;){if(t.lookahead<Mn){if(Jn(t),t.lookahead<Mn&&e===rn)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=pn(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-Mn&&(t.match_length=Xn(t,r)),t.match_length>=3)if(n=tn(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=pn(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=pn(t,t.ins_h,t.window[t.strstart+1]);else n=tn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(Hn(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===on?(Hn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Hn(t,!1),0===t.strm.avail_out)?1:2},xn=(t,e)=>{let r,n,A;for(;;){if(t.lookahead<Mn){if(Jn(t),t.lookahead<Mn&&e===rn)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=pn(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-Mn&&(t.match_length=Xn(t,r),t.match_length<=5&&(t.strategy===ln||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){A=t.strstart+t.lookahead-3,n=tn(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=A&&(t.ins_h=pn(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(Hn(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=tn(t,0,t.window[t.strstart-1]),n&&Hn(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=tn(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===on?(Hn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Hn(t,!1),0===t.strm.avail_out)?1:2};function kn(t,e,r,n,A){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=A}const Wn=[new kn(0,0,0,0,vn),new kn(4,4,8,4,Zn),new kn(4,5,16,8,Zn),new kn(4,6,32,32,Zn),new kn(4,4,16,16,xn),new kn(8,16,32,32,xn),new kn(8,16,128,128,xn),new kn(8,32,128,256,xn),new kn(32,128,258,1024,xn),new kn(32,258,258,4096,xn)];function Qn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Tn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Ln),this.dyn_dtree=new Uint16Array(2*(2*Fn+1)),this.bl_tree=new Uint16Array(2*(2*Pn+1)),mn(this.dyn_ltree),mn(this.dyn_dtree),mn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(On+1),this.heap=new Uint16Array(2*hn+1),mn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*hn+1),mn(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const jn=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Nn&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==Sn&&e.status!==dn?1:0},Yn=t=>{if(jn(t))return Un(t,En);t.total_in=t.total_out=0,t.data_type=In;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?Nn:Sn,t.adler=2===e.wrap?0:1,e.last_flush=-2,zr(e),an},zn=t=>{const e=Yn(t);var r;return e===an&&((r=t.state).window_size=2*r.w_size,mn(r.head),r.max_lazy_match=Wn[r.level].max_lazy,r.good_match=Wn[r.level].good_length,r.nice_match=Wn[r.level].nice_length,r.max_chain_length=Wn[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),e},qn=(t,e,r,n,A,i)=>{if(!t)return En;let o=1;if(e===fn&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),A<1||A>9||r!==Tn||n<8||n>15||e<0||e>9||i<0||i>Dn||8===n&&1!==o)return Un(t,En);8===n&&(n=9);const s=new Qn;return t.state=s,s.strm=t,s.status=Nn,s.wrap=o,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=A+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<A+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=e,s.strategy=i,s.method=r,zn(t)};var $n=(t,e)=>{if(jn(t)||e>sn||e<0)return t?Un(t,En):En;const r=t.state;if(!t.output||0!==t.avail_in&&!t.input||r.status===dn&&e!==on)return Un(t,0===t.avail_out?Cn:En);const n=r.last_flush;if(r.last_flush=e,0!==r.pending){if(wn(t),0===t.avail_out)return r.last_flush=-1,an}else if(0===t.avail_in&&Gn(e)<=Gn(n)&&e!==on)return Un(t,Cn);if(r.status===dn&&0!==t.avail_in)return Un(t,Cn);if(r.status===Nn&&0===r.wrap&&(r.status=Sn),r.status===Nn){let e=Tn+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=un||r.level<2?0:r.level<6?1:6===r.level?2:3,e|=n<<6,0!==r.strstart&&(e|=32),e+=31-e%31,gn(r,e),0!==r.strstart&&(gn(r,t.adler>>>16),gn(r,65535&t.adler)),t.adler=1,r.status=Sn,wn(t),0!==r.pending)return r.last_flush=-1,an}if(57===r.status)if(t.adler=0,Kn(r,31),Kn(r,139),Kn(r,8),r.gzhead)Kn(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Kn(r,255&r.gzhead.time),Kn(r,r.gzhead.time>>8&255),Kn(r,r.gzhead.time>>16&255),Kn(r,r.gzhead.time>>24&255),Kn(r,9===r.level?2:r.strategy>=un||r.level<2?4:0),Kn(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Kn(r,255&r.gzhead.extra.length),Kn(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=Qr(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Kn(r,0),Kn(r,0),Kn(r,0),Kn(r,0),Kn(r,0),Kn(r,9===r.level?2:r.strategy>=un||r.level<2?4:0),Kn(r,3),r.status=Sn,wn(t),0!==r.pending)return r.last_flush=-1,an;if(69===r.status){if(r.gzhead.extra){let e=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let A=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+A),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>e&&(t.adler=Qr(t.adler,r.pending_buf,r.pending-e,e)),r.gzindex+=A,wn(t),0!==r.pending)return r.last_flush=-1,an;e=0,n-=A}let A=new Uint8Array(r.gzhead.extra);r.pending_buf.set(A.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>e&&(t.adler=Qr(t.adler,r.pending_buf,r.pending-e,e)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let e,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=Qr(t.adler,r.pending_buf,r.pending-n,n)),wn(t),0!==r.pending)return r.last_flush=-1,an;n=0}e=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Kn(r,e)}while(0!==e);r.gzhead.hcrc&&r.pending>n&&(t.adler=Qr(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let e,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=Qr(t.adler,r.pending_buf,r.pending-n,n)),wn(t),0!==r.pending)return r.last_flush=-1,an;n=0}e=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Kn(r,e)}while(0!==e);r.gzhead.hcrc&&r.pending>n&&(t.adler=Qr(t.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(wn(t),0!==r.pending))return r.last_flush=-1,an;Kn(r,255&t.adler),Kn(r,t.adler>>8&255),t.adler=0}if(r.status=Sn,wn(t),0!==r.pending)return r.last_flush=-1,an}if(0!==t.avail_in||0!==r.lookahead||e!==rn&&r.status!==dn){let n=0===r.level?vn(r,e):r.strategy===un?((t,e)=>{let r;for(;;){if(0===t.lookahead&&(Jn(t),0===t.lookahead)){if(e===rn)return 1;break}if(t.match_length=0,r=tn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(Hn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===on?(Hn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Hn(t,!1),0===t.strm.avail_out)?1:2})(r,e):r.strategy===_n?((t,e)=>{let r,n,A,i;const o=t.window;for(;;){if(t.lookahead<=yn){if(Jn(t),t.lookahead<=yn&&e===rn)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(A=t.strstart-1,n=o[A],n===o[++A]&&n===o[++A]&&n===o[++A])){i=t.strstart+yn;do{}while(n===o[++A]&&n===o[++A]&&n===o[++A]&&n===o[++A]&&n===o[++A]&&n===o[++A]&&n===o[++A]&&n===o[++A]&&A<i);t.match_length=yn-(i-A),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(r=tn(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=tn(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(Hn(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===on?(Hn(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Hn(t,!1),0===t.strm.avail_out)?1:2})(r,e):Wn[r.level].func(r,e);if(3!==n&&4!==n||(r.status=dn),1===n||3===n)return 0===t.avail_out&&(r.last_flush=-1),an;if(2===n&&(e===nn?en(r):e!==sn&&(qr(r,0,0,!1),e===An&&(mn(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),wn(t),0===t.avail_out))return r.last_flush=-1,an}return e!==on?an:r.wrap<=0?Bn:(2===r.wrap?(Kn(r,255&t.adler),Kn(r,t.adler>>8&255),Kn(r,t.adler>>16&255),Kn(r,t.adler>>24&255),Kn(r,255&t.total_in),Kn(r,t.total_in>>8&255),Kn(r,t.total_in>>16&255),Kn(r,t.total_in>>24&255)):(gn(r,t.adler>>>16),gn(r,65535&t.adler)),wn(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?an:Bn)},tA=(t,e)=>{let r=e.length;if(jn(t))return En;const n=t.state,A=n.wrap;if(2===A||1===A&&n.status!==Nn||n.lookahead)return En;if(1===A&&(t.adler=kr(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){0===A&&(mn(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(r-n.w_size,r),0),e=t,r=n.w_size}const i=t.avail_in,o=t.next_in,s=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Jn(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=pn(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,Jn(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=o,t.input=s,t.avail_in=i,n.wrap=A,an},eA={deflateInit:(t,e)=>qn(t,e,Tn,15,8,Rn),deflateInit2:qn,deflateReset:zn,deflateResetKeep:Yn,deflateSetHeader:(t,e)=>jn(t)||2!==t.state.wrap?En:(t.state.gzhead=e,an),deflate:$n,deflateEnd:t=>{if(jn(t))return En;const e=t.state.status;return t.state=null,e===Sn?Un(t,cn):an},deflateSetDictionary:tA,deflateInfo:"pako deflate (from Nodeca project)"};const rA=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var nA={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const e in r)rA(r,e)&&(t[e]=r[e])}}return t},flattenChunks:t=>{let e=0;for(let r=0,n=t.length;r<n;r++)e+=t[r].length;const r=new Uint8Array(e);for(let e=0,n=0,A=t.length;e<A;e++){let A=t[e];r.set(A,n),n+=A.length}return r}};let AA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){AA=!1}const iA=new Uint8Array(256);for(let t=0;t<256;t++)iA[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;iA[254]=iA[254]=1;var oA={string2buf:t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,r,n,A,i,o=t.length,s=0;for(A=0;A<o;A++)r=t.charCodeAt(A),55296==(64512&r)&&A+1<o&&(n=t.charCodeAt(A+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),A++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(s),i=0,A=0;i<s;A++)r=t.charCodeAt(A),55296==(64512&r)&&A+1<o&&(n=t.charCodeAt(A+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),A++)),r<128?e[i++]=r:r<2048?(e[i++]=192|r>>>6,e[i++]=128|63&r):r<65536?(e[i++]=224|r>>>12,e[i++]=128|r>>>6&63,e[i++]=128|63&r):(e[i++]=240|r>>>18,e[i++]=128|r>>>12&63,e[i++]=128|r>>>6&63,e[i++]=128|63&r);return e},buf2string:(t,e)=>{const r=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let n,A;const i=new Array(2*r);for(A=0,n=0;n<r;){let e=t[n++];if(e<128){i[A++]=e;continue}let o=iA[e];if(o>4)i[A++]=65533,n+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&n<r;)e=e<<6|63&t[n++],o--;o>1?i[A++]=65533:e<65536?i[A++]=e:(e-=65536,i[A++]=55296|e>>10&1023,i[A++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&AA)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r})(i,A)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let r=e-1;for(;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+iA[t[r]]>e?r:e}};var sA=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const aA=Object.prototype.toString,{Z_NO_FLUSH:BA,Z_SYNC_FLUSH:EA,Z_FULL_FLUSH:cA,Z_FINISH:CA,Z_OK:fA,Z_STREAM_END:lA,Z_DEFAULT_COMPRESSION:uA,Z_DEFAULT_STRATEGY:_A,Z_DEFLATED:DA}=Yr;function RA(t){this.options=nA.assign({level:uA,method:DA,chunkSize:16384,windowBits:15,memLevel:8,strategy:_A},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new sA,this.strm.avail_out=0;let r=eA.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==fA)throw new Error(jr[r]);if(e.header&&eA.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?oA.string2buf(e.dictionary):"[object ArrayBuffer]"===aA.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,r=eA.deflateSetDictionary(this.strm,t),r!==fA)throw new Error(jr[r]);this.Ft=!0}}function IA(t,e){const r=new RA(e);if(r.push(t,!0),r.err)throw r.msg||jr[r.err];return r.result}RA.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let A,i;if(this.ended)return!1;for(i=e===~~e?e:!0===e?CA:BA,"string"==typeof t?r.input=oA.string2buf(t):"[object ArrayBuffer]"===aA.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(i===EA||i===cA)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(A=eA.deflate(r,i),A===lA)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),A=eA.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===fA;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},RA.prototype.onData=function(t){this.chunks.push(t)},RA.prototype.onEnd=function(t){t===fA&&(this.result=nA.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var TA={Deflate:RA,deflate:IA,deflateRaw:function(t,e){return(e=e||{}).raw=!0,IA(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,IA(t,e)},constants:Yr};const hA=16209;var FA=function(t,e){let r,n,A,i,o,s,a,B,E,c,C,f,l,u,_,D,R,I,T,h,F,P,L,O;const y=t.state;r=t.next_in,L=t.input,n=r+(t.avail_in-5),A=t.next_out,O=t.output,i=A-(e-t.avail_out),o=A+(t.avail_out-257),s=y.dmax,a=y.wsize,B=y.whave,E=y.wnext,c=y.window,C=y.hold,f=y.bits,l=y.lencode,u=y.distcode,_=(1<<y.lenbits)-1,D=(1<<y.distbits)-1;t:do{f<15&&(C+=L[r++]<<f,f+=8,C+=L[r++]<<f,f+=8),R=l[C&_];e:for(;;){if(I=R>>>24,C>>>=I,f-=I,I=R>>>16&255,0===I)O[A++]=65535&R;else{if(!(16&I)){if(0==(64&I)){R=l[(65535&R)+(C&(1<<I)-1)];continue e}if(32&I){y.mode=16191;break t}t.msg="invalid literal/length code",y.mode=hA;break t}T=65535&R,I&=15,I&&(f<I&&(C+=L[r++]<<f,f+=8),T+=C&(1<<I)-1,C>>>=I,f-=I),f<15&&(C+=L[r++]<<f,f+=8,C+=L[r++]<<f,f+=8),R=u[C&D];r:for(;;){if(I=R>>>24,C>>>=I,f-=I,I=R>>>16&255,!(16&I)){if(0==(64&I)){R=u[(65535&R)+(C&(1<<I)-1)];continue r}t.msg="invalid distance code",y.mode=hA;break t}if(h=65535&R,I&=15,f<I&&(C+=L[r++]<<f,f+=8,f<I&&(C+=L[r++]<<f,f+=8)),h+=C&(1<<I)-1,h>s){t.msg="invalid distance too far back",y.mode=hA;break t}if(C>>>=I,f-=I,I=A-i,h>I){if(I=h-I,I>B&&y.sane){t.msg="invalid distance too far back",y.mode=hA;break t}if(F=0,P=c,0===E){if(F+=a-I,I<T){T-=I;do{O[A++]=c[F++]}while(--I);F=A-h,P=O}}else if(E<I){if(F+=a+E-I,I-=E,I<T){T-=I;do{O[A++]=c[F++]}while(--I);if(F=0,E<T){I=E,T-=I;do{O[A++]=c[F++]}while(--I);F=A-h,P=O}}}else if(F+=E-I,I<T){T-=I;do{O[A++]=c[F++]}while(--I);F=A-h,P=O}for(;T>2;)O[A++]=P[F++],O[A++]=P[F++],O[A++]=P[F++],T-=3;T&&(O[A++]=P[F++],T>1&&(O[A++]=P[F++]))}else{F=A-h;do{O[A++]=O[F++],O[A++]=O[F++],O[A++]=O[F++],T-=3}while(T>2);T&&(O[A++]=O[F++],T>1&&(O[A++]=O[F++]))}break}}break}}while(r<n&&A<o);T=f>>3,r-=T,f-=T<<3,C&=(1<<f)-1,t.next_in=r,t.next_out=A,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=A<o?o-A+257:257-(A-o),y.hold=C,y.bits=f};const PA=15,LA=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),OA=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yA=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),MA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var NA=(t,e,r,n,A,i,o,s)=>{const a=s.bits;let B,E,c,C,f,l,u=0,_=0,D=0,R=0,I=0,T=0,h=0,F=0,P=0,L=0,O=null;const y=new Uint16Array(16),M=new Uint16Array(16);let N,S,d,U=null;for(u=0;u<=PA;u++)y[u]=0;for(_=0;_<n;_++)y[e[r+_]]++;for(I=a,R=PA;R>=1&&0===y[R];R--);if(I>R&&(I=R),0===R)return A[i++]=20971520,A[i++]=20971520,s.bits=1,0;for(D=1;D<R&&0===y[D];D++);for(I<D&&(I=D),F=1,u=1;u<=PA;u++)if(F<<=1,F-=y[u],F<0)return-1;if(F>0&&(0===t||1!==R))return-1;for(M[1]=0,u=1;u<PA;u++)M[u+1]=M[u]+y[u];for(_=0;_<n;_++)0!==e[r+_]&&(o[M[e[r+_]]++]=_);if(0===t?(O=U=o,l=20):1===t?(O=LA,U=OA,l=257):(O=yA,U=MA,l=0),L=0,_=0,u=D,f=i,T=I,h=0,c=-1,P=1<<I,C=P-1,1===t&&P>852||2===t&&P>592)return 1;for(;;){N=u-h,o[_]+1<l?(S=0,d=o[_]):o[_]>=l?(S=U[o[_]-l],d=O[o[_]-l]):(S=96,d=0),B=1<<u-h,E=1<<T,D=E;do{E-=B,A[f+(L>>h)+E]=N<<24|S<<16|d|0}while(0!==E);for(B=1<<u-1;L&B;)B>>=1;if(0!==B?(L&=B-1,L+=B):L=0,_++,0==--y[u]){if(u===R)break;u=e[r+o[_]]}if(u>I&&(L&C)!==c){for(0===h&&(h=I),f+=D,T=u-h,F=1<<T;T+h<R&&(F-=y[T+h],!(F<=0));)T++,F<<=1;if(P+=1<<T,1===t&&P>852||2===t&&P>592)return 1;c=L&C,A[c]=I<<24|T<<16|f-i|0}}return 0!==L&&(A[f+L]=u-h<<24|64<<16|0),s.bits=I,0};const{Z_FINISH:SA,Z_BLOCK:dA,Z_TREES:UA,Z_OK:GA,Z_STREAM_END:mA,Z_NEED_DICT:bA,Z_STREAM_ERROR:pA,Z_DATA_ERROR:wA,Z_MEM_ERROR:HA,Z_BUF_ERROR:KA,Z_DEFLATED:gA}=Yr,VA=16180,XA=16190,JA=16191,vA=16192,ZA=16194,xA=16199,kA=16200,WA=16206,QA=16209,jA=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function YA(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const zA=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<VA||e.mode>16211?1:0},qA=t=>{if(zA(t))return pA;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=VA,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,GA},$A=t=>{if(zA(t))return pA;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,qA(t)},ti=(t,e)=>{let r;if(zA(t))return pA;const n=t.state;return e<0?(r=0,e=-e):(r=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?pA:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,$A(t))},ei=(t,e)=>{if(!t)return pA;const r=new YA;t.state=r,r.strm=t,r.window=null,r.mode=VA;const n=ti(t,e);return n!==GA&&(t.state=null),n};let ri,ni,Ai=!0;const ii=t=>{if(Ai){ri=new Int32Array(512),ni=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(NA(1,t.lens,0,288,ri,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;NA(2,t.lens,0,32,ni,0,t.work,{bits:5}),Ai=!1}t.lencode=ri,t.lenbits=9,t.distcode=ni,t.distbits=5},oi=(t,e,r,n)=>{let A;const i=t.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(e.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(A=i.wsize-i.wnext,A>n&&(A=n),i.window.set(e.subarray(r-n,r-n+A),i.wnext),(n-=A)?(i.window.set(e.subarray(r-n,r),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=A,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=A))),0};var si=(t,e)=>{let r,n,A,i,o,s,a,B,E,c,C,f,l,u,_,D,R,I,T,h,F,P,L=0;const O=new Uint8Array(4);let y,M;const N=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(zA(t)||!t.output||!t.input&&0!==t.avail_in)return pA;r=t.state,r.mode===JA&&(r.mode=vA),o=t.next_out,A=t.output,a=t.avail_out,i=t.next_in,n=t.input,s=t.avail_in,B=r.hold,E=r.bits,c=s,C=a,P=GA;t:for(;;)switch(r.mode){case VA:if(0===r.wrap){r.mode=vA;break}for(;E<16;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(2&r.wrap&&35615===B){0===r.wbits&&(r.wbits=15),r.check=0,O[0]=255&B,O[1]=B>>>8&255,r.check=Qr(r.check,O,2,0),B=0,E=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&B)<<8)+(B>>8))%31){t.msg="incorrect header check",r.mode=QA;break}if((15&B)!==gA){t.msg="unknown compression method",r.mode=QA;break}if(B>>>=4,E-=4,F=8+(15&B),0===r.wbits&&(r.wbits=F),F>15||F>r.wbits){t.msg="invalid window size",r.mode=QA;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=512&B?16189:JA,B=0,E=0;break;case 16181:for(;E<16;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(r.flags=B,(255&r.flags)!==gA){t.msg="unknown compression method",r.mode=QA;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=QA;break}r.head&&(r.head.text=B>>8&1),512&r.flags&&4&r.wrap&&(O[0]=255&B,O[1]=B>>>8&255,r.check=Qr(r.check,O,2,0)),B=0,E=0,r.mode=16182;case 16182:for(;E<32;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}r.head&&(r.head.time=B),512&r.flags&&4&r.wrap&&(O[0]=255&B,O[1]=B>>>8&255,O[2]=B>>>16&255,O[3]=B>>>24&255,r.check=Qr(r.check,O,4,0)),B=0,E=0,r.mode=16183;case 16183:for(;E<16;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}r.head&&(r.head.xflags=255&B,r.head.os=B>>8),512&r.flags&&4&r.wrap&&(O[0]=255&B,O[1]=B>>>8&255,r.check=Qr(r.check,O,2,0)),B=0,E=0,r.mode=16184;case 16184:if(1024&r.flags){for(;E<16;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}r.length=B,r.head&&(r.head.extra_len=B),512&r.flags&&4&r.wrap&&(O[0]=255&B,O[1]=B>>>8&255,r.check=Qr(r.check,O,2,0)),B=0,E=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(f=r.length,f>s&&(f=s),f&&(r.head&&(F=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(i,i+f),F)),512&r.flags&&4&r.wrap&&(r.check=Qr(r.check,n,f,i)),s-=f,i+=f,r.length-=f),r.length))break t;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===s)break t;f=0;do{F=n[i+f++],r.head&&F&&r.length<65536&&(r.head.name+=String.fromCharCode(F))}while(F&&f<s);if(512&r.flags&&4&r.wrap&&(r.check=Qr(r.check,n,f,i)),s-=f,i+=f,F)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===s)break t;f=0;do{F=n[i+f++],r.head&&F&&r.length<65536&&(r.head.comment+=String.fromCharCode(F))}while(F&&f<s);if(512&r.flags&&4&r.wrap&&(r.check=Qr(r.check,n,f,i)),s-=f,i+=f,F)break t}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;E<16;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(4&r.wrap&&B!==(65535&r.check)){t.msg="header crc mismatch",r.mode=QA;break}B=0,E=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=JA;break;case 16189:for(;E<32;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}t.adler=r.check=jA(B),B=0,E=0,r.mode=XA;case XA:if(0===r.havedict)return t.next_out=o,t.avail_out=a,t.next_in=i,t.avail_in=s,r.hold=B,r.bits=E,bA;t.adler=r.check=1,r.mode=JA;case JA:if(e===dA||e===UA)break t;case vA:if(r.last){B>>>=7&E,E-=7&E,r.mode=WA;break}for(;E<3;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}switch(r.last=1&B,B>>>=1,E-=1,3&B){case 0:r.mode=16193;break;case 1:if(ii(r),r.mode=xA,e===UA){B>>>=2,E-=2;break t}break;case 2:r.mode=16196;break;case 3:t.msg="invalid block type",r.mode=QA}B>>>=2,E-=2;break;case 16193:for(B>>>=7&E,E-=7&E;E<32;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if((65535&B)!=(B>>>16^65535)){t.msg="invalid stored block lengths",r.mode=QA;break}if(r.length=65535&B,B=0,E=0,r.mode=ZA,e===UA)break t;case ZA:r.mode=16195;case 16195:if(f=r.length,f){if(f>s&&(f=s),f>a&&(f=a),0===f)break t;A.set(n.subarray(i,i+f),o),s-=f,i+=f,a-=f,o+=f,r.length-=f;break}r.mode=JA;break;case 16196:for(;E<14;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(r.nlen=257+(31&B),B>>>=5,E-=5,r.ndist=1+(31&B),B>>>=5,E-=5,r.ncode=4+(15&B),B>>>=4,E-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=QA;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;E<3;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}r.lens[N[r.have++]]=7&B,B>>>=3,E-=3}for(;r.have<19;)r.lens[N[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,y={bits:r.lenbits},P=NA(0,r.lens,0,19,r.lencode,0,r.work,y),r.lenbits=y.bits,P){t.msg="invalid code lengths set",r.mode=QA;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;L=r.lencode[B&(1<<r.lenbits)-1],_=L>>>24,D=L>>>16&255,R=65535&L,!(_<=E);){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(R<16)B>>>=_,E-=_,r.lens[r.have++]=R;else{if(16===R){for(M=_+2;E<M;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(B>>>=_,E-=_,0===r.have){t.msg="invalid bit length repeat",r.mode=QA;break}F=r.lens[r.have-1],f=3+(3&B),B>>>=2,E-=2}else if(17===R){for(M=_+3;E<M;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}B>>>=_,E-=_,F=0,f=3+(7&B),B>>>=3,E-=3}else{for(M=_+7;E<M;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}B>>>=_,E-=_,F=0,f=11+(127&B),B>>>=7,E-=7}if(r.have+f>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=QA;break}for(;f--;)r.lens[r.have++]=F}}if(r.mode===QA)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=QA;break}if(r.lenbits=9,y={bits:r.lenbits},P=NA(1,r.lens,0,r.nlen,r.lencode,0,r.work,y),r.lenbits=y.bits,P){t.msg="invalid literal/lengths set",r.mode=QA;break}if(r.distbits=6,r.distcode=r.distdyn,y={bits:r.distbits},P=NA(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,y),r.distbits=y.bits,P){t.msg="invalid distances set",r.mode=QA;break}if(r.mode=xA,e===UA)break t;case xA:r.mode=kA;case kA:if(s>=6&&a>=258){t.next_out=o,t.avail_out=a,t.next_in=i,t.avail_in=s,r.hold=B,r.bits=E,FA(t,C),o=t.next_out,A=t.output,a=t.avail_out,i=t.next_in,n=t.input,s=t.avail_in,B=r.hold,E=r.bits,r.mode===JA&&(r.back=-1);break}for(r.back=0;L=r.lencode[B&(1<<r.lenbits)-1],_=L>>>24,D=L>>>16&255,R=65535&L,!(_<=E);){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(D&&0==(240&D)){for(I=_,T=D,h=R;L=r.lencode[h+((B&(1<<I+T)-1)>>I)],_=L>>>24,D=L>>>16&255,R=65535&L,!(I+_<=E);){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}B>>>=I,E-=I,r.back+=I}if(B>>>=_,E-=_,r.back+=_,r.length=R,0===D){r.mode=16205;break}if(32&D){r.back=-1,r.mode=JA;break}if(64&D){t.msg="invalid literal/length code",r.mode=QA;break}r.extra=15&D,r.mode=16201;case 16201:if(r.extra){for(M=r.extra;E<M;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}r.length+=B&(1<<r.extra)-1,B>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;L=r.distcode[B&(1<<r.distbits)-1],_=L>>>24,D=L>>>16&255,R=65535&L,!(_<=E);){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(0==(240&D)){for(I=_,T=D,h=R;L=r.distcode[h+((B&(1<<I+T)-1)>>I)],_=L>>>24,D=L>>>16&255,R=65535&L,!(I+_<=E);){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}B>>>=I,E-=I,r.back+=I}if(B>>>=_,E-=_,r.back+=_,64&D){t.msg="invalid distance code",r.mode=QA;break}r.offset=R,r.extra=15&D,r.mode=16203;case 16203:if(r.extra){for(M=r.extra;E<M;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}r.offset+=B&(1<<r.extra)-1,B>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=QA;break}r.mode=16204;case 16204:if(0===a)break t;if(f=C-a,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=QA;break}f>r.wnext?(f-=r.wnext,l=r.wsize-f):l=r.wnext-f,f>r.length&&(f=r.length),u=r.window}else u=A,l=o-r.offset,f=r.length;f>a&&(f=a),a-=f,r.length-=f;do{A[o++]=u[l++]}while(--f);0===r.length&&(r.mode=kA);break;case 16205:if(0===a)break t;A[o++]=r.length,a--,r.mode=kA;break;case WA:if(r.wrap){for(;E<32;){if(0===s)break t;s--,B|=n[i++]<<E,E+=8}if(C-=a,t.total_out+=C,r.total+=C,4&r.wrap&&C&&(t.adler=r.check=r.flags?Qr(r.check,A,C,o-C):kr(r.check,A,C,o-C)),C=a,4&r.wrap&&(r.flags?B:jA(B))!==r.check){t.msg="incorrect data check",r.mode=QA;break}B=0,E=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;E<32;){if(0===s)break t;s--,B+=n[i++]<<E,E+=8}if(4&r.wrap&&B!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=QA;break}B=0,E=0}r.mode=16208;case 16208:P=mA;break t;case QA:P=wA;break t;case 16210:return HA;default:return pA}return t.next_out=o,t.avail_out=a,t.next_in=i,t.avail_in=s,r.hold=B,r.bits=E,(r.wsize||C!==t.avail_out&&r.mode<QA&&(r.mode<WA||e!==SA))&&oi(t,t.output,t.next_out,C-t.avail_out),c-=t.avail_in,C-=t.avail_out,t.total_in+=c,t.total_out+=C,r.total+=C,4&r.wrap&&C&&(t.adler=r.check=r.flags?Qr(r.check,A,C,t.next_out-C):kr(r.check,A,C,t.next_out-C)),t.data_type=r.bits+(r.last?64:0)+(r.mode===JA?128:0)+(r.mode===xA||r.mode===ZA?256:0),(0===c&&0===C||e===SA)&&P===GA&&(P=KA),P},ai={inflateReset:$A,inflateReset2:ti,inflateResetKeep:qA,inflateInit:t=>ei(t,15),inflateInit2:ei,inflate:si,inflateEnd:t=>{if(zA(t))return pA;let e=t.state;return e.window&&(e.window=null),t.state=null,GA},inflateGetHeader:(t,e)=>{if(zA(t))return pA;const r=t.state;return 0==(2&r.wrap)?pA:(r.head=e,e.done=!1,GA)},inflateSetDictionary:(t,e)=>{const r=e.length;let n,A,i;return zA(t)?pA:(n=t.state,0!==n.wrap&&n.mode!==XA?pA:n.mode===XA&&(A=1,A=kr(A,e,r,0),A!==n.check)?wA:(i=oi(t,e,r,r),i?(n.mode=16210,HA):(n.havedict=1,GA)))},inflateInfo:"pako inflate (from Nodeca project)"};var Bi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ei=Object.prototype.toString,{Z_NO_FLUSH:ci,Z_FINISH:Ci,Z_OK:fi,Z_STREAM_END:li,Z_NEED_DICT:ui,Z_STREAM_ERROR:_i,Z_DATA_ERROR:Di,Z_MEM_ERROR:Ri}=Yr;function Ii(t){this.options=nA.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new sA,this.strm.avail_out=0;let r=ai.inflateInit2(this.strm,e.windowBits);if(r!==fi)throw new Error(jr[r]);if(this.header=new Bi,ai.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=oA.string2buf(e.dictionary):"[object ArrayBuffer]"===Ei.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=ai.inflateSetDictionary(this.strm,e.dictionary),r!==fi)))throw new Error(jr[r])}function Ti(t,e){const r=new Ii(e);if(r.push(t),r.err)throw r.msg||jr[r.err];return r.result}Ii.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,A=this.options.dictionary;let i,o,s;if(this.ended)return!1;for(o=e===~~e?e:!0===e?Ci:ci,"[object ArrayBuffer]"===Ei.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),i=ai.inflate(r,o),i===ui&&A&&(i=ai.inflateSetDictionary(r,A),i===fi?i=ai.inflate(r,o):i===Di&&(i=ui));r.avail_in>0&&i===li&&r.state.wrap>0&&0!==t[r.next_in];)ai.inflateReset(r),i=ai.inflate(r,o);switch(i){case _i:case Di:case ui:case Ri:return this.onEnd(i),this.ended=!0,!1}if(s=r.avail_out,r.next_out&&(0===r.avail_out||i===li))if("string"===this.options.to){let t=oA.utf8border(r.output,r.next_out),e=r.next_out-t,A=oA.buf2string(r.output,t);r.next_out=e,r.avail_out=n-e,e&&r.output.set(r.output.subarray(t,t+e),0),this.onData(A)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==fi||0!==s){if(i===li)return i=ai.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Ii.prototype.onData=function(t){this.chunks.push(t)},Ii.prototype.onEnd=function(t){t===fi&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=nA.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var hi={Inflate:Ii,inflate:Ti,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Ti(t,e)},ungzip:Ti,constants:Yr};const{Deflate:Fi,deflate:Pi,deflateRaw:Li,gzip:Oi}=TA,{Inflate:yi,inflate:Mi,inflateRaw:Ni,ungzip:Si}=hi;var di={Deflate:Fi,deflate:Pi,deflateRaw:Li,gzip:Oi,Inflate:yi,inflate:Mi,inflateRaw:Ni,ungzip:Si,constants:Yr},Ui={LUMINANCE_8:1,LUMINANCE_16:2,ALPHA:3,ALPHA_4_LUMINANCE_4:4,LUMINANCE_ALPHA:5,RGB_565:6,BGR565:7,RGB:10,BGR:11,ARGB:12,ABGR:13,BGRA:14,WEBP:25,RGBA:28,DXT1:17,DXT2:18,DXT3:19,DXT4:20,DXT5:21,CRN_DXT5:26},Gi=1,mi=2,bi=4;function pi(t,e,r,n){var A=t|e<<8,i=A>>11&31,o=A>>5&63,s=31&A;return r[n+0]=i<<3|i>>2,r[n+1]=o<<2|o>>4,r[n+2]=s<<3|s>>2,r[n+3]=255,A}var wi=new Uint8Array(16),Hi=new Uint8Array(16);function Ki(t,e,r,n){var A=0;0!=(n&(mi|bi))&&(A=8),function(t,e,r,n){for(var A=pi(e[r+0],e[r+1],wi,0),i=pi(e[r+2],e[r+3],wi,4),o=0;o<3;o++){var s=wi[o],a=wi[4+o];n&&A<=i?(wi[8+o]=(s+a)/2,wi[12+o]=0):(wi[8+o]=(2*s+a)/3,wi[12+o]=(s+2*a)/3)}for(wi[11]=255,wi[15]=n&&A<=i?0:255,o=0;o<4;++o){var B=e[r+4+o];Hi[4*o+0]=3&B,Hi[4*o+1]=B>>2&3,Hi[4*o+2]=B>>4&3,Hi[4*o+3]=B>>6&3}for(o=0;o<16;++o)for(var E=4*Hi[o],c=0;c<4;++c)t[4*o+c]=wi[E+c]}(t,e,r+A,0!=(n&Gi)),0!=(n&mi)?function(t,e,r){for(var n=0;n<8;++n){var A=bytes[r+n],i=15&A,o=240&A;t[8*n+3]=i|i<<4,t[8*n+7]=o|o>>4}}(t,0,r):0!=(n&bi)&&function(t,e,r){var n=e[r+0],A=e[r+1];if(wi[0]=n,wi[1]=A,n<=A){for(var i=1;i<5;++i)wi[1+i]=((5-i)*n+i*A)/5;wi[6]=0,wi[7]=255}else for(i=1;i<7;++i)wi[1+i]=((7-i)*n+i*A)/7;r+=2;var o=0;for(i=0;i<2;++i){for(var s=0,a=0;a<3;++a)s|=e[r++]<<8*a;for(a=0;a<8;++a){var B=s>>3*a&7;Hi[o++]=B}}for(i=0;i<16;++i)t[4*i+3]=wi[Hi[i]]}(t,e,r)}var gi=new Uint16Array(4);\n/*! @brief Decompresses an image in memory.\n\n   @param rgba\t\tStorage for the decompressed pixels.\n   @param width\tThe width of the source image.\n   @param height\tThe height of the source image.\n   @param blocks\tThe compressed DXT blocks.\n   @param flags\tCompression flags.\n\n   The decompressed pixels will be written as a contiguous array of width*height\n   16 rgba values, with each component as 1 byte each. In memory this is:\n\n   { r1, g1, b1, a1, .... , rn, gn, bn, an } for n = width*height\n\n   The flags parameter should specify either kDxt1, kDxt3 or kDxt5 compression,\n   however, DXT1 will be used by default if none is specified. All other flags\n   are ignored.\n\n   Internally this function calls squish::Decompress for each block.\n   */\nvar Vi=new Uint8Array(64);function Xi(t){}Xi.decode=function(t,e,r,n,A){if(null!=t&&null!=n&&0!=r&&0!=e){var i=0;(i=A>11||5===A?bi:32|Gi)&Gi&&32&i?function(t,e,r,n){for(var A=t,i=0,o=0,s=0,a=0,B=0,E=0,c=0,C=0,f=0,l=e/4,u=r/4,_=0;_<u;_++)for(var D=0;D<l;D++)s=4*((u-_)*l+D),gi[0]=n[s],gi[1]=n[s+1],a=31&gi[0],B=2016&gi[0],E=63488&gi[0],c=31&gi[1],C=2016&gi[1],f=63488&gi[1],gi[2]=5*a+3*c>>3|5*B+3*C>>3&2016|5*E+3*f>>3&63488,gi[3]=5*c+3*a>>3|5*C+3*B>>3&2016|5*f+3*E>>3&63488,i=n[s+2],A[o=4*_*e+4*D]=gi[3&i],A[o+1]=gi[i>>2&3],A[o+2]=gi[i>>4&3],A[o+3]=gi[i>>6&3],A[o+=e]=gi[i>>8&3],A[o+1]=gi[i>>10&3],A[o+2]=gi[i>>12&3],A[o+3]=gi[i>>14],i=n[s+3],A[o+=e]=gi[3&i],A[o+1]=gi[i>>2&3],A[o+2]=gi[i>>4&3],A[o+3]=gi[i>>6&3],A[o+=e]=gi[i>>8&3],A[o+1]=gi[i>>10&3],A[o+2]=gi[i>>12&3],A[o+3]=gi[i>>14]}(t,e,r,n):function(t,e,r,n,A,i){for(var o=0!=(A&Gi)?8:16,s=0,a=0;a<r;a+=4)for(var B=0;B<e;B+=4){Ki(Vi,n,s,A);for(var E=0,c=0;c<4;++c)for(var C=0;C<4;++C){var f=B+C,l=a+c;if(f<e&&l<r){var u=4*(e*(r-l)+f);if(i===Ui.ABGR||i===Ui.BGRA)t[u+2]=Vi[E++],t[u+1]=Vi[E++],t[u+0]=Vi[E++],t[u+3]=Vi[E++];else for(var _=0;_<4;++_)t[u++]=Vi[E++]}else E+=4}s+=o}}(t,e,r,n,i,A)}};var Ji=function(){var t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),e=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var r,n="B9h79tEBBBE8fV9gBB9gVUUUUUEU9gIUUUB9gEUEU9gIUUUEUIKQBEEEDDDILLLVE9wEEEVIEBEOWEUEC+Q/IEKR/LEdO9tw9t9vv95DBh9f9f939h79t9f9j9h229f9jT9vv7BB8a9tw79o9v9wT9f9kw9j9v9kw9WwvTw949C919m9mwvBEy9tw79o9v9wT9f9kw9j9v9kw69u9kw949C919m9mwvBDe9tw79o9v9wT9f9kw9j9v9kw69u9kw949Twg91w9u9jwBIl9tw79o9v9wT9f9kw9j9v9kws9p2Twv9P9jTBLk9tw79o9v9wT9f9kw9j9v9kws9p2Twv9R919hTBVl9tw79o9v9wT9f9kw9j9v9kws9p2Twvt949wBOL79iv9rBRQ+x8yQDBK/qMEZU8jJJJJBCJ/EB9rGV8kJJJJBC9+HODNADCEFAL0MBCUHOAIrBBC+gE9HMBAVAIALFGRAD9rADZ1JJJBHWCJ/ABAD9uC/wfBgGOCJDAOCJD6eHdAICEFHLCBHQDNINAQAE9PMEAdAEAQ9rAQAdFAE6eHKDNDNADtMBAKCSFGOC9wgHXAOCL4CIFCD4HMAWCJDFHpCBHSALHZINDNARAZ9rAM9PMBCBHLXIKAZAMFHLDNAXtMBCBHhCBHIINDNARAL9rCk9PMBCBHLXVKAWCJ/CBFAIFHODNDNDNDNDNAZAICO4FrBBAhCOg4CIgpLBEDIBKAO9CB83IBAOCWF9CB83IBXIKAOALrBLALrBBGoCO4GaAaCIsGae86BBAOCEFALCLFAaFGarBBAoCL4CIgGcAcCIsGce86BBAOCDFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCIFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCLFAaAoFGarBBALrBEGoCO4GcAcCIsGce86BBAOCVFAaAcFGarBBAoCL4CIgGcAcCIsGce86BBAOCOFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCRFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCWFAaAoFGarBBALrBDGoCO4GcAcCIsGce86BBAOCdFAaAcFGarBBAoCL4CIgGcAcCIsGce86BBAOCQFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCKFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCXFAaAoFGorBBALrBIGLCO4GaAaCIsGae86BBAOCMFAoAaFGorBBALCL4CIgGaAaCIsGae86BBAOCpFAoAaFGorBBALCD4CIgGaAaCIsGae86BBAOCSFAoAaFGOrBBALCIgGLALCIsGLe86BBAOALFHLXDKAOALrBWALrBBGoCL4GaAaCSsGae86BBAOCEFALCWFAaFGarBBAoCSgGoAoCSsGoe86BBAOCDFAaAoFGorBBALrBEGaCL4GcAcCSsGce86BBAOCIFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCLFAoAaFGorBBALrBDGaCL4GcAcCSsGce86BBAOCVFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCOFAoAaFGorBBALrBIGaCL4GcAcCSsGce86BBAOCRFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCWFAoAaFGorBBALrBLGaCL4GcAcCSsGce86BBAOCdFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCQFAoAaFGorBBALrBVGaCL4GcAcCSsGce86BBAOCKFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCXFAoAaFGorBBALrBOGaCL4GcAcCSsGce86BBAOCMFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCpFAoAaFGorBBALrBRGLCL4GaAaCSsGae86BBAOCSFAoAaFGOrBBALCSgGLALCSsGLe86BBAOALFHLXEKAOAL8pBB83BBAOCWFALCWF8pBB83BBALCZFHLKAhCDFHhAICZFGIAX6MBKKDNALMBCBHLXIKDNAKtMBAWASFrBBHhCBHOApHIINAIAWCJ/CBFAOFrBBGZCE4CBAZCEg9r7AhFGh86BBAIADFHIAOCEFGOAK9HMBKKApCEFHpALHZASCEFGSAD9HMBKKABAQAD2FAWCJDFAKAD2Z1JJJB8aAWAWCJDFAKCUFAD2FADZ1JJJB8aKAKCBALeAQFHQALMBKC9+HOXEKCBC99ARAL9rADCAADCA0eseHOKAVCJ/EBF8kJJJJBAOK+OoEZU8jJJJJBC/AE9rGV8kJJJJBC9+HODNAECI9uGRChFAL0MBCUHOAIrBBGWC/wEgC/gE9HMBAWCSgGdCE0MBAVC/ABFCfECJEZ+JJJJB8aAVCuF9CU83IBAVC8wF9CU83IBAVCYF9CU83IBAVCAF9CU83IBAVCkF9CU83IBAVCZF9CU83IBAV9CU83IWAV9CU83IBAIALFC9wFHQAICEFGWARFHKDNAEtMBCMCSAdCEseHXABHICBHdCBHMCBHpCBHLCBHOINDNAKAQ9NMBC9+HOXIKDNDNAWrBBGRC/vE0MBAVC/ABFARCL4CU7AOFCSgCITFGSYDLHZASYDBHhDNARCSgGSAX9PMBAVARCU7ALFCSgCDTFYDBAdASeHRAStHSDNDNADCD9HMBABAh87EBABCLFAR87EBABCDFAZ87EBXEKAIAhbDBAICWFARbDBAICLFAZbDBKAdASFHdAVC/ABFAOCITFGoARbDBAoAZbDLAVALCDTFARbDBAVC/ABFAOCEFCSgGOCITFGZAhbDBAZARbDLALASFHLAOCEFHOXDKDNDNASCSsMBAMASFASC987FCEFHMXEKAK8sBBGSCfEgHRDNDNASCU9MMBAKCEFHKXEKAK8sBEGSCfBgCRTARCfBgvHRDNASCU9MMBAKCDFHKXEKAK8sBDGSCfBgCpTARvHRDNASCU9MMBAKCIFHKXEKAK8sBIGSCfBgCxTARvHRDNASCU9MMBAKCLFHKXEKAKrBLC3TARvHRAKCVFHKKARCE4CBARCEg9r7AMFHMKDNDNADCD9HMBABAh87EBABCLFAM87EBABCDFAZ87EBXEKAIAhbDBAICWFAMbDBAICLFAZbDBKAVC/ABFAOCITFGRAMbDBARAZbDLAVALCDTFAMbDBAVC/ABFAOCEFCSgGOCITFGRAhbDBARAMbDLALCEFHLAOCEFHOXEKDNARCPE0MBAVALAQARCSgFrBBGSCL4GZ9rCSgCDTFYDBAdCEFGhAZeHRAVALAS9rCSgCDTFYDBAhAZtGoFGhASCSgGZeHSAZtHZDNDNADCD9HMBABAd87EBABCLFAS87EBABCDFAR87EBXEKAIAdbDBAICWFASbDBAICLFARbDBKAVALCDTFAdbDBAVC/ABFAOCITFGaARbDBAaAdbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALAoFCSgGLCDTFASbDBAVC/ABFAOCDFCSgGOCITFGRAdbDBARASbDLAOCEFHOALAZFHLAhAZFHdXEKAdCBAKrBBGaeGZARC/+EsGcFHRAaCSgHhDNDNAaCL4GoMBARCEFHSXEKARHSAVALAo9rCSgCDTFYDBHRKDNDNAhMBASCEFHdXEKASHdAVALAa9rCSgCDTFYDBHSKDNDNActMBAKCEFHaXEKAK8sBEGaCfEgHZDNDNAaCU9MMBAKCDFHaXEKAK8sBDGaCfBgCRTAZCfBgvHZDNAaCU9MMBAKCIFHaXEKAK8sBIGaCfBgCpTAZvHZDNAaCU9MMBAKCLFHaXEKAK8sBLGaCfBgCxTAZvHZDNAaCU9MMBAKCVFHaXEKAKCOFHaAKrBVC3TAZvHZKAZCE4CBAZCEg9r7AMFGMHZKDNDNAoCSsMBAaHcXEKAa8sBBGKCfEgHRDNDNAKCU9MMBAaCEFHcXEKAa8sBEGKCfBgCRTARCfBgvHRDNAKCU9MMBAaCDFHcXEKAa8sBDGKCfBgCpTARvHRDNAKCU9MMBAaCIFHcXEKAa8sBIGKCfBgCxTARvHRDNAKCU9MMBAaCLFHcXEKAaCVFHcAarBLC3TARvHRKARCE4CBARCEg9r7AMFGMHRKDNDNAhCSsMBAcHKXEKAc8sBBGKCfEgHSDNDNAKCU9MMBAcCEFHKXEKAc8sBEGKCfBgCRTASCfBgvHSDNAKCU9MMBAcCDFHKXEKAc8sBDGKCfBgCpTASvHSDNAKCU9MMBAcCIFHKXEKAc8sBIGKCfBgCxTASvHSDNAKCU9MMBAcCLFHKXEKAcCVFHKAcrBLC3TASvHSKASCE4CBASCEg9r7AMFGMHSKDNDNADCD9HMBABAZ87EBABCLFAS87EBABCDFAR87EBXEKAIAZbDBAICWFASbDBAICLFARbDBKAVC/ABFAOCITFGaARbDBAaAZbDLAVALCDTFAZbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCDFCSgCITFGRAZbDBARASbDLAVALAotAoCSsvFGLCSgCDTFASbDBALAhtAhCSsvFHLAOCIFHOKAWCEFHWABCOFHBAICXFHIAOCSgHOALCSgHLApCIFGpAE6MBKKCBC99AKAQseHOKAVC/AEF8kJJJJBAOK/tLEDU8jJJJJBCZ9rHVC9+HODNAECVFAL0MBCUHOAIrBBC/+EgC/QE9HMBAV9CB83IWAICEFHOAIALFC98FHIDNAEtMBDNADCDsMBINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKAVCWFALCEgCDTvGDALCD4CBALCE4CEg9r7ADYDBFGLbDBABALbDBABCLFHBAECUFGEMBXDKKINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKABALCD4CBALCE4CEg9r7AVCWFALCEgCDTvGLYDBFGD87EBALADbDBABCDFHBAECUFGEMBKKCBC99AOAIseHOKAOK+lVOEUE99DUD99EUD99DNDNADCL9HMBAEtMEINDNDNjBBBzjBBB+/ABCDFGD8sBB+yAB8sBBGI+yGL+L+TABCEFGV8sBBGO+yGR+L+TGWjBBBB9gGdeAWjBB/+9CAWAWnjBBBBAWAdeGQAQ+MGKAICU9KeALmGLALnAQAKAOCU9KeARmGQAQnmm+R+VGRnmGW+LjBBB9P9dtMBAW+oHIXEKCJJJJ94HIKADAI86BBDNDNjBBBzjBBB+/AQjBBBB9geAQARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKAVAD86BBDNDNjBBBzjBBB+/ALjBBBB9geALARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKABAD86BBABCLFHBAECUFGEMBXDKKAEtMBINDNDNjBBBzjBBB+/ABCLFGD8uEB+yAB8uEBGI+yGL+L+TABCDFGV8uEBGO+yGR+L+TGWjBBBB9gGdeAWjB/+fsAWAWnjBBBBAWAdeGQAQ+MGKAICU9KeALmGLALnAQAKAOCU9KeARmGQAQnmm+R+VGRnmGW+LjBBB9P9dtMBAW+oHIXEKCJJJJ94HIKADAI87EBDNDNjBBBzjBBB+/AQjBBBB9geAQARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKAVAD87EBDNDNjBBBzjBBB+/ALjBBBB9geALARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKABAD87EBABCWFHBAECUFGEMBKKK/SILIUI99IUE99DNAEtMBCBHIABHLINDNDNj/zL81zALCOF8uEBGVCIv+y+VGOAL8uEB+ynGRjB/+fsnjBBBzjBBB+/ARjBBBB9gemGW+LjBBB9P9dtMBAW+oHdXEKCJJJJ94HdKALCLF8uEBHQALCDF8uEBHKABAVCEFCIgAIvCETFAd87EBDNDNAOAK+ynGWjB/+fsnjBBBzjBBB+/AWjBBBB9gemGX+LjBBB9P9dtMBAX+oHKXEKCJJJJ94HKKABAVCDFCIgAIvCETFAK87EBDNDNAOAQ+ynGOjB/+fsnjBBBzjBBB+/AOjBBBB9gemGX+LjBBB9P9dtMBAX+oHQXEKCJJJJ94HQKABAVCUFCIgAIvCETFAQ87EBDNDNjBBJzARARn+TAWAWn+TAOAOn+TGRjBBBBARjBBBB9ge+RjB/+fsnjBBBzmGR+LjBBB9P9dtMBAR+oHQXEKCJJJJ94HQKABAVCIgAIvCETFAQ87EBALCWFHLAICLFHIAECUFGEMBKKK6BDNADCD4AE2GEtMBINABABYDBGDCWTCW91+yADCk91ClTCJJJ/8IF++nuDBABCLFHBAECUFGEMBKKK9TEIUCBCBYDJ1JJBGEABCIFC98gFGBbDJ1JJBDNDNABzBCZTGD9NMBCUHIABAD9rCffIFCZ4NBCUsMEKAEHIKAIK/lEEEUDNDNAEABvCIgtMBABHIXEKDNDNADCZ9PMBABHIXEKABHIINAIAEYDBbDBAICLFAECLFYDBbDBAICWFAECWFYDBbDBAICXFAECXFYDBbDBAICZFHIAECZFHEADC9wFGDCS0MBKKADCL6MBINAIAEYDBbDBAECLFHEAICLFHIADC98FGDCI0MBKKDNADtMBINAIAErBB86BBAICEFHIAECEFHEADCUFGDMBKKABK/AEEDUDNDNABCIgtMBABHIXEKAECfEgC+B+C+EW2HLDNDNADCZ9PMBABHIXEKABHIINAIALbDBAICXFALbDBAICWFALbDBAICLFALbDBAICZFHIADC9wFGDCS0MBKKADCL6MBINAIALbDBAICLFHIADC98FGDCI0MBKKDNADtMBINAIAE86BBAICEFHIADCUFGDMBKKABKKKEBCJWKLZ9kBB";WebAssembly.validate(t)&&(n="B9h79tEBBBE5V9gBB9gVUUUUUEU9gIUUUB9gDUUB9gEUEUIMXBBEBEEDIDIDLLVE9wEEEVIEBEOWEUEC+Q/aEKR/LEdO9tw9t9vv95DBh9f9f939h79t9f9j9h229f9jT9vv7BB8a9tw79o9v9wT9f9kw9j9v9kw9WwvTw949C919m9mwvBDy9tw79o9v9wT9f9kw9j9v9kw69u9kw949C919m9mwvBLe9tw79o9v9wT9f9kw9j9v9kw69u9kw949Twg91w9u9jwBVl9tw79o9v9wT9f9kw9j9v9kws9p2Twv9P9jTBOk9tw79o9v9wT9f9kw9j9v9kws9p2Twv9R919hTBWl9tw79o9v9wT9f9kw9j9v9kws9p2Twvt949wBQL79iv9rBKQ/j6XLBZIK9+EVU8jJJJJBCZ9rHBCBHEINCBHDCBHIINABCWFADFAICJUAEAD4CEgGLe86BBAIALFHIADCEFGDCW9HMBKAEC+Q+YJJBFAI86BBAECITC+Q1JJBFAB8pIW83IBAECEFGECJD9HMBKK1HLSUD97EUO978jJJJJBCJ/KB9rGV8kJJJJBC9+HODNADCEFAL0MBCUHOAIrBBC+gE9HMBAVAIALFGRAD9rAD/8QBBCJ/ABAD9uC/wfBgGOCJDAOCJD6eHWAICEFHOCBHdDNINAdAE9PMEAWAEAd9rAdAWFAE6eHQDNDNADtMBAQCSFGLC9wgGKCI2HXAKCETHMALCL4CIFCD4HpCBHSINAOHZCBHhDNINDNARAZ9rAp9PMBCBHOXVKAVCJ/CBFAhAK2FHoAZApFHOCBHIDNAKC/AB6MBARAO9rC/gB6MBCBHLINAoALFHIDNDNDNDNDNAZALCO4FrBBGaCIgpLBEDIBKAICBPhPKLBXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLBAOCZFHOKDNDNDNDNDNAaCD4CIgpLBEDIBKAICBPhPKLZXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLZAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLZAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLZAOCZFHOKDNDNDNDNDNAaCL4CIgpLBEDIBKAICBPhPKLAXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLAAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLAAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLAAOCZFHOKDNDNDNDNDNAaCO4pLBEDIBKAICBPhPKL8wXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBAaC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKL8wAOCLFAlPqBFAaC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBAaC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKL8wAOCWFAlPqBFAaC+Q+YJJBFrBBFHOXEKAIAOPBBBPKL8wAOCZFHOKALC/ABFHIALCJEFAK0MEAIHLARAO9rC/fB0MBKKDNAIAK9PMBAICI4HLINDNARAO9rCk9PMBCBHOXRKAoAIFHaDNDNDNDNDNAZAICO4FrBBALCOg4CIgpLBEDIBKAaCBPhPKLBXIKAaAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAaAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAaAOPBBBPKLBAOCZFHOKALCDFHLAICZFGIAK6MBKKDNAOtMBAOHZAhCEFGhCLsMDXEKKCBHOXIKDNAKtMBAVCJDFASFHIAVASFPBDBHlCBHaINAIAVCJ/CBFAaFGLPBLBGxCEP9tAxCEPSGcP9OP9hP9RGxALAKFPBLBGkCEP9tAkAcP9OP9hP9RGkPMBZEhDoIaLcVxOqRlGyALAMFPBLBG8aCEP9tA8aAcP9OP9hP9RG8aALAXFPBLBGeCEP9tAeAcP9OP9hP9RGePMBZEhDoIaLcVxOqRlG3PMBEZhDIoaLVcxORqlGcAcPMBEDIBEDIBEDIBEDIAlP9uGlPeBbDBAIADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAyA3PMWdkyQK8aeXM35pS8e8fGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAxAkPMWkdyQ8aKeX3M5p8eS8fGxA8aAePMWkdyQ8aKeX3M5p8eS8fGkPMBEZhDIoaLVcxORqlGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAxAkPMWdkyQK8aeXM35pS8e8fGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFHIAaCZFGaAK6MBKKASCLFGSAD6MBKKABAdAD2FAVCJDFAQAD2/8QBBAVAVCJDFAQCUFAD2FAD/8QBBKAQCBAOeAdFHdAOMBKC9+HOXEKCBC99ARAO9rADCAADCA0eseHOKAVCJ/KBF8kJJJJBAOKWBZ+BJJJBK+KoEZU8jJJJJBC/AE9rGV8kJJJJBC9+HODNAECI9uGRChFAL0MBCUHOAIrBBGWC/wEgC/gE9HMBAWCSgGdCE0MBAVC/ABFCfECJE/8KBAVCuF9CU83IBAVC8wF9CU83IBAVCYF9CU83IBAVCAF9CU83IBAVCkF9CU83IBAVCZF9CU83IBAV9CU83IWAV9CU83IBAIALFC9wFHQAICEFGWARFHKDNAEtMBCMCSAdCEseHXABHICBHdCBHMCBHpCBHLCBHOINDNAKAQ9NMBC9+HOXIKDNDNAWrBBGRC/vE0MBAVC/ABFARCL4CU7AOFCSgCITFGSYDLHZASYDBHhDNARCSgGSAX9PMBAVARCU7ALFCSgCDTFYDBAdASeHRAStHSDNDNADCD9HMBABAh87EBABCLFAR87EBABCDFAZ87EBXEKAIAhbDBAICWFARbDBAICLFAZbDBKAdASFHdAVC/ABFAOCITFGoARbDBAoAZbDLAVALCDTFARbDBAVC/ABFAOCEFCSgGOCITFGZAhbDBAZARbDLALASFHLAOCEFHOXDKDNDNASCSsMBAMASFASC987FCEFHMXEKAK8sBBGSCfEgHRDNDNASCU9MMBAKCEFHKXEKAK8sBEGSCfBgCRTARCfBgvHRDNASCU9MMBAKCDFHKXEKAK8sBDGSCfBgCpTARvHRDNASCU9MMBAKCIFHKXEKAK8sBIGSCfBgCxTARvHRDNASCU9MMBAKCLFHKXEKAKrBLC3TARvHRAKCVFHKKARCE4CBARCEg9r7AMFHMKDNDNADCD9HMBABAh87EBABCLFAM87EBABCDFAZ87EBXEKAIAhbDBAICWFAMbDBAICLFAZbDBKAVC/ABFAOCITFGRAMbDBARAZbDLAVALCDTFAMbDBAVC/ABFAOCEFCSgGOCITFGRAhbDBARAMbDLALCEFHLAOCEFHOXEKDNARCPE0MBAVALAQARCSgFrBBGSCL4GZ9rCSgCDTFYDBAdCEFGhAZeHRAVALAS9rCSgCDTFYDBAhAZtGoFGhASCSgGZeHSAZtHZDNDNADCD9HMBABAd87EBABCLFAS87EBABCDFAR87EBXEKAIAdbDBAICWFASbDBAICLFARbDBKAVALCDTFAdbDBAVC/ABFAOCITFGaARbDBAaAdbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALAoFCSgGLCDTFASbDBAVC/ABFAOCDFCSgGOCITFGRAdbDBARASbDLAOCEFHOALAZFHLAhAZFHdXEKAdCBAKrBBGaeGZARC/+EsGcFHRAaCSgHhDNDNAaCL4GoMBARCEFHSXEKARHSAVALAo9rCSgCDTFYDBHRKDNDNAhMBASCEFHdXEKASHdAVALAa9rCSgCDTFYDBHSKDNDNActMBAKCEFHaXEKAK8sBEGaCfEgHZDNDNAaCU9MMBAKCDFHaXEKAK8sBDGaCfBgCRTAZCfBgvHZDNAaCU9MMBAKCIFHaXEKAK8sBIGaCfBgCpTAZvHZDNAaCU9MMBAKCLFHaXEKAK8sBLGaCfBgCxTAZvHZDNAaCU9MMBAKCVFHaXEKAKCOFHaAKrBVC3TAZvHZKAZCE4CBAZCEg9r7AMFGMHZKDNDNAoCSsMBAaHcXEKAa8sBBGKCfEgHRDNDNAKCU9MMBAaCEFHcXEKAa8sBEGKCfBgCRTARCfBgvHRDNAKCU9MMBAaCDFHcXEKAa8sBDGKCfBgCpTARvHRDNAKCU9MMBAaCIFHcXEKAa8sBIGKCfBgCxTARvHRDNAKCU9MMBAaCLFHcXEKAaCVFHcAarBLC3TARvHRKARCE4CBARCEg9r7AMFGMHRKDNDNAhCSsMBAcHKXEKAc8sBBGKCfEgHSDNDNAKCU9MMBAcCEFHKXEKAc8sBEGKCfBgCRTASCfBgvHSDNAKCU9MMBAcCDFHKXEKAc8sBDGKCfBgCpTASvHSDNAKCU9MMBAcCIFHKXEKAc8sBIGKCfBgCxTASvHSDNAKCU9MMBAcCLFHKXEKAcCVFHKAcrBLC3TASvHSKASCE4CBASCEg9r7AMFGMHSKDNDNADCD9HMBABAZ87EBABCLFAS87EBABCDFAR87EBXEKAIAZbDBAICWFASbDBAICLFARbDBKAVC/ABFAOCITFGaARbDBAaAZbDLAVALCDTFAZbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCDFCSgCITFGRAZbDBARASbDLAVALAotAoCSsvFGLCSgCDTFASbDBALAhtAhCSsvFHLAOCIFHOKAWCEFHWABCOFHBAICXFHIAOCSgHOALCSgHLApCIFGpAE6MBKKCBC99AKAQseHOKAVC/AEF8kJJJJBAOK/tLEDU8jJJJJBCZ9rHVC9+HODNAECVFAL0MBCUHOAIrBBC/+EgC/QE9HMBAV9CB83IWAICEFHOAIALFC98FHIDNAEtMBDNADCDsMBINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKAVCWFALCEgCDTvGDALCD4CBALCE4CEg9r7ADYDBFGLbDBABALbDBABCLFHBAECUFGEMBXDKKINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKABALCD4CBALCE4CEg9r7AVCWFALCEgCDTvGLYDBFGD87EBALADbDBABCDFHBAECUFGEMBKKCBC99AOAIseHOKAOK/xVDIUO978jJJJJBCA9rGI8kJJJJBDNDNADCL9HMBDNAEC98gGLtMBABHDCBHVINADADPBBBGOCkP+rECkP+sEP/6EGRAOCWP+rECkP+sEP/6EARP/gEAOCZP+rECkP+sEP/6EGWP/gEP/kEP/lEGdCBPhP+2EGQARCJJJJ94PhGKP9OP9RP/kEGRjBB/+9CPaARARP/mEAdAdP/mEAWAQAWAKP9OP9RP/kEGRARP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGQP/kECfEPhP9OAOCJJJ94PhP9OP9QARAWP/mEAQP/kECWP+rECJ/+IPhP9OP9QAdAWP/mEAQP/kECZP+rECJJ/8RPhP9OP9QPKBBADCZFHDAVCLFGVAL6MBKKALAE9PMEAIAECIgGVCDTGDvCBCZAD9r/8KBAIABALCDTFGLAD/8QBBDNAVtMBAIAIPBLBGOCkP+rECkP+sEP/6EGRAOCWP+rECkP+sEP/6EARP/gEAOCZP+rECkP+sEP/6EGWP/gEP/kEP/lEGdCBPhP+2EGQARCJJJJ94PhGKP9OP9RP/kEGRjBB/+9CPaARARP/mEAdAdP/mEAWAQAWAKP9OP9RP/kEGRARP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGQP/kECfEPhP9OAOCJJJ94PhP9OP9QARAWP/mEAQP/kECWP+rECJ/+IPhP9OP9QAdAWP/mEAQP/kECZP+rECJJ/8RPhP9OP9QPKLBKALAIAD/8QBBXEKABAEC98gGDZ+HJJJBADAE9PMBAIAECIgGLCITGVFCBCAAV9r/8KBAIABADCITFGDAV/8QBBAIALZ+HJJJBADAIAV/8QBBKAICAF8kJJJJBK+yIDDUR97DNAEtMBCBHDINABCZFGIAIPBBBGLCBPhGVCJJ98P3ECJJ98P3IGOP9OABPBBBGRALPMLVORXMpScxql358e8fCffEPhP9OP/6EARALPMBEDIWdQKZhoaky8aeGLCZP+sEP/6EGWP/gEALCZP+rECZP+sEP/6EGdP/gEP/kEP/lEGLjB/+fsPaAdALAVP+2EGVAdCJJJJ94PhGQP9OP9RP/kEGdAdP/mEALALP/mEAWAVAWAQP9OP9RP/kEGLALP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGVP/kECZP+rEAdAWP/mEAVP/kECffIPhP9OP9QGdALAWP/mEAVP/kECUPSCBPlDCBPlICBPlOCBPlRCBPlQCBPlKCBPlpCBPlSP9OGLPMWdkyQK8aeXM35pS8e8fP9QPKBBABARAOP9OAdALPMBEZhDIoaLVcxORqlP9QPKBBABCAFHBADCLFGDAE6MBKKK94EIU8jJJJJBCA9rGI8kJJJJBABAEC98gGLZ+JJJJBDNALAE9PMBAIAECIgGVCITGEFCBCAAE9r/8KBAIABALCITFGBAE/8QBBAIAVZ+JJJJBABAIAE/8QBBKAICAF8kJJJJBK/hILDUE97EUV978jJJJJBCZ9rHDDNAEtMBCBHIINADABPBBBGLABCZFGVPBBBGOPMLVORXMpScxql358e8fGRCZP+sEGWCLP+rEPKLBABjBBJzPaj/zL81zPaAWCIPhP9QP/6EP/nEGWALAOPMBEDIWdQKZhoaky8aeGLCZP+rECZP+sEP/6EP/mEGOAOP/mEAWALCZP+sEP/6EP/mEGdAdP/mEAWARCZP+rECZP+sEP/6EP/mEGRARP/mEP/kEP/kEP/lECBPhP+4EP/jEjB/+fsPaGWP/mEjBBN0PaGLP/kECffIPhGQP9OAdAWP/mEALP/kECZP+rEP9QGdARAWP/mEALP/kECZP+rEAOAWP/mEALP/kEAQP9OP9QGWPMBEZhDIoaLVcxORqlGLP5BADPBLBPeB+t+J83IBABCWFALP5EADPBLBPeE+t+J83IBAVAdAWPMWdkyQK8aeXM35pS8e8fGWP5BADPBLBPeD+t+J83IBABCkFAWP5EADPBLBPeI+t+J83IBABCAFHBAICLFGIAE6MBKKK/3EDIUE978jJJJJBC/AB9rHIDNADCD4AE2GLC98gGVtMBCBHDABHEINAEAEPBBBGOCWP+rECWP+sEP/6EAOCkP+sEClP+rECJJJ/8IPhP+uEP/mEPKBBAECZFHEADCLFGDAV6MBKKDNAVAL9PMBAIALCIgGDCDTGEvCBC/ABAE9r/8KBAIABAVCDTFGVAE/8QBBDNADtMBAIAIPBLBGOCWP+rECWP+sEP/6EAOCkP+sEClP+rECJJJ/8IPhP+uEP/mEPKLBKAVAIAE/8QBBKK9TEIUCBCBYDJ1JJBGEABCIFC98gFGBbDJ1JJBDNDNABzBCZTGD9NMBCUHIABAD9rCffIFCZ4NBCUsMEKAEHIKAIKKKEBCJWKLZ9tBB");var A=WebAssembly.instantiate(function(t){for(var r=new Uint8Array(t.length),n=0;n<t.length;++n){var A=t.charCodeAt(n);r[n]=A>96?A-71:A>64?A-65:A>47?A+4:A>46?63:62}var i=0;for(n=0;n<t.length;++n)r[i++]=r[n]<60?e[r[n]]:64*(r[n]-60)+r[++n];return r.buffer.slice(0,i)}(n),{}).then((function(t){(r=t.instance).exports.__wasm_call_ctors()}));function i(t,e,n,A,i,o){var s=r.exports.sbrk,a=n+3&-4,B=s(a*A),E=s(i.length),c=new Uint8Array(r.exports.memory.buffer);c.set(i,E);var C=t(B,n,A,E,i.length);if(0==C&&o&&o(B,a,A),e.set(c.subarray(B,B+n*A)),s(B-s(0)),0!=C)throw new Error("Malformed buffer data: "+C)}var o={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},s={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:A,supported:!0,decodeVertexBuffer:function(t,e,n,A,s){i(r.exports.meshopt_decodeVertexBuffer,t,e,n,A,r.exports[o[s]])},decodeIndexBuffer:function(t,e,n,A){i(r.exports.meshopt_decodeIndexBuffer,t,e,n,A)},decodeIndexSequence:function(t,e,n,A){i(r.exports.meshopt_decodeIndexSequence,t,e,n,A)},decodeGltfBuffer:function(t,e,n,A,a,B){i(r.exports[s[a]],t,e,n,A,r.exports[o[B]])}}}();function vi(){}vi.s3tc=!0,vi.pvrtc=!1,vi.etc1=!1;const Zi={SV_Unkown:0,SV_Standard:1,SV_Compressed:2,SV_DracoCompressed:3},xi={Standard:0,Draco:1,MeshOpt:2},ki={0:Uint32Array.BYTES_PER_ELEMENT,1:Float32Array.BYTES_PER_ELEMENT,2:Float64Array.BYTES_PER_ELEMENT},Wi={LUMINANCE_8:1,LUMINANCE_16:2,ALPHA:3,ALPHA_4_LUMINANCE_4:4,LUMINANCE_ALPHA:5,RGB_565:6,BGR565:7,RGB:10,BGR:11,ARGB:12,ABGR:13,BGRA:14,WEBP:25,RGBA:28,DXT1:17,DXT2:18,DXT3:19,DXT4:20,DXT5:21,CRN_DXT5:26,STANDARD_CRN:27},Qi={SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32},ji={Invalid:0,Position:1,PositionW:2,Normal:4,Tangent:8,FirstTexcoord:16,SecondTexcoord:32,Color:64,SecondColor:128,Custom0:512,Custom1:1024};function Yi(t,e,r){r=t.byteLength;return t=t.subarray(0,0+r),new TextDecoder("utf-8").decode(t)}function zi(t,e,r){let n=e.getUint32(r,!0);return r+=Uint32Array.BYTES_PER_ELEMENT,{string:Yi(new Uint8Array(t,r,n)),bytesOffset:r+=n,length:n}}function qi(t,e,r,n){let A={},i=[],o=new Array(16);for(let t=0;t<16;t++)o[t]=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;A.matrix=o,A.skeletonNames=i;let s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let n=0;n<s;n++){let n=zi(t,e,r);i.push(n.string),r=n.bytesOffset}return n.push(A),r}function $i(t,e,r,n,A){let i={};i.rangeList=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,i.rangeMode=e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let o={};o.x=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,o.y=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,o.z=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;let s=e.getFloat64(r,!0);if(r+=Float64Array.BYTES_PER_ELEMENT,i.boundingSphere={center:o,radius:s},3===A){const t={};t.x=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,t.y=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,t.z=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;const n={};n.x=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,n.y=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,n.z=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;const A={};A.x=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,A.y=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,A.z=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;const o={};o.x=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,o.y=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,o.z=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,i.obb={xExtent:n,yExtent:A,zExtent:o,obbCenter:t}}let a=zi(t,e,r),B=a.string;r=a.bytesOffset;let E=B.indexOf("Geometry");if(-1!==E){let t=B.substring(E);B=B.replace(t,"")}i.childTile=B,i.geodes=[];let c=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let n=0;n<c;n++)r=qi(t,e,r,i.geodes);if(n.push(i),3===A){r=zi(t,e,r).bytesOffset}return r}function to(t,e,r,n){let A=e.getUint32(r,!0);if(n.verticesCount=A,(r+=Uint32Array.BYTES_PER_ELEMENT)<=0)return r;let i=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let o=e.getUint16(r,!0);o=i*Float32Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;let s=A*i*Float32Array.BYTES_PER_ELEMENT,a=new Uint8Array(t,r,s);r+=s;let B=n.vertexAttributes,E=n.attrLocation;return E.aPosition=B.length,B.push({index:E.aPosition,typedArray:a,componentsPerAttribute:i,componentDatatype:5126,offsetInBytes:0,strideInBytes:o,normalize:!1}),r}function eo(t,e,r,n){let A=e.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,A<=0)return r;let i=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let o=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let s=A*i*Float32Array.BYTES_PER_ELEMENT,a=new Uint8Array(t,r,s);r+=s;let B=n.vertexAttributes,E=n.attrLocation;return E.aNormal=B.length,B.push({index:E.aNormal,typedArray:a,componentsPerAttribute:i,componentDatatype:5126,offsetInBytes:0,strideInBytes:o,normalize:!1}),r}function ro(t,e,r,n){let A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let i,o=n.verticesCount;if(A>0){e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,r+=2*Uint8Array.BYTES_PER_ELEMENT;let n=A*Uint8Array.BYTES_PER_ELEMENT*4;i=new Uint8Array(t,r,n).slice(0,n),r+=n}else{i=new Uint8Array(4*o);for(let t=0;t<o;t++)i[4*t]=255,i[4*t+1]=255,i[4*t+2]=255,i[4*t+3]=255}let s=n.vertexAttributes,a=n.attrLocation;return a.aColor=s.length,s.push({index:a.aColor,typedArray:i,componentsPerAttribute:4,componentDatatype:5121,offsetInBytes:0,strideInBytes:4,normalize:!0}),n.vertexColor=i,r}function no(t,e,r,n){let A=e.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,A<=0)return r;e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,r+=2*Uint8Array.BYTES_PER_ELEMENT;let i=A*Uint8Array.BYTES_PER_ELEMENT*4,o=new Uint8Array(t,r,i);r+=i;let s=n.vertexAttributes,a=n.attrLocation;return a.aSecondColor=s.length,s.push({index:a.aSecondColor,typedArray:o,componentsPerAttribute:4,componentDatatype:5121,offsetInBytes:0,strideInBytes:4,normalize:!0}),r}function Ao(t,e,r,n){let A=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;for(let i=0;i<A;i++){let A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let o=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let s=A*o*Float32Array.BYTES_PER_ELEMENT,a=new Uint8Array(t,r,s);r+=s;let B="aTexCoord"+i,E=n.vertexAttributes,c=n.attrLocation;c[B]=E.length,E.push({index:c[B],typedArray:a,componentsPerAttribute:o,componentDatatype:5126,offsetInBytes:0,strideInBytes:o*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}return r}function io(t,e,r,n){let A=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;let i=n.vertexAttributes,o=n.attrLocation;for(let s=0;s<A;s++){let A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let s=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let a=A*s*Float32Array.BYTES_PER_ELEMENT;if(17===s||29===s){let e=new Uint8Array(t,r,a);n.instanceCount=A,n.instanceMode=s,n.instanceBuffer=e,n.instanceIndex=1;let B,E=s*A*4,c=e.slice(0,E);n.vertexColorInstance=c,17===s?(B=17*Float32Array.BYTES_PER_ELEMENT,o.uv2=i.length,i.push({index:o.uv2,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:0,strideInBytes:B,instanceDivisor:1}),o.uv3=i.length,i.push({index:o.uv3,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.uv4=i.length,i.push({index:o.uv4,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.secondary_colour=i.length,i.push({index:o.secondary_colour,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.uv6=i.length,i.push({index:o.uv6,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1})):29===s&&(B=29*Float32Array.BYTES_PER_ELEMENT,o.uv1=i.length,i.push({index:o.uv1,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:0,strideInBytes:B,instanceDivisor:1,byteLength:a}),o.uv2=i.length,i.push({index:o.uv2,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.uv3=i.length,i.push({index:o.uv3,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.uv4=i.length,i.push({index:o.uv4,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.uv5=i.length,i.push({index:o.uv5,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.uv6=i.length,i.push({index:o.uv6,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.uv7=i.length,i.push({index:o.uv7,componentsPerAttribute:3,componentDatatype:5126,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.secondary_colour=i.length,i.push({index:o.secondary_colour,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}),o.uv9=i.length,i.push({index:o.uv9,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:28*Float32Array.BYTES_PER_ELEMENT,strideInBytes:B,instanceDivisor:1}))}else{let t=A*s;n.instanceBounds=new Float32Array(t);for(let A=0;A<t;A++)n.instanceBounds[A]=e.getFloat32(r+A*Float32Array.BYTES_PER_ELEMENT,!0)}r+=a}return r}function oo(t,e,r,n,A){if(3===A&&(e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT),r=ro(t,e,r=eo(t,e,r=to(t,e,r,n),n),n),3!==A&&(r=no(t,e,r,n)),r=io(t,e,r=Ao(t,e,r,n),n),3===A){r=function(t,e,r,n){const A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let i=0;i<A;i++){const A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const o=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;const s=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;const a=A*o*ki[s],B=new Uint8Array(t,r,a);r+=a;const E=n.vertexAttributes,c=n.attrLocation,C="aCustom"+i;c[C]=E.length,E.push({index:c[C],typedArray:B,componentsPerAttribute:o,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,normalize:!1})}return r}(t,e,r,n);const A=zi(t,e,r);r=A.bytesOffset,n.customVertexAttribute=JSON.parse(A.string);const i="aCustom"+n.customVertexAttribute.TextureCoordMatrix,o="aCustom"+n.customVertexAttribute.VertexWeight;void 0!==n.attrLocation[i]&&(n.attrLocation.aTextureCoordMatrix=n.attrLocation[i],delete n.attrLocation[i]),void 0!==n.attrLocation[o]&&(n.attrLocation.aVertexWeight=n.attrLocation[o],delete n.attrLocation[o]);let s=r%4;s&&(s=4-s),r=function(t,e,r,n){const A=e.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,A<=0)return r;const i=e.getUint16(r,!0);return r+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,r+=A*i*Float32Array.BYTES_PER_ELEMENT}(0,e,r+=s)}return r}function so(t,e,r,n,A,i){let o,s=0;const a=A.vertexAttributes,B=A.attrLocation;switch(e){case ji.Normal:case ji.FirstTexcoord:case ji.SecondTexcoord:s=2*Uint16Array.BYTES_PER_ELEMENT,0!=(16&i)||e!==ji.FirstTexcoord&&e!==ji.SecondTexcoord||(s=2*Float32Array.BYTES_PER_ELEMENT),o=new Uint8Array(t*s);break;case ji.Color:case ji.SecondColor:s=4*Uint8Array.BYTES_PER_ELEMENT,o=new Uint8Array(4*t);break;case ji.Custom0:case ji.Custom1:s=Float32Array.BYTES_PER_ELEMENT*r,o=new Uint8Array(t*r*4);break;default:s=4*Uint16Array.BYTES_PER_ELEMENT,o=new Uint8Array(t*s)}let E,c;switch(Ji.decodeVertexBuffer(o,t,s,n,n.length),e){case ji.Position:B.aPosition=a.length,a.push({index:B.aPosition,typedArray:new Uint16Array(o.buffer,0,o.length/2),componentsPerAttribute:4,componentDatatype:5122,offsetInBytes:0,strideInBytes:0,normalize:!1}),A.verticesCount=t;break;case ji.Normal:B.aNormal=a.length,a.push({index:B.aNormal,typedArray:new Int16Array(o.buffer,0,o.length/2),componentsPerAttribute:2,componentDatatype:5122,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case ji.FirstTexcoord:0==(16&i)?(c=5126,E=new Float32Array(o.buffer,0,o.length/4)):(c=5122,E=new Uint16Array(o.buffer,0,o.length/2)),B.aTexCoord0=a.length,a.push({index:B.aTexCoord0,typedArray:E,componentsPerAttribute:2,componentDatatype:c,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case ji.SecondTexcoord:0==(16&i)?(c=5126,E=new Float32Array(o.buffer,0,o.length/4)):(c=5122,E=new Uint16Array(o.buffer,0,o.length/2)),B.aTexCoord1=a.length,a.push({index:B.aTexCoord1,typedArray:E,componentsPerAttribute:2,componentDatatype:c,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case ji.Color:B.aColor=a.length,a.push({index:B.aColor,typedArray:o,componentsPerAttribute:4,componentDatatype:5121,offsetInBytes:0,strideInBytes:0,normalize:!0});break;case ji.SecondColor:B.aSecondColor=a.length,a.push({index:B.aSecondColor,typedArray:o,componentsPerAttribute:4,componentDatatype:5120,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case ji.Custom0:B.aCustom0=a.length,a.push({index:B.aCustom0,typedArray:new Float32Array(o.buffer,0,o.length/4),componentsPerAttribute:r,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case ji.Custom1:B.aCustom1=a.length,a.push({index:B.aCustom1,typedArray:new Float32Array(o.buffer,0,o.length/4),componentsPerAttribute:r,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,normalize:!1})}}function ao(t,e,r,n,A){const i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT,n.compressOptions=i;const o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT,n.minVerticesValue={x:0,y:0,z:0,w:0},n.minTexCoordValue=[{x:0,y:0},{x:0,y:0}],n.texCoordCompressConstant=[{x:0,y:0,z:0},{x:0,y:0,z:0}];for(let A=0;A<o;A++){const s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT,n.vertCompressConstant=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,n.minVerticesValue.x=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,n.minVerticesValue.y=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,n.minVerticesValue.z=e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;const a=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT;const B=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT;const E=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT;const c=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT;const C=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT;const f=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT;const l=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT;const u=e.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT,n.minTexCoordValue[0].x=E,n.minTexCoordValue[0].y=c,n.minTexCoordValue[1].x=l,n.minTexCoordValue[1].y=u,n.texCoordCompressConstant[0].x=a,n.texCoordCompressConstant[0].y=B,n.texCoordCompressConstant[1].x=C,n.texCoordCompressConstant[1].y=f;const _=e.getInt32(r,!0);r+=Int32Array.BYTES_PER_ELEMENT;for(let A=0;A<_;A++){const A=e.getInt32(r,!0);r+=Int32Array.BYTES_PER_ELEMENT;let o=0;A!==ji.Custom0&&A!==ji.Custom1||(o=e.getInt32(r,!0),r+=Int32Array.BYTES_PER_ELEMENT);const a=e.getInt32(r,!0);r+=Int32Array.BYTES_PER_ELEMENT;const B=new Uint8Array(t,r,a);let E=(r+=Uint8Array.BYTES_PER_ELEMENT*a)%4;E&&(E=4-E),r+=E,so(s,A,o,B,n,i)}let D=zi(t,e,r);r=D.bytesOffset,n.customVertexAttribute=JSON.parse(D.string);let R="aCustom"+n.customVertexAttribute.TextureCoordMatrix,I="aCustom"+n.customVertexAttribute.VertexWeight;void 0!==n.attrLocation[R]&&(n.attrLocation.aTextureCoordMatrix=n.attrLocation[R],A===o-1&&delete n.attrLocation[R]),void 0!==n.attrLocation[I]&&(n.attrLocation.aVertexWeight=n.attrLocation[I],A===o-1&&delete n.attrLocation[I]);let T=r%4;T&&(T=4-T),r+=T}return r}function Bo(t,e,r,n,A){const i=e.getInt32(r,!0);r+=Int32Array.BYTES_PER_ELEMENT;for(let A=0;A<i;A++){const A={},i=e.getInt32(r,!0);if(r+=Int32Array.BYTES_PER_ELEMENT,i<1)continue;const o=e.getInt8(r,!0);r+=Int8Array.BYTES_PER_ELEMENT,e.getInt8(r,!0),r+=Int8Array.BYTES_PER_ELEMENT;const s=e.getInt8(r,!0);r+=Int8Array.BYTES_PER_ELEMENT,e.getInt8(r,!0),r+=Int8Array.BYTES_PER_ELEMENT;const a=e.getInt32(r,!0);let B;r+=Int32Array.BYTES_PER_ELEMENT,13!==s?(B=new Uint8Array(t,r,a),r+=Uint8Array.BYTES_PER_ELEMENT*a):(B=new Uint32Array(t,r,a),r+=Uint32Array.BYTES_PER_ELEMENT*a);let E,c=r%4;c&&(c=4-c),r+=c,13!==s?(E=new Uint8Array(i*Uint32Array.BYTES_PER_ELEMENT),Ji.decodeIndexBuffer(E,i,Uint32Array.BYTES_PER_ELEMENT,B)):E=B;const C=e.getInt32(r,!0);r+=Int32Array.BYTES_PER_ELEMENT,A.indexType=o;const f=0===o?new Uint16Array(i):new Uint32Array(i);A.indicesCount=i;const l=new Uint32Array(E.buffer,E.byteOffset,E.byteLength/4);f.set(l,0),A.indicesTypedArray=f,A.primitiveType=s;for(let n=0;n<C;n++){const n=zi(t,e,r);r=n.bytesOffset,A.materialCode=n.string}n.push(A),c=r%4,c&&(c=4-c),r+=c}return r}function Eo(t,e,r,n){let A=e.getUint32(r,!0);return n.compressOptions=A,r+=Uint32Array.BYTES_PER_ELEMENT,r=(A&Qi.SVC_Vertex)===Qi.SVC_Vertex?function(t,e,r,n){let A=e.getUint32(r,!0);if(n.verticesCount=A,(r+=Uint32Array.BYTES_PER_ELEMENT)<=0)return r;let i=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let o=e.getUint16(r,!0);o=i*Int16Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;let s=e.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT;let a={};a.x=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,a.y=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,a.z=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,a.w=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,n.vertCompressConstant=s,n.minVerticesValue=a;let B=A*i*Int16Array.BYTES_PER_ELEMENT,E=new Uint8Array(t,r,B);r+=B;let c=n.vertexAttributes,C=n.attrLocation;return C.aPosition=c.length,c.push({index:C.aPosition,typedArray:E,componentsPerAttribute:i,componentDatatype:5122,offsetInBytes:0,strideInBytes:o,normalize:!1}),r}(t,e,r,n):to(t,e,r,n),r=(A&Qi.SVC_Normal)===Qi.SVC_Normal?function(t,e,r,n){let A=e.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,A<=0)return r;e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let i=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT;let o=2*A*Int16Array.BYTES_PER_ELEMENT,s=new Uint8Array(t,r,o);r+=o;let a=n.vertexAttributes,B=n.attrLocation;return B.aNormal=a.length,a.push({index:B.aNormal,typedArray:s,componentsPerAttribute:2,componentDatatype:5122,offsetInBytes:0,strideInBytes:i,normalize:!1}),r}(t,e,r,n):eo(t,e,r,n),r=no(t,e,r=ro(t,e,r,n),n),r=(A&Qi.SVC_TexutreCoord)===Qi.SVC_TexutreCoord?function(t,e,r,n){n.texCoordCompressConstant=[],n.minTexCoordValue=[];let A=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,r+=Uint16Array.BYTES_PER_ELEMENT;for(let i=0;i<A;i++){let A=e.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT,r+=3*Uint8Array.BYTES_PER_ELEMENT;let o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let s=e.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT;let a=e.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT,n.texCoordCompressConstant.push(a);let B={};B.x=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,B.y=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,B.z=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,B.w=e.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,n.minTexCoordValue.push(B);let E=o*s*Int16Array.BYTES_PER_ELEMENT,c=new Uint8Array(t,r,E),C=(r+=E)%4;0!==C&&(r+=4-C);let f="aTexCoord"+i,l=n.vertexAttributes,u=n.attrLocation;if(u[f]=l.length,l.push({index:u[f],typedArray:c,componentsPerAttribute:s,componentDatatype:5122,offsetInBytes:0,strideInBytes:s*Int16Array.BYTES_PER_ELEMENT,normalize:!1}),A){E=o*Float32Array.BYTES_PER_ELEMENT;let e=new Uint8Array(t,r,E);r+=E,n.texCoordZMatrix=!0,f="aTexCoordZ"+i,u[f]=l.length,l.push({index:u[f],typedArray:e,componentsPerAttribute:1,componentDatatype:5126,offsetInBytes:0,strideInBytes:Float32Array.BYTES_PER_ELEMENT,normalize:!1})}}return r}(t,e,r,n):Ao(t,e,r,n),(A&Qi.SVC_TexutreCoordIsW)===Qi.SVC_TexutreCoordIsW&&(n.textureCoordIsW=!0),r=io(t,e,r,n)}function co(t,e,r,n,A){let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let o=0;o<i;o++){let i={};3===A&&(e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT);let o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let s=e.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT,e.getUint8(r,!0),r+=Uint8Array.BYTES_PER_ELEMENT;let a=e.getUint8(r,!0);if(r+=Uint8Array.BYTES_PER_ELEMENT,r+=Uint8Array.BYTES_PER_ELEMENT,o>0){let e,n=null;1===s||3===s?(e=o*Uint32Array.BYTES_PER_ELEMENT,n=new Uint8Array(t,r,e)):(e=o*Uint16Array.BYTES_PER_ELEMENT,n=new Uint8Array(t,r,e),o%2!=0&&(e+=2)),i.indicesTypedArray=n,r+=e}i.indicesCount=o,i.indexType=s,i.primitiveType=a;let B=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let n=0;n<B;n++){let n=zi(t,e,r),A=n.string;r=n.bytesOffset,i.materialCode=A}if(0!==r%4){r+=4-r%4}n.push(i)}return r}let Co={red:0,green:0,blue:0,alpha:0},fo=65536;function lo(t,e,r){let n=t.vertexAttributes,A=t.attrLocation,i=n.length;A[1===r?"instanceId":"batchId"]=i,n.push({index:i,typedArray:e,componentsPerAttribute:1,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,instanceDivisor:r})}vi.parseBuffer=function(t){let e=0,r={version:void 0,groupNode:void 0,geoPackage:{},matrials:void 0,texturePackage:{}},n=new DataView(t);r.version=n.getFloat32(e,!0),e+=Float32Array.BYTES_PER_ELEMENT,r.version>=2&&(n.getUint32(e,!0),e+=Uint32Array.BYTES_PER_ELEMENT),r.version>=3&&(n.getUint32(e,!0),e+=Uint32Array.BYTES_PER_ELEMENT),n.getUint32(e,!0),e+=Uint32Array.BYTES_PER_ELEMENT;let A=function(t,e){let r=new Uint8Array(t,e);return di.inflate(r).buffer}(t,e);n=new DataView(A),e=0;let i=n.getUint32(e,!0);return e+=Uint32Array.BYTES_PER_ELEMENT,e=function(t,e,r,n){let A={},i=[];e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let o=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let A=0;A<o;A++)r=$i(t,e,r,i,n.version);A.pageLods=i;let s=r%4;return 0!==s&&(r+=4-s),n.groupNode=A,r}(A,n,e,r),e=function(t,e,r,n,A){e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let o=0;o<i;o++){3===A&&(e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT);let i=zi(t,e,r),o=i.string;r=i.bytesOffset;let s=i.length%4;0!==s&&(r+=4-s);let a=e.getUint32(r,!0);if(r+=Int32Array.BYTES_PER_ELEMENT,3===A)switch(a){case xi.Standard:a=Zi.SV_Standard;break;case xi.Draco:a=Zi.SV_DracoCompressed;break;case xi.MeshOpt:a=Zi.SV_Compressed}let B={vertexAttributes:[],attrLocation:{},instanceCount:0,instanceMode:0,instanceIndex:-1};a===Zi.SV_Standard?r=oo(t,e,r,B,A):a===Zi.SV_Compressed&&3===A?r=ao(t,e,r,B):a===Zi.SV_Compressed&&(r=Eo(t,e,r,B));let E,c=[];r=a===Zi.SV_Compressed&&3===A?Bo(t,e,r,c):co(t,e,r,c,A),2===c.length&&13===c[1].primitiveType&&c[1].indicesCount>=3&&(E=S3MEdgeProcessor.createEdgeDataByIndices(B,c[1])),n[o]={vertexPackage:B,arrIndexPackage:c,edgeGeometry:E},3===A&&(e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,e.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT)}3!==A&&(r+=e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT);return r}(A,n,e,r.geoPackage,r.version),e=function(t,e,r,n){e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let i=0;i<A;i++){let A=zi(t,e,r),i=A.string;r=A.bytesOffset;let o=A.length%4;0!==o&&(r+=4-o),e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let a=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let B=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let E=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let c=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let C=new Uint8Array(t,r,E);r+=E;let f=c===Wi.RGB||c===Wi.BGR?33776:33779;if(22===B&&(f=36196),!vi.s3tc&&(33776===f||33779===f)){let t=new Uint8Array(s*a*4);Xi.decode(t,s,a,C,c),C=t,B=0,f=c===Wi.RGB||c===Wi.RGB?273:4369}n[i]={id:i,width:s,height:a,compressType:B,nFormat:c,internalFormat:f,arrayBufferView:C}}return r}(A,n,e,r.texturePackage),e=function(t,e,r,n){let A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let i=Yi(new Uint8Array(t,r,A));return r+=A,n.materials=JSON.parse(i),r}(A,n,e,r),function(t,e,r,n,A,i){if(3===i&&(n=e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT),1==(1&n)){e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;let n=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let o=0;o<n;o++){let n=zi(t,e,r),o=n.string;r=n.bytesOffset;let s=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let a={};if(A[o].pickInfo=a,-1==A[o].vertexPackage.instanceIndex){let t=new Float32Array(A[o].vertexPackage.verticesCount);for(let n=0;n<s;n++){let A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let o=[];for(let A=0;A<i;A++){let A=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;let i=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT,t.fill(n,A,A+i),o.push({vertexColorOffset:A,vertexColorCount:i,batchId:n})}a[A]=o}lo(A[o].vertexPackage,t,void 0)}else{let t=A[o].vertexPackage.instanceCount,n=A[o].vertexPackage.instanceBuffer,B=A[o].vertexPackage.instanceMode,E=new Float32Array(t),c=[];for(let t=0;t<s;t++){let t=e.getUint32(r,!0);c.push(t),r+=Uint32Array.BYTES_PER_ELEMENT;let n=e.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let t=0;t<n;t++)e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,3===i&&(e.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT)}let C=17===B?16:28;C*=Float32Array.BYTES_PER_ELEMENT;for(let e=0;e<t;e++){E[e]=e;let t=e*B*Float32Array.BYTES_PER_ELEMENT+C;Cesium.Color.unpack(n,t,Co);let r=2===i?c[e]:Co.red+256*Co.green+Co.blue*fo;void 0===a[r]&&(a[r]={vertexColorCount:1,instanceIds:[],vertexColorOffset:e}),a[r].instanceIds.push(e)}lo(A[o].vertexPackage,E,1)}}}}(A,n,e,i,r.geoPackage,r.version),r};class uo{constructor(t,e,{width:r,height:n,colorDepth:A,format:i}){if(this.format=i,this.offset=e,this.depth=A,this.stride=\n/*!\n   * decode-bmp\n   * https://github.com/LinusU/decode-bmp\n   * MIT License\n   */\nfunction(t){const e=t%4;return e?t+4-e:t}(r*this.depth/8),this.size=this.stride*n,this.data=t.subarray(this.offset,this.offset+this.size),this.size!==this.data.byteLength)throw new Error("Truncated bitmap data")}get(t,e,r){const n=this.format.indexOf(r);if(1===this.depth){return(this.data[e*this.stride+(t/8|0)]&1<<7-t%8*1)>>7-t%8*1}if(2===this.depth){return(this.data[e*this.stride+(t/4|0)]&3<<6-t%4*2)>>>6-t%4*2}if(4===this.depth){return(this.data[e*this.stride+(t/2|0)]&15<<4-t%2*4)>>>4-t%2*4}return this.data[e*this.stride+t*(this.depth/8)+n]}}function _o(t,e,r,n,{width:A=0,height:i=0,icon:o=!1}={}){const s=new DataView(e,r,n);let a,B,E,c,C;o?(a=s.getUint32(0,!0),B=s.getUint32(4,!0)/1|0,E=s.getUint32(8,!0)/2|0,c=s.getUint16(14,!0),C=s.getUint32(32,!0)):(!function(t){if(19778!==t)throw new Error(`Invalid magic byte 0x${t.toString(16)}`)}(s.getUint16(0,!0)),a=14+s.getUint32(14,!0),B=s.getUint32(18,!0),E=s.getUint32(22,!0),c=s.getUint16(28,!0),C=s.getUint32(46,!0)),0===C&&c<=8&&(C=1<<c);const f=0===B?A:B,l=0===E?i:E,u=new Uint8Array(s.buffer,s.byteOffset+a,s.byteLength-a),_=t.byteLength===f*l*4,D=C?function(t,e,r,{width:n,height:A,colorDepth:i,colorCount:o,icon:s}){if(8!==i&&4!==i&&2!==i&&1!==i)throw new Error(`A color depth of ${i} is not supported`);const a=new uo(r,0,{width:o,height:1,colorDepth:32,format:"BGRA"}),B=new uo(r,a.offset+a.size,{width:n,height:A,colorDepth:i,format:"C"}),E=s?new uo(r,B.offset+B.size,{width:n,height:A,colorDepth:1,format:"A"}):null,c=t;let C=0;for(let t=0;t<A;t++)for(let r=0;r<n;r++){const n=B.get(r,A-t-1,"C");c[C++]=a.get(n,0,"R"),c[C++]=a.get(n,0,"G"),c[C++]=a.get(n,0,"B"),e&&(c[C++]=E&&E.get(r,A-t-1,"A")?0:255)}return c}(t,_,u,{width:f,height:l,colorDepth:c,colorCount:C,icon:o}):function(t,e,r,{width:n,height:A,colorDepth:i,icon:o}){if(32!==i&&24!==i)throw new Error(`A color depth of ${i} is not supported`);const s=new uo(r,0,{width:n,height:A,colorDepth:i,format:"BGRA"}),a=24===i&&o?new uo(r,s.offset+s.size,{width:n,height:A,colorDepth:1,format:"A"}):null,B=t;let E=0;for(let t=0;t<A;t++)for(let r=0;r<n;r++)B[E++]=s.get(r,A-t-1,"R"),B[E++]=s.get(r,A-t-1,"G"),B[E++]=s.get(r,A-t-1,"B"),e&&(B[E++]=32===i?s.get(r,A-t-1,"A"):a&&a.get(r,A-t-1,"A")?0:255);return B}(t,_,u,{width:f,height:l,colorDepth:c,icon:o});return D}var Do=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),Ro={UNSIGNED_BYTE:Do.UNSIGNED_BYTE,UNSIGNED_SHORT:Do.UNSIGNED_SHORT,UNSIGNED_INT:Do.UNSIGNED_INT,FLOAT:Do.FLOAT,HALF_FLOAT:Do.HALF_FLOAT_OES,UNSIGNED_INT_24_8:Do.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:Do.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:Do.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:Do.UNSIGNED_SHORT_5_6_5,toWebGLConstant:function(t,e){switch(t){case Ro.UNSIGNED_BYTE:return Do.UNSIGNED_BYTE;case Ro.UNSIGNED_SHORT:return Do.UNSIGNED_SHORT;case Ro.UNSIGNED_INT:return Do.UNSIGNED_INT;case Ro.FLOAT:return Do.FLOAT;case Ro.HALF_FLOAT:return e.webgl2?Do.HALF_FLOAT:Do.HALF_FLOAT_OES;case Ro.UNSIGNED_INT_24_8:return Do.UNSIGNED_INT_24_8;case Ro.UNSIGNED_SHORT_4_4_4_4:return Do.UNSIGNED_SHORT_4_4_4_4;case Ro.UNSIGNED_SHORT_5_5_5_1:return Do.UNSIGNED_SHORT_5_5_5_1;case Ro.UNSIGNED_SHORT_5_6_5:return Ro.UNSIGNED_SHORT_5_6_5}},isPacked:function(t){return t===Ro.UNSIGNED_INT_24_8||t===Ro.UNSIGNED_SHORT_4_4_4_4||t===Ro.UNSIGNED_SHORT_5_5_5_1||t===Ro.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(t){switch(t){case Ro.UNSIGNED_BYTE:return 1;case Ro.UNSIGNED_SHORT:case Ro.UNSIGNED_SHORT_4_4_4_4:case Ro.UNSIGNED_SHORT_5_5_5_1:case Ro.UNSIGNED_SHORT_5_6_5:case Ro.HALF_FLOAT:return 2;case Ro.UNSIGNED_INT:case Ro.FLOAT:case Ro.UNSIGNED_INT_24_8:return 4}},validate:function(t){return t===Ro.UNSIGNED_BYTE||t===Ro.UNSIGNED_SHORT||t===Ro.UNSIGNED_INT||t===Ro.FLOAT||t===Ro.HALF_FLOAT||t===Ro.UNSIGNED_INT_24_8||t===Ro.UNSIGNED_SHORT_4_4_4_4||t===Ro.UNSIGNED_SHORT_5_5_5_1||t===Ro.UNSIGNED_SHORT_5_6_5}},Io=Object.freeze(Ro),To={DEPTH_COMPONENT:Do.DEPTH_COMPONENT,DEPTH_STENCIL:Do.DEPTH_STENCIL,ALPHA:Do.ALPHA,RGB:Do.RGB,RGBA:Do.RGBA,LUMINANCE:Do.LUMINANCE,LUMINANCE_ALPHA:Do.LUMINANCE_ALPHA,RGB_DXT1:Do.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:Do.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:Do.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:Do.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:Do.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:Do.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:Do.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:Do.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:Do.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:Do.COMPRESSED_RGB_ETC1_WEBGL,RGB8_ETC2:Do.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:Do.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:Do.COMPRESSED_RGBA_BPTC_UNORM,componentsLength:function(t){switch(t){case To.RGB:return 3;case To.RGBA:return 4;case To.LUMINANCE_ALPHA:return 2;case To.ALPHA:case To.LUMINANCE:default:return 1}},validate:function(t){return t===To.DEPTH_COMPONENT||t===To.DEPTH_STENCIL||t===To.ALPHA||t===To.RGB||t===To.RGBA||t===To.LUMINANCE||t===To.LUMINANCE_ALPHA||t===To.RGB_DXT1||t===To.RGBA_DXT1||t===To.RGBA_DXT3||t===To.RGBA_DXT5||t===To.RGB_PVRTC_4BPPV1||t===To.RGB_PVRTC_2BPPV1||t===To.RGBA_PVRTC_4BPPV1||t===To.RGBA_PVRTC_2BPPV1||t===To.RGBA_ASTC||t===To.RGB_ETC1||t===To.RGB8_ETC2||t===To.RGBA8_ETC2_EAC||t===To.RGBA_BC7},isColorFormat:function(t){return t===To.ALPHA||t===To.RGB||t===To.RGBA||t===To.LUMINANCE||t===To.LUMINANCE_ALPHA},isDepthFormat:function(t){return t===To.DEPTH_COMPONENT||t===To.DEPTH_STENCIL},isCompressedFormat:function(t){return t===To.RGB_DXT1||t===To.RGBA_DXT1||t===To.RGBA_DXT3||t===To.RGBA_DXT5||t===To.RGB_PVRTC_4BPPV1||t===To.RGB_PVRTC_2BPPV1||t===To.RGBA_PVRTC_4BPPV1||t===To.RGBA_PVRTC_2BPPV1||t===To.RGBA_ASTC||t===To.RGB_ETC1||t===To.RGB8_ETC2||t===To.RGBA8_ETC2_EAC||t===To.RGBA_BC7},isDXTFormat:function(t){return t===To.RGB_DXT1||t===To.RGBA_DXT1||t===To.RGBA_DXT3||t===To.RGBA_DXT5},isPVRTCFormat:function(t){return t===To.RGB_PVRTC_4BPPV1||t===To.RGB_PVRTC_2BPPV1||t===To.RGBA_PVRTC_4BPPV1||t===To.RGBA_PVRTC_2BPPV1},isASTCFormat:function(t){return t===To.RGBA_ASTC},isETC1Format:function(t){return t===To.RGB_ETC1},isETC2Format:function(t){return t===To.RGB8_ETC2||t===To.RGBA8_ETC2_EAC},isBC7Format:function(t){return t===To.RGBA_BC7},compressedTextureSizeInBytes:function(t,e,r){switch(t){case To.RGB_DXT1:case To.RGBA_DXT1:case To.RGB_ETC1:case To.RGB8_ETC2:return Math.floor((e+3)/4)*Math.floor((r+3)/4)*8;case To.RGBA_DXT3:case To.RGBA_DXT5:case To.RGBA_ASTC:case To.RGBA8_ETC2_EAC:return Math.floor((e+3)/4)*Math.floor((r+3)/4)*16;case To.RGB_PVRTC_4BPPV1:case To.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(e,8)*Math.max(r,8)*4+7)/8);case To.RGB_PVRTC_2BPPV1:case To.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(e,16)*Math.max(r,8)*2+7)/8);case To.RGBA_BC7:return Math.ceil(e/4)*Math.ceil(r/4)*16;default:return 0}},textureSizeInBytes:function(t,e,r,n){var A=To.componentsLength(t);return Io.isPacked(e)&&(A=1),A*Io.sizeInBytes(e)*r*n},alignmentInBytes:function(t,e,r){var n=To.textureSizeInBytes(t,e,r,1)%4;return 0===n?4:2===n?2:1},createTypedArray:function(t,e,r,n){var A=Io.sizeInBytes(e);return new(A===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:A===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:A===Float32Array.BYTES_PER_ELEMENT&&e===Io.FLOAT?Float32Array:Uint32Array)(To.componentsLength(t)*r*n)},flipY:function(t,e,r,n,A){if(1===A)return t;for(var i=To.createTypedArray(e,r,n,A),o=To.componentsLength(e),s=n*o,a=0;a<A;++a)for(var B=a*n*o,E=(A-a-1)*n*o,c=0;c<s;++c)i[E+c]=t[B+c];return i},toInternalFormat:function(t,e,r){if(!r.webgl2)return t;if(t===To.DEPTH_STENCIL)return Do.DEPTH24_STENCIL8;if(t===To.DEPTH_COMPONENT){if(e===Io.UNSIGNED_SHORT)return Do.DEPTH_COMPONENT16;if(e===Io.UNSIGNED_INT)return Do.DEPTH_COMPONENT24}if(e===Io.FLOAT)switch(t){case To.RGBA:return Do.RGBA32F;case To.RGB:return Do.RGB32F;case To.RG:return Do.RG32F;case To.R:return Do.R32F}if(e===Io.HALF_FLOAT)switch(t){case To.RGBA:return Do.RGBA16F;case To.RGB:return Do.RGB16F;case To.RG:return Do.RG16F;case To.R:return Do.R16F}return t}},ho=Object.freeze(To);const Fo=4369,Po=6410;function Lo(t,e,r,n,A,i){const o=function(t,e,r,n){let A=t.length,i=r,o=n,s=0;for(;i>0&&o>0;){if(s+=ho.compressedTextureSizeInBytes(e,i,o),i>>=1,o>>=1,0===i&&0===o)break;i=Math.max(i,1),o=Math.max(o,1)}return s===A}(t,r,A,i);if(!o)return null;const s=r===Po||r===Fo;let a=0,B=A,E=i;const c=[];do{let n=ho.compressedTextureSizeInBytes(r,B,E),A=new Uint8Array(t.buffer,e+a,n);c.push(A),B=Math.max(B>>1,1),E=Math.max(E>>1,1),a+=n}while(a<t.byteLength&&o);return{flipY:s,mipmap:c}}const Oo={SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32};function yo(t,e){const r={};if(t.compressOptions){let e=t.compressOptions;(e&Oo.SVC_Vertex)===Oo.SVC_Vertex&&(r.COMPRESS_VERTEX=1),(e&Oo.SVC_Normal)===Oo.SVC_Normal&&(r.COMPRESS_NORMAL=1),(e&Oo.SVC_VertexColor)===Oo.SVC_VertexColor&&(r.COMPRESS_COLOR=1),(e&Oo.SVC_TexutreCoord)===Oo.SVC_TexutreCoord&&(r.COMPRESS_TEXCOORD=1)}e.push(r)}function Mo(t){if(t&&ht(t)){const e=[];for(const r in t)e.push(t[r]);return e}return t}function No(t,e){const r={},n=t.compressOptions;(n&Oo.SVC_Vertex)===Oo.SVC_Vertex&&(r.decode_position_min=Mo(t.minVerticesValue),r.decode_position_normConstant=Mo(t.vertCompressConstant)),(n&Oo.SVC_Normal)===Oo.SVC_Normal&&(r.normal_rangeConstant=Mo(t.normalRangeConstant)),(n&Oo.SVC_TexutreCoord)===Oo.SVC_TexutreCoord&&(t.texCoordCompressConstant.length>0&&(r.decode_texCoord0_min=Mo(t.minTexCoordValue[0]),r.decode_texCoord0_normConstant=Mo(t.texCoordCompressConstant[0]),r.decode_texCoord0_vNormConstant=Mo(t.texCoordCompressConstant[0])),t.texCoordCompressConstant.length>1&&(r.decode_texCoord1_min=Mo(t.minTexCoordValue[1]),r.decode_texCoord1_normConstant=Mo(t.texCoordCompressConstant[1]),r.decode_texCoord1_vNormConstant=Mo(t.texCoordCompressConstant[1])),t.texCoordCompressConstant.length>2&&(r.decode_texCoord2_min=Mo(t.minTexCoordValue[2]),r.decode_texCoord2_normConstant=Mo(t.texCoordCompressConstant[2])),t.texCoordCompressConstant.length>3&&(r.decode_texCoord3_min=Mo(t.minTexCoordValue[3]),r.decode_texCoord3_normConstant=Mo(t.texCoordCompressConstant[3])),t.texCoordCompressConstant.length>4&&(r.decode_texCoord4_min=Mo(t.minTexCoordValue[4]),r.decode_texCoord4_normConstant=Mo(t.texCoordCompressConstant[4])),t.texCoordCompressConstant.length>5&&(r.decode_texCoord5_min=Mo(t.minTexCoordValue[5]),r.decode_texCoord5_normConstant=Mo(t.texCoordCompressConstant[5])),t.texCoordCompressConstant.length>6&&(r.decode_texCoord6_min=Mo(t.minTexCoordValue[6]),r.decode_texCoord6_normConstant=Mo(t.texCoordCompressConstant[6])),t.texCoordCompressConstant.length>7&&(r.decode_texCoord7_min=Mo(t.minTexCoordValue[7]),r.decode_texCoord7_normConstant=Mo(t.texCoordCompressConstant[7]))),e.push(r)}function So(t,e){var r,n,A,i=t.bytesOffset,o=vi.parseBuffer(t.buffer,i),s=o.geoPackage,a=o.groupNode.pageLods,B=[],E=[],c=[],C=[],f=[],l=[],u=[],_=[],D=[];if(!a[0].geodes[0])return null;var R=a[0].geodes[0].matrix;const I=[];for(var T={},h=0;h<o.materials.material.length;h++)T[o.materials.material[h].material.id]=o.materials.material[h].material;var F=Number.MAX_VALUE,P=Number.MAX_VALUE,L=Number.MAX_VALUE,O=Number.MIN_VALUE,y=Number.MIN_VALUE,M=Number.MIN_VALUE;for(var N in s){var S=s[N].vertexPackage;r=S.verticesCount;var d=S.vertexAttributes[0].typedArray.buffer,U=S.vertexAttributes[0].typedArray.byteOffset,G=S.vertexAttributes[0].componentsPerAttribute;A=new(ue(S.vertexAttributes[0].componentDatatype))(d,S.vertexAttributes[0].offsetInBytes+U,r*G);const t=Mo(S.minVerticesValue)||[0,0,0],e=Mo(S.vertCompressConstant)||0;for(let n=0;n<r;n++){var m=A[n*G]*e+t[0],b=A[n*G+1]*e+t[1],p=A[n*G+2]*e+t[2];F=Math.min(F,m),P=Math.min(P,b),L=Math.min(L,p),O=Math.max(O,m),y=Math.max(y,b),M=Math.max(M,p)}B.push(A),Zo("aColor",S,d,r,C),Zo("aTexCoord0",S,d,r,c),Zo("aTextureCoordMatrix",S,d,r,I),Zo("batchId",S,d,r,f),yo(S,u),No(S,_);var w=s[N].arrIndexPackage[0].indicesTypedArray,H=w.byteLength/s[N].arrIndexPackage[0].indicesCount;n=new(4===H?Uint32Array:2===H?Uint16Array:Uint8Array)(w.buffer,(s[N].arrIndexPackage[0].bytesOffset||0)+w.byteOffset,s[N].arrIndexPackage[0].indicesCount),E.push(n),n.length,D.push(r);var K=s[N].arrIndexPackage[0].materialCode;l.push(T[K])}var g=[F,P,L],V=[O,y,M];const X=function(t,e,r,n,A,i,o,s,a,B,E,c,C,f,l,u,_,D){let R=0;for(const t in a)a[t].width*a[t].height*4>R&&(R=a[t].width*a[t].height*4);(!mo||R>mo)&&(Go=new Uint8ClampedArray(R+Uo),mo=R);const I=[],T={magFilter:9729,minFilter:9729,wrapS:10497,wrapT:10497},h={},F={},P=[],L=[],O=[];for(let B=0;B<r.length;B++){const R=e[B],y=t[B],M=r[B],N=A&&A[B]&&A[B],S=i&&i[B],d=n&&n[B]&&n[B],U=o&&o[B]&&o[B],G=s&&s[B]&&s[B],m={POSITION:{array:M,componentType:_e(M.constructor),count:y,byteOffset:M.byteOffset,byteStride:0,byteLength:M.byteLength,type:De(M.length/y),itemSize:M.length/y,name:"POSITION",min:E,max:c}};P.indexOf(M.buffer)<0&&P.push(M.buffer),N&&xo(m,"TEXCOORD_0",N,y,P),S&&xo(m,"TextureCoordMatrix",S,y,P),d&&xo(m,"NORMAL",d,y,P),U&&xo(m,"COLOR_0",U,y,P),G&&xo(m,"_BATCHID",G,y,P);const b={attributes:m,material:B,compressDefines:l[B],compressUniforms:u[B],indices:{array:R.slice(),itemSize:1,byteLength:R.byteLength,byteOffset:0,byteStride:0,name:R,count:R.length,componentType:5123},mode:4};P.push(b.indices.array.buffer);const p={primitives:[b],index:B};F[B]=p;const w={mesh:B,nodeIndex:B,matrix:D};h[B]=w,L.push({nodes:[w]});const H=f[B],K={uFillForeColor:[1,1,1,1]};let g=H.ambient;K.ambientColor=[g.r,g.g,g.b,g.a];let V=H.diffuse;K.uDiffuseColor=[V.r,V.g,V.b,V.a];let X=H.specular;K.specularColor=[X.r,X.g,X.b,X.a],K.shininess=H.shininess,K.bTransparentSorting=H.transparentsorting;let J=H.textureunitstates;if(J.length){K.uTexMatrix=J[0].textureunitstate.texmodmatrix;const t=a[J[0].textureunitstate.id];if(K.uTexture0Width=t.width,J[1]){const t=a[J[1].textureunitstate.id];K.uTexture1Width=t.width}}O.push({pbrMetallicRoughness:{baseColorFactor:[.8,.8,.8,1],metallicFactor:0,roughnessFactor:.5},extensions:{KHR_techniques_webgl:{technique:0,values:K}}}),I.push(wo(B,f,C,a,_).then((t=>{if(!t)return null;const{array:e,mipmap:r,width:n,height:A,format:i,flipY:o}=t;if(e&&P.indexOf(e.buffer)<0&&P.push(e.buffer),r)for(let t=0;t<r.length;t++)e&&P.indexOf(r[t].buffer)<0&&P.push(r[t].buffer);let s=T;return r&&(s={magFilter:T.magFilter,minFilter:9987,wrapS:T.wrapS,wrapT:T.wrapT}),{materialIndex:B,image:{mipmap:r,array:e,flipY:!!o,width:n,height:A,mimeType:"image/bmp"},sampler:s,format:i,source:B}})))}return Promise.all(I).then((t=>{t=t.filter((t=>!!t));for(let e=0;e<t.length;e++){const{materialIndex:r}=t[e];let n="uTexture";O[r].extensions.KHR_techniques_webgl.values.uTexture&&(n="uTexture2"),O[r].extensions.KHR_techniques_webgl.values[n]={"index":e,"texCoord":r},delete t[e].materialIndex}return{transferables:P,gltf:{"asset":{"generator":"S3M","version":"2.0"},"scene":0,"scenes":L,"nodes":h,"meshes":F,"materials":O,"skins":[],"animations":null,"textures":t,"transferables":[{},{},{},{},{}]}}}))}(D,E,B,null,c,I,C,f,o.texturePackage,0,g,V,[],l,u,_,e,R);return X.then((({gltf:t,transferables:e})=>({gltf:t,featureTable:{"BATCH_LENGTH":0},transferables:e,pageLods:a})))}vi.multiplyByPoint=function(t,e,r){var n=e.x,A=e.y,i=e.z,o=t[0]*n+t[4]*A+t[8]*i+t[12],s=t[1]*n+t[5]*A+t[9]*i+t[13],a=t[2]*n+t[6]*A+t[10]*i+t[14];return r.x=o,r.y=s,r.z=a,r};const Uo=122;let Go,mo=0;let bo=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d",{willReadFrequently:!0})}catch(Un){}t&&"undefined"!=typeof createImageBitmap&&(bo=!0)}const po={};function wo(t,e,r,n,A){const i=Go,o=Uo;return new Promise((function(r){!function(t){if(e[t].textureunitstates[0]){var s=e[t].textureunitstates[0].textureunitstate.id,a=n[s],B=a.arrayBufferView,E=a.nFormat,c=a.internalFormat;if(function(t){return t===vo.RGB_DXT1||t===vo.RGBA_DXT1||t===vo.RGBA_DXT3||t===vo.RGBA_DXT5||t===vo.RGB_PVRTC_4BPPV1||t===vo.RGB_PVRTC_2BPPV1||t===vo.RGBA_PVRTC_4BPPV1||t===vo.RGBA_PVRTC_2BPPV1||t===vo.RGBA_ASTC||t===vo.RGB_ETC1||t===vo.RGB8_ETC2||t===vo.RGBA8_ETC2_EAC||t===vo.RGBA_BC7}(c)&&a.width===a.height){const t=Lo(B,B.byteOffset,c,0,a.width,a.height);if(t){const{mipmap:e,flipY:n}=t;return void r({format:c,mipmap:e,flipY:n,width:a.width,height:a.height})}}let C;C=E>Ui.BGR||E===Ui.LUMINANCE_ALPHA?o+a.width*a.height*4:o/2+a.width*a.height,Xi.decode(i.subarray(o),a.width,a.height,B,E),function(t,e,r){var n=r*(4*e+e%4),A=n+o,i=new DataView(t),o=0;i.setUint16(o,19778,!0),o+=2,i.setUint32(o,A,!0),o+=4,i.setUint32(o,0,!0),o+=4,i.setUint32(o,122,!0),o+=4,i.setUint32(o,108,!0),o+=4,i.setUint32(o,e,!0),o+=4,i.setUint32(o,r,!0),o+=4,i.setUint16(o,1,!0),o+=2,i.setUint16(o,32,!0),o+=2,i.setUint32(o,this.compress,!0),o+=4,i.setUint32(o,n,!0),o+=4,i.setUint32(o,2835,!0),o+=4,i.setUint32(o,2835,!0),o+=4,i.setUint8(o,0,!0),o+=4,i.setUint32(o,0,!0),o+=4,i.setUint32(o,16711680,!0),o+=4,i.setUint32(o,65280,!0),o+=4,i.setUint32(o,255,!0),o+=4,i.setUint32(o,4278190080,!0),o+=4,i.setUint32(o,1466527264,!0),o+=4}(i.buffer,a.width,a.height);let{width:f,height:l}=a;Ho(f)||(f=Ko(f)),Ho(l)||(l=Ko(l));const u=A;let _;u&&(f=Math.min(u,f),l=Math.min(u,l));let D=6408;const R=a.width*a.height*4;!bo||f===a.width&&l===a.height?(_=new Uint8Array(3*R/4),D=6407):(po[R]||(po[R]=new Uint8Array(R)),_=po[R]),_=_o(_,i.buffer,0,C),!bo||f===a.width&&l===a.height||(_=function(t,e,r,n,A){go||(go=new OffscreenCanvas(2,2),Vo=go.getContext("2d"),Xo=new OffscreenCanvas(2,2),Jo=Xo.getContext("2d",{willReadFrequently:!0}));const i=new ImageData(new Uint8ClampedArray(t.buffer),e,r);return go.width=e,go.height=r,Vo.putImageData(i,0,0),Xo.width=n,Xo.height=A,Jo.drawImage(go,0,0,n,A),Jo.getImageData(0,0,n,A).data}(_,a.width,a.height,f,l)),_.buffer===(po[R]&&po[R].buffer)&&(_=new Uint8Array(_)),r({array:_,width:f,height:l,format:D})}else r(null)}(t)}))}function Ho(t){return 0==(t&t-1)&&0!==t}function Ko(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}let go,Vo,Xo,Jo;const vo={RGB_DXT1:33776,RGBA_DXT1:33777,RGBA_DXT3:33778,RGBA_DXT5:33779,RGB_PVRTC_4BPPV1:35840,RGB_PVRTC_2BPPV1:35841,RGBA_PVRTC_4BPPV1:35842,RGBA_PVRTC_2BPPV1:35843,RGBA_ASTC:37808,RGB_ETC1:36196,RGB8_ETC2:37492,RGBA8_ETC2_EAC:37496,RGBA_BC7:36492};function Zo(t,e,r,n,A){var i=e.attrLocation[t];if(i){const t=e.vertexAttributes[i];if(t.typedArray.buffer!==r)A.push(t.typedArray);else{var o=t.componentsPerAttribute;var s=new(ue(t.componentDatatype))(r,t.offsetInBytes+t.typedArray.byteOffset,n*o);A.push(s)}}else A.push(void 0)}function xo(t,e,r,n,A){t[e]={array:r,componentType:_e(r.constructor),count:n,byteOffset:r.byteOffset,byteStride:0,byteLength:r.byteLength,type:De(r.length/n),itemSize:r.length/n,name:e},A.indexOf(r.buffer)<0&&A.push(r.buffer)}var ko=542327876,Wo=131072,Qo=4,jo=ls("DXT1"),Yo=ls("DXT3"),zo=ls("DXT5"),qo=ls("DX10"),$o=116,ts=512,es=3,rs=2,ns=31,As=0,is=1,os=2,ss=3,as=4,Bs=7,Es=20,cs=21,Cs=28,fs=function(t){var e,r,n=new Int32Array(t,0,ns);if(n[As]!==ko)throw new Error("Invalid magic number in DDS header");if(!n[Es]&Qo)throw new Error("Unsupported format, must contain a FourCC code");var A=n[cs];switch(A){case jo:e=8,r="dxt1";break;case Yo:e=16,r="dxt3";break;case zo:e=16,r="dxt5";break;case $o:r="rgba32f";break;case qo:var i=new Uint32Array(t.slice(128,148));r=i[0];var o=i[1];if(i[2],i[3],i[4],o!==es||r!==rs)throw new Error("Unsupported DX10 texture format "+r);r="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+(s=A,String.fromCharCode(255&s,s>>8&255,s>>16&255,s>>24&255)))}var s;var a=n[os],B=1;a&Wo&&(B=Math.max(1,n[Bs]));var E=!1;n[Cs]&ts&&(E=!0);var c,C=n[as],f=n[ss],l=n[is]+4,u=C,_=f,D=[];A===qo&&(l+=20);if(E)for(var R=0;R<6;R++){if("rgba32f"!==r)throw new Error("Only RGBA32f cubemaps are supported");C=u,f=_;for(var I=Math.log(C)/Math.log(2)+1,T=0;T<I;T++)c=C*f*16,D.push({offset:l,length:c,shape:[C,f]}),T<B&&(l+=c),C=Math.floor(C/2),f=Math.floor(f/2)}else for(T=0;T<B;T++)c=Math.max(4,C)/4*Math.max(4,f)/4*e,D.push({offset:l,length:c,shape:[C,f]}),l+=c,C=Math.floor(C/2),f=Math.floor(f/2);return{shape:[u,_],images:D,format:r,flags:a,cubemap:E}};function ls(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}const us=Math.PI/180,_s=6378137*Math.PI/180,Ds=85.0511287798;function Rs(t,e,r){if("EPSG:3857"===r)return function(t,e){const r=Ds,n=e[0],A=Math.max(Math.min(r,e[1]),-r);let i;i=0===A?0:Math.log(Math.tan((90+A)*us/2))/us;return t[0]=n*_s,t[1]=i*_s,t}(t,e);if("EPSG:4326"===r||"EPSG:4490"===r||"identity"===r)return Is(t,e);if("baidu"===r)return Is(t,e);throw new Error("unsupported projection:"+r)}function Is(t,e){return t[0]=e[0],t[1]=e[1],t}const Ts=i([]),hs=Fe().draco,Fs=Fe().ktx2,Ps={"pbrMetallicRoughness":{"baseColorFactor":[.5,.5,.5,1],"metallicFactor":0,"roughnessFactor":.5}},Ls={"position":{name:"POSITION",accessor:{"componentType":5126,"type":"VEC3"}},"normal":{name:"NORMAL",accessor:{"componentType":5126,"type":"VEC3"}},"uv0":{name:"TEXCOORD_0",accessor:{"componentType":5126,"type":"VEC2"}},"color":{name:"COLOR_0",accessor:{"componentType":5121,"type":"VEC4"}},"uv-region":{name:"uvRegion",accessor:{"componentType":5123,"type":"VEC4"}},"feature-index":{name:"_BATCHID",accessor:{"componentType":5125,"type":"SCALAR"}},"faceRange":{name:"faceRange",accessor:{"componentType":5125,"type":"VEC2"}}};function Os(t,e,r,n){const A=[],o=[],s=[];for(let e=0;e<t.meshes.length;e++){const{geometry:r,material:n}=t.meshes[e];let i=Y.getArrayBuffer(r.url);i.xhr.url=r.url,s.push(i.xhr);const a=i.then((t=>({buffer:t})));A.push(a);const B=[];if(ms(n,B),B.length){const t=B.map((t=>{const e=Y.getArrayBuffer(t.url);return e.xhr.url=t.url,s.push(e.xhr),e.then((e=>e&&e.status?null:{buffer:e,mimeType:t.mimeType,format:t.format}))}));A.push(...t)}o[e]=B.length}const a=Promise.all(A).then((A=>{for(let t=0;t<A.length;t++)if(!A[t]||!A[t].buffer)return Promise.resolve(null);const s=[];let a=0;for(let t=0;t<o.length;t++){const e=o[t];s.push({geoBuffer:{data:A[a].buffer.data},textureBuffers:A.slice(a+1,e+a+1).map((t=>({data:t.buffer.data,mimeType:t.mimeType,format:t.format})))}),a+=1+e}const B=function(t,e,r,n,A){const o={asset:{generator:"i3s",version:"2.0"},extensions:{},scene:0,scenes:[{nodes:[]}],nodes:{},meshes:{},materials:[],skins:[],animations:null,textures:[],transferables:[]},s=[];for(let a=0;a<t.meshes.length;a++){let B,{geometry:E,material:c}=t.meshes[a];const C=e[a].geoBuffer.data;if(!C)continue;B=gs(C)?Ms(o,a,E,C,t.transform,t.center,A):Ss(o,a,E,C,t.transform,t.center,A),s.push(B),o.nodes[a]={mesh:a,nodeIndex:a,matrix:i([])},o.scenes[0].nodes[a]=o.nodes[a],c||(c=Ps);const f=Us(a,o,c,e[a].textureBuffers,r,n);s.push(f)}return Promise.all(s).then((()=>({gltf:o,featureTable:{BATCH_LENGTH:0},transferables:o.transferables})))}(t,s,e,n,r);return B}));return a.xhr=s,a}const ys={"magFilter":9728,"minFilter":9728,"wrapR":33071,"wrapS":33071,"wrapT":33071};function Ms(t,e,r,n,A,i,o){const s=r.info.compressedAttributes.attributes.reduce(((t,e,r)=>{const n=Ls[e];if(!n)return t;return t[n.name||e]=r,t}),{});return hs(n,{attributes:s,metadatas:{"POSITION":[{name:"i3s-scale_x",type:"double"},{name:"i3s-scale_y",type:"double"}]},useUniqueIDs:!1,skipAttributeTransform:!1}).then((r=>ds(r,t,e,A,i,o)))}var Ns={position:function(t,e,r){const n=3*t.vertexCount,A=new Float32Array(e,r,n);return t.position={array:A,componentType:5126,itemSize:3,count:n/3,meta:{"i3s-scale_x":1,"i3s-scale_y":1},type:"VEC3"},r+=4*n},normal:function(t,e,r){var n=3*t.vertexCount;const A=new Float32Array(e,r,n);return t.normal={array:A,componentType:5126,itemSize:3,count:n/3,type:"VEC3"},r+=4*n},uv0:function(t,e,r){var n=2*t.vertexCount;const A=new Float32Array(e,r,n);return t.uv0={array:A,componentType:5126,itemSize:2,count:n/2,type:"VEC2"},r+=4*n},color:function(t,e,r){var n=4*t.vertexCount;const A=new Uint8Array(e,r,n);return t.color={array:A,componentType:5121,itemSize:4,count:n/4,type:"VEC4"},r+=n},featureId:function(t,e,r){return r+=8*t.featureCount},id:function(t,e,r){return r+=8*t.featureCount},faceRange:function(t,e,r){var n=2*t.featureCount;const A=new Uint32Array(e,r,n);return t.faceRange={array:A,componentType:5125,itemSize:2,count:n/2,type:"VEC2"},r+=4*n},uvRegion:function(t,e,r){var n=4*t.vertexCount;const A=new Uint16Array(e,r,n);return t["uv-region"]={array:A,componentType:5123,itemSize:4,count:n/4,type:"VEC4"},r+=2*n},region:function(t,e,r){var n=4*t.vertexCount;const A=new Uint16Array(e,r,n);return t["uv-region"]={array:A,componentType:5123,itemSize:4,count:n/4,type:"VEC4"},r+=2*n}};function Ss(t,e,r,n,A,i,o){const s={vertexCount:0},a=new DataView(n);try{var B=0;s.vertexCount=a.getUint32(B,1),B+=4,s.featureCount=a.getUint32(B,1),B+=4;const t=r.info.ordering?null:r.info;if(t){const e=[];for(const r in t)"offset"!==r&&""!==r&&e.push(r);for(var E=0;E<e.length;E++)Ns[e[E]]?B=Ns[e[E]](s,n,B):console.error("Unknown decoder for",e[E])}else{const t=r.info;let e=t.ordering,A=t.featureAttributeOrder;const i=null;i&&i.geometryData&&i.geometryData[0]&&i.geometryData[0].params;for(var c=0;c<e.length;c++){var C=Ns[e[c]];C||console.log(e[c]),B=C(s,n,B)}for(var f=0;f<A.length;f++){var l=Ns[A[f]];l||console.log(A[f]),B=l(s,n,B)}}}catch(t){}s.scale_x=1,s.scale_y=1;const u={};for(const t in s){const e=Ls[t]&&Ls[t].name;e&&(u[e]=s[t])}if(s.faceRange){const t=s.faceRange.array,e=t.length/2,r=(_=e)<=255?Uint8Array:_<=65535?Uint16Array:Uint32Array,n=new r(u.POSITION.array.length/3);for(let e=0;e<t.length-1;e+=2){const r=e/2,A=t[e],i=t[e+1];for(let t=A;t<=i;t++)n[3*t]=r,n[3*t+1]=r,n[3*t+2]=r}u._BATCHID={componentType:_e(r),array:n,itemSize:1,count:n.length,type:"SCALAR"}}var _;return ds({attributes:u},t,e,A,i,o)}function ds(t,e,r,n,A,i){const o={attributes:t.attributes,material:r,indices:t.indices,mode:4};!function(t){const e=t.array,r=t.meta&&t.meta["i3s-scale_x"],n=t.meta&&t.meta["i3s-scale_y"];if(r&&n&&(1!==r||1!==n))for(let t=0;t<e.length;t+=3)e[t]*=r.value,e[t+1]*=n.value}(t.attributes.POSITION);const s=function(t,e,r,n){const A=r;let i,o=[0,0,0,1],s=[0,0];const a=Rs([],r,n);a[2]=r[2];const B=e&&E(Ts,e);return ge(t,(t=>(o[0]=t[0],o[1]=t[1],o[2]=t[2],B||(o=L(o,o,e)),A&&_(o,o,A),Rs(s,o,n),i=o[2],t[0]=s[0]-a[0],t[1]=s[1]-a[1],t[2]=i-a[2],t))),a}(t.attributes.POSITION,n,A,i);e.meshes[r]={primitives:[o],index:r},e.extensions.MAPTALKS_RTC={projCenter:s},e.extensions.CESIUM_RTC={rtcCoord:A};for(const r in t.attributes)Ks(e.transferables,t.attributes[r].array.buffer);return t.indices&&Ks(e.transferables,t.indices.array.buffer),o}function Us(t,e,r,n,A,i){const o=n.map((t=>function(t,e,r,n,A){if("dds"===e){const e=fs(t),n=e.images.map((e=>new Uint8Array(t,e.offset,e.length))),A="dxt1"===e.format?33777:33779;return Promise.resolve({image:{mipmap:n,width:e.shape[0],height:e.shape[1],mimeType:r},sampler:ys,format:A})}if("png"===e||"jpg"===e)return function(t,e){bs||(bs=new OffscreenCanvas(2,2),ps=bs.getContext("2d",{willReadFrequently:!0}));const r=new Blob([new Uint8Array(t)]);return createImageBitmap(r).then((t=>{let{width:r,height:n}=t;ws(r)||(r=Hs(r)),ws(n)||(n=Hs(n));const A=e;A&&(r=Math.min(A,r),n=Math.min(A,n)),bs.width=r,bs.height=n,ps.drawImage(t,0,0,r,n),t.close();const i=ps.getImageData(0,0,r,n);return{width:r,height:n,array:new Uint8Array(i.data)}})).catch((()=>({width:2,height:2,array:new Uint8Array(4)})))}(t,A).then((t=>{t.mimeType=r;return{image:t,sampler:ys,format:6408}}));if("ktx2"===e)return Fs(t,n).then((t=>(t.mimeType=r,{image:t,sampler:ys,format:t.format})))}(t.data,t.format,t.mimeType,A,i).then((t=>{if(t.image)if(t.image.array)Ks(e.transferables,t.image.array.buffer);else if(t.image.mipmap)for(let r=0;r<t.image.mipmap.length;r++)Ks(e.transferables,t.image.mipmap[r].buffer);return t}))));return Promise.all(o).then((n=>{Gs(t,e,r,n)}))}function Gs(t,e,r,n){const A=JSON.parse(JSON.stringify(r)),i=e.textures;n.ptr||(n.ptr=0);for(const t in r)r[t]&&r[t].url?(i.push(n[n.ptr++]),A[t]={index:i.length-1},void 0!==r[t].factor&&(A[t].scale=r[t].factor)):ht(r[t])&&(A[t]=Gs(-1,e,r[t],n));return t>=0&&(e.materials[t]=A),A}function ms(t,e){for(const r in t)t[r]&&t[r].url?e.push({url:t[r].url,mimeType:t[r].mimeType,format:t[r].format}):ht(t[r])&&ms(t[r],e)}let bs,ps;function ws(t){return 0==(t&t-1)&&0!==t}function Hs(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Ks(t,e){e&&(t.indexOf(e)>=0||t.push(e))}function gs(t){const e=new Uint8Array(t,0,5);return e[0]==="D".charCodeAt()&&e[1]==="R".charCodeAt()&&e[2]==="A".charCodeAt()&&e[3]==="C".charCodeAt()&&e[4]==="O".charCodeAt()}const Vs=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],Xs=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],Js="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let vs,Zs,xs=!1;if("undefined"!=typeof OffscreenCanvas){try{Zs=new OffscreenCanvas(2,2).getContext("2d",{willReadFrequently:!0})}catch(Un){}Zs&&"undefined"!=typeof createImageBitmap&&(xs=!0)}const ks=i([]),Ws=[0,0,0],Qs=[],js=[],Ys=[],zs=[];class qs{constructor(t,e,r,n){this.id=t,this.options=e,this.Pt=this.requestImage.bind(this),this.Lt=r,this.Ot={},n(null,{},[])}yt(t){this.Mt||(this.i=t,this.Nt=new Ne,this.Mt=new Pe(this.Pt,lt,t),this.St=new Le(this.Pt,lt,t))}requestImage(t,e){xs?fetch(t).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((t=>{vs.width=t.width,vs.height=t.height,Zs.drawImage(t,0,0);const r=Zs.getImageData(0,0,vs.width,vs.height);e(null,{width:t.width,height:t.height,data:new Uint8Array(r.data)})})):this.Lt("requestImage",{url:t},null,e)}loadTile(t,e){this.yt(t.supportedFormats);const r=t.url,n=t.arraybuffer;if(function(t){return t.indexOf("i3s:")>=0}(r)){const n=t.i3sInfo,A=this.options.services[t.rootIdx].maxTextureSize||1024,i=Os(n,t.supportedFormats,this.options.projection,A);return i.then((t=>{if(delete this.Ot[r],!t)return void e({status:404,url:r,i3sInfo:n});if(!Object.keys(t.gltf.meshes).length)return void e({status:404,url:r,i3sInfo:n});t.gltf.url=r;const{transferables:A}=t;t.magic="b3dm",e(null,t,A)})),void(this.Ot[r]=i.xhr)}if(n){delete this.Ot[r];const A=new DataView(n),i=vt(A,0);if("{"===i[0]||" "===i[0]||"<"===i[0]){const A=function(t,e,r){if(Js){const n=new Uint8Array(t,e,r);return Js.decode(n)}return yt(new Uint8Array(t,e,r))}(n,0,n.byteLength),i=JSON.parse(A);this.dt(t.rootIdx,i,n,r,e)}else{const o=A.getFloat32(0,!0);1===o||2===o||3===o?this.Ut(n,r,t,e):this.Gt(n,r,t,i,e)}}else{const n=this.options.services[t.rootIdx];let A=n.urlParams;A&&(A=(r.indexOf("?")>0?"&":"?")+A);const i=r.replace(/\\+/g,"%2B");let o=Y.getArrayBuffer(i+(A||""),n.fetchOptions);const s=o.xhr;o=o.then((n=>{delete this.Ot[r],n&&n.status?e(n):(t.arraybuffer=n&&n.data,this.loadTile(t,e))})).catch((t=>{delete this.Ot[r],e(t)})),this.Ot[r]=s}}Gt(t,e,r,n,A){const i=this.options.services[r.rootIdx];if("b3dm"===n){this.Mt.load(e,t,0,0,{maxTextureSize:i.maxTextureSize||1024}).then((t=>{if(t.error)return void A(t);const{content:e,transferables:n}=this.bt(t,r);A(null,e,n)})).catch((t=>{A(t)}))}else if("pnts"===n){const n=r.transform;this.Nt.load(e,t).then((t=>{const{content:e,transferables:i}=this.wt(t,n,r.rootIdx);A(null,e,i)}))}else if("i3dm"===n){const n=r.transform;this.St.load(e,t,0,0,{maxTextureSize:i.maxTextureSize||1024}).then((t=>{const{content:e,transferables:i}=this.wt(t,n,r.rootIdx);A(null,e,i)}))}else if("cmpt"===n){new de(this.Pt,lt,this.i,i.maxTextureSize||1024).load(e,t,0,0,{maxTextureSize:i.maxTextureSize||1024}).then((t=>{const{content:e,transferables:n}=this.Ht(t,r);A(null,e,n)})).catch((t=>{A(t)}))}}Ut(t,e,r,n){So({buffer:t,bytesOffset:0},this.options.services[r.rootIdx].maxTextureSize||1024).then((t=>{t.gltf.url=e;const{content:A,transferables:i}=this.bt(t,r);if(A.magic="b3dm",t.pageLods){const e=this.Kt(t.pageLods);e.length&&(A.children=e)}n(null,A,i)}))}Kt(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r];if(!n.childTile)continue;const A={boundingVolume:{sphere:[n.boundingSphere.center.x,n.boundingSphere.center.y,n.boundingSphere.center.z,n.boundingSphere.radius]},content:{uri:n.childTile},geometricError:n.boundingSphere.radius/n.rangeList*16,refine:"REPLACE"};e.push(A)}return e}dt(t,e,r,n,A){return e.dataType&&e.position?void A(null,Je(e)):(e.capabilities,void A(null,e))}Ht(t,e){const{tiles:r}=t,n={magic:"cmpt",content:[]},A=[];for(let t=0;t<r.length;t++){const{magic:i}=r[t];if("b3dm"===i){const{content:i,transferables:o}=this.bt(r[t],e);ra(A,o),n.content.push(i)}else if("i3dm"===i||"pnts"===i){const{transform:i,rootIdx:o}=e,{content:s,transferables:a}=this.wt(r[t],i,o);ra(A,a),n.content.push(s)}else if("cmpt"===i){const{content:i,transferables:o}=this.Ht(r[t],e);ra(A,o),n.content.push(i)}}return{content:n,transferables:A}}bt(t,e){const{gltf:r,transferables:n,featureTable:A}=t,i=function(t){if(!t||!t.meshes)return!1;const e="visited";let r=1;const n=[];for(const A in t.meshes){const i=t.meshes[A],{primitives:o}=i;if(o)for(let t=0;t<o.length;t++){const A=o[t].attributes&&o[t].attributes.POSITION;if(!A||!A.array)continue;A.array.buffer[e]||(A.array.buffer[e]=r++);const i=r-1+"-"+(A.byteOffset||0);if(n.indexOf(i)>=0)return!0;n.push(i)}}return!1}(r);return this.gt(t.gltf),t.gltf.asset||(t.gltf.asset={}),i?(t.gltf.asset.sharePosition=!0,this.Vt(r,A,e.upAxis,e.transform)):this.Xt(r,A,e.upAxis,e.transform),delete t.transferables,{content:t,transferables:n}}wt(t,e,r){const{featureTable:A}=t,i=t.pnts||t.i3dm;let o=A&&A.RTC_CENTER||[0,0,0];if(A.EAST_NORTH_UP&&!i.NORMAL_UP&&!i.NORMAL_UP_OCT32P){const e=new Float32Array(3*i.POSITION.array.length),r=[],A=[],s=[];ge(i.POSITION,((t,i)=>{_(s,t,o),ae(s,null,r),n(A,r);!function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(e.subarray(9*i,9*(i+1)),A)})),i.INSTANCE_ROTATION={byteStride:0,byteOffset:0,itemSize:9,componentType:5126,array:e},t.transferables.push(e.buffer)}const s={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};ta(i.POSITION.array,3,o,ks,s);const a=ea(s),B=l([],a),E=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];ge(i.POSITION,(t=>{t[0]=t[0]+o[0]-B[0],t[1]=t[1]+o[1]-B[1],t[2]=t[2]+o[2]-B[2],t[0]<E[0]&&(E[0]=t[0]),t[1]<E[1]&&(E[1]=t[1]),t[2]<E[2]&&(E[2]=t[2]),t[0]>c[0]&&(c[0]=t[0]),t[1]>c[1]&&(c[1]=t[1]),t[2]>c[2]&&(c[2]=t[2])})),i.POSITION.min=E,i.POSITION.max=c,e&&L(a,a,e);const C=this.Jt(a);t.rtcCenter=B,t.rtcCoord=C,t.rootIdx=r;const f=t.transferables;return delete t.transferables,{content:t,transferables:f}}gt(t){if(!Array.isArray(t.textures))return;const e=t.textures;for(let t=0;t<e.length;t++){const r=e[t].image&&e[t].image.array;if(r&&r.length){const n=r[0],A=r[1],i=r[2],o=r[3];let s=!0;for(let t=4;t<r.length;t+=4)if(r[t]!==n||r[t+1]!==A||r[t+2]!==i||r[t+3]!==o){s=!1;break}s&&(e[t].image.color=[n/255,A/255,i/255,o/255],delete e[t].image.array)}}}abortTileLoading(t,e){const r=this.Ot[t.url];if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t].abort();else r&&r.abort&&r.abort();delete this.Ot[t.url],e(null)}vt(t,e,r,n){let A=e&&e.RTC_CENTER||t.extensions&&t.extensions.CESIUM_RTC&&t.extensions.CESIUM_RTC.center,s=Vs;"X"===(r=r&&r.toUpperCase())?s=Xs:"Z"===r&&(s=ks),t.extensions=t.extensions||{},t.extensions.CESIUM_RTC||(t.extensions.CESIUM_RTC={}),A&&(t.extensions.CESIUM_RTC.center=A),t.extensions.MAPTALKS_RTC={};const a={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};Ue(t,(t=>{if(!(t.attributes&&t.attributes.POSITION))return;const e=i(Qs);t.matrices&&na(e,t.matrices);const r=t.attributes.POSITION.array,B=t.attributes.POSITION.itemSize;o(e,s,e),n&&o(e,n,e),ta(r,B,A||Ws,e,a,t.compressUniforms)}));const B=ea(a);return{rtcCenter:A,modelCenter:B,upAxisTransform:s}}Vt(t,e,r,n){const{modelCenter:A,upAxisTransform:s,rtcCenter:a}=this.vt(t,e,r),B=l([],A);n&&L(A,A,n),t.extensions.CESIUM_RTC.rtcCoord=this.Jt(A),a||(Ue(t,(t=>{if(t.attributes&&t.attributes.POSITION){const e=t.attributes.POSITION;if(e.array.buffer.projected&&e.array.buffer.projected[e.byteOffset])return;const r=i(Qs);t.matrices&&na(r,t.matrices),o(r,s,r);const n=function(t,e){var r=e[0],n=e[1],A=e[2],i=e[3],o=e[4],s=e[5],a=e[6],B=e[7],E=e[8],c=e[9],C=e[10],f=e[11],l=e[12],u=e[13],_=e[14],D=e[15],R=r*s-n*o,I=r*a-A*o,T=r*B-i*o,h=n*a-A*s,F=n*B-i*s,P=A*B-i*a,L=E*u-c*l,O=E*_-C*l,y=E*D-f*l,M=c*_-C*u,N=c*D-f*u,S=C*D-f*_,d=R*S-I*N+T*M+h*y-F*O+P*L;return d?(d=1/d,t[0]=(s*S-a*N+B*M)*d,t[1]=(A*N-n*S-i*M)*d,t[2]=(u*P-_*F+D*h)*d,t[3]=(C*F-c*P-f*h)*d,t[4]=(a*y-o*S-B*O)*d,t[5]=(r*S-A*y+i*O)*d,t[6]=(_*T-l*P-D*I)*d,t[7]=(E*P-C*T+f*I)*d,t[8]=(o*N-s*y+B*L)*d,t[9]=(n*y-r*N-i*L)*d,t[10]=(l*F-u*T+D*R)*d,t[11]=(c*T-E*F-f*R)*d,t[12]=(s*O-o*M-a*L)*d,t[13]=(r*M-n*O+A*L)*d,t[14]=(u*I-l*h-_*R)*d,t[15]=(E*h-c*I+C*R)*d,t):null}(js,r),A=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];ge(e,(t=>{L(t,t,r),t[0]=t[0]-B[0],t[1]=t[1]-B[1],t[2]=t[2]-B[2],L(t,t,n),t[0]<A[0]&&(A[0]=t[0]),t[1]<A[1]&&(A[1]=t[1]),t[2]<A[2]&&(A[2]=t[2]),t[0]>a[0]&&(a[0]=t[0]),t[1]>a[1]&&(a[1]=t[1]),t[2]>a[2]&&(a[2]=t[2])})),e.min=A,e.max=a,e.array.buffer.projected||(e.array.buffer.projected={}),e.array.buffer.projected[e.byteOffset]=1}})),t.extensions.CESIUM_RTC.center=B)}Xt(t,e,r,n){const{modelCenter:A,rtcCenter:i}=this.vt(t,e,r,n),o=this.Zt(A);t.extensions.MAPTALKS_RTC.projCenter=o,t.extensions.CESIUM_RTC.rtcCoord=this.Jt(A),Ue(t,(e=>{if(e.attributes&&e.attributes.POSITION){e.attributes.NORMAL&&this.xt(e.attributes.NORMAL,e.matrices,r),e.attributes.TANGENT&&this.xt(e.attributes.TANGENT,e.matrices,r);const{newPositions:A}=this.kt(e.attributes.POSITION,e.matrices,i,t.extensions.MAPTALKS_RTC,r,n,e.compressUniforms);let{componentType:o}=e.attributes.POSITION;5126!==o&&(e.attributes.POSITION.array=new Float32Array(A))}}));for(const e in t.nodes){t.nodes[e].matrix=ks}}Zt(t){0===M(t)?u(Ys,0,0,-6378137):pt(Ys,t);const e=this.options.projection;Rs(zs,Ys,e);const r=Ys[2],n=[];return n[0]=zs[0],n[1]=zs[1],n[2]=r,n}xt(t,e,r){let i;i="Y"===r?Vs:"X"===r?Xs:ks;const o=A([],i);if(na(o,e),E(o,ks))return;const s=n([],o),a=[];ge(t,(t=>(function(t,e,r){var n=e[0],A=e[1],i=e[2];t[0]=n*r[0]+A*r[3]+i*r[6],t[1]=n*r[1]+A*r[4]+i*r[7],t[2]=n*r[2]+A*r[5]+i*r[8]}(a,t,s),h(a,a),l(t,a),a)))}kt(t,e,r,n,A,o,s){if(t.array.buffer.projected&&t.array.buffer.projected[t.byteOffset])return;const a=i([]);na(a,e);const B=this.options.projection;A=A&&A.toUpperCase();const c=r;let C=null;"Y"===A?C=Vs:"X"===A&&(C=Xs);let f=[0,0,0,1],l=[0,0,0],D=[0,0];const R=n.projCenter,I=o&&E(ks,o),T=t.min=t.min||[],h=t.max=t.max||[];u(T,1/0,1/0,1/0),u(h,-1/0,-1/0,-1/0);const F=s||{},{decode_position_min:P,decode_position_normConstant:O}=F;let y=[0,0,0,0],N=1;P&&(y=P),O&&(N=O);const S=[];return ge(t,(t=>{if(f[0]=t[0]*N+y[0],f[1]=t[1]*N+y[1],f[2]=t[2]*N+y[2],f=L(f,f,a),C&&(f=L(f,f,C)),c&&_(f,f,c),o&&!I&&(f=L(f,f,o)),0===M(f)?u(l,0,0,-6378137):pt(l,f),Rs(D,l,B),t instanceof Float32Array)t[0]=D[0]-R[0],t[1]=D[1]-R[1],t[2]=l[2]-R[2];else{const e=D[0]-R[0],r=D[1]-R[1],n=l[2]-R[2];S.push(e),S.push(r),S.push(n),S.push(t[3])}return t[0]<T[0]&&(T[0]=t[0]),t[1]<T[1]&&(T[1]=t[1]),t[2]<T[2]&&(T[2]=t[2]),t[0]>h[0]&&(h[0]=t[0]),t[1]>h[1]&&(h[1]=t[1]),t[2]>h[2]&&(h[2]=t[2]),t})),t.array.buffer.projected||(t.array.buffer.projected={}),t.array.buffer.projected[t.byteOffset]=1,{projCenter:R,newPositions:S}}Jt(t){return 0===M(t)?u([],0,0,-6378137):pt([],t)}onRemove(){}}const $s=[];function ta(t,e,r,n,A,i){const o=i||{},{decode_position_min:s,decode_position_normConstant:a}=o;let B=[0,0,0,0],E=1;s&&(B=s),a&&(E=a);for(let i=0,o=t.length;i<o;i+=e){const{xmin:o,ymin:s,xmax:a,ymax:c,hmin:C,hmax:f}=A;u($s,t[i]*E+B[0],t[i+1]*E+B[1],t[i+2]*E+B[2]),L($s,$s,n);const l=_($s,r,$s);l[0]<o&&(A.xmin=l[0]),l[0]>a&&(A.xmax=l[0]),l[1]<s&&(A.ymin=l[1]),l[1]>c&&(A.ymax=l[1]),e>2&&(l[2]<C&&(A.hmin=l[2]),l[2]>f&&(A.hmax=l[2]))}}function ea(t){const{xmax:e,ymax:r,xmin:n,ymin:A,hmin:i,hmax:o}=t,s=[(n+e)/2,(A+r)/2,(i+o)/2];return e===-1/0&&(s[0]=0),r===-1/0&&(s[1]=0),o===-1/0&&(s[2]=0),isNaN(s[2])&&(s[2]=0),s}function ra(t,e){for(let r=0;r<e.length;r++)t.indexOf(e[r])<0&&t.push(e[r])}function na(t,e){const r=t;for(let t=e.length-1;t>=0;t--)o(r,e[t],r);return r}let Aa=0;class ia{constructor(t){this.workerId=t,this.workers={},this.Wt={}}addLayer({actorId:t,mapId:e,layerId:r,params:n},A){if(this.Qt(e,r))return;const i=this.jt(e,r),o=n.options,s=this.send.bind(this,t);this.workers[i]=new qs(r,o,s,A)}removeLayer({mapId:t,layerId:e},r){const n=this.Qt(t,e),A=this.jt(t,e);delete this.workers[A],n&&n.onRemove(r)}loadTile({mapId:t,layerId:e,params:r},n){const A=this.Qt(t,e);A&&A.loadTile(r,n)}abortTileLoading({mapId:t,layerId:e,params:r},n){const A=this.Qt(t,e);A&&A.abortTileLoading(r,n)}receive(t){const e=t.callback,r=this.Wt[e];delete this.Wt[e],r&&t.error?r(new Error(t.error)):r&&r(null,t.data)}send(t,e,r,n,A){const i=A?`${t}-${Aa++}`:null;A&&(this.Wt[i]=A),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:e,params:r,callback:String(i)},n||[])}jt(t,e){return`${t}-${e}`}Qt(t,e){const r=this.jt(t,e);return this.workers[r]}}t.initialize=function(){},t.onmessage=function(t,e){const r=t.data;this.dispatcher||(this.dispatcher=new ia(t.workerId)),"<response>"===t.type?this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t):this.dispatcher[r.command]({actorId:r.actorId,mapId:r.mapId,layerId:r.layerId,params:r.params},((t,r,n)=>{t instanceof Error&&(t={message:t.message}),e(t,r,n)}))},Object.defineProperty(t,"Yt",{value:!0})}';function R$4(t){return null==t}function g$2(t){for(let e=1;e<arguments.length;e++){const r=arguments[e];for(const e in r)t[e]=r[e]}return t}function p$4(t){return null!=t&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function y$3(t){return"object"==typeof t&&!!t}function I$3(t){return"number"==typeof t&&!isNaN(t)}function b$3(t){return t*Math.PI/180}function S$4(t){return t/Math.PI*180}function P$4(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}function D$4(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}const N$4=[1,1,1,1,2,2,3,0];function M$4(t){const e=t.length;let r="";for(let n=0;n<e;){let i=t[n++];if(128&i){let r=N$4[i>>3&7];if(!(64&i)||!r||n+r>e)return null;for(i&=63>>r;r>0;r-=1){const e=t[n++];if(128!=(192&e))return null;i=i<<6|63&e}}r+=String.fromCharCode(i)}return r}function O$4(t,e,r){return t[3*r]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2],t}function L$4(t){return t.flat?t.flat(1/0):t.reduce(((t,e)=>t.concat(e)),[])}function F$4(t){return t<256?Uint8Array:t<65536?Uint16Array:Uint32Array}function x$3(t){return 0===t.indexOf("data:")}function w$4(t){const e=t.indexOf("base64,"),r=t.substring(e+7),n=window.atob(r),i=n.length,o=new Uint8Array(i);for(let t=0;t<i;t++)o[t]=n.charCodeAt(t);return o.buffer}function v$3(t){for(let e=1;e<arguments.length;e++){const r=arguments[e];if(r)for(let e=0,n=r.length;e<n;e++)t.push(r[e])}return t.length}var U$3=Object.freeze({__proto__:null,isNil:R$4,extend:g$2,isFunction:p$4,isObject:y$3,isNumber:I$3,toRadian:b$3,toDegree:S$4,getAbsoluteURL:P$4,sign:D$4,stringFromUTF8Array:M$4,setColumn3:O$4,flatArr:L$4,getBatchIdArrayType:F$4,isBase64:x$3,base64URLToArrayBuffer:w$4,pushIn:v$3});const G$3="undefined"==typeof document?null:document.createElement("canvas");class H$4 extends t__namespace.worker.Actor{constructor(t,e){super(t),this.mapId=e}initialize(t){t(null)}loadTile(t,e,r){let n=null;e&&e.arraybuffer&&(n=[e.arraybuffer]);this.send({mapId:this.mapId,layerId:t,command:"loadTile",params:e},n,r)}abortTileLoading(t,e,r){this.broadcast({mapId:this.mapId,layerId:t,command:"abortTileLoading",params:{url:e}},null,r)}addLayer(t,e,r){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:e}},null,r)}removeLayer(t,e){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,e)}requestImage({url:t},e){const r=new Image;r.onload=()=>{if(!this.isActive())return;if(!G$3)return void e(new Error("There is no canvas to draw image!"));const t=function(t){if(V$4(t.width)&&V$4(t.height))return t;let e=t.width,r=t.height;V$4(e)||(e=K$3(e)),V$4(r)||(r=K$3(r));const n=document.createElement("canvas");n.width=e,n.height=r,n.getContext("2d").drawImage(t,0,0,e,r);const i=t.src,o=i.lastIndexOf("/")+1,s=i.substring(o);return console.warn(`Texture(${s})'s size is not power of two, resize from (${t.width}, ${t.height}) to (${e}, ${r})`),n}(r);G$3.width=t.width,G$3.height=t.height;const n=G$3.getContext("2d",{willReadFrequently:!0});n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),o={width:t.width,height:t.height,data:new Uint8Array(i.data)};e(null,o,[o.data.buffer])},r.onerror=function(t){e(t)},r.src=t}}function V$4(t){return 0==(t&t-1)&&0!==t}function K$3(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}class k$4{constructor(t,e){this.max=t,this.currentSize=0,this.onRemove=e,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this.currentSize=0,this}clear(){this.reset(),delete this.onRemove}add(t,e){if(!e)return this;if(e.node&&e.node.memorySize&&(this.currentSize+=e.node.memorySize),this.has(t)){const r=this.data.get(t);r&&r.node&&r.node.memorySize&&(this.currentSize-=r.node.memorySize),this.data.delete(t),this.data.set(t,e)}else this.data.set(t,e);return this}shrink(){if(this.currentSize>this.max){const t=this.data.keys();let e=t.next();for(;this.currentSize>this.max&&void 0!==e.value;){if(!this.data.get(e.value).current){const t=this.getAndRemove(e.value);t&&this.onRemove(t)}e=t.next()}}}has(t){return this.data.has(t)}keys(){const t=new Array(this.data.size);let e=0;const r=this.data.keys();for(let n of r)t[e++]=n;return t}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return e.node&&e.node.memorySize&&(this.currentSize-=e.node.memorySize),this.data.delete(t),e}get(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),this.data.set(t,e),e}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return e.node&&e.node.memorySize&&(this.currentSize-=e.node.memorySize),this.data.delete(t),this.onRemove(e),this}setMaxSize(t){return this.max=t,this.shrink(),this}getMemorySize(){let t=0;const e=this.data.values();for(const r of e){const e=r&&r.node;e&&e.memorySize&&(t+=e.memorySize)}return t}markAll(t){const e=this.data.values();for(const r of e)r.current=t}}function X$3(t,e){if(t.scenes&&t.scenes.length)for(let r=0,n=t.scenes.length;r<n;r++){const n=t.scenes[r].nodes;for(let r=0,i=n.length;r<i;r++){Q$3(n[r],[],t,e)}}}const z$3=[],J$3=[],Y$2=[],Z$3=[0,0,0],W$3=identity$1([]),j$3=[1,1,1];function Q$3(t,e,r,n){const i=e.slice(0);if(t.matrix)i.push(t.matrix);else if(t.rotation||t.translation||t.scale){const e=fromTranslation$1(z$3,t.translation||Z$3),r=fromQuat(J$3,t.rotation||W$3),n=fromScaling(Y$2,t.scale||j$3);multiply$5(n,r,n);const o=multiply$5([],e,n);i.push(o)}if(t.children&&t.children.length)for(let e=0,o=t.children.length;e<o;e++)Q$3(t.children[e],i,r,n);if(void 0!==t.mesh){const e=t.mesh,o=r.meshes[e];if(o){const t=i.slice(0),s=o.primitives;for(let i=0,o=s.length;i<o;i++){const o=s[i];o&&(o.matrices=t,n(o,e,i,r))}}}}function q$3(t,e,r){let{componentType:n,byteOffset:i,byteStride:o,itemSize:s}=e;const a=e.array.buffer,A=n?k$8.getTypedArrayCtor(n):e.array.constructor;if(i=void 0===i?e.array.byteOffset:i,o=o||0,!o||o===s*A.BYTES_PER_ELEMENT&&i%A.BYTES_PER_ELEMENT==0){const e=new A(a,i+r*s*A.BYTES_PER_ELEMENT,s);return t.set(e),t}o||(o=s*A.BYTES_PER_ELEMENT);const c=new Uint8Array(a,o*r+i,s*A.BYTES_PER_ELEMENT);return new Uint8Array(t.buffer).set(c),t}function $$3(t,e,r,n){t[4*e]=r[n],t[4*e+1]=r[n+4],t[4*e+2]=r[n+8],t[4*e+3]=r[n+12]}const tt$2=new Array(3),et$2=new Array(3),rt$2=[40680631590769,40680631590769,40408299984661.445];function nt$2(t,e,r,n){const i=rt$2,o=Math.cos(r);tt$2[0]=o*Math.cos(e),tt$2[1]=o*Math.sin(e),tt$2[2]=Math.sin(r),ut$2(tt$2,tt$2),multiply$4(et$2,i,tt$2);const s=Math.sqrt(dot$4(tt$2,et$2));var a,A,c;return(a=et$2)[0]=(A=et$2)[0]/(c=s),a[1]=A[1]/c,a[2]=A[2]/c,scale$4(tt$2,tt$2,n),add$4(t,et$2,tt$2)}const it$2=[1/6378137,1/6378137,1/6356752.314245179],ot$2=[1/40680631590769,1/40680631590769,1/40408299984661.445],st$2=new Array(3),at$2=new Array(3),At$1=new Array(3);function ct$2(t,e){const r=ot$2,n=function(t,e,r,n,i){const o=e[0],s=e[1],a=e[2],A=r[0],c=r[1],l=r[2],f=o*o*A*A,h=s*s*c*c,E=a*a*l*l,u=f+h+E,_=Math.sqrt(1/u),B=scale$4(lt$2,e,_);if(u<.1)return isFinite(_)?B:void 0;const C=n[0],T=n[1],m=n[2],R=ft$2;R[0]=B[0]*C*2,R[1]=B[1]*T*2,R[2]=B[2]*m*2;let g,p,y,I,b,S,P,D,N,M,O,L=(1-_)*Et$1(e)/(.5*Et$1(R)),F=0;do{L-=F,y=1/(1+L*C),I=1/(1+L*T),b=1/(1+L*m),S=y*y,P=I*I,D=b*b,N=S*y,M=P*I,O=D*b,g=f*S+h*P+E*D-1,p=f*N*C+h*M*T+E*O*m,F=g/(-2*p)}while(Math.abs(g)>ht$2);return t[0]=o*y,t[1]=s*I,t[2]=a*b,t}(st$2,e,it$2,r);let i=mul$4(at$2,n,r);i=ut$2(i,i);const o=sub$2(At$1,e,n),s=Math.atan2(i[1],i[0]),a=Math.asin(i[2]),A=D$4(dot$4(o,e))*Et$1(o);return t[0]=S$4(s),t[1]=S$4(a),t[2]=A,t}const lt$2=new Array(3),ft$2=new Array(3),ht$2=1e-12;function Et$1(t){return length$4(t)}function ut$2(t,e){const r=e[0],n=e[1],i=e[2];let o=r*r+n*n+i*i;return o>0&&(o=Math.sqrt(o),t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o),t}function _t$2(t,e){return multiply$4(e,t,ot$2),normalize$4(e,e)}function Bt$1(t,e){var r=t[0],n=t[1],i=Math.cos(n),o=i*Math.cos(r),s=i*Math.sin(r),a=Math.sin(n);return e.x=o,e.y=s,e.z=a,normalize$4(e,e)}var dt$2=Object.freeze({__proto__:null,radianToCartesian3:nt$2,cartesian3ToDegree:ct$2,normalizeCartesian:ut$2,geodeticSurfaceNormal:_t$2,geodeticSurfaceNormalCartographic:Bt$1});function mt$2(t,e,r,n){r=r||0,n=n||r;var i=Math.abs(t-e);return i<=n||i<=r*Math.max(Math.abs(t),Math.abs(e))}function Rt$1(t,e){let r="";for(let n=0;n<4;n++){const i=t.getUint8(e+n);r+=String.fromCharCode(i)}return r}const gt$2="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function pt$2(t,e,r){const n=new Uint8Array(t,e,r);return gt$2?JSON.parse(gt$2.decode(n)):JSON.parse(M$4(n))}function yt$2(t,e,r){const n=new Uint8Array(t,e,r);return gt$2?JSON.parse(gt$2.decode(n)):JSON.parse(M$4(n))}function It$1(t,e,r){return{offset:e,byteLength:r}}function bt$2(t,e,r,n){const{byteOffset:i,componentType:o,type:s}=t,{ctor:a,type:A}=Ot$1(o||"UNSIGNED_SHORT"),c=Nt$1(s);return{byteStride:0,byteOffset:i+r,itemSize:c,count:n*c,componentType:A,array:new a(e,r+i,n*c)}}function St$1(t,e,r,n){const i=bt$2(t,e,r,n);return i.array.buffer.byteLength!==e.byteLength&&(i.array=i.array.slice()),i}function Pt$1(t,e,r,n){const{byteOffset:i,componentType:o,type:s}=t,{ctor:a}=Ot$1(o||"UNSIGNED_SHORT"),A=Nt$1(s),c=new a(e,i,r*A);return 1===A?c[n]:c.subarray(n*A,n*A+A)}const Dt$1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4};function Nt$1(t){return t?Dt$1[t]:1}const Mt$1={BYTE:{ctor:Int8Array,type:5120,name:"Int8Array"},UNSIGNED_BYTE:{ctor:Uint8Array,type:5121,name:"Uint8Array"},SHORT:{ctor:Int16Array,type:5122,name:"Int16Array"},UNSIGNED_SHORT:{ctor:Uint16Array,type:5123,name:"Uint16Array"},INT:{ctor:Int32Array,type:5124,name:"Int32Array"},UNSIGNED_INT:{ctor:Uint32Array,type:5125,name:"Uint32Array"},FLOAT:{ctor:Float32Array,type:5126,name:"Float32Array"},DOUBLE:{ctor:Float64Array,type:5126,name:"Float64Array"}};function Ot$1(t){return Mt$1[t]}function Lt$1(t){for(let e in Mt$1)if(t===Mt$1[e].ctor)return Mt$1[e].type;throw new Error("unrecognized ctor:"+t)}function Ft$1(t,e,r,n){const i=t,o=e.length/3;for(let t=0;t<o;t++)i[3*t]=e[3*t]/65535*n[0]+r[0],i[3*t+1]=e[3*t+1]/65535*n[1]+r[1],i[3*t+2]=e[3*t+2]/65535*n[2]+r[2];return i}function xt$2(t,e,r){let n=t.getUint32(12,!0),i=t.getUint32(16,!0),o=t.getUint32(20,!0),s=t.getUint32(24,!0);const a=t.buffer;let A,c,l={},f={};n>0&&(l=pt$2(a,e,n),e+=n),i>0&&(A=function(t,e,r){return{offset:e,byteLength:r}}(0,e,i),e+=i),o>0&&(f=yt$2(a,e,o),e+=o);const h=It$1(0,e,s);return c=a.slice(h.offset,h.offset+h.byteLength),r.push(c),{featureTable:l,featureTableBin:A,batchTable:f,batchTableBin:c}}var wt$2={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},vt$1={},Ut$1={east:[],north:[],up:[],west:[],south:[],down:[]},Gt$1=[],Ht$1=[],Vt$1=[];const Kt$1=[0,0,0];function kt$1(t,e,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=t[15],r}const Xt$1=(Zt$1={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}}["east"]["north"],vt$1["eastnorth"]?Yt$1=vt$1.eastnorth:(Yt$1=function(t,e,r){if(equals$5(t,Kt$1))copy$4(Gt$1,wt$2.east),copy$4(Ht$1,wt$2.north),copy$4(Vt$1,wt$2[Zt$1]);else if(mt$2(t[0],0,1e-14)&&mt$2(t[1],0,1e-14)){var n=D$4(t[2]);copy$4(Gt$1,wt$2.east),copy$4(Ht$1,wt$2.north),scale$4(Ht$1,Ht$1,n),copy$4(Vt$1,wt$2[Zt$1]),"east"!==Zt$1&&"west"!==Zt$1&&scale$4(Vt$1,Vt$1,n)}else{_t$2(t,Ut$1.up);var i=Ut$1.up,o=Ut$1.east;o[0]=-t[1],o[1]=t[0],o[2]=0,normalize$4(Ut$1.east,o),cross$1(Ut$1.north,i,o),scale$4(Ut$1.down,Ut$1.up,-1),scale$4(Ut$1.west,Ut$1.east,-1),scale$4(Ut$1.south,Ut$1.north,-1),Gt$1=Ut$1.east,Ht$1=Ut$1.north,Vt$1=Ut$1[Zt$1]}return r[0]=Gt$1[0],r[1]=Gt$1[1],r[2]=Gt$1[2],r[3]=0,r[4]=Ht$1[0],r[5]=Ht$1[1],r[6]=Ht$1[2],r[7]=0,r[8]=Vt$1[0],r[9]=Vt$1[1],r[10]=Vt$1[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},vt$1.eastnorth=Yt$1),Yt$1);var Yt$1,Zt$1;const jt$1=[],Qt$1=[],qt$1=[],$t$1=[],te$1=[],ee$1=[],re$1=[],ne$1={x:0,y:0},ie$1={x:0,y:0},oe$1=Math.PI/180,se$1={programs:[{attributes:["aPosition","instanceId","batchId","aTexCoord0","aTexCoord1","aNormal","aColor","uv2","uv3","uv4","secondary_colour","uv6"],fragmentShader:1,vertexShader:0}],shaders:[{type:35633,content:"precision highp float;\n\n#include <gl2_vert>\n\n    attribute vec4 aPosition;\n\n#ifdef VertexColor\n\n    attribute vec4 aColor0;\n\n#endif\n\n#ifdef VertexNormal\n\n    attribute vec3 aNormal;\n\n#endif\n\n#ifdef Instance\n\n    attribute float instanceId;\n\n#else\n\n    attribute float batchId;\n\n#endif \n\n\n\n#ifdef HAS_VertexWeight\n\n    attribute float aVertexWeight;\n\n#endif\n\n\n\n#ifdef HAS_TextureCoordMatrix\n\n    attribute vec2 aTextureCoordMatrix;\n\n#endif\n\n\n\n#ifdef TexCoord\n\n    attribute vec4 aTexCoord;\n\n    varying vec4 vTexCoord;\n\n    uniform mat4 uTexMatrix;\n\n#ifdef COMPUTE_TEXCOORD\n\n    uniform float uTexture0Width;\n\n    varying vec4 vTexMatrix;\n\n    varying vec4 vTexCoordTransform;\n\n    varying vec2 vIsRGBA;\n\n#endif\n\n#endif\n\n\n\n#ifdef TexCoord2\n\n    attribute vec4 aTexCoord1;\n\n    uniform float uTexture1Width;\n\n    varying vec4 vTexMatrix2;\n\n#endif\n\n#ifdef InstanceBim\n\n    attribute vec4 uv2;\n\n    attribute vec4 uv3;\n\n    attribute vec4 uv4;\n\n    attribute vec4 secondary_colour;\n\n    attribute vec4 uv6;   \n\n#endif\n\n\n\n#ifdef InstancePipe\n\n    attribute vec4 uv1;\n\n    attribute vec4 uv2;\n\n    attribute vec4 uv3;\n\n    attribute vec4 uv4;\n\n    attribute vec4 uv5;\n\n    attribute vec4 uv6;\n\n    attribute vec4 uv7;\n\n    attribute vec4 secondary_colour;\n\n    attribute vec4 uv9;\n\n#endif\n\n    uniform vec4 uFillForeColor;\n\n    uniform vec4 uSelectedColor;\n\n    varying vec4 vPositionMC;\n\n    varying vec3 vPositionEC;\n\n#ifdef VertexNormal\n\n    varying vec3 vNormalEC;\n\n#endif\n\n    varying vec4 vColor;\n\n    const float SHIFT_LEFT8 = 256.0;\n\n    const float SHIFT_RIGHT8 = 1.0 / 256.0;\n\n    const float SHIFT_RIGHT4 = 1.0 / 16.0;\n\n    const float SHIFT_LEFT4 = 16.0;\n\n    void getTextureMatrixFromZValue(in float nZ, inout float XTran, inout float YTran, inout float scale, inout float isRGBA)\n\n    {\n\n        if(nZ <= 0.0)\n\n        {\n\n            return;\n\n        }\n\n        float nDel8 = floor(nZ * SHIFT_RIGHT8);\n\n        float nDel16 = floor(nDel8 * SHIFT_RIGHT8);\n\n        float nDel20 = floor(nDel16 * SHIFT_RIGHT4);\n\n        isRGBA = floor(nDel20);\n\n        YTran = nZ - nDel8 * SHIFT_LEFT8;\n\n        XTran = nDel8 - nDel16 * SHIFT_LEFT8;\n\n        float nLevel = nDel16 - nDel20 * SHIFT_LEFT4;\n\n        scale = 1.0 / pow(2.0, nLevel);\n\n    }\n\n    \n\n    void operation(vec4 operationType, vec4 color, vec4 selectedColor, inout vec4 vertexColor)\n\n    {\n\n        float right_2 = operationType.x * 0.5;\n\n        float right_4 = right_2 * 0.5;\n\n        float right_8 = right_4 * 0.5;\n\n        float right_16 = right_8 * 0.5;\n\n        float isSetColor = fract(right_2);\n\n        if(isSetColor > 0.1)\n\n        {\n\n            vertexColor *= color;\n\n        }\n\n        float isPicked = fract(floor(right_2)* 0.5);\n\n        if(isPicked > 0.1)\n\n        {\n\n            vertexColor *= selectedColor;\n\n        }\n\n        float isHide = fract(floor(right_4)* 0.5);\n\n        if(isHide > 0.1)\n\n        {\n\n            vertexColor.a = 0.0;\n\n        }\n\n    }\n\n    \n\n#ifdef COMPRESS_TEXCOORD\n\n#ifdef TexCoord\n\n    uniform vec2 decode_texCoord0_min;\n\n#endif\n\n#ifdef TexCoord2\n\n    uniform vec2 decode_texCoord1_min;\n\n#endif\n\n#ifdef MeshOPT_Compress\n\n    uniform vec3 decode_texCoord0_vNormConstant;\n\n    uniform vec3 decode_texCoord1_vNormConstant;\n\n#else\n\n    uniform float decode_texCoord0_normConstant;\n\n    uniform float decode_texCoord1_normConstant;\n\n#endif\n\n#endif\n\n\n\n#ifdef COMPRESS_VERTEX\n\n    uniform vec4 decode_position_min;\n\n    uniform float decode_position_normConstant;\n\n#endif\n\n\n\n#ifdef COMPRESS_NORMAL\n\n    uniform float normal_rangeConstant;\n\n#endif\n\n\n\nuniform mat4 modelMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat4 projMatrix;\n\nuniform mat3 modelNormalMatrix;\n\n\n\n\n\n\n\nfloat czm_signNotZero(float value) {\n\n    return value >= 0.0 ? 1.0 : -1.0;\n\n}\n\nvec2 czm_signNotZero(vec2 value) {\n\n    return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n\n}\n\n\n\nvec3 czm_octDecode(vec2 encoded, float range) {\n\n    if (encoded.x == 0.0 && encoded.y == 0.0) {\n\n        return vec3(0.0, 0.0, 0.0);\n\n    }\n\n    encoded = encoded / range * 2.0 - 1.0;\n\n    vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n\n    if (v.z < 0.0) {\n\n        v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n\n    }\n\n    return normalize(v);\n\n}\n\n\n\nvec4 czm_updatePositionDepth(vec4 coords) {\n\n    coords.z = clamp(coords.z / coords.w, -1.0, 1.0) * coords.w;\n\n    return coords;\n\n}\n\n\n\nvoid main()\n\n{\n\n#ifdef COMPRESS_VERTEX\n\n    vec4 vertexPos = vec4(1.0);\n\n    vertexPos = vec4(aPosition.xyz, 1.0);\n\n#else\n\n    vec4 vertexPos = aPosition;\n\n#endif\n\n#ifdef TexCoord\n\n\n\n#ifdef COMPRESS_TEXCOORD\n\n#ifdef MeshOPT_Compress\n\n    vec2 texCoord0;\n\n    texCoord0.x = aTexCoord.x * decode_texCoord0_vNormConstant.x;\n\n    texCoord0.y = aTexCoord.y * decode_texCoord0_vNormConstant.y;\n\n    vTexCoord.xy = decode_texCoord0_min + texCoord0.xy;\n\n#else\n\n    vTexCoord.xy = decode_texCoord0_min.xy + aTexCoord.xy * decode_texCoord0_normConstant;\n\n#endif\n\n#else\n\n    vTexCoord.xy = aTexCoord.xy;\n\n#endif\n\n\n\n#ifdef COMPUTE_TEXCOORD\n\n    vTexMatrix = vec4(0.0,0.0,1.0,0.0);\n\n    vIsRGBA.x = 0.0;\n\n    vTexCoordTransform.x = aTexCoord.z;\n\n    #ifdef HAS_TextureCoordMatrix\n\n        vTexCoordTransform.x = aTextureCoordMatrix.x;\n\n    #endif\n\n    if(vTexCoordTransform.x < -90000.0)\n\n    {\n\n        vTexMatrix.z = -1.0;\n\n    }\n\n    getTextureMatrixFromZValue(floor(vTexCoordTransform.x), vTexMatrix.x, vTexMatrix.y, vTexMatrix.z, vIsRGBA.x);\n\n    vTexMatrix.w = log2(uTexture0Width * vTexMatrix.z);\n\n#endif\n\n#endif\n\n\n\n#ifdef TexCoord2\n\n\n\n    #ifdef COMPRESS_TEXCOORD\n\n        #ifdef MeshOPT_Compress\n\n            vec2 texCoord1;\n\n            texCoord1.x = aTexCoord1.x * decode_texCoord1_vNormConstant.x;\n\n            texCoord1.y = aTexCoord1.y * decode_texCoord1_vNormConstant.y;\n\n            vTexCoord.zw = decode_texCoord1_min + texCoord1.xy;\n\n        #else\n\n            vTexCoord.zw = decode_texCoord1_min.xy + aTexCoord1.xy * decode_texCoord1_normConstant;\n\n        #endif\n\n    #else\n\n        vTexCoord.zw = aTexCoord1.xy;\n\n    #endif\n\n\n\n    vTexMatrix2 = vec4(0.0,0.0,1.0,0.0);\n\n    vIsRGBA.y = 0.0;\n\n    vTexCoordTransform.y = aTexCoord1.z;\n\n    #ifdef HAS_TextureCoordMatrix\n\n        vTexCoordTransform.y = aTextureCoordMatrix.y;\n\n    #endif\n\n    if(vTexCoordTransform.y < -90000.0)\n\n    {\n\n        vTexMatrix2.z = -1.0;\n\n    }\n\n    getTextureMatrixFromZValue(floor(vTexCoordTransform.y), vTexMatrix2.x, vTexMatrix2.y, vTexMatrix2.z, vIsRGBA.y);\n\n    vTexMatrix2.w = log2(uTexture1Width * vTexMatrix.z);\n\n#endif\n\n\n\n    vec4 vertexColor = uFillForeColor;\n\n#ifdef VertexColor\n\n    vertexColor *= aColor0 / 255.0;\n\n#endif\n\n#ifdef VertexNormal\n\n    vec3 normal = aNormal;\n\n    #ifdef COMPRESS_NORMAL\n\n        #ifdef MeshOPT_Compress\n\n            normal.x = aNormal.x / 127.0;\n\n            normal.y = aNormal.y / 127.0;\n\n            normal.z = 1.0 - abs(normal.x) - abs(normal.y);\n\n            normal = normalize(normal);\n\n        #else\n\n            normal = czm_octDecode(aNormal.xy, normal_rangeConstant).zxy;\n\n        #endif\n\n    #endif\n\n#endif\n\n#ifdef InstanceBim\n\n    mat4 worldMatrix;\n\n    worldMatrix[0] = uv2;\n\n    worldMatrix[1] = uv3;\n\n    worldMatrix[2] = uv4;\n\n    worldMatrix[3] = vec4(0, 0, 0, 1);\n\n    vertexPos = vec4(vertexPos.xyz,1.0) * worldMatrix;\n\n    vertexColor *= secondary_colour; \n\n#endif\n\n#ifdef InstancePipe\n\n    mat4 worldMatrix;\n\n    mat4 worldMatrix0;\n\n    mat4 worldMatrix1;\n\n    vec4 worldPos0;\n\n    vec4 worldPos1;\n\n    worldMatrix0[0] = uv1;\n\n    worldMatrix0[1] = uv2;\n\n    worldMatrix0[2] = uv3;\n\n    worldMatrix0[3] = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n    worldMatrix1[0] = uv4;\n\n    worldMatrix1[1] = uv5;\n\n    worldMatrix1[2] = uv6;\n\n    worldMatrix1[3] = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n    vec4 realVertex = vec4(vertexPos.xyz, 1.0);\n\n    realVertex.x = realVertex.x * uv7.z;\n\n    worldPos0 = realVertex * worldMatrix0;\n\n    worldPos1 = realVertex * worldMatrix1;\n\n    vertexColor *= secondary_colour; \n\n    #ifdef TexCoord\n\n        if(aTexCoord.y > 0.5)\n\n        {\n\n            vec4 tex4Vec = uTexMatrix * vec4(uv7.y, aTexCoord.x, 0.0, 1.0);\n\n            vTexCoord.xy = tex4Vec.xy;\n\n            vertexPos = worldPos1;\n\n            worldMatrix = worldMatrix1;\n\n        }\n\n        else\n\n        {\n\n            vec4 tex4Vec = uTexMatrix * vec4(uv7.x, aTexCoord.x, 0.0, 1.0);\n\n            vTexCoord.xy = tex4Vec.xy;\n\n            vertexPos = worldPos0;\n\n            worldMatrix = worldMatrix0;\n\n        }\n\n    #endif\n\n    #ifdef VertexNormal\n\n        normal.x = normal.x * uv7.z;\n\n    #endif\n\n#endif\n\n#ifdef Instance  \n\n    float index = instanceId;\n\n#else\n\n    float index = batchId;\n\n#endif  \n\n    vec4 positionMC = vec4(vertexPos.xyz, 1.0);\n\n    vColor = vertexColor;\n\n#ifdef VertexNormal\n\n    vNormalEC = modelNormalMatrix * normal;\n\n#endif\n\n    vPositionMC = positionMC;\n\n    vPositionEC = (modelViewMatrix * positionMC).xyz;\n\n    gl_Position = projMatrix * modelViewMatrix * vec4(vertexPos.xyz, 1.0);\n\n}\n\n"},{type:35632,content:"#ifdef GL_OES_standard_derivatives\n\n    #extension GL_OES_standard_derivatives : enable\n\n#endif\n\n#ifdef GL_EXT_shader_texture_lod\n\n    #extension GL_EXT_shader_texture_lod : enable\n\n#endif\n\nprecision highp float;\n\n#include <gl2_frag>\n\n    uniform vec4 uDiffuseColor;\n\n#ifdef TexCoord\n\n    varying vec4 vTexCoord;\n\n    #ifdef COMPUTE_TEXCOORD\n\n        uniform sampler2D uTexture;\n\n        uniform float uTexture0Width;\n\n        varying vec4 vTexCoordTransform;\n\n        varying vec4 vTexMatrix;\n\n        varying vec2 vIsRGBA;\n\n    #endif\n\n#endif\n\n\n\n    varying vec4 vPositionMC;\n\n    varying vec3 vPositionEC;\n\n    varying vec4 vColor;\n\n#ifdef VertexNormal\n\n    varying vec3 vNormalEC;\n\n#endif\n\n#ifdef TexCoord2\n\n    uniform sampler2D uTexture2;\n\n    uniform float uTexture1Width;\n\n    varying vec4 vTexMatrix2;\n\n#endif\n\n#ifdef COMPUTE_TEXCOORD\n\n    void calculateMipLevel(in vec2 inTexCoord, in float vecTile, in float fMaxMip, inout float mipLevel)\n\n    {\n\n        vec2 dx = dFdx(inTexCoord * vecTile);\n\n        vec2 dy = dFdy(inTexCoord * vecTile);\n\n        float dotX = dot(dx, dx);\n\n        float dotY = dot(dy, dy);\n\n        float dMax = max(dotX, dotY);\n\n        float dMin = min(dotX, dotY);\n\n        float offset = (dMax - dMin) / (dMax + dMin);\n\n        offset = clamp(offset, 0.0, 1.0);\n\n        float d = dMax * (1.0 - offset) + dMin * offset;\n\n        mipLevel = 0.5 * log2(d);\n\n        mipLevel = clamp(mipLevel, 0.0, fMaxMip - 1.62);\n\n    }\n\n    \n\n    void calculateTexCoord(in vec3 inTexCoord, in float scale, in float XTran, in float YTran, in float fTile, in float mipLevel, inout vec2 outTexCoord)\n\n    {\n\n        if(inTexCoord.z < -9000.0)\n\n        {\n\n            outTexCoord = inTexCoord.xy;\n\n        }\n\n        else\n\n        {\n\n            vec2 fTexCoord = fract(inTexCoord.xy);\n\n            float offset = 1.0 * pow(2.0, mipLevel) / fTile;\n\n            fTexCoord = clamp(fTexCoord, offset, 1.0 - offset);\n\n            outTexCoord.x = (fTexCoord.x + XTran) * scale;\n\n            outTexCoord.y = (fTexCoord.y + YTran) * scale;\n\n        }\n\n    }\n\n    \n\n    vec4 getTexColorForS3M(sampler2D curTexture, vec3 oriTexCoord, float texTileWidth, float fMaxMipLev, float fTexCoordScale, vec2 vecTexCoordTranslate, float isRGBA)\n\n    {\n\n        vec4 color = vec4(1.0);\n\n        float mipLevel = 0.0;\n\n    #ifdef GL_OES_standard_derivatives\n\n        calculateMipLevel(oriTexCoord.xy, texTileWidth, fMaxMipLev, mipLevel);\n\n    #endif\n\n        vec2 realTexCoord;\n\n        calculateTexCoord(oriTexCoord, fTexCoordScale, vecTexCoordTranslate.x, vecTexCoordTranslate.y, texTileWidth, mipLevel, realTexCoord);\n\n        if(isRGBA > 0.5)\n\n        {\n\n            vec2 rgbTexCoord;\n\n            rgbTexCoord.x = (realTexCoord.x + vecTexCoordTranslate.x * fTexCoordScale) * 0.5;\n\n            rgbTexCoord.y = (realTexCoord.y + vecTexCoordTranslate.y * fTexCoordScale) * 0.5;\n\n            color = texture2D(curTexture, rgbTexCoord.xy, -10.0);\n\n            vec2 vecAlphaTexCoord;\n\n            vecAlphaTexCoord.x = rgbTexCoord.x;\n\n            vecAlphaTexCoord.y = rgbTexCoord.y + fTexCoordScale * 0.5;\n\n            color.a = texture2D(curTexture, vecAlphaTexCoord.xy, -10.0).r;\n\n        }\n\n        else\n\n        {\n\n            if(oriTexCoord.z < -9000.0)\n\n            {\n\n                color = texture2D(curTexture, realTexCoord.xy);\n\n            }\n\n            else\n\n            {\n\n                color = texture2DLodEXT(curTexture, realTexCoord.xy, mipLevel);\n\n            }\n\n        }\n\n        \n\n        return color;\n\n    }\n\n    \n\n    vec4 getTextureColor()\n\n    {\n\n        if(vTexMatrix.z < 0.0)\n\n        {\n\n            return vec4(1.0);\n\n        }\n\n        float texTileWidth0 = vTexMatrix.z * uTexture0Width;\n\n        vec3 realTexCoord = vec3(vTexCoord.xy, vTexCoordTransform.x);\n\n        vec4 FColor = getTexColorForS3M(uTexture, realTexCoord, texTileWidth0, vTexMatrix.w, vTexMatrix.z, vTexMatrix.xy, vIsRGBA.x);\n\n    #ifdef TexCoord2\n\n        float texTileWidth1 = vTexMatrix2.z * uTexture1Width;\n\n        realTexCoord = vec3(vTexCoord.zw, vTexCoordTransform.y);\n\n        vec4 SColor = getTexColorForS3M(uTexture2, realTexCoord, texTileWidth1, vTexMatrix2.w, vTexMatrix2.z, vTexMatrix2.xy, vIsRGBA.y);\n\n        SColor.r = clamp(SColor.r, 0.0, 1.0);\n\n        SColor.g = clamp(SColor.g, 0.0, 1.0);\n\n        SColor.b = clamp(SColor.b, 0.0, 1.0);\n\n        return FColor * SColor;\n\n    #else\n\n        return FColor;\n\n    #endif\n\n    }\n\n#endif\n\n\n\n    vec3 czm_acesTonemapping(vec3 color) {\n\n        float g = 0.985;\n\n        float a = 0.065;\n\n        float b = 0.0001;\n\n        float c = 0.433;\n\n        float d = 0.238;\n\n\n\n        color = (color * (color + a) - b) / (color * (g * color + c) + d);\n\n\n\n        color = clamp(color, 0.0, 1.0);\n\n\n\n        return color;\n\n    }\n\n    vec4 SRGBtoLINEAR4(vec4 srgbIn) {\n\n        #ifndef HDR \n\n            vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));\n\n            return vec4(linearOut, srgbIn.a);\n\n        #else\n\n            return srgbIn;\n\n        #endif\n\n    }\n\n    vec3 LINEARtoSRGB(vec3 linearIn) {\n\n        #ifndef HDR \n\n            return pow(linearIn, vec3(1.0/2.2));\n\n        #else\n\n            return linearIn;\n\n        #endif\n\n    }\n\n    vec3 applyTonemapping(vec3 linearIn) {\n\n        #ifndef HDR\n\n            return czm_acesTonemapping(linearIn);\n\n        #else\n\n            return linearIn;\n\n        #endif\n\n    }\n\n  \n\n    vec3 computeNormal(in vec3 oriVertex)\n\n    {\n\n        vec3 normal = cross(vec3(dFdx(oriVertex.x), dFdx(oriVertex.y), dFdx(oriVertex.z)), vec3(dFdy(oriVertex.x), dFdy(oriVertex.y), dFdy(oriVertex.z)));\n\n        normal = normalize(normal);\n\n        return normal;\n\n    }\n\n    \n\n    uniform vec3 light0_viewDirection;\n\n    void main()\n\n    {\n\n        if(vColor.a < 0.1)\n\n        {\n\n            discard;\n\n        } \n\n        vec4 baseColorWithAlpha = vColor;\n\n    #ifdef COMPUTE_TEXCOORD\n\n        baseColorWithAlpha *= SRGBtoLINEAR4(getTextureColor());\n\n    #endif\n\n    \n\n        if(baseColorWithAlpha.a < 0.1)\n\n        {\n\n            discard;\n\n        }\n\n        vec3 normal = vec3(0.0);\n\n    #ifdef VertexNormal\n\n        normal = normalize(vNormalEC);\n\n    #endif\n\n        normal = length(normal) > 0.1 ? normal : computeNormal(vPositionMC.xyz);\n\n        vec3 color = baseColorWithAlpha.rgb;\n\n        vec3 dirVectorEC = normalize(light0_viewDirection);\n\n        float dotProduct = dot( normal, dirVectorEC );\n\n        float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n        dirDiffuseWeight = dirDiffuseWeight * 0.5 + 0.5;\n\n        color += color * uDiffuseColor.rgb * dirDiffuseWeight;\n\n    #ifdef TexCoord\n\n        color = LINEARtoSRGB(color);\n\n    #endif\n\n        glFragColor = vec4(color, baseColorWithAlpha.a);\n\n#if __VERSION__ == 100\n\n    gl_FragColor = glFragColor;\n\n#endif\n\n    }"}],techniques:[{attributes:{aPosition:{semantic:"POSITION",type:35666},instanceId:{semantic:"instanceId",type:5126},batchId:{semantic:"_BATCHID",type:5126},aTexCoord0:{semantic:"TEXCOORD_0",type:35664},aTexCoord1:{semantic:"aTexCoord1",type:35666},aNormal:{semantic:"aNormal",type:35665},aColor:{semantic:"COLOR_0",type:35666},uv2:{semantic:"uv2",type:35666},uv3:{semantic:"uv3",type:35666},uv4:{semantic:"uv4",type:35666},secondary_colour:{semantic:"secondary_colour",type:35666},uv6:{semantic:"uv6",type:35666},TextureCoordMatrix:{semantic:"TextureCoordMatrix",type:35664}},program:0,uniforms:{czm_modelView:{type:35676,semantic:"MODELVIEW"},czm_normal:{type:35675,semantic:"MODELINVERSETRANSPOSE"},czm_modelViewProjection:{type:35676,semantic:"MODELVIEWPROJECTION"},uTexMatrix:{type:35676},uTexture0Width:{type:5126},uFillForeColor:{type:35666},uSelectedColor:{type:35666},uDiffuseColor:{type:35666},uTexture:{type:35678},uTexture2:{type:35678},uTexture1Width:{type:5126}}}]},{getTextureMagFilter:ae$1,getTextureMinFilter:Ae$1,getTextureWrap:ce$1,getMaterialType:le$1,getMaterialFormat:fe$1,getPrimitive:he$1,getUniqueREGLBuffer:Ee$1}=Gt$5,ue$1=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],_e$1=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],{loginIBLResOnCanvas:Be$1,logoutIBLResOnCanvas:de$1,getIBLResOnCanvas:Ce$1,getPBRUniforms:Te$1}=Fm.PBRUtils,me$1={factor:0,units:0},Re$1={specularStrength:0,materialShininess:1},ge$1=[1,1,1],pe$1=identity$2([]),ye$1=t=>t.material instanceof rt$6,Ie$1=t=>t.material instanceof Fm.StandardMaterial,be$1=[!0,!0,!0,!0],Se$1=[],Pe$1=new t__namespace.Coordinate(0,0),De$1=new t__namespace.Point(0,0),Ne$1=new t__namespace.Point(0,0),Me$1=new t__namespace.Point(0,0),Oe$1=[],Le$1=[],Fe$1=[],xe$1=[],we$1={POSITION:"POSITION",NORMAL:"NORMAL",TEXCOORD_0:"TEXCOORD_0",TEXCOORD_1:"TEXCOORD_1",COLOR_0:"COLOR_0",TANGENT:"TANGENT",_BATCHID:"_BATCHID"};class ve$1{constructor(e,n){this.t=n,this.i=n.getRenderer().canvas,this.pickingFBO=n.getRenderer().pickingFBO,this.o=new t__namespace.SpatialReference,this.A=e,this.l=new N$8(e),this.h={},this.u={},this._={},this.B={},this.C={},this.T={},this.m={},this.R=new yt$6,this.g=new yt$6,this.p=new yt$6,this.I=new yt$6,this.S=new gt$6(e.texture(2)),this.P=this.D.bind(this),this.N=new rt$6({baseColorFactor:[1,1,1,1]}),this.M(),this.O=new Lm(this.A,this.L(),this.S);const i=this.getMap();i.altitudeToPoint&&(this.F=i.altitudeToPoint(100,i.getGLRes())/100)}getI3DMMeshes(){return this.C}getPNTSMeshes(){return this.B}getB3DMMeshes(){return this._}getPaintedMeshes(){return this.v}getMap(){return this.t.getMap()}paint(t,e,r){const n=r&&r.renderTarget,o=r&&r.sceneFilter,s=this.getMap();if(!t.length||!s)return;const a=this.U(),A=s.projViewMatrix,c=this.t.options.services,f=[],h=[];let E=[];const u=[],_=[],B=this.G(t);for(let n=0,o=t.length;n<o;n++){const o=t[n].data.node;let s=this.H(o);if(!s)continue;this.T[o.id]&&(s=this.T[o.id],s=L$4(s));let a=c[o.V].polygonOffset||me$1;p$4(a)&&(a=a()),Array.isArray(s)||(f[0]=s,s=f);for(let t=0,n=s.length;t<n;t++){const n=s[t].properties.magic;if("b3dm"===n){if(s[t].getBoundingBox&&!intersectsBox$1(A,s[t].getBoundingBox()))continue;const{batchIdData:e,batchIdMap:n}=s[t].geometry.properties;if(e&&n){const e=s[t].properties.node.V;this.K&&this.K[e]&&ae$4.highlightMesh(this.A,s[t],this.K[e],this.k,n),ae$4.showOnly(this.A,s[t],this.X&&this.X[e],this.J,n)}r&&r.bloom&&s[t].properties.hlBloomMesh&&(s[t].properties.hlBloomMesh.properties.depthFunc="always",s[t].properties.hlBloomMesh.properties.polygonOffset=a,E.push(s[t].properties.hlBloomMesh)),E.push(s[t])}else"pnts"===n?u.push(s[t]):"i3dm"===n&&_.push(s[t]);s[t].properties.isLeaf=!!e[o.id],s[t].properties.level=B.get(o.Y),s[t].properties.polygonOffset=a,s[t].Z=o,e[o.id]||h.push(s[t])}}let d=0;const C=this.O.getExcludeFilter();d+=this.W(this.j,a,[o,ye$1,C],n,h,E,_),d+=this.W(this.q,a,[o,Ie$1,C],n,h,E,_),this.O.forEachShader(((t,e,r)=>{const i=this.U(r);d+=this.W(t,i,[o,e],n,h,E,_)})),this.g.setMeshes(u);const T=this.$();return d+=this.l.render(this.tt,T,this.g,n&&n.fbo),this.v={pntsMeshes:u,i3dmMeshes:_,b3dmMeshes:E},d}W(t,e,r,n,i,o,s){t.filter=r.filter((t=>!!t)),e.debug=!1,e.stencilEnable=!0,e.debug=!1,e.cullFace="back",e.colorMask=be$1;let a=0;return this.R.setMeshes(o),a+=this.l.render(t,e,this.R,n&&n.fbo),e.stencilEnable=!0,this.p.setMeshes(s),a+=this.l.render(t,e,this.p,n&&n.fbo),a}et(t,e){return e.Z.rt-t.Z.rt}paintRegion(t,e,r,n,i){const o=this.getMap();if(!t.length&&!e.length)return;const s=o.projViewMatrix,a=[];for(let r=0,n=(t=t.concat(e)).length;r<n;r++){const n=this.nt(t[r].node);n&&(n.getBoundingBox&&!intersectsBox$1(s,n.getBoundingBox())||a.push(n))}this.it.filter=n,this.I.setMeshes(a);const A=this.ot(r);this.l.render(this.it,A,this.I,i&&i.fbo)}deleteTile(t){this.st(t.node.id)}st(t){const e=this.u[t];e&&(e.geometry.dispose(),e.dispose(),delete this.u[t]);let r=this._[t]||this.B[t]||this.C[t]||this.T[t]||this.h[t];this.T[t]?this.At(t):r&&(this.ct(r),delete this._[t],delete this.B[t],delete this.C[t],delete this.h[t])}At(t){let e=this.T[t];e=L$4(e);for(let t=0;t<e.length;t++){const{id:r}=e[t].properties;this.st(r)}delete this.T[t]}ct(t){if(Array.isArray(t))for(let e=0,r=t.length;e<r;e++)this.ct(t[e]);else{ae$4.showOnly(this.A,t),ae$4.highlightMesh(this.A,t);const e=t.geometry.properties.url;if(e){const t=this.m[e];t&&(t.refCount--,t.refCount<=0&&(t.geometry.dispose(),t.material.dispose(),delete this.m[e]))}else t.geometry.dispose(),t.material&&t.material.dispose();t.dispose()}}remove(){const t=this.t;de$1(t.getRenderer().canvas,t.getMap());for(const t in this.T)this.At(t);this.T={};for(const t in this._)this.st(t);this._={};for(const t in this.B)this.st(t);this.B={};for(const t in this.C)this.st(t);this.C={};for(const t in this.h)this.st(t);this.h={};for(const t in this.u)this.st(t);this.u={},this.j&&(this.j.dispose(),delete this.j),this.q&&(this.q.dispose(),delete this.q),this.tt&&(this.tt.dispose(),delete this.tt),this.it&&(this.it.dispose(),delete this.it),this.O.dispose(),this.picking&&this.picking.dispose()}nt(e){if(!e.boundingVolume||!e.boundingVolume.region)return null;if(this.u[e.id])return this.u[e.id];const i=e.boundingVolume.region;let o=new t__namespace.Coordinate(S$4(i[0]),S$4(i[1])),s=new t__namespace.Coordinate(S$4(i[2]),S$4(i[3]));o=this.lt(o),s=this.lt(s);const a=o.add(s).ft(.5);o._sub(a),s._sub(a);const A=this.ht(i[4],i[5]),c=A.x,l=A.y,h=new Q$7({aPosition:[o.x,o.y,l,s.x,o.y,l,s.x,s.y,l,o.x,s.y,l,o.x,o.y,c,s.x,o.y,c,s.x,s.y,c,o.x,s.y,c]},[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],0,{primitive:"lines"});h.generateBuffers(this.A);const E=new ft$6(h),u=identity$2([]);return E.setLocalTransform(translate$1(u,u,[a.x,a.y,0])),this.u[e.id]=E,E}H(t){return this._[t.id]||this.B[t.id]||this.C[t.id]||this.T[t.id]}has(t){return this.H(t)||this.h[t.id]}createPntsMesh(t,e,i,o){if(this.B[e]){const t=this.B[e];return console.warn(`pnts mesh with id(${e}) was already created.`),o(null,{id:e,mesh:t}),t}const{pnts:s,featureTable:a,rootIdx:A}=t,c=this.t.options.services[A],l=a.POINTS_LENGTH,f=new Q$7(s,null,l,{primitive:"points",positionAttribute:"POSITION"});f.generateBuffers(this.A);const h={};s.POSITION?h.HAS_POSITION=1:s.POSITION_QUANTIZED&&(h.HAS_POSITION_QUANTIZED=1),s.RGB?h.HAS_RGB=1:s.RGBA?h.HAS_RGBA=1:s.RGB565&&(h.HAS_RGB565=1),(s.NORMAL||s.NORMAL_OCT16P)&&(h.HAS_NORMAL=1,s.NORMAL_OCT16P&&(h.HAS_NORMAL_OCT16P=1)),t.featureTable.CONSTANT_RGBA&&(t.featureTable.CONSTANT_RGBA=t.featureTable.CONSTANT_RGBA.map((t=>t/255)));const{rtcCenter:E,rtcCoord:u}=t,_=this.Et(Fe$1,u),B=this.ut([],i,E,u);multiply$5(B,B,_);const d=this.t.options.services[A],C=new ft$6(f);if(C.properties.magic="pnts",C.properties.id=e,C.properties.node=i,C.properties.count=l,C.properties.batchTable=t.batchTable,C.properties.batchTableBin=t.batchTableBin,C.properties.serviceIndex=A,C.setDefines(h),Object.defineProperty(C.uniforms,"pointColor",{enumerable:!0,get:function(){return t.featureTable.CONSTANT_RGBA?t.featureTable.CONSTANT_RGBA:d&&d.pointColor||[1,1,1,1]}}),Object.defineProperty(C.uniforms,"pointSize",{enumerable:!0,get:function(){return d&&d.pointSize||2}}),Object.defineProperty(C.uniforms,"pointOpacity",{enumerable:!0,get:function(){return d&&d.pointOpacity||1}}),c.coordOffset){multiply$5(B,this._t(i.V,u),B)}return C.setLocalTransform(B),this.B[e]=C,o(null,{id:e,mesh:[C]}),[C]}createI3DMMesh(t,e,i,s){if(this.C[e]){const t=this.C[e];return console.warn(`i3dm mesh with id(${e}) was already created.`),this.h[e]||s(null,{id:e,mesh:t}),t}const a=this.t.options.services[i.V],c=this.Bt(i.dt),{i3dm:l,featureTable:f,gltf:h,batchTable:u,batchTableBin:_,count:B}=t,d=f.INSTANCES_LENGTH,{rtcCenter:C,rtcCoord:T}=t,m=this.Et(Fe$1,T),R=this.ut(xe$1,i,C,T);multiply$5(m,R,m);const{POSITION:g,NORMAL_UP:p,NORMAL_RIGHT:y,SCALE:I,SCALE_NON_UNIFORM:b,INSTANCE_ROTATION:S}=l,P={instance_vectorA:new Float32Array(4*d),instance_vectorB:new Float32Array(4*d),instance_vectorC:new Float32Array(4*d)},D=new Float32Array(3),N=new Float32Array(3),M=[],L=new Float32Array(1),F=new Float32Array(3),x=[],w=[],v=[],U=[],G=new Float32Array(9);!function(t,e){let{componentType:r,byteOffset:n,byteStride:i,count:o,itemSize:s}=t;const a=t.array.buffer,A=r?k$8.getTypedArrayCtor(r):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,i=i||0,o=o||t.array.length/s,(!i||i===s*A.BYTES_PER_ELEMENT)&&n%A.BYTES_PER_ELEMENT==0){const t=new A(a,n,o*s);for(let r=0;r<o*s;r+=s)e(new A(t.buffer,n+r*A.BYTES_PER_ELEMENT,s),r/s);return}const c=new Uint8Array(s*A.BYTES_PER_ELEMENT);i||(i=s*A.BYTES_PER_ELEMENT);for(let t=0;t<o;t++){const r=new Uint8Array(a,i*t+n,s*A.BYTES_PER_ELEMENT);c.set(r),e(new A(c.buffer),t),r.set(c)}}(g,((t,e)=>{p?(q$3(N,y,e),q$3(D,p,e),cross$1(M,N,D),normalize$4(M,M),O$4(x,N,0),O$4(x,D,1),O$4(x,M,2),fromMat3(w,x)):S?(q$3(G,S,e),fromMat3(w,G)):identity$1(w),I?(q$3(L,I,e),set$4(v,L[0],L[0],L[0])):b?(q$3(F,b,e),set$4(v,...F)):set$4(v,1,1,1),fromRotationTranslationScale(U,w,t,v),$$3(P.instance_vectorA,e,U,0),$$3(P.instance_vectorB,e,U,1),$$3(P.instance_vectorC,e,U,2)}));const H={};for(const t in P)H[t]={buffer:this.A.buffer({dimension:P[t].length/d,data:P[t]}),divisor:1};const V=a.shader||"phong";let K=0,k=!0;const z=[];return X$3(h,((t,o,s,A)=>{let{geometry:l,material:f}=this.Ct(t,o,s,A,i,!0,V);f&&!f.isReady()&&(k=!1,K++);const h=new dt$6(H,d,l,f);h.properties.magic="i3dm",h.properties.id=e,h.properties.count=B,h.properties.batchTable=u,h.properties.batchTableBin=_,h.properties.serviceIndex=i.V;const E=this.Tt(t,l,f,i.V,A),C=identity$2([]);if(t.matrices&&t.matrices.length)for(let e=0;e<t.matrices.length;e++)multiply$5(C,C,t.matrices[e]);let R;if(multiply$5(C,c,C),h.setPositionMatrix(C),a.coordOffset){R=multiply$5([],this._t(i.V,T),m)}else R=copy$5([],m);h.setLocalTransform(R),h.setDefines(E),h.properties.polygonOffset={offset:0,factor:0},z.push(h)})),k?(this.C[e]=z,s(null,{id:e,mesh:z})):(this.h[e]={meshes:z,count:K},z.Rt=s),z}createB3DMMesh(e,i,o,s){if(this._[i]||this.h[i]){const t=this._[i];return console.warn(`mesh with id(${i}) was already created.`),this.h[i]||s(null,{id:i,mesh:t}),t}let a;if(o.maxExtent){const e=new t__namespace.Extent(o.maxExtent).convertTo((t=>this._pointToPrj(t)));a=[e.xmin,e.ymin,e.xmax,e.ymax]}const A=e.gltf,{projCenter:c}=A.extensions.MAPTALKS_RTC,{rtcCoord:l,center:f}=A.extensions.CESIUM_RTC,h=this.Bt(o.dt);let E;E=A.asset&&A.asset.sharePosition?this.Et(Fe$1,l):this.gt(Fe$1,l,c,o.V);const u=this.t.options.services[o.V];let _=u.shader||"pbr";if(A.materials)for(let t=0;t<A.materials.length;t++)if(A.materials[t]&&A.materials[t].extensions&&A.materials[t].extensions.KHR_materials_unlit){_=u.shader="phong";break}const B=[];let d=0,C=!0;return X$3(A,((t,s,A,c)=>{let{geometry:T,material:m}=this.Ct(t,s,A,c,o,!1,_);m&&!m.isReady()&&(C=!1,d++);const R=new ft$6(T,m);R.properties.magic="b3dm",R.properties.id=i,R.properties.node=o,R.properties.batchTable=e.batchTable,R.properties.batchTableBin=e.batchTableBin,R.properties.count=e.featureTable.BATCH_LENGTH,R.properties.serviceIndex=o.V;const g=this.Tt(t,T,m,o.V,c);R.setDefines(g);const p=t.compressUniforms;if(p)for(const t in p)R.setUniform(t,p[t]);a&&(g.USE_MAX_EXTENT=1,R.setUniform("maxPrjExtent",a)),Object.prototype.hasOwnProperty.call(R.uniforms,"polygonOpacity")||Object.defineProperty(R.uniforms,"polygonOpacity",{enumerable:!0,get:function(){return I$3(u.opacity)?u.opacity:1}});let y=identity$2([]);if(c.asset.sharePosition&&t.matrices&&t.matrices.length)for(let e=0;e<t.matrices.length;e++)multiply$5(y,y,t.matrices[e]);if(c.asset.sharePosition){const t=this.ut(xe$1,o,f,l);multiply$5(y,h,y),multiply$5(y,E,y),multiply$5(y,t,y)}else multiply$5(y,E,y);if(u.coordOffset){multiply$5(y,this._t([],o.V,l),y)}R.setLocalTransform(y),B.push(R)})),C?(this._[i]=B,s(null,{id:i,mesh:B})):(this.h[i]={meshes:B,count:d},B.Rt=s),B}ut(e,r,i,s){const a=this.getMap(),A=this.t.options.services[r.V].heightOffset||0,c=new t__namespace.Coordinate(s);let l;l=a.altitudeToPoint?this.F:a.distanceToPointAtRes(100,100,a.getGLRes(),c).y/100;let f=r.matrix?copy$5(e,r.matrix):identity$2(e);i&&kt$1(f,transformMat4$2(Se$1,i,f),f);const h=function(t,e,r,n,i,o,s){e=copy$4(jt$1,e);const a=nt$2(jt$1,e[0]*oe$1,e[1]*oe$1,e[2]),A=getTranslation$1(Qt$1,r),c=n.ellipsoid;var l;l=0===len$4(A)?set$4(qt$1,0,0,-6378137):ct$2(qt$1,A),ne$1.x=l[0],ne$1.y=l[1];const f=n.project(ne$1,ie$1);$t$1[0]=f.x/i,$t$1[1]=f.y/i,$t$1[2]=(l[2]+s)*o;const h=Xt$1(a,c,te$1),E=function(t,e,r){var n=t[0],i=t[1],o=t[2],s=t[4],a=t[5],A=t[6],c=t[8],l=t[9],f=t[10],h=e[0],E=e[1],u=e[2],_=e[3],B=e[4],d=e[5],C=e[6],T=e[7],m=e[8],g=i*h+a*E+l*u,p=o*h+A*E+f*u,y=n*_+s*B+c*d,I=i*_+a*B+l*d,b=o*_+A*B+f*d,S=n*C+s*T+c*m,P=i*C+a*T+l*m,D=o*C+A*T+f*m;return r[0]=n*h+s*E+c*u,r[1]=g,r[2]=p,r[3]=0,r[4]=y,r[5]=I,r[6]=b,r[7]=0,r[8]=S,r[9]=P,r[10]=D,r[11]=0,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}(invert$2(ee$1,h),fromMat4$1(re$1,r),t);return kt$1(t,$t$1,E),t}(f,s,f,a.getProjection(),a.getGLRes(),l,A),E=function(t,e){return set$4(t,e[12],e[13],e[14]),t}(Le$1,h);let u=this.t.options.offset;return p$4(u)&&(u=u(this.t.yt(r.id).center)),set$4(Oe$1,u[0],u[1],0),sub$2(E,E,Oe$1),kt$1(h,E,h),h}_t(t,e,r){const i=this.t.options.services[e];if(!i.coordOffset)return null;const s=this.getMap(),a=s.getGLRes();Pe$1.set(r[0],r[1]);const A=s.coordToPointAtRes(Pe$1,a,Ne$1),c=i.coordOffset,l=Pe$1.set(r[0]+c[0],r[1]+c[1]),f=s.coordToPointAtRes(l,a,Me$1),h=f.x-A.x,E=f.y-A.y,u=this.It();return fromTranslation$1(t,set$4(Oe$1,h,E,(c[2]||0)*u))}It(){const t=this.getMap();let e;return e=t.altitudeToPoint?this.F:t.distanceToPointAtRes(100,100,t.getGLRes(),Pe$1).y/100,e}createCMPTMesh(t,e,r,n){if(this.T[e]){const t=this.T[e];return console.warn(`mesh with id(${e}) was already created.`),n(null,{id:e,mesh:t}),t}const{content:i}=t,o=[];for(let t=0;t<i.length;t++){const{magic:n}=i[t],s=e+"."+t;"b3dm"===n?this.createB3DMMesh(i[t],s,r,((t,{mesh:e})=>{o.push(e)})):"i3dm"===n?this.createI3DMMesh(i[t],s,r,((t,{mesh:e})=>{o.push(e)})):"pnts"===n?this.createPntsMesh(i[t],s,r,((t,{mesh:e})=>{o.push(e)})):"cmpt"===n&&this.createCMPTMesh(i[t],s,r,((t,{mesh:e})=>{o.push(e)}))}return this.T[e]=o,n(null,{id:e,mesh:o}),o}Tt(t,e,r,n,i){const o=("phong"===(this.t.options.services[n].shader||"phong")?this.j:this.q).getGeometryDefines(e);return i.asset&&"S3M"===i.asset.generator&&this.bt(o,e,i),e.data.uvRegion&&(o.HAS_I3S_UVREGION=1),e.data[e.desc.normalAttribute]&&(o.VertexNormal=1),e.data[e.desc.color0Attribute]&&(o.VertexColor=1),e.data[e.desc.uv0Attribute]&&(o.TexCoord=1),e.data[e.desc.textureCoordMatrixAttribute]&&(o.HAS_TextureCoordMatrix=1),r.get("uTexture")&&(o.COMPUTE_TEXCOORD=1),r.get("uTexture2")&&(o.TexCoord2=1),"MESHOPT"===this.t.St&&(o.MeshOPT_Compress=1),this.hasIBL()&&(o.HAS_IBL_LIGHTING=1),g$2(o,t.compressDefines),o}bt(t,e,r){e.data.aNormal&&(t.VertexNormal=1),e.data.instanceId&&(t.Instance=1),e.data.aTexCoord0&&(t.TexCoord=1),e.data.aColor&&(t.VertexColor=1),e.data.aTexCoord1&&(t.TexCoord2=1),e.data.uv2&&(t.InstanceBim=1),e.data.aTexCoord0&&r.textures.length&&(t.COMPUTE_TEXCOORD=1)}Ct(t,e,r,n,i,o,s){let a=!1;n.asset&&"S3M"===n.asset.generator&&(a=!0,n.extensions=n.extensions||{},n.extensions.KHR_techniques_webgl=se$1);const A=n.url+"-"+e+"-"+r;if(this.m[A])return this.m[A].refCount++,this.m[A];let c,l;const f=n.materials[t.material];if(n.extensions&&n.extensions.KHR_techniques_webgl&&f.extensions&&f.extensions.KHR_techniques_webgl){const e=this.Pt(t,n,o,a);c=e.material,l=e.geometry,this.t.options.services[i.V].fillEmptyDataInMissingAttribute&&(l.desc.fillEmptyDataInMissingAttribute=!0)}else{l=this.Dt(t,o,we$1);const e=this.t.options.services[i.V],r=e.ambientLight;let a=e.environmentExposure;const A=e.material,f=this.getMap().getLightManager(),h=f&&f.getAmbientLight();if(r&&(!h||h.color)&&void 0===a){a=r[0]/(h&&h.color?h.color[0]:.2)}c=this.Nt(t.material,n,s,A||Re$1,a||1)}c&&!c.isReady()?c.Mt=i.id:c||(c=this.N);const h={refCount:1,geometry:l,material:c};return l.properties.url=A,this.m[A]=h,h}Pt(t,e,r,n){const{geometry:i,material:o}=this.O.createMesh(t,e,r,n);return{geometry:i,material:o}}Dt(t,e,n){const i=t.attributes,o="COLOR_0";let s=i._BATCHID&&i._BATCHID.array;if(s&&s.byteOffset&&(s=new s.constructor(s)),i[o]){const t=i[o].array||i[o];if(t instanceof Float32Array){const e=new Uint8Array(t.length);for(let r=0;r<e.length;r++)e[r]=Math.round(255*t[r]);i[o].array?(i[o].array=e,i[o].componentType=5121):i[o]=e}}const a={};for(const t in i){const e=Ee$1(this.A,i[t],{dimension:i[t].itemSize}),r=n[t]||t;a[r]={buffer:e},i[t].quantization&&(a[r].quantization=i[t].quantization),r===n.POSITION&&(a[r].array=i[t].array,a[r].min=i[t].min,a[r].max=i[t].max)}delete t.attributes;const A=t.indices?t.indices.array?t.indices.array.slice():t.indices:null,c=new Q$7(a,A,0,{positionAttribute:n.POSITION,normalAttribute:n.NORMAL,uv0Attribute:n.TEXCOORD_0,uv1Attribute:n.TEXCOORD_1,color0Attribute:n.COLOR_0,tangentAttribute:n.TANGENT,pickingIdAttribute:n._BATCHID,primitive:void 0===t.mode?"triangles":he$1(t.mode)});return s&&A&&(c.properties.batchIdData=s,c.properties.batchIdMap=function(t,e){if(!e)return null;const r=new Map;for(let n=0;n<e.length;n++){const i=e[n],o=t[i];let s=r.get(o);s||(s=[],r.set(o,s)),s.push(i)}return r}
/*!
	 * @maptalks/gl v0.81.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.com
	 */(s,A)),c.generateBuffers(this.A,{excludeElementsInVAO:e}),c}gt(t,e,r,i){const s=identity$2(t),a=this.getMap();Pe$1.x=r[0],Pe$1.y=r[1];const A=this._prjToPoint(Pe$1),c=this.Ot(),l=1/(a.getGLZoom?a.getResolution(a.getGLZoom()):a.getGLRes());Pe$1.x=e[0],Pe$1.y=e[1];const f=this.It();let h=this.t.options.offset;p$4(h)&&(h=h(Pe$1));return set$4(Le$1,A.x-h[0],A.y-h[1],f*r[2]+f*(this.t.options.services[i].heightOffset||0)),translate$1(s,s,Le$1),set$4(c,l,l,f),scale$5(s,s,c),s}Et(t,e){const r=identity$2(t),i=this.getMap(),s=this.Ot();Pe$1.x=e[0],Pe$1.y=e[1];const a=i.distanceToPointAtRes(100,100,i.getGLRes(),Pe$1);let A;return A=i.altitudeToPoint?this.F:a.y/100,set$4(s,a.x/100*1.01,a.y/100*1.01,A),scale$5(r,r,s),r}M(){const t={x:0,y:0,width:()=>this.i?this.i.width:1,height:()=>this.i?this.i.height:1};this.it=new ie$5({vert:"attribute vec3 aPosition;\n\n\n\nuniform mat4 projViewModelMatrix;\n\n\n\nvoid main() {\n\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n}\n\n",frag:"precision mediump float;\nuniform vec3 color;\nvoid main() {\n    gl_FragColor = vec4(color, 1.0);\n}\n",uniforms:["color",{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:t}});const e=[],i=[];this.tt=new ie$5({vert:"const float SHIFT_RIGHT_11 = 1.0 / 2048.0;\n\nconst float SHIFT_RIGHT_5 = 1.0 / 32.0;\n\nconst float SHIFT_LEFT_11 = 2048.0;\n\nconst float SHIFT_LEFT_5 = 32.0;\n\nconst float NORMALIZE_6 = 1.0 / 64.0;\n\nconst float NORMALIZE_5 = 1.0 / 32.0;\n\n\n\n#ifdef HAS_POSITION\n\n    attribute vec3 POSITION;\n\n#endif\n\n\n\n#if defined(HAS_RGB)\n\n    attribute vec3 RGB;\n\n#elif defined(HAS_RGBA)\n\n    attribute vec4 RGBA;\n\n#elif defined(HAS_RGB565)\n\n    attribute float RGB565;\n\n#endif\n\n\n\nuniform vec4 pointColor;\n\nuniform float pointSize;\n\n\n\nuniform mat4 projViewModelMatrix;\n\nuniform float pointOpacity;\n\n\n\nvarying vec4 vColor;\n\n\n\n#ifdef HAS_NORMAL\n\n    #ifdef HAS_NORMAL_OCT16P\n\n        attribute vec2 NORMAL_OCT16P;\n\n        float signNotZero(float value) {\n\n            return value >= 0.0 ? 1.0 : -1.0;\n\n        }\n\n        vec2 signNotZero(vec2 value) {\n\n            return vec2(signNotZero(value.x), signNotZero(value.y));\n\n        }\n\n        vec3 octDecode(vec2 encoded, float range) {\n\n            if (encoded.x == 0.0 && encoded.y == 0.0) {\n\n                return vec3(0.0, 0.0, 0.0);\n\n            }\n\n            encoded = encoded / range * 2.0 - 1.0;\n\n            vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n\n            if (v.z < 0.0) {\n\n                v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\n\n            }\n\n            return normalize(v);\n\n        }\n\n        vec3 octDecode(vec2 encoded) {\n\n            return octDecode(encoded, 255.0);\n\n        }\n\n    #else\n\n        attribute vec3 NORMAL;\n\n    #endif\n\n    uniform vec3 lightDir;\n\n    uniform mat3 modelNormalMatrix;\n\n    uniform mat4 positionMatrix;\n\n    float getLambertDiffuse(vec3 lightDir, vec3 normal) {\n\n        return max(dot(-lightDir, normal), 0.0);\n\n    }\n\n#endif\n\n\n\nvoid main() {\n\n    #if defined(HAS_RGB)\n\n        vColor = vec4(RGB / 255.0, 1.0) * pointOpacity;\n\n    #elif defined(HAS_RGBA)\n\n        vColor = RGBA / 255.0 * pointOpacity;\n\n    #elif defined(HAS_RGB565)\n\n        float compressed = RGB565;\n\n        float r = floor(compressed * SHIFT_RIGHT_11);\n\n        compressed -= r * SHIFT_LEFT_11;\n\n        float g = floor(compressed * SHIFT_RIGHT_5);\n\n        compressed -= g * SHIFT_LEFT_5;\n\n        float b = compressed;\n\n        vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5);\n\n        vColor = vec4(rgb, 1.0);\n\n    #else\n\n        vColor = pointColor;\n\n    #endif\n\n\n\n    #ifdef HAS_POSITION\n\n        vec3 localPos = POSITION;\n\n    #endif\n\n\n\n    #ifdef HAS_NORMAL\n\n        mat3 positionNormalMatrix = mat3(positionMatrix);\n\n        mat3 normalMatrix = modelNormalMatrix * positionNormalMatrix;\n\n        #ifdef HAS_NORMAL_OCT16P\n\n            vec3 localNormal = octDecode(NORMAL_OCT16P);\n\n        #else\n\n            vec3 localNormal = NORMAL;\n\n        #endif\n\n        vec3 normal = normalize(normalMatrix * localNormal);\n\n        float colorStrength = getLambertDiffuse(lightDir, normal);\n\n        colorStrength = max(colorStrength, 0.5);\n\n        vColor *= colorStrength;\n\n    #endif\n\n\n\n    gl_Position = projViewModelMatrix * vec4(localPos, 1.0);\n\n    gl_PointSize = pointSize;\n\n}\n\n",frag:"#define SHADER_NAME PNTS\n\nprecision mediump float;\n\n\n\nvarying vec4 vColor;\n\n\n\nvoid main() {\n\n    gl_FragColor = vColor;\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5(i,e.projViewMatrix,e.modelMatrix)},{name:"modelNormalMatrix",type:"function",fn:(t,r)=>fromMat4$1(e,r.modelMatrix)}],extraCommandProps:{viewport:t,blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:[0,1],func:"<"}}});const o=this.L();this.j=new ae$5({extraCommandProps:o}),this.q=new Fm.StandardShader({extraCommandProps:o});const a=this.t;Be$1(a.getRenderer().canvas,this.A,a.getMap()),this.picking=new Am(this.l,{vert:this.q.vert,extraCommandProps:o,uniforms:this.q.uniforms,defines:{PICKING_MODE:1,ENABLE_PICKING:1,HAS_PICKING_ID:1}},this.pickingFBO,this.getMap())}L(){return{viewport:{x:0,y:0,width:()=>this.i?this.i.width:1,height:()=>this.i?this.i.height:1},colorMask:(t,e)=>e.colorMask||be$1,cull:{enable:!0,face:(t,e)=>e.cullFace||"back"},stencil:{enable:(t,e)=>!0===e.stencilEnable,func:{cmp:(t,e)=>e.meshProperties.isLeaf?"always":">=",ref:(t,e)=>e.meshProperties.level},opFront:{fail:"keep",zfail:"keep",zpass:"replace"},opBack:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:[0,1],func:(t,e)=>e.meshProperties.depthFunc||"<"},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:(t,e)=>e.meshProperties.polygonOffset}}}ot(t){return{projViewMatrix:this.getMap().projViewMatrix,color:t&&t.color||[0,1,0]}}$(t){const e=this.getMap(),r=e.getLightManager(),n=(r&&r.getDirectionalLight()||{}).direction||[1,1,-1];return{projViewMatrix:e.projViewMatrix,pointOpacity:t&&t.pointOpacity||1,lightDir:normalize$4(n,n)}}U(){const t=this.getMap(),e=this.t.getRenderer().canvas,{iblTexes:r,dfgLUT:n}=Ce$1(e),i=Te$1(t,r,n);return g$2(i,{czm_lightDirectionEC:i.light0_viewDirection,lightSpecular:[1,1,1],viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,outSize:[e.width,e.height],polygonFill:[1,1,1,1],polygonOpacity:1}),i}Nt(t,e,n,i,o){const s=e.materials[t];if(!s||!s.baseColorTexture&&!s.pbrMetallicRoughness)return null;const A=g$2({},i);if(s.baseColorTexture){const t=e.textures[s.baseColorTexture.index];let r;t&&!t.image.color&&(r=this.Lt(t)),A.baseColorFactor=t&&t.image.color||s.baseColorFactor||[1,1,1,1],r&&(A.baseColorTexture=r)}else{if(s.normalTexture){const t=this.Lt(e.textures[s.normalTexture.index]),r=s.normalTexture.scale||1;A.normalTexture=t,A.normalMapFactor=r}if(s.occlusionTexture){const t=this.Lt(e.textures[s.occlusionTexture.index]),r=s.occlusionTexture.strength||1;A.occlusionTexture=t,A.occlusionFactor=r}if(s.emissiveTexture){const t=this.Lt(e.textures[s.emissiveTexture.index]);A.emissiveTexture=t}s.emissiveFactor&&(A.emissiveFactor=s.emissiveFactor);const t=s.pbrMetallicRoughness;if(t){if(t.baseColorFactor&&(A.baseColorFactor=t.baseColorFactor),t.baseColorTexture&&void 0!==t.baseColorTexture.index){const r=e.textures[t.baseColorTexture.index];r.image&&r.image.color?A.baseColorFactor=A.baseColorFactor?multiply$3(A.baseColorFactor,A.baseColorFactor,r.image.color):r.image.color:(A.baseColorTexture=this.Lt(r),A.baseColorTexture.getREGLTexture(this.A))}if(R$4(t.metallicFactor)||(A.metallicFactor=t.metallicFactor),R$4(t.roughnessFactor)||(A.roughnessFactor=t.roughnessFactor),s.metallicRoughnessTexture){const t=this.Lt(e.textures[s.metallicRoughnessTexture.index]);A.metallicRoughnessTexture=t}}}if(s.s3mMaterial)return new tt$6(A);if(A.environmentExposure=o,s.extensions&&s.extensions.KHR_materials_unlit)return A.environmentExposure=1,A.ambientColor=[1,1,1],A.light0_diffuse=[0,0,0,0],A.lightSpecular=[0,0,0],new rt$6(A);let c=new Fm.StandardMaterial(A);"phong"===n&&(c=rt$6.convertFrom(c));const l=s.pbrMetallicRoughness,f=l&&l.baseColorTexture&&l.baseColorTexture.extensions;return f&&f.KHR_texture_transform&&(c.set("khr_offset",f.KHR_texture_transform.offset||[0,0]),c.set("khr_rotation",f.KHR_texture_transform.rotation||0),c.set("khr_scale",f.KHR_texture_transform.scale||[1,1])),c.once("complete",this.P),c}Lt(t){const e={type:t.type?le$1(t.type):"uint8",format:t.format?fe$1(t.format):"rgba",flipY:!!t.flipY},n=t.image;n.array?e.data=n.array:n.mipmap&&(e.mipmap=n.mipmap),e.width=n.width,e.height=n.height;const i=t.sampler||t.texture&&t.texture.sampler;return i&&(i.magFilter&&(e.mag=ae$1(i.magFilter)),i.minFilter&&(e.min=Ae$1(i.minFilter)),i.wrapS&&(e.wrapS=ce$1(i.wrapS)),i.wrapT&&(e.wrapT=ce$1(i.wrapT))),new Vt$5(e,this.S)}Ft(t){const e=t.image,r=window.URL||window.webkitURL,n=new Blob([e.array],{type:e.mimeType});return r.createObjectURL(n)}D({target:t}){const e=t.Mt,r=this.h[e];if(r.count--,!r.count){const t=r.meshes;this._[e]=t,delete this.h[e];const n=t.Rt;delete t.Rt,n(null,{mesh:r.meshes,id:e})}}Ot(){return ge$1}lt(t){return this.t.lt(t)}ht(t,e){const r=this.getMap();return r.getGLZoom?r.distanceToPoint(t,e,r.getGLZoom()):r.distanceToPointAtRes(t,e,r.getGLRes())}_pointToPrj(t){const e=this.getMap();return e.getGLZoom?e._pointToPrj(t,e.getGLZoom()):e._pointToPrjAtRes(t,e.getGLRes())}_prjToPoint(t){const e=this.getMap();return e.getGLZoom?e._prjToPoint(t,e.getGLZoom()):e._prjToPointAtRes(t,e.getGLRes(),De$1)}Bt(t){return"Y"===t?ue$1:"X"===t?_e$1:pe$1}pick(t,e,r=3){const n=this.t;if(!n||!n.options.picking)return[];if(!this.pickingFBO||!this.picking)return[];const i=this.getMap(),o=this.U(),s=this.picking;s.render(this.R.getMeshes().filter((t=>!t.bloom)),o,!0);let a={};s.getRenderedMeshes().length&&(a=s.pick(t,e,r,o,{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:n.options.pickingPoint}));const{meshId:A,pickingId:c,point:l,coordinate:f}=a,h=(0===A||A)&&s.getMeshAt(A);if(!h||!h.geometry)return[];const E=h.properties;l&&l.length&&(l[0]=Math.round(1e5*l[0])/1e5,l[1]=Math.round(1e5*l[1])/1e5,l[2]=Math.round(1e5*l[2])/1e5);const u={batchId:c};if(n.options.debug&&(u.debugInfo=E),E&&E.batchTable){const{batchTable:t,batchTableBin:e,count:r}=E,n=c;for(const i in t)u[i]=void 0!==t[i].byteOffset?Pt$1(t[i],e,r,n):t[i][n]}return[{service:h.properties.serviceIndex,data:u,point:l,coordinate:f}]}G(t){let e=new Set;for(let r=0,n=t.length;r<n;r++){const n=t[r].data.node;this.H(n)&&e.add(n.Y)}e=Array.from(e),e.sort();const r=new Map,n=e.length;for(let t=0;t<n;t++)r.set(e[t],t);return r}highlight(t){this.K=t;const e=this.t.getRenderer();this.k=e.getFrameTimestamp(),e.setToRedraw(!0)}cancelAllHighlight(){this.K=null;const t=this.t.getRenderer();this.k=t.getFrameTimestamp(),t.setToRedraw(!0)}showOnly(t){this.X=t;const e=this.t.getRenderer();this.J=e.getFrameTimestamp(),e.setToRedraw(!0)}cancelShowOnly(){this.X=null;const t=this.t.getRenderer();this.J=t.getFrameTimestamp(),t.setToRedraw(!0)}xt(){if(!this.v)return[];const t={},e=[];for(const r in this.v){const n=this.v[r];if(n)for(let r=0;r<n.length;r++){const i=n[r],o=i&&i.geometry;if(!i||!o)continue;const s=i.properties.serviceIndex;t[s]||(t[s]=new Set);const a=o.properties.batchIdData;if(a)for(let r=0;r<a.length;r++)t[s].has(a[r])||(e.push({id:a[r],service:s}),t[s].add(a[r]))}}return e}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}}const Ue$1=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},Ge$1=Ue$1(),He$1=Ge$1.gl_trans__coders=Ge$1.gl_trans__coders||{};function Ve$1(t,e){if(e)for(let r=0;r<e.length;r++)t[e[r].id||e[r].index]=e[r]}He$1.inject=function(t){const e=t.toString(),r=e.indexOf("{")+1,n=e.substring(0,r),i=Ge$1.gl_trans__coders=Ge$1.gl_trans__coders||{};let o=`${n}\n    const _____getGlobal = ${Ue$1.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const t in i)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(o+='tran_____scoders["'+t+'"] ='+i[t].toString()+"\n;");return o+="\n"+e.substring(n.length),o},He$1.registerTranscoder=function(t,e){He$1[t]=e},He$1.getTranscoder=function(t){return He$1[t]};const Ke$1=[];class ke$1{constructor(t,e,r,n){this.wt=t,this.V=e,this.vt=n,this.Ut=r.version,t.indexOf("i3s:tileset:")<0?(this.Gt=this.Ut<=1.6?"root":0,r.version=this.Ut):(this.Gt=t.substring("i3s:tileset:".length),this.Ut>1.6&&(this.Gt=parseInt(this.Gt))),this.wt=t,this.Ht=r}load(){const t=this.Ht,e=t.layerScene.baseUrl;if(this.Ut<=1.6)return t[this.Gt]&&t[this.Gt].lodSelection?(this.Vt=t[this.Gt],this.Kt()):new Promise((r=>{let n=e+"/nodes/"+this.Gt;t.layerScene.eslpk&&(n+="/3dNodeIndexDocument.json"),this.vt(this.V,n,(()=>{this.Vt=t[this.Gt],r(this.Kt())}))}));if(this.Ut>=1.7){if(t[this.Gt])return this.Vt=t[this.Gt],this.Kt();const r=Math.floor(this.Gt/t.nodesPerPage);return new Promise((n=>{let i=e+"/nodepages/"+r;t.layerScene.eslpk&&(i+=".json"),this.vt(this.V,i,(()=>{this.Vt=t[this.Gt],n(this.Kt())}))}))}return null}getTileset(){return this.kt}getChildrenURL(){return this.Xt}Kt(){const t=this.Ht,e=t.layerScene.baseUrl,r=this.Vt.children,n=[],i={};if(r)for(let o=0;o<r.length;o++)if(this.Ut<=1.6){const s=r[o].id;if(t[s])continue;const a=s;i[a]||(i[a]=new Promise((r=>{let n=e+"/nodes/"+a;t.layerScene.eslpk&&(n+="/3dNodeIndexDocument.json"),this.vt(this.V,n,(()=>{r()}))})),n.push(i[a]))}else{const s=r[o];if(t[s])continue;const a=Math.floor(s/t.nodesPerPage);i[a]||(i[a]=new Promise((r=>{let n=e+"/nodepages/"+a;t.layerScene.eslpk&&(n+=".json"),this.vt(this.V,n,(()=>{r()}))})),n.push(i[a]))}return n.length?Promise.all(n).then((()=>this.zt())):this.zt()}zt(){return Promise.resolve(this.Jt())}Yt(t){Ve$1(this.Ht,t)}Jt(){return{asset:{i3s:!0,version:"1.0",gltfUpAxis:"Z"},geometricError:Number.MAX_VALUE,root:this.Zt(this.Vt,!0)}}Zt(t){const e=this.Ut,r=this.Ht,n=t;var i,o=n.obb,s=n.mbs,a={};if(s)i=Xe$1([],s[0],s[1],s[2]),a.sphere=[...i,s[3]];else if(o){const t=function(t,e,r){const n=fromQuat$1([],r);return n[0]=n[0]*e[0],n[1]=n[1]*e[0],n[2]=n[2]*e[0],n[3]=n[3]*e[1],n[4]=n[4]*e[1],n[5]=n[5]*e[1],n[6]=n[6]*e[2],n[7]=n[7]*e[2],n[8]=n[8]*e[2],[...t,...n]}(i=Xe$1([],o.center[0],o.center[1],o.center[2]),o.halfSize,o.quaternion);set$4(Ke$1,t[3]+t[6]+t[9],t[4]+t[7]+t[10],t[5]+t[8]+t[11]);const s=len$4(Ke$1);a.sphere=[...i,s]}var A=1/0,c=0;if(n.mbs?c=n.mbs[3]:n.obb&&(c=Math.max(Math.max(n.obb.halfSize[0],n.obb.halfSize[1]),n.obb.halfSize[2])),void 0!==n.lodThreshold)"maxScreenThresholdSQ"===r.lodSelectionMetricType?A=c/(Math.sqrt(n.lodThreshold)/(.25*Math.PI)):console.error("Unsupported lodSelectionMetricType in Layer");else if(void 0!==n.lodSelection)for(var l=0;l<n.lodSelection.length;l++)"maxScreenThreshold"===n.lodSelection[l].metricType&&(A=c/n.lodSelection[l].maxError);(A===1/0||isNaN(A))&&(A=1e5);var f=16*A;const h=identity$2([]),E=n.children;var u;if(E){u=[];const t=this.Ht;for(let r=0;r<E.length;r++){const n=e<=1.6?E[r].id:E[r];if(!t[n]){u=null;break}u.push(this.Zt(t[n]))}}var _={refine:"REPLACE",boundingVolume:a,transform:h,geometricError:f};return e<=1.6?t.lodSelection?t.geometryData&&(_.content={uri:"i3s:mesh:"+(t.id||t.index)}):_.content={uri:"i3s:tileset:"+(t.id||t.index)}:E&&E.length&&!u?_.content={uri:"i3s:tileset:"+(t.id||t.index)}:n.mesh&&(_.content={uri:"i3s:mesh:"+(t.id||t.index)}),u&&u.length&&(_.children=u),_}getJSON(){return this.Vt}}function Xe$1(t,e,r,n){return nt$2(t,b$3(e),b$3(r),n)}const ze$1=!!He$1.ktx2,Je$1=identity$2([]),Ye$1=(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1})();function Ze$1(t){return t.indexOf("i3s:mesh")>=0}const We$1="i3s:mesh:".length;function je$1(t,e,r,n,i){const o=e.layerScene.eslpk,s=function(t,e){const r=e.substring(We$1);return t>=1.7?parseInt(r):r}(e.version,t),a=e[s],A=e.layerScene.baseUrl,c=[];let l=!1;const f=Je$1;let h,E;if(e.version<=1.6){if(!a.geometryData)return null;const t=a.geometryData.length;if(!t)return null;let r=A+`/nodes/${a.id}/`+a.geometryData[t-1].href;o&&(r+=".bin");const n={geometry:{url:r,info:e.layerScene.store.defaultGeometrySchema}};let i=a.textureData&&a.textureData[0]&&a.textureData[0].href;if(i){const t=e.layerScene.store.textureEncoding[0];let r;r="image/jpeg"===t?"jpg":"png",o&&(i+="."+r);n.material={pbrMetallicRoughness:{baseColorTexture:{url:A+`/nodes/${a.id}/`+i,factor:1,format:r,mimeType:t},metallicFactor:0}}}c.push(n)}else{h=a.mesh.geometry,E=a.mesh.material;const t=e.layerScene.geometryDefinitions[h.definition],{geometryBuffers:s}=t;l=n&&2===s.length;let _=A+`/nodes/${h.resource}/geometries/`+(He$1.draco&&l?1:0);o&&(_+=".bin");const B={geometry:{url:_,info:He$1.draco&&l?s[1]:s[0]}};if(i&&Ye$1&&l&&!He$1.draco)throw new Error("Must import @maptalks/transcoder.draco to load i3s draco compressed geometry");const d=e.layerScene.materialDefinitions,C=e.layerScene.textureSetDefinitions;let T,m=0;E&&(m=d[E.definition]),T=d?function(t,e,r,n,i,o){const s=JSON.parse(JSON.stringify(t));return Qe$1(s,e,r,n,i,o),s}(m,C,A,E.resource,r,e.layerScene.eslpk):{pbrMetallicRoughness:{metallicFactor:0}},B.material=T,c.push(B)}return{dracoCompression:l,meshes:c,nodeIndex:s,center:a.obb&&a.obb.center||a.mbs&&[a.mbs[0],a.mbs[1],a.mbs[2]],transform:f}}function Qe$1(t,e,r,n,i,o){for(const s in t)if(t[s]&&t[s].textureSetDefinitionId>=0){const a=e[t[s].textureSetDefinitionId],A="images/"+a.formats[0].format,c=qe$1(a.formats,i),l={url:r+`/nodes/${n}/textures/${c.name}`,factor:void 0===t[s].factor?1:t[s].factor,format:c.format,mimeType:A};if(o){let t="";switch(c.format){case"dds":t="bin.dds";break;case"jpg":case"png":t=c.format}l.url+="."+t}t[s]=l}else y$3(t[s])&&Qe$1(t[s],e,r,n,i,o)}function qe$1(t,e){for(let r=0;r<=t.length;r++){const n=t[r].format;if("dds"===n&&e.hasExtension("WEBGL_compressed_texture_s3tc"))return t[r];if("jpg"===n||"png"===n)return t[r];if("ktx2"===n&&ze$1)return t[r]}return null}const $e$1=[];function er$1(t,e){return t.rt-e.rt}function rr$1(t,e,r){return t[0]=e[r],t[1]=e[r+3],t[2]=e[r+6],t}const ir$1=[],or$1=[],sr$1=[],ar$1=[],Ar$1=[],cr$1=2*Math.PI;class lr$1{constructor(t,e,r,n){this.west=t,this.south=e,this.east=r,this.north=n}static contains(t,e){var r=e[0],n=e[1],i=t.west,o=t.east;return o<i&&(o+=cr$1,r<0&&(r+=cr$1)),(r>i||mt$2(r,i,1e-14))&&(r<o||mt$2(r,o,1e-14))&&n>=t.south&&n<=t.north}static southwest(t,e){return e[0]=t.west,e[1]=t.south,e[2]=0,e}static northeast(t,e){return e[0]=t.east,e[1]=t.north,e[2]=0,e}static southeast(t,e){return e[0]=t.east,e[1]=t.south,e[2]=0,e}static northwest(t,e){return e[0]=t.west,e[1]=t.north,e[2]=0,e}}const fr$1=[0,0,1];function hr$1(t,e){return nt$2(e,t[0],t[1],t[2])}class Er$1{constructor(t,e){this.normal=copy$4([],t),this.distance=e}static fromPointNormal(t,e,r){var n=-dot$4(e,t);return copy$4(r.normal,e),r.distance=n,r}}const ur$1=[],_r$1=[],Br$1=[],dr$1=[],Cr$1=[],Tr$1=[],mr$1=[],Rr$1=[],gr$1=[],pr$1=[],yr$1=new Er$1([1,0,0],0),Ir$1=[];class br$1{constructor(t){this.southwestCornerCartesian=[],this.northeastCornerCartesian=[],this.westNormal=[],this.eastNormal=[],this.southNormal=[],this.northNormal=[],this.rectangle=new lr$1(...t),this.minimumHeight=t[4],this.maximumHeight=t[5],this.computeBox(this.rectangle)}distanceToCamera(t,e){var r,n,i,s=0;if(!lr$1.contains(this.rectangle,e)){var A=this.northeastCornerCartesian,c=this.westNormal,l=this.southNormal,f=this.eastNormal,h=this.northNormal,E=subtract$2(Ir$1,t,this.southwestCornerCartesian),u=dot$4(E,c),_=dot$4(E,l),B=subtract$2(Ir$1,t,A),d=dot$4(B,f),C=dot$4(B,h);u>0?s+=u*u:d>0&&(s+=d*d),_>0?s+=_*_:C>0&&(s+=C*C)}if(n=this.minimumHeight,(r=e[2])>(i=this.maximumHeight)){var T=r-i;s+=T*T}else if(r<n){var m=n-r;s+=m*m}return Math.sqrt(s)}computeBox(t){const e=this;hr$1(lr$1.southwest(t,_r$1),e.southwestCornerCartesian),hr$1(lr$1.northeast(t,_r$1),e.northeastCornerCartesian),ur$1[0]=t.west,ur$1[1]=.5*(t.south+t.north),ur$1[2]=0;var r=hr$1(ur$1,Br$1),n=cross$1(Cr$1,r,fr$1);normalize$4(e.westNormal,n),ur$1[0]=t.east;var i=hr$1(ur$1,Rr$1),s=cross$1(Cr$1,fr$1,i);normalize$4(e.eastNormal,s);var a,A=subtract$2(Cr$1,r,i),c=normalize$4(dr$1,A),l=t.south;if(l>0){ur$1[0]=.5*(t.west+t.east),ur$1[1]=l;var f=hr$1(ur$1,gr$1);copy$4(pr$1,c);var h=Er$1.fromPointNormal(e.southwestCornerCartesian,e.westNormal,yr$1);Sr$1(gr$1,pr$1,h,e.southwestCornerCartesian),a=_t$2(f,Tr$1)}else a=Bt$1(lr$1.southeast(t,_r$1),Tr$1);var E=cross$1(mr$1,a,A);normalize$4(e.southNormal,E);var u,_=t.north;if(_<0){ur$1[0]=.5*(t.west+t.east),ur$1[1]=_;var B=hr$1(ur$1,gr$1);scale$4(pr$1,c,-1);var d=Er$1.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,yr$1);Sr$1(gr$1,pr$1,d,e.northeastCornerCartesian),u=_t$2(B,Tr$1)}else u=Bt$1(lr$1.northwest(t,_r$1),Tr$1);var C=cross$1(mr$1,A,u);normalize$4(e.northNormal,C)}}function Sr$1(t,e,r,n){var i=t,s=e,a=r.normal,A=dot$4(a,s);if(!(Math.abs(A)<1e-15)){var c=(-r.distance-dot$4(a,i))/A;if(!(c<0))return add$4(n=scale$4(n,s,c),i,n)}}const Pr$1=new t__namespace.Extent(0,0,0,0),Dr$1=new t__namespace.Extent(0,0,0,0),Nr$1=[],Mr$1=[],Or$1=[],Lr$1=[],Fr$1=new t__namespace.Point(0,0),xr$1=[],wr$1=new t__namespace.Coordinate(0,0),vr$1=identity$2([]),Ur$1=[0,0];class Gr$1 extends t__namespace.Layer{constructor(t,e){super(t,e),this.Ie(),this.Wt={},this.be=[]}Ie(){let t=this.options.services.map((t=>t.url));this.Se=t.map(((t,e)=>function(t,e){return{visible:1,baseUrl:(t=P$4(t)).substring(0,t.lastIndexOf("/"))+"/",content:{url:t},refine:"replace",matrix:identity$2([]),V:e,Y:0}}(t,e))),this.fire("rootready",{roots:this.Se.slice(0)})}showService(t){return this.Pe(t,1),this}hideService(t){return this.Pe(t,0),this}setToRedraw(){const t=this.getRenderer();t&&t.setToRedraw()}Pe(t,e){const r=this.Se[t];if(!r)return;r.visible=e;const n=this.getRenderer();n&&n.setToRedraw()}getTileUrl(t){return t}getExtent(e){if(!e&&0!==e){const e=new t__namespace.Extent;for(let t=0;t<this.Se.length;t++)if(this.Se[t].boundingVolume){const r=this.boundingVolumeToExtent(this.Se[t]);e._combine(r)}return e}return this.Se[e]&&this.Se[e].boundingVolume?this.boundingVolumeToExtent(this.Se[e]):null}boundingVolumeToExtent(e){const r=e.boundingVolume.De?vr$1:e.matrix,n=this.getMap();if(e.boundingVolume.region){const r=e.boundingVolume.region;return new t__namespace.Extent(S$4(r[0]),S$4(r[1]),S$4(r[2]),S$4(r[3]))}if(e.boundingVolume.sphere){const i=e.boundingVolume.sphere,s=ct$2([],transformMat4$2([],i,r)),a=i[3],A=n.locate(s,-a,a),c=n.locate(s,a,-a);return new t__namespace.Extent(A,c)}if(e.boundingVolume.box){const i=e.boundingVolume.box,a=transformMat4$2([],i,r),A=new t__namespace.Coordinate(ct$2([],a)),c=i.slice(3);multiply$6(c,fromMat4$1([],e.matrix),c);const l=length$4(c.slice(0,3)),f=length$4(c.slice(3,6)),h=length$4(c.slice(6,9)),E=Math.max(l,f,h),u=n.locate(A,-E,E),_=n.locate(A,E,-E);return new t__namespace.Extent(u,_)}return null}getRootTiles(){return this.Se}getTiles(){const t=this.getRenderer();if(!t.ready)return this.Ne(),{tiles:Lr$1};const e=this.getMap(),r=e.cameraPosition;let n,i;if(e.getGLZoom)i=e.pointToDistance(r[2],0,e.getGLZoom()),wr$1.set(r[0],r[1]),n=e.pointToCoord(wr$1,e.getGLZoom());else{const t=e.getGLRes();i=e.pointAtResToDistance(r[2],0,t),wr$1.set(r[0],r[1]),n=e.pointAtResToCoord(wr$1,t)}this.Me=this.Me||[],set$4(this.Me,b$3(n.x),b$3(n.y),i),this.Oe=nt$2(this.Oe||[],this.Me[0],this.Me[1],this.Me[2]),this.Le=2*Math.tan(.5*b$3(e.getFov()));const s=e.projViewMatrix,a={children:[],level:-1};let A=a;const c=[];for(let e=0;e<this.Se.length;e++){const r=this.Se[e];if(!r.visible)continue;let n=1/0;const i=[r],o=this.Fe(e);for(;i.length>0;){const e=i.pop();for(e.id||this.xe(e);A.level>=e.Y;)A=A.parent;const r=this.we(e,o,s);if(r<1){let t=A;for(;t&&!t.content;)t=t.parent;if(0===r&&t&&t.content&&this.ve(c,t),!1===this.options.services[e.V].alwaysShow)continue;if(!(0===r&&e.Y<=n))continue;e.content&&(n=e.Y)}e.rt<1/0&&this.Ue(e);const a=this.he(e,A);A.children.push(a);const l=e.children,f=l&&l.length,h=a.content;if(!f&&h&&this.ve(c,a),f){h&&"add"===e.refine&&this.ve(c,a),A=a;const r=l[0].parent;let n=!1;for(let o=0,s=l.length;o<s;o++){if(r){const e=t.getCachedTile(l[o].id);if(e&&e.error&&404!==e.error.status)continue;n=!0}else{n=!0,l[o].parent=e,l[o].dt=e.dt,l[o].baseUrl=e.baseUrl;const t=l[o].content&&(l[o].content.url||l[o].content.uri);t&&(x$3(t)||t.indexOf("i3s:")>=0?l[o].baseUrl=e.baseUrl:-1===t.indexOf("http://")&&-1===t.indexOf("https://")?l[o].content.url=e.baseUrl+t:l[o].baseUrl=t.substring(0,t.lastIndexOf("/")+1))}i.push(l[o])}!n&&h&&this.ve(c,a)}}}return{root:a,tiles:c}}ve(t,e){const{viewerRequestVolume:r}=e.node;r&&!function(t,e,r){if(r.region){const e=r.region;if(t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3])return!0}else{if(r.sphere)return Hr$1(r,e);if(r.box)return 0===Vr$1(r,e)}return!1}(this.Me,this.Oe,r)||t.push(e)}he(t,e){return{id:t.id,node:t,children:[],level:t.Y,parent:e,content:t.content&&t.content.url}}xe(e){e.id=t__namespace.Util.GUID(),e.matrix=e.transform||identity$2([]),e.Ge=this.He(e),e.parent&&(function(t){return t.content&&t.content.uri&&t.content.uri.indexOf("i3s:")>=0}(e)||(e.matrix=multiply$5(e.matrix,e.parent.matrix,e.matrix)),e.V=e.parent.V,void 0===e.Y&&(e.Y=e.parent.Y+1),e.maxExtent=e.parent.maxExtent),e.refine=e.refine&&e.refine.toLowerCase()||"replace",e.content&&!e.content.url&&e.content.uri&&(e.content.url=e.content.uri),this.Ve(e)}Ve(t){const e=t.boundingVolume;if(!e||e.De)return;const r=this.options.services[t.V],i=r.heightOffset||0,s=this.options.offset,a=p$4(s)||s[0]||s[1],A=r.coordOffset||Ur$1;if(!Array.isArray(A))throw new Error("service.coordOffset must be an array");if(!t.boundingVolume||!i&&exactEquals$5(t.matrix,vr$1)&&!a&&A===Ur$1)return;const{region:c,box:l,sphere:f}=e;if(c){const t=this.Ke([S$4(c[0]),S$4(c[1])]);c[0]=b$3(t.x+A[0]),c[1]=b$3(t.y+A[1]);const e=this.Ke([S$4(c[2]),S$4(c[3])]);c[2]=b$3(e.x+A[0]),c[3]=b$3(e.y+A[1]),c[4]+=i+(A[2]||0),c[5]+=i+(A[2]||0)}else if(l||f){const e=l||f,r=transformMat4$2(Nr$1,e,t.matrix),n=ct$2(Mr$1,r),s=this.Ke([n[0]+A[0],n[1]+A[1]]);n[0]=s.x,n[1]=s.y,n[2]+=i+(A[2]||0),nt$2(e,b$3(n[0]),b$3(n[1]),n[2])}e.De=!0}He(t){return void 0===t.geometricError||!t.boundingVolume}Ue(t){let e=t.parent;for(;e&&e.Ge&&!(e.rt<=t.rt);)e.rt=t.rt,e=t.parent}onTileLoad(t,e){if(t.children&&(!e.children||!e.children.length)){e.children=t.children;const r=e.content.url;e.baseUrl=r.substring(0,r.lastIndexOf("/")+1);const n=this.getRenderer();n&&n.setToRedraw()}}onTilesetLoad(t,e,r){if(!t)return void console.warn("invalid tileset at : "+r);const i=this.options.services[e.V],o=(t.asset&&t.asset.gltfUpAxis||e&&e.dt||i.upAxis||"Y").toUpperCase();t.root.baseUrl=r.substring(0,r.lastIndexOf("/")+1);const s=r.indexOf("realspace/")>-1;0===e.Y&&(t.asset&&t.asset.s3mType&&s||i.isSuperMapiServer)&&(t.root.baseUrl+="data/path/");const a=t.asset.i3s,A=!!t.asset.s3mType;if(t.root.dt=o,e){const i=this.Se[e.V];A&&!i.isS3M&&(i.isS3M=A);const o=e.boundingVolume;g$2(e,t.root),e.refine=e.refine&&e.refine.toLowerCase()||"replace",o&&(e.boundingVolume=o);const s=t.root.transform;s&&(e.parent?a||(e.matrix=multiply$5([],e.parent.matrix,s)):e.matrix=s),this.Ve(e),e.ke=e.content,delete e.content,t.root.content&&(e.content=t.root.content),e.Ge=this.He(e);const c=e.content&&(e.content.url||e.content.uri);c&&e.content.uri&&(e.content.url=e.content.uri,delete e.content.uri),a||!c||x$3(c)||-1!==c.indexOf("http://")||-1!==c.indexOf("https://")||(e.content.url=e.baseUrl+c)}this.Ne(),this.fire("loadtileset",{tileset:t,index:e&&e.V,url:r})}we(t,e,r){if(t.rt=1/0,0===t.Y||t.Ge)return 1;if(!this.Xe(t,e,r))return-1;if(0===t.geometricError)return 1;let n=this.options.services[t.V].maximumScreenSpaceError;null==n&&(n=8);let i=this.ze(t);return 0===i&&t.parent&&(i=.5*(t.parent.ae||0)),i>=n?1:0}lt(e,r){r||(r=new t__namespace.Point(0,0));const n=this.getMap();return n.getGLZoom?n.coordToPoint(e,n.getGLZoom(),r):n.coordToPointAtRes(e,n.getGLRes(),r)}Xe(e,r,i){const a=e.id;let A=this.be[a];const{boundingVolume:c}=e,E=c.sphere;let u=c.region;const _=c.box;if(!A){let r,i,l;if(_&&(u=function(t,e){for(let e=0;e<9;e++)Qr$1[e]=t[e+3];const r=Qr$1;exactEquals$5(e,vr$1)||multiply$6(r,fromMat4$1(xr$1,e),r);const i=copy$4(Kr$1,t),a=set$4(kr$1,r[0],r[1],r[2]),A=set$4(Xr$1,r[3],r[4],r[5]),c=set$4(zr$1,r[6],r[7],r[8]);Jr$1[0]=Jr$1[0]||[];const l=copy$4(Jr$1[0],i);sub$2(l,l,a),sub$2(l,l,A),sub$2(l,l,c),Jr$1[1]=Jr$1[1]||[];const f=copy$4(Jr$1[1],i);sub$2(f,f,a),sub$2(f,f,A),add$4(f,f,c),Jr$1[2]=Jr$1[2]||[];const h=copy$4(Jr$1[2],i);sub$2(h,h,a),add$4(h,h,A),sub$2(h,h,c),Jr$1[3]=Jr$1[3]||[];const E=copy$4(Jr$1[3],i);sub$2(E,E,a),add$4(E,E,A),add$4(E,E,c),Jr$1[4]=Jr$1[4]||[];const u=copy$4(Jr$1[4],i);add$4(u,u,a),sub$2(u,u,A),sub$2(u,u,c),Jr$1[5]=Jr$1[5]||[];const _=copy$4(Jr$1[5],i);add$4(_,_,a),sub$2(_,_,A),add$4(_,_,c),Jr$1[6]=Jr$1[6]||[];const B=copy$4(Jr$1[6],i);add$4(B,B,a),add$4(B,B,A),sub$2(B,B,c),Jr$1[7]=Jr$1[7]||[];const d=copy$4(Jr$1[7],i);add$4(d,d,a),add$4(d,d,A),add$4(d,d,c);for(let t=0;t<Jr$1.length;t++)Yr$1[t]=Yr$1[t]||[],ct$2(Yr$1[t],Jr$1[t]),Zr$1[t]=Yr$1[t][0],Wr$1[t]=Yr$1[t][1],jr$1[t]=Yr$1[t][2];return[b$3(Math.min(...Zr$1)),b$3(Math.min(...Wr$1)),b$3(Math.max(...Zr$1)),b$3(Math.max(...Wr$1)),Math.min(...jr$1),Math.max(...jr$1)]}(_,e.matrix),c.region=u),u){r=Pr$1.set(S$4(u[0]),S$4(u[1]),S$4(u[2]),S$4(u[3]));const t=r.getCenter(),e=this.Je(t);r=r.convertTo((t=>this.lt(t,Fr$1)),Dr$1),l=u[4],i=u[5],A=this.be[a]=[[r.xmin,r.ymin,l*e[2]],[r.xmax,r.ymax,i*e[2]]],A.center=t}else if(E){const e=ct$2(Nr$1,E),r=new t__namespace.Coordinate(e),n=this.lt(r,Fr$1).toArray(),i=this.Je(r);n.push(e[2]*i[2]),A=this.be[a]=[n,E[3]*i[2]],A.center=r}}if(r){if(u)Pr$1.xmin=A[0][0],Pr$1.ymin=A[0][1],Pr$1.xmax=A[1][0],Pr$1.ymax=A[1][1];else if(E){const t=A[2];Pr$1.xmin=A[0][0]-t,Pr$1.ymin=A[0][1]-t,Pr$1.xmax=A[0][0]+t,Pr$1.ymax=A[0][1]+t}else if(_){const t=A[1],e=A[2];Pr$1.xmin=A[0][0]-t,Pr$1.ymin=A[0][1]-e,Pr$1.xmax=A[0][0]+t,Pr$1.ymax=A[0][1]+e}if(!r.intersects(Pr$1))return!1}return u?intersectsBox$1(i,A):E?function(matrix,sphere,mask){setPlanes$1(matrix);for(var center=sphere[0],negRadius=-sphere[1],i=0;i<6;i++)if((!mask||"0"!==mask.charAt(i))&&distanceToPoint$1(planes$1[i],center)<negRadius)return!1;return!0}(i,A):!!_&&function(matrix,box,mask){setPlanes$1(matrix);for(var i=0;i<6;i++)if(!(mask&&"0"===mask.charAt(i)||intersectsPlane(planes$1[i],box)))return!1;return!0}(i,A)}Je(t){const e=this.getMap(),r=e.distanceToPointAtRes(100,100,e.getGLRes(),t);let n;return n=e.altitudeToPoint?e.altitudeToPoint(100,e.getGLRes())/100:r.y/100,set$4(Or$1,r.x/100*1.01,r.y/100*1.01,n),Or$1}Ke(e){Array.isArray(e)&&(e=new t__namespace.Coordinate(e));let r=this.options.offset;if(p$4(r)&&(r=r(Array.isArray(e)?new t__namespace.Coordinate(e):e)),r[0]||r[1]){const t=this.getMap(),n=t.getGLRes(),i=t.coordToPointAtRes(e,n);return i._sub(r),t.pointAtResToCoord(i,n)}return e}Fe(e){const r=this.options.services[e].maxExtent;if(!r)return null;const n=this.Se[e];return n.maxExtent||(n.maxExtent=new t__namespace.Extent(r).convertTo((t=>this.lt(t)))),n.maxExtent}ze(t){const e=this.Le,r=t.geometricError;if(0===r)return t.ae=0,0;const n=this.getMap();let i;t.boundingVolume.region?i=function(t,e,r){return t.Ye||(t.Ye=new br$1(t.boundingVolume.region)),t.Ye.distanceToCamera(e,r)}(t,this.Oe,this.Me):t.boundingVolume.sphere?i=Hr$1(t.boundingVolume,this.Oe):t.boundingVolume.box&&(i=Vr$1(t.boundingVolume,this.Oe));const o=Math.max(Math.abs(i),1e-7),s=r*n.height/(o*e);return t.rt=i,t.ae=s,s}Ne(){const t=this.getRenderer();t&&t.setToRedraw()}yt(t){return this.be[t]}identify(e,r={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const o=n.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(o,r)}identifyAtPoint(t,e={}){const r=this.getMap(),n=this.getRenderer();if(!r||!n)return[];const i=r.getDevicePixelRatio();return n.pick(t.x*i,t.y*i,e)}getCurrentBatchIDs(){const t=this.getMap(),e=this.getRenderer();return t&&e?e.xt():[]}highlight(t){const e=this.getRenderer();return e?(e.highlight(t),this):(this.K||(this.K=[]),this.K.push(t),this)}ge(){if(this.K){for(let t=0;t<this.K.length;t++)this.highlight(this.K[t]);delete this.K}}cancelHighlight(t,e){const r=this.getRenderer();return r?(r.cancelHighlight(t,e),this):this}cancelAllHighlight(){const t=this.getRenderer();return t?(t.cancelAllHighlight(),this):this}showOnly(t){const e=this.getRenderer();return e?(e.showOnly(t),this):(this.X||(this.X=[]),this.X.push(t),this)}Ze(){if(this.X){for(let t=0;t<this.X.length;t++)this.showOnly(this.X[t]);delete this.X}}cancelShowOnly(t){const e=this.getRenderer();return e?(e.cancelShowOnly(t),this):this}}function Hr$1(t,e){const n=dist$2(t.sphere,e),i=t.sphere[3];return n<i?0:n-i}function Vr$1(t,e){const r=t.box;return function(t,e,r){return Math.sqrt(function(t,e,r){var n=subtract$2(ir$1,r,t),i=rr$1(or$1,e,0),o=rr$1(sr$1,e,1),s=rr$1(ar$1,e,2),a=len$4(i),A=len$4(o),c=len$4(s);normalize$4(i,i),normalize$4(o,o),normalize$4(s,s);var l=Ar$1;l[0]=dot$4(n,i),l[1]=dot$4(n,o),l[2]=dot$4(n,s);var f,h=0;return l[0]<-a?h+=(f=l[0]+a)*f:l[0]>a&&(h+=(f=l[0]-a)*f),l[1]<-A?h+=(f=l[1]+A)*f:l[1]>A&&(h+=(f=l[1]-A)*f),l[2]<-c?h+=(f=l[2]+c)*f:l[2]>c&&(h+=(f=l[2]-c)*f),h}(t,e,r))}(set$4(Nr$1,r[0],r[1],r[2]),set$6(xr$1,r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11]),e)}Gr$1.mergeOptions({maxGPUMemory:512,retireInterval:2e3,loadingLimitOnInteracting:5,loadingLimit:0,renderer:"gl",forceRenderOnZooming:!0,forceRenderOnRotating:!0,forceRenderOnMoving:!0,debug:!1,debugOutline:[0,1,0],meshLimitPerFrame:1,i3sNodepageLimitPerFrame:1,enableI3SCompressedGeometry:!0,forceI3SCompressedGeometry:!0,picking:!0,pickingPoint:!0,geometryEvents:!1,antialias:!1,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"],offset:[0,0]}),Gr$1.registerRenderer("gl",class extends t__namespace.renderer.CanvasRenderer{constructor(t){super(t),this.prepareWorker(),this.tilesLoading={},this.tileCache=new k$4(1024*t.options.maxGPUMemory*1024,this.deleteTile.bind(this)),this.Wt={},this.jt=[],this.vt=this.Qt.bind(this)}getAnalysisMeshes(){if(!this.painter)return $e$1;const t=this.painter.getPaintedMeshes();if(!t)return $e$1;const e=[],{b3dmMeshes:r,pntsMeshes:n,i3dmMeshes:i}=t;return r.length&&v$3(e,r),n.length&&v$3(e,n),i.length&&v$3(e,i),e}needToRedraw(){return!!this.getMap().isInteracting()||!!this.jt.length||super.needToRedraw()}getFrameTimestamp(){return this.qt}drawOnInteracting(t,e,r){this.draw(e,r)}draw(t,e){this.qt=t;const r=this.prepareCanvas();if(r&&!r.intersects(this.canvasExtent2D))return void this.completeRender();const{root:n,tiles:i}=this.layer.getTiles();if(!i||!i.length)return void this.completeRender();this.$t(),this.te();const{selectedTiles:s,leaves:a,requests:A}=this.ee(n,i);A.length&&this.loadTiles(A),this.re(s,a,e),this.ne(),A.length||this.completeRender()}ee(t,e){const r=this.layer.getRootTiles();let n=[];this.ie();let i=0;const o=this.oe(),s={};let a=!1,A=!1;for(let t=0;t<e.length;t++){const o=e[t],c=o.node;if(s[c.id])continue;const l=r[c.V];s[c.id]=1;let f=!1;const h=this.getCachedTile(c.id);(this.se(c.id)?(i++,f=A=!0,this.tilesLoading[c.id].current=!0):h?(this.getTileOpacity(h)<1&&(f=A=!0),(!o.node.ae||l.isS3M||!o.node.children||o.node.ae<=500)&&(a=!0,o.selected=!0,o.data=h)):this.painter.has(c)||(f=A=!0,n.push(c)),f)&&((this.Ae(o)||this.ce(o).length)&&(a=!0))}let c=[],l={};if(a&&({selectedTiles:c,leaves:l}=this.le(t)),n.length>1&&(n.sort(er$1),o)){const t=o-i;n=t>0?n.slice(0,t):[]}return{loading:A,requests:n,selectedTiles:c,leaves:l}}le(t){const e=[],r={};let n;const i=[t],o=[];for(;i.length>0||o.length>0;){if(o.length>0){const t=o[o.length-1];if(t.fe===i.length){o.pop(),t===n&&(t.leave=!0,r[t.node.id]=1),e.push(t);continue}}const t=i.pop(),s=t.children;if(t.selected)if("add"===t.node.refine)r[t.node.id]=1,t.selectionDepth=o.length,e.push(t);else{if(t.selectionDepth=o.length,n=t,0===s.length){t.leave=!0,r[t.node.id]=1,e.push(t);continue}o.push(t),t.fe=i.length}for(let t=0;t<s.length;t++)i.push(s[t])}return{selectedTiles:e,leaves:r}}Ae(t){if(!t.parent)return null;let e=t.parent;for(;e&&e.level>=0;){const t=e.node.id;if(this.tileCache.has(t))return e.selected=!0,e.data=this.tileCache.get(t),e;e=e.parent}return null}ce(t){const e=[];if(!t.node.children||!t.node.children.length)return e;const r=t.Y+1,n=[t.node];for(;n.length>0;){const i=n.pop().children;for(let o=0,s=i.length;o<s;o++){if((!i[o].content||!i[o].content.url)&&i[o].children&&i[o].children.length){n.push(i[o]);continue}const s=i[o].id;if(this.tileCache.has(s)){const r=this.layer.he(i[o],t);r.selected=!0,r.data=this.tileCache.get(s),t.children.push(r),e.push(r)}else i[o].Y<=r&&n.push(i[o])}}return e}re(t,e,r){this.tileCache.markAll(!1);for(let e=0,r=t.length;e<r;e++){const r=t[e].data;r.current=!0,this.tileCache.add(t[e].node.id,r)}this.tileCache.shrink();const n={tiles:t,leaves:e};this.onDrawTileStart(n);const i=this.painter.paint(t,e,r);this.onDrawTileEnd(n),i&&this.layer.fire("canvasisdirty",{renderCount:i})}onDrawTileStart(){}onDrawTileEnd(){}loadTiles(t){for(let e=0,r=t.length;e<r;e++){const r=t[e];this.tilesLoading[r.id]={current:!0,node:r},this.loadTile(r)}}loadTile(t){let e=t.content.url;if(x$3(e)){const r=w$4(e);return void this.Ee(e,r,t)}if(function(t){return t.indexOf("i3s:tileset")>=0}(e)){const r=t.V;return new ke$1(e,r,this.ue[r],this.vt).load().then((r=>{this.onTilesetLoad(r,t,e)}))}t&&-1===e.indexOf("http://")&&-1===e.indexOf("https://")&&!Ze$1(e)&&(e=t.baseUrl+e);const r=this.layer.options.services[t.V];if(r.ajaxInMainThread){let n=r.urlParams;n&&(n=(e.indexOf("?")>0?"&":"?")+n);let i=w$8.getArrayBuffer(e+(n||""),r.fetchOptions);const o=i.xhr;i=i.then((r=>{delete this.Wt[e],r?this.Ee(e,r.data,t):this.onTileError(null,t)})).catch((r=>{delete this.Wt[e],this.onTileError(r,t)})),this.Wt[e]=o}else this.Ee(e,null,t)}Ee(t,e,n){let i=this._e;i||(i=k$7.getSupportedFormats(this.gl.gl||this.gl),this._e=i);const o=this.layer.options.services[n.V];o.isSuperMapiServer&&(t=function(t,e){const n=t.substring(e.length).split("/"),i=[];for(let t=0;t<n.length;t++)i.push(encodeURIComponent(n[t]));return e+i.join("/")}(t,n.baseUrl));const s={url:t=this.layer.getTileUrl(t,n.baseUrl,o),arraybuffer:e,rootIdx:n.V,upAxis:n.dt,transform:n.matrix,supportedFormats:i};if(Ze$1(t)){if(s.i3sInfo=je$1(t,this.ue[n.V],this.regl,this.layer.options.enableI3SCompressedGeometry,this.layer.options.forceI3SCompressedGeometry),!s.i3sInfo)return void this.onTileError({status:404},n)}this.workerConn.loadTile(this.layer.getId(),s,((e,r)=>{if(e)return void this.onTileError(e,n);const{magic:i}=r;"b3dm"===i||"pnts"===i||"i3dm"===i||"cmpt"===i?this.jt.push({data:r,tile:n}):this.onTilesetLoad(r,n,t)}))}te(){const t=this.getMap(),e=this.layer.options.meshLimitPerFrame;let r=0;for(;this.jt.length&&(r<e||!t.isInteracting());){const{data:t,tile:e}=this.jt.shift(),{magic:n}=t;"b3dm"===n?this.painter.createB3DMMesh(t,e.id,e,((r,{mesh:n})=>{this.Be(t,e,r,n)})):"pnts"===n?this.painter.createPntsMesh(t,e.id,e,((r,{mesh:n})=>{this.Be(t,e,r,n)})):"i3dm"===n?this.painter.createI3DMMesh(t,e.id,e,((r,{mesh:n})=>{this.Be(t,e,r,n)})):"cmpt"===n&&this.painter.createCMPTMesh(t,e.id,e,((r,{mesh:n})=>{this.Be(t,e,r,n)})),r++}}Be(t,e,r,n){if(r)this.onTileError(r,e);else{const r=this.de(n);e.memorySize=r,this.onTileLoad(t,e)}}de(t){let e=0;if(Array.isArray(t))for(let r=0;r<t.length;r++)t[r]&&(e+=this.de(t[r]));else t&&(e+=t.getMemorySize());return e}onTileLoad(t,e){this.layer&&(delete this.tilesLoading[e.id],this.layer.onTileLoad(t,e),this.Ce(e),this.setToRedraw(),this.layer.fire("tileload",{node:e}))}onTilesetLoad(t,e,r){this.layer&&(this.layer.St=t.extensions&&t.extensions["s3m:VertexCompressionType"],t.capabilities||t.layers&&t.layers[0]&&t.layers[0].capabilities?this.Te(t,e,r):(delete this.tilesLoading[e.id],this.layer.onTilesetLoad(t,e,r)))}onTileError(t,e){if(!this.layer)return;console.warn("failed to load 3d tile: "+e.content.url),console.warn(t),delete this.tilesLoading[e.id],this.me(e,t),this.setToRedraw(),this.layer.fire("tileerror",{node:e,error:t})}getCachedTile(t){return this.tileCache.get(t)}me(e,r){const n={loadTime:t__namespace.Util.now(),current:!0,error:r,node:e};this.tileCache.add(e.id,n)}Ce(e){const r={loadTime:t__namespace.Util.now(),current:!0,node:e};this.tileCache.add(e.id,r)}abortTileLoading(t){if(!t||!this.workerConn)return;const e=t.node.content.url;if(this.layer.options.services[t.node.V].ajaxInMainThread){const t=this.Wt[e];t&&t.abort()}else this.workerConn.abortTileLoading(this.layer.getId(),e);delete this.Wt[e]}ie(){if(this.tilesLoading)for(const t in this.tilesLoading)this.tilesLoading[t].current=!1}deleteTile(t){this.painter.deleteTile(t)}createContext(){const t=this.layer,e=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:t.options.antialias},r=this.canvas.gl&&this.canvas.gl.wrap;r?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):(this.glOptions=e,this.gl=this.Re(this.canvas,e)),this.regl=this.regl||h$1({gl:this.gl,attributes:e,extensions:["OES_element_index_uint"],optionalExtensions:t.options.optionalExtensions||[]}),r&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=new ve$1(this.regl,t),this.layer.ge()}prepareWorker(){const t=this.getMap();this.workerConn||(this.workerConn=new H$4("@maptalks/3dtiles",t.id));const e=this.workerConn;if(!e.isActive())return;let r=this.layer.options||{};r=g$2({},r),delete r.offset,r.projection=t.getSpatialReference().getProjection().code;const n=this.layer.getId();e.addLayer(n,r,(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}onRemove(){this.painter&&this.painter.remove(),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),this.clear(),delete this.tileCache,super.onRemove()}clear(){this.ne(!0),this.tileCache.reset(),this.tilesLoading={},super.clear()}clearCanvas(){this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas()}getTileOpacity(){return 1}getStencilValue(){return 0}ne(t){this.pe||(this.pe=Date.now());const e=Date.now();if(t||!(e-this.pe<this.layer.options.retireInterval)){this.pe=e;for(const e in this.tilesLoading){const r=this.tilesLoading[e];!t&&r.current||this.abortTileLoading(r)}}}oe(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit}Re(t,e){const r=["webgl","experimental-webgl"];let n=null;for(let i=0;i<r.length;++i){try{n=t.getContext(r[i],e)}catch(t){}if(n)break}return n}se(t){return!!this.tilesLoading[t]}getI3DMMeshes(){return this.painter.getI3DMMeshes()}getPNTSMeshes(){return this.painter.getPNTSMeshes()}getB3DMMeshes(){return this.painter.getB3DMMeshes()}readBatchData(t,e,r){return bt$2(t,e,0,r)}$t(){if(!this.ye)return;const t=this.layer.options.i3sNodepageLimitPerFrame||Number.MAX_VALUE;let e=0;const r=[];for(const n in this.ye){const i=this.ye[n];if("pending"===i.status)continue;i.status="pending";const o=i.rootIdx;if(r.push(w$8.getJSON(n).then((t=>{delete this.ye[n];const e=this.ue[o];if(e){t.nodes?Ve$1(e,t.nodes):(e[t.id]=t,Ve$1(e,t.children));for(let t=0;t<i.length;t++)i[t]();this.setToRedraw()}else this.setToRedraw()}))),e++,e>=t)break}r.length&&Promise.all(r)}Qt(t,e,r){this.ye||(this.ye={}),this.ye[e]=this.ye[e]||[],this.ye[e].rootIdx=t,this.ye[e].push(r),this.setToRedraw()}Te(t,e,r){this.ue||(this.ue=[]);const n=e.V;this.ue[n]||(this.ue[n]={});const i=this.ue[n];t.layers&&(t=t.layers[0],"/"!==r[r.length-1]&&(r+="/"),r+="layers/0"),i.version=+(this.layer.options.services[n].i3sVersion||t.store.version),function(t,e,r,n,i,o){if(!i.layerScene){i.layerScene=t,i.nodesPerPage=t.nodePages&&t.nodePages.nodesPerPage||64,i.lodSelectionMetricType=t.nodePages&&t.nodePages.lodSelectionMetricType;let e=n;if(i.layerScene.eslpk=e.indexOf("3dSceneLayer.json")>=0,e.endsWith(".json")){const t=n.lastIndexOf("/");e=t<0?"./":n.substring(0,t)}i.layerScene.baseUrl=function(t){return t.split("?")[0]}(e)}return new ke$1(n,e,i,o).load()}(t,n,0,r,i,this.vt).then((t=>{this.onTilesetLoad(t,e,r)}))}pick(t,e,r){return this.painter?this.painter.pick(t,e,r&&r.tolerance):[]}highlight(t){if(this.K||(this.K=[]),Array.isArray(t))for(let e=0;e<t.length;e++){const r=t[e].service||0;let n=this.K[r];n||(n=this.K[r]=new Map),n.set(t[e].id,t[e])}else{const e=t.service||0;let r=this.K[e];r||(r=this.K[e]=new Map),r.set(t.id,t)}this.painter.highlight(this.K)}cancelHighlight(t,e){if(!this.K)return;const r=this.K[t];if(r){if(Array.isArray(e))for(let t=0;t<e.length;t++)r.delete(e[t]);else r.delete(e);this.painter.highlight(this.K)}}cancelAllHighlight(){delete this.K,this.painter.cancelAllHighlight()}showOnly(t){if(this.X||(this.X=[]),Array.isArray(t))for(let e=0;e<t.length;e++){const r=t[e].service||0;let n=this.X[r];n||(n=this.X[r]=new Map),n.set(t[e].id,t[e])}else{const e=t.service||0;let r=this.X[e];r||(r=this.X[e]=new Map),r.set(t.id,t)}this.painter.showOnly(this.X)}cancelShowOnly(){delete this.X,this.painter.cancelShowOnly()}xt(){return this.painter?this.painter.xt():[]}}),Gr$1.registerJSONType("Geo3DTilesLayer");const Kr$1=[],kr$1=[],Xr$1=[],zr$1=[],Jr$1=[],Yr$1=[],Zr$1=[],Wr$1=[],jr$1=[],Qr$1=[];let qr$1=null;function $r$1(){return qr$1||(qr$1={"image/crn":He$1.crn&&He$1.crn(),"image/ktx2":He$1.ktx2&&He$1.ktx2(),"image/cttf":He$1.ktx2&&He$1.ktx2(),draco:He$1.draco&&He$1.draco()}),qr$1}class tn$1{constructor(t,e,r){this.We=t,this.je=e||k$8,this._e=r,this.Qe=$r$1()}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,r=0,n=0,i){return e?(n||(n=e.byteLength),this.qe(t,e,r,n,i)):w$8.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.qe(t,i,r,n)}))}qe(t,e,r,n,i){const o=i&&i.maxTextureSize,s=this.$e(e,r,n,t);if(s.error)return Promise.resolve(s);const a=t.substring(0,t.lastIndexOf("/")),A=new this.je(a,s.glb,{transferable:!0,requestImage:this.We,decoders:this.Qe,supportedFormats:this._e,maxTextureSize:o});return A.load({skipAttributeTransform:!1}).then((e=>{e.url=`${t}-${r}-${n}`;const i=A.transferables;for(let t=0;t<s.transferables.length;t++)i.indexOf(s.transferables[t])<0&&i.push(s.transferables[t]);return{magic:"b3dm",count:s.count,transferables:i,featureTable:s.featureTable,batchTable:s.batchTable,batchTableBin:s.batchTableBin,gltf:e}}))}$e(t,e,r,n){const i=new DataView(t,e,r),o=i.getUint32(4,!0);if(1!==o){const t="Unsupported b3dm version: "+o+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in b3dm header is inconsistent with b3dm's byte length, url: "+n;return console.warn(t),{error:t}}let s,a=i.getUint32(12,!0),A=i.getUint32(16,!0),c=i.getUint32(20,!0),l=i.getUint32(24,!0),f=28+e;c>=570425344?(f-=8,s=a,c=A,l=0,a=0,A=0):l>=570425344&&(f-=4,s=c,c=a,l=A,a=0,A=0);const h=[t];let E,u,_;if(a>0?(E=pt$2(t,f,a),f+=a,s=E.BATCH_LENGTH):E={BATCH_LENGTH:s},A>0&&(f+=A),c>0&&(u=yt$2(t,f,c),f+=c,l>0)){const e=It$1(0,f,l);_=t.slice(e.offset,e.offset+e.byteLength),f+=l,h.push(_)}const B=E.BATCH_LENGTH,d={};if(E&&E.BATCH_ID){d.BATCH_ID=St$1(E.BATCH_ID,t,(void 0).offset,B);const e=d.BATCH_ID.array&&d.BATCH_ID.array.buffer;e&&h.indexOf(e)<0&&h.push(e)}return{count:s,transferables:h,featureTable:E,batchTable:u,batchTableBin:_,b3dm:d,glb:{buffer:t,byteOffset:f,byteLength:i.byteLength+i.byteOffset-f}}}tr(){return null}}class en$1{constructor(t,e,r,n){this.We=t,this.je=e||k$8,this._e=r,this.Qe=$r$1(),this.er=n}load(t,e,r=0,n=0,i){return e?(n||(n=e.byteLength),this.qe(t,e,r,n,i)):w$8.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.qe(t,i,r,n)}))}qe(t,e,r,n,i){return this.rr(t,e,r,n,i).then((({gltf:i,transferables:o})=>{const s=this.nr(e,r,n,t);if(s.error)return Promise.resolve(s);for(let t=0;t<o.length;t++)-1===s.transferables.indexOf(o[t])&&s.transferables.push(o[t]);return delete i.transferables,Promise.resolve({magic:"i3dm",count:s.count,transferables:s.transferables,featureTable:s.featureTable,batchTable:s.batchTable,batchTableBin:s.batchTableBin,i3dm:s.i3dm,gltf:i})}))}rr(t,e,r,n,i){const s={transferable:!0,requestImage:this.We,decoders:this.Qe,supportedFormats:this._e,maxTextureSize:i&&i.maxTextureSize},a=new DataView(e,r,n),A=32+a.getUint32(12,!0)+a.getUint32(16,!0)+a.getUint32(20,!0)+a.getUint32(24,!0);if(0===a.getUint32(28,!0)){let n=M$4(new Uint8Array(e,A+r,a.byteLength-A));return-1==n.indexOf("://")&&(n=t.substring(0,t.lastIndexOf("/"))+"/"+n),n.indexOf(".glb")>0?w$8.getArrayBuffer(n,{}).then((t=>this.ir(n,{buffer:t.data,byteOffset:0},s))):w$8.getJSON(n,{}).then((t=>this.ir(n,t,s)))}return this.ir(t,{buffer:e,byteOffset:A+r,byteLength:a.byteLength-A},s)}ir(t,e,r){const n=t.substring(0,t.lastIndexOf("/")),i=new this.je(n,e,r);return i.load({skipAttributeTransform:!0}).then((r=>{let n=0,o=0;return e.buffer&&(n=e.byteOffset||0,o=e.byteLength||0),r.url=`${t}-${n}-${o}`,{transferables:i.transferables,gltf:r}}))}nr(t,e,r,n){const i=new DataView(t,e,r),o=i.getUint32(4,!0);if(1!==o){const t="Unsupported pnts version: "+o+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+n;return console.warn(t),{error:t}}const s=[t],{featureTable:a,featureTableBin:A,batchTable:c,batchTableBin:l}=xt$2(i,32+e,s),f={},h=a.INSTANCES_LENGTH;if(a.POSITION){const{byteOffset:e}=a.POSITION;f.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+A.offset,3*h).slice()},s.push(f.POSITION.array.buffer)}else if(a.POSITION_QUANTIZED){const e=a.QUANTIZED_VOLUME_OFFSET,r=a.QUANTIZED_VOLUME_SCALE,{byteOffset:n}=a.POSITION_QUANTIZED;f.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.sr(new Uint16Array(t,n+A.offset,3*h),e,r)},s.push(f.POSITION.array.buffer)}if(a.BATCH_ID){f.BATCH_ID=St$1(a.BATCH_ID,t,A.offset,h);const e=f.BATCH_ID.array&&f.BATCH_ID.array.buffer;e&&s.indexOf(e)<0&&s.push(e)}if(a.NORMAL_UP){let{byteOffset:e}=a.NORMAL_UP;f.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+A.offset,3*h).slice()},s.push(f.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT.byteOffset,f.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+A.offset,3*h).slice()},s.push(f.NORMAL_RIGHT.array.buffer)}else if(a.NORMAL_UP_OCT32P){let{byteOffset:e}=a.NORMAL_UP_OCT32P;f.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.ar(new Uint16Array(t,e+A.offset,2*h))},s.push(f.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT_OCT32P.byteOffset,f.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.ar(new Uint16Array(t,e+A.offset,2*h))},s.push(f.NORMAL_RIGHT.array.buffer)}if(a.SCALE){const{byteOffset:e}=a.SCALE;f.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:h,componentType:5126,array:new Float32Array(t,e+A.offset,h).slice()},s.push(f.SCALE.array.buffer)}else if(a.SCALE_NON_UNIFORM){const{byteOffset:e}=a.SCALE_NON_UNIFORM;f.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+A.offset,3*h).slice()},s.push(f.SCALE_NON_UNIFORM.array.buffer)}return{count:h,batchTable:c,batchTableBin:l,featureTable:a,i3dm:f,transferables:s}}ar(t){const e=t.length/2,r=new Float32Array(3*e),n=[];for(let i=0;i<e;i++)rn$1(n,t[2*i],t[2*i+1],65535),r[3*i]=n[0],r[3*i+1]=n[1],r[3*i+2]=n[2];return r}sr(t,e,r){return Ft$1(new Float32Array(t.length),t,e,r)}tr(){return null}}function rn$1(t,e,r,n){if(t[0]=nn$1(e,n),t[1]=nn$1(r,n),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*on$1(e),t[1]=(1-Math.abs(e))*on$1(t[1])}return normalize$4(t,t)}function nn$1(t,e){return function(t,e,r){return t<0?0:t>r?r:t}(t,0,e=function(t,e){return null!=t?t:255}(e))/e*2-1}function on$1(t){return t<0?-1:1}class sn$1{constructor(){}load(t,e,r=0,n=0){return e?(n||(n=e.byteLength),this.qe(t,e,r,n)):w$8.getArrayBuffer(t,{}).then((e=>{const i=e.data;return n||(n=i.byteLength),this.qe(t,i,r,n)}))}qe(t,e,r,n){return this.Ar(e,r,n,t).then((t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts}))}Ar(t,e,r,n){const i=new DataView(t,e,r),o=i.getUint32(4,!0);if(1!==o){const t="Unsupported pnts version: "+o+", url:"+n;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+n;return console.warn(t),{error:t}}const s=[t],{featureTable:a,featureTableBin:A,batchTable:c,batchTableBin:l}=xt$2(i,e+28,s),f=a.QUANTIZED_VOLUME_OFFSET,h=a.QUANTIZED_VOLUME_SCALE,E=a.POINTS_LENGTH;let u,_={};if(a.extensions&&a.extensions["3DTILES_draco_point_compression"]){_=a.extensions["3DTILES_draco_point_compression"],u=new DataView(t,_.byteOffset+A.offset,_.byteLength);const e={attributes:_.properties,useUniqueIDs:!1};return this.cr||(this.cr=$r$1().draco),this.cr(u,e).then((e=>{const r=e.attributes;!a.POSITION&&!a.POSITION_QUANTIZED||r.POSITION||r.POSITION_QUANTIZED||(r.POSITION=a.POSITION,r.POSITION_QUANTIZED=a.POSITION_QUANTIZED),!(a.RGB||a.RGBA||a.RGB565)||r.RGB||r.RGBA||r.RGB565||(r.RGB=a.RGB,r.RGBA=a.RGBA,r.RGB565=a.RGB565),!a.NORMAL&&!a.NORMAL_OCT16P||r.NORMAL||r.NORMAL_OCT16P||(r.NORMAL=a.NORMAL,r.NORMAL_OCT16P=a.NORMAL_OCT16P);const n=this.lr(t,e.attributes,A.offset,E,s,f,h);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;n.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:Lt$1(t.constructor),array:t},s.push(t.buffer)}else if(a.BATCH_ID||Object.keys(c).length){n.BATCH_ID=a.BATCH_ID?St$1(a.BATCH_ID,t,A.offset,E):an$1(E);const e=n.BATCH_ID.array&&n.BATCH_ID.array.buffer;e&&s.indexOf(e)<0&&s.push(e)}return{count:E,batchTable:c,batchTableBin:l,featureTable:a,pnts:n,transferables:s}}))}const B=this.lr(t,a,A.offset,E,s,f,h);if(a.BATCH_ID||Object.keys(c).length){B.BATCH_ID=a.BATCH_ID?St$1(a.BATCH_ID,t,A.offset,E):an$1(E);const e=B.BATCH_ID.array&&B.BATCH_ID.array.buffer;e&&s.indexOf(e)<0&&s.push(e)}return Promise.resolve({count:E,batchTable:c,batchTableBin:l,featureTable:a,pnts:B,transferables:s})}lr(t,e,r,n,i,o,s){const a={};if(e.POSITION){let{byteOffset:o,array:s}=e.POSITION;o=o||0;const A=s?0:r;if(!s){const e=t.slice(o+A,o+A+3*n*4);s=new Float32Array(e)}a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:s},i.push(s.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:A,array:c}=e.POSITION_QUANTIZED;A=A||0;const l=c?0:r;a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:this.sr(c||new Uint16Array(t,A+l,3*n),o,s)},i.push(a.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:o,array:s}=e.RGBA;o=o||0;const A=s?0:r;if(!s){const e=t.slice(o+A,o+A+4*n);s=new Uint8Array(e)}a.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:n,componentType:5121,array:s},i.push(s.buffer)}else if(e.RGB){let{byteOffset:o,array:s}=e.RGB;o=o||0;const A=s?0:r;if(!s){const e=t.slice(o+A,o+A+3*n);s=new Uint8Array(e)}a.RGB={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5121,array:s},i.push(s.buffer)}else if(e.RGB565){let{byteOffset:o,array:s}=e.RGB565;o=o||0;const A=s?0:r;if(!s){const e=t.slice(o+A,o+A+2*n);s=new Uint16Array(e)}a.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:n,componentType:5123,array:s},i.push(s.buffer)}if(e.NORMAL){let{byteOffset:o,array:s}=e.NORMAL;o=o||0;const A=s?0:r;if(!s){const e=t.slice(o+A,o+A+3*n*4);s=new Float32Array(e)}a.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:n,componentType:5126,array:s},i.push(s.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:o,array:s}=e.NORMAL_OCT16P;o=o||0;const A=s?0:r;if(!s){const e=t.slice(o+A,o+A+2*n);s=new Uint8Array(e)}a.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:n,componentType:5121,array:s},i.push(s.buffer)}return a}sr(t,e,r){return Ft$1(new Float32Array(t.length),t,e,r)}tr(){return null}}function an$1(t){const e=F$4(t),r=new e(t);for(let e=0;e<t;e++)r[e]=e;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:Lt$1(e),array:r}}class An$1{constructor(t,e,r,n){this._e=r,this.We=t,this.je=e||k$8,this.er=n}load(t,e,r=0,n=0,i){return e?this.qe(t,e,r,n,i):w$8.getArrayBuffer(t,{}).then((e=>this.qe(t,e.data,r,n)))}qe(t,e,r,n,i){n||(n=e.byteLength);const o=this.hr(e,t,r,n),s=[];for(let r=0;r<o.length;r++){let n;if("b3dm"===o[r].magic)n=new tn$1(this.We,this.je,this._e);else if("i3dm"===o[r].magic)n=new en$1(this.We,this.je,this._e,this.er);else if("pnts"===o[r].magic)n=new sn$1;else{if("cmpt"!==o[r].magic){console.warn("Unsupported magic in CMPT tile:",o[r].magic);continue}n=new An$1(this.We,this.je,this._e,this.er)}s.push(n.load(t,e,o[r].offset,o[r].byteLength,i).then((t=>t)))}return Promise.all(s).then((t=>({magic:"cmpt",tiles:t})))}hr(t,e,r,n){const i=new DataView(t,r,n),o=i.getUint32(4,!0);if(1!==o){const t="Unsupported cmpt version: "+o+", url:"+e;return console.warn(t),{error:t}}if(16===i.byteLength)return[];const s=[],a=i.getUint32(12,!0);let A=16;for(let e=0;e<a;e++){const e=Rt$1(i,A),n=i.getUint32(A+8,!0);s.push({magic:e,buffer:t,offset:A+r,byteLength:n}),A+=n}return s}}if(transcoders){const r=t__namespace.Map.VERSION;if(r.indexOf("1.0.0-beta")>=0||r.indexOf("1.0.0-alpha")>=0){const r=transcoders.inject(m$3);t__namespace.registerWorkerAdapter("@maptalks/3dtiles",r)}else t__namespace.registerWorkerAdapter("@maptalks/3dtiles",(function(){return transcoders.inject(m$3)}))}else t__namespace.registerWorkerAdapter("@maptalks/3dtiles",m$3);"undefined"!=typeof console&&console.log("@maptalks/3dtiles v0.23.1");for(
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/
var planes=[],i=0;i<6;i++)planes[i]=[];var p$3=[];function intersectsBox(matrix,box,mask){!function(m){var me0=m[0],me1=m[1],me2=m[2],me3=m[3],me4=m[4],me5=m[5],me6=m[6],me7=m[7],me8=m[8],me9=m[9],me10=m[10],me11=m[11],me12=m[12],me13=m[13],me14=m[14],me15=m[15];setComponents(planes[0],me3-me0,me7-me4,me11-me8,me15-me12),setComponents(planes[1],me3+me0,me7+me4,me11+me8,me15+me12),setComponents(planes[2],me3+me1,me7+me5,me11+me9,me15+me13),setComponents(planes[3],me3-me1,me7-me5,me11-me9,me15-me13),setComponents(planes[4],me3-me2,me7-me6,me11-me10,me15-me14),setComponents(planes[5],me3+me2,me7+me6,me11+me10,me15+me14)}(matrix);for(var i=0;i<6;i++)if(!mask||"0"!==mask.charAt(i)){var plane=planes[i];if(p$3[0]=plane[0]>0?box[1][0]:box[0][0],p$3[1]=plane[1]>0?box[1][1]:box[0][1],p$3[2]=plane[2]>0?box[1][2]:box[0][2],distanceToPoint(plane,p$3)<0)return!1}return!0}function setComponents(out,x,y,z,w){var inverseNormalLength=1/Math.sqrt(x*x+y*y+z*z);return out[0]=x*inverseNormalLength,out[1]=y*inverseNormalLength,out[2]=z*inverseNormalLength,out[3]=w*inverseNormalLength,out}function distanceToPoint(plane,p){return plane[0]*p[0]+plane[1]*p[1]+plane[2]*p[2]+plane[3]}
/*!
	 * @maptalks/gltf-layer v0.81.4
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.org
	 */const w$3='function(t){var e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],u=e[6],f=e[7],h=e[8],l=e[9],d=e[10],m=e[11],g=e[12],_=e[13],b=e[14],y=e[15],p=n[0],w=n[1],A=n[2],T=n[3];return t[0]=p*r+w*a+A*h+T*g,t[1]=p*s+w*c+A*l+T*_,t[2]=p*i+w*u+A*d+T*b,t[3]=p*o+w*f+A*m+T*y,p=n[4],w=n[5],A=n[6],T=n[7],t[4]=p*r+w*a+A*h+T*g,t[5]=p*s+w*c+A*l+T*_,t[6]=p*i+w*u+A*d+T*b,t[7]=p*o+w*f+A*m+T*y,p=n[8],w=n[9],A=n[10],T=n[11],t[8]=p*r+w*a+A*h+T*g,t[9]=p*s+w*c+A*l+T*_,t[10]=p*i+w*u+A*d+T*b,t[11]=p*o+w*f+A*m+T*y,p=n[12],w=n[13],A=n[14],T=n[15],t[12]=p*r+w*a+A*h+T*g,t[13]=p*s+w*c+A*l+T*_,t[14]=p*i+w*u+A*d+T*b,t[15]=p*o+w*f+A*m+T*y,t}function r(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t,n,r){var s=new e(3);return s[0]=t,s[1]=n,s[2]=r,s}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function a(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function c(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function u(t,e,n,r,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=s,t}function f(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function h(t,e,n,r){var s=e[0],i=e[1],o=e[2],a=e[3],c=n[0],u=n[1],f=n[2],h=n[3],l=void 0,d=void 0,m=void 0,g=void 0,_=void 0;return(d=s*c+i*u+o*f+a*h)<0&&(d=-d,c=-c,u=-u,f=-f,h=-h),1-d>1e-6?(l=Math.acos(d),m=Math.sin(l),g=Math.sin((1-r)*l)/m,_=Math.sin(r*l)/m):(g=1-r,_=r),t[0]=g*s+_*c,t[1]=g*i+_*u,t[2]=g*o+_*f,t[3]=g*a+_*h,t}r(),function(){var t,n=(t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var l,d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};r(),s(1,0,0),s(0,1,0),f(),f(),l=new e(9),e!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1;\n/*!\n   * @maptalks/gltf-loader v0.27.2\n   * LICENSE : UNLICENSED\n   * (c) 2016-2023 maptalks.org\n   */\nlet m=0;function g(t){return null==t}function _(t){return!g(t)}function b(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function y(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView\'s component type: "+t)}function p(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function w(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return r.buffer}const A=[],T=[],I=[],x=[0,0,0],M=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),v=[1,1,1];function E(t,e,n,r,s,i,o){const a=y(o);if((0===s||s===r*a.BYTES_PER_ELEMENT)&&i%a.BYTES_PER_ELEMENT==0){const s=new a(e,i,n*r);return t.set(s),t}0===s&&(s=r*a.BYTES_PER_ELEMENT);const c=new Uint8Array(r*a.BYTES_PER_ELEMENT);for(let o=0;o<n;o++){let n=null;const u=new Uint8Array(e,s*o+i,r*a.BYTES_PER_ELEMENT);c.set(u),n=new a(c.buffer,0,r);for(let e=0;e<r;e++)t[o*r+e]=n[e]}return t}const O="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function P(t,e,n){const r=new Uint8Array(t,e,n);return O.decode(r)}const k={get:function(t,e={}){e||(e={});const n=new AbortController,r=n.signal,s=b({},e);s.signal=r,s.method||(s.method="GET");const i=fetch(t,s).then(t=>{const n=this.t(t,e.responseType);return n.message?n:n.then(n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t})}).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t});return i.xhr=n,i},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={})=>(e||(e={}),e.responseType="arraybuffer",k.get(t,e)),getJSON:function(t,e={}){return e&&e.jsonp?k.jsonp(t):((e=e||{}).responseType="json",k.get(t,e))},jsonp:function(t){const e="_maptalks_jsonp_"+m++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise(t=>{window[e]=function(r){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(r)},document.getElementsByTagName("head")[0].appendChild(n)})}};class N{constructor(t,e,n){this.s=t,this.decoders=e,this.i=n,this.images={},this.o={}}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const r=this.buffers[t.id],s=this.u(e,r);return this.getImageByBuffer(s,n)}if(this.o[t.id])return this.o[t.id].then(()=>{const r=this.buffers[t.id],s=this.u(e,r);return this.getImageByBuffer(s,n)});if(p(t.uri)){const r=this.buffers[t.id]=w(t.uri),s=this.u(e,r);return this.getImageByBuffer(s,n)}return this.o[t.id]=k.getArrayBuffer(t.uri,null).then(r=>{const s=this.buffers[t.id]=r.data,i=this.u(e,s);return this.getImageByBuffer(i,n)})}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;if(n[e.mimeType])return n[e.mimeType](t,{supportedFormats:this.i});if("image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType)return console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null);{const n=new Blob([t],{type:e.mimeType}),r=URL.createObjectURL(n);return this.h(e.id,r)}}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.o[t.id]?this.o[t.id].then(()=>this.images[t.id]):this.o[t.id]=this.h(t.id,e)}h(t,e){return new Promise((n,r)=>{this.s(e,(s,i)=>{s?r(s):(URL.revokeObjectURL(e),this.images[t]=i,n(this.images[t]))})})}}const S=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16];class R{constructor(t,e,n){this.rootPath=t,this.gltf=e,this.l=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this.m()}g(t,e){const n=this.gltf,r=n.accessors[e];if(void 0===r.bufferView)return this.accessors[r.id]=this._(t,e,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);const s=n.bufferViews[r.bufferView];return this.p(s).then(n=>{const{buffer:s,byteOffset:i}=n;return this.accessors[r.id]=this._(t,e,s,i)})}p(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then(()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})});if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(p(e.uri)){const t=this.buffers[e.id]=w(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=k.getArrayBuffer(t,null).then(r=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=r.data,byteOffset:0}))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_(t,e,n,r=0){const s=this.gltf,i=s.accessors[e],o=void 0!==i.bufferView?s.bufferViews[i.bufferView]:{},a=(o.byteOffset||0)+r,c=this.A(i.type),u=y(i.componentType),f=o.byteStride||0,h={array:void 0,name:t,accessorName:e,byteLength:i.count*c*u.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:c};if(i.min&&(h.min=i.min),i.max&&(h.max=i.max),n)if(this.l)h.byteStride=f,h.byteOffset=a+(i.byteOffset||0),!f||f===c*u.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(h.array=this.T(n,i.count,c,a+(i.byteOffset||0),u),h.array.buffer.byteLength===h.byteLength&&(h.byteOffset=0)):h.array=new Uint8Array(n,a,o.byteLength);else if(i.interleaved){h.byteStride=0,h.byteOffset=0;const t=new u(i.count*c);h.array=E(t,n,i.count,c,f,a+(i.byteOffset||0),i.componentType)}else h.byteStride=0,h.array=this.T(n,i.count,c,a+(i.byteOffset||0),u),h.byteOffset=h.array.byteOffset;else{h.array=new u(i.count);const t=h.min||h.max;t&&(h.array[0]=t[0],h.array[1]=t[1],h.array[2]=t[2])}return h}m(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}T(t,e,n,r,s){return r%s.BYTES_PER_ELEMENT!=0&&(t=t.slice(r,r+e*n*s.BYTES_PER_ELEMENT),r=0),new s(t,r,n*e)}A(t){const e=S.indexOf(t);return S[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map(t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this.p(e).then(r=>{const{buffer:s,byteOffset:i}=r,o=P(s,i+(e.byteOffset||0),n);return t.content=o,t})}if(t.uri){if(p(t.uri)){const e=w(t.uri),n=P(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return k.get(e).then(e=>(t.content=e,t))}}return Promise.resolve(t)});return Promise.all(n).then(()=>t)}}class B extends N{constructor(t,e,n,r,s,i){super(r,s,i),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new R(t,e,n)}iterate(t,e){const n=this.gltf[e];if(!n)return;let r=0;for(const e in n)t(e,n[e],r++)}createNode(t){const e={};if(_(t.name)&&(e.name=t.name),_(t.children)&&(e.children=t.children),_(t.jointName)&&(e.jointName=t.jointName),_(t.matrix)&&(e.matrix=t.matrix),_(t.rotation)&&(e.rotation=t.rotation),_(t.scale)&&(e.scale=t.scale),_(t.translation)&&(e.translation=t.translation),_(t.extras)&&(e.extras=t.extras),_(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(A,e.translation||x),s=function(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,a=r+r,c=s+s,u=n*o,f=r*o,h=r*a,l=s*o,d=s*a,m=s*c,g=i*o,_=i*a,b=i*c;return t[0]=1-h-m,t[1]=f+b,t[2]=l-_,t[3]=0,t[4]=f-b,t[5]=1-u-m,t[6]=d+g,t[7]=0,t[8]=l+_,t[9]=d-g,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(T,e.rotation||M),i=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(I,e.scale||v);return n(i,s,i),n(t,r,i)}return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}I(t){const e={};for(const n in t){const r=t[n];let s,i;r.instanceTechnique&&r.instanceTechnique.values?(s=r.instanceTechnique,i=s.values.diffuse):(s=r,i=s.values.tex||s.values.diffuseTex||s.values.diffuse);const o={baseColorTexture:{index:i}};r.name&&(o.name=r.name),r.extensions&&(o.extensions=r.extensions),r.extras&&(o.extras=r.extras),e[n]=o}return e}M(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],r=(n.byteOffset||0)+this.glbBuffer.byteOffset,s=n.byteLength,i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,r,s);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}v(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.M(n).then(t=>{const r=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:r}})}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,r;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,r=n.values.diffuse):(n=e,r=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const s=this.gltf.textures[r];if(!s)return null;const i=this.gltf.samplers[s.sampler];return{format:s.format||6408,internalFormat:s.internalFormat||6408,type:s.type||5121,sampler:i,source:this.gltf.images[s.source]}}getMaterial(){return null}getAnimations(){return null}}class C extends N{constructor(t,e,n,r,s,i){super(r,s,i),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new R(t,e,n)}iterate(t,e){const n=this.gltf[e];if(n)for(let e=0;e<n.length;e++)t(e,n[e],e)}createNode(t){const e={};return b(e,t),!_(t.weights)&&this.gltf.meshes&&_(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}v(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.M(n).then(t=>{if(!t)return null;const r={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extensions:n.extensions,extras:n.extras}};b(r,e);const s=_(e.sampler)?this.gltf.samplers[e.sampler]:void 0;return s&&(r.sampler=s),t.format&&(r.format=t.format),r})}M(t){if(!_(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this.O(e,t)}return null}O(t,e){const n=this.u(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}u(t,e,n){n=n||0;const r=t.byteOffset+n,s=t.byteLength;return new Uint8Array(e,r,s)}P(t,e){const n=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)n[e]=String.fromCharCode(t[e]);return n.join(""),"data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(n)))}getAnimations(t){const e=[];return t.forEach(t=>{e.push(this.getSamplers(t.samplers))}),Promise.all(e).then(e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t})}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(_(t[n].input)||_(t[n].output))&&(e.push(this.accessor.g("input",t[n].input)),e.push(this.accessor.g("output",t[n].output)));return Promise.all(e).then(e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t})}}const U="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class L{static read(t,e=0,n=0){n||(n=t.byteLength);const r=new DataView(t,e,n),s=r.getUint32(4,!0);if(1===s)return L.readV1(r,e);if(2===s)return L.readV2(t,e);throw new Error("Unsupported glb version : "+s)}static readV1(t,e){const n=t.getUint32(8,!0),r=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb\'s byte length.");const s=D(t.buffer,20+e,r);return{json:JSON.parse(s),glbBuffer:{byteOffset:20+e+r,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,r,s;const i=new DataView(t,e+12);let o=0;for(;o<i.byteLength;){const a=i.getUint32(o,!0);o+=4;const c=i.getUint32(o,!0);if(o+=4,1313821514===c)n=D(t,e+12+o,a);else if(5130562===c){s=e+12+o,r=a;break}o+=a}return{json:JSON.parse(n),glbBuffer:{byteOffset:s,buffer:t,byteLength:r}}}}function D(t,e,n){if(U){const r=new Uint8Array(t,e,n);return U.decode(r)}return function(t){const e=t.length;let n="";for(let r=0;r<e;){let s=t[r++];if(128&s){let n=q[s>>3&7];if(!(64&s)||!n||r+n>e)return null;for(s&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;s=s<<6|63&e}}n+=String.fromCharCode(s)}return n}(new Uint8Array(t,e,n))}const q=[1,1,1,1,2,2,3,0],F=[0,0,0],j=[0,0,0,1],V=[1,1,1],H={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},K={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},$={k(t,e,n,r,s,o,a,c){const u=_(t)?e.animations:[e.animations[0]],f={};for(let e=0;e<u.length;e++){const h=u[e],l=h.name||e;if(_(t)&&l!==t)continue;const m=h.channelsMap[n];if(m)for(let t=0;t<m.length;t++){const e=m[t];"translation"===e.target.path?(this.N(s,h.samplers[e.sampler],r,1),f.translation=i(F,s)):"rotation"===e.target.path?(this.S(o,h.samplers[e.sampler],r,1),f.rotation=d(j,o)):"scale"===e.target.path?(this.N(a,h.samplers[e.sampler],r,1),f.scale=i(V,a)):"weights"===e.target.path&&c&&(this.N(c,h.samplers[e.sampler],r,c.length),f.weights=c)}}return f},N(t,e,n,r){switch(e.interpolation){case"LINEAR":{const s=this.R(K,e,n,1*r);s&&(t=function(t,e,n,r){for(let s=0;s<t.length;s++)t[s]=e[s]+r*(n[s]-e[s]);return t}(t,s.PREVIOUS,s.NEXT,s.INTERPOLATION));break}case"STEP":{const s=this.R(K,e,n,1*r);s&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this.R(K,e,n,3*r);s&&(t=this.B(t,s,e.input.array,3*r));break}}return t},S(t,e,n){switch(e.interpolation){case"LINEAR":{const r=this.R(K,e,n,1);r&&h(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const r=this.R(K,e,n,1);r&&(t=u(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this.R(K,e,n,3);if(r){for(let t=0;t<r.PREVIOUS.length;t++)r.PREVIOUS[t]=Math.acos(r.PREVIOUS[t]),r.NEXT[t]=Math.acos(r.NEXT[t]);t=this.B(t,r,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},C(t,e){const n=t.length;let r,s,i,o=0,a=n-1,c=Math.floor((o+a)/2);for(;o<=n-1&&a>=0;){if(o===a)return null;if(t[c]<=e&&e<=t[c+1]){const n=t[c];return r=c,s=c+1,i=(e-n)/(t[c+1]-n),{preIndx:r,nextIndex:s,interpolation:i}}e<t[c]?(a=c,c=Math.floor((o+a)/2)):t[c+1]<e&&(o=c,c=Math.floor((o+a)/2))}return null},R(t,e,n,r){const s=e.input.array,i=e.output.array,o=e.output.itemSize;(n<s[0]||n>s[s.length-1])&&(n=Math.max(s[0],Math.min(s[s.length-1],n))),n===s[s.length-1]&&(n=s[0]);const a=this.C(s,n);if(!a||!a.nextIndex)return null;const{preIndx:c,nextIndex:u,interpolation:f}=a;t.PREINDEX=c,t.NEXTINDEX=u,t.INTERPOLATION=f;const h=o*r;return t.PREVIOUS=i.subarray(t.PREINDEX*h,(t.PREINDEX+1)*h),t.NEXT=i.subarray(t.NEXTINDEX*h,(t.NEXTINDEX+1)*h),t},B(t,e,n,r){const s=e.INTERPOLATION,i=n[e.PREINDEX],o=n[e.NEXTINDEX];for(let n=0;n<3;n++){const a=e.PREVIOUS[r+n],c=(o-i)*e.PREVIOUS[2*r+n],u=e.NEXT[3+n],f=(o-i)*e.NEXT[n],h=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*a+(Math.pow(s,3)-2*Math.pow(s,2)+s)*c+(2*-Math.pow(s,3)+3*Math.pow(s,2))*u+(Math.pow(s,3)-Math.pow(s,2))*f;t[n]=h}return t},getAnimationClip(t,e,n,r){const s=t.nodes[e]&&t.nodes[e].weights;return o(F,...H.TRANSLATION),u(j,...H.ROTATION),o(V,...H.SCALE),this.k(r,t,e,n,F,j,V,s)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach((e,n)=>{let r=-1/0,s=1/0;const i=e.channels;for(let t=0;t<i.length;t++){const n=i[t],o=e.samplers[n.sampler].input.array;o[o.length-1]>r&&(r=o[o.length-1]),o[0]<s&&(s=o[0])}const o=e.name||n;t.timeSpan[o]={max:r,min:s}}),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?_(e)?n[e]:n[Object.keys(n)[0]]:null}};let G=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(rt){}t&&"undefined"!=typeof createImageBitmap&&(G=!0)}const X="undefined"==typeof document?null:document.createElement("canvas");class z{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:r}=L.read(e.buffer,e.byteOffset,e.byteLength);this.U(t,n,r)}else this.U(t,e);this.L=new R(this.rootPath,this.gltf,this.glbBuffer),this.D()}D(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}q(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.L.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then(e=>(t.KHR_techniques_webgl=e,t)):Promise.resolve(t)}load(t){t=t||{};const e=this.F(t),n=this.j(),r=this.V(),s=this.q();return Promise.all([e,n,r,s]).then(t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0]))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const n=e[t];n.channelsMap={};for(let t=0;t<n.channels.length;t++){const e=n.channels[t];n.channelsMap[e.target.node]||(n.channelsMap[e.target.node]=[]),n.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let n=0;n<e.length;n++)e[n].uri&&e[n].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[n].uri});for(let e=0;e<n.length;e++)n[e].uri&&n[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[e].uri})}return t}static getAnimationClip(t,e,n,r){return $.getAnimationClip(t,e,n,r)}static getAnimationTimeSpan(t,e){return $.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return y(t)}static readInterleavedArray(t,e,n,r,s,i,o){return E(t,e,n,r,s,i,o)}U(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=G?Y.bind(this):this.options.requestImage||J,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new C(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate((t,e,n)=>{e.id="buffer_"+n},"buffers"),this.adapter.iterate((t,e,n)=>{e.id="image_"+n},"images"),this.adapter.iterate((t,e,n)=>{e.id="accessor_"+n},"accessors")):(this.adapter=new B(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{}),this.adapter.iterate((t,e,n)=>{e.id="accessor_"+n},"accessors"),this.adapter.iterate((t,e,n)=>{e.id="image_"+n},"images"))}H(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||function(t){return!g(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}(t.children[0])))return t;const r=t.children.map(t=>{const n=e[t];return n.nodeIndex=t,this.H(n,e)});t.children=r}var n;return t}F(t){return this.K(t).then(t=>{const e=this.scenes=[];let n;for(const e in t)t[e]=this.H(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate((r,s,i)=>{const o={};s.name&&(o.name=s.name),s.nodes&&(o.nodes=s.nodes.map(e=>t[e])),this.gltf.scene===r&&(n=i),e.push(o)},"scenes");const r={asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.I(this.gltf.materials);r.materials=t}return r})}K(t){return this.$(t).then(()=>{const t=this.nodes={};return this.adapter.iterate((e,n)=>{const r=this.adapter.createNode(n,this.meshes,this.skins);t[e]=r},"nodes"),t})}G(){this.skins=[];const t=[];return this.adapter.iterate((e,n,r)=>{t.push(this.X(n).then(t=>{t.index=r,this.skins.push(t)}))},"skins"),t}X(t){const e=t.inverseBindMatrices;return this.adapter.accessor.g("inverseBindMatrices",e).then(e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t))}j(){const t=this.gltf.animations;return _(t)?this.adapter.getAnimations(t):null}$(t){this.meshes={};let e=[];return this.adapter.iterate((n,r,s)=>{e.push(this.J(r,t).then(t=>{t.index=s,this.meshes[n]=t}))},"meshes"),e=e.concat(this.G()),Promise.all(e)}J(t,e){const n=t.primitives.map(t=>this.W(t,e)).filter(t=>!!t);return Promise.all(n).then(e=>{const n={};return b(n,t),n.primitives=e,n})}V(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter.v(n));return Promise.all(e).then(e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t].image.array;if(e[t]&&n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},r=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[r[t]]=e[t]);return n}return e})}W(t,e){let n;const r=[],s=t.extensions;if(_(t.targets))for(let e=0;e<t.targets.length;e++){const n=t.targets[e];for(const t in n){const s=this.adapter.accessor.g(`morphTargets_${t}_${e}`,n[t]);s&&r.push(s)}}if(s&&s.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:i,attributes:o}=s.KHR_draco_mesh_compression,a=this.gltf.bufferViews[i],c=this.L.p(a).then(n=>{const{buffer:r,byteOffset:s}=n;let{byteOffset:i,byteLength:c}=a;i||(i=0);const u=new DataView(r,s+i,c),f={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(u,f).then(t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e})});r.push(c),n=Promise.all(r)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor.g(t,e[t]);n&&r.push(n)}if(_(t.indices)){const e=this.adapter.accessor.g("indices",t.indices);e&&r.push(e)}n=Promise.all(r)}return n.then(e=>{if(s&&s.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,r;const i={attributes:e.reduce((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)r=r||{},r[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:r,array:s}=e,i=s.length/r;for(let e=0;e<i;e++)for(let i=0;i<r;i++){const o=e*r+i;s[o]<t[i]&&(t[i]=s[o]),s[o]>n[i]&&(n[i]=s[o])}if(e.quantization){const r=e.quantization,s=r.range/(1<<r.quantizationBits),i=r.minValues;c(t,t,s),a(t,t,i),c(n,n,s),a(n,n,i)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t},{}),material:t.material};return n&&(i.indices=n),r&&(i.morphTargets=r),i.mode=_(t.mode)?t.mode:4,_(t.extras)&&(i.extras=t.extras),i})}}function J(t,e){const n=new Image;n.crossOrigin="",n.onload=()=>{if(!X)return void e(new Error("There is no canvas to draw image!"));X.width=n.width,X.height=n.height;const t=X.getContext("2d",{willReadFrequently:!0});t.drawImage(n,0,0,n.width,n.height);const r=t.getImageData(0,0,n.width,n.height),s={width:n.width,height:n.height,data:new Uint8Array(r.data)};e(null,s)},n.onerror=function(t){e(t)},n.src=t}let W,Q;function Y(t,e){W||(W=new OffscreenCanvas(2,2),Q=W.getContext("2d",{willReadFrequently:!0})),fetch(t).then(t=>t.arrayBuffer()).then(t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)}).then(t=>{let{width:n,height:r}=t;Z(n)||(n=tt(n)),Z(r)||(r=tt(r));const s=this.options.maxTextureSize;s&&(n=Math.min(s,n),r=Math.min(s,r)),W.width=n,W.height=r,Q.drawImage(t,0,0,n,r),t.close();const i=Q.getImageData(0,0,n,r);e(null,{width:n,height:r,data:new Uint8Array(i.data)})}).catch(t=>{console.warn(t),e(t)})}function Z(t){return 0==(t&t-1)&&0!==t}function tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}\n/*!\n   * @maptalks/gl v0.81.4\n   * LICENSE : UNLICENSED\n   * (c) 2016-2023 maptalks.com\n   */const et=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},nt=et(),rt=nt.gl_trans__coders=nt.gl_trans__coders||{};rt.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),s=nt.gl_trans__coders=nt.gl_trans__coders||{};let i=`${r}\\n    const _____getGlobal = ${et.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals[\'gl_trans__coders\'] = g___lobals[\'gl_trans__coders\'] || {};`;for(const t in s)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(i+=\'tran_____scoders["\'+t+\'"] =\'+s[t].toString()+"\\n;");return i+="\\n"+e.substring(r.length),i},rt.registerTranscoder=function(t,e){rt[t]=e},rt.getTranscoder=function(t){return rt[t]};const st={"image/crn":rt.crn&&rt.crn(),"image/ktx2":rt.ktx2&&rt.ktx2(),"image/cttf":rt.ktx2&&rt.ktx2(),"draco":rt.draco&&rt.draco()};let it;const ot={};function at(t,e,n){return new z(t,e,n).load({skipAttributeTransform:!0})}function ct(t,e){const n=e.lastIndexOf("/"),r=e.slice(0,n),s=e.slice(e.lastIndexOf(".")).toLowerCase(),i=ut.bind(this,t);return s.indexOf(".gltf")>-1?function(t,e){return k.getJSON(t,e)}(e,{}).then(t=>t.message?t:at(r,t,{requestImage:i,decoders:st,transferable:!0})):s.indexOf(".glb")>-1?function(t,e){return k.getArrayBuffer(t,e)}(e,{}).then(t=>t.message?t:at(r,{buffer:t.data,byteOffset:0},{requestImage:i,decoders:st,transferable:!0})):null}function ut(t,e,n){ot[e]?ot[e].push(n):(ot[e]=[n],self.postMessage({type:"<request>",command:"sendImageData",actorId:t,workerId:it,params:e}))}t.onmessage=function(t){const e=t.data,n=e.url;if("addLayer"===e.command||"removeLayer"===e.command)it=t.workerId,self.postMessage({type:"<response>",actorId:e.actorId,workerId:it,params:"ok"});else if(n)!function(t){const e=t.data,n=t.callback;ct(t.actorId,e.url).then(t=>{t.message?self.postMessage({callback:n,error:t}):self.postMessage({callback:n,data:t},t.transferables)}).catch(t=>{self.postMessage({callback:n,error:t})}),ot.receive=n}(t);else if(e.imageUrl){const t=ot[e.imageUrl];if(delete ot[e.imageUrl],t)for(let n=0;n<t.length;n++)t[n](null,e.result)}},Object.defineProperty(t,"Y",{value:!0})}';function v$2(t){return null==t}function T$3(t){return!v$2(t)}function O$3(t,e){const s=new Set(e);return Array.from(new Set(t.filter((t=>s.has(t)))))}function S$3(t,s,n=0){if(!(t&&s instanceof t$2.Coordinate))return null;const i=t.coordinateToPointAtRes(s,t.getGLRes());return[i.x,i.y,n]}function M$3(t,e){return Math.abs(t)*Math.sign(e)}const A$1={},E$3="undefined"==typeof document?null:document.createElement("canvas");class I$2 extends t__namespace.worker.Actor{constructor(t,e){super(t),this.mapId=e}loadGLTF(t){const e={url:function(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}(t)};return new Promise(((t,s)=>{this.send(e,null,((e,n)=>{e?s(e):t(n)}))}))}sendImageData(t,e){!function(t,e){const s=new Image;s.onload=()=>{if(!E$3)return void e(new Error("There is no canvas to draw image!"));E$3.width=s.width,E$3.height=s.height;const t=E$3.getContext("2d");t.drawImage(s,0,0,s.width,s.height);const n=t.getImageData(0,0,s.width,s.height),i={width:s.width,height:s.height,data:new Uint8Array(n.data)};e(null,i)},s.onerror=function(t){e(t)},s.src=t}(t,((s,n)=>{s||this.isActive()&&e(null,{result:n,imageUrl:t})}))}addLayer(t,e,s){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:e}},null,s)}removeLayer(t,e,s){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,s)}}const P$3=[],k$3=[],N$3=[.2107,-.0202],R$3=["points","lines","line strip","line loop"];class C$3 extends(pe$4(t__namespace.renderer.OverlayLayerCanvasRenderer)){constructor(t){super(t),this.t={},this.s=[]}onAdd(){super.onAdd(),this.prepareWorker()}draw(t,e){this.prepareCanvas(),this.i(e,t)}drawOnInteracting(t,e,s){this.i(s,e)}i(e,s){let n=0;this.o(e),this.h={},this.u(e);const i=this.l(e);this.m(s);const r=e&&e.renderTarget?e.renderTarget.fbo:null;for(const s in this.t){if("pointline"===s)continue;if(e&&e.includes){const{newShader:n,uniforms:r}=this.p(e,s);this.t[s].shader=n,t__namespace.Util.extend(i,r)}const o=this.g(s),a=this.t[s].shader;a.filter=e&&e.sceneFilter||null,this.renderer.render(a,i,o,r),n++}const o=this.g("pointline");if(o.getMeshes().length){i.pointSize=this.layer.options.pointSize||1;const t=this.t.pointline.shader;t.filter=e&&e.sceneFilter||null,this.renderer.render(t,i,o,r),n++}this._=!0,(!e||e&&e.isFinalRender)&&(this.completeRender(),this.layer.fire("rendercomplete-debug",{count:n})),this.v=e,this.T=s}m(e){this.s.length=0;const s=this.layer.getGeometries();for(let n=0;n<s.length;n++){const i=s[n],r=i.getMeshes(this.O,this.regl,e),o=i.getShader();r.length&&(this.s.push(i),this.h[o]=this.h[o]||[],t__namespace.Util.pushIn(this.h[o],r))}}l(e){const s={};this.S.outSize=[this.canvas.width,this.canvas.height],this.S.halton=e?e.jitter||[0,0]:N$3,t__namespace.Util.extend(s,this.S);const n=this.getMaskUniforms();return t__namespace.Util.extend(s,n),s}g(t){const e=[],s=[];if("pointline"===t){for(const t in this.h)this.h[t].forEach((t=>{R$3.indexOf(t.geometry.desc.primitive)>-1&&e.push(t)}));const t=new yt$6(e);return t.sortMeshes(this.S.cameraPosition),t}for(const e in this.h){const n=this.h[e];e===t&&n.forEach((t=>{R$3.indexOf(t.geometry.desc.primitive)<0&&s.push(t)}))}const n=new yt$6(s);return n.sortMeshes(this.S.cameraPosition),n}needToRedraw(){if(super.needToRedraw())return!0;const t=this.layer.getGeometries();for(let e=0;e<t.length;e++)if(this.s.indexOf(t[e])>-1&&(t[e].isDirty()||t[e].isAnimated()))return!0;return!1}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),super.onRemove()}hitDetect(){return!1}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;if(t)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this.M(this.canvas,t),this.regl=h$1({gl:this.gl,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_s3tc"]})}t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.O=this.regl.gltfManager=this.regl.gltfManager||this.A(),this.I(),this.P&&this.P.forEach((t=>{t.generateInstancedBuffers(this.regl)})),this.k&&this.k.forEach((t=>{t.generateBuffers(this.regl)})),this.layer.fire("contextcreate",{regl:this.regl})}N(){return this.O}A(){return new Vd(this.regl,(t=>this.workerConn.loadGLTF(t).then((t=>(this.setToRedraw(),this.R=!0,t))).catch((e=>{console.error(e),this.layer.fire("modelerror",{type:"modelerror",url:t,info:e})}))))}I(){const t=this.layer.getMap(),e=new N$8(this.regl);this.renderer=e,this.S={projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,viewMatrix:t.viewMatrix,cameraPosition:t.cameraPosition,altitudeScale:1},Fm.PBRUtils.loginIBLResOnCanvas(this.canvas,this.regl,t),this.C=new Am(e,{vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float pointSize;\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = pointSize;\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}]},this.pickingFBO,t)}prepareWorker(){const t=this.layer.getMap();this.workerConn||(this.workerConn=new I$2("@maptalks/gltf-layer",t.id));const e=this.workerConn;if(!e.isActive())return;const s=this.layer.options||{},n=this.layer.getId();e.addLayer(n,{markerType:s.markerTypes,pointSize:s.pointSize},(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}u(t){const e=A$1;for(const s in e){if(this.t[s])continue;const n=e[s];this.L(t,n.name,n.type,n.config)}}L(e,s,n,i){this.viewport||(this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1}),i.extraCommandProps||(i.extraCommandProps={});const r={};e&&this.B(r,P$3,e);const o=t__namespace.Util.extend({},i);o.extraCommandProps=t__namespace.Util.extend({},i.extraCommandProps),o.extraCommandProps.viewport=this.viewport,o.uniforms=t__namespace.Util.extend([],i.uniforms,P$3),o.defines=t__namespace.Util.extend({},o.defines,r),n.indexOf(".")>-1?(n=n.split("."),this.t[s]={shader:new u$3[n[0]][n[1]](o),type:n}):this.t[s]={shader:new u$3[n](o),type:n}}remove(){this.F();const t=this.t;for(const e in t)t[e].shader.dispose();this.extentShader&&this.extentShader.dispose(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}resizeCanvas(t){super.resizeCanvas(t),this.pickingFBO&&this.pickingFBO.resize(this.canvas.width,this.canvas.height),this.layer.fire("resizecanvas",{size:t})}getFrameTimestamp(){return this.T}getFrameContext(){return this.v}supportRenderMode(){return!0}needRetireFrames(){return this.R}B(e,s,n){const i=n&&n.includes;if(i)for(const r in i)i[r]&&(n[r].uniformDeclares&&(s.length=0,s.push(...n[r].uniformDeclares)),n[r].defines&&t__namespace.Util.extend(e,n[r].defines))}U(e,s){const n=s&&s.includes;if(n)for(const i in n)n[i]&&s[i].renderUniforms&&t__namespace.Util.extend(e,s[i].renderUniforms)}p(e,s){const{shader:n,type:i}=this.t[s],r={},o={};this.B(r,P$3,e),this.U(o,e);const a={vert:n.vert,frag:n.frag,uniforms:n.uniforms,extraCommandProps:n.extraCommandProps};a.defines=r,a.uniforms=t__namespace.Util.extend([],a.uniforms,P$3);let h=null;return e.states.includesChanged?(h=Array.isArray(i)?new u$3[i[0]][i[1]](a):new u$3[i](a),n.dispose()):h=n,{uniforms:o,newShader:h}}V(e,s,n){if(e.viewshed){for(const t in e.viewshed.renderUniforms)n[t]=e.viewshed.renderUniforms[t];t__namespace.Util.extend(s.shaderDefines,e.viewshed.defines)}if(e.floodAnalysis){for(const t in e.floodAnalysis.renderUniforms)n[t]=e.floodAnalysis.renderUniforms[t];t__namespace.Util.extend(s.shaderDefines,e.floodAnalysis.defines)}return n}getShadowMeshes(){const e=[];if(!this.layer||!this.layer.isVisible()||!this.h)return e;const s=this.layer.getGeometries();for(let n=0;n<s.length;n++)if(s[n].isCastShadow()&&s[n].isVisible()&&s[n].D()){t__namespace.Util.pushIn(e,s[n].j||[])}return e}q(){const e=[];if(!Object.keys(this.h).length)return e;for(const s in this.h)t__namespace.Util.pushIn(e,this.h[s]);return e}getAnalysisMeshes(){return this.q()}getRayCastData(t){const e=this.layer.getGeometries();for(let s=0;s<e.length;s++){const n=e[s].j;if(n&&n.indexOf(t)>-1)return e[s]}return null}drawOutline(t){this.extentShader||(this.extentShader=new ie$5({vert:"attribute vec3 aPosition;\n\nattribute float aOutline;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float instance;\n\n#include <get_output>\n\n\n\nvarying float vOutline;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    if (instance == 0.0) {\n\n        vOutline = 1.0;\n\n    } else {\n\n        vOutline = aOutline;\n\n    }\n\n}\n\n",frag:"precision highp float;\n\nvarying float vOutline;\n\nvoid main() {\n\n    gl_FragColor = vec4(vOutline);\n\n}\n\n",positionAttribute:"POSITION",extraCommandProps:{viewport:this.viewport,cull:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}));const e=this.getOutlineMeshes();e.length&&(this.G=this.G||new yt$6,this.G.setMeshes(e),this.renderer.render(this.extentShader,{projViewMatrix:this.S.projViewMatrix},this.G,t))}getOutlineMeshes(){const e=[];if(!this.layer)return e;const s=this.layer.getGeometries();for(let n=0;n<s.length;n++)if(s[n].isOutline()&&s[n].isVisible()&&s[n].D()){t__namespace.Util.pushIn(e,s[n].j||[])}return e}F(){this.canvas&&Fm.PBRUtils.logoutIBLResOnCanvas(this.canvas,this.getMap())}o(e){const s=this.layer.getMap(),{iblTexes:n,dfgLUT:i}=Fm.PBRUtils.getIBLResOnCanvas(this.canvas);if(s&&s.getLights()){const r=Fm.PBRUtils.getPBRUniforms(s,n,i,e&&e.ssr,e&&e.jitter),o=s.getLights();this.S.ambientColor=o.ambient&&o.ambient.color?o.ambient.color:[.2,.2,.2],r&&t__namespace.Util.extend(this.S,r)}else{const n=Fm.PBRUtils.getPBRUniforms(s,null,i,e&&e.ssr,e&&e.jitter);t__namespace.Util.extend(this.S,n)}}M(t,e){const s=["webgl","experimental-webgl"];let n=null;for(let i=0;i<s.length;++i){try{n=t.getContext(s[i],e)}catch(t){}if(n)break}return n}X(e,s,n={}){if(!this.C||!this.layer.isVisible())return null;const i=this.layer.getMap();if(this._||this.canvas.gl&&this.canvas.gl.wrap){if(!this.h||!Object.keys(this.h).length)return null;const e=this.q(),s=t__namespace.Util.extend({},this.S);s.pointSize=this.layer.options.pointSize||1,this.C.render(e,s,!0),this._=!1}const{meshId:o,pickingId:a,point:h}=this.C.pick(e,s,n.tolerance||3,{projViewMatrix:i.projViewMatrix,pointSize:this.layer.options.pointSize||1},{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:!0}),u=this.J(a);return{meshId:o,target:this.layer.H()[u],pickingId:a,point:h,index:a-u}}J(t){if(!T$3(t))return null;if(this.layer.H()[t])return t;const e=Object.keys(this.layer.H()).sort().map((t=>Number(t))),s=e.length;let n=0,i=s-1,r=Math.floor((n+i)/2);for(;n<=s-1&&i>=0;){if(n===i)return e[n];if(e[r]<=t&&t<e[r+1])return e[r];t<e[r]?(i=r-1,r=Math.floor((n+i)/2)):e[r+1]<t&&(n=r+1,r=Math.floor((n+i)/2))}return null}isInFrustum(t){const e=this.layer.getMap(),s=t.K;if(!s||"multigltfmarker"===t.getGLTFMarkerType())return!0;const n=set(k$3,s.min,s.max);return!!intersectsBox(e.projViewMatrix,n)}getRenderMeshesTest(){return this.q()}isMarkerTransparent(t){return t.W()}getMarkerFitSizeScale(t){return t.Y()}getMarkerFitTranslate(t){return t.Z()}getFBORayPicking(){return this.C}getShaderList(){return this.t}}const L$3=[],B$3=[],F$3=[],U$2=[],V$3=[],D$3=[1,1,1],j$2=[],q$2=[1,1,1],G$2=function(t,e){const s=[];return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=0,s[4]=t[3],s[5]=t[4],s[6]=t[5],s[7]=0,s[8]=t[6],s[9]=t[7],s[10]=t[8],s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}(function(t){const e=Math.cos(t),s=Math.sin(t),n=[];return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=e,n[5]=s,n[6]=0,n[7]=-s,n[8]=e,n}(.5*Math.PI),[0,0,0]),z$2=[186/255,186/255,186/255,1],X$2={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]};class J$2 extends t$2.Marker{constructor(t,e){const s=t$2.Util.extend({},e),i=s.symbol;super(t,s),this.options.symbol=i,this.$=!1,this.tt=identity$2([]),this.et="gltfmarker",this.st=!0,this.nt={get translation(){return[0,0,0]},get rotation(){return[0,0,0]},get scale(){return[1,1,1]}},this.it()}static parseJSONData(t){const e=J$2.fromJSON(t);return e.setZoomOnAdded(t.zoomOnAdded),e}static fromJSON(t){return new J$2(t.coordinates,t.options)}getMeshes(t,e,s){let n=[];const i=this.getMap();if(this.getLayer().isVisible()&&this.isVisible()&&this.D()){if(!this.j)return this.rt(t,e),n;this.ot(this.j,s),n=this.j.filter((t=>!!(intersectsBox(i.projViewMatrix,t.getBoundingBox())||t instanceof dt$6)&&(this.ht(t),this.ut(t),!0))),this.st=!1}return n}ct(){return this.lt}ft(t){this.lt=t}dt(t,e){this._externSymbol=this._externSymbol||{},this._externSymbol[t]=e,"uniforms"===t&&(this.pt=!0)}setUrl(t){return super.updateSymbol({url:t}),this.gt=!0,this}setSymbol(t){const e=this.getUrl(),s=this.getShader();super.setSymbol(t);const n=this.O;n&&t.url!==e&&(n.logoutGLTF(e),this.bt=!1,this.yt(!1),delete this.j),t.shader!==s&&this._t(n,this.regl),this.pt=!0,this.st=!0}getCenter(){const t=this.getMap();if(!t)return null;const e=S$3(t,super.getCenter()||this.getCoordinates());if(!e)return null;const s=this.xt(),n=new t$2.Point([e[0]+s[0],e[1]+s[1]]);return t.pointAtResToCoord(n,t.getGLRes())}getPointZ(){const t=this.getCoordinates(),e=this.getMap();return e&&t?e.altitudeToPoint(t.z||0,e.getGLRes()):null}getUrl(){const t=this._getInternalSymbol();return t&&t.url||"pyramid"}addTo(t){if(this.getLayer())throw new Error("GLTFMarker cannot be added to two or more layers at the same time.");return t.addGeometry(this),this}rt(t,e){const s=this.getUrl();this.O=t,this.bt||(t.loginGLTF(s),this.bt=!0);const n=t.getGLTF(s);n&&!n.then&&(this.yt(!0),this.wt(n,t,e))}ht(t,e){"effectmarker"===this.getGLTFMarkerType()?this.updateUV(e):"glowmarker"===this.getGLTFMarkerType()&&this.vt();const s=this.getUniforms();if(s&&this.isDirty()&&this.Tt())for(const e in s)t.material.set(e,s[e]);this.W()&&(t.transparent=!0),t.bloom=+!!this.isBloom(),"wireframe"===this.getShader()&&s&&s.dashAnimate&&t.material.set("time",e/1e3),t.setUniform("uPickingId",this.Ot()),t.properties.isAnimated=this.isAnimated(),this.St(t)}ut(t){const e=this.getShader(),s=t.getDefines();if("pbr"===e){const t=this.getLayer(),{iblTexes:e}=Fm.PBRUtils.getIBLResOnCanvas(t.getRenderer().canvas);e?s.HAS_IBL_LIGHTING=1:delete s.HAS_IBL_LIGHTING}const i=this.getLayer().getRenderer();if(i){const t=i.getMaskUniforms();if(t&&Object.keys(t).length>0){const t=i.getMaskDefines();t$2.Util.extend(s,t)}else delete s.HAS_MASK_EXTENT}t.setDefines(s)}_t(t,e){const s=this.getShader(),n=this.getUrl(),i=this.j;if(!t||!i)return;if(this.regl=e,t.isSimpleModel(n))return"wireframe"===s&&i.forEach((t=>{this.Mt(t.properties.geometryResource,e),this.ht(t)})),void this.At(i);const r=t.getGLTF(n);r&&("wireframe"===s&&r.resources.forEach((t=>{this.Mt(t,e)})),i.forEach((t=>{this.ht(t)})),this.At(i))}At(t){const e=this.getShader();t.forEach((t=>{const s=this.Et(t.properties.geometryResource);t.geometry="wireframe"===e?t.properties.geometryResource.copyGeometry:t.properties.geometryResource.geometry,t.material=s}))}Mt(t,e){t.copyGeometry.data.aBarycentric||(t.copyGeometry.buildUniqueVertex(),t.copyGeometry.createBarycentric("aBarycentric"),e?t.copyGeometry.generateBuffers(e):(this.k=this.k||[],this.k.push(t.copyGeometry)))}ot(t,e){const s=[],n=[],i=this.isAnimated();this.it();const r=this.getModelMatrix();multiply$5(r,r,G$2);const{nodeMatrixMap:o,skinMap:a}=this.It(e),h=this.getMap(),c=this.Pt(D$3),f=this.Y()||q$2;if(multiply$4(s,f,c),"gltf"===this.getLayer().getGltfCoordinateSystem()){const t=h.distanceToPointAtRes(1,0,h.getGLRes());scale$4(s,s,t.x)}t.forEach((t=>{const e=t.properties.geometryResource.nodeIndex,h=o[e],c=i&&h?h:t.nodeMatrix;if(t instanceof dt$6){scale$5(n,r,s);const e=multiply$5(t.positionMatrix,n,c);t.positionMatrix=e,t.localTransform=this.kt()}else{scale$5(n,r,s);const e=multiply$5(t.localTransform,n,c);t.localTransform=e}if(i){const s=a[e];s&&(t.material.set("skinAnimation",1),t.material.set("jointTextureSize",s.jointTextureSize),t.material.set("numJoints",s.numJoints),t.material.set("jointTexture",s.jointTexture));const n=t.geometry.properties.morphWeights;n&&this.Nt(n,t.material)}else t.material.set("skinAnimation",0)})),this.Rt(t)}It(t){const e=this.isAnimated(),s=this.Ct(),n={},i=this.Lt();if(t&&e&&this.gltfPack&&s){const e=this.Bt();if(T$3(e)){this.Ft(t);const s=this.Ut(),r=this.isAnimationLooped(),o=this.getAnimationSpeed();this.gltfPack.updateAnimation(t,r,o,e,s,n,i)}else console.warn("animation specified does not exist!")}return{nodeMatrixMap:n,skinMap:i}}Pt(t){const e=this.getMap();t[0]=t[1]=t[2]=1;const s=this.getSymbol(),i=s&&s.fixSizeOnZoom;if(t$2.Util.isNumber(i))if(i>=0){let s=e.getGLScale()/e.getGLScale(i);s*=this.Vt(),set$4(t,s,s,s),this.Dt(s)}else{const e=this.jt();set$4(t,e,e,e),this.qt(e)}return t}Rt(t){const e=this.Gt(t);if(!e)return;const s=this.zt(this.Z()||[],e);t.forEach((t=>{if(t instanceof dt$6){t.positionMatrix[12]+=s[0],t.positionMatrix[13]+=s[1],t.positionMatrix[14]+=s[2];t.positionMatrix=t.positionMatrix,this.Xt(t)}else{t.localTransform[12]+=s[0],t.localTransform[13]+=s[1],t.localTransform[14]+=s[2];t.localTransform=t.localTransform}}))}wt(t,e,s){const n=this.getUrl();this.ft(t.json),this.Jt(n,e,s),this._t(e,s),this.fire("load",{data:t.json}),this.fire("setUrl-debug"),this._fireEvent("meshcreate",{url:n})}Jt(t,e,s){const n=[],i=this.getShader(),r=e.getGLTF(t);if(r&&r.resources){if(!r.resources.length)return void this._fireEvent("modelerror",{url:t,info:"there are no geomtries in the gltf model"});this.gltfPack=r.gltfPack,r.resources.forEach((t=>{const e=this.Ht(t,i,s);n.push(e)}))}this.j&&this.Kt(),this.j=n,this.Y()?this.Y()&&(this.Wt([1,1,1]),this.Yt([0,0,0]),this.Zt(this.j)):this.Zt(this.j),this.fire("createscene-debug",{meshes:this.j})}Kt(){const t=this.Gt(this.j);this.K=t;const e=subtract$2(B$3,t.max,t.min);divide$2(e,e,this.getScale());const s=Math.max(...e)/this.getMap().getGLScale(this.getZoomOnAdded());this.$t(s)}Zt(t){this.ot(t);let e=this.Gt(t);if(!e)return;const s=this.Qt(this.Y()||[],e);this.te=s,this.ot(t),e=this.Gt(t),e&&(this.zt(this.Z()||[],e),this.K=e)}Qt(t,e){let s=1;if("map"===this.getLayer().getGltfCoordinateSystem()){const n=this.getScale(),i=subtract$2(t,e.max,e.min);divide$2(i,i,n);const r=Math.max(...i);let o=null;o=this.Y()&&this.ee()?this.ee():this.se(),s=function(t,e,s){return e*t.getGLScale(s)}(this.getMap(),o,this.getZoomOnAdded())/r}return set$4(t,s,s,s)}zt(t,e){if("map"===this.getLayer().getGltfCoordinateSystem()){const s=this.getPointZ()||0;if("multigltfmarker"===this.getGLTFMarkerType())return set$4(t,0,0,-e.min[2]+s);if(!this.ne()){const t=this.Z();return set$4(j$2,0,0,s),add$4(j$2,j$2,t)}const n=this.getAnchorZ()||"bottom";let i=0;"bottom"===n?i=-e.min[2]:"top"===n?i=-e.max[2]:"center"===n&&(i=-(e.min[2]+e.max[2])/2);const r=this.getModelMatrix(),o=this.xt();set$4(t,-(e.min[0]+e.max[0])/2+r[12],-(e.min[1]+e.max[1])/2+r[13],i+o[2]),this.gt=!1,this.Yt(t);const a=copy$4(j$2,t);return a[2]+=s,a}return t[0]=t[1]=t[2]=0,this.Yt(t),t}Gt(t){if(!t||!t.length)return null;if(!this.ne())return this.K;"multigltfmarker"===this.getGLTFMarkerType()&&t.forEach((t=>{this.Xt(t),t.updateBoundingBox()}));const e=t[0].getBoundingBox(),s=copy$4([],e[0]),n=copy$4([],e[1]);for(let e=1;e<t.length;e++){const i=t[e].getBoundingBox(),r=copy$4([],i[0]),o=copy$4([],i[1]);r[0]<s[0]&&(s[0]=r[0]),r[1]<s[1]&&(s[1]=r[1]),r[2]<s[2]&&(s[2]=r[2]),o[0]>n[0]&&(n[0]=o[0]),o[1]>n[1]&&(n[1]=o[1]),o[2]>n[2]&&(n[2]=o[2])}return{min:s,max:n}}ne(){if(!this.K)return!0;const t=this.getSymbol(),e=t&&t.fixSizeOnZoom;if(this.gt)return!0;const s=this.getLayer().getMap();return!(e>0&&!s.isZooming())}Ht(t,e,s){const n=t;n.copy(),"wireframe"===e&&n.createCopyBarycentric();const i=this.ie(n,e,s),r=i.getDefines();return i instanceof dt$6?(r.HAS_PICKING_ID=1,r.HAS_INSTANCE_COLOR=1):r.HAS_PICKING_ID=2,i.geometry.data.COLOR_0&&(r.HAS_COLOR0=1),n.extraInfo&&"MASK"===n.extraInfo.alphaMode&&(r.HAS_ALPHAMODE=1),i.setDefines(r),i}ie(t,e,s){const n=this.getGLTFMarkerType();let i=null;const r=this.Et(t),o="wireframe"===e?t.copyGeometry:t.geometry;if(s?o.generateBuffers(s):(this.k=this.k||[],this.k.push(o)),"multigltfmarker"===n){this.re();const t=this.oe(identity$2(V$3)),e=this.getCount();i=new dt$6(t,e,o,r),i.setUniform("instance",1),s?i.generateInstancedBuffers(s):(this.P=this.P||[],this.P.push(i))}else i=new ft$6(o,r),i.setUniform("instance",0);i.nodeMatrix=copy$5([],t.nodeMatrix),i.properties.geometryResource=t,this.isBloom()&&(i.bloom=1),i.transparent=this.W();const a=t.extraInfo;return"BLEND"!==a.alphaMode&&"MASK"!==a.alphaMode||(i.transparent=!0),i.properties.pickingId=this.Ot(),this.St(i),i}Et(t){let e=null;const s=this.getShader(),n=this.getUniforms()||{},i=t.materialInfo||{},r=this.getLayer().getRenderer();if("phong"===s)if("pbrSpecularGlossiness"===i.name)e=new lt$6(i);else{for(const t in X$2)n[t]=n[t]||X$2[t];e=new rt$6(i)}else if("wireframe"===s)e=new nt$6(i);else if("pbr"===s){if(e="pbrSpecularGlossiness"===i.name?new Fm.StandardSpecularGlossinessMaterial(i):new Fm.StandardMaterial(i),r.regl&&!Fm.PBRUtils.isSupported(r.regl)){e=rt$6.convertFrom(e);for(const t in X$2)n[t]=n[t]||X$2[t]}}else e=new tt$6(i);e.doubleSided=t.extraInfo&&t.extraInfo.doubleSided?1:0;for(const t in n)e.set(t,n[t]);return t.morphWeights&&this.Nt(t.morphWeights,e),t.skin&&e.set("skinAnimation",0),e}Nt(t,e){const s=e.get("morphWeights1")||[],n=e.get("morphWeights2")||[];for(let e=0;e<4;e++)s[e]=t[e]||0,n[e]=t[e+4]||0;e.set("morphWeights1",s),e.set("morphWeights2",n)}St(t){const e=this.getSymbol();e&&e.uniforms?(t.setUniform("polygonFill",e.uniforms.polygonFill||z$2),t.setUniform("polygonOpacity",void 0===e.uniforms.polygonOpacity?1:e.uniforms.polygonOpacity),t.setUniform("lineColor",e.uniforms.lineColor||z$2),t.setUniform("lineOpacity",void 0===e.uniforms.lineOpacity?1:e.uniforms.lineOpacity)):(t.setUniform("polygonFill",z$2),t.setUniform("polygonOpacity",1),t.setUniform("lineColor",z$2),t.setUniform("lineOpacity",1))}ae(){const t=this.getLayer();if(!t)return;const e=t.getMap();if(!e)throw Error("marker has not been added to map");const n=this.Gt(this.j);if(!n)return null;const i=this.getPointZ()||0,o=n.min,a=n.max,h=set$3(F$3,(o[0]+a[0])/2,(o[1]+a[1])/2,o[2]+i,1),u=set$3(U$2,(o[0]+a[0])/2,(o[1]+a[1])/2,a[2]+i,1),c=transformMat4$1(h,h,e.projViewMatrix),l=transformMat4$1(u,u,e.projViewMatrix),f=(c[0]/c[3]+1)*e.width/2,d=(1-c[1]/c[3])*e.height/2,p=(l[0]/l[3]+1)*e.width/2,g=(1-l[1]/l[3])*e.height/2,b=Math.min(f,p),y=Math.max(f,p),_=Math.min(d,g),x=Math.max(d,g);return new t$2.Extent({xmin:b,ymin:_,xmax:y,ymax:x})}onAdd(){const t=this.getLayer().getMap();if(t&&!T$3(this.he)){const e=t.getZoom();this.he=e}}onRemove(){this.ue()}remove(){const t=this.getUrl();this.O&&(delete this.j,this.O.logoutGLTF(t),delete this.O),delete this.lt,delete this.gltfPack,super.remove()}show(){return super.updateSymbol({visible:!0}),this}hide(){super.updateSymbol({visible:!1})}setBloom(t){return super.updateSymbol({bloom:t}),this}isBloom(){const t=this._getInternalSymbol();return t&&t.bloom}setCastShadow(t){return super.updateSymbol({shadow:t}),this}isCastShadow(){const t=this._getInternalSymbol();return t&&t.shadow}outline(){return this.ce=!0,this.st=!0,this}cancelOutline(){return this.ce=!1,this.st=!0,this}isOutline(){return this.ce}isVisible(){const t=this._getInternalSymbol();return!t||!T$3(t.visible)||t.visible}setCoordinates(t){return super.setCoordinates(t),this.nt&&this.it(),this.st=!0,this}copy(){const t=this.toJSON(),e=J$2.fromJSON(t);return e.setZoomOnAdded(this.he),e}setShader(t){return super.updateSymbol({shader:t}),this}getShader(){const t=this._getInternalSymbol();return t&&t.shader||"pbr"}setUniforms(t){return super.updateSymbol({uniforms:t}),this.pt=!0,this}getUniforms(){const t=this._getInternalSymbol();return t&&t.uniforms}setUniform(t,e){const s=this.getUniforms()||{};return s[t]=e,super.updateSymbol({uniforms:s}),this.pt=!0,this}getUniform(t){const e=this._getInternalSymbol();return e&&e.uniforms&&e.uniforms[t]}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation&&this.lt&&this.lt.animations}isDashAnimated(){const t=this._getInternalSymbol();return t&&t.uniforms&&t.uniforms.dashEnabled&&t.uniforms.dashAnimate}setAnimation(t){return super.updateSymbol({animation:t}),delete this.le,this}setAnimationLoop(t){return super.updateSymbol({loop:t}),delete this.le,this.st=!0,this}isAnimationLooped(){const t=this._getInternalSymbol();return t&&t.loop}getAnimationSpeed(){const t=this._getInternalSymbol();return t&&T$3(t.speed)?t.speed:1}setAnimationSpeed(t){return super.updateSymbol({speed:t}),this}fe(t){const e=this.getMap();return e?S$3(e,t||this.getCoordinates()):null}setTRS(t,e,s){const n=t||this.nt.translation;return super.updateSymbol({translationX:n[0],translationY:n[1],translationZ:n[2],rotationX:e[0],rotationY:e[1],rotationZ:e[2],scaleX:s[0],scaleY:s[1],scaleZ:s[2]}),this.it(),this.de=!0,this}me(){const t=this.xt(),e=this.fe();return e?add$4(t,t,e):t}setTranslation(t,e,s){return super.updateSymbol({translationX:t,translationY:e,translationZ:s}),this.it(),this}setRotation(t,e,s){return super.updateSymbol({rotationX:t,rotationY:e,rotationZ:s}),this.it(),this}setScale(t,e,s){return super.updateSymbol({scaleX:t,scaleY:e,scaleZ:s}),this.it(),this.gt=!0,this}getTranslation(){const t=this._getInternalSymbol();return set$4(this.nt.translation,t&&t.translationX||0,t&&t.translationY||0,t&&t.translationZ||0)}xt(){const t=this.getTranslation(),e=this.getMap();if(!e)return this.nt.translation;const s=e.distanceToPointAtRes(t[0],t[1],e.getGLRes()),n=e.altitudeToPoint(t[2],e.getGLRes());return set$4([],M$3(s.x,t[0]),M$3(s.y,t[1]),M$3(n,t[2]))}getRotation(){const t=this._getInternalSymbol();return set$4(this.nt.rotation,t&&t.rotationX||0,t&&t.rotationY||0,t&&t.rotationZ||0)}getScale(){const t=this._getInternalSymbol();return set$4(this.nt.scale,t&&t.scaleX||1,t&&t.scaleY||1,t&&t.scaleZ||1)}setFixSizeOnZoom(t){return super.updateSymbol({fixSizeOnZoom:t}),this}getFixSizeOnZoom(){const t=this._getInternalSymbol();return t&&t.fixSizeOnZoom}cancelFixSize(){return this.setFixSizeOnZoom(-1)}setAnchorZ(t){return super.updateSymbol({anchorZ:t}),this}getAnchorZ(){const t=this._getInternalSymbol();return t&&t.anchorZ||"bottom"}_setExternSymbol(t){return this.st=!0,super._setExternSymbol(t)}pe(t){return loadFunctionTypes(t,(()=>{const t=this.getMap();return t?[t.getZoom()]:null}))}_prepareSymbol(t){super._prepareSymbol(t);const e=this.pe(t);return e&&e.uniforms&&(e.uniforms=this.pe(t.uniforms)),delete this.ge,e}hasFunctionDefinition(){if(T$3(this.ge))return this.ge;const t=this._getInternalSymbol();return this.ge=hasFunctionDefinition(t)||t&&t.uniforms&&hasFunctionDefinition(t.uniforms),this.ge}onSymbolChanged(){super.onSymbolChanged(),this.nt&&this.it()}setModelMatrix(t){const e=getTranslation$1(this.nt.translation,t),s=getRotation(this.nt.rotation,t),n=getScaling(this.nt.scale,t);return this.setTranslation(e[0],e[1],e[2]),this.setRotation(s[0],s[1],s[2]),this.setScale(n[0],n[1],n[2]),this}getModelMatrix(){return this.tt}it(){const t=this.me(),e=this.getRotation(),s=fromEuler(L$3,e[0],e[1],e[2]),n=this.getScale();this.tt=fromRotationTranslationScale(this.tt,s,t,n)}isDirty(){return this.st}be(t){return this.st=t,this}on(t,e,s){super.on(t,e,s||this),this.getLayer()&&this.getLayer().ye(t)}off(t,e,s){super.off(t,e,s||this),this.getLayer()&&this.getLayer()._e()}xe(){const t=this.toJSON();return t.zoomOnAdded=this.he,t}toJSON(){const t=JSON.parse(JSON.stringify({coordinates:this.getCoordinates(),options:this.options||{}})),e=this.getId();t$2.Util.isNil(e)||(t.options.id=e);const s=this.getProperties();s&&(t.options.properties=JSON.parse(JSON.stringify(s)));const i=this.getSymbol();return i&&(t.options.symbol=JSON.parse(JSON.stringify(i))),t}setZoomOnAdded(t){this.he=t}getZoomOnAdded(){return this.he}W(){return this.D()<1}D(){const t=this.getUniforms(),e=this.getShader();return"phong"===e||"wireframe"===e?t&&T$3(t.opacity)?t.opacity:1:"pbr"===e&&t&&T$3(t.polygonOpacity)?t.polygonOpacity:1}yt(t){this.$=t}isLoaded(){return this.$}getGLTFMarkerType(){return this.et}we(t){this.ve=t}Ot(){return this.ve}getCount(){return 1}Wt(t){this.te=t}Y(){return this.te}Yt(t){this.Te=t}Z(){return this.Te}getContainerExtent(){return this.ae()}getGLTFAsset(){return this.lt&&this.lt.asset}openInfoWindow(t){this.lt?super.openInfoWindow(t):this.once("load",(()=>{super.openInfoWindow(t)}))}getAnimations(){if(!this.lt)return null;const t=this.lt.animations;return t?t.map(((t,e)=>t.name||e)):null}getCurrentAnimation(){const t=this._getInternalSymbol();return t&&t.animationName}Bt(){const t=this.getAnimations();if(!t)return null;const e=this.getCurrentAnimation();return T$3(e)?t.indexOf(e)>-1?e:void 0:t[0]}setCurrentAnimation(t){this.updateSymbol({animationName:t})}Ft(t){T$3(this.le)||(this.le=t)}Ut(){return this.le||0}Lt(){this.Oe=this.Oe||{};for(const t in this.Oe)this.Oe[t].jointTexture.destroy(),delete this.Oe[t];return this.Oe}Dt(t){this.Se=t}jt(){return this.Se||1}qt(t){this.Me=t}Vt(){return this.Me||1}$t(t){this.Ae=t}ee(){return this.Ae}Ee(){return this.de}Ie(){this.de=!1}Tt(){return this.pt}Pe(){this.pt=!1}setAnimationTimeframe(t){const e=this.Ut(),s=this.Lt();this.gltfPack.updateAnimation(t,this.isAnimationLooped(),this.getAnimationSpeed(),e,{},s)}se(){return this.options.fitSize||100}ue(){delete this.K,delete this.ke,delete this.he,delete this.te,delete this.Te,delete this.Se,delete this.Me,delete this.Ae}Ct(){return"effectmarker"!==this.getGLTFMarkerType()&&"glowmarker"!==this.getGLTFMarkerType()}}J$2.mergeOptions({symbol:null}),J$2.registerJSONType("GLTFMarker");const H$3=/\{ *([\w_]+) *\}/g;class K$2 extends J$2{constructor(t,e){super(t,e),this.et="effectmarker"}static fromJSON(t){return new K$2(t.coordinates,t.options)}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation}setTexture(t){const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const s=this.getTextureUrl();e.Ne(s),e.Re(t)}return super.updateSymbol({textureUrl:t}),this}Ce(t){const e=this.getTextureUrl(),s=this.getLayer()&&this.getLayer().getRenderer();if(s){let n=e;const i=this.Le();if(i){const s=this.isAnimationLooped(),r=this.getAnimationSpeed()||1,o=s?Math.floor(.01*t*r)%i.length:Math.floor(.01*t);n=e.replace(H$3,i[o]),this.setUniform("width",1),this.setUniform("height",1),this.setUniform("uvOffset",[0,0])}return s.Be(n,this.Ot())}return null}Le(){const t=this._getInternalSymbol();return t&&t.textureNames}getTextureUrl(){const t=this._getInternalSymbol();return t&&t.textureUrl||"default"}getUrl(){return"plane"}getShader(){return"effect"}setTransparent(t){return this.options.symbol.transparent=t,this}isTransparent(){return this.options.symbol.transparent}updateUV(t){const e=this.isAnimationLooped(),s=this.getAnimationSpeed()||1,n=this.getUniforms()||{},i=n.width||1,r=n.height||1;let o;const a=this.getEffectType();"uv"===a?o=e?.01*t*s%(i*r):.01*t:"sequence"===a&&(o=e?Math.floor(.01*t*s)%(i*r):Math.floor(.01*t));const h=Number(o%i),u=Math.floor(o/i),c=this.Ce(t);this._getSymbol()?(this.setUniform("uvOffset",[h,u]),this.setUniform("width",i),this.setUniform("height",r),this.setUniform("texture",c)):this.dt("uniforms",{uvOffset:[h,u],width:i,height:r,texture:c})}_setExternSymbol(t){super._setExternSymbol(t);const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const t=this.getTextureUrl();e.Re(t)}}getEffectType(){const t=this._getInternalSymbol();return t&&t.effect||"uv"}setEffectType(t){return this._getInternalSymbol().effect=t,this}remove(){const t=this.getLayer()&&this.getLayer().getRenderer();if(t){const e=this.getTextureUrl();t.Ne(e)}super.remove()}}const W$2=["Point","Polygon","LineString","MultiPoint","MultiPolygon","MultiLineString","GeometryCollection","Feature","FeatureCollection"].reduce(((t,e)=>(t[e]=!0,t)),{}),Y$1={toGeometry:function(t,e){if(t$2.Util.isString(t)&&(t=t$2.Util.parseJSON(t)),Array.isArray(t)){const s=[];for(let i=0,r=t.length;i<r;i++){const r=Y$1.Fe(t[i],e);Array.isArray(r)?t$2.Util.pushIn(s,r):s.push(r)}return s}return Y$1.Fe(t,e)},Fe:function(t,e){if(!t||t$2.Util.isNil(t.type))return null;const s=t.type;if("Feature"===s){const n=Y$1.Fe(t.geometry,e);return n?(n.setId(t.id),n.setProperties(t.properties),n):null}if("FeatureCollection"===s){const s=t.features;return s?Y$1.toGeometry(s,e):null}if("Point"===s)return function(t,e){return"EffectLayer"===e?new K$2(t):new J$2(t)}(t.coordinates,e);if("GeometryCollection"===s){const s=t.geometries,n=[],i=s.length;for(let t=0;t<i;t++)n.push(Y$1.Fe(s[t],e));return n}throw new Error("geometry's type is invalid, only support type of Point")},isGeoJSON:function(t){return!(!t||"object"!=typeof t||!t.type||!W$2[t.type]||t instanceof t$2.Geometry)}},Z$2=["mousedown","mouseup","mousemove","contextmenu","click","dbclick","touchstart","touchmove","touchend"],$$2=/\{*(\$root)*\}/g;class Q$2 extends t__namespace.OverlayLayer{constructor(e,s,n){!s||s instanceof t__namespace.Geometry||Array.isArray(s)||W$2[s.type]||(n=s,s=null),super(e,null,n),this.pickingId=0,this.Ue={},this.Ve={},this.De={},this.mapEvents="";this.setStyle(n&&n.style),s&&this.addGeometry(s)}static registerShader(t,e,s,n){A$1[t]={name:t,type:e,config:s,uniforms:n}}static removeShader(t){delete A$1[t]}static getShaders(){const t=[];for(const e in A$1)t.push({shader:e,uniforms:A$1[e].uniforms});return t}static getShaderMap(){return A$1}addGeometry(t,e){let s=Y$1.isGeoJSON(t)?Y$1.toGeometry(t,this.getJSONType()):t;s=Array.isArray(s)?s:[s];for(let t=0;t<s.length;t++)if(!this.je(s[t]))return void console.error("type of geometry is invalid");super.addGeometry(s,e),Array.isArray(s)&&this.addMarker(s)}addMarker(t){for(let e=0;e<t.length;e++){const s=t[e];s.we(this.pickingId),this.Ue[this.pickingId]=s,this.ye(s.getListeningEvents());const n=s.getId();n&&(this.De[n]=s),s.fire("add",{type:"add",target:s,layer:this}),"multigltfmarker"===s.getGLTFMarkerType()?this.pickingId+=s.getCount():this.pickingId++}}qe(t){const e=this.getRenderer();e&&e.loginGLTFMarker(t)}toJSON(t){t||(t={});const e={type:this.getJSONType(),id:this.getId(),options:this.config()};if((v$2(t.style)||t.style)&&(e.style=this.getStyle()),v$2(t.geometries)||t.geometries){const t=[],s=this._geoList;for(let e=0;e<s.length;e++){const n=s[e].xe();t.push(n)}e.geometries=t}return e}je(t){return!!t.getGLTFMarkerType&&this.options.markerTypes.indexOf(t.getGLTFMarkerType())>-1}setStyle(t){return t?(this.options.style=t,this.Ge=JSON.parse(JSON.stringify(t)),this.ze(),this.fire("setstyle",{target:this,style:this.Ge}),this):(delete this.Ge,delete this.options.style,this)}getStyle(){return this.options.style}updateSymbol(t,e){const s=this.getStyle();this.Xe(t,e,s),this.Xe(t,e,this.Ge),this.ze(),this.fire("updatesymbol",{target:this,index:t,symbol:e})}Xe(t,e,s){if(!s)return;const n=(s.style?s.style:s)[t].symbol||{};for(const t in e)n[t]=e[t]}ze(){this._processRootUrl(this.Ge);this.Je=compileStyle(this.Ge.style?this.Ge.style:this.Ge),this._geoList.forEach((function(t){this.He(t)}),this)}getGLTFUrls(){return Object.keys(this.Ve)}ye(e){const s=t__namespace.Util.isString(e)?e.split(/\s+/).map((t=>"mouseleave"===t||"mouseenter"===t||"mouseout"===t?"mousemove":t)):e;let n=this.mapEvents;const i=O$3(s,Z$2).filter((t=>this.mapEvents.indexOf(t)<0));this.mapEvents+=" "+i.join(" "),this.mapEvents=this.mapEvents.trim();const r=this.mapEvents.replace(" "," dom:");n=n.replace(" "," dom:");const o=this.getMap();o&&(o.off("dom:"+n,this.Ke,this),o.on("dom:"+r,this.Ke,this))}_e(){const t={};let e=this.mapEvents;const s=this._geoList;for(let e=0;e<s.length;e++){const n=s[e].getListeningEvents().map((t=>"mouseleave"===t||"mouseenter"===t||"mouseout"===t?"mousemove":t));for(let e=0;e<n.length;e++)t[n[e]]=1}this.mapEvents=O$3(Object.keys(t),Z$2).join(" ");const n=this.mapEvents.replace(" "," dom:");e=e.replace(" "," dom:");const i=this.getMap();i&&(i.off("dom:"+e,this.Ke,this),i.on("dom:"+n,this.Ke,this))}_processRootUrl(e){t__namespace.Util.isString(e.$root)&&e.style.forEach((t=>{const s=t.symbol.url;s&&s.indexOf("{$root}")>-1&&(t.symbol.url=s.replace($$2,e.$root))}))}He(t){if(!this.Je)return!1;for(let e=0,s=this.Je.length;e<s;e++)if(!0===this.Je[e].filter({properties:t.getProperties()})){const s=this.Je[e].symbol;return t.dt("url",s.url),t.updateSymbol(s),!0}return!1}We(t){if(this.Je)for(let e=0,s=this.Je.length;e<s;e++)!0===this.Je[e].filter({properties:t.getProperties()})&&this.Je[e].outline&&t.outline()}removeGeometry(t){this._e(),super.removeGeometry(t)}getMapEvents(){return this.mapEvents}Ye(e){const s=t__namespace.Util.isString(e)?this.De[e].Ot():e.Ot(),n=this.getRenderer();n&&n.Ze(s),delete this.Ue[s],delete this.De[e]}clear(){return super.clear(),this.Ue={},this.De={},this}H(){return this.Ue}X(t,e,s){const n=this.getRenderer();return n?n.X(t,e,s):null}$e(){const t=this._geoList;for(let e=0;e<t.length;e++)if(!t[e].isLoaded())return!1;return!0}ae(t){const e=this.getRenderer();return e?e.ae(t):null}Ke(t){if(!this.options.markerEvents)return;const e=this.getMap();if(!e)return;this.Qe=this.ts,this.es=this.ss,this.ns=this.rs,this.os=this.as,this.hs=this.us;const s=t.containerPoint,n=Math.round(s.x),i=Math.round(s.y);if(n<=0||n>=e.width||i<=0||i>=e.height)return this.ts=null,this.as=null,void(this.rs=null);const r=this.X(n,i);if(!r)return;r.coordinate=t.coordinate,this.ts=null,r.target&&"gltfmarker"===r.target.getGLTFMarkerType()?this.ts=r.target.Ot():r.target&&"multigltfmarker"===r.target.getGLTFMarkerType()&&(this.ts=r.target.Ot()+r.index),this.ss=r.target?r.index:null,this.as=r.meshId,this.rs=JSON.stringify(r.point),this.us=r.pickingId;const o=t.type.replace("dom:","");"mousemove"===o?this.cs().forEach((t=>{t.target.getIndexByPickingId&&(t.index=t.target.getIndexByPickingId(t.pickingId)),t.target.fire(t.type,t)})):r.target&&r.target.fire(o,r)}cs(){const t=[];return T$3(this.ts)&&!T$3(this.Qe)?t.push({type:"mouseenter",target:this.ls(this.ts,0),meshId:this.as,pickingId:this.us,point:JSON.parse(this.rs)}):!T$3(this.ts)&&T$3(this.Qe)?t.push({type:"mouseout",target:this.ls(this.Qe,1),meshId:this.os,pickingId:this.hs,point:JSON.parse(this.ns)},{type:"mouseleave",target:this.ls(this.Qe,1),meshId:this.os,pickingId:this.hs,point:JSON.parse(this.ns)}):T$3(this.ts)&&T$3(this.Qe)&&(this.ts===this.Qe?t.push({type:"mousemove",target:this.ls(this.ts,0),meshId:this.as,pickingId:this.us,point:JSON.parse(this.rs)}):t.push({type:"mouseenter",target:this.ls(this.ts,0),meshId:this.as,pickingId:this.us,point:JSON.parse(this.rs)},{type:"mouseout",target:this.ls(this.Qe,1),meshId:this.os,pickingId:this.hs,point:JSON.parse(this.ns)},{type:"mouseleave",target:this.ls(this.Qe,1),meshId:this.os,pickingId:this.hs,point:JSON.parse(this.ns)})),t}ls(t,e){if(T$3(t)){if(e<1){return this.Ue[t-(this.ss||0)]}return this.Ue[t-(this.es||0)]}}_t(t){const e=this.getRenderer();e&&e._t(t)}outlineBatch(t){const e=this.Ge.style?this.Ge.style:this.Ge;e[t].outline=!0,this.Je=compileStyle(e),this._geoList.forEach((t=>{this.We(t)}))}outlineAll(){this._geoList.forEach((t=>{t.outline()}))}cancelOutline(){this.Ge&&(this.Ge.style?this.Ge.style:this.Ge).forEach((t=>{delete t.outline})),this._geoList.forEach((t=>{t.cancelOutline()}))}setGltfCoordinateSystem(t){this.options.gltfCoordinateSystem=t}getGltfCoordinateSystem(){return this.options.gltfCoordinateSystem}}Q$2.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,gltfCoordinateSystem:"map"});class tt$1 extends(fe$4(Q$2)){static initDefaultShader(){const t={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new rt$6};tt$1.registerShader("phong","PhongShader",t.shader,t.material.getUniforms());const e={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{cull:{enable:!1,face:"back"},frontFace:"cw",blend:{enable:!1,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new nt$6};tt$1.registerShader("wireframe","WireframeShader",e.shader,e.material.getUniforms());const s={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",tangentAttribute:"TANGENT",colorAttribute:"COLOR_0",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",extraCommandProps:{cull:{enable:!0},frontFace:"ccw",blend:{enable:(t,e)=>!!e.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}},material:new Fm.StandardMaterial({})};tt$1.registerShader("pbr","pbr.StandardShader",s.shader,s.material.getUniforms()),tt$1.registerShader("depth","pbr.StandardDepthShader",s.shader,s.material.getUniforms());const n={shader:{positionAttribute:"POSITION",color0Attribute:"COLOR_0",extraCommandProps:{blend:{enable:!1,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new tt$6};tt$1.registerShader("pointline","PointLineShader",n.shader,n.material.getUniforms())}static fromJSON(t){if(!t||"GLTFLayer"!==t.type)return null;const e=new tt$1(t.id,t.options),s=t.geometries,n=[];for(let t=0;t<s.length;t++){const e=J$2.parseJSONData(s[t]);e&&n.push(e)}return e.addGeometry(n),t.style&&e.setStyle(t.style),e}onAdd(){const t=this.getMap();t.on(this.mapEvents,this.Ke,this),this._geoList.forEach((e=>{T$3(e.getZoomOnAdded())||e.setZoomOnAdded(t.getZoom())})),super.onAdd()}onRemove(){super.onRemove(),this.clear()}remove(){const t=this.getMap();if(!t)return;const e=this.mapEvents.replace(" "," dom:");t.off("dom:"+e,this.Ke,this),super.remove()}identify(e,s){const n=this.getMap();if(!n)return[];const i=n.coordinateToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(i,s)}identifyAtPoint(t,e){const s=this.getMap();if(!s)return[];const n=s.getDevicePixelRatio(),o=this.X(t.x*n,t.y*n,e);return o&&o.target?[{data:o.target,point:o.point}]:[]}fs(){this.pickingId=0;for(const t in this.Ue){const e=this.Ue[t],s=e.Ot();delete this.Ue[s],e.we(this.pickingId),this.Ue[this.pickingId]=e;const n=e.getCount();this.pickingId+=n}}_onGeometryEvent(t){if(!t||!t.target)return;const e=t.type;"meshcreate"===e?this.ds(t):"modelerror"===e&&this.ms(t),super._onGeometryEvent(t)}ms(t){const{url:e,info:s}=t;console.error(s),this.fire("modelerror",{type:"modelerror",url:e,info:s})}ds(t){this.Ve[t.url]=1,this.getRenderer().setToRedraw(),this.$e()&&this.fire("modelload",{models:this.getGLTFUrls()})}}tt$1.initDefaultShader(),tt$1.mergeOptions({markerTypes:["gltfmarker","multigltfmarker"],pointSize:1}),tt$1.registerJSONType("GLTFLayer"),tt$1.registerRenderer("gl",C$3);const et$1=[1,1,1,1],st$1=[],nt$1=[],it$1=[1,1,1],rt$1=new t$2.Coordinate(0,0);class ot$1 extends J$2{constructor(t,e){super(null,e),this.ps=t,this.gs=[],this.bs=[0,0,0],this.ys=identity$2([]),this.et="multigltfmarker"}static fromJSON(t){return new ot$1(t.data,t.options)}setCoordinates(t){return this._s=Array.isArray(t[0])?t.map((t=>new t$2.Coordinate(t))):t,this.updateAllData("coordinates",this._s),this.st=!0,this}getCoordinates(t){if(t&&this.ps&&this.ps.length){return this.ps[t.index].coordinates}return null}addData(t){this.ps.push(t);const e=this.getLayer();return e&&e.fs(),this.st=!0,this}removeData(t){return this.ps.splice(t,1),this.re&&this.gs.splice(t,1),this.st=!0,this}getData(t){return this.ps[t]}updateData(t,e,s){return this.ps[t][e]=s,this.st=!0,this}updateAllData(t,e){for(let s=0;s<this.ps.length;s++)this.updateData(s,t,e[s]);return this}re(){const t=this.getMap();if(this.ps&&t){this.xs(),this.gs=this.gs||[];for(let t=0;t<this.ps.length;t++){const e=this.ws(t);this.gs[t]=e}}}openInfoWindow(t){let e=null;e=T$3(t)&&this.ps[t]?this.ps[t].coordinates:this.getCenter(),super.openInfoWindow(e)}getCenter(){let t=0,e=0,s=0;for(let n=0,i=this.ps.length;n<i;n++){const i=this.ps[n].coordinates;t+=i.x,e+=i.y,s++}return 0===s?null:rt$1.set(t/s,e/s)}xs(){const t=this.getMap(),e=this.getCenter();this.bs=S$3(t,e);const s=fromEuler(nt$1,0,0,0);fromRotationTranslationScale(this.ys,s,this.bs,it$1)}ws(t){const e=this.ps[t],s=this.fe(e.coordinates);if(!s)return;const n=sub$2(st$1,s,this.bs),i=add$4(st$1,e.translation||this.nt.translation,n||this.nt.translation),r=e.rotation||this.nt.rotation,o=e.scale||this.nt.scale,a=fromEuler(nt$1,r[0]||0,r[1]||0,r[2]||0);return fromRotationTranslationScale(this.gs[t]||[],a,i,o)}it(){super.it(),this.re()}vs(){this.Ts&&this.Ts.instance_vectorA.length/4===this.gs.length||(this.Ts={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_color:[],aPickingId:[],aOutline:[]});for(let t=0;t<this.gs.length;t++){const e=this.gs[t];this.Os("instance_vectorA",t,e,0),this.Os("instance_vectorB",t,e,1),this.Os("instance_vectorC",t,e,2);const s=this.ps[t].color||et$1;this.Ts.instance_color[4*t]=s[0],this.Ts.instance_color[4*t+1]=s[1],this.Ts.instance_color[4*t+2]=s[2],this.Ts.instance_color[4*t+3]=s[3],this.Ts.aPickingId[t]=this.Ot()+t,this.Ts.aOutline[t]=this.ps[t].outline?1:0}return this.Ts}Xt(t){const e=this.oe();for(const s in e)t.updateInstancedData(s,e[s]);this.regl?t.generateInstancedBuffers(this.regl):(this.P=this.P||[],this.P.push(t)),t.instanceCount=this.getCount()}Os(t,e,s,n){this.Ts[t]&&s&&(this.Ts[t][4*e]=s[n],this.Ts[t][4*e+1]=s[n+4],this.Ts[t][4*e+2]=s[n+8],this.Ts[t][4*e+3]=s[n+12])}oe(t){return!this.st&&this.Ts?this.Ts:this.vs(t)}kt(){return this.ys}getCount(){return this.ps.length}toJSON(){const t=JSON.parse(JSON.stringify({data:this.ps,options:this.options})),e=this.getProperties();return t.options&&(t.options.properties=e),t}getIndexByPickingId(t){return t-this.Ot()}outline(t){return T$3(t)&&this.updateData(t,"outline",!0),this}cancelOutline(t){return T$3(t)&&this.updateData(t,"outline",!1),this}isOutline(){if(!this.ps||!this.ps.length)return!1;for(let t=0;t<this.ps.length;t++)if(this.ps[t].outline)return!0;return!1}}const at$1=new Vt$5({url:void 0,mag:"linear"});class ht$1 extends C$3{constructor(t){super(t),this._textureMap={}}Be(t){return this.regl&&this._textureMap[t]?this._textureMap[t].texture.getREGLTexture(this.regl):at$1}Re(t){if(this._textureMap[t])this._textureMap[t].count++;else{this.Ss=this.Ss||new gt$6;const s=new Vt$5({url:"default"===t?void 0:t,mag:"linear"},this.Ss);s.once("complete",(()=>{this.setToRedraw()}),this),this._textureMap[t]={count:1,texture:s}}}Ne(t){this._textureMap[t]&&(this._textureMap[t].count--,this._textureMap[t].count<1&&(this._textureMap[t].texture.dispose(),delete this._textureMap[t]))}}class ut$1 extends Q$2{static initDefaultShader(){const t={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new tt$6};ut$1.registerShader("effect","MeshShader",t.shader,t.material.getUniforms())}onAddGeometry(t){super.onAddGeometry(t);const e=t.getTextureUrl(),s=this.getRenderer();s?s.Re(e):this.on("renderercreate",(t=>{t.renderer.Re(e)}))}remove(){const t=this.getRenderer();t&&this._geoList.forEach((e=>{const s=e.getTextureUrl();t.Ne(s)})),super.remove()}clear(){const t=this.getRenderer();t&&this._geoList.forEach((e=>{const s=e.getTextureUrl();t.Ne(s)})),super.clear()}getTextureMapTest(){const t=this.getRenderer();return t?t._textureMap:null}}ut$1.initDefaultShader(),ut$1.mergeOptions({markerTypes:["effectmarker"]}),ut$1.registerJSONType("EffectLayer"),ut$1.registerRenderer("gl",ht$1);class ct$1 extends J$2{constructor(t,e){super(t,e),this.et="glowmarker"}static fromJSON(t){return new ct$1(t.coordinates,t.options)}getUrl(){return"plane"}setSpeed(t){this.setUniform("speed",t)}getSpeed(){return this._getInternalSymbol().uniforms.speed}getShader(){return"glowmarker"}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation}vt(){let t=this._getInternalSymbol().uniforms.time||0;t+=.01,this.setUniform("time",t)}}ct$1.mergeOptions({visible:!0});class lt$1 extends Q$2{static initDefaultShader(){const t=function(){const t={vert:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        attribute vec3 aPosition;\n        uniform mat4 projViewModelMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 positionMatrix;\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        #include <get_output>\n        void main(){\n            mat4 localPositionMatrix = getPositionMatrix();\n            vec4 localVertex = getPosition(aPosition);\n            vec4 position = localPositionMatrix * localVertex;\n            gl_Position = projViewModelMatrix * position;\n            vec4 worldPos = modelMatrix * position;\n            v_FragPos = worldPos.xyz;\n            v_center = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;\n        }\n    ",frag:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        #define pi 3.14159\n        const float dotsnb = 30.0; // Number of dots\n\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        uniform float time;\n        uniform float radius;\n        uniform vec3 color;\n        uniform float speed;\n        vec3 hsb2rgb(in vec3 c)\n        {\n            vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0,0.0,1.0 );\n            rgb = rgb*rgb*(4.0-2.0*rgb);\n            return c.z * mix( vec3(1.0), rgb, c.y);\n        }\n\n        void main()\n        {\n            float r = length(v_FragPos - v_center);\n            r = r*2.-1.;\n            if(r>radius) {\n                gl_FragColor = vec4(1.0,1.0,1.0, 0.0);\n            } else {\n                //vec3 color = hsb2rgb(vec3(fract(time*.1),.7,.4));\n                vec3 color = color;\n                float s = abs(sin(pow(r+5.0, 1.5)-time*speed+sin(r*0.9))*sin(r+.99));\n                color *= (abs(1./(s*10.8))-.01);\n                gl_FragColor = vec4(color, (color.x + color.y + color.z) / 1.0);\n            }\n        }\n    ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}],positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]}}};return{shader:t,material:new tt$6}}();lt$1.registerShader("glowmarker","MeshShader",t.shader,t.material.getUniforms())}}lt$1.initDefaultShader(),lt$1.mergeOptions({markerTypes:["glowmarker"]}),lt$1.registerJSONType("GlowMarkerLayer"),lt$1.registerRenderer("gl",C$3);const ft$1={url:"plane",animation:!0,loop:!0,rotation:[0,0,0],translation:[0,0,30],scale:[1,1,30]},dt$1={width:1,height:1,modelHeight:60,startOpacity:0,endOpacity:1};class pt$1 extends Q$2{static initDefaultShader(){const t={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        varying float vHeight;\n        void main()\n        {\n            vec4 worldPosition = modelMatrix * vec4(aPosition, 1.0);\n            gl_Position = projViewMatrix * worldPosition;\n            vHeight = worldPosition.z;\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n        uniform float modelHeight;\n        uniform float startOpacity;\n        uniform float endOpacity;\n        varying float vHeight;\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            float opacity = (endOpacity - startOpacity) * (1.0 - vHeight / modelHeight);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a * opacity;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new tt$6};pt$1.registerShader("effectline","MeshShader",t.shader)}}pt$1.initDefaultShader(),pt$1.mergeOptions({markerTypes:["effectmarker"]}),pt$1.registerJSONType("EffectLineLayer"),pt$1.registerRenderer("gl",ht$1);const gt$1={offsetX:0,offsetY:0,uReflectivity:.8,opacity:.9,color:[.9,0,0,1]};class yt$1 extends Q$2{static initDefaultShader(){const t=function(){const t={vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        attribute vec3 aNormal;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 normalMatrix;\n        uniform float offsetX;\n        uniform float offsetY;\n        varying vec2 uv;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            uv = vec2(aTexCoord.x + offsetX, aTexCoord.y + offsetY);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D effectTexture;\n        uniform vec3 uCameraPosition;\n        uniform mat4 viewMatrix;\n        uniform float uReflectivity;\n        uniform vec4 color;\n        uniform float opacity;\n\n        varying vec2 uv;\n\n        vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {\n            return normalize((vec4(dir, 0.0) * matrix).xyz);\n        }\n\n        const float GAMMA_FACTOR = 2.0;\n        vec4 GammaToLinear(in vec4 value, in float gammaFactor) {\n            return vec4(pow(value.xyz, vec3(gammaFactor)), value.w);\n        }\n\n        vec4 mixTexelToLinear(vec4 value) {\n            return GammaToLinear(value, float(GAMMA_FACTOR));\n        }\n\n        void main() {\n            vec4 texColor = texture2D(effectTexture, uv);\n            if (color.a == 0.0) {\n                discard;\n            }\n            vec4 mixColor = mixTexelToLinear(color);\n            texColor.rgb += mixColor.xyz * uReflectivity;\n            texColor.a*= opacity;\n            gl_FragColor = texColor;\n        }\n    ",uniforms:[{name:"normalMatrix",type:"function",fn:function(t,e){const s=[];return invert$2(s,e.modelMatrix),transpose(s,s),s}}],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}};return{shader:t,material:new tt$6}}();yt$1.registerShader("effectring","MeshShader",t.shader)}}yt$1.initDefaultShader(),yt$1.mergeOptions({markerTypes:["effectring"]}),yt$1.registerJSONType("EffectRingLayer"),yt$1.registerRenderer("gl",C$3);const _t$1={animation:!0,loop:!0,url:"plane",effect:"sequence",speed:1,scale:[1,1,1],rotation:[90,0,0]},xt$1={width:9,height:5};if(transcoders){const e=t__namespace.Map.VERSION;if(e.indexOf("1.0.0-beta")>=0||e.indexOf("1.0.0-alpha")>=0){const e=transcoders.inject(w$3);t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",e)}else t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",(function(){return transcoders.inject(w$3)}))}else t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",w$3);"undefined"!=typeof console&&console.log("@maptalks/gltf-layer v0.81.4");
/*!
	 * @maptalks/transform-control v0.8.0
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.org
	 */
const w$2={yuanhuan:{accessors:[{name:"����С��_1_0_positions",componentType:5126,count:104,min:[-5.407599925994873,-5.404099941253662,0],max:[5.405200004577637,5.406300067901611,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"����С��_1_0_normals",componentType:5126,count:104,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"����С��_1_0_indices",componentType:5123,count:288,min:[0],max:[103],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"缩放圈-新",byteLength:3072,uri:"data:application/octet-stream;base64,KVyjQLbzPT4AAAAAZvesQLbzPT4AAAAAhsmqQC7/YT8AAAAAZ0ShQDC7Vz8AAAAA+u2lwGKhxr8AAAAArK2cwLpJvL8AAAAAEFihwB04V78AAAAAXdyqwE7RYb8AAAAAat6lQEaUxj8AAAAAApqcQG+BvD8AAAAAB18EQFOWlcAAAAAA+u0LQLBynsAAAAAARPoxQNSalMAAAAAAJzEoQIxKjMAAAAAAQBNVQFyPiMAAAAAAIEFJQMDsgMAAAAAA0950QK36dMAAAAAAejZnQFRSZ8AAAAAAXdyAQBBYScAAAAAA+n6IQI0oVcAAAAAAcoqUQAMJMsAAAAAAKjqMQIlBKMAAAAAAXdyAQFdbSUAAAAAA+n6IQDsBVUAAAAAA0950QBTQdEAAAAAAejZnQA5PZ0AAAAAA+n6IwI0oVcAAAAAAwOyAwBBYScAAAAAAXkuMwIlBKMAAAAAA0ZGUwAMJMsAAAAAA5j+8P9ejnMAAAAAAkDFXP65HocAAAAAA1JrGPz7opcAAAAAA/7I7PvhTo8AAAAAA/7I7PmPurMAAAAAAM8RhP/vLqsAAAAAADwutwLbzPT4AAAAA0m+jwLbzPT4AAAAAEFihwDC7Vz8AAAAAXdyqwC7/YT8AAAAArK2cwG+BvD8AAAAA+u2lwEaUxj8AAAAADXGewN/gC0AAAAAAa5qVwIV8BEAAAAAAXkuMwAFNKEAAAAAA0ZGUwD7oMUAAAAAAlIeVQIV8BEAAAAAAlWWeQN/gC0AAAAAAcoqUQD7oMUAAAAAAKjqMQAFNKEAAAAAAQBNVQBB6iEAAAAAAIEFJQKfogEAAAAAAW9N0wK36dMAAAAAAsVBnwFRSZ8AAAAAAlWWeQM/3C8AAAAAAlIeVQNxoBMAAAAAA+n6IwDsBVUAAAAAAwOyAwFdbSUAAAAAAsVBnwA5PZ0AAAAAAW9N0wBTQdEAAAAAAd74LwLBynsAAAAAAkxi8v9ejnMAAAAAAwFsEwFOWlcAAAAAARpRWv65HocAAAAAAayvGvz7opcAAAAAA2c43vvhTo8AAAAAA2c43vmPurMAAAAAAt9Fgv/vLqsAAAAAAt9Fgv7fRqkAAAAAAayvGvybkpUAAAAAAd74LwAponkAAAAAA2c43vv5lo0AAAAAA2c43vmkArUAAAAAARpRWvzxOoUAAAAAAkxi8v9ejnEAAAAAAOdYxwHKKlEAAAAAAwFsEwDqSlUAAAAAA+zoowNBEjEAAAAAAJlNJwKfogEAAAAAAUPxUwBB6iEAAAAAAat6lQGKhxr8AAAAAApqcQLpJvL8AAAAAhsmqQE7RYb8AAAAAZ0ShQB04V78AAAAAZvesQP+yO74AAAAAKVyjQP+yO74AAAAAM8RhP7fRqkAAAAAA/7I7PmkArUAAAAAA/7I7Pv5lo0AAAAAA+u0LQAponkAAAAAA1JrGPybkpUAAAAAAkDFXPzxOoUAAAAAA5j+8P9ejnEAAAAAARPoxQHKKlEAAAAAAB18EQDqSlUAAAAAAJzEoQNBEjEAAAAAA+zoowIxKjMAAAAAAOdYxwNSalMAAAAAAUPxUwFyPiMAAAAAAJlNJwMDsgMAAAAAAa5qVwNxoBMAAAAAADXGewM/3C8AAAAAA0m+jwP+yO74AAAAADwutwP+yO74AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMABAAFAAYABAAGAAcAAwACAAgAAwAIAAkACgALAAwACgAMAA0ADQAMAA4ADQAOAA8ADwAOABAADwAQABEAEgATABQAEgAUABUAFgAXABgAFgAYABkAGgAbABwAGgAcAB0AHgALAAoAHwALAB4AHwAgAAsAIQAgAB8AIgAjACAAIgAgACEAJAAlACYAJAAmACcAJwAmACgAJwAoACkAKgArACwAKgAsAC0ALgAvADAALgAwADEAGQAYADIAGQAyADMANAA1ABsANAAbABoAFQAUADYAFQA2ADcAOAA5ADoAOAA6ADsAPAA9AD4APAA/AD0AQAA/ADwAQABBAD8AQgBBAEAAQgBAAEMARABFAEYARABGAEcARABHAEgARgBJAEcARgBKAEkASwBKAEYASwBMAEoASwBNAEwACQAIAC8ACQAvAC4ALQAsADkALQA5ADgAOwA6AE4AOwBOAE8ATwBOAE0ATwBNAEsAKQAoACsAKQArACoANwA2AFAANwBQAFEAUQBQAFIAUQBSAFMAUwBSAFQAUwBUAFUAVgBXAFgAVgBYAFkAVgBZAFoAWwBZAFgAXABZAFsAXABdAFkAXgBdAFwAXwBdAF4APAA+AGAAPABgAGEAMQAwABcAMQAXABYAYgBjADUAYgA1ADQAYQBgAGMAYQBjAGIAMwAyAF0AMwBdAF8AHQAcAGQAHQBkAGUAZQBkAAUAZQAFAAQAZgBnAAcAZgAHAAYAEQAQABMAEQATABIA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:1248,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:1248,byteOffset:1248,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:576,byteOffset:2496,target:34963}],materials:[{name:"SVGMat_001",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"����С��_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"����С��",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan41:{accessors:[{name:"Բ��_1_0_positions",componentType:5126,count:39,min:[0,0,0],max:[5.489999771118164,0,5.488900184631348],type:"VEC3",bufferView:0,byteOffset:0},{name:"Բ��_1_0_normals",componentType:5126,count:39,min:[0,-.999939501285553,-1],max:[.13969914615154266,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Բ��_1_0_indices",componentType:5123,count:105,min:[0],max:[38],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yh41",byteLength:1148,uri:"data:application/octet-stream;base64,8tKXQAAAAACoNU09FK6vQAAAAAB1Ako/FK6vQAAAAAAAAACATfOAQAAAAAACmkg+K4dWQAAAAAAIrNw+WvUtQAAAAABbsT8/X5gIQAAAAACMSpI/OUWbQAAAAAD0/VQ/LbKHQAAAAAD0/XQ/W0JqQAAAAAC6SZQ/dLXNPwAAAACfq80/H4VHQAAAAAB0JLc/ZognQAAAAAA1XuI/YVSSPwAAAAAukAhABaMKQAAAAAB4nApABcU/PwAAAACF6y1Aw2TiPwAAAACRfidASS63PwAAAABKe0dAJLncPgAAAACze1ZAj1OUPwAAAADjNmpAAppIPgAAAADu64BAnRF1PwAAAAD8qYdAqDVNPQAAAADBypdAgQRVPwAAAAAIPZtAAAAAAAAAAAASpa9AAwlKPwAAAAASpa9AJJd/PAAAAAASpa9AAwlKPwAAAAASpa9AAAAAAAAAAAASpa9Asp1vPQAAAAASpa9AJLn8PQAAAAASpa9AqoJRPgAAAAASpa9ARwOYPgAAAAASpa9AHhbKPgAAAAASpa9A2hv8PgAAAAASpa9A5q4VPwAAAAASpa9A+n4qPwAAAAASpa9AQxw7PwAAAAASpa9AwhdGPwAAAAASpa9AAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAJ5X/OwL+fz8AAACAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIC/Kzs0PAn8f78AAACApLK/PA7uf78AAACAeJkZPefRfz8AAACA+ZldPQSgf78AAACA6XSTPelVfz8AAACALLO3PdT3fr8AAACAfkjZPR2Ofr8AAACANf32Paohfj8AAACAeUYHPqDBfT8AAACASw0PPlt9fb8AAACAAAABAAIAAwABAAAABAABAAMABQABAAQABgAHAAUABwABAAUABgAIAAcABgAJAAgACgAJAAYACgALAAkACgAMAAsADQAMAAoADQAOAAwADwAOAA0ADwAQAA4ADwARABAAEgARAA8AEgATABEAFAATABIAFAAVABMAFgAVABQAFgAXABUAGAAXABYAGAAZABcAGgAbABwAHQAbABoAHgAbAB0AHwAbAB4AIAAbAB8AIQAbACAAIgAbACEAIwAbACIAJAAbACMAJQAbACQAJgAbACUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:468,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:468,byteOffset:468,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:212,byteOffset:936,target:34963}],materials:[{name:"SVGMat_002",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Բ��_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Բ��",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan411:{accessors:[{name:"����СȦ_1_0_positions",componentType:5126,count:28,min:[.026000000536441803,-4.6834001541137695,0],max:[4.696700096130371,-.014800000004470348,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"����СȦ_1_0_normals",componentType:5126,count:28,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"����СȦ_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanhuan411",byteLength:828,uri:"data:application/octet-stream;base64,ufwXQLN7Mr8AAAAAObRAQLFQK78AAAAA1ediQMWP8b4AAAAAGQQ6QCv2174AAAAAqFdeQHUCWr4AAAAA7FGCQL6fmr0AAAAAHHyDQDLmrr4AAAAAXkuWQJf/kL4AAAAAXkuWQLN7crwAAAAAMCrxP2RdhL8AAAAA/BgDQJeQn78AAAAADeARQAg9i78AAAAAukkIQISeXb8AAAAAZaogQH/Zbb8AAAAA7Q3ePr4wOcAAAAAA5IMuP9/gP8AAAAAAJQZxPwrXH8AAAAAAPZs1P6UsF8AAAAAAdy2hP0VHAsAAAAAAb/CFP5eQ778AAAAA0ES4P32utr8AAAAAAprQPyL9zr8AAAAAi/1lPqqCXcAAAAAA9dv3PtcSYsAAAAAADi2yPZvmgcAAAAAAYTK1PssQg8AAAAAA9P3UPGrelcAAAAAA4liXPmrelcAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMAAwACAAQABQAGAAcABQAHAAgABAACAAYABAAGAAUACQAKAAsACQALAAwAAAANAAEADgAPABAADgAQABEAEQAQABIAEQASABMAFAAVAAoAFAAKAAkADAALAA0ADAANAAAAFgAXAA8AFgAPAA4AGAAZABcAGAAXABYAGgAZABgAGgAbABkAEwASABUAEwAVABQA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"����СȦ_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"����СȦ",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanpan:{accessors:[{name:"Circle001_1_0_positions",componentType:5126,count:28,min:[-1.9510999917984009,0,-1.9510999917984009],max:[1.9510999917984009,0,1.9510999917984009],type:"VEC3",bufferView:0,byteOffset:0},{name:"Circle001_1_0_normals",componentType:5126,count:28,min:[0,1,0],max:[0,1,0],type:"VEC3",bufferView:1,byteOffset:0},{name:"Circle001_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanpan",byteLength:828,uri:"data:application/octet-stream;base64,S+rkvgAAAADRIvM/AAAAAAAAAAClvfk/S+rkPgAAAADRIvM/0SLzvwAAAABL6uQ+MlXgvwAAAACsi1s/c9fCvwAAAACvJZw/pb35vwAAAAAAAAAA0SLzvwAAAABL6uS+MlXgvwAAAACsi1u/c9fCvwAAAACvJZy/ryWcvwAAAABz18K/rItbvwAAAAAyVeC/S+rkvgAAAADRIvO/AAAAgAAAAAClvfm/S+rkPgAAAADRIvO/rItbPwAAAAAyVeC/ryWcPwAAAABz18K/c9fCPwAAAACvJZy/MlXgPwAAAACsi1u/0SLzPwAAAABL6uS+pb35PwAAAAAAAACA0SLzPwAAAABL6uQ+MlXgPwAAAACsi1s/c9fCPwAAAACvJZw/ryWcvwAAAABz18I/ryWcPwAAAABz18I/rItbvwAAAAAyVeA/rItbPwAAAAAyVeA/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAABAAIAAwAEAAUABgADAAUABwAGAAUACAAHAAUACQAIAAUACgAJAAUACwAKAAUADAALAAUADQAMAAUADgANAAUADwAOAAUAEAAPAAUAEQAQAAUAEgARAAUAEwASAAUAFAATAAUAFQAUAAUAFgAVAAUAFwAWAAUAFwAFABgAGQAXABgAGQAYABoAGwAZABoAAgAbABoAAAACABoA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"wire_008110135",pbrMetallicRoughness:{baseColorFactor:[.0314,.4314,.5294,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Circle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Circle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},zzhou:{accessors:[{name:"Cube.001-Mesh_0_positions",componentType:5126,count:45,min:[-.2711470127105713,-5.473427772521973,-.2711470127105713],max:[.2711470127105713,.46298399567604065,.2711470127105713],type:"VEC3",bufferView:0,byteOffset:0},{name:"Cube.001-Mesh_0_normals",componentType:5126,count:45,min:[-1,-1,-1],max:[1,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Cube.001-Mesh_0_texcoords",componentType:5126,count:45,min:[.125,0],max:[.875,1],type:"VEC2",bufferView:2,byteOffset:0},{name:"Cube.001-Mesh_0_indices",componentType:5123,count:72,min:[0],max:[44],type:"SCALAR",bufferView:3,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"Z",byteLength:1584,uri:"data:application/octet-stream;base64,/waNvZMdK77/Bo09/waNPZMdK77/Bo09/waNPR4Kr8D/Bo09l+KKPVImr8D/Bo09/waNvVImr8D/Bo09yNOKPsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04o+yNOKvsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04q+yNOKvsjTir7I04q+yNOKPsjTir7I04q+yNOKPsjTir7I04o+yNOKvsjTir7I04o+yNOKPsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04o+yNOKvsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04q+/waNPZMdK77/Bo09/waNPZMdK77/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09/waNPR4Kr8D/Bo09/waNvZMdK77/Bo09/waNvVImr8D/Bo09/waNvVImr8D/Bo29/waNvZMdK77/Bo29/waNvZMdK77/Bo29/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPZMdK77/Bo29/waNPZMdK77/Bo09/waNvZMdK77/Bo09/waNvZMdK77/Bo29/waNPZMdK77/Bo29/waNvVImr8D/Bo09cooOO1Imr8BAMTI7/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09l+KKPVImr8D/Bo09/waNPVImr8D/Bo09AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/cCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAAAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAADAPgAAQD8AAMA+AACAP2L1Hz8AAIA/AAAgP3uDfz8AACA/AABAPwAAwD4AAIA+AAAgPwAAAAAAAMA+AAAAAAAAwD4AAIA/AAAgPwAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAAD8AAMA+AACAPgAAAD4AAIA+AADAPgAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAQD8AACA/AAAAPwAAwD4AAAA/AADAPgAAAD8AAMA+AABAPwAAID8AAEA/AAAgPwAAAD9i9R8/AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAgD4AACA/AACAPgAAID8AAAAAAADAPgAAAAAAAAA+AAAAPwAAwD4AAAA/AADAPgAAgD4AAAA+AACAPgAAID8AAAA/vAJBP/mGwj4AACA/AACAPgAAYD8AAIA+AAAgPwAAgD97g18/AAAAPwAAYD8AAAA/AAABAAIAAgADAAQAAgAEAAAABQAGAAcACAAJAAoACwAMAA0ACwANAA4ADwAQABEAEgATABQAFQAWABcAFwAYABkAFwAZABUAGgAbABwAGgAcAB0AHgAfACAAHgAgACEAIgAjACQAIgAkACUAJgAnACgAKAAnACkAAwACACoAKQAnACsAKQArACwAJwAmACsA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:540,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:540,byteOffset:540,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:360,byteOffset:1080,byteStride:8,target:34962},{name:"bufferView_3",buffer:0,byteLength:144,byteOffset:1440,target:34963}],materials:[{name:"Material.001",pbrMetallicRoughness:{baseColorFactor:[.8,.8,.8,1],metallicFactor:0,roughnessFactor:.676000006},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Cube.001-Mesh",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0,mode:4}]}],nodes:[{name:"Cube.001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},jiantou:{accessors:[{name:"��ͷ_1_0_positions",componentType:5126,count:7,min:[-.47690001130104065,-.8044000267982483,0],max:[.47780001163482666,0,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"��ͷ_1_0_normals",componentType:5126,count:7,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"��ͷ_1_0_indices",componentType:5123,count:15,min:[0],max:[6],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"jiantou",byteLength:200,uri:"data:application/octet-stream;base64,bxIDOintTb8AAAAAH/RsvsKGp74AAAAAPSz0vsKGp74AAAAANs17PsKGp74AAAAANKL0PsKGp74AAAAANs17PgAAAAAAAAAAH/RsvgAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAADAAEAAAAEAAMAAQAFAAYAAQADAAUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:84,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:84,byteOffset:84,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:32,byteOffset:168,target:34963}],materials:[{name:"SVGMat_003",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"��ͷ_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"��ͷ",mesh:0}],scene:0,scenes:[{nodes:[0]}]},xuanzhuan:{accessors:[{name:"��ת001_1_0_positions",componentType:5126,count:369,min:[-6.572299957275391,-7.298999786376953,0],max:[6.5742998123168945,7.298299789428711,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"��ת001_1_0_normals",componentType:5126,count:369,min:[0,-1,0],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"��ת001_1_0_indices",componentType:5123,count:1089,min:[0],max:[368],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"旋转-新",byteLength:11036,uri:"data:application/octet-stream;base64,1zQDwHql3kAAAAAA48e4vgMJ1kAAAAAAQmD1v6yL6UAAAAAA2qxqv1Fr0EAAAAAAVHSkvnuD1UAAAAAAF7eRvjXv1EAAAAAAyeV/vqVO1EAAAAAA5INevsuh00AAAAAAW7E/vpHt0kAAAAAAZogjvoMv0kAAAAAAAwkKvrpr0UAAAAAA+aDnvTSi0EAAAAAAXCDBvWfVz0AAAAAAqoLZv4NRy0AAAAAALv+hvfcGz0AAAAAAAwmKvVg5zkAAAAAA/Yd0vYtszUAAAAAAak1zvSBBzUAAAAAA1xJyveQUzUAAAAAAIEFxvTLmzEAAAAAARdhwvd21zEAAAAAARdhwvbaEzEAAAAAAIEFxvb1SzEAAAAAAs3tyvSEfzEAAAAAARrZzvYXry0AAAAAAayt2vRe3y0AAAAAAkKB4vQaBy0AAAAAASFB8vfVKy0AAAAAAhXwcwLRZw0AAAAAAbjSAveQUy0AAAAAA3EaDvcX+ykAAAAAAb/CFvTLmykAAAAAAcM6IvRTQykAAAAAAcayLvSS5ykAAAAAAcoqOvQWjykAAAAAA4XqUvWx4ykAAAAAAUI2XvSBjykAAAAAACD2bvQFNykAAAAAAUrievbU3ykAAAAAAeJyivTojykAAAAAA5x2nve0NykAAAAAAMCqpvaMBykAAAAAAVp+rvVr1yUAAAAAAexSuvbPqyUAAAAAAxSCwvTvfyUAAAAAA6pWyvfLSyUAAAAAAoda0vUvIyUAAAAAAx0u3vQK8yUAAAAAAWvW5vVuxyUAAAAAA7Z68vYenyUAAAAAA7ny/veCcyUAAAAAAgSbCvQyTyUAAAAAAgQTFvQmKyUAAAAAA1CvlvRUdyUAAAAAAXW0FviS5yEAAAAAALNQavjVeyEAAAAAADi0yvqYKyEAAAAAAlkNLvki/x0AAAAAA5q5lvhx8x0AAAAAAZaqAvqs+x0AAAAAA4L6OvsgHx0AAAAAAyAedvnPXxkAAAAAAlkOrvqytxkAAAAAAEFi5vs6IxkAAAAAAH4XLvpVlxkAAAAAAAwnKvjhnxkAAAAAA54zIvjhnxkAAAAAAsAPHvgpoxkAAAAAAOwHNvsNkxkAAAAAAO3DOvvFjxkAAAAAA0ETYvpJcxkAAAAAAV+zPvk5ixkAAAAAAV1vRvtlfxkAAAAAAWMrSvgdfxkAAAAAAWDnUvmRdxkAAAAAAIo7VvpJcxkAAAAAA6+LWvpJcxkAAAAAAiIXavgRWxkAAAAAAJLncvkhQxkAAAAAA2/nevl5LxkAAAAAAkzrhvhdIxkAAAAAASnvjvtBExkAAAAAAMzPzvoY4xkAAAAAAArzlvrhAxkAAAAAAufznvkI+xkAAAAAAcT3qvs07xkAAAAAAKH7svlg5xkAAAAAAxLHuvoY4xkAAAAAAfPLwvoY4xkAAAAAA9Gz2vsoyxkAAAAAAtab5vj0sxkAAAAAAduD8vlInxkAAAAAAqRMAvzojxkAAAAAApb0Bv08exkAAAAAAE2EDvzcaxkAAAAAAnREFv00VxkAAAAAAC7UGvzQRxkAAAAAAlWUIv0oMxkAAAAAAHhYKv18HxkAAAAAAGsALv6MBxkAAAAAADk8Pv7n8xUAAAAAAgEgPv7n8xUAAAAAApHANv7n8xUAAAAAAUwWrv90kwkAAAAAASS4Pv7n8xUAAAAAApHANv7n8xUAAAAAAgEgPv7n8xUAAAAAA9wYPv7n8xUAAAAAAidIOv7n8xUAAAAAAG54Ov7n8xUAAAAAAIGMOv7n8xUAAAAAAJCgOv7n8xUAAAAAAKe0Nv7n8xUAAAAAASL8Nv7n8xUAAAAAA9pcNv7n8xUAAAAAAv30Nv7n8xUAAAAAABoFJwDm0uEAAAAAAZvcEwJtVu0AAAAAAwcoxwOzAsUAAAAAARiUFQFdbu8AAAAAAdZMcQM9mw8AAAAAA9pdJQIPAuMAAAAAAtvMxQEvIscAAAAAA2IFzQISeq8AAAAAAjLlbQECkpcAAAAAAZveMQPkxnMAAAAAAPQqBQNEil8AAAAAA+zqeQJOpisAAAAAAdk+SQPd1hsAAAAAAA3ihQFafZ8AAAAAAnl6tQN5xbsAAAAAAsi66QCEfRMAAAAAASFCuQLTIPsAAAAAA4XrEQPW5FsAAAAAAHqe4QJ/NEsAAAAAA1xLMQJhMzb8AAAAA6UjAQFInyL8AAAAAnMTQQM4ZUb8AAAAAsAPFQKMBTL8AAAAAduCMwKMjWcAAAAAA9P1wwOauOcAAAAAA6GqDwG1WGcAAAAAA46WZwA5PM8AAAAAANKLGQBe30TkAAAAAqmDSQBe30TkAAAAAdQLMwEYlzT8AAAAALUPAwAAAyD8AAAAAvp+4wFK4EkAAAAAArWnEwAWjFkAAAAAAF0iuwGizPkAAAAAATx66wI4GREAAAAAAXW2hwAmKZ0AAAAAAPE6twEtZbkAAAAAAW0KSwFFrhkAAAAAAayuewO2eikAAAAAAUPyAwPwYl0AAAAAA1eeMwK8lnEAAAAAAyJhbwA+cpUAAAAAAoWdzwDqSq0AAAAAA6GqrP8cpwsAAAAAA+zoQP6MBxsAAAAAAbqPZPxNhy8AAAAAAYHYPPxsNxsAAAAAAukkMPzQRxsAAAAAA0gAOPxsNxsAAAAAARPoNPxsNxsAAAAAAexQOPxsNxsAAAAAAPzUOPxsNxsAAAAAAIGMOPxsNxsAAAAAAcooOPxsNxsAAAAAAUrgOPxsNxsAAAAAAMuYOPxsNxsAAAAAAoBoPPxsNxsAAAAAAZDsPPxsNxsAAAAAAKVwPPxsNxsAAAAAA0m8PPxsNxsAAAAAAMZkKP00VxsAAAAAAp+gIPzcaxsAAAAAAqz4HPyEfxsAAAAAAIo4FP90kxsAAAAAAmN0DP2srxsAAAAAADi0CPycxxsAAAAAAhXwAP+M2xsAAAAAA9pf9PnE9xsAAAAAA/kP6PltCxsAAAAAA6+L2PqJFxsAAAAAA2IHzPulIxsAAAAAAc2jxPl5LxsAAAAAADk/vPtNNxsAAAAAAqDXtPkhQxsAAAAAAKA/rPr1SxsAAAAAAjNvoPmFUxsAAAAAAC7XmPjJVxsAAAAAAVHTkPgRWxsAAAAAA003iPnlYxsAAAAAAGw3gPh1axsAAAAAAZMzdPpJcxsAAAAAArIvbPgdfxsAAAAAA9UrZPnxhxsAAAAAA2c7XPvFjxsAAAAAA2V/WPpVlxsAAAAAA2PDUPgpoxsAAAAAA847TPn9qxsAAAAAA8x/SPiJsxsAAAAAA8rDQPvRsxsAAAAAA8kHPPphuxsAAAAAAKe3NPg1xxsAAAAAAKH7MPt5xxsAAAAAADALLPlR0xsAAAAAADJPJPsl2xsAAAAAA8BbIPj55xsAAAAAA4za6PryWxsAAAAAATRWsPvW5xsAAAAAASL+dPuvixsAAAAAAYHaPPp0Rx8AAAAAA5WGBPgtGx8AAAAAAi2xnPtiBx8AAAAAAOwFNPtbFx8AAAAAA6gQ0PmIQyMAAAAAAP8YcPiBjyMAAAAAA3pMHPrG/yMAAAAAAZ0TpPdEiycAAAAAAg1HJPcWPycAAAAAAy6HFPQ+cycAAAAAA7lrCPYenycAAAAAAEhS/PdCzycAAAAAAowG8PRrAycAAAAAAEFi5PZLLycAAAAAAfa62PdzXycAAAAAA6gS0PVTjycAAAAAAxY+xPZ7vycAAAAAADk+vPef7ycAAAAAA6NmsPV8HysAAAAAAn82qPakTysAAAAAAeVioPfMfysAAAAAAwaikPT81ysAAAAAA5WGhPYxKysAAAAAACRuePapgysAAAAAACD2bPcl2ysAAAAAAB1+YPbmNysAAAAAAdLWVPamkysAAAAAAvJaQPVvTysAAAAAABFaOPRzrysAAAAAA3+CLPd4Cy8AAAAAAldSJPXEby8AAAAAAcF+HPTMzy8AAAAAA3bWEPc9my8AAAAAALNRqP1Z90MAAAAAAuECCPciYy8AAAAAA3GiAPZLLy8AAAAAAtvN9PS7/y8AAAAAASFB8PScxzMAAAAAA/kN6PSBjzMAAAAAAI9t5PUaUzMAAAAAAI9t5PRHHzMAAAAAAI9t5PTj4zMAAAAAA/kN6PV8pzcAAAAAAkX57PYZazcAAAAAAJLl8PQmKzcAAAAAAcoqOPdZWzsAAAAAAMEymPaMjz8AAAAAAXW3FPZ7vz8AAAAAAjLnrPfW50MAAAAAAqz4DQN213sAAAAAAgy8MPmN/0cAAAAAA5q4lPrhA0sAAAAAAE/JBPn/70sAAAAAAnMRgPhSu08AAAAAAJQaBPnlY1MAAAAAAPL2SPpT21MAAAAAAeHqlPgmK1cAAAAAAhxa5Pr8O1sAAAAAA63P1P2iR6cAAAAAApb1Bv4xKsEAAAAAAMlVAP4xKsEAAAAAAw2QquxDpsUAAAAAAMne9v/OOq0AAAAAA3bW8P/OOq0AAAAAAYqEKwG/wo0AAAAAAcT0KQG/wo0AAAAAA/7IzwG6jmUAAAAAAak0zQG6jmUAAAAAA8IVZwAHejEAAAAAAHcklvw6+lkAAAAAAw2Qqu8UgmEAAAAAAxm0kPw6+lkAAAAAAuB5ZQAHejEAAAAAAc2ihP5aykkAAAAAA1xKiv5aykkAAAAAAKH7sP+AtjEAAAAAAjSjtv+AtjEAAAAAAuK97wBSue0AAAAAAOUV7QBSue0AAAAAAnl4ZQHBfg0AAAAAAdLUZwHBfg0AAAAAAXro5QGDlcEAAAAAA7Q06wGDlcEAAAAAAduCMwPCFWUAAAAAAZaqMQPCFWUAAAAAAqvFWQJAxV0AAAAAA3EZXwJAxV0AAAAAA46WZwEa2M0AAAAAA0m+ZQEa2M0AAAAAAHqdwQIv9OUAAAAAA9P1wwIv9OUAAAAAAIEGDQLWmGUAAAAAA6GqDwLWmGUAAAAAAnzyMwMZt7L8AAAAAiPSjwHE9CsAAAAAAIEGDQG1WGcAAAAAA0m+ZQA5PM8AAAAAA07yjQHE9CsAAAAAANBGMQMZt7L8AAAAA+1yrQAisvL8AAAAA6pWSQBBYob8AAAAAOpKrwAisvL8AAAAAVcGSwBBYob8AAAAA+8uWwI9TJL8AAAAA002wwG40QL8AAAAAYqGWQMbcJT8AAAAA8BawQPfkQT8AAAAA+1yrQE2EvT8AAAAA6pWSQJEPoj8AAAAAVTCYwInSXjsAAAAA+u2xwInSXjsAAAAA6gSYQInSXjsAAAAARraxQInSXjsAAAAAObTQwEXYUD8AAAAAIv3EwBrASz8AAAAAYqGWQI9TJL8AAAAA8BawQG40QL8AAAAA+8uWwMbcJT8AAAAA002wwPfkQT8AAAAAVcGSwJEPoj8AAAAAOpKrwE2EvT8AAAAAnzyMwOQU7T8AAAAAiPSjwEymCkAAAAAA07yjQEymCkAAAAAANBGMQOQU7T8AAAAAHqdwQOauOcAAAAAAZaqMQKMjWcAAAAAA3EZXwOviVsAAAAAAqvFWQOviVsAAAAAA7Q06wLyWcMAAAAAAXro5QLyWcMAAAAAAOUV7QMdLe8AAAAAAuK97wMdLe8AAAAAAdLUZwHo2g8AAAAAAnl4ZQHo2g8AAAAAAuB5ZQE+vjMAAAAAA8IVZwE+vjMAAAAAAjSjtv+oEjMAAAAAAKH7sP+oEjMAAAAAA1xKiv86IksAAAAAAc2ihP86IksAAAAAAak0zQGB2mcAAAAAA/7IzwGB2mcAAAAAAHcklv0aUlsAAAAAAxm0kP0aUlsAAAAAAw2Qqu/32l8AAAAAAcT0KQDPEo8AAAAAAYqEKwDPEo8AAAAAA3bW8P4hjq8AAAAAAMne9v4hjq8AAAAAAMlVAPyEfsMAAAAAApb1BvyEfsMAAAAAAw2Qqu3e+scAAAAAASFDSwG8Sg7oAAAAASZ3GwG8Sg7oAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAwABAAAAAwAEAAEAAwAFAAQAAwAGAAUAAwAHAAYAAwAIAAcAAwAJAAgAAwAKAAkAAwALAAoAAwAMAAsADQAMAAMADQAOAAwADQAPAA4ADQAQAA8ADQARABAADQASABEADQATABIADQAUABMADQAVABQADQAWABUADQAXABYADQAYABcADQAZABgADQAaABkADQAbABoAHAAbAA0AHAAdABsAHAAeAB0AHAAfAB4AHAAgAB8AHAAhACAAHAAiACEAHAAjACIAHAAkACMAHAAlACQAHAAmACUAHAAnACYAHAAoACcAHAApACgAHAAqACkAHAArACoAHAAsACsAHAAtACwAHAAuAC0AHAAvAC4AHAAwAC8AHAAxADAAHAAyADEAHAAzADIAHAA0ADMAHAA1ADQAHAA2ADUAHAA3ADYAHAA4ADcAHAA5ADgAHAA6ADkAHAA7ADoAHAA8ADsAHAA9ADwAHAA+AD0AHAA/AD4AHABAAD8AQABBAD8AQQBCAD8AQgBDAD8AHABAAEQAHABEAEUAHABGAEUARgBHAEUARgBIAEcARgBJAEgARgBKAEkARgBLAEoARgBMAEsAHABNAEYAHABOAE0AHABPAE4AHABQAE8AHABRAFAAHABSAFEAUgBTAFEAUgBUAFMAUgBVAFQAUgBWAFUAUgBXAFYAUgBYAFcAHABZAFIAHABaAFkAHABbAFoAHABcAFsAHABdAFwAHABeAF0AHABfAF4AHABgAF8AHABhAGAAHABiAGEAHABjAGIAHABjAGQAZABlAGMAZQBmAGMAHABnAGQAaABpAGoAawBpAGgAbABpAGsAbQBpAGwAbgBpAG0AbwBpAG4AcABpAG8AcQBpAHAAcgBpAHEAcwBpAHIAdABnABwAdAB1AGcAdAB2AHUAdwB4AHkAdwB5AHoAegB5AHsAegB7AHwAfAB7AH0AfAB9AH4AfgB9AH8AfgB/AIAAgQCCAIMAgQCDAIQAhACDAIUAhACFAIYAhgCFAIcAhgCHAIgAiACHAIkAiACJAIoAiwCMAI0AiwCNAI4AjwCKAJAAigCJAJAAkQCSAJMAkQCTAJQAlACTAJUAlACVAJYAlgCVAJcAlgCXAJgAgAB/AIIAgACCAIEAmACXAJkAmACZAJoAmgCZAJsAmgCbAJwAnACbAJ0AnACdAJ4AngCdAHYAngB2AHQAnwB4AHcAoAB4AJ8AoAChAHgAogChAKAAowCkAKUAowCmAKQAowCnAKYAowCoAKcAowCpAKgAowCqAKkAowCrAKoAowCsAKsAowCtAKwAowCuAK0AowCvAK4AowCiAK8AowChAKIAsAChAKMAsQChALAAsgChALEAswChALIAtAChALMAtQChALQAtgChALUAtwChALYAuAChALcAuQChALgAugChALkAuwChALoAvAChALsAvQChALwAvgChAL0AvwChAL4AwAChAL8AwQChAMAAwgChAMEAwwChAMIAxAChAMMAxQChAMQAxgChAMUAxwChAMYAyAChAMcAyQChAMgAygChAMkAywChAMoAzAChAMsAzQChAMwAzgChAM0AzwChAM4A0AChAM8A0QChANAA0gChANEA0wChANIA1AChANMA1QChANQA1gChANUA1wChANYA2AChANcA2QChANgA2gChANkA2wChANoA3AChANsA3QChANwA3gChAN0A3wChAN4A4AChAN8A4QChAOAA4gChAOEA4wChAOIA5AChAOMA5QChAOQA5gChAOUA5wChAOYA6AChAOcA6QChAOgA6gChAOkA6wChAOoA7AChAOsA7QChAOwA7gChAO0A7wChAO4A8AChAO8A8QChAO8A8gChAPEA8wChAPIA9AChAPMA9QChAPQA9gChAPUA9gD3AKEA+AD3APYA+QD3APgA+gD3APkA+wD3APoA/AD3APsA/QD3APwA/gD3AP0A/wD3AP4AAAH3AP8AAQH3AAABAgH3AAEBAwH3AAIBBAH3AAMBBQH3AAQBBgH3AAUBBgEHAfcACAEHAQYBCQEHAQgBCgEHAQkBCwEHAQoBDAEHAQsBDQEHAQwBDgEHAQ0BDwEHAQ4BEAEHAQ8BEQESARMBFAESAREBFAEVARIBFgEVARQBFgEXARUBGAEXARYBGAEZARcBGgEbARgBGwEcARgBHAEZARgBHAEdARkBHQEeARkBHwEeAR0BGgEgARsBIQEeAR8BGgEiASABIwEiARoBIQEkAR4BJQEkASEBIwEmASIBJwEkASUBIwEoASYBKQEoASMBJwEqASQBKwEqAScBKQEsASgBLQEsASkBKwEuASoBLwEuASsBLQEwASwBMQEuAS8BLQEyATABjgCNADMBjgAzATQBNQE2ATcBNQE3ATgBOAE3ATkBOAE5AToBOwE8AT0BOwE9AT4BPwFAAUEBPwFBAUIBPgE9AUMBPgFDAUQBRQFGAUABRQFAAT8BRwFIAZIARwGSAJEASQFKAUYBSQFGAUUBRAFDAUsBRAFLAUwBOgE5AUoBOgFKAUkBTAFLAU0BTAFNAU4BTgFNAU8BTgFPAVABQgFBAVEBQgFRAVIBUgFRAS4BUgEuATEBNAEzATwBNAE8ATsBUwFUATYBUwE2ATUBUAFPATIBUAEyAS0BiwBVAYwAVgFUAVMBiwBXAVUBWAFUAVYBWAFZAVQBWgFXAYsAWgFbAVcBXAFZAVgBXAFdAVkBXgFbAVoBXgFfAVsBYAFdAVwBXgFhAV8BYgFdAWABYgFjAV0BZAFhAV4BZAFlAWEBZgFjAWIBZAFnAWUBZwFjAWYBZAFjAWcBZAFoAWMBaQFoAWQBaQFqAWgBawFqAWkBawFsAWoBbQFsAWsBbQFuAWwBbwFwAUgBbwFIAUcBAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:4428,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:4428,byteOffset:4428,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:2180,byteOffset:8856,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"��ת001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"��ת001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},plane:{accessors:[{name:"Rectangle001_1_0_positions",componentType:5126,count:4,min:[-5,-5,0],max:[5,5,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"Rectangle001_1_0_normals",componentType:5126,count:4,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Rectangle001_1_0_indices",componentType:5123,count:6,min:[0],max:[3],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"plane",byteLength:108,uri:"data:application/octet-stream;base64,AACgQAAAoEAAAAAAAACgwAAAoEAAAAAAAACgwAAAoMAAAAAAAACgQAAAoMAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAgADAAAA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:48,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:48,byteOffset:48,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:12,byteOffset:96,target:34963}],materials:[{name:"wire_225198087",pbrMetallicRoughness:{baseColorFactor:[.8824,.7765,.3412,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Rectangle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Rectangle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]}};function f$1(s,i,n,o,I,r){const a=[],g=fromRotationTranslationScale([],fromEuler([],n[0],n[1],n[2]),i,o),B=function(A){return new k$8("",w$2[A]).load().then((A=>A))}(s);return B.then((A=>{const s=zd.exportGLTFPack(A).getMeshesInfo(),h=new tt$6({color:I});s.forEach((A=>{const s=new ft$6(A.geometry,h);s.setUniform("uPickingId",r);const c=s.getDefines();c.HAS_PICKING_ID=2,s.setDefines(c),s.translate=i,s.rotation=n,s.scaling=o,multiply$5(s.localTransform,g,A.nodeMatrix),s.originTransform=copy$5([],s.localTransform),s.originColor=I,a.push(s)}))})),a}function C$2(A,e){const i=A.getCoordinates(),n=e.coordinateToPointAtRes(i,e.getGLRes()),I=[n.x,n.y,0];add$4(I,I,A.getTranslation());const a=function(A,t,e,s){return A._pointAtResToContainerPoint(t,e,void 0)}(e,new t__namespace.Point(I[0],I[1]),e.getGLRes());a.x+=170;const h=function(A,e,i,n){{const t=A.containerPointToCoordinate(e);return A.coordinateToPointAtRes(t,i)}}(e,a,e.getGLRes());return Math.sqrt(Math.pow(h.x-I[0],2)+Math.pow(h.y-I[1],2))/5.272881136101205}class P$2{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],t=340/177,e=f$1("jiantou",[1.2*t,0,0],[0,0,90],[t,t,t],[89/255,206/255,147/255,0],7),s=f$1("jiantou",[0,1.2*t,0],[0,0,180],[t,t,t],[89/255,206/255,147/255,0],8),i=f$1("jiantou",[-1.2*t,0,0],[0,0,270],[t,t,t],[89/255,206/255,147/255,0],9),n=f$1("jiantou",[0,-1.2*t,0],[0,0,0],[t,t,t],[89/255,206/255,147/255,0],10);return A.push(e,s,i,n),A}getMeshes(){return this._meshes}}class m$2{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],t=340/177,e=f$1("xuanzhuan",[0,0,0],[180,0,0],[.5*t,.5*t,.5*t],[50/255,130/255,184/255,.8],11);return A.push(e),A}getMeshes(){return this._meshes}}class u{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],t=340/177,e=f$1("yuanhuan",[0,0,0],[0,0,0],[.5*t,.5*t,.5*t],[149/255,179/255,199/255,.5],12);return A.push(e),A}getMeshes(){return this._meshes}}class Q$1{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],t=f$1("plane",[0,0,0],[0,0,0],[10,10,10],[1,0,0,.5],16);return A.push(t),A}getMeshes(){return this._meshes}}const l=[],b$2=[],y$2=[],v$1=[],M$2=[],E$2=[177/170,177/170,177/170],D$2=[1,2,3,4,12];class p$2{constructor(){this.translate=new P$2,this.rotation=new m$2,this.scaling=new u,this.planeHelper=new Q$1,this._meshes=this.t(),this.i=!0}t(){const A={};A.translate=this.translate.getMeshes(),A.rotation=this.rotation.getMeshes(),A.scaling=this.scaling.getMeshes(),A.planeHelper=this.planeHelper.getMeshes();const t=340/177,e=f$1("yuanhuan41",[-2.745*t,2.745*t,0],[90,0,0],[.5*t,.5*t,.5*t],[149/255,179/255,199/255,.6],1),s=f$1("yuanhuan41",[2.745*t,2.745*t,0],[-90,0,180],[.5*t,.5*t,.5*t],[50/255,130/255,184/255,.5],2),i=f$1("yuanhuan41",[2.745*t,-2.745*t,0],[90,0,180],[.5*t,.5*t,.5*t],[149/255,179/255,199/255,.6],3),n=f$1("yuanhuan41",[-2.745*t,-2.745*t,0],[-90,0,0],[.5*t,.5*t,.5*t],[50/255,130/255,184/255,.5],4),o=f$1("yuanpan",[0,0,0],[90,0,0],[.5*t,.5*t,.5*t],[89/255,206/255,147/255,.5],5),I=f$1("zzhou",[0,0,6.5],[90,0,0],[1,1,1],[14/255,127/255,191/255,1],6);return A.translate.push(e,s,i,n,o,I),A}updateMatrix(e,i,n,o,I){const r=i.getCoordinates(),a=e.coordinateToPointAtRes(r,e.getGLRes()),h=i.getPointZ();set$4(b$2,a.x,a.y,h);const g=copy$4(l,I),c=i.getTranslation();add$4(b$2,b$2,c),add$4(b$2,b$2,g);for(const I in this._meshes)for(let r=0;r<this._meshes[I].length;r++){const a=this._meshes[I][r];for(let I=0;I<a.length;I++){const r=a[I],h=r.getUniform("uPickingId"),g=copy$4(l,r.translate),c=[r.rotation[0],r.rotation[1],r.rotation[2]],w=r.scaling;if(11===h&&(this.i?(c[2]+=n,r.rotation[2]+=n):this.i||(c[2]+=n,r.rotation[2]+=n,c[0]=360,c[2]-=90)),D$2.indexOf(h)>-1)if(12!==h)w[0]+=o,w[1]+=o,w[2]+=o;else{const A=this._meshes.translate[4][0];w[0]=1.2*A.scaling[0],w[1]=1.2*A.scaling[0],w[2]=1.2*A.scaling[0]}let B=C$2(i,e);if(B=set$4(y$2,B,B,B),multiply$4(g,g,B),multiply$4(B,B,w),1===h||2===h||3===h||4===h){const A=multiply$4(M$2,w,E$2);multiply$4(g,g,A)}const f=fromEuler(v$1,c[0],c[1],c[2]);add$4(g,g,b$2),fromRotationTranslationScale(r.localTransform,f,g,B)}}}getMeshes(A){const t={};return t.translate=this._meshes.translate,A&&"translate"!==A&&(t[A]=this._meshes[A]),t}o(A){this.i=A}dispose(){for(const A in this._meshes)for(let t=0;t<this._meshes[A].length;t++){const e=this._meshes[A][t];for(let A=0;A<e.length;A++){const t=e[A];t.geometry.dispose(),t.dispose()}}}}const d$2=[5,6,7,8,9,10],x$2=[5,7,8,9,10],F$2=[2,4,11],U$1=[1,3,12],k$2=[12,16],L$2=[1,2,3,4],V$2=[1,2,3,4,12],O$2=[],S$2=[],H$2=[],N$2=[],T$2=[],K$1=[],_$2=[];class R$2 extends(t$2.Eventable(t$2.Handlerable(t$2.Class))){constructor(A){super(A),this.options=A,this.mouseAction="moving",this.I="translate",this.h=!0,this.TransformHelper=new p$2,this.helperScene=new yt$6([]),this.addToMapCount=0}enable(){return this.h=!0,this.layerRenderer&&this.layerRenderer.setToRedraw(),this}disable(){return this.h=!1,this.layerRenderer&&this.layerRenderer.setToRedraw(),this.map&&this.map.resetCursor(),this}isEnable(){return this.h}g(A){this.I=d$2.indexOf(A)>-1?"translate":F$2.indexOf(A)>-1?"rotation":U$1.indexOf(A)>-1?"scaling":"translate"}B(){return this.I}addTo(A){this.map&&(this.C(),console.warn("transform control has been added to a map, it suggest remove from the map before")),this.addToMapCount++,this.map=A,this.container=A.getContainer(),A.on("dom:mousemove",this.P,this),A.on("dom:mousedown",this.m,this),A.on("dom:mouseup",this.u,this),A.on("zooming moving dragrotating",this.l,this),this.v()}remove(){this.map&&this.container&&this.layerRenderer&&(this.C(),this.TransformHelper.dispose(),this.layerRenderer.setToRedraw(),delete this.map,delete this.layer,delete this.layerRenderer,delete this.container,delete this.M)}C(){this.container&&this.map&&(this.map.off("mousemove",this.P,this),this.map.off("mousedown",this.m,this),this.map.off("mouseup",this.u,this),this.map.off("zooming moving dragrotating",this.l,this),this.layer&&this.layer.off("renderend",this.render,this))}P(A){if(this.D()){if(this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y},"moving"===this.mouseAction){const A=this.p();this.currentPickingObject=this.F(this.currentMousePosition,A,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.pickingId?(this.g(this.currentPickingObject.pickingId),this.U(6===this.currentPickingObject.pickingId)):(this.U(!1),this.g()),this.k()}this.L(this.currentMousePosition)}}m(A){if(!this.D())return;const t=this.p();this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y},this.V=!0,this.currentPickingObject=this.F(this.currentMousePosition,t,"meshes"),this.firstDownPoint=this.F(this.currentMousePosition,t,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.O(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.layerRenderer&&this.layerRenderer.setToRedraw()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0),this.S()),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=t[this.currentPickingObject.meshId]}u(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.S(),this.V=!0,this.fire("transformend",{action:this.H,type:"transformend"})),this.mouseAction="moving",this.I="translate",this.map.config("zoomable",!0),this.map.config("draggable",!0),this.layerRenderer&&this.layerRenderer.setToRedraw()}l(){const A=this.TransformHelper.planeHelper.getMeshes()[0][0],t=this.map.getBearing();A.rotation[2]=-t,this.N()}N(){this.D()&&(this.TransformHelper.updateMatrix(this.map,this.M,0,0,[0,0,0]),this.V=!0)}picked(A){if(!this.layerRenderer)return!1;const t=this.p();let s=A;A instanceof t$2.Point||(s=this.map.coordinateToContainerPoint(new t$2.Coordinate(A)));const i=this.F(s,t,"picked");return!(!i||null===i.meshId)}S(){const A=this.TransformHelper.getMeshes("scaling").scaling[0][0],t=340/177;A.scaling=[.6*t,.6*t,.6*t],this.layerRenderer&&(this.T(A),this.K())}K(){this.TransformHelper._meshes.translate.forEach((A=>{for(let t=0;t<A.length;t++){const e=A[t];L$2.indexOf(e.getUniform("uPickingId"))>-1&&e.material.set("color",e.originColor)}}))}T(e){const i=this.M.getCoordinates(),n=this.map.coordinateToPointAtRes(i,this.map.getGLRes()),o=[n.x,n.y,0],I=this.M.getTranslation();add$4(o,o,I);const r=copy$4([],e.translate),a=e.scaling;let h=C$2(this.M,this.map);h=set$4([],h,h,h),multiply$4(r,r,h),multiply$4(h,h,a),add$4(r,r,o),fromRotationTranslationScale(e.localTransform,[0,0,0,1],r,h),this.p().forEach((e=>{const i=e.getUniform("uPickingId");if(1===i||3===i||2===i||4===i){const i=copy$4([],e.translate),n=170/177;e.scaling=[n,n,n];const I=e.scaling,r=e.rotation;let a=C$2(this.M,this.map);a=set$4([],a,a,a),multiply$4(i,i,a),multiply$4(a,a,I),add$4(i,i,o);const h=fromEuler([],r[0],r[1],r[2]);fromRotationTranslationScale(e.localTransform,h,i,a)}}))}_(A){const t=this.map.containerPointToCoordinate(A),e=this.map.coordinateToPointAtRes(t,this.map.getGLRes());return{point:[e.x,e.y]}}L(A){if("transform"===this.mouseAction){const A=this.B(),t=this.M.getTranslation(),e=this.M.getPointZ(),n=this.M.getCoordinates(),o=this.map.coordinateToPointAtRes(n,this.map.getGLRes()),I=this.M.getRotation(),r=this.M.getScale();let a=null,c=null;if(t[2]+e<.01&&"z-translate"!==this.H)a=this._(this.currentMousePosition),c=this._(this.lastMousePosition);else{const A=this.TransformHelper.planeHelper.getMeshes()[0];if(a=this.F(this.currentMousePosition,A,"plane"),c=this.F(this.lastMousePosition,A,"plane"),!a||null===a.meshId||!c||null===c.meshId)return}const w=[0,0,0],B=[0,0,0];let f=0,C=0,P=0;if("translate"===A){if("xy-translate"===this.H){const t=a.point[1]-c.point[1];w[0]=a.point[0]-c.point[0],w[1]=t}else if("x-translate"===this.H){w[0]=a.point[0]-c.point[0]}else if("y-translate"===this.H){w[1]=a.point[1]-c.point[1]}else if("z-translate"===this.H){let A=0;if(this.R()){const t=this.map.getGLRes(),e=this.map._pointAtResToContainerPoint(new t$2.Point(c.point[0],c.point[1]),t),s=this.map._pointAtResToContainerPoint(new t$2.Point(a.point[0],a.point[1]),t),n=length(set(N$2,a.point[0]-c.point[0],a.point[1]-c.point[1]));A=s.y<e.y?n:-n}else A=a.point[2]-c.point[2];w[2]=Math.sign(A)*this.map.pointAtResToAltitude(A,this.map.getGLRes())}}else if("rotation"===A)C=this.G(a.point,c.point),this.TransformHelper.o(C>=0),B[2]+=C;else if("scaling"===A){const A=this.j(),t=length(set(N$2,this.firstDownPoint.point[0]-A[0],this.firstDownPoint.point[1]-A[1])),e=length(set(N$2,c.point[0]-A[0],c.point[1]-A[1]));f=this.Z(a.point,c.point,A,e,r),P=this.Z(a.point,c.point,A,t)}const m=set$4([],o.x,o.y,n.z||0),u=add$4(m,m,w),Q=this.map.pointAtResToCoordinate(new t$2.Coordinate(u[0],u[1]),this.map.getGLRes());Q.z=u[2];let l=null;l=f>=0?f:f*(this.options&&this.options.scaleStrength||1);const b=add$4(r,set$4(N$2,l,l*(r[1]/r[0]),l*(r[2]/r[0])),r);if(Math.min(...b)<.01){const A=Math.min(...r);b[0]=r[0]*(.01/A),b[1]=r[1]*(.01/A),b[2]=r[2]*(.01/A)}const y=add$4(I,B,I);this.TransformHelper.updateMatrix(this.map,this.M,C,P,w),this.H.indexOf("translate")>-1?this.fire("positionchange",{action:this.H,type:"positionchange",target:this.M,coordinate:Q}):this.fire("transforming",{action:this.H,type:"transforming",target:this.M,translate:t,rotation:y,scale:b})}this.lastMousePosition=A,this.lastPickingObject=this.currentPickingObject;const t=this.p();this.lastPickingMesh=t[this.currentPickingObject.meshId]}Z(A,t,e,s,n){const o=(length(set(N$2,A[0]-e[0],A[1]-e[1]))-length(set(N$2,t[0]-e[0],t[1]-e[1])))/s;return n?(n[0]-.01)*o:o}j(){const A=this.map,t=this.M.getCoordinates(),e=A.coordinateToPointAtRes(t,A.getGLRes()),i=set$4(T$2,e.x,e.y,0);return add$4(i,i,this.M.getTranslation()),i}U(e){const i=this.TransformHelper.planeHelper.getMeshes()[0][0],n=getTranslation$1(H$2,i.localTransform),o=getScaling(S$2,i.localTransform);let I=fromEuler(O$2,0,0,0);const r=this.map.getBearing();e&&!this.R()?(I=fromEuler(O$2,90,0,-r),0===i.rotation[0]&&(this.V=!0),set$4(i.rotation,90,0,-r)):(90===i.rotation[0]&&(this.V=!0),set$4(i.rotation,0,0,-r)),fromRotationTranslationScale(i.localTransform,I,n,o)}R(){if(this.map.getPitch())return!1;const A=this.map.cameraPosition,t=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());set$4(t,t.x,t.y,0);const e=this.M.getCoordinates(),i=this.map.coordinateToPointAtRes(e,this.map.getGLRes()),n=this.M.getTranslation(),o=set$4(H$2,i.x,i.y,0);return angle$1(subtract$2([],A,add$4(o,o,n)),subtract$2([],A,t))<1/180*Math.PI}k(){const A=this.p();if(this.currentPickingObject&&null!=this.currentPickingObject.meshId){this.J(),this.lastPickingObject&&null!=this.lastPickingObject.meshId&&this.lastPickingObject.meshId!==this.currentPickingObject.meshId&&this.Y();const t=A[this.currentPickingObject.meshId];if(t&&k$2.indexOf(this.currentPickingObject.pickingId)<0){t.material.set("color",[t.originColor[0],t.originColor[1],t.originColor[2],.8]),this.W(t,.5)}this.layerRenderer.setToRedraw()}else this.lastPickingObject&&null!=this.lastPickingObject.meshId&&(this.map.resetCursor(),this.Y(),this.layerRenderer.setToRedraw())}J(){6===this.currentPickingObject.pickingId?this.map.setCursor("ns-resize"):x$2.indexOf(this.currentPickingObject.pickingId)>-1?this.map.setCursor("move"):this.map.setCursor("pointer")}Y(){const A=this.lastPickingMesh;if(!A)return;const t=A.getUniform("uPickingId"),e=this.p();x$2.indexOf(t)>-1?e.forEach((A=>{x$2.indexOf(A.getUniform("uPickingId"))>-1&&A.material.set("color",A.originColor)})):V$2.indexOf(t)>-1?e.forEach((A=>{const t=A.getUniform("uPickingId");L$2.indexOf(t)>-1&&A.material.set("color",A.originColor)})):11===t&&e.forEach((A=>{L$2.indexOf(A.getUniform("uPickingId"))>-1&&A.material.set("color",A.originColor)})),A.material.set("color",A.originColor)}W(A,t){const e=A.getUniform("uPickingId"),s=this.p();x$2.indexOf(e)>-1?s.forEach((e=>{if(x$2.indexOf(e.getUniform("uPickingId"))>-1&&e.getUniform("uPickingId")!==A.getUniform("uPickingId")){e.material.set("color",[e.originColor[0],e.originColor[1],e.originColor[2],t])}})):"scaling"===this.I?s.forEach((A=>{const t=A.getUniform("uPickingId");if(1===t||3===t||2===t||4===t){A.material.set("color",[149/255,179/255,199/255,.8])}})):"rotation"===this.I&&s.forEach((A=>{const t=A.getUniform("uPickingId");if(1===t||3===t||2===t||4===t){const t=A.originColor;A.material.set("color",[t[0],t[1],t[2],0])}}))}reset(){if(!this.map||!this.M)return;this.M.setTranslation(this.M.originTrans),this.M.setRotation(this.q),this.M.setScale(this.X);const A=this.M.getTranslation();scale$4(A,A,-1),this.TransformHelper.updateMatrix(this.map,this.M,0,1,[0,0,0])}G(A,t){const e=this.j(),s=set(K$1,t[0]-e[0],t[1]-e[1]),n=set(_$2,A[0]-e[0],A[1]-e[1]),o=Math.atan2(s[1],s[0]);return(Math.atan2(n[1],n[0])-o)/Math.PI*180}O(A){return this.H=5===A?"xy-translate":6===A?"z-translate":7===A||9===A?"x-translate":8===A||10===A?"y-translate":11===A?"z-rotate":"scale",this.H}transform(A){if(this.layerRenderer&&this.layerRenderer.layer&&(this.layerRenderer.layer.off("renderend",this.render),this.layerRenderer.layer.off("resizeCanvas",this.$)),this.M&&(this.M.off("remove",this.AA,this),delete this.M),this.M=A,this.M.on("remove",this.AA,this),!this.map)return void console.error("should add to a target first");const t=this.map;this.M.originTrans||(this.M.originTrans=this.M.getTranslation(),this.M.originRotation=this.M.getRotation(),this.M.originScale=this.M.getScale()),this.TransformHelper.updateMatrix(t,A,0,0,[0,0,0]),this.tA(),this.V=!0}getTransformTarget(){return this.M}AA(){delete this.M}tA(){const A=this.M.getLayer();A&&(A.off("renderend",this.render),A.off("resizeCanvas",this.$));const t=this.map.getLayers();let e=null;for(let A=0;A<t.length;A++)if(t[A]instanceof zi$3){e=t[A];break}if(!e)return;const s=e.getLayers(),i=s.indexOf(A);if(i<0)return;s.splice(i,1),s.push(A);const o=this.map,I=A.getRenderer();this.layerRenderer=I,this.regl=I.regl,this.renderer=I.renderer,this.eA=this.layerRenderer.getFBORayPicking(),this.sA={projViewMatrix:o.projViewMatrix},A.on("renderend",this.render,this),A.on("resizeCanvas",this.$,this),I.setToRedraw()}$(){this.eA.clear(),this.V=!0}F(A,t,e){const s=this.map;if(!(s&&this.eA&&this.layerRenderer&&this.layerRenderer.canvas))return null;const i=s.getDevicePixelRatio(),n=A.x*i,o=A.y*i,I={projViewMatrix:this.map.projViewMatrix,pointSize:1};return(this.V||this.layerRenderer.canvas.gl&&this.layerRenderer.canvas.gl.wrap||!this.iA||this.iA!==e)&&(this.eA.render(t,I,!0),this.iA=e,this.V=!1),this.eA.pick(n,o,10,I,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}v(){const A=this.map.getDevicePixelRatio();this.nA=new ie$5({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\n\n\nvoid main()\n\n{\n\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n\n\n}\n\n",frag:"precision mediump float;\n\nuniform vec4 color;\n\n\n\nvoid main() {\n\n    gl_FragColor = color;\n\n}\n\n",uniforms:["color",{name:"projViewModelMatrix",type:"function",fn:function(A,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>this.map?this.map.width*A:1,height:()=>this.map?this.map.height*A:1},depth:{enable:!0,func:"always",mask:!1,range:[0,0]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}},defines:{}})}render(){if(!this.D())return;const A=this.p();this.helperScene.setMeshes(A);const t=this.layerRenderer.getFrameContext();if(t&&t.renderTarget&&this.layerRenderer.getFrameTimestamp()!==t.timestamp)return;this.N(),this.nA.filter=t&&t.sceneFilter;this.renderer.render(this.nA,this.sA,this.helperScene,t&&t.renderTarget&&t.renderTarget.fbo)}p(){let A=[];const t=this.TransformHelper.getMeshes(this.I);for(const e in t){if("translate"===e)continue;const s=t[e];for(let t=0;t<s.length;t++)A=A.concat(s[t])}const e=t.translate;for(let t=0;t<e.length;t++)A=A.concat(e[t]);return A}D(){const A=this.layerRenderer,t=A&&A.layer;return A&&this.M&&t&&t.isVisible()&&this.M.isVisible()&&this.regl&&this.h}}R$2.mergeOptions({scaleStrength:2}),"undefined"!=typeof console&&console.log("@maptalks/transform-control v0.8.0");
/*!
	 * @maptalks/msd-json-loader v0.1.0
	 * LICENSE : BSD-3-Clause
	 * (c) 2016-2022 maptalks.com
	 */
class t{constructor(t){this.t=t||{}}getJSON(){return e(this.t)}getId(){return this.t.id}getStyle(){return this.t.options?e(this.t.options.style):null}getData(){return this.t.options?e(this.t.options.data):null}getGeometryById(t){const r=this.t.geometries;if(!r)return null;for(let i=0;i<r.length;i++)if(r[i]&&r[i].options&&r[i].options.id===t)return e(r[i]);return null}getGeometries(){return this.t.geometries?e(this.t.geometries):[]}}function e(t){return t?JSON.parse(JSON.stringify(t)):null}
/*!
	 * @maptalks/video-layer v0.3.0
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.org
	 */
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/for(var f=[],d$1=0;d$1<6;d$1++)f[d$1]=[];var v=[];function p$1(t,e,i){var r,n,o,s,a,h,u,l,c,d,p,_,g,x,y,b,M;n=(r=t)[0],o=r[1],s=r[2],u=r[5],l=r[6],p=r[9],_=r[10],y=r[13],b=r[14],m$1(f[0],(a=r[3])-n,(c=r[7])-(h=r[4]),(g=r[11])-(d=r[8]),(M=r[15])-(x=r[12])),m$1(f[1],a+n,c+h,g+d,M+x),m$1(f[2],a+o,c+u,g+p,M+y),m$1(f[3],a-o,c-u,g-p,M-y),m$1(f[4],a-s,c-l,g-_,M-b),m$1(f[5],a+s,c+l,g+_,M+b);for(var O=0;O<6;O++)if(!i||"0"!==i.charAt(O)){var T=f[O];if(v[0]=T[0]>0?e[1][0]:e[0][0],v[1]=T[1]>0?e[1][1]:e[0][1],v[2]=T[2]>0?e[1][2]:e[0][2],w$1(T,v)<0)return!1}return!0}function m$1(t,e,i,r,n){var o=1/Math.sqrt(e*e+i*i+r*r);return t[0]=e*o,t[1]=i*o,t[2]=r*o,t[3]=n*o,t}function w$1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}var _$1=x$1,g$1=x$1;function x$1(t,e,i){i=i||2;var r,n,o,s,a,h,u,l=e&&e.length,c=l?e[0]*i:t.length,f=y$1(t,0,c,i,!0),d=[];if(!f||f.next===f.prev)return d;if(l&&(f=function(t,e,i,r){var n,o,h,u=[];for(n=0,o=e.length;n<o;n++)(h=y$1(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===h.next&&(h.steiner=!0),u.push(k$1(h));for(u.sort(E$1),n=0;n<u.length;n++)i=P$1(u[n],i);return i}(t,e,f,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var v=i;v<c;v+=i)(a=t[v])<r&&(r=a),(h=t[v+1])<n&&(n=h),a>o&&(o=a),h>s&&(s=h);u=0!==(u=Math.max(o-r,s-n))?32767/u:0}return M$1(f,d,i,r,n,u,0),d}function y$1(t,e,i,r,n){var o,s;if(n===B$1(t,e,i,r)>0)for(o=e;o<i;o+=r)s=W$1(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=W$1(o,t[o],t[o+1],s);return s&&L$1(s,s.next)&&(X$1(s),s=s.next),s}function b$1(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!L$1(r,r.next)&&0!==D$1(r.prev,r,r.next))r=r.next;else{if(X$1(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function M$1(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{0===n.z&&(n.z=A(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,h,u=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<u&&(a++,r=r.nextZ);e++);for(h=u;a>0||h>0&&r;)0!==a&&(0===h||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,h--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(s>1)}(n)}(t,r,n,o);for(var a,h,u=t;t.prev!==t.next;)if(a=t.prev,h=t.next,o?T$1(t,r,n,o):O$1(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),X$1(t),t=h.next,u=h.next;else if((t=h)===u){s?1===s?M$1(t=C$1(b$1(t),e,i),e,i,r,n,o,2):2===s&&S$1(t,e,i,r,n,o):M$1(b$1(t),e,i,r,n,o,1);break}}}function O$1(t){var e=t.prev,i=t,r=t.next;if(D$1(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,s=r.x,a=e.y,h=i.y,u=r.y,l=n<o?n<s?n:s:o<s?o:s,c=a<h?a<u?a:u:h<u?h:u,f=n>o?n>s?n:s:o>s?o:s,d=a>h?a>u?a:u:h>u?h:u,v=r.next;v!==e;){if(v.x>=l&&v.x<=f&&v.y>=c&&v.y<=d&&I$1(n,a,o,h,s,u,v.x,v.y)&&D$1(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function T$1(t,e,i,r){var n=t.prev,o=t,s=t.next;if(D$1(n,o,s)>=0)return!1;for(var a=n.x,h=o.x,u=s.x,l=n.y,c=o.y,f=s.y,d=a<h?a<u?a:u:h<u?h:u,v=l<c?l<f?l:f:c<f?c:f,p=a>h?a>u?a:u:h>u?h:u,m=l>c?l>f?l:f:c>f?c:f,w=A(d,v,e,i,r),_=A(p,m,e,i,r),g=t.prevZ,x=t.nextZ;g&&g.z>=w&&x&&x.z<=_;){if(g.x>=d&&g.x<=p&&g.y>=v&&g.y<=m&&g!==n&&g!==s&&I$1(a,l,h,c,u,f,g.x,g.y)&&D$1(g.prev,g,g.next)>=0)return!1;if(g=g.prevZ,x.x>=d&&x.x<=p&&x.y>=v&&x.y<=m&&x!==n&&x!==s&&I$1(a,l,h,c,u,f,x.x,x.y)&&D$1(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;g&&g.z>=w;){if(g.x>=d&&g.x<=p&&g.y>=v&&g.y<=m&&g!==n&&g!==s&&I$1(a,l,h,c,u,f,g.x,g.y)&&D$1(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;x&&x.z<=_;){if(x.x>=d&&x.x<=p&&x.y>=v&&x.y<=m&&x!==n&&x!==s&&I$1(a,l,h,c,u,f,x.x,x.y)&&D$1(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function C$1(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!L$1(n,o)&&j$1(n,r,r.next,o)&&G$1(n,o)&&G$1(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),X$1(r),X$1(r.next),r=t=o),r=r.next}while(r!==t);return b$1(r)}function S$1(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&R$1(s,a)){var h=H$1(s,a);return s=b$1(s,s.next),h=b$1(h,h.next),M$1(s,e,i,r,n,o,0),void M$1(h,e,i,r,n,o,0)}a=a.next}s=s.next}while(s!==t)}function E$1(t,e){return t.x-e.x}function P$1(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==e);if(!i)return null;var h,u=i,l=i.x,c=i.y,f=1/0;r=i;do{n>=r.x&&r.x>=l&&n!==r.x&&I$1(o<c?n:s,o,l,c,o<c?s:n,o,r.x,r.y)&&(h=Math.abs(o-r.y)/(n-r.x),G$1(r,t)&&(h<f||h===f&&(r.x>i.x||r.x===i.x&&V$1(i,r)))&&(i=r,f=h)),r=r.next}while(r!==u);return i}(t,e);if(!i)return e;var r=H$1(i,t);return b$1(r,r.next),b$1(i,i.next)}function V$1(t,e){return D$1(t.prev,t,e.prev)<0&&D$1(e.next,t,t.next)<0}function A(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function k$1(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function I$1(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function R$1(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&j$1(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(G$1(t,e)&&G$1(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(D$1(t.prev,t,e.prev)||D$1(t,e.prev,e))||L$1(t,e)&&D$1(t.prev,t,t.next)>0&&D$1(e.prev,e,e.next)>0)}function D$1(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function L$1(t,e){return t.x===e.x&&t.y===e.y}function j$1(t,e,i,r){var n=N$1(D$1(t,e,i)),o=N$1(D$1(t,e,r)),s=N$1(D$1(i,r,t)),a=N$1(D$1(i,r,e));return n!==o&&s!==a||!(0!==n||!F$1(t,i,e))||!(0!==o||!F$1(t,r,e))||!(0!==s||!F$1(i,t,r))||!(0!==a||!F$1(i,e,r))}function F$1(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function N$1(t){return t>0?1:t<0?-1:0}function G$1(t,e){return D$1(t.prev,t,t.next)<0?D$1(t,e,t.next)>=0&&D$1(t,t.prev,e)>=0:D$1(t,e,t.prev)<0||D$1(t,t.next,e)<0}function H$1(t,e){var i=new z$1(t.i,t.x,t.y),r=new z$1(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function W$1(t,e,i,r){var n=new z$1(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function X$1(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function z$1(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function B$1(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}x$1.deviation=function(t,e,i,r){var n=e&&e.length,s=Math.abs(B$1(t,0,n?e[0]*i:t.length,i));if(n)for(var a=0,h=e.length;a<h;a++){s-=Math.abs(B$1(t,e[a]*i,a<h-1?e[a+1]*i:t.length,i))}var c=0;for(a=0;a<r.length;a+=3){var f=r[a]*i,d=r[a+1]*i,v=r[a+2]*i;c+=Math.abs((t[f]-t[v])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[v+1]-t[f+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},x$1.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&i.holes.push(r+=t[n-1].length)}return i},_$1.default=g$1;const q$1={vert:"\n    attribute vec3 aPosition;\n    attribute vec2 aTexCoord;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 positionMatrix;\n    uniform mat4 modelMatrix;\n    varying vec2 vTexCoords;\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        vTexCoords = aTexCoord;\n    }\n",frag:"\n    precision mediump float;\n    uniform sampler2D videoTexture;\n    uniform float opacity;\n\n    varying vec2 vTexCoords;\n    void main() {\n        vec4 color = texture2D(videoTexture, vTexCoords);\n        gl_FragColor = color * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5([],e.projViewMatrix,e.modelMatrix)},"texture","opacity"],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,func:"always"},cull:{enable:!1,face:"back"},frontFace:"cw",blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}};function Z$1(t,e,i){if(!t)return null;const r=t.coordinateToPointAtRes(e,t.getGLRes());return[r.x,r.y,i]}class $$1 extends t$2.Layer{constructor(t,e,i){super(t,i),this.t={},this.videoId=0,this.addSurfaces(e)}addSurfaces(t){if(t)if(Array.isArray(t))t.forEach((t=>{this.addMarker(t)}));else{t.o=this,this.t[this.videoId]=t,t.s(this.videoId);const e=this.getRenderer();e?e.h()&&e.u(t):this.on("renderercreate",(e=>{e.renderer.h()&&e.renderer.u(t)})),this.videoId++}}showTopAlways(t){this.options.showTopAlways=t;const e=this.getRenderer();e&&e.l()}getVideoSurfaces(){const t=[];for(const e in this.t)t.push(this.t[e]);return t}removeVideoSurfaces(t){if(Array.isArray(t))t.forEach((t=>{this.removeVideoSurfaces(t)}));else{const e=t.v(),i=this.getRenderer();i&&i.p(e),delete this.t[e]}}remove(){this.clear(),super.remove()}clear(){const t=this.getVideoSurfaces();for(let e=0;e<t.length;e++)t[e].remove()}}$$1.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,showTopAlways:!0}),$$1.registerJSONType("VideoLayer"),$$1.registerRenderer("gl",class extends t$2.renderer.CanvasRenderer{constructor(t){super(t),this.m={}}draw(t,e){this.prepareCanvas(),this._(e)}drawOnInteracting(t,e,i){this._(i)}needToRedraw(){return!0}hitDetect(){return!1}createContext(){if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this.g(this.canvas,t),this.regl=h$1({gl:this.gl,extensions:["ANGLE_instanced_arrays","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","WEBGL_depth_texture"],optionalExtensions:this.layer.options.glExtensions||[]})}this.M(),this.O();const t=this.layer.getVideoSurfaces();for(let e=0;e<t.length;e++)this.u(t[e])}g(t,e){const i=["webgl","experimental-webgl"];let r=null;for(let n=0;n<i.length;++n){try{r=t.getContext(i[n],e)}catch(t){}if(r)break}return r}O(){const t=this.layer.getMap(),e=new N$8(this.regl);this.renderer=e,this.T={projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,viewMatrix:t.viewMatrix,halton:[.2107,-.0202],uHalton:[.2107,-.0202],uCameraPosition:t.cameraPosition,cameraPosition:t.cameraPosition,globalTexSize:[t.width,t.height]}}h(){return this.regl}M(){this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.l()}l(){this.C&&this.C.dispose(),this.layer.options.showTopAlways?(q$1.extraCommandProps.depth.mask=!1,q$1.extraCommandProps.depth.range=[0,0]):(delete q$1.extraCommandProps.depth.mask,delete q$1.extraCommandProps.depth.range),this.C=new ie$5(q$1)}u(t){const e=this.regl.texture(),i=new tt$6({videoTexture:e,opacity:1}),r=t.getCoordinates(),{worldCenter:n,points:o}=this.S(r),s=this.P(o),a=new ft$6(s,i);this.V(a,n);const h=new yt$6(a),l=t.v();this.m[l]=h}A(t){const e=t.v(),i=this.m[e].getMeshes()[0],r=t.getCoordinates();i.geometry.dispose();const{worldCenter:n,points:o}=this.S(r),s=this.P(o);i.geometry=s,this.V(i,n)}_(t){const e=this.layer.getVideoSurfaces().filter((t=>t.isVisible()));if(!e.length)return;const i=this.k(e);if(!i)return;let r=null;t&&(r=t.renderTarget&&t.renderTarget.fbo),this.renderer.render(this.C,this.T,i,r)}P(t){const e=_$1(t,null,3);return new Q$7({POSITION:t,TEXCOORD:[0,0,1,0,1,1,0,1]},e,0,{primitive:"triangles",positionAttribute:"POSITION",uv0Attribute:"TEXCOORD",normalAttribute:"NORMAL",positionSize:3})}S(t){let r=[];const n=this.getMap(),o=new t$2.Polygon(t).getCenter(),s=Z$1(n,o,0);return this.I=s,n&&t.forEach((t=>{const e=new t$2.Coordinate(t[0],t[1]),o=n.altitudeToPoint(t[2]||0,n.getGLRes()),a=Z$1(n,e,o);a[0]=a[0]-s[0],a[1]=a[1]-s[1],r=r.concat(a)})),{worldCenter:s,points:r}}k(t){const e=[],i=this.layer.getMap();for(let r=0;r<t.length;r++){const n=t[r],o=this.m[n.v()];if(!o)continue;const s=o.getMeshes();for(let t=0;t<s.length;t++){const r=s[t],o=r.getMaterial(),a=o.get("videoTexture");a&&n.R()&&(a(n.video),o.set("opacity",n.getOpacity())),p$1(i.projViewMatrix,r.getBoundingBox())&&e.push(r)}}return e.length?new yt$6(e):null}V(t,e){fromRotationTranslationScale(t.localTransform,fromEuler([],0,0,0),e,[1,1,1])}remove(){this.C&&this.C.dispose(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}p(t){const e=this.m[t];e&&e.getMeshes().forEach((t=>{t.geometry.dispose(),t.material&&t.material.dispose(),t.dispose()}))}});class J$1 extends(t$2.Eventable(t$2.Handlerable(t$2.Class))){constructor(t,e){super(e),this.setCoordinates(t),this.setVideo(this.options.url)}setCoordinates(t){this.D=t}getCoordinates(){return this.D}setVideo(t){this.L="stop",this.options.url=t;const e=document.createElement("video");e.src=t,e.autoplay=!0,e.loop=!0,e.muted=!0,e.play(),e.addEventListener("playing",(()=>{this.L="playing",this.fire("playing",{state:this.L,url:t})})),e.addEventListener("pause",(()=>{this.L="pause",this.fire("pause",{state:this.L,url:t})})),this.video=e}getVideo(){return this.video}s(t){this.j=t}v(){return this.j}addTo(t){if(this.o)throw new Error("VideoSurface cannot be added to two or more layers at the same time.");return t.addSurfaces(this),this}show(){return this.options.visible=!0,this}hide(){return this.options.visible=!1,this}isVisible(){return this.options.visible}play(){this.video&&this.video.play()}pause(){this.video&&this.video.pause()}setAudio(t){this.video.muted=t}setOpacity(t){this.options.opacity=t}getOpacity(){return this.options.opacity}remove(){delete this.video;const t=this.getLayer();t&&t.removeVideoSurfaces(this),this.endEdit()}getLayer(){return this.o}R(){return"playing"===this.L||"pause"===this.L}startEdit(){const t=this.getLayer();if(!t)return void console.warn("videosurface should be added to a map before edit");const i=t.getMap();if(!i)return void console.warn("videosurface should be added to a map before edit");if(this.F(),!this.N){const e=t.getId();this.N=new t$2.VectorLayer(`internal_${e}_edit`,{enableAltitude:!0}).addTo(i)}const r=this.getCoordinates();this.G=new t$2.Polygon(r,{symbol:{lineColor:"#34495e",lineWidth:2,polygonFill:"rgb(135,196,240)",polygonOpacity:.1}}).addTo(this.N),this.G.startEdit({newVertexHandleSymbol:{polygonFill:"rgba(0, 0, 0, 0)",polygonOpacity:0,markerType:"ellipse",markerWidth:1,markerHeight:1}}),this.G.on("shapechange",(e=>{const i=e.target.getCoordinates()[0].slice(0,4).map((t=>[t.x,t.y,0]));this.setCoordinates(i),t.getRenderer().A(this)}),this)}endEdit(){this.N&&(this.G.endEdit(),this.G.remove(),this.N.remove()),delete this.N,delete this.G}F(){this.N&&this.N.clear(),delete this.G}}J$1.mergeOptions({opacity:1,visible:!0}),"undefined"!=typeof console&&console.log("@maptalks/video-layer v0.3.0");
/*!
	 * @maptalks/analysis v0.81.4
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.org
	 */
var Y,w="undefined"!=typeof Float32Array?Float32Array:Array;function P(A){return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A}function g(A,t,n){var i=t[0],r=t[1],e=t[2],s=t[3],u=t[4],o=t[5],h=t[6],f=t[7],c=t[8],a=t[9],v=t[10],l=t[11],w=t[12],P=t[13],g=t[14],C=t[15],D=n[0],I=n[1],M=n[2],b=n[3];return A[0]=D*i+I*u+M*c+b*w,A[1]=D*r+I*o+M*a+b*P,A[2]=D*e+I*h+M*v+b*g,A[3]=D*s+I*f+M*l+b*C,A[4]=(D=n[4])*i+(I=n[5])*u+(M=n[6])*c+(b=n[7])*w,A[5]=D*r+I*o+M*a+b*P,A[6]=D*e+I*h+M*v+b*g,A[7]=D*s+I*f+M*l+b*C,A[8]=(D=n[8])*i+(I=n[9])*u+(M=n[10])*c+(b=n[11])*w,A[9]=D*r+I*o+M*a+b*P,A[10]=D*e+I*h+M*v+b*g,A[11]=D*s+I*f+M*l+b*C,A[12]=(D=n[12])*i+(I=n[13])*u+(M=n[14])*c+(b=n[15])*w,A[13]=D*r+I*o+M*a+b*P,A[14]=D*e+I*h+M*v+b*g,A[15]=D*s+I*f+M*l+b*C,A}function C(A,t,n){var i=n[0],r=n[1],e=n[2];return A[0]=t[0]*i,A[1]=t[1]*i,A[2]=t[2]*i,A[3]=t[3]*i,A[4]=t[4]*r,A[5]=t[5]*r,A[6]=t[6]*r,A[7]=t[7]*r,A[8]=t[8]*e,A[9]=t[9]*e,A[10]=t[10]*e,A[11]=t[11]*e,A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15],A}function D(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[4],s=t[5],u=t[6],o=t[7],h=t[8],f=t[9],c=t[10],a=t[11];return t!==A&&(A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[3],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[4]=e*r+h*i,A[5]=s*r+f*i,A[6]=u*r+c*i,A[7]=o*r+a*i,A[8]=h*r-e*i,A[9]=f*r-s*i,A[10]=c*r-u*i,A[11]=a*r-o*i,A}function I(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[0],s=t[1],u=t[2],o=t[3],h=t[8],f=t[9],c=t[10],a=t[11];return t!==A&&(A[4]=t[4],A[5]=t[5],A[6]=t[6],A[7]=t[7],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[0]=e*r-h*i,A[1]=s*r-f*i,A[2]=u*r-c*i,A[3]=o*r-a*i,A[8]=e*i+h*r,A[9]=s*i+f*r,A[10]=u*i+c*r,A[11]=o*i+a*r,A}function M(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[0],s=t[1],u=t[2],o=t[3],h=t[4],f=t[5],c=t[6],a=t[7];return t!==A&&(A[8]=t[8],A[9]=t[9],A[10]=t[10],A[11]=t[11],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[0]=e*r+h*i,A[1]=s*r+f*i,A[2]=u*r+c*i,A[3]=o*r+a*i,A[4]=h*r-e*i,A[5]=f*r-s*i,A[6]=c*r-u*i,A[7]=a*r-o*i,A}function b(A,t){return A[0]=t[12],A[1]=t[13],A[2]=t[14],A}function z(A,t,n,i){var r=t[0],e=t[1],s=t[2],u=t[3],o=r+r,h=e+e,f=s+s,c=r*o,a=r*h,v=r*f,l=e*h,w=e*f,P=s*f,g=u*o,C=u*h,D=u*f,I=i[0],M=i[1],b=i[2];return A[0]=(1-(l+P))*I,A[1]=(a+D)*I,A[2]=(v-C)*I,A[3]=0,A[4]=(a-D)*M,A[5]=(1-(c+P))*M,A[6]=(w+g)*M,A[7]=0,A[8]=(v+C)*b,A[9]=(w-g)*b,A[10]=(1-(c+l))*b,A[11]=0,A[12]=n[0],A[13]=n[1],A[14]=n[2],A[15]=1,A}function x(A,t,n,i,r){var e=1/Math.tan(t/2),s=void 0;return A[0]=e/n,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=e,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,null!=r&&r!==1/0?(A[10]=(r+i)*(s=1/(i-r)),A[14]=2*r*i*s):(A[10]=-1,A[14]=-2*i),A}function d(A,t,n,i){var r=void 0,e=void 0,s=void 0,u=void 0,o=void 0,h=void 0,f=void 0,c=void 0,a=void 0,v=void 0,l=t[0],w=t[1],g=t[2],C=i[0],D=i[1],I=i[2],M=n[0],b=n[1],z=n[2];return Math.abs(l-M)<1e-6&&Math.abs(w-b)<1e-6&&Math.abs(g-z)<1e-6?P(A):(f=l-M,c=w-b,a=g-z,r=D*(a*=v=1/Math.sqrt(f*f+c*c+a*a))-I*(c*=v),e=I*(f*=v)-C*a,s=C*c-D*f,(v=Math.sqrt(r*r+e*e+s*s))?(r*=v=1/v,e*=v,s*=v):(r=0,e=0,s=0),u=c*s-a*e,o=a*r-f*s,h=f*e-c*r,(v=Math.sqrt(u*u+o*o+h*h))?(u*=v=1/v,o*=v,h*=v):(u=0,o=0,h=0),A[0]=r,A[1]=u,A[2]=f,A[3]=0,A[4]=e,A[5]=o,A[6]=c,A[7]=0,A[8]=s,A[9]=h,A[10]=a,A[11]=0,A[12]=-(r*l+e*w+s*g),A[13]=-(u*l+o*w+h*g),A[14]=-(f*l+c*w+a*g),A[15]=1,A)}function y(){var A=new w(3);return w!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function p(A,t,n){var i=new w(3);return i[0]=A,i[1]=t,i[2]=n,i}function L(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A}function T(A,t,n,i){return A[0]=t,A[1]=n,A[2]=i,A}function O(A,t,n){return A[0]=t[0]+n[0],A[1]=t[1]+n[1],A[2]=t[2]+n[2],A}function F(A,t,n){return A[0]=t[0]-n[0],A[1]=t[1]-n[1],A[2]=t[2]-n[2],A}function E(A,t){var n=t[0],i=t[1],r=t[2],e=n*n+i*i+r*r;return e>0&&(e=1/Math.sqrt(e),A[0]=t[0]*e,A[1]=t[1]*e,A[2]=t[2]*e),A}function j(A,t,n){var i=t[0],r=t[1],e=t[2],s=n[3]*i+n[7]*r+n[11]*e+n[15];return A[0]=(n[0]*i+n[4]*r+n[8]*e+n[12])/(s=s||1),A[1]=(n[1]*i+n[5]*r+n[9]*e+n[13])/s,A[2]=(n[2]*i+n[6]*r+n[10]*e+n[14])/s,A}function N(A,t){var n=p(A[0],A[1],A[2]),i=p(t[0],t[1],t[2]);E(n,n),E(i,i);var r=function(A,t){return A[0]*t[0]+A[1]*t[1]+A[2]*t[2]}(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}function Q(){var A=new w(4);return w!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A[3]=1,A}function S(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A}function B(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o+s*u,A[1]=r*o+e*u,A[2]=e*o-r*u,A[3]=s*o-i*u,A}function R(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o-e*u,A[1]=r*o+s*u,A[2]=e*o+i*u,A[3]=s*o-r*u,A}function k(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o+r*u,A[1]=r*o-i*u,A[2]=e*o+s*u,A[3]=s*o-e*u,A}function G(A,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var e=Math.sin(t),s=Math.cos(t),u=Math.sin(n),o=Math.cos(n),h=Math.sin(i),f=Math.cos(i);return A[0]=e*o*f-s*u*h,A[1]=s*u*f+e*o*h,A[2]=s*o*h-e*u*f,A[3]=s*o*f+e*u*h,A}function W(A,t,n){return A[0]=t,A[1]=n,A}y(),function(){var A;A=new w(4),w!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0)}(),y(),p(1,0,0),p(0,1,0),Q(),Q(),Y=new w(9),w!=Float32Array&&(Y[1]=0,Y[2]=0,Y[3]=0,Y[5]=0,Y[6]=0,Y[7]=0),Y[0]=1,Y[4]=1,Y[8]=1,function(){var A=new w(2);w!=Float32Array&&(A[0]=0,A[1]=0)}();class q{constructor(A,t){this.renderer=A,this.regl=A.regl,this.u=t,this.h()}h(){this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:2048,height:2048,wrap:"clamp",mag:"nearest",min:"nearest"}),depth:!0})}g(A,t,n){const i={projViewMatrix:t,logDepthBufFC:2/(Math.log(n+1)/Math.LN2)};this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.l}),this.renderer.render(this.C,i,A,this.l)}D(t,n){this.C=new ie$5({vert:"#include <gl2_vert>\n\n#ifdef HAS_ALTITUDE\n\n    attribute vec2 aPosition;\n\n    attribute float aAltitude;\n\n#else\n\n    attribute vec3 aPosition;\n\n#endif\n\n// uniform mat4 projViewMatrix;\n\n// uniform mat4 modelMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 positionMatrix;\n\nvarying vec2 vHighPrecisionZW;\n\n#include <get_output>\n\nvarying float vFragDepth;\n\n\n\n#ifdef HAS_ALTITUDE\n\n    vec3 unpackVTPosition() {\n\n        return vec3(aPosition, aAltitude);\n\n    }\n\n#endif\n\nvoid main()\n\n{\n\n    #ifdef HAS_ALTITUDE\n\n        vec3 i = unpackVTPosition();\n\n        vec4 j = vec4(i, 1.);\n\n        gl_Position = projViewModelMatrix * j;\n\n    #else\n\n        mat4 localPositionMatrix = getPositionMatrix();\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    #endif\n\n    vFragDepth = 1.0 + gl_Position.w;\n\n    vHighPrecisionZW = gl_Position.zw;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n#include <gl2_frag>\n\n\n\nuniform float logDepthBufFC;\n\nvarying float vFragDepth;\n\nvarying vec2 vHighPrecisionZW;\n\n\n\nconst float PackUpscale = 256. / 255.;\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA(const in float v ) {\n\n    vec4 r = vec4(fract(v * PackFactors), v);\n\n    r.yzw -= r.xyz * ShiftRight8;\n\n    return r * PackUpscale;\n\n}\n\nvoid main() {\n\n    gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n    glFragColor = packDepthToRGBA(fragCoordZ);\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>g([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:{x:0,y:0,width:()=>{const A=this.I(t,n);return A?A.width:1},height:()=>{const A=this.I(t,n);return A?A.height:1}}}}),this.C.version=300}I(A,t){if(this.m(A,t))return A>=t?{width:2048,height:2048*t/A}:{width:2048*A/t,height:2048}}m(A,t){return A&&t&&A*t>0}dispose(){this.l&&this.l.destroy(),this.C&&this.C.dispose()}}const V=[0,0,0,1];class K extends q{h(){this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.O=new ie$5({vert:"attribute vec3 aPosition;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n\n\nvoid main() {\n\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,n)=>multiply$5([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.F=new yt$6}render(A,t){this.U(),this.renderer.clear({color:V,depth:1,framebuffer:this.T}),this.F.setMeshes(A);return this.renderer.render(this.O,{projViewMatrix:t},this.F,this.T),this.T}U(){const A=t__namespace.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t__namespace.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t)}dispose(){this.T&&(this.T.destroy(),delete this.T),this.O&&(this.O.dispose(),delete this.O)}}function H(A){return!function(A){return null==A}(A)}function _(A,t){return A.altitudeToPoint(t||0,A.getGLRes())}const J=new t__namespace.Coordinate(0,0);function Z(A,t,n,i){if(!A)return null;J.set(t,n);const r=A.coordinateToPointAtRes(J,A.getGLRes()),e=_(A,i);return[r.x,r.y,e]}var X={exports:{}};function $(A,t,n){n=n||2;var i,r,e,s,u,o,h,f=t&&t.length,c=f?t[0]*n:A.length,a=AA(A,0,c,n,!0),v=[];if(!a||a.next===a.prev)return v;if(f&&(a=function(A,t,n,i){var r,e,o,h=[];for(r=0,e=t.length;r<e;r++)(o=AA(A,t[r]*i,r<e-1?t[r+1]*i:A.length,i,!1))===o.next&&(o.steiner=!0),h.push(cA(o));for(h.sort(uA),r=0;r<h.length;r++)n=oA(h[r],n);return n}(A,t,a,n)),A.length>80*n){i=e=A[0],r=s=A[1];for(var l=n;l<c;l+=n)(u=A[l])<i&&(i=u),(o=A[l+1])<r&&(r=o),u>e&&(e=u),o>s&&(s=o);h=0!==(h=Math.max(e-i,s-r))?32767/h:0}return nA(a,v,n,i,r,h,0),v}function AA(A,t,n,i,r){var e,s;if(r===xA(A,t,n,i)>0)for(e=t;e<n;e+=i)s=MA(e,A[e],A[e+1],s);else for(e=n-i;e>=t;e-=i)s=MA(e,A[e],A[e+1],s);return s&&wA(s,s.next)&&(bA(s),s=s.next),s}function tA(A,t){if(!A)return A;t||(t=A);var n,i=A;do{if(n=!1,i.steiner||!wA(i,i.next)&&0!==lA(i.prev,i,i.next))i=i.next;else{if(bA(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function nA(A,t,n,i,r,e,s){if(A){!s&&e&&function(A,t,n,i){var r=A;do{0===r.z&&(r.z=fA(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==A);r.prevZ.nextZ=null,r.prevZ=null,function(A){var t,n,i,r,e,s,u,o,h=1;do{for(n=A,A=null,e=null,s=0;n;){for(s++,i=n,u=0,t=0;t<h&&(u++,i=i.nextZ);t++);for(o=h;u>0||o>0&&i;)0!==u&&(0===o||!i||n.z<=i.z)?(r=n,n=n.nextZ,u--):(r=i,i=i.nextZ,o--),e?e.nextZ=r:A=r,r.prevZ=e,e=r;n=i}e.nextZ=null,h*=2}while(s>1)}(r)}(A,i,r,e);for(var u,o,h=A;A.prev!==A.next;)if(u=A.prev,o=A.next,e?rA(A,i,r,e):iA(A))t.push(u.i/n|0),t.push(A.i/n|0),t.push(o.i/n|0),bA(A),A=o.next,h=o.next;else if((A=o)===h){s?1===s?nA(A=eA(tA(A),t,n),t,n,i,r,e,2):2===s&&sA(A,t,n,i,r,e):nA(tA(A),t,n,i,r,e,1);break}}}function iA(A){var t=A.prev,n=A,i=A.next;if(lA(t,n,i)>=0)return!1;for(var r=t.x,e=n.x,s=i.x,u=t.y,o=n.y,h=i.y,f=r<e?r<s?r:s:e<s?e:s,c=u<o?u<h?u:h:o<h?o:h,a=r>e?r>s?r:s:e>s?e:s,v=u>o?u>h?u:h:o>h?o:h,l=i.next;l!==t;){if(l.x>=f&&l.x<=a&&l.y>=c&&l.y<=v&&aA(r,u,e,o,s,h,l.x,l.y)&&lA(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function rA(A,t,n,i){var r=A.prev,e=A,s=A.next;if(lA(r,e,s)>=0)return!1;for(var u=r.x,o=e.x,h=s.x,f=r.y,c=e.y,a=s.y,v=u<o?u<h?u:h:o<h?o:h,l=f<c?f<a?f:a:c<a?c:a,w=u>o?u>h?u:h:o>h?o:h,P=f>c?f>a?f:a:c>a?c:a,g=fA(v,l,t,n,i),C=fA(w,P,t,n,i),D=A.prevZ,I=A.nextZ;D&&D.z>=g&&I&&I.z<=C;){if(D.x>=v&&D.x<=w&&D.y>=l&&D.y<=P&&D!==r&&D!==s&&aA(u,f,o,c,h,a,D.x,D.y)&&lA(D.prev,D,D.next)>=0)return!1;if(D=D.prevZ,I.x>=v&&I.x<=w&&I.y>=l&&I.y<=P&&I!==r&&I!==s&&aA(u,f,o,c,h,a,I.x,I.y)&&lA(I.prev,I,I.next)>=0)return!1;I=I.nextZ}for(;D&&D.z>=g;){if(D.x>=v&&D.x<=w&&D.y>=l&&D.y<=P&&D!==r&&D!==s&&aA(u,f,o,c,h,a,D.x,D.y)&&lA(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;I&&I.z<=C;){if(I.x>=v&&I.x<=w&&I.y>=l&&I.y<=P&&I!==r&&I!==s&&aA(u,f,o,c,h,a,I.x,I.y)&&lA(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function eA(A,t,n){var i=A;do{var r=i.prev,e=i.next.next;!wA(r,e)&&PA(r,i,i.next,e)&&DA(r,e)&&DA(e,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(e.i/n|0),bA(i),bA(i.next),i=A=e),i=i.next}while(i!==A);return tA(i)}function sA(A,t,n,i,r,e){var s=A;do{for(var u=s.next.next;u!==s.prev;){if(s.i!==u.i&&vA(s,u)){var o=IA(s,u);return s=tA(s,s.next),o=tA(o,o.next),nA(s,t,n,i,r,e,0),void nA(o,t,n,i,r,e,0)}u=u.next}s=s.next}while(s!==A)}function uA(A,t){return A.x-t.x}function oA(A,t){var n=function(A,t){var n,i=t,r=A.x,e=A.y,s=-1/0;do{if(e<=i.y&&e>=i.next.y&&i.next.y!==i.y){var u=i.x+(e-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(u<=r&&u>s&&(s=u,n=i.x<i.next.x?i:i.next,u===r))return n}i=i.next}while(i!==t);if(!n)return null;var o,h=n,f=n.x,c=n.y,a=1/0;i=n;do{r>=i.x&&i.x>=f&&r!==i.x&&aA(e<c?r:s,e,f,c,e<c?s:r,e,i.x,i.y)&&(o=Math.abs(e-i.y)/(r-i.x),DA(i,A)&&(o<a||o===a&&(i.x>n.x||i.x===n.x&&hA(n,i)))&&(n=i,a=o)),i=i.next}while(i!==h);return n}(A,t);if(!n)return t;var i=IA(n,A);return tA(i,i.next),tA(n,n.next)}function hA(A,t){return lA(A.prev,A,t.prev)<0&&lA(t.next,A,A.next)<0}function fA(A,t,n,i,r){return(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-n)*r|0)|A<<8))|A<<4))|A<<2))|A<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function cA(A){var t=A,n=A;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==A);return n}function aA(A,t,n,i,r,e,s,u){return(r-s)*(t-u)>=(A-s)*(e-u)&&(A-s)*(i-u)>=(n-s)*(t-u)&&(n-s)*(e-u)>=(r-s)*(i-u)}function vA(A,t){return A.next.i!==t.i&&A.prev.i!==t.i&&!function(A,t){var n=A;do{if(n.i!==A.i&&n.next.i!==A.i&&n.i!==t.i&&n.next.i!==t.i&&PA(n,n.next,A,t))return!0;n=n.next}while(n!==A);return!1}(A,t)&&(DA(A,t)&&DA(t,A)&&function(A,t){var n=A,i=!1,r=(A.x+t.x)/2,e=(A.y+t.y)/2;do{n.y>e!=n.next.y>e&&n.next.y!==n.y&&r<(n.next.x-n.x)*(e-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==A);return i}(A,t)&&(lA(A.prev,A,t.prev)||lA(A,t.prev,t))||wA(A,t)&&lA(A.prev,A,A.next)>0&&lA(t.prev,t,t.next)>0)}function lA(A,t,n){return(t.y-A.y)*(n.x-t.x)-(t.x-A.x)*(n.y-t.y)}function wA(A,t){return A.x===t.x&&A.y===t.y}function PA(A,t,n,i){var r=CA(lA(A,t,n)),e=CA(lA(A,t,i)),s=CA(lA(n,i,A)),u=CA(lA(n,i,t));return r!==e&&s!==u||!(0!==r||!gA(A,n,t))||!(0!==e||!gA(A,i,t))||!(0!==s||!gA(n,A,i))||!(0!==u||!gA(n,t,i))}function gA(A,t,n){return t.x<=Math.max(A.x,n.x)&&t.x>=Math.min(A.x,n.x)&&t.y<=Math.max(A.y,n.y)&&t.y>=Math.min(A.y,n.y)}function CA(A){return A>0?1:A<0?-1:0}function DA(A,t){return lA(A.prev,A,A.next)<0?lA(A,t,A.next)>=0&&lA(A,A.prev,t)>=0:lA(A,t,A.prev)<0||lA(A,A.next,t)<0}function IA(A,t){var n=new zA(A.i,A.x,A.y),i=new zA(t.i,t.x,t.y),r=A.next,e=t.prev;return A.next=t,t.prev=A,n.next=r,r.prev=n,i.next=n,n.prev=i,e.next=i,i.prev=e,i}function MA(A,t,n,i){var r=new zA(A,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function bA(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function zA(A,t,n){this.i=A,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xA(A,t,n,i){for(var r=0,e=t,s=n-i;e<n;e+=i)r+=(A[s]-A[e])*(A[e+1]+A[s+1]),s=e;return r}X.exports=$,X.exports.default=$,$.deviation=function(A,t,n,i){var r=t&&t.length,s=Math.abs(xA(A,0,r?t[0]*n:A.length,n));if(r)for(var u=0,o=t.length;u<o;u++){s-=Math.abs(xA(A,t[u]*n,u<o-1?t[u+1]*n:A.length,n))}var c=0;for(u=0;u<i.length;u+=3){var a=i[u]*n,v=i[u+1]*n,l=i[u+2]*n;c+=Math.abs((A[a]-A[l])*(A[v+1]-A[a+1])-(A[a]-A[v])*(A[l+1]-A[a+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},$.flatten=function(A){for(var t=A[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<A.length;r++){for(var e=0;e<A[r].length;e++)for(var s=0;s<t;s++)n.vertices.push(A[r][e][s]);r>0&&n.holes.push(i+=A[r-1].length)}return n};var dA=X.exports;class yA extends(t$2.Eventable(t$2.Handlerable(t$2.Class))){constructor(A){super(A),this.j=!0}addTo(A){return A.getMap()?(this.layer=A,this.N()):A.once("add",(()=>{this.addTo(A)}),this),this}N(){const A=this.layer.getRenderer();A?(this.regl=A.regl,this.S(A)):this.layer.once("renderercreate",(A=>{this.regl=A.renderer.regl,this.S(A.renderer)}),this)}enable(){this.j=!0;const A=this.layer.getRenderer();A&&A.setToRedraw()}disable(){this.j=!1;const A=this.layer.getRenderer();A&&A.setToRedraw()}isEnable(){return this.j}remove(){if(this.layer){const A=this.layer;delete this.layer,A.removeAnalysis(this),this.B&&(this.B.dispose(),delete this.B),this.R&&(this.R.dispose(),delete this.R),this.k&&(this.k.forEach((A=>{A.geometry.dispose(),A.dispose()})),delete this.k),this.G&&(this.G.dispose(),delete this.G)}}update(A,t){this.options[A]=t;const n=this.layer.getRenderer();n&&n.setToRedraw()}getExcludeLayers(){return this.options.excludeLayers||[]}setExcludeLayers(A){this.options.excludeLayers=A}exportAnalysisMap(A){if(!this.isEnable())return null;let t=this.B.render(A,this.W);t=t.meshesMap?t.meshesMap:t;const n=this.layer.getRenderer();if(t&&n){const A=n.regl,i=t.width,r=t.height,e=new Uint8Array(4*i*r);return A.read({data:e,x:0,y:0,framebuffer:t,width:i,height:r}),e}return null}getAnalysisType(){return this.type}q(A){const t=new t$2.Polygon(A,{symbol:{polygonOpacity:.2}}).getExtent();return this.V(t,A)}V(n,i){const r=this.layer.getMap(),e=r.getCenter(),s=r.getZoom(),u=r.getPitch(),o=r.getBearing(),h=r.getFitZoom(n),f=n.getCenter();r.setZoom(h),r.setCenter(f),r.setPitch(0),r.setBearing(0);const c=r.getExtent();this.K=this.K||[],copy$5(this.K,r.projViewMatrix);const a=Z(r,c.xmin,c.ymin),v=Z(r,c.xmax,c.ymax),l=[a[0],a[1],v[0],v[1]],w=Z(r,n.xmin,n.ymin),P=Z(r,n.xmax,n.ymax),g=[w[0],w[1],P[0],P[1]];if(r.setZoom(s),r.setCenter(e),r.setPitch(u),r.setBearing(o),this.k=this.H(i,f),!this.R){const t=new N$8(this.regl);this.R=new K(t,this.u)}return{extentMap:this.R.render(this.k,this.K),extentInWorld:l,extentPolygon:g}}H(i,r){const e=[],s=this.layer.getMap(),u=Z(s,r.x,r.y,0);for(let A=0;A<i.length;A++){const t=Z(s,...i[A]);e.push(t[0]-u[0]),e.push(t[1]-u[1]),e.push(0)}const o=dA(e,null,3);this.k&&(this.k[0].geometry.dispose(),this.k[0].dispose());const h=new Q$7({POSITION:e},o,0,{positionAttribute:"POSITION"}),f=new ft$6(h),c=fromRotationTranslationScale([],identity$1([]),u,[1,1,1]);return f.localTransform=c,this.k=[f],this.k}}var mA="attribute vec3 aPosition;\n\nattribute vec2 aTexCoord;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    v_texCoord = aTexCoord;\n\n}\n\n",pA="#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform sampler2D meshesMap;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        #ifdef HAS_HELPERPARTS\n\n          gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n\n        #else\n\n          gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        #endif\n\n        vec2 v = v_texCoord;\n\n    }\n\n}\n\n";const LA={helper:{asset:{generator:"Khronos glTF Blender I/O v1.6.16",version:"2.0"},scene:0,scenes:[{name:"Scene",nodes:[0,1,2,3,4,5,6,7]}],nodes:[{mesh:0,name:"角2",scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,0,-9.680065155029297]},{mesh:1,name:"角3",rotation:[1,0,0,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,.04612281173467636,9.669971466064453]},{mesh:2,name:"角1",rotation:[0,0,-1,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,.028526417911052704,-9.667880058288574]},{mesh:3,name:"角4",rotation:[0,-1,0,1910685676922942e-30],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,0,9.639498710632324]},{mesh:4,name:"X轴",translation:[.008500291034579277,0,11.816417694091797]},{mesh:5,name:"平面",scale:[9.5003657913208,9.5003657913208,9.5003657913208]},{mesh:6,name:"Y轴",rotation:[.5384660959243774,.45831674337387085,-.45831674337387085,-.5384663343429565],translation:[11.712308883666992,0,.32547950744628906]},{mesh:7,name:"Z轴",scale:[.49277400970458984,.41999998688697815,.49277400970458984],translation:[.0035659661516547203,1.6771862506866455,-11.201739311218262]}],materials:[{doubleSided:!0,name:"材质.015",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.014",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.016",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.013",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.009",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:"材质.017",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04.006",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:"材质.023",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.022",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.021",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}}],meshes:[{name:"平面.009",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0}]},{name:"平面.010",primitives:[{attributes:{POSITION:4,NORMAL:5,TEXCOORD_0:6},indices:3,material:1}]},{name:"平面.011",primitives:[{attributes:{POSITION:7,NORMAL:8,TEXCOORD_0:9},indices:3,material:2}]},{name:"平面.012",primitives:[{attributes:{POSITION:10,NORMAL:11,TEXCOORD_0:12},indices:3,material:3}]},{name:"圆环.004",primitives:[{attributes:{POSITION:13,NORMAL:14,TEXCOORD_0:15},indices:16,material:4},{attributes:{POSITION:17,NORMAL:18,TEXCOORD_0:19},indices:20,material:5}]},{name:"平面.015",primitives:[{attributes:{POSITION:21,NORMAL:22,TEXCOORD_0:23},indices:24}]},{name:"圆环.008",primitives:[{attributes:{POSITION:25,NORMAL:26,TEXCOORD_0:27},indices:16,material:6},{attributes:{POSITION:28,NORMAL:29,TEXCOORD_0:30},indices:20,material:7}]},{name:"立方体.011",primitives:[{attributes:{POSITION:31,NORMAL:32,TEXCOORD_0:33},indices:34,material:8},{attributes:{POSITION:35,NORMAL:36,TEXCOORD_0:37},indices:38,material:9},{attributes:{POSITION:39,NORMAL:40,TEXCOORD_0:41},indices:42,material:10}]}],accessors:[{bufferView:0,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:1,componentType:5126,count:68,type:"VEC3"},{bufferView:2,componentType:5126,count:68,type:"VEC2"},{bufferView:3,componentType:5123,count:144,type:"SCALAR"},{bufferView:4,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:5,componentType:5126,count:68,type:"VEC3"},{bufferView:6,componentType:5126,count:68,type:"VEC2"},{bufferView:7,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:8,componentType:5126,count:68,type:"VEC3"},{bufferView:9,componentType:5126,count:68,type:"VEC2"},{bufferView:10,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:11,componentType:5126,count:68,type:"VEC3"},{bufferView:12,componentType:5126,count:68,type:"VEC2"},{bufferView:13,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:14,componentType:5126,count:32,type:"VEC3"},{bufferView:15,componentType:5126,count:32,type:"VEC2"},{bufferView:16,componentType:5123,count:90,type:"SCALAR"},{bufferView:17,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:18,componentType:5126,count:745,type:"VEC3"},{bufferView:19,componentType:5126,count:745,type:"VEC2"},{bufferView:20,componentType:5123,count:1053,type:"SCALAR"},{bufferView:21,componentType:5126,count:4,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:22,componentType:5126,count:4,type:"VEC3"},{bufferView:23,componentType:5126,count:4,type:"VEC2"},{bufferView:24,componentType:5123,count:6,type:"SCALAR"},{bufferView:25,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:26,componentType:5126,count:32,type:"VEC3"},{bufferView:27,componentType:5126,count:32,type:"VEC2"},{bufferView:28,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:29,componentType:5126,count:745,type:"VEC3"},{bufferView:30,componentType:5126,count:745,type:"VEC2"},{bufferView:31,componentType:5126,count:16,max:[1,1,1],min:[-1,-1,-1],type:"VEC3"},{bufferView:32,componentType:5126,count:16,type:"VEC3"},{bufferView:33,componentType:5126,count:16,type:"VEC2"},{bufferView:34,componentType:5123,count:18,type:"SCALAR"},{bufferView:35,componentType:5126,count:16,max:[1.0000004768371582,-6.847862720489502,1.0000038146972656],min:[-.999999463558197,-8.847862243652344,-.9999960660934448],type:"VEC3"},{bufferView:36,componentType:5126,count:16,type:"VEC3"},{bufferView:37,componentType:5126,count:16,type:"VEC2"},{bufferView:38,componentType:5123,count:18,type:"SCALAR"},{bufferView:39,componentType:5126,count:24,max:[.23352710902690887,-.6051979064941406,.20581023395061493],min:[-.16755716502666473,-7.437830924987793,-.19527404010295868],type:"VEC3"},{bufferView:40,componentType:5126,count:24,type:"VEC3"},{bufferView:41,componentType:5126,count:24,type:"VEC2"},{bufferView:42,componentType:5123,count:36,type:"SCALAR"}],bufferViews:[{buffer:0,byteLength:816,byteOffset:0},{buffer:0,byteLength:816,byteOffset:816},{buffer:0,byteLength:544,byteOffset:1632},{buffer:0,byteLength:288,byteOffset:2176},{buffer:0,byteLength:816,byteOffset:2464},{buffer:0,byteLength:816,byteOffset:3280},{buffer:0,byteLength:544,byteOffset:4096},{buffer:0,byteLength:816,byteOffset:4640},{buffer:0,byteLength:816,byteOffset:5456},{buffer:0,byteLength:544,byteOffset:6272},{buffer:0,byteLength:816,byteOffset:6816},{buffer:0,byteLength:816,byteOffset:7632},{buffer:0,byteLength:544,byteOffset:8448},{buffer:0,byteLength:384,byteOffset:8992},{buffer:0,byteLength:384,byteOffset:9376},{buffer:0,byteLength:256,byteOffset:9760},{buffer:0,byteLength:180,byteOffset:10016},{buffer:0,byteLength:8940,byteOffset:10196},{buffer:0,byteLength:8940,byteOffset:19136},{buffer:0,byteLength:5960,byteOffset:28076},{buffer:0,byteLength:2106,byteOffset:34036},{buffer:0,byteLength:48,byteOffset:36144},{buffer:0,byteLength:48,byteOffset:36192},{buffer:0,byteLength:32,byteOffset:36240},{buffer:0,byteLength:12,byteOffset:36272},{buffer:0,byteLength:384,byteOffset:36284},{buffer:0,byteLength:384,byteOffset:36668},{buffer:0,byteLength:256,byteOffset:37052},{buffer:0,byteLength:8940,byteOffset:37308},{buffer:0,byteLength:8940,byteOffset:46248},{buffer:0,byteLength:5960,byteOffset:55188},{buffer:0,byteLength:192,byteOffset:61148},{buffer:0,byteLength:192,byteOffset:61340},{buffer:0,byteLength:128,byteOffset:61532},{buffer:0,byteLength:36,byteOffset:61660},{buffer:0,byteLength:192,byteOffset:61696},{buffer:0,byteLength:192,byteOffset:61888},{buffer:0,byteLength:128,byteOffset:62080},{buffer:0,byteLength:36,byteOffset:62208},{buffer:0,byteLength:288,byteOffset:62244},{buffer:0,byteLength:288,byteOffset:62532},{buffer:0,byteLength:192,byteOffset:62820},{buffer:0,byteLength:72,byteOffset:63012}],buffers:[{byteLength:63084,uri:"data:application/octet-stream;base64,AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAABAAGAAAABgACAAgADAAOAAgADgAKABMAEAAiABMAIgAqAB8AFgAuAB8ALgA3AA0ACQAZAA0AGQAVAAMABwATAAMAEwASAAUAAQARAAUAEQAQAA8ADQAVAA8AFQAeAAkACwAcAAkAHAAZAAcABQAQAAcAEAATAAEAAwASAAEAEgARAAsADwAeAAsAHgAcACgAKwBDACgAQwBAABEAEgAnABEAJwAlABIAEwAqABIAKgAnABAAEQAlABAAJQAiADEANAA2ADEANgAtAD0APwBCAD0AQgA6ACAAIwA7ACAAOwA4ABcAGgAyABcAMgAvACkAIQA5ACkAOQBBACQAJgA+ACQAPgA8ABsAHQA1ABsANQAzABQAGAAwABQAMAAsAAAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9b7f79WWa49UQo6Qdb7f79WWa49UQo6Qdb7f79WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QQAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEa5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8c5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/W+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEAAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAACAv8LFR74AAAAAvhR7vxbvw74AAAAAXoNsv9o5Dr8AAAAAMdtUv/MENb8AAAAA8wQ1vzHbVL8AAAAA2jkOv16DbL8AAAAAFe/Dvr4Ue78AAAAAxMVHvgAAgL8AAAAALr07M74Ue78AAAAAwsVHPl+DbL8AAAAAFO/DPjLbVL8AAAAA2TkOP/MENb8AAAAA8wQ1P9k5Dr8AAAAAMttUPxfvw74AAAAAXoNsP8HFR74AAAAAvxR7Py69uzMAAAAAAACAP73FRz4AAAAAvxR7PxXvwz4AAAAAXoNsP9s5Dj8AAAAAMNtUP/IENT8AAAAA9AQ1Py/bVD8AAAAA3TkOP16DbD8AAAAAGu/DPr4Uez8AAAAAxsVHPgAAgD8AAAAALt5Msr4Uez8AAAAAyMVHvl2DbD8AAAAAG+/DvjPbVD8AAAAA1zkOv/UENT8AAAAA8gQ1v9s5Dj8AAAAAMdtUvxXvwz4AAAAAX4Nsv7zFRz4AAAAAvxR7vwAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAEAAgACAAMABAAEAAUABgAGAAcACAAIAAkACgAKAAsADAAMAA0ADgAOAA8AEAAQABEAEgASABMAFAAUABUAFgAWABcAGAAYABkAGgAaABsAHAAcAB0AHgAeAB8AAAAAAAIABAAEAAYACAAIAAoADAAMAA4AEAAQABIAFAAUABYAGAAYABoAHAAcAB4AAAAAAAQACAAIAAwAEAAQABQAGAAYABwAAAAAAAgAEAAQABgAAAAcfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8McFu+mRx5vOP/r74McFu+mRx5vOP/r74McFu+mRx5vOP/r74Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G7/osCq+oRx5vN/bvL7osCq+oRx5vN/bvL7INe69qBx5vOSPxr7INe69qBx5vOSPxr7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr8APSu8txx5vJ3wz74APSu8txx5vJ3wz77QnjE9vRx5vHt3z77QnjE9vRx5vHt3z7746sU9wxx5vDOLy7746sU9wxx5vDOLy7746sU9wxx5vDOLy74Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA7+MGRg+yBx5vLA7xL6MGRg+yBx5vLA7xL40/Uo+zRx5vGimub40/Uo+zRx5vGimub40/Uo+zRx5vGimub4izto+8Rx5vOq17r4izto+8Rx5vOq17r4izto+8Rx5vOq17r7U0no+0Rx5vA72q77U0no+0Rx5vA72q77U0no+0Rx5vA72q76qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b7SbJM+1Bx5vPdhm77SbJM+1Bx5vPdhm77WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr6yasU+1hx5vCieOr6yasU+1hx5vCieOr6yasU+1hx5vCieOr4+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRztGxYA+xRx5vOoPLL69LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/1Bx5vDBIyT3AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/Zw8i+jRx5vKrq9b7Zw8i+jRx5vKrq9b4k6aa+mRx5vGTRBr8tYee+ghx5vDUk2r4tYee+ghx5vDUk2r4tYee+ghx5vDUk2r6UUje+sBx5vGO9F7+UUje+sBx5vGO9F7+UUje+sBx5vGO9F7/EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur6oz829uxx5vAaJHL+oz829uxx5vAaJHL+oz829uxx5vAaJHL8qggy/bBx5vGs7mL4qggy/bBx5vGs7mL4qggy/bBx5vGs7mL7AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr5QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr8WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL6+spi+ihx5vH6rjb6+spi+ihx5vH6rjb5KoKq+ghx5vHN7cb5KoKq+ghx5vHN7cb4qyrm+exx5vPJ1Q74qyrm+exx5vPJ1Q74c88W+dRx5vE0AEr4c88W+dRx5vE0AEr4O6s6+bxx5vFTEu71x5RM/MMU9PFZTjr69LRw/9Bx5vEj9Ur5x5RM/9Rx5vFZTjr69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY769LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur69LRw/MsU9PEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/1Bx5vDBIyT2JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0+dd8+zhx5vABTRzs+dd8+zhx5vABTRzszFgo/1Bx5vDBIyT1GxYA+xRx5vOoPLL5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL5GxYA+YsU9POoPLL4+dd8+WMU9PABTRzuyasU+UMU9PCieOr5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL6yasU+1hx5vCieOr6yasU+UMU9PCieOr66Yrg+1hx5vJhJZb6yasU+1hx5vCieOr66Yrg+UMU9PJhJZb7WL6c+1Rx5vAYtiL7WL6c+UMU9PAYtiL7SbJM+1Bx5vPdhm77SbJM+UsU9PPdhm77U0no+0Rx5vA72q77U0no+VsU9PA72q740/Uo+zRx5vGimub40/Uo+WsU9PGimub6MGRg+yBx5vLA7xL6MGRg+XsU9PLA7xL746sU9wxx5vDOLy7746sU9YsU9PDOLy77QnjE9aMU9PHt3z77QnjE9vRx5vHt3z74APSu8cMU9PJ3wz74APSu8txx5vJ3wz77Q/IK9dsU9PL30zL7Q/IK9sBx5vL30zL7INe69fsU9POSPxr7INe69qBx5vOSPxr7osCq+hsU9PN/bvL7osCq+oRx5vN/bvL4McFu+jsU9POP/r74McFu+mRx5vOP/r77aSYS+lMU9PM4voL7aSYS+kRx5vM4voL6+spi+nMU9PH6rjb6+spi+ihx5vH6rjb5KoKq+pMU9PHN7cb5KoKq+ghx5vHN7cb4qyrm+qsU9PPJ1Q74qyrm+exx5vPJ1Q74c88W+ssU9PE0AEr4c88W+dRx5vE0AEr4O6s6+uMU9PFTEu70O6s6+bxx5vFTEu70O6s6+uMU9PFTEu70O6s6+uMU9PFTEu70WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4O6s6+bxx5vFTEu70WWhy/zMU9PCkZGL7goBW/xMU9PFxGZr4WWhy/WRx5vCkZGL4WWhy/zMU9PCkZGL7goBW/Yxx5vFxGZr4qggy/usU9PGs7mL4qggy/bBx5vGs7mL7EIgG/sMU9PIu/ur7EIgG/dxx5vIu/ur4tYee+pMU9PDUk2r4tYee+ghx5vDUk2r7Zw8i+mMU9PKrq9b7Zw8i+jRx5vKrq9b4k6aa+jMU9PGTRBr8k6aa+mRx5vGTRBr/AWYK+gsU9PGN2EL/AWYK+pRx5vGN2EL+UUje+dsU9PGO9F7+UUje+sBx5vGO9F7+oz829asU9PAaJHL+oz829uxx5vAaJHL/AvqW8YMU9PPLFHr/AvqW8xhx5vPLFHr9QxXc9VsU9PBVrHr9QxXc90Bx5vBVrHr8Uxg8+TsU9POJ5G78Uxg8+2Bx5vOJ5G78cfF8+4Bx5vDz+Fb8cfF8+RsU9PDz+Fb/K6JU+5xx5vEYODr/K6JU+PsU9PEYODr8Wybk+7Rx5vAjKA78Wybk+OsU9PAjKA78izto+8Rx5vOq17r4izto+NsU9POq17r6qcvg+9Bx5vIbm0b6qcvg+MsU9PIbm0b59Hwk/9Rx5vDiasb59Hwk/MMU9PDiasb7Zw8i+mMU9PKrq9b7Zw8i+mMU9PKrq9b7AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL8k6aa+jMU9PGTRBr8tYee+pMU9PDUk2r4tYee+pMU9PDUk2r4tYee+pMU9PDUk2r6UUje+dsU9PGO9F7+UUje+dsU9PGO9F7+UUje+dsU9PGO9F7/EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur6oz829asU9PAaJHL+oz829asU9PAaJHL+oz829asU9PAaJHL8qggy/usU9PGs7mL4qggy/usU9PGs7mL4qggy/usU9PGs7mL7AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/goBW/xMU9PFxGZr7goBW/xMU9PFxGZr7goBW/xMU9PFxGZr5QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr8WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G7/aSYS+lMU9PM4voL7aSYS+lMU9PM4voL7aSYS+lMU9PM4voL6+spi+nMU9PH6rjb6+spi+nMU9PH6rjb5KoKq+pMU9PHN7cb5KoKq+pMU9PHN7cb4qyrm+qsU9PPJ1Q74qyrm+qsU9PPJ1Q74c88W+ssU9PE0AEr4c88W+ssU9PE0AEr4O6s6+uMU9PFTEu70McFu+jsU9POP/r74McFu+jsU9POP/r74McFu+jsU9POP/r74+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzuyasU+UMU9PCieOr6yasU+UMU9PCieOr6yasU+UMU9PCieOr5GxYA+YsU9POoPLL5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr69LRw/MsU9PEj9Ur69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb/osCq+hsU9PN/bvL7osCq+hsU9PN/bvL7INe69fsU9POSPxr7INe69fsU9POSPxr7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr8APSu8cMU9PJ3wz74APSu8cMU9PJ3wz77QnjE9aMU9PHt3z77QnjE9aMU9PHt3z7746sU9YsU9PDOLy7746sU9YsU9PDOLy7746sU9YsU9PDOLy74Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA7+MGRg+XsU9PLA7xL6MGRg+XsU9PLA7xL40/Uo+WsU9PGimub40/Uo+WsU9PGimub40/Uo+WsU9PGimub4izto+NsU9POq17r4izto+NsU9POq17r4izto+NsU9POq17r7U0no+VsU9PA72q77U0no+VsU9PA72q77U0no+VsU9PA72q76qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b7SbJM+UsU9PPdhm77SbJM+UsU9PPdhm77WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb4JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD4FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+bRx5vA4gWD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz5HOw+/PBx5vCrfpD5HOw+/PBx5vCrfpD5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT56R88+vRx5vOgXPz56R88+vRx5vOgXPz5qPtg+wxx5vLz5Cj6KHsM+thx5vI6NcD6KHsM+thx5vI6NcD6q9LM+rxx5vIhJjz6q9LM+rxx5vIhJjz4aB6I+qBx5vFA3pD4aB6I+qBx5vFA3pD42no0+oBx5vJ67tj42no0+oBx5vJ67tj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj7oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT8LSxo/zxx5vACviT4LSxo/zxx5vACviT4LSxo/zxx5vACviT5Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj74IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T40+0k+gRx5vEwDIz80+0k+gRx5vEwDIz80+0k+gRx5vEwDIz+KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D4eros+jBx5vE68Gz8eros+jBx5vE68Gz8eros+jBx5vE68Gz8yGNI+pBx5vD47Bj8yGNI+pBx5vD47Bj+CPbA+mBx5vEwXEj9OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5eDq++Wxx5vKAwiT5eDq++Wxx5vKAwiT5+252+XBx5vNe4nj5+252+XBx5vNe4nj5+252+XBx5vNe4nj5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT7KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj8kKmi+YRx5vOSBwj4kKmi+YRx5vOSBwj5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D62dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz/UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j5mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT+omaC9bhx5vAgX4j6omaC9bhx5vAgX4j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT/g4+o8exx5vGh85j7g4+o8exx5vGh85j5ITqg9ghx5vJSA4z5ITqg9ghx5vJSA4z6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6UWT0+kRx5vKxn0z6UWT0+kRx5vKxn0z787m2+bRx5vA4gWD787m2+bRx5vA4gWD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+Wxx5vPBLZz787m2+usU9PA4gWD6mNry+zMU9PPBLZz5eDq++Wxx5vKAwiT6mNry+Wxx5vPBLZz5eDq++zMU9PKAwiT5+252+XBx5vNe4nj5+252+ysU9PNe4nj52GIq+Xhx5vMrtsT52GIq+yMU9PMrtsT4kKmi+YRx5vOSBwj4kKmi+xsU9POSBwj5sVDi+ZBx5vDQy0D5sVDi+wsU9PDQy0D7UcAW+aRx5vH7H2j7UcAW+vsU9PH7H2j6omaC9bhx5vAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828dBx5vFAD5j7g4+o8rMU9PGh85j7g4+o8exx5vGh85j5ITqg9pMU9PJSA4z5ITqg9ghx5vJSA4z6kwwk+nsU9PLwb3T6kwwk+iRx5vLwb3T6UWT0+lsU9PKxn0z6UWT0+kRx5vKxn0z68GG4+jsU9PLCLxj68GG4+mBx5vLCLxj42no0+hsU9PJ67tj42no0+oBx5vJ67tj4aB6I+fsU9PFA3pD4aB6I+qBx5vFA3pD6q9LM+dsU9PIhJjz6q9LM+rxx5vIhJjz6KHsM+cMU9PI6NcD6KHsM+thx5vI6NcD56R88+asU9POgXPz56R88+vRx5vOgXPz5qPtg+ZMU9PLz5Cj5qPtg+wxx5vLz5Cj5qPtg+ZMU9PLz5Cj5qPtg+ZMU9PLz5Cj5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5qPtg+wxx5vLz5Cj5DBCE/TsU9PLwwRT5DBCE/2Bx5vLwwRT4LSxo/WMU9PACviT4LSxo/zxx5vACviT5DBCE/TsU9PLwwRT5dLBE/YsU9PDzHrj5dLBE/xRx5vDzHrj7rzAU/bMU9PFxL0T7rzAU/uhx5vFxL0T6KtfA+dsU9PPyv8D6KtfA+rxx5vPyv8D4yGNI+gsU9PD47Bj8yGNI+pBx5vD47Bj+CPbA+jsU9PEwXEj+CPbA+mBx5vEwXEj8eros+msU9PE68Gz8eros+jBx5vE68Gz80+0k+pMU9PEwDIz80+0k+gRx5vEwDIz/4IPM9sMU9PPLOJz/4IPM9dhx5vPLOJz9Qgh09usU9PNgLKj9Qgh09axx5vNgLKj9wIi29xMU9PP6wKT9wIi29Yhx5vP6wKT/oOvq9zsU9PMe/Jj/oOvq9WRx5vMe/Jj9g00y+URx5vChEIT9g00y+1sU9PChEIT9mlIy+Shx5vC1UGT9mlIy+3MU9PC1UGT+2dLC+RBx5vO4PDz+2dLC+4sU9PO4PDz/KedG+QBx5vNygAj/KedG+5sU9PNygAj9MHu++PRx5vF5y6D5MHu++6MU9PF5y6D5OdQS/PBx5vAomyD5OdQS/6sU9PAomyD5HOw+/PBx5vCrfpD5HOw+/6sU9PCrfpD5yeRe/Phx5vIU3gD5yeRe/6MU9PIU3gD5yeRe/Phx5vIU3gD70Lj+//MU9PKvqiD70Lj+/KRx5vKvqiD5yeRe/6MU9PIU3gD4FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+//MU9PKvqiD4FbAW/XRx5vKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT0FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+usU9PA4gWD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz5HOw+/6sU9PCrfpD5HOw+/6sU9PCrfpD5eDq++zMU9PKAwiT5eDq++zMU9PKAwiT5+252+ysU9PNe4nj5+252+ysU9PNe4nj5+252+ysU9PNe4nj5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT7KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj8kKmi+xsU9POSBwj4kKmi+xsU9POSBwj5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D62dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz/UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j5mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT+omaC9uMU9PAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT/g4+o8rMU9PGh85j7g4+o8rMU9PGh85j5ITqg9pMU9PJSA4z5ITqg9pMU9PJSA4z6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T7oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj+UWT0+lsU9PKxn0z6UWT0+lsU9PKxn0z68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj56R88+asU9POgXPz56R88+asU9POgXPz5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5qPtg+ZMU9PLz5Cj6KHsM+cMU9PI6NcD6KHsM+cMU9PI6NcD6q9LM+dsU9PIhJjz6q9LM+dsU9PIhJjz4aB6I+fsU9PFA3pD4aB6I+fsU9PFA3pD42no0+hsU9PJ67tj42no0+hsU9PJ67tj5wIi29xMU9PP6wKT9wIi29xMU9PP6wKT9wIi29xMU9PP6wKT8LSxo/WMU9PACviT4LSxo/WMU9PACviT4LSxo/WMU9PACviT5Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj74IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T40+0k+pMU9PEwDIz80+0k+pMU9PEwDIz80+0k+pMU9PEwDIz+KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D4eros+msU9PE68Gz8eros+msU9PE68Gz8eros+msU9PE68Gz8yGNI+gsU9PD47Bj8yGNI+gsU9PD47Bj+CPbA+jsU9PEwXEj/0Lj+//MU9PKvqiD70Lj+//MU9PKvqiD70Lj+//MU9PKvqiD4JJda+xMU9PLwSJT0JJda+xMU9PLwSJT0FbAW/yMU9PKwxXr387m2+usU9PA4gWD787m2+usU9PA4gWD787m2+usU9PA4gWD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD4eeCG0AACAvyvyJDPYIA20//9/v/jrjTM+Zwm0AACAvwGvAzRUadWzAACAv2wBkzMAAAAAAACAv1sy8rNUadWzAACAv2wBkzMAAAAAAACAv1sy8rMAAAAAAACAv/sMtrMvygK0//9/v6OQjDMt3tWzAACAv4PItjNUadWzAACAv2wBkzMAAAAAAACAv/sMtrM+Zwm0AACAvwGvAzQAAAAAAACAv1sy8rMeeCG0AACAvyvyJDM+Zwm0AACAvwGvAzQeeCG0AACAvyvyJDPYIA20//9/v/jrjTMeeKGzAACAv1bqjzPYIA20//9/v/jrjTPeWvGzAACAv9ZSuDP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMGTcqzAACAv3rnlTP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMGTcqzAACAv46mqzNGxgi0AACAv0PmizOdo/yzAACAv1rInTP9L+6zAACAvyhzjjMGTcqzAACAv46mqzNGxgi0AACAv0PmizMGTcqzAACAv46mqzNexgi0AACAv4iLizNGxgi0AACAv0PmizOdo/yzAACAv1rInTNexgi0AACAv4iLizOdo/yzAACAv1rInTNomu6zAACAv3yUkjP8kR+0AACAv/n0jjNexgi0AACAv4iLizNomu6zAACAv3yUkjP8kR+0AACAv/n0jjPITQK0AACAvzKJojNomu6zAACAv3yUkjPmvK2zAACAvzROtDP8kR+0AACAv/n0jjPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTOCvc+zAACAvze8kTPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTNklMOz//9/v+eNlzPEuQG0AACAvy3imTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOCvc+zAACAvze8kTNklMOz//9/v+eNlzNklMOz//9/v+eNlzO3aO+zAACAv241pTOCvc+zAACAvze8kTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOqIAC0AACAv7IwkjPTFk20AACAvxck/zLKARm0AACAv8NAmzMNM4GzAACAv4MQxDPTFk20AACAvxck/zLKARm0AACAv8NAmzPKARm0AACAv8NAmzPTFk20AACAvxck/zJjBjy0AACAv1jUkjMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjPE8rOzAACAv07jlzMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjMT1vWzAACAv1zarjPE8rOzAACAv07jlzMT1vWzAACAv1zarjP0ZdCzAACAv51NhDPE8rOzAACAv07jlzMT1vWzAACAv1zarjMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzMFsM2zAACAv91zuDO8riO0AACAv7WyjzMt3tWzAACAv4PItjMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzOxluOzAACAv6tQkzMt3tWzAACAv4PItjNHL9OzAACAvxxNvTMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDMAAAAAAACAv/sMtrMB1km0//9/v1NUFzNHL9OzAACAvxxNvTOxluOzAACAv6tQkzNHL9OzAACAvxxNvTP6wPqzAACAv/jvdzOxluOzAACAv6tQkzO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzO4TQK0AACAv6h2lDPFaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r7FaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r5z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9c1S2/wAFgOXjrOz9t1i2/AAAAAEXtOz9i1i2/lvevtk3tOz9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9j1i2/AAAAAEztOz9c1S2/AAAAAHjrOz+uAdc7AP5/PxABCDvX6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj8a3Qy/AAAAAKzBVT8a3Qy/AAAAAKzBVT/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz924To9AAAAAP+5fz924To9AAAAAP+5fz9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj+ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj+8LV4/AAAAAP1R/j68LV4/AAAAAP1R/j7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj7kEXI/AAAAAE2Npj6Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj/ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr7ZXWy/AAAAAImdxL68LV6/AAAAAP1R/r68LV6/AAAAAP1R/r6ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8s0ZW+AAAAAOrJdL8s0ZW+AAAAAOrJdL9dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL+jp1E/AAAAACbjEr+jp1E/AAAAACbjEr8AAAAAAACAP99/b7ToFs0zAACAPztbCbQAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrMAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrPGBA00AACAP04+17MVuM4zAACAPxB8JrNaC/4zAACAP9AmXLPGBA00AACAP04+17NaC/4zAACAP9AmXLNvSAo0AACAPwePZLPGBA00AACAP04+17Ow0OozAACAP6P0tbNaC/4zAACAP9AmXLNvSAo0AACAPwePZLOw0OozAACAP6P0tbNvSAo0AACAPwePZLM4mxA0AACAP94+m7Ow0OozAACAP6P0tbMDsPQzAACAP9OilLM4mxA0AACAP94+m7MDsPQzAACAP9OilLOB+wY0AACAPyWKabM4mxA0AACAP94+m7NMxNwzAACAP09Bs7MDsPQzAACAP9OilLOB+wY0AACAPyWKabPxA7UzAACAP67AxbNMxNwzAACAP09Bs7Oigewz//9/P+Fg1rPR4+4zAACAPwWMmrMINPIzAACAP9R1vbNU4PwzAACAP6VWQrOB+wY0AACAPyWKabNn3g80//9/P5hCdLPus1O1AACAP1RpgrVMxNwzAACAP09Bs7MfDQw0AACAPweLmLNn3g80//9/P5hCdLPus1O1AACAP1RpgrUINPIzAACAP9R1vbNn3g80//9/P5hCdLPxA7UzAACAP67AxbMINPIzAACAP9R1vbPxA7UzAACAP67AxbNU4PwzAACAP6VWQrOigewz//9/P+Fg1rNU4PwzAACAP6VWQrOigewz//9/P+Fg1rPR4+4zAACAPwWMmrPR4+4zAACAPwWMmrPus1O1AACAP1RpgrWDL7y0AACAP8e4RTMfDQw0AACAPweLmLOOm8kzAACAP4A1pbNX6/YzAACAP4WIm7OyGPczAACAP6NlnLNsGvczAACAP7AwkrNx1gE0AACAPzDFo7NX6/YzAACAP4WIm7OyGPczAACAP6NlnLPCqgM0AACAP6X6m7NX6/YzAACAP4WIm7MUIfYzAACAPyr6m7OyGPczAACAP6NlnLNx1gE0AACAPzDFo7PCqgM0AACAP6X6m7OOm8kzAACAP4A1pbNx1gE0AACAPzDFo7OOm8kzAACAP4A1pbNsGvczAACAP7AwkrNsGvczAACAP7AwkrODL7y0AACAP8e4RTM91skzAACAPz/yJLMfDQw0AACAPweLmLM+5Q80AACAPzbdabMZ3mc0//9/P/75HrODL7y0AACAP8e4RTMZ3mc0//9/P/75HrM91skzAACAPz/yJLMZ3mc0//9/P/75HrPPVJIz//9/P5ozCrQ91skzAACAPz/yJLM+5Q80AACAPzbdabPPVJIz//9/P5ozCrQDMO4zAACAP8z6t7NbmQE0AACAP3jnlbM+5Q80AACAPzbdabPT9xg0AACAP8ew/7LPVJIz//9/P5ozCrTT9xg0AACAP8ew/7JbmQE0AACAP3jnlbPT9xg0AACAP8ew/7LNVbczAACAP9yCzLMDMO4zAACAP8z6t7NbmQE0AACAP3jnlbPNVbczAACAP9yCzLMDMO4zAACAP8z6t7PyDfUzAACAPzLsqbOdo/wzAACAP1PInbPNVbczAACAP9yCzLPyDfUzAACAPzLsqbPyDfUzAACAPzLsqbMIwfozAACAP5GLi7Odo/wzAACAP1PInbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLOdo/wzAACAP1PInbPdwPozAACAP97yVbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLPdwPozAACAP97yVbOBo/wzAACAP1gyfLOuTQI0AACAP24GkrPKTQI0AACAPx1RirPdwPozAACAP97yVbOuTQI0AACAP24GkrOk4+4zAACAPzvBurOuTQI0AACAP24GkrPKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PCqgM0AACAP6X6m7PA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDOg9f+7oPV/v7H0grzA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDPA8hK0//9/v4LkkjOg9f+7oPV/v7H0grySF/Sz//9/v1t7mDO/zMw57/9/v8Cotjqg9f+7oPV/v7H0grxtqQW0AACAv4YwpDO/zMw57/9/v8CotjoBQg60AACAv44alzNtqQW0AACAv4YwpDOapuezAACAv5IalzO/zMw57/9/v8CotjptqQW0AACAv4YwpDOapuezAACAv5IalzMeeCG0AACAv6F1vTPbuRe0AACAv5pQkzOCdQS0AACAv06elTOlWvGzAACAv3GmdDOt4+6zAACAvzWBlzPdZeezAACAv/hIlzNI9eOzAACAv3ssqTPQ6+KzAACAv1AdgTMAAAAAAACAv8iawDOt4+6zAACAvzWBlzNI9eOzAACAv3ssqTOt4+6zAACAvzWBlzPbuRe0AACAv5pQkzNI9eOzAACAv3ssqTPbuRe0AACAv5pQkzOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTMAAAAAAACAv8iawDPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTQAAAAAAACAv8iawDMC1AS0//9/v4IBlTOCdQS0AACAv06elTPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTTuNXKzAACAv31SazMn7hi0AACAv3gntzOCdQS0AACAv06elTPdZeezAACAv/hIlzMn7hi0AACAv3gntzNakPKzAACAv2U/mzPdZeezAACAv/hIlzMn7hi0AACAv3gntzNp4wy0AACAv8hMhDNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPT1vWzAACAv0bZrjNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPYC/6zAACAv07jlzPT1vWzAACAv0bZrjPYC/6zAACAv07jlzPT1vWzAACAv0bZrjOGBryzAACAvznWkjPYC/6zAACAv07jlzPHts6zAACAvyQRxDOGBryzAACAvznWkjPHts6zAACAvyQRxDOGBryzAACAvznWkjNDFk2zAACAv2If/zLHts6zAACAvyQRxDNDFk2zAACAv2If/zIAAAAAAACAv65CmzNDFk2zAACAv2If/zIAAAAAAACAv65CmzMAAAAAAACAv65CmzMBQg60AACAv44alzOcpuezAACAvxeJojOapuezAACAv5IalzOjdMOz//9/vx9tljMBQg60AACAv44alzOjdMOz//9/vx9tljNiKQ20AACAvzO7mDOcpuezAACAvxeJojOjdMOz//9/vx9tljNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDOcpuezAACAvxeJojNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDMaLNmzAACAv+FtlzNSyBC0AACAv0C7mDNKW++zAACAv/dUtTNjkeCzAACAv4LInTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjPPXbazAACAvwnmizPKXbaz//9/vx/YoTMAbSi0AACAv0+3kjN7UwS0AACAv9makjMfbeCzAACAv0DolTPKXbaz//9/vx/YoTMfbeCzAACAv0DolTPKXbaz//9/vx/YoTNbkAS0AACAvydkhTN7UwS0AACAv9makjMfbeCzAACAv0DolTNpnRq0AACAv8gDnDMC1AS0//9/v4IBlTNbkAS0AACAvydkhTN7UwS0AACAv9makjNqj6uzAACAv/ODvjNpnRq0AACAv8gDnDNbkAS0AACAvydkhTNpnRq0AACAv8gDnDNqj6uzAACAv/ODvjMC1AS0//9/v4IBlTNqj6uzAACAv/ODvjPuNXKzAACAv31SazOmGs6zAACAv9nYDTTuNXKzAACAv31SazMtBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL8s1ZW+AAAAAOrJdL8s1ZW+AAAAAOrJdL+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr+ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr+8LV6/AAAAAP1R/r68LV6/AAAAAP1R/r7ZXWy/AAAAAImdxL7ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr6Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr/kEXI/AAAAAE2Npj7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj68LV4/AAAAAP1R/j68LV4/AAAAAP1R/j6ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD924To9AAAAAP+5fz924To9AAAAAP+5fz9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT8a2wy/AAAAAKzBVT8a2wy/AAAAAKzBVT9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD+jp1G/AAAAACbjEj+jp1G/AAAAACbjEj/FaWK/AAAAAN7p7j7FaWK/AAAAAN7p7j7Td2m/AAAAAKQB0j7Td2m/AAAAAKQB0j5IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE79rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9xLi0/AAAAAB6IPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9tLi0/AAAAACKIPL+cpuczAACAP706krMJIfYzAACAPwhRirPCTQI0//9/P/wxZLMDQg40AACAP786krOJzEy6q/9/P70fSrsKxd4zAACAPy1doLOcpuczAACAP706krMDQg40AACAP786krMKxd4zAACAPy1doLOcpuczAACAP706krPCTQI0//9/P/wxZLMDQg40AACAP786krMJIfYzAACAPwhRirOXTQI0AACAP5AGkrPCTQI0//9/P/wxZLPqpuczAACAPxfhqLMJIfYzAACAPwhRirOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLNymu4z//9/P33InbN2xgg0AACAPymMi7MgLNkzAACAP46mr7N2xgg0AACAPymMi7NI9eMzAACAP+7rqbNymu4z//9/P33InbN2xgg0AACAPymMi7PLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNymu4z//9/P33InbPLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNSxgg0AACAPzElfLPLjNkzAACAPy7ZirPk3/wzAACAPzzolbOYBAE0AACAP2wCrbNSxgg0AACAPzElfLPk3/wzAACAPzzolbNSxgg0AACAPzElfLOmTcozAACAP2uos7Pk3/wzAACAPzzolbOYBAE0AACAP2wCrbPrd6EzAACAP1VHFbSmTcozAACAP2uos7NaYd0z//9/P4IBlbOYBAE0AACAP2wCrbM8AzU0AACAPxCjSbOmTcozAACAP2uos7M8AzU0AACAPxCjSbPrd6EzAACAP1VHFbQ8AzU0AACAPxCjSbPrd6EzAACAP1VHFbRaYd0z//9/P4IBlbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNaYd0z//9/P4IBlbPQ6+IzAACAPw2bl7O91gU0AACAPz72b7NQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbPQ6+IzAACAPw2bl7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNexgg0AACAPwDwd7Mop7Uz//9/P6h1vbPcr80zAACAPyjNubPQ6+IzAACAPw2bl7Ns4PwzAACAP4RWQrOnTQI0AACAP392lLO91gU0AACAPz72b7P3wgc0AACAPynAxbNexgg0AACAPwDwd7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNs4PwzAACAP4RWQrNexgg0AACAPwDwd7Ns4PwzAACAP4RWQrP3wgc0AACAPynAxbMop7Uz//9/P6h1vbP3wgc0AACAPynAxbMop7Uz//9/P6h1vbPm7jw0AACAP5mawLPcr80zAACAPyjNubML3wE0AACAP+HCirO91gU0AACAPz72b7Pcr80zAACAPyjNubML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprOCnAI0AACAP8CQoLM6phk0AACAP1dkerPh2bszAACAP9rfprNL9gY0AACAP73yJrM6phk0AACAP1dkerNL9gY0AACAP73yJrM6phk0AACAP1dkerMksBw0AACAPwfZHLMVCZszAACAP1pxGrRL9gY0AACAP73yJrMksBw0AACAPwfZHLMvFk0zAACAP/6ZsLMVCZszAACAP1pxGrQksBw0AACAPwfZHLMvFk0zAACAP/6ZsLOBApkzAACAP65Cm7MVCZszAACAP1pxGrQvFk0zAACAP/6ZsLOBApkzAACAP65Cm7OBApkzAACAP65Cm7MAAAAAqv9/P7lLUzsgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzuSF/Qz//9/P1XrkLOJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzsKxd4zAACAPy1doLMAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwMABQAKAAYABAANAAwAAgAPAA4AAAAQABEAAQATABIAFwAZABgAFAAaABsAFgAdABwAFQAhAB4AIgAkACMAHwAmACcAIAApACUAKAAsAC0AKgAwACsALgAyADMAMQA2ADQALwA3ADUAOAA7ADwAOQBAADoAPQBBAEMASABJAEQAQgA+AEcAPwBLAEYASgBNAEUATABOAFAAUwBUAFIATwBVAFcAUQBaAFYAWABbAF0AWQBgAFwAXgBhAGMAXwBmAGIAZQBoAGcAZABqAGkAbAB0AHIAawAJAG4ACAB2AG0AdQB4AHMAeQB7AHEAegB9AHAAfAB/AG8AfgCAAHcACwAHAIEAggCDAIIAgQCEAIYAiACJAIcAhQCKAIwAjgCPAI0AiwCQAJEAlQCXAJYAkwCZAJgAkgCaAJsAlACcAJ0AngCfAJ4AnQCgAKEAogCjAKIAoQCkAKQApQCiAKUApACmAKYApwClAKcApgCoAKgAqQCnAKkAqACqAKoAqwCpAKsAqgCsAKwArQCrAK0ArACuAK4ArwCtAK8ArgCwAK8AsQCyALEArwCwALIAswC0ALMAsgCxALQAtQC2ALUAtACzALYAtwC4ALcAtgC1ALgAuQC6ALkAuAC3ALoAuwC8ALsAugC5ALwAvQC+AL0AvAC7AL4AvwDAAL8AvgC9AMAAwQDCAMEAwAC/AMIAwwDEAMMAwgDBAMQAxQDGAMUAxADDAMYAxwDIAMcAxgDFAMkAywDNAMwAygDOAM8A0ADRANAAzwDSANMA0gDPANIA0wDUANUA1ADTANQA1QDWANcA1gDVANYA1wDYANkA2ADXANgA2QDaANsA2gDZANoA2wDcAN0A3ADbANwA3QDeAN8A3gDdAN4A3wDgAOEA4ADfAOAA4QDiAOMA4gDhAOIA4wDkAOUA5ADjAOQA5QDmAOcA5gDlAOYA5wDoAOcA6QDoAOkA5wDqAOoA6wDpAOsA6gDsAOwA7QDrAO0A7ADuAO4A7wDtAO8A7gDwAPAA8QDvAPEA8ADyAPIA8wDxAPMA8gD0APQAgwDzAIMA9ACBAPUA9wD6APgA9gD7APkA/AD+AAAB/QADAf8AAQEFAQYBAgEIAQQBBwEKAQwBCQEPAQsBDQERARIBDgEZARABFAEcAR4BGgEhASABFwEjASIBEwEkASUBGAEnASYBFQEoASkBFgEqARsBHwErAS8BMwE2ATQBMAE4ATkBMgE8ATsBLgE9AT4BMQE/AS0BQgEdAUABLAFFAUQBRgFIAUEBRwFKAUMBSwFPAUwBSQFRAVABUgFUAU4BUwFXAU0BVgFZAVgBVQFcAVoBXQFeAVsBYAFjAWEBXwFlAWIBZgFoAWcBZAFrAWkBbAFuAWoBbwFyAXABbQFzAXEBdAE3AToBdQE1AXYBeQF7AXoBdwF9AXgBfAF/AYEBfgGFAYABgwGGAYwBkQGTAZIBjgGVAZQBiQGWAZcBiwGZAZgBiAGaAZsBkAGeAZwBjwGhAaABigGlAaYBjQGpAaQBpwGqAawBqAGvAasBrQGwAbIBrgG0AbEBswG2AbgBtQG6AbcBuQG8Ab0BuwG/Ab4BwAHBAYQBxAGHAcIBggHGAcUBxwHKAcMByQHNAcwByAHPAcsBzgHRAdQB0AHWAdIB1QHXAdMB2AHbAdwB2QHeAdoB3QHgAeMB3wHlAeIB5AHoAeEB5wHsAesB5gHvAekB7gHwAe0B8QHzAeoB8gGfAaMB9AH2AaIB9QGdAfcB+QH7AfoB+AH8Af0B/gH/Af4B/QEAAgACAQL+AQECAAICAgICAwIBAgMCAgIEAgQCBQIDAgUCBAIGAgYCBwIFAgcCBgIIAggCCQIHAgkCCAIKAgoCCwIJAgsCCgIMAg0CCwIMAgsCDQIOAg8CDgINAg4CDwIQAhECEAIPAhACEQISAhMCEgIRAhICEwIUAhUCFAITAhQCFQIWAhcCFgIVAhYCFwIYAhkCGAIXAhgCGQIaAhsCGgIZAhoCGwIcAh0CHAIbAhwCHQIeAh8CHgIdAh4CHwIgAiECIAIfAiACIQIiAiMCIgIhAiICIwIkAiUCJwIpAigCJgIqAisCLAItAiwCKwIuAi0CLwIwAi8CLQIsAjACMQIyAjECMAIvAjICMwI0AjMCMgIxAjQCNQI2AjUCNAIzAjYCNwI4AjcCNgI1AjgCOQI6AjkCOAI3AjoCOwI8AjsCOgI5AjwCPQI+Aj0CPAI7Aj4CPwJAAj8CPgI9AkACQQJCAkECQAI/AkICQwJEAkMCQgJBAkMCRQJEAkUCQwJGAkYCRwJFAkcCRgJIAkgCSQJHAkkCSAJKAkoCSwJJAksCSgJMAkwCTQJLAk0CTAJOAk4CTwJNAk8CTgJQAlACUQJPAlECUAJSAlICUwJRAlMCUgJUAlUCVgJXAlYCVQJYAloCXAJdAlsCWQJeAmECYwJkAmICXwJlAmYCYAJnAmgCbgJxAm8CawJzAnICagJ2AnQCaQJ4AnUCeQJ8AnsCdwJ+AnoCfQKBAoICgAKFAoQCfwKIAoMChwKKAokChgKMAosCjwKRApACjQKTApQCjgKYApIClgKaApsCmQKdApwClQKeAp8ClwKiAqACpQKnAqYCoQKoAqsCsQK2ArQCrAK4ArACtwK5ArMCugK8Aq0CuwK9ArUCvgKqAq8CqQKjArICpALBAq4CvwLCAsMCwALGAsQCxwLJAsgCxQLLAsoCzQLPAs4CzALSAtAC0wLWAtUC0QLZAtQC1wLaAtsC2ALcAt4C4ALiAuEC3wLlAuQC3QLnAuMC5gJsAm0C6AJwAgAAAACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAIA/AACAPwAAAAAAAAAAAACAPwAAAAAAAAEAAwAAAAMAAgAAAAAAAAAAAAAAgL/CxUe+AAAAAL4Ue78W78O+AAAAAF6DbL/aOQ6/AAAAADHbVL/zBDW/AAAAAPMENb8x21S/AAAAANo5Dr9eg2y/AAAAABXvw76+FHu/AAAAAMTFR74AAIC/AAAAAC69OzO+FHu/AAAAAMLFRz5fg2y/AAAAABTvwz4y21S/AAAAANk5Dj/zBDW/AAAAAPMENT/ZOQ6/AAAAADLbVD8X78O+AAAAAF6DbD/BxUe+AAAAAL8Uez8uvbszAAAAAAAAgD+9xUc+AAAAAL8Uez8V78M+AAAAAF6DbD/bOQ4/AAAAADDbVD/yBDU/AAAAAPQENT8v21Q/AAAAAN05Dj9eg2w/AAAAABrvwz6+FHs/AAAAAMbFRz4AAIA/AAAAAC7eTLK+FHs/AAAAAMjFR75dg2w/AAAAABvvw74z21Q/AAAAANc5Dr/1BDU/AAAAAPIENb/bOQ4/AAAAADHbVL8V78M+AAAAAF+DbL+8xUc+AAAAAL8Ue78AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/DHBbvpkcebzj/6++DHBbvpkcebzj/6++DHBbvpkcebzj/6++FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/6LAqvqEcebzf27y+6LAqvqEcebzf27y+yDXuvagcebzkj8a+yDXuvagcebzkj8a+0PyCvbAceby99My+0PyCvbAceby99My+0PyCvbAceby99My+yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/AD0rvLccebyd8M++AD0rvLccebyd8M++0J4xPb0cebx7d8++0J4xPb0cebx7d8+++OrFPcMcebwzi8u++OrFPcMcebwzi8u++OrFPcMcebwzi8u+Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/jBkYPsgcebywO8S+jBkYPsgcebywO8S+NP1KPs0cebxoprm+NP1KPs0cebxoprm+NP1KPs0cebxoprm+Is7aPvEcebzqte6+Is7aPvEcebzqte6+Is7aPvEcebzqte6+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+0myTPtQcebz3YZu+0myTPtQcebz3YZu+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+umK4PtYcebyYSWW+umK4PtYcebyYSWW+umK4PtYcebyYSWW+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+smrFPtYcebwonjq+smrFPtYcebwonjq+smrFPtYcebwonjq+PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7RsWAPsUcebzqDyy+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP9QcebwwSMk9wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/2cPIvo0cebyq6vW+2cPIvo0cebyq6vW+JOmmvpkcebxk0Qa/LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+qM/NvbscebwGiRy/qM/NvbscebwGiRy/qM/NvbscebwGiRy/KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/4KAVv2McebxcRma+4KAVv2McebxcRma+4KAVv2McebxcRma+UMV3PdAcebwVax6/UMV3PdAcebwVax6/UMV3PdAcebwVax6/Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+vrKYvoocebx+q42+vrKYvoocebx+q42+SqCqvoIcebxze3G+SqCqvoIcebxze3G+Ksq5vnscebzydUO+Ksq5vnscebzydUO+HPPFvnUcebxNABK+HPPFvnUcebxNABK+DurOvm8cebxUxLu9ceUTPzDFPTxWU46+vS0cP/QcebxI/VK+ceUTP/UcebxWU46+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+vS0cPzLFPTxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP9QcebwwSMk9iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7MxYKP9QcebwwSMk9RsWAPsUcebzqDyy+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+RsWAPmLFPTzqDyy+PnXfPljFPTwAU0c7smrFPlDFPTwonjq+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+smrFPtYcebwonjq+smrFPlDFPTwonjq+umK4PtYcebyYSWW+smrFPtYcebwonjq+umK4PlDFPTyYSWW+1i+nPtUcebwGLYi+1i+nPlDFPTwGLYi+0myTPtQcebz3YZu+0myTPlLFPTz3YZu+1NJ6PtEcebwO9qu+1NJ6PlbFPTwO9qu+NP1KPs0cebxoprm+NP1KPlrFPTxoprm+jBkYPsgcebywO8S+jBkYPl7FPTywO8S++OrFPcMcebwzi8u++OrFPWLFPTwzi8u+0J4xPWjFPTx7d8++0J4xPb0cebx7d8++AD0rvHDFPTyd8M++AD0rvLccebyd8M++0PyCvXbFPTy99My+0PyCvbAceby99My+yDXuvX7FPTzkj8a+yDXuvagcebzkj8a+6LAqvobFPTzf27y+6LAqvqEcebzf27y+DHBbvo7FPTzj/6++DHBbvpkcebzj/6++2kmEvpTFPTzOL6C+2kmEvpEcebzOL6C+vrKYvpzFPTx+q42+vrKYvoocebx+q42+SqCqvqTFPTxze3G+SqCqvoIcebxze3G+Ksq5vqrFPTzydUO+Ksq5vnscebzydUO+HPPFvrLFPTxNABK+HPPFvnUcebxNABK+DurOvrjFPTxUxLu9DurOvm8cebxUxLu9DurOvrjFPTxUxLu9DurOvrjFPTxUxLu9Flocv1kcebwpGRi+Flocv1kcebwpGRi+DurOvm8cebxUxLu9Flocv8zFPTwpGRi+4KAVv8TFPTxcRma+Flocv1kcebwpGRi+Flocv8zFPTwpGRi+4KAVv2McebxcRma+KoIMv7rFPTxrO5i+KoIMv2wcebxrO5i+xCIBv7DFPTyLv7q+xCIBv3ccebyLv7q+LWHnvqTFPTw1JNq+LWHnvoIcebw1JNq+2cPIvpjFPTyq6vW+2cPIvo0cebyq6vW+JOmmvozFPTxk0Qa/JOmmvpkcebxk0Qa/wFmCvoLFPTxjdhC/wFmCvqUcebxjdhC/lFI3vnbFPTxjvRe/lFI3vrAcebxjvRe/qM/NvWrFPTwGiRy/qM/NvbscebwGiRy/wL6lvGDFPTzyxR6/wL6lvMYcebzyxR6/UMV3PVbFPTwVax6/UMV3PdAcebwVax6/FMYPPk7FPTzieRu/FMYPPtgcebzieRu/HHxfPuAcebw8/hW/HHxfPkbFPTw8/hW/yuiVPuccebxGDg6/yuiVPj7FPTxGDg6/Fsm5Pu0cebwIygO/Fsm5PjrFPTwIygO/Is7aPvEcebzqte6+Is7aPjbFPTzqte6+qnL4PvQcebyG5tG+qnL4PjLFPTyG5tG+fR8JP/Ucebw4mrG+fR8JPzDFPTw4mrG+2cPIvpjFPTyq6vW+2cPIvpjFPTyq6vW+wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/JOmmvozFPTxk0Qa/LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+vrKYvpzFPTx+q42+vrKYvpzFPTx+q42+SqCqvqTFPTxze3G+SqCqvqTFPTxze3G+Ksq5vqrFPTzydUO+Ksq5vqrFPTzydUO+HPPFvrLFPTxNABK+HPPFvrLFPTxNABK+DurOvrjFPTxUxLu9DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7smrFPlDFPTwonjq+smrFPlDFPTwonjq+smrFPlDFPTwonjq+RsWAPmLFPTzqDyy+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+vS0cPzLFPTxI/VK+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/6LAqvobFPTzf27y+6LAqvobFPTzf27y+yDXuvX7FPTzkj8a+yDXuvX7FPTzkj8a+0PyCvXbFPTy99My+0PyCvXbFPTy99My+0PyCvXbFPTy99My+yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/AD0rvHDFPTyd8M++AD0rvHDFPTyd8M++0J4xPWjFPTx7d8++0J4xPWjFPTx7d8+++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u+Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/jBkYPl7FPTywO8S+jBkYPl7FPTywO8S+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+0myTPlLFPTz3YZu+0myTPlLFPTz3YZu+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+CSXWvmMceby8EiU9CSXWvmMceby8EiU99C4/vykcebyr6og+9C4/vykcebyr6og+9C4/vykcebyr6og+BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+RzsPvzwcebwq36Q+RzsPvzwcebwq36Q+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+ekfPPr0cebzoFz8+ekfPPr0cebzoFz8+aj7YPsMceby8+Qo+ih7DPrYcebyOjXA+ih7DPrYcebyOjXA+qvSzPq8cebyISY8+qvSzPq8cebyISY8+GgeiPqgcebxQN6Q+GgeiPqgcebxQN6Q+Np6NPqAcebyeu7Y+Np6NPqAcebyeu7Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/cCItvWIcebz+sCk/cCItvWIcebz+sCk/cCItvWIcebz+sCk/C0saP88cebwAr4k+C0saP88cebwAr4k+C0saP88cebwAr4k+UIIdPWscebzYCyo/UIIdPWscebzYCyo/UIIdPWscebzYCyo/XSwRP8Ucebw8x64+XSwRP8Ucebw8x64+XSwRP8Ucebw8x64++CDzPXYcebzyzic/+CDzPXYcebzyzic/+CDzPXYcebzyzic/68wFP7ocebxcS9E+68wFP7ocebxcS9E+68wFP7ocebxcS9E+NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/irXwPq8cebz8r/A+irXwPq8cebz8r/A+irXwPq8cebz8r/A+Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/MhjSPqQcebw+OwY/MhjSPqQcebw+OwY/gj2wPpgcebxMFxI/TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+Xg6vvlscebygMIk+Xg6vvlscebygMIk+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+TB7vvj0cebxecug+TB7vvj0cebxecug+TB7vvj0cebxecug+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/JCpovmEcebzkgcI+JCpovmEcebzkgcI+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/qJmgvW4cebwIF+I+qJmgvW4cebwIF+I+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/4OPqPHscebxofOY+4OPqPHscebxofOY+SE6oPYIcebyUgOM+SE6oPYIcebyUgOM+pMMJPokceby8G90+pMMJPokceby8G90+pMMJPokceby8G90+lFk9PpEcebysZ9M+lFk9PpEcebysZ9M+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vlscebzwS2c+/O5tvrrFPTwOIFg+pja8vszFPTzwS2c+Xg6vvlscebygMIk+pja8vlscebzwS2c+Xg6vvszFPTygMIk+ftudvlwcebzXuJ4+ftudvsrFPTzXuJ4+dhiKvl4cebzK7bE+dhiKvsjFPTzK7bE+JCpovmEcebzkgcI+JCpovsbFPTzkgcI+bFQ4vmQcebw0MtA+bFQ4vsLFPTw0MtA+1HAFvmkcebx+x9o+1HAFvr7FPTx+x9o+qJmgvW4cebwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvHQcebxQA+Y+4OPqPKzFPTxofOY+4OPqPHscebxofOY+SE6oPaTFPTyUgOM+SE6oPYIcebyUgOM+pMMJPp7FPTy8G90+pMMJPokceby8G90+lFk9PpbFPTysZ9M+lFk9PpEcebysZ9M+vBhuPo7FPTywi8Y+vBhuPpgcebywi8Y+Np6NPobFPTyeu7Y+Np6NPqAcebyeu7Y+GgeiPn7FPTxQN6Q+GgeiPqgcebxQN6Q+qvSzPnbFPTyISY8+qvSzPq8cebyISY8+ih7DPnDFPTyOjXA+ih7DPrYcebyOjXA+ekfPPmrFPTzoFz8+ekfPPr0cebzoFz8+aj7YPmTFPTy8+Qo+aj7YPsMceby8+Qo+aj7YPmTFPTy8+Qo+aj7YPmTFPTy8+Qo+QwQhP9gceby8MEU+QwQhP9gceby8MEU+aj7YPsMceby8+Qo+QwQhP07FPTy8MEU+QwQhP9gceby8MEU+C0saP1jFPTwAr4k+C0saP88cebwAr4k+QwQhP07FPTy8MEU+XSwRP2LFPTw8x64+XSwRP8Ucebw8x64+68wFP2zFPTxcS9E+68wFP7ocebxcS9E+irXwPnbFPTz8r/A+irXwPq8cebz8r/A+MhjSPoLFPTw+OwY/MhjSPqQcebw+OwY/gj2wPo7FPTxMFxI/gj2wPpgcebxMFxI/Hq6LPprFPTxOvBs/Hq6LPowcebxOvBs/NPtJPqTFPTxMAyM/NPtJPoEcebxMAyM/+CDzPbDFPTzyzic/+CDzPXYcebzyzic/UIIdPbrFPTzYCyo/UIIdPWscebzYCyo/cCItvcTFPTz+sCk/cCItvWIcebz+sCk/6Dr6vc7FPTzHvyY/6Dr6vVkcebzHvyY/YNNMvlEcebwoRCE/YNNMvtbFPTwoRCE/ZpSMvkocebwtVBk/ZpSMvtzFPTwtVBk/tnSwvkQcebzuDw8/tnSwvuLFPTzuDw8/ynnRvkAcebzcoAI/ynnRvubFPTzcoAI/TB7vvj0cebxecug+TB7vvujFPTxecug+TnUEvzwcebwKJsg+TnUEv+rFPTwKJsg+RzsPvzwcebwq36Q+RzsPv+rFPTwq36Q+cnkXvz4cebyFN4A+cnkXv+jFPTyFN4A+cnkXvz4cebyFN4A+9C4/v/zFPTyr6og+9C4/vykcebyr6og+cnkXv+jFPTyFN4A+BWwFv8jFPTysMV69BWwFv8jFPTysMV699C4/vykcebyr6og+9C4/vykcebyr6og+9C4/v/zFPTyr6og+BWwFv10cebysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69CSXWvmMceby8EiU9CSXWvmMceby8EiU9BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvrrFPTwOIFg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+RzsPv+rFPTwq36Q+RzsPv+rFPTwq36Q+Xg6vvszFPTygMIk+Xg6vvszFPTygMIk+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+TB7vvujFPTxecug+TB7vvujFPTxecug+TB7vvujFPTxecug+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/JCpovsbFPTzkgcI+JCpovsbFPTzkgcI+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/qJmgvbjFPTwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/4OPqPKzFPTxofOY+4OPqPKzFPTxofOY+SE6oPaTFPTyUgOM+SE6oPaTFPTyUgOM+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/lFk9PpbFPTysZ9M+lFk9PpbFPTysZ9M+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+ekfPPmrFPTzoFz8+ekfPPmrFPTzoFz8+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+aj7YPmTFPTy8+Qo+ih7DPnDFPTyOjXA+ih7DPnDFPTyOjXA+qvSzPnbFPTyISY8+qvSzPnbFPTyISY8+GgeiPn7FPTxQN6Q+GgeiPn7FPTxQN6Q+Np6NPobFPTyeu7Y+Np6NPobFPTyeu7Y+cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/XSwRP2LFPTw8x64+XSwRP2LFPTw8x64+XSwRP2LFPTw8x64++CDzPbDFPTzyzic/+CDzPbDFPTzyzic/+CDzPbDFPTzyzic/68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/MhjSPoLFPTw+OwY/MhjSPoLFPTw+OwY/gj2wPo7FPTxMFxI/9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+CSXWvsTFPTy8EiU9CSXWvsTFPTy8EiU9BWwFv8jFPTysMV69/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+HnghtAAAgL8r8iQz2CANtP//f7/4640zPmcJtAAAgL8BrwM0VGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzVGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzAAAAAAAAgL/7DLazL8oCtP//f7+jkIwzLd7VswAAgL+DyLYzVGnVswAAgL9sAZMzAAAAAAAAgL/7DLazPmcJtAAAgL8BrwM0AAAAAAAAgL9bMvKzHnghtAAAgL8r8iQzPmcJtAAAgL8BrwM0HnghtAAAgL8r8iQz2CANtP//f7/4640zHnihswAAgL9W6o8z2CANtP//f7/4640z3lrxswAAgL/WUrgz/S/uswAAgL8oc44zBk3KswAAgL9655UzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzBk3KswAAgL9655Uz/S/uswAAgL8oc44zBk3KswAAgL9655UzBk3KswAAgL+OpqszRsYItAAAgL9D5osznaP8swAAgL9ayJ0z/S/uswAAgL8oc44zBk3KswAAgL+OpqszRsYItAAAgL9D5oszBk3KswAAgL+OpqszXsYItAAAgL+Ii4szRsYItAAAgL9D5osznaP8swAAgL9ayJ0zXsYItAAAgL+Ii4sznaP8swAAgL9ayJ0zaJruswAAgL98lJIz/JEftAAAgL/59I4zXsYItAAAgL+Ii4szaJruswAAgL98lJIz/JEftAAAgL/59I4zyE0CtAAAgL8yiaIzaJruswAAgL98lJIz5rytswAAgL80TrQz/JEftAAAgL/59I4z5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpcznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzgr3PswAAgL83vJEz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzZJTDs///f7/njZczxLkBtAAAgL8t4pkzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzgr3PswAAgL83vJEzZJTDs///f7/njZczZJTDs///f7/njZczt2jvswAAgL9uNaUzgr3PswAAgL83vJEzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzqiAAtAAAgL+yMJIz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszDTOBswAAgL+DEMQz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszygEZtAAAgL/DQJsz0xZNtAAAgL8XJP8yYwY8tAAAgL9Y1JIzDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzxPKzswAAgL9O45czDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzE9b1swAAgL9c2q4zxPKzswAAgL9O45czE9b1swAAgL9c2q4z9GXQswAAgL+dTYQzxPKzswAAgL9O45czE9b1swAAgL9c2q4zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGczBbDNswAAgL/dc7gzvK4jtAAAgL+1so8zLd7VswAAgL+DyLYzBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzuE0CtAAAgL+odpQz+sD6swAAgL/473czsZbjswAAgL+rUJMzLd7VswAAgL+DyLYzRy/TswAAgL8cTb0zBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzAAAAAAAAgL/7DLazAdZJtP//f79TVBczRy/TswAAgL8cTb0zsZbjswAAgL+rUJMzRy/TswAAgL8cTb0z+sD6swAAgL/473czsZbjswAAgL+rUJMzuE0CtAAAgL+odpQz+sD6swAAgL/473czuE0CtAAAgL+odpQzxWliPwAAAADe6e6+03dpPwAAAACkAdK+xWliPwAAAADe6e6+03dpPwAAAACkAdK+c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/XNUtv8ABYDl46zs/bdYtvwAAAABF7Ts/YtYtv5b3r7ZN7Ts/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/Y9YtvwAAAABM7Ts/XNUtvwAAAAB46zs/rgHXOwD+fz8QAQg71+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/Gt0MvwAAAACswVU/Gt0MvwAAAACswVU/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/b5M3PwAAAABlazI/b5M3PwAAAABlazI/mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+5BFyPwAAAABNjaY+mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+2V1svwAAAACJncS+vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/b5M3vwAAAABlazK/b5M3vwAAAABlazK/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/LNGVvgAAAADqyXS/LNGVvgAAAADqyXS/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/GtsMPwAAAACswVW/GtsMPwAAAACswVW/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/o6dRPwAAAAAm4xK/o6dRPwAAAAAm4xK/AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazAAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazxgQNNAAAgD9OPtezFbjOMwAAgD8QfCazWgv+MwAAgD/QJlyzxgQNNAAAgD9OPtezWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzxgQNNAAAgD9OPtezsNDqMwAAgD+j9LWzWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzsNDqMwAAgD+j9LWzb0gKNAAAgD8Hj2SzOJsQNAAAgD/ePpuzsNDqMwAAgD+j9LWzA7D0MwAAgD/TopSzOJsQNAAAgD/ePpuzA7D0MwAAgD/TopSzgfsGNAAAgD8limmzOJsQNAAAgD/ePpuzTMTcMwAAgD9PQbOzA7D0MwAAgD/TopSzgfsGNAAAgD8limmz8QO1MwAAgD+uwMWzTMTcMwAAgD9PQbOzooHsM///fz/hYNaz0ePuMwAAgD8FjJqzCDTyMwAAgD/Udb2zVOD8MwAAgD+lVkKzgfsGNAAAgD8limmzZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1TMTcMwAAgD9PQbOzHw0MNAAAgD8Hi5izZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1CDTyMwAAgD/Udb2zZ94PNP//fz+YQnSz8QO1MwAAgD+uwMWzCDTyMwAAgD/Udb2z8QO1MwAAgD+uwMWzVOD8MwAAgD+lVkKzooHsM///fz/hYNazVOD8MwAAgD+lVkKzooHsM///fz/hYNaz0ePuMwAAgD8FjJqz0ePuMwAAgD8FjJqz7rNTtQAAgD9UaYK1gy+8tAAAgD/HuEUzHw0MNAAAgD8Hi5izjpvJMwAAgD+ANaWzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzbBr3MwAAgD+wMJKzcdYBNAAAgD8wxaOzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzwqoDNAAAgD+l+puzV+v2MwAAgD+FiJuzFCH2MwAAgD8q+puzshj3MwAAgD+jZZyzcdYBNAAAgD8wxaOzwqoDNAAAgD+l+puzjpvJMwAAgD+ANaWzcdYBNAAAgD8wxaOzjpvJMwAAgD+ANaWzbBr3MwAAgD+wMJKzbBr3MwAAgD+wMJKzgy+8tAAAgD/HuEUzPdbJMwAAgD8/8iSzHw0MNAAAgD8Hi5izPuUPNAAAgD823WmzGd5nNP//fz/++R6zgy+8tAAAgD/HuEUzGd5nNP//fz/++R6zPdbJMwAAgD8/8iSzGd5nNP//fz/++R6zz1SSM///fz+aMwq0PdbJMwAAgD8/8iSzPuUPNAAAgD823Wmzz1SSM///fz+aMwq0AzDuMwAAgD/M+rezW5kBNAAAgD9455WzPuUPNAAAgD823Wmz0/cYNAAAgD/HsP+yz1SSM///fz+aMwq00/cYNAAAgD/HsP+yW5kBNAAAgD9455Wz0/cYNAAAgD/HsP+yzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rezW5kBNAAAgD9455WzzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rez8g31MwAAgD8y7KmznaP8MwAAgD9TyJ2zzVW3MwAAgD/cgsyz8g31MwAAgD8y7Kmz8g31MwAAgD8y7KmzCMH6MwAAgD+Ri4uznaP8MwAAgD9TyJ2zCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyznaP8MwAAgD9TyJ2z3cD6MwAAgD/e8lWzCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyz3cD6MwAAgD/e8lWzgaP8MwAAgD9YMnyzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqz3cD6MwAAgD/e8lWzrk0CNAAAgD9uBpKzpOPuMwAAgD87wbqzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzwqoDNAAAgD+l+puzwPIStP//f7+C5JIzkhf0s///f79be5gzoPX/u6D1f7+x9IK8wPIStP//f7+C5JIzkhf0s///f79be5gzwPIStP//f7+C5JIzoPX/u6D1f7+x9IK8khf0s///f79be5gzv8zMOe//f7/AqLY6oPX/u6D1f7+x9IK8bakFtAAAgL+GMKQzv8zMOe//f7/AqLY6AUIOtAAAgL+OGpczbakFtAAAgL+GMKQzmqbnswAAgL+SGpczv8zMOe//f7/AqLY6bakFtAAAgL+GMKQzmqbnswAAgL+SGpczHnghtAAAgL+hdb0z27kXtAAAgL+aUJMzgnUEtAAAgL9OnpUzpVrxswAAgL9xpnQzrePuswAAgL81gZcz3WXnswAAgL/4SJczSPXjswAAgL97LKkz0OviswAAgL9QHYEzAAAAAAAAgL/ImsAzrePuswAAgL81gZczSPXjswAAgL97LKkzrePuswAAgL81gZcz27kXtAAAgL+aUJMzSPXjswAAgL97LKkz27kXtAAAgL+aUJMzpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zAAAAAAAAgL/ImsAz0OviswAAgL9QHYEzphrOswAAgL/Z2A00AAAAAAAAgL/ImsAzAtQEtP//f7+CAZUzgnUEtAAAgL9OnpUz0OviswAAgL9QHYEzphrOswAAgL/Z2A007jVyswAAgL99UmszJ+4YtAAAgL94J7czgnUEtAAAgL9OnpUz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czWpDyswAAgL9lP5sz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czaeMMtAAAgL/ITIQzWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz09b1swAAgL9G2a4zWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz2Av+swAAgL9O45cz09b1swAAgL9G2a4z2Av+swAAgL9O45cz09b1swAAgL9G2a4zhga8swAAgL851pIz2Av+swAAgL9O45czx7bOswAAgL8kEcQzhga8swAAgL851pIzx7bOswAAgL8kEcQzhga8swAAgL851pIzQxZNswAAgL9iH/8yx7bOswAAgL8kEcQzQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszAAAAAAAAgL+uQpszAUIOtAAAgL+OGpcznKbnswAAgL8XiaIzmqbnswAAgL+SGpczo3TDs///f78fbZYzAUIOtAAAgL+OGpczo3TDs///f78fbZYzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzo3TDs///f78fbZYzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gzGizZswAAgL/hbZczUsgQtAAAgL9Au5gzSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zGizZswAAgL/hbZczSlvvswAAgL/3VLUzGizZswAAgL/hbZczSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5IzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5Izz122swAAgL8J5oszyl22s///f78f2KEzAG0otAAAgL9Pt5Ize1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzyl22s///f78f2KEzH23gswAAgL9A6JUzyl22s///f78f2KEzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzaZ0atAAAgL/IA5wzAtQEtP//f7+CAZUzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzao+rswAAgL/zg74zaZ0atAAAgL/IA5wzW5AEtAAAgL8nZIUzaZ0atAAAgL/IA5wzao+rswAAgL/zg74zAtQEtP//f7+CAZUzao+rswAAgL/zg74z7jVyswAAgL99UmszphrOswAAgL/Z2A007jVyswAAgL99UmszLQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/GtsMPwAAAACswVW/GtsMPwAAAACswVW/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/LNWVvgAAAADqyXS/LNWVvgAAAADqyXS/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/b5M3vwAAAABlazK/b5M3vwAAAABlazK/mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+2V1svwAAAACJncS+2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/5BFyPwAAAABNjaY+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/b5M3PwAAAABlazI/b5M3PwAAAABlazI/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/GtsMvwAAAACswVU/GtsMvwAAAACswVU/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/o6dRvwAAAAAm4xI/o6dRvwAAAAAm4xI/xWlivwAAAADe6e4+xWlivwAAAADe6e4+03dpvwAAAACkAdI+03dpvwAAAACkAdI+SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/cS4tPwAAAAAeiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/bS4tPwAAAAAiiDy/nKbnMwAAgD+9OpKzCSH2MwAAgD8IUYqzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzicxMuqv/fz+9H0q7CsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzA0IONAAAgD+/OpKzCsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzwk0CNP//fz/8MWSz6qbnMwAAgD8X4aizCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizcpruM///fz99yJ2zdsYINAAAgD8pjIuzICzZMwAAgD+Opq+zdsYINAAAgD8pjIuzSPXjMwAAgD/u66mzcpruM///fz99yJ2zdsYINAAAgD8pjIuzy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzcpruM///fz99yJ2zy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzUsYINAAAgD8xJXyzy4zZMwAAgD8u2Yqz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2zUsYINAAAgD8xJXyz5N/8MwAAgD886JWzUsYINAAAgD8xJXyzpk3KMwAAgD9rqLOz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2z63ehMwAAgD9VRxW0pk3KMwAAgD9rqLOzWmHdM///fz+CAZWzmAQBNAAAgD9sAq2zPAM1NAAAgD8Qo0mzpk3KMwAAgD9rqLOzPAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0PAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0WmHdM///fz+CAZWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzWmHdM///fz+CAZWz0OviMwAAgD8Nm5ezvdYFNAAAgD8+9m+zUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWz0OviMwAAgD8Nm5ez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzXsYINAAAgD8A8HezKKe1M///fz+odb2z3K/NMwAAgD8ozbmz0OviMwAAgD8Nm5ezbOD8MwAAgD+EVkKzp00CNAAAgD9/dpSzvdYFNAAAgD8+9m+z98IHNAAAgD8pwMWzXsYINAAAgD8A8Hez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzbOD8MwAAgD+EVkKzXsYINAAAgD8A8HezbOD8MwAAgD+EVkKz98IHNAAAgD8pwMWzKKe1M///fz+odb2z98IHNAAAgD8pwMWzKKe1M///fz+odb2z5u48NAAAgD+ZmsCz3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzvdYFNAAAgD8+9m+z3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azgpwCNAAAgD/AkKCzOqYZNAAAgD9XZHqz4dm7MwAAgD/a36azS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzJLAcNAAAgD8H2RyzFQmbMwAAgD9acRq0S/YGNAAAgD+98iazJLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzFQmbMwAAgD9acRq0JLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzFQmbMwAAgD9acRq0LxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzgQKZMwAAgD+uQpuzAAAAAKr/fz+5S1M7IGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7khf0M///fz9V65CzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7CsXeMwAAgD8tXaCzAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8u+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WS/LvnkPgAAAIAAAAAALvnkPi75ZL8AAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAu+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8AAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8u+WQ/LvnkPgAAAIAAAMA+AACAPwAAAD4AAIA+AADAPgAAAAAAACA/AABAPwAAID8AAAA/AAAgPwAAAAAAACA/AACAPgAAwD4AAEA/AAAAPgAAAD8AAMA+AABAPwAAwD4AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAAA/AADAPgAAAD8AAMA+AAAAPwAAAwAHAAkABAAOAA8ABgAMAAsABQACAAgADQAKAAgACgABAPf/f7+xIdvAvv9/v/f/f7+xIdvAvv9/v/f/f7+xIdvAvv9/vwAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96Nvf/f7+xIdvAIACAP/f/f7+xIdvAIACAP/f/f7+xIdvAIACAPwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPy35ZL8u+eS+AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAu+eS+Lflkvy35ZD8v+eS+AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAwD4AAIA/AADAPgAAAAAAAAA+AACAPgAAID8AAEA/AAAgPwAAAD8AACA/AAAAAAAAID8AAIA+AADAPgAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAADAAcACAAEAA0ADwAGAAwACgAFAAEACQAOAAsACQALAAIAG5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/vwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/vwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/PwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/PwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AAADAAkAAAAJAAYACAAKABUACAAVABMAFAAXABEAFAARAA4ADQAPAAQADQAEAAIABwASAAwABwAMAAEAFgALAAUAFgAFABAA"}]}};var TA="#include <gl2_vert>\n\nattribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float pointSize;\n\n//引入fbo picking的vert相关函数\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    //传入gl_Position的depth值\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n";const OA=[0,1e5,0],FA=[0,0,0],EA=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],UA=[3,1,0,0,2,3],jA=[.1,.1,.1],NA=[],QA=[],SA=[],BA=[],RA=[],kA=[],GA=[],YA=[],WA=[0,-1,0],qA={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},VA={4:[4,5],5:[4,5],7:[7,8],8:[7,8],9:[9,10,11],10:[9,10,11],11:[9,10,11]},KA=[6];class HA{constructor(A,t,n,i,r){this.map=A,this.renderer=t,this.updateTRS(n,i,r),this.createPickHelper(),this.createHelperMeshes(),this._(),this.registEvents(),this.mouseAction="moving",this.J=null,this.$=!0}registEvents(){const A=this.map;A.on("dom:mousemove",this.AA,this),A.on("dom:mousedown",this.tA,this),A.on("dom:mouseup",this.nA,this),A.on("zooming moving dragrotating",this.iA,this)}unregistEvents(){const A=this.map;A.off("dom:mousemove",this.AA,this),A.off("dom:mousedown",this.tA,this),A.off("dom:mouseup",this.nA,this),A.off("zooming moving dragrotating",this.iA,this)}AA(A){this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y};const t=this.getCntrollerMeshes();if(this.currentPickingObject=this.rA(this.currentMousePosition,t,"meshes"),"transform"===this.mouseAction){if("z-translate"===this.eA){const n=b(SA,t[9].localTransform);this.sA(!0,n,[this.uA[0]*Math.PI/180,this.uA[1]*Math.PI/180,this.uA[2]*Math.PI/180])}else if("y-rotate"===this.eA){const n=b(SA,t[4].localTransform);this.sA(!0,n,[90*Math.PI/180,0,-this.uA[2]])}else if("z-rotate"===this.eA){const n=b(SA,t[7].localTransform);this.sA(!0,n,[0,0,0])}}else this.sA(!1);this.oA(),this.hA(this.currentMousePosition)}oA(){this.fA(),this.currentPickingObject&&null!=this.currentPickingObject.meshId&&(this.lastPickingMeshId=this.currentPickingObject.pickingId,this.cA(this.currentPickingObject.pickingId,.6)),this.aA()}hA(A){if("transform"===this.mouseAction){const A=this.vA,t=this.rA(this.currentMousePosition,[A],"plane"),n=this.rA(this.lastMousePosition,[A],"plane");if(!t||null===t.meshId||!n||null===n.meshId)return;const i=[0,0,0];let r=0;if("z-translate"===this.eA){i[0]=t.point[0]-n.point[0],i[1]=t.point[1]-n.point[1],i[2]=t.point[2]-n.point[2];const A=this.lA(),r=N(i,A),e=function(A){var t=A[0],n=A[1],i=A[2];return Math.sqrt(t*t+n*n+i*i)}(i)*Math.cos(r),s=Math.sign(e)*Math.sqrt(Math.pow(e,2)/(Math.pow(A[0],2)+Math.pow(A[1],2)+Math.pow(A[2],2))),u=T(BA,A[0]*s,A[1]*s,A[2]*s);this.wA(u)}else"y-rotate"!==this.eA&&"z-rotate"!==this.eA||(r=this.PA(t.point,n.point,this.eA),this.gA(r,this.eA))}this.lastMousePosition=A,this.lastPickingObject=this.currentPickingObject,this.lastPickingMeshId=this.currentPickingObject.meshId}PA(A,t,n){const i=this.CA;let r,e;"y-rotate"===n?(r=W(GA,t[0]-i[0],t[2]-i[2]),e=W(YA,A[0]-i[0],A[2]-i[2])):"z-rotate"===n&&(r=W(GA,t[0]-i[0],t[1]-i[1]),e=W(YA,A[0]-i[0],A[1]-i[1]));const s=Math.atan2(r[1],r[0]);return(Math.atan2(e[1],e[0])-s)/Math.PI*180}wA(A){O(this.CA,this.CA,A),this.DA()}gA(A,t){"y-rotate"===t?this.uA[1]-=A:"z-rotate"===t&&(this.uA[2]+=A),this.DA()}DA(){const A=this.updateMatrix();C(A,A,jA);const t=this.getCntrollerMeshes();for(let n=0;n<t.length;n++){const i=t[n];let r=A;7!==n&&8!==n||(r=this.updateMatrixExcept(0),C(r,r,jA)),g(i.localTransform,r,i.nodeMatrix)}}aA(){this.renderer&&this.renderer.parentRenderer.setToRedraw()}tA(A){this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y};const t=this.getCntrollerMeshes();this.firstDownPoint=this.currentPickingObject=this.rA(this.currentMousePosition,t,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.IA(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.aA()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0)),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=t[this.currentPickingObject.meshId]}IA(A){VA[9].indexOf(A)>-1?this.eA="z-translate":VA[4].indexOf(A)>-1?this.eA="y-rotate":VA[7].indexOf(A)>-1&&(this.eA="z-rotate")}sA(A,t,n){const i=this.vA,r=t||i.originTranslation,e=function(A,t){var n=t[0],i=t[1],r=t[2],e=t[4],s=t[5],u=t[6],o=t[8],h=t[9],f=t[10];return A[0]=Math.sqrt(n*n+i*i+r*r),A[1]=Math.sqrt(e*e+s*s+u*u),A[2]=Math.sqrt(o*o+h*h+f*f),A}(QA,i.localTransform);let s=G(NA,0,0,0);z(i.localTransform,s,r,e),A&&!this.MA()&&(M(i.localTransform,i.localTransform,n[2]),D(i.localTransform,i.localTransform,n[0]),I(i.localTransform,i.localTransform,n[1]))}MA(){if(this.map.getPitch())return!1;const A=this.map.cameraPosition,t=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());T(t,t.x,t.y,0);const n=this.bA.getCoordinates(),i=this.map.coordinateToPointAtRes(n,this.map.getGLRes()),r=this.bA.getTranslation(),e=T(SA,i.x,i.y,0),s=O(e,e,r);return N(F(BA,A,s),F(BA,A,t))<1/180*Math.PI}nA(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.$=!0),this.mouseAction="moving",this.eA=null,this.map.config("zoomable",!0),this.map.config("draggable",!0),this.aA()}iA(){this.$=!0}fA(){H(this.lastPickingMeshId)&&this.cA(this.lastPickingMeshId),this.map.resetCursor()}cA(A,t){const n=this.getCntrollerMeshes();if(KA.indexOf(A)<0){const i=VA[A];if(i)for(let A=0;A<i.length;A++){this.zA(n[i[A]],t)}else{this.zA(n[A],t)}}this.map.setCursor("pointer")}zA(A,t){const n=A.material.get("polygonFill");n[3]=t||A.originOpacity,A.material.set("polygonFill",n)}rA(A,t,n){const i=this.map;if(!(i&&this.G&&this.renderer&&this.renderer.canvas))return null;const r=i.getDevicePixelRatio(),e=A.x*r,s=A.y*r,u={projViewMatrix:this.map.projViewMatrix,pointSize:1};return!this.$&&this.xA&&this.xA===n||(this.G.render(t,u,!0),this.xA=n,this.$=!1),this.G.pick(e,s,10,u,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}updateTRS(A,t,n){this.CA=L([],A),this.dA=L([],n),this.uA=L([],t)}updateMatrix(){const A=this.uA,t=this.CA,n=this.dA,i=S(NA);return k(i,i,A[2]*Math.PI/180),B(i,i,A[0]*Math.PI/180),R(i,i,A[1]*Math.PI/180),z(RA,i,t,n)}updateMatrixExcept(){const A=L([],this.uA);A[0]=0;const t=this.CA,n=this.dA,i=S(NA);return k(i,i,A[2]*Math.PI/180),B(i,i,A[0]*Math.PI/180),R(i,i,A[1]*Math.PI/180),z(kA,i,t,n)}lA(){const A=this.uA,t=P([]);return M(t,t,A[2]*Math.PI/180),D(t,t,A[0]*Math.PI/180),I(t,t,A[1]*Math.PI/180),j(BA,WA,t)}createPickHelper(){const t=new Q$7({POSITION:EA},UA,0,{primitive:"triangles",positionAttribute:"POSITION"}),n=t$2.Util.extend({},qA,{polygonFill:[0,0,0,.001]});this.vA=new ft$6(t,new rt$6(n)),this.vA.setUniform("uPickingId",12);const i=P([]),r=G([],0,0,0);this.vA.originRotation=[0,0,0],z(i,r,this.CA,[3,3,3]),this.vA.originTranslation=this.CA,this.vA.localTransform=i,this.vA.transparent=!0,this.vA.setDefines({HAS_HELPERPARTS:1,HAS_PICKING_ID:2})}createHelperMeshes(){this.yA=this.mA("helper"),this.pA=[],this.pA.push(...this.yA),this.pA.push(this.vA)}getPickHelperMesh(){return this.vA}getCntrollerMeshes(){return this.yA}getAllMeshes(){return this.pA.length<12&&this.pA.push(...this.yA),this.pA}createProjViewMatrix(){const A=this.updateMatrix(),t=j([],FA,A),n=j([],OA,A),i=Math.sqrt(Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)+Math.pow(n[2]-t[2],2));return g([],function(A,t,n,i,r,e,s){var u=1/(t-n),o=1/(i-r),h=1/(1-s);return A[0]=-2*u,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*o,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*h,A[11]=0,A[12]=(t+n)*u,A[13]=(r+i)*o,A[14]=(s+1)*h,A[15]=1,A}([],-this.dA[0],this.dA[1],-this.dA[0],this.dA[1],0,i),d([],n,t,[0,0,1]))}mA(t){const n=[],i=function(t){return zd.loadGLTF("",LA[t]).then((A=>A))}(t),r=this.updateMatrix();return C(r,r,jA),i.then((t=>{zd.exportGLTFPack(t).getMeshesInfo().forEach(((t,i)=>{const e=t.materialInfo||{};e.polygonFill=6===i?[1,1,1,.1]:[1,1,1,1],t$2.Util.extend(e,qA,e);const s=new rt$6(e),u=new ft$6(t.geometry,s);u.setUniform("uPickingId",i);const o=u.getDefines();if(o.HAS_HELPERPARTS=1,o.HAS_PICKING_ID=2,u.setDefines(o),u.nodeMatrix=t.nodeMatrix,u.originTransform=function(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[3],A[4]=t[4],A[5]=t[5],A[6]=t[6],A[7]=t[7],A[8]=t[8],A[9]=t[9],A[10]=t[10],A[11]=t[11],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15],A}([],u.localTransform),7===i||8===i){const A=this.updateMatrixExcept(0);C(A,A,jA),g(u.localTransform,A,u.nodeMatrix)}else g(u.localTransform,r,u.nodeMatrix);u.originOpacity=6===i?.1:1,u.transparent=!0,n.push(u)}))})),n}_(){this.pickingFBO=this.renderer.regl.framebuffer(this.renderer.canvas.width,this.renderer.canvas.height),this.G=new Am(this.renderer,{vert:TA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(A,t){return g([],t.projViewMatrix,t.modelMatrix)}}]},this.pickingFBO,this.map)}LA(){this.unregistEvents(),this.dispose()}dispose(){this.getAllMeshes().forEach((A=>{A.geometry.dispose(),A.dispose()})),this.pickingFBO&&this.pickingFBO.destroy()}resize(A,t){this.pickingFBO.width===A&&this.pickingFBO.height===t||this.pickingFBO.resize(A,t)}}class _A extends ie$5{constructor(A={}){const t=[],n=[],i=A.uniforms,r=[{name:"modelNormalMatrix",type:"function",fn:function(A,n){return function(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[4],A[4]=t[5],A[5]=t[6],A[6]=t[8],A[7]=t[9],A[8]=t[10],A}(t,n.modelMatrix)}},{name:"modelViewMatrix",type:"function",fn:function(A,t){return g(n,t.viewMatrix,t.modelMatrix)}}];i&&r.push(...i),super({vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\n#include <line_extrusion_vert>\n\n\n\n#ifdef HAS_MAP\n\n    uniform vec2 uvScale;\n\n    uniform vec2 uvOffset;\n\n    attribute vec2 aTexCoord;\n\n    varying vec2 vTexCoord;\n\n#endif\n\n#if defined(HAS_COLOR)\n\n    attribute vec4 aColor;\n\n    varying vec4 vColor;\n\n#elif defined(HAS_COLOR0)\n\n    attribute vec4 aColor0;\n\n    varying vec4 vColor;\n\n#endif\n\n\n\nvarying vec3 vFragPos;\n\nvarying vec3 vNormal;\n\n\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat3 modelNormalMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform vec2 halton;\n\nuniform vec2 outSize;\n\n\n\nuniform mat4 projViewMatrix;\n\n\n\n#include <get_output>\n\n#include <heatmap_render_vert>\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n    #include <vsm_shadow_vert>\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    attribute float aExtrusionOpacity;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_TANGENT)\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n) {\n\n    n = vec3( 0.0,  0.0,  1.0) +\n\n        vec3( 2.0, -2.0, -2.0) * q.x * q.zwx +\n\n        vec3( 2.0,  2.0, -2.0) * q.y * q.wzy;\n\n}\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n, out highp vec3 t) {\n\n    toTangentFrame(q, n);\n\n    t = vec3( 1.0,  0.0,  0.0) +\n\n        vec3(-2.0,  2.0, -2.0) * q.y * q.yxw +\n\n        vec3(-2.0,  2.0,  2.0) * q.z * q.zwx;\n\n}\n\n\n\n\n\nvoid main()\n\n{\n\n    #ifdef IS_LINE_EXTRUSION\n\n        vec4 localPosition = getPosition(getLineExtrudePosition(aPosition));\n\n    #else\n\n        vec4 localPosition = getPosition(aPosition);\n\n    #endif\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n\n\n    vFragPos = vec3(modelMatrix * localPositionMatrix * localPosition);\n\n\n\n    #if defined(HAS_NORMAL) || defined(HAS_TANGENT)\n\n        mat3 localNormalMatrix = modelNormalMatrix * mat3(localPositionMatrix);\n\n        vec3 Normal;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t;\n\n            toTangentFrame(aTangent, Normal, t);\n\n            vTangent = vec4(localNormalMatrix * t, aTangent.w);\n\n        #else\n\n            #ifdef HAS_DECODE_NORMAL\n\n                Normal = getNormal(aNormal);\n\n            #else\n\n                Normal = aNormal;\n\n            #endif\n\n        #endif\n\n        vec3 localNormal = appendMorphNormal(Normal);\n\n        vNormal = normalize(localNormalMatrix * localNormal);\n\n    #else\n\n        vNormal = vec3(0.0);\n\n    #endif\n\n\n\n    mat4 jitteredProjection = projMatrix;\n\n    jitteredProjection[2].xy += halton.xy / outSize.xy;\n\n    gl_Position = jitteredProjection * modelViewMatrix * localPositionMatrix * localPosition;\n\n    #ifdef HAS_MAP\n\n        vec2 TexCoord = getTexcoord(aTexCoord);\n\n        vTexCoord = TexCoord * uvScale + uvOffset;\n\n    #endif\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        vExtrusionOpacity = aExtrusionOpacity;\n\n    #endif\n\n    #if defined(HAS_COLOR)\n\n        vColor = aColor / 255.0;\n\n    #elif defined(HAS_COLOR0)\n\n        vColor = aColor0 / 255.0;\n\n    #endif\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPositionMatrix * localPosition;\n\n}\n\n",frag:"precision mediump float;\n\n#include <gl2_frag>\n\n\n\nuniform vec4 baseColorFactor;\n\nuniform float materialShininess;//反光度，即影响镜面高光的散射/半径\n\nuniform float opacity;\n\nuniform float environmentExposure;\n\nuniform float specularStrength;\n\n\n\nuniform vec3 light0_viewDirection;\n\nuniform vec3 ambientColor;\n\nuniform vec4 light0_diffuse;\n\nuniform vec3 lightSpecular;\n\nuniform vec3 cameraPosition;\n\n\n\n#ifdef HAS_TANGENT\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\n#ifdef HAS_MAP\n\n    varying vec2 vTexCoord;\n\n#endif\n\nvarying vec3 vNormal;\n\nvarying vec3 vFragPos;\n\n\n\n#ifdef HAS_INSTANCE_COLOR\n\n    varying vec4 vInstanceColor;\n\n#endif\n\n\n\n#ifdef HAS_BASECOLOR_MAP\n\n    uniform sampler2D baseColorTexture;\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    uniform vec2 extrusionOpacityRange;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n    varying vec4 vColor;\n\n#elif defined(IS_LINE_EXTRUSION)\n\n    uniform vec4 lineColor;\n\n#else\n\n    uniform vec4 polygonFill;\n\n#endif\n\n\n\n#ifdef IS_LINE_EXTRUSION\n\n    uniform float lineOpacity;\n\n#else\n\n    uniform float polygonOpacity;\n\n#endif\n\n\n\n#ifdef HAS_OCCLUSION_MAP\n\n    uniform sampler2D occlusionTexture;\n\n#endif\n\n\n\n#ifdef HAS_NORMAL_MAP\n\n    uniform sampler2D normalTexture;\n\n#endif\n\n\n\n#ifdef HAS_EMISSIVE_MAP\n\n    uniform sampler2D emissiveTexture;\n\n#endif\n\n\n\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\n\n    uniform vec4 diffuseFactor;\n\n    uniform vec3 specularFactor;\n\n    #ifdef HAS_DIFFUSE_MAP\n\n        uniform sampler2D diffuseTexture;\n\n    #endif\n\n    #ifdef HAS_SPECULARGLOSSINESS_MAP\n\n        uniform sampler2D specularGlossinessTexture;\n\n    #endif\n\n#endif\n\n#include <heatmap_render_frag>\n\n\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n  #include <vsm_shadow_frag>\n\n#endif\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\nvec3 transformNormal() {\n\n    #if defined(HAS_NORMAL_MAP)\n\n        vec3 n = normalize(vNormal);\n\n        vec3 normal = texture2D(normalTexture, vTexCoord).xyz * 2.0 - 1.0;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t = normalize(vTangent.xyz);\n\n            vec3 b = normalize(cross(n, t) * sign(vTangent.w));\n\n            mat3 tbn = mat3(t, b, n);\n\n            return normalize(tbn * normal);\n\n        #else\n\n            return normalize(normal);\n\n        #endif\n\n    #else\n\n        return normalize(vNormal);\n\n    #endif\n\n}\n\n\n\nvec4 linearTosRGB(const in vec4 color) {\n\n    return vec4( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055, color.a);\n\n}\n\n\n\nvec4 getBaseColor() {\n\n    #if defined(HAS_BASECOLOR_MAP)\n\n        return texture2D(baseColorTexture, vTexCoord);\n\n    #elif defined(HAS_DIFFUSE_MAP)\n\n        return texture2D(diffuseTexture, vTexCoord);\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return diffuseFactor;\n\n    #else\n\n        return baseColorFactor;\n\n    #endif\n\n}\n\n\n\nvec3 getSpecularColor() {\n\n    #if defined(HAS_SPECULARGLOSSINESS_MAP)\n\n        return texture2D(specularGlossinessTexture, vTexCoord).rgb;\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return specularFactor;\n\n    #else\n\n        return vec3(1.0);\n\n    #endif\n\n}\n\n\n\nvoid main() {\n\n    //环境光\n\n    vec4 baseColor = getBaseColor();\n\n    vec3 ambient = environmentExposure * ambientColor * baseColor.rgb;\n\n\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        ambient *= vInstanceColor.rgb;\n\n    #endif\n\n\n\n    //漫反射光\n\n    vec3 norm = transformNormal();\n\n    vec3 lightDir = normalize(-light0_viewDirection);\n\n    float diff = max(dot(norm, lightDir), 0.0);\n\n    vec3 diffuse = light0_diffuse.rgb * diff * baseColor.rgb;\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        vec3 color = vColor.rgb;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        vec3 color = lineColor.rgb;\n\n    #else\n\n        vec3 color = polygonFill.rgb;\n\n    #endif\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        color *= vInstanceColor.rgb;\n\n    #endif\n\n    ambient *= color.rgb;\n\n    diffuse *= color.rgb;\n\n\n\n    //镜面反色光\n\n    vec3 viewDir = normalize(cameraPosition - vFragPos);\n\n    vec3 halfwayDir = normalize(lightDir + viewDir);\n\n    float spec = pow(max(dot(norm, halfwayDir), 0.0), materialShininess);\n\n    vec3 specular = specularStrength * lightSpecular * spec * getSpecularColor();\n\n    #ifdef HAS_OCCLUSION_MAP\n\n        float ao = texture2D(occlusionTexture, vTexCoord).r;\n\n        ambient *= ao;\n\n    #endif\n\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n        float shadowCoeff = shadow_computeShadow();\n\n        diffuse = shadow_blend(diffuse, shadowCoeff).rgb;\n\n        specular = shadow_blend(specular, shadowCoeff).rgb;\n\n    #endif\n\n    vec3 result = ambient + diffuse + specular;\n\n\n\n    #ifdef HAS_EMISSIVE_MAP\n\n        vec3 emit = texture2D(emissiveTexture, vTexCoord).rgb;\n\n        result += emit;\n\n    #endif\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        discard;\n\n    }\n\n    glFragColor = vec4(result, opacity);\n\n    // glFragColor = linearTosRGB(glFragColor);\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        float colorAlpha = vColor.a;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        float colorAlpha = lineColor.a;\n\n    #else\n\n        float colorAlpha = polygonFill.a;\n\n    #endif\n\n        glFragColor *= colorAlpha;\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        float topAlpha = extrusionOpacityRange.x;\n\n        float bottomAlpha = extrusionOpacityRange.y;\n\n        float alpha = topAlpha + vExtrusionOpacity * (bottomAlpha - topAlpha);\n\n        alpha = clamp(alpha, 0.0, 1.0);\n\n        glFragColor *= alpha;\n\n    #endif\n\n\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:r,defines:A.defines||{},extraCommandProps:A.extraCommandProps||{}}),this.version=300}}const JA=[0,0,0,1],ZA={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]};class XA extends q{h(){this.TA=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.OA=new ie$5({vert:mA,frag:pA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>g([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.FA=new ie$5({vert:mA,frag:pA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>g([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u,depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.EA=new _A({extraCommandProps:{viewport:this.u,blend:{enable:(A,t)=>!!t.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}}),this.UA=new _A({extraCommandProps:{viewport:this.u,blend:{enable:(A,t)=>!!t.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"},depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.jA=new yt$6,this.NA=new yt$6,this.F=new yt$6}QA(A,t,n,i){this.controller=new HA(A,this.renderer,t,n,i)}SA(A,t,n){this.controller&&(this.controller.updateTRS(A,t,n),this.controller.DA(),this.controller.aA())}render(A,t){this.U(),this.renderer.clear({color:JA,depth:1,framebuffer:this.T});const n=this.BA(A),i=this.controller.getAllMeshes(),r=this.controller.createProjViewMatrix();return this.RA(n,i,r,t.map),this.kA(n,i,r,t.map),{meshesMap:this.TA,invisibleMap:this.T}}BA(t){const n=[];for(let i=0;i<t.length;i++){const r=t$2.Util.extend({},t[i].material.uniforms,ZA),e=new rt$6(r),s=new ft$6(t[i].geometry,e),u=s.getDefines();u.HAS_CUT=1,s.setDefines(u),s.localTransform=t[i].localTransform,n.push(s)}return n}kA(A,t,n,i){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.T});const r={cut_projViewMatrixFromViewpoint:n,projViewMatrix:i.projViewMatrix};this.F.setMeshes(A),this.renderer.render(this.OA,r,this.F,this.T),this.F.setMeshes(t),this.renderer.render(this.FA,r,this.F,this.T)}RA(t,n,i,r){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.TA});const e=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,s=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height,u={projMatrix:r.projMatrix,cut_projViewMatrixFromViewpoint:i,projViewMatrix:r.projViewMatrix,viewMatrix:r.viewMatrix,cameraPosition:r.cameraPosition,altitudeScale:1,outSize:[e,s],halton:[.2107,-.0202],polygonFill:[1,1,1,1],polygonOpacity:1};!function(t,n,i,r){const{iblTexes:e,dfgLUT:s}=Fm.PBRUtils.getIBLResOnCanvas(n);if(i&&i.getLights()){const n=Fm.PBRUtils.getPBRUniforms(i,e,s,r,r),u=i.getLights();t.ambientColor=u.ambient&&u.ambient.color?u.ambient.color:[1,1,1],n&&t$2.Util.extend(t,n)}else{const n=Fm.PBRUtils.getPBRUniforms(i,null,s,r,r);t$2.Util.extend(t,n)}}(u,this.renderer.canvas,r),this.jA.setMeshes(t),this.renderer.render(this.EA,u,this.jA,this.TA),this.NA.setMeshes(n),this.renderer.render(this.UA,u,this.NA,this.TA)}dispose(){this.T&&this.T.destroy(),this.C&&this.C.dispose(),this.GA&&this.GA.dispose(),this.controller&&this.controller.LA()}U(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t),!this.TA||this.TA.width===A&&this.TA.height===t||this.TA.resize(A,t),this.controller&&this.controller.resize(A,t)}}const At=[0,0,0,1,1,-1,1,-1,-1,1,-1,1,1,1,1,1,0,0],tt=[0,1,0,2,0,3,0,4,1,2,2,3,3,4,4,1,0,5],nt=[],it=S([]),rt=S([]),et=[],st=[1,0,0],ut=[],ot=[],ht=[0,0,0,1];let ft=.01;class ct extends q{h(){super.h(),this.WA=new ie$5({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 viewshed_projViewMatrixFromViewpoint;\n\nvarying vec4 viewshed_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    viewshed_positionFromViewpoint = viewshed_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 viewshed_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\nuniform float near;\n\nuniform float far;\n\n#ifdef HAS_HELPERLINE\n\n  uniform vec3 lineColor;\n\n#endif\n\n\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1.);\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n\n    return dot(v, UnpackFactors);\n\n}\n\n\n\nfloat linear(float value) {\n\n    float z = value * 2.0 - 1.0;\n\n    return (2.0 * near * far) / (far + near - z * (far - near));\n\n}\n\n\n\nvoid main() {\n\n    #ifdef HAS_HELPERLINE\n\n        gl_FragColor = vec4(lineColor, 0.009);\n\n    #else\n\n        vec3 shadowCoord = (viewshed_positionFromViewpoint.xyz / viewshed_positionFromViewpoint.w)/2.0 + 0.5;\n\n        vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n        float depth = unpackRGBAToDepth(rgbaDepth);\n\n        float linearZ = linear(shadowCoord.z);\n\n        float linearDepth = linear(depth);\n\n        if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && linearZ >= near && linearZ <= far) {\n\n            if (linearZ / far <= linearDepth / (far - near)) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//可视区\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//不可视区\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        }\n\n    #endif\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>g([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=new Q$7({POSITION:At},tt,0,{primitive:"lines",positionAttribute:"POSITION"});this.qA=new ft$6(t,new tt$6({lineColor:[.8,.8,.1]}));const n=this.qA.getDefines();n.HAS_HELPERLINE=1,this.qA.setDefines(n),this.F=new yt$6}render(A,t){const{eyePos:n,lookPoint:i,horizontalAngle:r,verticalAngle:e}=t;if(!this.m(r,e)||!n||!i)return this.T;this.C||this.D(r,e),this.U(r,e),this.renderer.clear({color:ht,depth:1,framebuffer:this.T}),this.qA.localTransform=this.VA(n,i,r,e),A.push(this.qA),this.F.setMeshes(A);const{projViewMatrixFromViewpoint:s,far:u}=this.KA(n,i,e,r);return this.g(this.F,s,u),this.HA(this.F,s,t.projViewMatrix,u),this.T}VA(A,t,n,i){const r=Math.sqrt(Math.pow(A[0]-t[0],2)+Math.pow(A[1]-t[1],2)+Math.pow(A[2]-t[2],2));r<=0&&console.warn("both lookpoint and eyePos are in the same position");const e=P(nt),s=T(et,t[0]-A[0],t[1]-A[1],t[2]-A[2]),u=n*Math.PI/360,o=i*Math.PI/360;let h=N(st,T(ut,s[0],s[1],0));h=s[1]>=0?h:2*Math.PI-h;const f=k(it,rt,h);let c=N(T(ot,s[0],s[1],0),s);return c=s[0]>=0?c:2*Math.PI-c,R(f,f,c),z(e,f,A,[r,r*Math.tan(u),r*Math.tan(o)]),e}HA(A,t,n,i){this.renderer.render(this.WA,{viewshed_projViewMatrixFromViewpoint:t,projViewMatrix:n,near:ft,far:i,depthMap:this.l},A,this.T)}KA(A,t,n,i){const r=n/i,e=Math.sqrt(Math.pow(A[0]-t[0],2)+Math.pow(A[1]-t[1],2)+Math.pow(A[2]-t[2],2));return ft=e/100,{projViewMatrixFromViewpoint:g([],x([],i*Math.PI/180,r,ft,e),d([],A,t,[0,1,0])),far:e}}dispose(){super.dispose(),this.T&&this.T.destroy(),this.WA&&this.WA.dispose(),this.qA&&(this.qA.geometry.dispose(),this.qA.dispose())}U(A,t){const n=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,i=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;if(!this.T||this.T.width===n&&this.T.height===i||this.T.resize(n,i),this.l&&this.l.width/this.l.height!=A/t){const n=this.I(A,t);n&&this.l.resize(n.width,n.height)}}}class vt extends q{render(A,{projViewMatrix:t,lineColor:n,lineWidth:i}){if(A&&A.length)return this._A(),this.U(),this.F.setMeshes(A),this.JA(this.F,t),this.ZA(n,i,this.T),this.T}h(){this.fboExtent=this.XA();const t=this.u;this.extentShader=new ie$5({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>  \n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}",frag:"precision highp float;\n\nvoid main() {\n\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\n}",extraCommandProps:{viewport:t,cull:{enable:!1}}}),this.outlineShader=new de$5({vert:"#if __VERSION__ == 300\n\n\t#define attribute in\n\n\t#define varying out\n\n#endif\n\n\n\nattribute vec2 aPosition;\n\nattribute vec2 aTexCoord;\n\n\n\nvarying vec2 vTexCoord;\n\n\n\nvoid main()\n\n{\n\n  gl_Position = vec4(aPosition, 0., 1.);\n\n  vTexCoord = aTexCoord;\n\n}\n\n",frag:"precision highp float;\n\nprecision highp int;\n\n\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D maskTexture;\n\nuniform vec2 texSize;\n\nuniform vec3 visibleEdgeColor;\n\nuniform float lineWidth;\n\nvoid main() {\n\n    vec2 invSize = (1.0 / texSize) * lineWidth;\n\n    vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize.x, invSize.y, invSize.x, invSize.y);\n\n    vec4 c1 = texture2D(maskTexture, vTexCoord + uvOffset.xy);\n\n    vec4 c2 = texture2D(maskTexture, vTexCoord - uvOffset.xy);\n\n    vec4 c3 = texture2D(maskTexture, vTexCoord + uvOffset.yw);\n\n    vec4 c4 = texture2D(maskTexture, vTexCoord - uvOffset.yw);\n\n    float diff1 = (c1.r - c2.r)*0.7;\n\n    float diff2 = (c3.r - c4.r)*0.7;\n\n    float d = length(vec2(diff1, diff2) );\n\n    float a1 = min(c1.g, c2.g);\n\n    float a2 = min(c3.g, c4.g);\n\n    float visibilityFactor = min(a1, a2);\n\n    gl_FragColor = 1.0 - visibilityFactor > 0.001 ? vec4(visibleEdgeColor, 1.0) * vec4(d) : vec4(0.0);\n\n}",extraCommandProps:{viewport:t,depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}}),this.T=this.regl.framebuffer({color:this.regl.texture({width:t.width(),height:t.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.F=new yt$6}JA(A,t){this.renderer.render(this.extentShader,{projViewMatrix:t},A,this.fboExtent)}ZA(A,t,n){this.renderer.render(this.outlineShader,{texSize:[n.width,n.height],visibleEdgeColor:A||[1,0,0],maskTexture:this.fboExtent,lineWidth:t||1},null,n)}XA(){return this.regl.framebuffer({color:this.regl.texture({width:2,height:2,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}getRenderMeshes(){return this.F.getMeshes()}_A(){this.regl.clear({color:[1,1,1,1],depth:1,framebuffer:this.fboExtent})}dispose(){this.fboExtent&&(this.fboExtent.destroy(),this.extentShader.dispose(),this.outlineShader.dispose(),delete this.fboExtent),this.T&&(this.T.destroy(),delete this.T)}U(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;this.T.width===A&&this.fboExtent.height===t||this.T.resize(A,t),this.fboExtent.width===A&&this.fboExtent.height===t||this.fboExtent.resize(A,t)}}const lt="undefined"==typeof document?null:document.createElement("canvas");class Pt extends q{h(){this.O=new ie$5({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projViewMatrix * worldPosition;\n\n    flood_height = worldPosition.z;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform float waterHeight;\n\nuniform sampler2D extentMap;\n\nuniform float hasExtent;\n\nuniform float type;\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    bool compare = type == 1.0 ? flood_height < waterHeight : flood_height >= waterHeight;\n\n    if (compare) {\n\n        if (hasExtent == 1.0) {\n\n            if (extentColor.r > 0.0) {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n            } else {\n\n                gl_FragColor = vec4(0.0);\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(t,n){this.U(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T});const i=new yt$6(t);return this.nt(i,n),this.T}nt(A,t){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.renderer.render(this.O,t,A,this.T)}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}U(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t)}}const gt=[.1451,.2588,.4863],Ct=[0,0,0,0];class Dt extends yA{constructor(A){super(A),this.type="floodAnalysis"}YA(A){const t=this.layer.getMap();if(this.W={},this.W.waterHeight=_(t,this.options.waterHeight),this.W.waterOpacity=this.options.waterOpacity,this.W.waterColor=this.options.waterColor,this.W.extent=Ct,this.W.extentMap=A.regl.texture({width:2,height:2}),this.W.hasExtent=0,this.W.type=1,this.options.boundary){const{extentMap:A,extentInWorld:t}=this.q(this.options.boundary);this.W.extent=t,this.W.extentMap=A,this.W.hasExtent=1}this.W.projViewMatrix=t.projViewMatrix}S(t){const n=this.u={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(t);const i=new N$8(t.regl);this.B=this.B||new Pt(i,n),this.layer.addAnalysis(this)}update(A,t){if("boundary"===A){const{extentMap:A,extentInWorld:n,extentPolygon:i}=this.q(t);this.W.extent=n,this.W.extentPolygon=i,this.W.extentMap=A}else if("waterHeight"===A){const A=this.layer.getMap();this.W.waterHeight=A.altitudeToPoint(t||0,A.getGLRes())}else this.W[A]=t;super.update(A,t)}renderAnalysis(A){const t={};return this.options.boundary&&this.R.render(this.k,this.K),t.flood_waterColor=this.W.waterColor||gt,t.flood_waterOpacity=this.W.waterOpacity||.6,t.floodMap=this.B.render(A,this.W),t}getDefines(){return{HAS_FLOODANALYSE:1}}}const It=[0,0,0,1,0,0],Mt=[0,1],bt=[],zt=[0,0,0,1];class xt extends q{h(){super.h(),this.it=new ie$5({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 insight_projViewMatrixFromViewpoint;\n\nvarying vec4 insight_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    insight_positionFromViewpoint = insight_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 insight_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\n\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1.);\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n\n    return dot(v, UnpackFactors);\n\n}\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (insight_positionFromViewpoint.xyz / insight_positionFromViewpoint.w)/2.0 + 0.5;\n\n    vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n    float depth = unpackRGBAToDepth(rgbaDepth); // Retrieve the z-value from R\n\n    if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n\n        if (depth <0.001) {\n\n            gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//可视区,green\n\n        } else {\n\n            if (shadowCoord.z <= depth + 0.002) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//可视区,green\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//不可视区,red\n\n            }\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);//非视野范围,blue\n\n    }\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>g([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=new Q$7({POSITION:It},Mt,0,{primitive:"lines",positionAttribute:"POSITION"});this.rt=t,this.qA=new ft$6(t,new tt$6({lineColor:[.8,.8,.1]})),this.F=new yt$6}render(A,t){const{lines:n,horizontalAngle:i,verticalAngle:r}=t;this.C||this.D(i,r),this.U(i,r),this.renderer.clear({color:zt,depth:1,framebuffer:this.T});const e=P(bt);this.qA.localTransform=e;for(let e=0;e<n.length;e++){let{from:s,to:u}=n[e];if(!this.m(i,r)||!s||!u)continue;const{projViewMatrixFromViewpoint:o,far:h}=this.KA(s,u,i,r);this.F.setMeshes(A),this.g(this.F,o,h),this.et(s,u),this.F.setMeshes(this.qA),this.st(this.F,o,t.projViewMatrix)}return this.T}et(t,n){this.rt&&(this.rt.dispose(),this.qA.dispose(),It[0]=t[0],It[1]=t[1],It[2]=t[2],It[3]=n[0],It[4]=n[1],It[5]=n[2],this.rt=new Q$7({POSITION:It},Mt,0,{primitive:"lines",positionAttribute:"POSITION"}),this.qA=new ft$6(this.rt,new tt$6({lineColor:[.8,.8,.1]})))}st(A,t,n){this.renderer.render(this.it,{insight_projViewMatrixFromViewpoint:t,projViewMatrix:n,depthMap:this.l},A,this.T)}KA(A,t,n,i){const r=n/i,e=Math.sqrt(Math.pow(A[0]-t[0],2)+Math.pow(A[1]-t[1],2)+Math.pow(A[2]-t[2],2));return{projViewMatrixFromViewpoint:g([],x([],i*Math.PI/180,r,1,e+1e3),d([],A,t,[0,1,0])),far:e}}dispose(){super.dispose(),this.T&&this.T.destroy(),this.it&&this.it.dispose(),this.qA&&(this.qA.geometry.dispose(),this.qA.dispose())}U(A,t){const n=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():t$2.Util.isFunction(this.u.width)?this.u.width():this.u.width,i=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():t$2.Util.isFunction(this.u.height)?this.u.height():this.u.height;if(!this.T||this.T.width===n&&this.T.height===i||this.T.resize(n,i),this.l&&this.l.width/this.l.height!=A/t){const n=this.I(A,t);n&&this.l.resize(n.width,n.height)}}}const dt=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],yt=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],mt=[],pt=[],Lt=[],Tt=[],Ot=[],Ft=[],Et=[],Ut=[],jt=new t$2.Point(0,0),Nt=[];class Qt{constructor(A,t,n={}){this.setFromPoint(A),this.setToPoint(t),this.ut=n,this.ot={},this.ht=0}setFromPoint(A){this.ft=this.ct(A),this.vt()}setToPoint(A){this.wt=this.ct(A),this.vt()}vt(){this.ot={},this.ht++}test(A,t){const n=[];for(let i=0;i<A.length;i++){const r=A[i],e=r.uuid+"-"+r.version+"-"+r.geometry.version+"-"+this.ht;if(this.ot[e]){n.push(this.ot[e]);continue}if(!this.Pt(r.getBoundingBox(),t))continue;const s=r.localTransform,u=r.geometry,o=u.data[u.desc.positionAttribute].array,h=u.data[u.desc.altitudeAttribute]&&u.data[u.desc.altitudeAttribute].array||Nt,f=u.indices;if(!o||!f){console.warn("there are no POSITION or inidces in mesh");continue}const c=this.Ct(t,o,h,f,u.desc.positionSize,s);if(c){const A={mesh:r,coordinates:c};n.push(A),this.ot[e]=A}}return n}Ct(A,t,n,i,s,u){const o=Z(A,this.ft.x,this.ft.y,this.ft.z),h=Z(A,this.wt.x,this.wt.y,this.wt.z),f=set(Lt,o,h),c=[];for(let r=0;r<i.length;r+=3){const o=i[r],h=i[r+1],a=i[r+2],v=this.Dt(Ft,A,t.slice(o*s,o*s+s),n[o]/100,u),w=this.Dt(Et,A,t.slice(h*s,h*s+s),n[h]/100,u),P=this.Dt(Ut,A,t.slice(a*s,a*s+s),n[a]/100,u),g=set$4(pt,v,w,P),C=this.It(g,f);if(C){if(!C[0]||!C[1])continue;const t=A.pointAtResToAltitude(C[2],A.getGLRes());jt.x=C[0],jt.y=C[1];const n=A.pointAtResToCoordinate(jt,A.getGLRes()),i=new t$2.Coordinate(n.x,n.y,t);c.push({coordinate:i,indices:[o,h,a]})}}return c.length?c:null}Dt(A,t,n,i,r){let e;return t$2.Util.isNumber(i)?(e=t.altitudeToPoint(i,t.getGLRes()),set$3(A,n[0],n[1],0,1),transformMat4$1(A,A,r),A[2]=e):(e=n[2],set$3(A,n[0],n[1],e,1),transformMat4$1(A,A,r)),A}It(A,t){const n=A[0],i=A[1],r=A[2],s=t[0],u=t[1],o=s[0],h=s[1],f=s[2],c=u[0]-s[0],a=u[1]-s[1],v=u[2]-s[2];let l=0,w=0,P=0;n[0]===i[0]&&n[0]===r[0]?l=1:n[1]===i[1]&&n[1]===r[1]?w=1:n[2]===i[2]&&n[2]===r[2]?P=1:(l=(A[2][1]-A[0][1])*(A[2][2]-A[0][2])-(A[1][2]-A[0][2])*(A[2][1]-A[0][1]),w=(A[2][0]-A[0][0])*(A[1][2]-A[0][2])-(A[1][0]-A[0][0])*(A[2][2]-A[0][2]),P=(A[1][0]-A[0][0])*(A[2][1]-A[0][1])-(A[2][0]-A[0][0])*(A[1][1]-A[0][1]));const C=l*c+w*a+P*v;if(0===C)return null;const D=-(l*o+w*h+P*f+-(l*A[0][0]+w*A[0][1]+P*A[0][2]))/C,I=c*D+o,M=a*D+h,b=v*D+f,z=set$4(Tt,I,M,b);return this.Mt(A,z)&&this.bt(t,z)?[I,M,b]:null}Mt(A,t){const n=this.ut.tolerance||1,i=A[0],r=A[1],e=A[2],s=t,u=this.zt(i,r,e),o=this.zt(s,i,r),h=this.zt(s,i,e),f=this.zt(s,r,e);return!(Math.abs(o+h+f-u)>n/1e3)}bt(A,t){const n=this.ut.tolerance||1,i=A[0],r=A[1],s=t,u=length$4(sub$2(Ot,i,r)),o=length$4(sub$2(Ot,i,s)),h=length$4(sub$2(Ot,r,s));return!(Math.abs(o+h-u)>n/1e5)}zt(A,t,n){const s=cross$1([],[t[0]-A[0],t[1]-A[1],t[2]-A[2]],[n[0]-A[0],n[1]-A[1],n[2]-A[2]]);return.5*Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2])}ct(A){return A instanceof t$2.Coordinate?A:Array.isArray(A)?new t$2.Coordinate(A):null}Pt(A,t){const n=[Z(t,this.ft.x,this.ft.y,this.ft.z),Z(t,this.wt.x,this.wt.y,this.wt.z)],i=A[0],r=A[1];for(let A=0;A<dt.length;A+=3)for(let t=0;t<3;t++){const n=3*A+t;mt[n]=dt[n]>0?r[t]:i[t]}for(let A=0;A<yt.length;A+=3){const t=yt[A],i=yt[A+1],r=yt[A+2],e=[mt.slice(3*t,3*t+3),mt.slice(3*i,3*i+3),mt.slice(3*r,3*r+3)];if(this.It(e,n))return!0}return!1}}const Bt=[1,0,0,1];class Rt extends q{h(){this.O=new ie$5({vert:"precision mediump float;\n\nattribute vec3 aPosition;\n\nattribute vec2 aTexCoord;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform vec4 extent;\n\nuniform sampler2D extentMap;\n\nuniform float height;\n\nuniform float useAnalysis;\n\nvarying vec4 vWorldPosition;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\n    vWorldPosition = modelMatrix * vec4(aPosition, 1.0);\n\n    float w = extent.z - extent.x;\n\n    float h = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / w, 1.0 - (vWorldPosition.y - extent.w) / h);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    if (extentColor.r > 0.0) {\n\n        vec4 wPosition = vec4(vWorldPosition.x, vWorldPosition.y, height, vWorldPosition.w);\n\n        if (useAnalysis == 0.0) {\n\n            wPosition = vWorldPosition;\n\n        }\n\n        gl_Position = projViewMatrix * wPosition;\n\n    } else {\n\n        gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n    }\n\n    v_texCoord = aTexCoord;\n\n}\n\n",frag:"precision mediump float;\n\nuniform vec4 extent;\n\nuniform vec4 extentPolygon;\n\nuniform sampler2D extentMap;\n\nuniform sampler2D groundTexture;\n\n#ifdef HAS_MODELTEXTURE\n\n    uniform sampler2D baseColorTexture;\n\n#endif\n\n#ifdef HAS_BASECOLOR\n\n    uniform vec4 baseColorFactor;\n\n#endif\n\nuniform float hasTexture;\n\nuniform float useAnalysis;\n\nvarying vec4 vWorldPosition;\n\nvarying vec2 v_texCoord;\n\n\n\nvoid fragColor() {\n\n    #ifdef HAS_MODELTEXTURE\n\n        gl_FragColor = texture2D(baseColorTexture, v_texCoord);\n\n    #endif\n\n    #ifdef HAS_BASECOLOR\n\n        gl_FragColor = baseColorFactor;\n\n    #endif\n\n}\n\n\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n\n\n    float widthPolygon = extentPolygon.z - extentPolygon.x;\n\n    float heightPolygon = extentPolygon.y - extentPolygon.w;\n\n    vec2 uvInExtentPolygon = vec2((vWorldPosition.x - extentPolygon.x) / widthPolygon, 1.0 - (vWorldPosition.y - extentPolygon.w) / heightPolygon);\n\n    vec4 groundColor = texture2D(groundTexture, uvInExtentPolygon);\n\n    if (extentColor.r > 0.0) {\n\n        if (hasTexture == 1.0) {\n\n            gl_FragColor = groundColor;\n\n            if (useAnalysis == 0.0) {\n\n                fragColor();\n\n            }\n\n        } else {\n\n            fragColor();\n\n        }\n\n        // discard;\n\n    } else {\n\n       fragColor();\n\n    }\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>g([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.F=new yt$6}render(A,t){return this.resize(),this.renderer.clear({color:Bt,depth:1,framebuffer:this.T}),this.F.setMeshes(A),this.renderer.render(this.O,t,this.F,this.T),this.T}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}resize(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t)}}class Gt extends q{h(){this.O=new ie$5({vert:"attribute vec3 aPosition;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 modelViewMatrix;\n\n#include <get_output>\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform sampler2D extentMap;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    if (extentColor.r > 0.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(A,n){return multiply$5([],n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(t,n){this.U(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T});const i=new yt$6(t);return this.nt(i,n),this.T}nt(A,t){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.renderer.render(this.O,t,A,this.T)}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}U(){const A=t$2.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$2.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t)}}var Yt={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function Wt(A,t,n){void 0===n&&(n={});var i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=A,i}function qt(A,t,n){if(void 0===n&&(n={}),!A)throw new Error("coordinates is required");if(!Array.isArray(A))throw new Error("coordinates must be an Array");if(A.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xt(A[0])||!Xt(A[1]))throw new Error("coordinates must contain numbers");return Wt({type:"Point",coordinates:A},t,n)}function Vt(A,t,n){if(void 0===n&&(n={}),A.length<2)throw new Error("coordinates must be an array of two or more positions");return Wt({type:"LineString",coordinates:A},t,n)}function Kt(A,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=A,n}function Ht(A,t){void 0===t&&(t="kilometers");var n=Yt[t];if(!n)throw new Error(t+" units is invalid");return A*n}function _t(A,t){void 0===t&&(t="kilometers");var n=Yt[t];if(!n)throw new Error(t+" units is invalid");return A/n}function Jt(A){return A%(2*Math.PI)*180/Math.PI}function Zt(A){return A%360*Math.PI/180}function Xt(A){return!isNaN(A)&&null!==A&&!Array.isArray(A)}function $t(A){if(!A)throw new Error("coord is required");if(!Array.isArray(A)){if("Feature"===A.type&&null!==A.geometry&&"Point"===A.geometry.type)return A.geometry.coordinates;if("Point"===A.type)return A.coordinates}if(Array.isArray(A)&&A.length>=2&&!Array.isArray(A[0])&&!Array.isArray(A[1]))return A;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function An(A,t,n){if(void 0===n&&(n={}),!0===n.final)return function(A,t){var n=An(t,A);return(n+180)%360}(A,t);var i=$t(A),r=$t(t),e=Zt(i[0]),s=Zt(r[0]),u=Zt(i[1]),o=Zt(r[1]),h=Math.sin(s-e)*Math.cos(o),f=Math.cos(u)*Math.sin(o)-Math.sin(u)*Math.cos(o)*Math.cos(s-e);return Jt(Math.atan2(h,f))}function tn(A,t,n,i){void 0===i&&(i={});var r=$t(A),e=Zt(r[0]),s=Zt(r[1]),u=Zt(n),o=_t(t,i.units),h=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(u));return qt([Jt(e+Math.atan2(Math.sin(u)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(h))),Jt(h)],i.properties)}function nn(A,t,n){void 0===n&&(n={});var i=$t(A),r=$t(t),e=Zt(r[1]-i[1]),s=Zt(r[0]-i[0]),u=Zt(i[1]),o=Zt(r[1]),h=Math.pow(Math.sin(e/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(o);return Ht(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),n.units)}function rn(A,t,n){void 0===n&&(n={});for(var i,r=("Feature"===(i=A).type?i.geometry:i).coordinates,e=0,s=0;s<r.length&&!(t>=e&&s===r.length-1);s++){if(e>=t){var u=t-e;if(u){var o=An(r[s],r[s-1])-180;return tn(r[s],u,o,n)}return qt(r[s])}e+=nn(r[s],r[s+1],n)}return qt(r[r.length-1])}function en(A,t){if("Feature"===A.type)t(A,0);else if("FeatureCollection"===A.type)for(var n=0;n<A.features.length&&!1!==t(A.features[n],n);n++);}function sn(A,t){var n,i,r,e,s,u,o,h,f,c,a=0,v="FeatureCollection"===A.type,l="Feature"===A.type,w=v?A.features.length:1;for(n=0;n<w;n++){for(h=v?A.features[n].properties:l?A.properties:{},f=v?A.features[n].bbox:l?A.bbox:void 0,c=v?A.features[n].id:l?A.id:void 0,s=(o=!!(u=v?A.features[n].geometry:l?A.geometry:A)&&"GeometryCollection"===u.type)?u.geometries.length:1,r=0;r<s;r++)if(null!==(e=o?u.geometries[r]:u))switch(e.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(e,a,h,f,c))return!1;break;case"GeometryCollection":for(i=0;i<e.geometries.length;i++)if(!1===t(e.geometries[i],a,h,f,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,a,h,f,c))return!1;a++}}function un(A){var t=[1/0,1/0,-1/0,-1/0];return function A(t,n,i){if(null!==t)for(var r,e,s,u,o,h,f,c,a=0,v=0,l=t.type,w="FeatureCollection"===l,P="Feature"===l,g=w?t.features.length:1,C=0;C<g;C++){o=(c=!!(f=w?t.features[C].geometry:P?t.geometry:t)&&"GeometryCollection"===f.type)?f.geometries.length:1;for(var D=0;D<o;D++){var I=0,M=0;if(null!==(u=c?f.geometries[D]:f)){h=u.coordinates;var b=u.type;switch(a=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===n(h,v,C,I,M))return!1;v++,I++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++){if(!1===n(h[r],v,C,I,M))return!1;v++,"MultiPoint"===b&&I++}"LineString"===b&&I++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(e=0;e<h[r].length-a;e++){if(!1===n(h[r][e],v,C,I,M))return!1;v++}"MultiLineString"===b&&I++,"Polygon"===b&&M++}"Polygon"===b&&I++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for(M=0,e=0;e<h[r].length;e++){for(s=0;s<h[r][e].length-a;s++){if(!1===n(h[r][e][s],v,C,I,M))return!1;v++}M++}I++}break;case"GeometryCollection":for(r=0;r<u.geometries.length;r++)if(!1===A(u.geometries[r],n,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(A,(function(A){t[0]>A[0]&&(t[0]=A[0]),t[1]>A[1]&&(t[1]=A[1]),t[2]<A[0]&&(t[2]=A[0]),t[3]<A[1]&&(t[3]=A[1])})),t}un.default=un,"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(A){if(null==this)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)t[i]=A,++i;return t},writable:!0}),Number.isFinite=Number.isFinite||function(A){return"number"==typeof A&&isFinite(A)},Number.isInteger=Number.isInteger||function(A){return"number"==typeof A&&isFinite(A)&&Math.floor(A)===A},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(A){return A!=A},Math.trunc=Math.trunc||function(A){return A<0?Math.ceil(A):Math.floor(A)};var on=function(){};on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on},on.prototype.equalsWithTolerance=function(A,t,n){return Math.abs(A-t)<=n};var hn=function(A){function t(t){A.call(this,t),this.name="IllegalArgumentException",this.message=t,this.stack=(new A).stack}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(Error),fn=function(){},cn={MAX_VALUE:{configurable:!0}};fn.isNaN=function(A){return Number.isNaN(A)},fn.doubleToLongBits=function(A){return A},fn.longBitsToDouble=function(A){return A},fn.isInfinite=function(A){return!Number.isFinite(A)},cn.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(fn,cn);var an=function(){},vn=function(){},ln=function(){};function wn(){}var Pn=function A(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=A.NULL_ORDINATE;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=A.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},gn={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Pn.prototype.setOrdinate=function(A,t){switch(A){case Pn.X:this.x=t;break;case Pn.Y:this.y=t;break;case Pn.Z:this.z=t;break;default:throw new hn("Invalid ordinate index: "+A)}},Pn.prototype.equals2D=function(){if(1===arguments.length){var A=arguments[0];return this.x===A.x&&this.y===A.y}if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!on.equalsWithTolerance(this.x,t.x,n)&&!!on.equalsWithTolerance(this.y,t.y,n)}},Pn.prototype.getOrdinate=function(A){switch(A){case Pn.X:return this.x;case Pn.Y:return this.y;case Pn.Z:return this.z}throw new hn("Invalid ordinate index: "+A)},Pn.prototype.equals3D=function(A){return this.x===A.x&&this.y===A.y&&(this.z===A.z||fn.isNaN(this.z))&&fn.isNaN(A.z)},Pn.prototype.equals=function(A){return A instanceof Pn&&this.equals2D(A)},Pn.prototype.equalInZ=function(A,t){return on.equalsWithTolerance(this.z,A.z,t)},Pn.prototype.compareTo=function(A){return this.x<A.x?-1:this.x>A.x?1:this.y<A.y?-1:this.y>A.y?1:0},Pn.prototype.clone=function(){},Pn.prototype.copy=function(){return new Pn(this)},Pn.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},Pn.prototype.distance3D=function(A){var t=this.x-A.x,n=this.y-A.y,i=this.z-A.z;return Math.sqrt(t*t+n*n+i*i)},Pn.prototype.distance=function(A){var t=this.x-A.x,n=this.y-A.y;return Math.sqrt(t*t+n*n)},Pn.prototype.hashCode=function(){var A=17;return 37*(A=37*A+Pn.hashCode(this.x))+Pn.hashCode(this.y)},Pn.prototype.setCoordinate=function(A){this.x=A.x,this.y=A.y,this.z=A.z},Pn.prototype.interfaces_=function(){return[an,vn,wn]},Pn.prototype.getClass=function(){return Pn},Pn.hashCode=function(){if(1===arguments.length){var A=arguments[0],t=fn.doubleToLongBits(A);return Math.trunc((t^t)>>>32)}},gn.DimensionalComparator.get=function(){return Cn},gn.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},gn.NULL_ORDINATE.get=function(){return fn.NaN},gn.X.get=function(){return 0},gn.Y.get=function(){return 1},gn.Z.get=function(){return 2},Object.defineProperties(Pn,gn);var Cn=function(A){if(this.Rt=2,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new hn("only 2 or 3 dimensions may be specified");this.Rt=t}};Cn.prototype.compare=function(A,t){var n=A,i=t,r=Cn.compare(n.x,i.x);if(0!==r)return r;var e=Cn.compare(n.y,i.y);return 0!==e?e:this.Rt<=2?0:Cn.compare(n.z,i.z)},Cn.prototype.interfaces_=function(){return[ln]},Cn.prototype.getClass=function(){return Cn},Cn.compare=function(A,t){return A<t?-1:A>t?1:fn.isNaN(A)?fn.isNaN(t)?0:-1:fn.isNaN(t)?1:0};var Dn=function(){};Dn.prototype.create=function(){},Dn.prototype.interfaces_=function(){return[]},Dn.prototype.getClass=function(){return Dn};var In=function(){},Mn={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};In.prototype.interfaces_=function(){return[]},In.prototype.getClass=function(){return In},In.toLocationSymbol=function(A){switch(A){case In.EXTERIOR:return"e";case In.BOUNDARY:return"b";case In.INTERIOR:return"i";case In.NONE:return"-"}throw new hn("Unknown location value: "+A)},Mn.INTERIOR.get=function(){return 0},Mn.BOUNDARY.get=function(){return 1},Mn.EXTERIOR.get=function(){return 2},Mn.NONE.get=function(){return-1},Object.defineProperties(In,Mn);var bn=function(A,t){return A.interfaces_&&A.interfaces_().indexOf(t)>-1},zn=function(){},xn={LOG_10:{configurable:!0}};zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn},zn.log10=function(A){var t=Math.log(A);return fn.isInfinite(t)||fn.isNaN(t)?t:t/zn.LOG_10},zn.min=function(A,t,n,i){var r=A;return t<r&&(r=t),n<r&&(r=n),i<r&&(r=i),r},zn.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1],n=arguments[2];return A<t?t:A>n?n:A}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],e=arguments[2];return i<r?r:i>e?e:i}},zn.wrap=function(A,t){return A<0?t- -A%t:A%t},zn.max=function(){if(3===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=A;return t>i&&(i=t),n>i&&(i=n),i}if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3],o=r;return e>o&&(o=e),s>o&&(o=s),u>o&&(o=u),o}},zn.average=function(A,t){return(A+t)/2},xn.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(zn,xn);var dn=function(A){this.str=A};dn.prototype.append=function(A){this.str+=A},dn.prototype.setCharAt=function(A,t){this.str=this.str.substr(0,A)+t+this.str.substr(A+1)},dn.prototype.toString=function(A){return this.str};var yn=function(A){this.value=A};yn.prototype.intValue=function(){return this.value},yn.prototype.compareTo=function(A){return this.value<A?-1:this.value>A?1:0},yn.isNaN=function(A){return Number.isNaN(A)};var mn=function(){};mn.isWhitespace=function(A){return A<=32&&A>=0||127===A},mn.toUpperCase=function(A){return A.toUpperCase()};var pn=function A(){if(this.kt=0,this.Gt=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof A){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var i=arguments[0];A.call(this,A.parse(i))}}else if(2===arguments.length){var r=arguments[0],e=arguments[1];this.init(r,e)}},Ln={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};pn.prototype.le=function(A){return(this.kt<A.kt||this.kt===A.kt)&&this.Gt<=A.Gt},pn.prototype.extractSignificantDigits=function(A,t){var n=this.abs(),i=pn.magnitude(n.kt),r=pn.TEN.pow(i);(n=n.divide(r)).gt(pn.TEN)?(n=n.divide(pn.TEN),i+=1):n.lt(pn.ONE)&&(n=n.multiply(pn.TEN),i-=1);for(var e=i+1,s=new dn,u=pn.MAX_PRINT_DIGITS-1,o=0;o<=u;o++){A&&o===e&&s.append(".");var h=Math.trunc(n.kt);if(h<0)break;var f=!1,c=0;h>9?(f=!0,c="9"):c="0"+h,s.append(c),n=n.subtract(pn.valueOf(h)).multiply(pn.TEN),f&&n.selfAdd(pn.TEN);var a=!0,v=pn.magnitude(n.kt);if(v<0&&Math.abs(v)>=u-o&&(a=!1),!a)break}return t[0]=i,s.toString()},pn.prototype.sqr=function(){return this.multiply(this)},pn.prototype.doubleValue=function(){return this.kt+this.Gt},pn.prototype.subtract=function(){if(arguments[0]instanceof pn){var A=arguments[0];return this.add(A.negate())}if("number"==typeof arguments[0]){var t=arguments[0];return this.add(-t)}},pn.prototype.equals=function(){if(1===arguments.length){var A=arguments[0];return this.kt===A.kt&&this.Gt===A.Gt}},pn.prototype.isZero=function(){return 0===this.kt&&0===this.Gt},pn.prototype.selfSubtract=function(){if(arguments[0]instanceof pn){var A=arguments[0];return this.isNaN()?this:this.selfAdd(-A.kt,-A.Gt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}},pn.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},pn.prototype.min=function(A){return this.le(A)?this:A},pn.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof pn){var A=arguments[0];return this.selfDivide(A.kt,A.Gt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfDivide(t,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,e=null,s=null,u=null,o=null,h=null,f=null,c=null;return c=(r=(h=pn.SPLIT*(o=this.kt/n))-(r=h-o))*(s=(c=pn.SPLIT*n)-(s=c-n))-(f=o*n)+r*(u=n-s)+(e=o-r)*s+e*u,c=o+(h=(this.kt-f-c+this.Gt-o*i)/n),this.kt=c,this.Gt=o-c+h,this}},pn.prototype.dump=function(){return"DD<"+this.kt+", "+this.Gt+">"},pn.prototype.divide=function(){if(arguments[0]instanceof pn){var A=arguments[0],t=null,n=null,i=null,r=null,e=null,s=null,u=null,o=null;n=(e=this.kt/A.kt)-(t=(s=pn.SPLIT*e)-(t=s-e)),o=t*(i=(o=pn.SPLIT*A.kt)-(i=o-A.kt))-(u=e*A.kt)+t*(r=A.kt-i)+n*i+n*r;var h=o=e+(s=(this.kt-u-o+this.Gt-e*A.Gt)/A.kt),f=e-o+s;return new pn(h,f)}if("number"==typeof arguments[0]){var c=arguments[0];return fn.isNaN(c)?pn.createNaN():pn.copy(this).selfDivide(c,0)}},pn.prototype.ge=function(A){return(this.kt>A.kt||this.kt===A.kt)&&this.Gt>=A.Gt},pn.prototype.pow=function(A){if(0===A)return pn.valueOf(1);var t=new pn(this),n=pn.valueOf(1),i=Math.abs(A);if(i>1)for(;i>0;)i%2==1&&n.selfMultiply(t),(i/=2)>0&&(t=t.sqr());else n=t;return A<0?n.reciprocal():n},pn.prototype.ceil=function(){if(this.isNaN())return pn.NaN;var A=Math.ceil(this.kt),t=0;return A===this.kt&&(t=Math.ceil(this.Gt)),new pn(A,t)},pn.prototype.compareTo=function(A){return this.kt<A.kt?-1:this.kt>A.kt?1:this.Gt<A.Gt?-1:this.Gt>A.Gt?1:0},pn.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},pn.prototype.setValue=function(){if(arguments[0]instanceof pn){var A=arguments[0];return this.init(A),this}if("number"==typeof arguments[0]){var t=arguments[0];return this.init(t),this}},pn.prototype.max=function(A){return this.ge(A)?this:A},pn.prototype.sqrt=function(){if(this.isZero())return pn.valueOf(0);if(this.isNegative())return pn.NaN;var A=1/Math.sqrt(this.kt),n=pn.valueOf(this.kt*A),i=this.subtract(n.sqr()).kt*(.5*A);return n.add(i)},pn.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof pn){var A=arguments[0];return this.selfAdd(A.kt,A.Gt)}if("number"==typeof arguments[0]){var t=arguments[0],n=null,i=null,r=null,e=null,s=null,u=null;return e=(r=this.kt+t)-(s=r-this.kt),i=(u=(e=t-s+(this.kt-e))+this.Gt)+(r-(n=r+u)),this.kt=n+i,this.Gt=i+(n-this.kt),this}}else if(2===arguments.length){var o=arguments[0],h=arguments[1],f=null,c=null,a=null,v=null,l=null,w=null,P=null;l=(v=this.kt+o)-(w=v-this.kt),a=(c=this.Gt+h)-(P=c-this.Gt);var g=(f=v+(w=(l=o-w+(this.kt-l))+c))+(w=(a=h-P+(this.Gt-a))+(w+(v-f))),C=w+(f-g);return this.kt=g,this.Gt=C,this}},pn.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof pn){var A=arguments[0];return this.selfMultiply(A.kt,A.Gt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfMultiply(t,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,e=null,s=null,u=null,o=null,h=null;r=(o=pn.SPLIT*this.kt)-this.kt,r=o-r;var f=(o=this.kt*n)+(h=r*(s=(h=pn.SPLIT*n)-(s=h-n))-o+r*(u=n-s)+(e=this.kt-r)*s+e*u+(this.kt*i+this.Gt*n)),c=h+(r=o-f);return this.kt=f,this.Gt=c,this}},pn.prototype.selfSqr=function(){return this.selfMultiply(this)},pn.prototype.floor=function(){if(this.isNaN())return pn.NaN;var A=Math.floor(this.kt),t=0;return A===this.kt&&(t=Math.floor(this.Gt)),new pn(A,t)},pn.prototype.negate=function(){return this.isNaN()?this:new pn(-this.kt,-this.Gt)},pn.prototype.clone=function(){},pn.prototype.multiply=function(){if(arguments[0]instanceof pn){var A=arguments[0];return A.isNaN()?pn.createNaN():pn.copy(this).selfMultiply(A)}if("number"==typeof arguments[0]){var t=arguments[0];return fn.isNaN(t)?pn.createNaN():pn.copy(this).selfMultiply(t,0)}},pn.prototype.isNaN=function(){return fn.isNaN(this.kt)},pn.prototype.intValue=function(){return Math.trunc(this.kt)},pn.prototype.toString=function(){var A=pn.magnitude(this.kt);return A>=-3&&A<=20?this.toStandardNotation():this.toSciNotation()},pn.prototype.toStandardNotation=function(){var A=this.getSpecialNumberString();if(null!==A)return A;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),i=t[0]+1,r=n;if("."===n.charAt(0))r="0"+n;else if(i<0)r="0."+pn.stringOfChar("0",-i)+n;else if(-1===n.indexOf(".")){r=n+pn.stringOfChar("0",i-n.length)+".0"}return this.isNegative()?"-"+r:r},pn.prototype.reciprocal=function(){var A,t,n,i,r=null,e=null,s=null,u=null;A=(n=1/this.kt)-(r=(s=pn.SPLIT*n)-(r=s-n)),e=(u=pn.SPLIT*this.kt)-this.kt;var o=n+(s=(1-(i=n*this.kt)-(u=r*(e=u-e)-i+r*(t=this.kt-e)+A*e+A*t)-n*this.Gt)/this.kt);return new pn(o,n-o+s)},pn.prototype.toSciNotation=function(){if(this.isZero())return pn.SCI_NOT_ZERO;var A=this.getSpecialNumberString();if(null!==A)return A;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),i=pn.SCI_NOT_EXPONENT_CHAR+t[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var e=n.charAt(0)+"."+r;return this.isNegative()?"-"+e+i:e+i},pn.prototype.abs=function(){return this.isNaN()?pn.NaN:this.isNegative()?this.negate():new pn(this)},pn.prototype.isPositive=function(){return(this.kt>0||0===this.kt)&&this.Gt>0},pn.prototype.lt=function(A){return(this.kt<A.kt||this.kt===A.kt)&&this.Gt<A.Gt},pn.prototype.add=function(){if(arguments[0]instanceof pn){var A=arguments[0];return pn.copy(this).selfAdd(A)}if("number"==typeof arguments[0]){var t=arguments[0];return pn.copy(this).selfAdd(t)}},pn.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var A=arguments[0];this.kt=A,this.Gt=0}else if(arguments[0]instanceof pn){var t=arguments[0];this.kt=t.kt,this.Gt=t.Gt}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.kt=n,this.Gt=i}},pn.prototype.gt=function(A){return(this.kt>A.kt||this.kt===A.kt)&&this.Gt>A.Gt},pn.prototype.isNegative=function(){return(this.kt<0||0===this.kt)&&this.Gt<0},pn.prototype.trunc=function(){return this.isNaN()?pn.NaN:this.isPositive()?this.floor():this.ceil()},pn.prototype.signum=function(){return this.kt>0?1:this.kt<0?-1:this.Gt>0?1:this.Gt<0?-1:0},pn.prototype.interfaces_=function(){return[wn,an,vn]},pn.prototype.getClass=function(){return pn},pn.sqr=function(A){return pn.valueOf(A).selfMultiply(A)},pn.valueOf=function(){if("string"==typeof arguments[0]){var A=arguments[0];return pn.parse(A)}if("number"==typeof arguments[0]){var t=arguments[0];return new pn(t)}},pn.sqrt=function(A){return pn.valueOf(A).sqrt()},pn.parse=function(A){for(var t=0,n=A.length;mn.isWhitespace(A.charAt(t));)t++;var i=!1;if(t<n){var r=A.charAt(t);"-"!==r&&"+"!==r||(t++,"-"===r&&(i=!0))}for(var e=new pn,s=0,u=0,o=0;!(t>=n);){var h=A.charAt(t);if(t++,mn.isDigit(h)){var f=h-"0";e.selfMultiply(pn.TEN),e.selfAdd(f),s++}else{if("."!==h){if("e"===h||"E"===h){var c=A.substring(t);try{o=yn.parseInt(c)}catch(t){throw t instanceof Error?new Error("Invalid exponent "+c+" in string "+A):t}break}throw new Error("Unexpected character '"+h+"' at position "+t+" in string "+A)}u=s}}var a=e,v=s-u-o;if(0===v)a=e;else if(v>0){var l=pn.TEN.pow(v);a=e.divide(l)}else if(v<0){var w=pn.TEN.pow(-v);a=e.multiply(w)}return i?a.negate():a},pn.createNaN=function(){return new pn(fn.NaN,fn.NaN)},pn.copy=function(A){return new pn(A)},pn.magnitude=function(A){var t=Math.abs(A),n=Math.log(t)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=t&&(i+=1),i},pn.stringOfChar=function(A,t){for(var n=new dn,i=0;i<t;i++)n.append(A);return n.toString()},Ln.PI.get=function(){return new pn(3.141592653589793,12246467991473532e-32)},Ln.TWO_PI.get=function(){return new pn(6.283185307179586,24492935982947064e-32)},Ln.PI_2.get=function(){return new pn(1.5707963267948966,6123233995736766e-32)},Ln.E.get=function(){return new pn(2.718281828459045,14456468917292502e-32)},Ln.NaN.get=function(){return new pn(fn.NaN,fn.NaN)},Ln.EPS.get=function(){return 123259516440783e-46},Ln.SPLIT.get=function(){return 134217729},Ln.MAX_PRINT_DIGITS.get=function(){return 32},Ln.TEN.get=function(){return pn.valueOf(10)},Ln.ONE.get=function(){return pn.valueOf(1)},Ln.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Ln.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(pn,Ln);var Tn=function(){},On={DP_SAFE_EPSILON:{configurable:!0}};Tn.prototype.interfaces_=function(){return[]},Tn.prototype.getClass=function(){return Tn},Tn.orientationIndex=function(A,t,n){var i=Tn.orientationIndexFilter(A,t,n);if(i<=1)return i;var r=pn.valueOf(t.x).selfAdd(-A.x),e=pn.valueOf(t.y).selfAdd(-A.y),s=pn.valueOf(n.x).selfAdd(-t.x),u=pn.valueOf(n.y).selfAdd(-t.y);return r.selfMultiply(u).selfSubtract(e.selfMultiply(s)).signum()},Tn.signOfDet2x2=function(A,t,n,i){return A.multiply(i).selfSubtract(t.multiply(n)).signum()},Tn.intersection=function(A,t,n,i){var r=pn.valueOf(i.y).selfSubtract(n.y).selfMultiply(pn.valueOf(t.x).selfSubtract(A.x)),e=pn.valueOf(i.x).selfSubtract(n.x).selfMultiply(pn.valueOf(t.y).selfSubtract(A.y)),s=r.subtract(e),u=pn.valueOf(i.x).selfSubtract(n.x).selfMultiply(pn.valueOf(A.y).selfSubtract(n.y)),o=pn.valueOf(i.y).selfSubtract(n.y).selfMultiply(pn.valueOf(A.x).selfSubtract(n.x)),h=u.subtract(o).selfDivide(s).doubleValue(),f=pn.valueOf(A.x).selfAdd(pn.valueOf(t.x).selfSubtract(A.x).selfMultiply(h)).doubleValue(),c=pn.valueOf(t.x).selfSubtract(A.x).selfMultiply(pn.valueOf(A.y).selfSubtract(n.y)),a=pn.valueOf(t.y).selfSubtract(A.y).selfMultiply(pn.valueOf(A.x).selfSubtract(n.x)),v=c.subtract(a).selfDivide(s).doubleValue(),l=pn.valueOf(n.y).selfAdd(pn.valueOf(i.y).selfSubtract(n.y).selfMultiply(v)).doubleValue();return new Pn(f,l)},Tn.orientationIndexFilter=function(A,t,n){var i=null,r=(A.x-n.x)*(t.y-n.y),e=(A.y-n.y)*(t.x-n.x),s=r-e;if(r>0){if(e<=0)return Tn.signum(s);i=r+e}else{if(!(r<0))return Tn.signum(s);if(e>=0)return Tn.signum(s);i=-r-e}var u=Tn.DP_SAFE_EPSILON*i;return s>=u||-s>=u?Tn.signum(s):2},Tn.signum=function(A){return A>0?1:A<0?-1:0},On.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Tn,On);var Fn=function(){},En={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};En.X.get=function(){return 0},En.Y.get=function(){return 1},En.Z.get=function(){return 2},En.M.get=function(){return 3},Fn.prototype.setOrdinate=function(A,t,n){},Fn.prototype.size=function(){},Fn.prototype.getOrdinate=function(A,t){},Fn.prototype.getCoordinate=function(){},Fn.prototype.getCoordinateCopy=function(A){},Fn.prototype.getDimension=function(){},Fn.prototype.getX=function(A){},Fn.prototype.clone=function(){},Fn.prototype.expandEnvelope=function(A){},Fn.prototype.copy=function(){},Fn.prototype.getY=function(A){},Fn.prototype.toCoordinateArray=function(){},Fn.prototype.interfaces_=function(){return[vn]},Fn.prototype.getClass=function(){return Fn},Object.defineProperties(Fn,En);var Un=function(){},jn=function(A){function t(){A.call(this,"Projective point not representable on the Cartesian plane.")}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Un),Nn=function(){};Nn.arraycopy=function(A,t,n,i,r){for(var e=0,s=t;s<t+r;s++)n[i+e]=A[s],e++},Nn.getProperty=function(A){return{"line.separator":"\n"}[A]};var Qn=function A(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof A&&arguments[1]instanceof A){var r=arguments[0],e=arguments[1];this.x=r.y*e.w-e.y*r.w,this.y=e.x*r.w-r.x*e.w,this.w=r.x*e.y-e.x*r.y}else if(arguments[0]instanceof Pn&&arguments[1]instanceof Pn){var s=arguments[0],u=arguments[1];this.x=s.y-u.y,this.y=u.x-s.x,this.w=s.x*u.y-u.x*s.y}}else if(3===arguments.length){var o=arguments[0],h=arguments[1],f=arguments[2];this.x=o,this.y=h,this.w=f}else if(4===arguments.length){var c=arguments[0],a=arguments[1],v=arguments[2],l=arguments[3],w=c.y-a.y,P=a.x-c.x,g=c.x*a.y-a.x*c.y,C=v.y-l.y,D=l.x-v.x,I=v.x*l.y-l.x*v.y;this.x=P*I-D*g,this.y=C*g-w*I,this.w=w*D-C*P}};Qn.prototype.getY=function(){var A=this.y/this.w;if(fn.isNaN(A)||fn.isInfinite(A))throw new jn;return A},Qn.prototype.getX=function(){var A=this.x/this.w;if(fn.isNaN(A)||fn.isInfinite(A))throw new jn;return A},Qn.prototype.getCoordinate=function(){var A=new Pn;return A.x=this.getX(),A.y=this.getY(),A},Qn.prototype.interfaces_=function(){return[]},Qn.prototype.getClass=function(){return Qn},Qn.intersection=function(A,t,n,i){var r=A.y-t.y,e=t.x-A.x,s=A.x*t.y-t.x*A.y,u=n.y-i.y,o=i.x-n.x,h=n.x*i.y-i.x*n.y,f=r*o-u*e,c=(e*h-o*s)/f,a=(u*s-r*h)/f;if(fn.isNaN(c)||fn.isInfinite(c)||fn.isNaN(a)||fn.isInfinite(a))throw new jn;return new Pn(c,a)};var Sn=function A(){if(this.Yt=null,this.Wt=null,this.qt=null,this.Vt=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof Pn){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof A){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=arguments[3];this.init(e,s,u,o)}},Bn={serialVersionUID:{configurable:!0}};Sn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Sn.prototype.equals=function(A){if(!(A instanceof Sn))return!1;var t=A;return this.isNull()?t.isNull():this.Wt===t.getMaxX()&&this.Vt===t.getMaxY()&&this.Yt===t.getMinX()&&this.qt===t.getMinY()},Sn.prototype.intersection=function(A){return this.isNull()||A.isNull()||!this.intersects(A)?new Sn:new Sn(this.Yt>A.Yt?this.Yt:A.Yt,this.Wt<A.Wt?this.Wt:A.Wt,this.qt>A.qt?this.qt:A.qt,this.Vt<A.Vt?this.Vt:A.Vt)},Sn.prototype.isNull=function(){return this.Wt<this.Yt},Sn.prototype.getMaxX=function(){return this.Wt},Sn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof Pn){var A=arguments[0];return this.covers(A.x,A.y)}if(arguments[0]instanceof Sn){var t=arguments[0];return!this.isNull()&&!t.isNull()&&t.getMinX()>=this.Yt&&t.getMaxX()<=this.Wt&&t.getMinY()>=this.qt&&t.getMaxY()<=this.Vt}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&n>=this.Yt&&n<=this.Wt&&i>=this.qt&&i<=this.Vt}},Sn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Sn){var A=arguments[0];return!this.isNull()&&!A.isNull()&&!(A.Yt>this.Wt||A.Wt<this.Yt||A.qt>this.Vt||A.Vt<this.qt)}if(arguments[0]instanceof Pn){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&!(n>this.Wt||n<this.Yt||i>this.Vt||i<this.qt)}},Sn.prototype.getMinY=function(){return this.qt},Sn.prototype.getMinX=function(){return this.Yt},Sn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof Pn){var A=arguments[0];this.expandToInclude(A.x,A.y)}else if(arguments[0]instanceof Sn){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this.Yt=t.getMinX(),this.Wt=t.getMaxX(),this.qt=t.getMinY(),this.Vt=t.getMaxY()):(t.Yt<this.Yt&&(this.Yt=t.Yt),t.Wt>this.Wt&&(this.Wt=t.Wt),t.qt<this.qt&&(this.qt=t.qt),t.Vt>this.Vt&&(this.Vt=t.Vt))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.isNull()?(this.Yt=n,this.Wt=n,this.qt=i,this.Vt=i):(n<this.Yt&&(this.Yt=n),n>this.Wt&&(this.Wt=n),i<this.qt&&(this.qt=i),i>this.Vt&&(this.Vt=i))}},Sn.prototype.minExtent=function(){if(this.isNull())return 0;var A=this.getWidth(),t=this.getHeight();return A<t?A:t},Sn.prototype.getWidth=function(){return this.isNull()?0:this.Wt-this.Yt},Sn.prototype.compareTo=function(A){var t=A;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this.Yt<t.Yt?-1:this.Yt>t.Yt?1:this.qt<t.qt?-1:this.qt>t.qt?1:this.Wt<t.Wt?-1:this.Wt>t.Wt?1:this.Vt<t.Vt?-1:this.Vt>t.Vt?1:0},Sn.prototype.translate=function(A,t){if(this.isNull())return null;this.init(this.getMinX()+A,this.getMaxX()+A,this.getMinY()+t,this.getMaxY()+t)},Sn.prototype.toString=function(){return"Env["+this.Yt+" : "+this.Wt+", "+this.qt+" : "+this.Vt+"]"},Sn.prototype.setToNull=function(){this.Yt=0,this.Wt=-1,this.qt=0,this.Vt=-1},Sn.prototype.getHeight=function(){return this.isNull()?0:this.Vt-this.qt},Sn.prototype.maxExtent=function(){if(this.isNull())return 0;var A=this.getWidth(),t=this.getHeight();return A>t?A:t},Sn.prototype.expandBy=function(){if(1===arguments.length){var A=arguments[0];this.expandBy(A,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this.Yt-=t,this.Wt+=t,this.qt-=n,this.Vt+=n,(this.Yt>this.Wt||this.qt>this.Vt)&&this.setToNull()}},Sn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Sn){var A=arguments[0];return this.covers(A)}if(arguments[0]instanceof Pn){var t=arguments[0];return this.covers(t)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.covers(n,i)}},Sn.prototype.centre=function(){return this.isNull()?null:new Pn((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Sn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof Pn){var A=arguments[0];this.init(A.x,A.x,A.y,A.y)}else if(arguments[0]instanceof Sn){var t=arguments[0];this.Yt=t.Yt,this.Wt=t.Wt,this.qt=t.qt,this.Vt=t.Vt}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3];r<e?(this.Yt=r,this.Wt=e):(this.Yt=e,this.Wt=r),s<u?(this.qt=s,this.Vt=u):(this.qt=u,this.Vt=s)}},Sn.prototype.getMaxY=function(){return this.Vt},Sn.prototype.distance=function(A){if(this.intersects(A))return 0;var t=0;this.Wt<A.Yt?t=A.Yt-this.Wt:this.Yt>A.Wt&&(t=this.Yt-A.Wt);var n=0;return this.Vt<A.qt?n=A.qt-this.Vt:this.qt>A.Vt&&(n=this.qt-A.Vt),0===t?n:0===n?t:Math.sqrt(t*t+n*n)},Sn.prototype.hashCode=function(){var A=17;return 37*(A=37*(A=37*(A=37*A+Pn.hashCode(this.Yt))+Pn.hashCode(this.Wt))+Pn.hashCode(this.qt))+Pn.hashCode(this.Vt)},Sn.prototype.interfaces_=function(){return[an,wn]},Sn.prototype.getClass=function(){return Sn},Sn.intersects=function(){if(3===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(A.x<t.x?A.x:t.x)&&n.x<=(A.x>t.x?A.x:t.x)&&n.y>=(A.y<t.y?A.y:t.y)&&n.y<=(A.y>t.y?A.y:t.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=arguments[3],u=Math.min(e.x,s.x),o=Math.max(e.x,s.x),h=Math.min(i.x,r.x),f=Math.max(i.x,r.x);return!(h>o||f<u||(u=Math.min(e.y,s.y),o=Math.max(e.y,s.y),h=Math.min(i.y,r.y),f=Math.max(i.y,r.y),h>o||f<u))}},Bn.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Sn,Bn);var Rn={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},kn=function(A){this.geometryFactory=A||new yr};kn.prototype.read=function(A){var t,n;A=A.replace(/[\n\r]/g," ");var r=Rn.typeStr.exec(A);if(-1!==A.search("EMPTY")&&((r=Rn.emptyTypeStr.exec(A))[2]=void 0),r&&(n=r[1].toLowerCase(),Yn[n]&&(t=Yn[n].apply(this,[r[2]]))),void 0===t)throw new Error("Could not parse WKT "+A);return t},kn.prototype.write=function(A){return this.extractGeometry(A)},kn.prototype.extractGeometry=function(A){var t=A.getGeometryType().toLowerCase();if(!Gn[t])return null;var n=t.toUpperCase();return A.isEmpty()?n+" EMPTY":n+"("+Gn[t].apply(this,[A])+")"};var Gn={coordinate:function(A){return A.x+" "+A.y},point:function(A){return Gn.coordinate.call(this,A.Kt.Kt[0])},multipoint:function(A){for(var t=[],n=0,i=A.Ht.length;n<i;++n)t.push("("+Gn.point.apply(this,[A.Ht[n]])+")");return t.join(",")},linestring:function(A){for(var t=[],n=0,i=A._t.Kt.length;n<i;++n)t.push(Gn.coordinate.apply(this,[A._t.Kt[n]]));return t.join(",")},linearring:function(A){for(var t=[],n=0,i=A._t.Kt.length;n<i;++n)t.push(Gn.coordinate.apply(this,[A._t.Kt[n]]));return t.join(",")},multilinestring:function(A){for(var t=[],n=0,i=A.Ht.length;n<i;++n)t.push("("+Gn.linestring.apply(this,[A.Ht[n]])+")");return t.join(",")},polygon:function(A){var t=[];t.push("("+Gn.linestring.apply(this,[A.Jt])+")");for(var n=0,i=A.Zt.length;n<i;++n)t.push("("+Gn.linestring.apply(this,[A.Zt[n]])+")");return t.join(",")},multipolygon:function(A){for(var t=[],n=0,i=A.Ht.length;n<i;++n)t.push("("+Gn.polygon.apply(this,[A.Ht[n]])+")");return t.join(",")},geometrycollection:function(A){for(var t=[],n=0,i=A.Ht.length;n<i;++n)t.push(this.extractGeometry(A.Ht[n]));return t.join(",")}},Yn={point:function(A){if(void 0===A)return this.geometryFactory.createPoint();var t=A.trim().split(Rn.spaces);return this.geometryFactory.createPoint(new Pn(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiPoint();for(var n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(Rn.trimParens,"$1"),i.push(Yn.point.apply(this,[t]));return this.geometryFactory.createMultiPoint(i)},linestring:function(A){if(void 0===A)return this.geometryFactory.createLineString();for(var t,n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].trim().split(Rn.spaces),i.push(new Pn(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLineString(i)},linearring:function(A){if(void 0===A)return this.geometryFactory.createLinearRing();for(var t,n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].trim().split(Rn.spaces),i.push(new Pn(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLinearRing(i)},multilinestring:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiLineString();for(var n=A.trim().split(Rn.parenComma),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(Rn.trimParens,"$1"),i.push(Yn.linestring.apply(this,[t]));return this.geometryFactory.createMultiLineString(i)},polygon:function(A){var t,n,i;if(void 0===A)return this.geometryFactory.createPolygon();for(var r,e=A.trim().split(Rn.parenComma),s=[],u=0,o=e.length;u<o;++u)t=e[u].replace(Rn.trimParens,"$1"),n=Yn.linestring.apply(this,[t]),i=this.geometryFactory.createLinearRing(n._t),0===u?r=i:s.push(i);return this.geometryFactory.createPolygon(r,s)},multipolygon:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiPolygon();for(var n=A.trim().split(Rn.doubleParenComma),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(Rn.trimParens,"$1"),i.push(Yn.polygon.apply(this,[t]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(A){if(void 0===A)return this.geometryFactory.createGeometryCollection();for(var t=(A=A.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],i=0,r=t.length;i<r;++i)n.push(this.read(t[i]));return this.geometryFactory.createGeometryCollection(n)}},Wn=function(A){this.parser=new kn(A)};Wn.prototype.write=function(A){return this.parser.write(A)},Wn.toLineString=function(A,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+A.x+" "+A.y+", "+t.x+" "+t.y+" )"};var qn=function(A){function t(t){A.call(this,t),this.name="RuntimeException",this.message=t,this.stack=(new A).stack}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(Error),Vn=function(A){function t(){if(A.call(this),0===arguments.length)A.call(this);else if(1===arguments.length){var t=arguments[0];A.call(this,t)}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qn),Kn=function(){};Kn.prototype.interfaces_=function(){return[]},Kn.prototype.getClass=function(){return Kn},Kn.shouldNeverReachHere=function(){if(0===arguments.length)Kn.shouldNeverReachHere(null);else if(1===arguments.length){var A=arguments[0];throw new Vn("Should never reach here"+(null!==A?": "+A:""))}},Kn.isTrue=function(){var A;if(1===arguments.length)Kn.isTrue(arguments[0],null);else if(2===arguments.length&&(A=arguments[1],!arguments[0]))throw null===A?new Vn:new Vn(A)},Kn.equals=function(){var A,t,n;if(2===arguments.length)Kn.equals(A=arguments[0],t=arguments[1],null);else if(3===arguments.length&&(n=arguments[2],!(t=arguments[1]).equals(A=arguments[0])))throw new Vn("Expected "+A+" but encountered "+t+(null!==n?": "+n:""))};var Hn=function(){this.Xt=null,this.$t=Array(2).fill().map((function(){return Array(2)})),this.An=new Array(2).fill(null),this.tn=null,this.nn=null,this.in=null,this.rn=null,this.en=null,this.An[0]=new Pn,this.An[1]=new Pn,this.in=this.An[0],this.rn=this.An[1],this.Xt=0},_n={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Hn.prototype.getIndexAlongSegment=function(A,t){return this.computeIntLineIndex(),this.tn[A][t]},Hn.prototype.getTopologySummary=function(){var A=new dn;return this.isEndPoint()&&A.append(" endpoint"),this.nn&&A.append(" proper"),this.isCollinear()&&A.append(" collinear"),A.toString()},Hn.prototype.computeIntersection=function(A,t,n,i){this.$t[0][0]=A,this.$t[0][1]=t,this.$t[1][0]=n,this.$t[1][1]=i,this.Xt=this.computeIntersect(A,t,n,i)},Hn.prototype.getIntersectionNum=function(){return this.Xt},Hn.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this.tn&&(this.tn=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var A=arguments[0],t=this.getEdgeDistance(A,0),n=this.getEdgeDistance(A,1);t>n?(this.tn[A][0]=0,this.tn[A][1]=1):(this.tn[A][0]=1,this.tn[A][1]=0)}},Hn.prototype.isProper=function(){return this.hasIntersection()&&this.nn},Hn.prototype.setPrecisionModel=function(A){this.en=A},Hn.prototype.isInteriorIntersection=function(){var A=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],n=0;n<this.Xt;n++)if(!A.An[n].equals2D(A.$t[t][0])&&!A.An[n].equals2D(A.$t[t][1]))return!0;return!1}},Hn.prototype.getIntersection=function(A){return this.An[A]},Hn.prototype.isEndPoint=function(){return this.hasIntersection()&&!this.nn},Hn.prototype.hasIntersection=function(){return this.Xt!==Hn.NO_INTERSECTION},Hn.prototype.getEdgeDistance=function(A,t){return Hn.computeEdgeDistance(this.An[t],this.$t[A][0],this.$t[A][1])},Hn.prototype.isCollinear=function(){return this.Xt===Hn.COLLINEAR_INTERSECTION},Hn.prototype.toString=function(){return Wn.toLineString(this.$t[0][0],this.$t[0][1])+" - "+Wn.toLineString(this.$t[1][0],this.$t[1][1])+this.getTopologySummary()},Hn.prototype.getEndpoint=function(A,t){return this.$t[A][t]},Hn.prototype.isIntersection=function(A){for(var t=0;t<this.Xt;t++)if(this.An[t].equals2D(A))return!0;return!1},Hn.prototype.getIntersectionAlongSegment=function(A,t){return this.computeIntLineIndex(),this.An[this.tn[A][t]]},Hn.prototype.interfaces_=function(){return[]},Hn.prototype.getClass=function(){return Hn},Hn.computeEdgeDistance=function(A,t,n){var i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),e=-1;if(A.equals(t))e=0;else if(A.equals(n))e=i>r?i:r;else{var s=Math.abs(A.x-t.x),u=Math.abs(A.y-t.y);0!==(e=i>r?s:u)||A.equals(t)||(e=Math.max(s,u))}return Kn.isTrue(!(0===e&&!A.equals(t)),"Bad distance calculation"),e},Hn.nonRobustComputeEdgeDistance=function(A,t,n){var i=A.x-t.x,r=A.y-t.y,e=Math.sqrt(i*i+r*r);return Kn.isTrue(!(0===e&&!A.equals(t)),"Invalid distance calculation"),e},_n.DONT_INTERSECT.get=function(){return 0},_n.DO_INTERSECT.get=function(){return 1},_n.COLLINEAR.get=function(){return 2},_n.NO_INTERSECTION.get=function(){return 0},_n.POINT_INTERSECTION.get=function(){return 1},_n.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Hn,_n);var Jn=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isInSegmentEnvelopes=function(A){var t=new Sn(this.$t[0][0],this.$t[0][1]),n=new Sn(this.$t[1][0],this.$t[1][1]);return t.contains(A)&&n.contains(A)},t.prototype.computeIntersection=function(){if(3!==arguments.length)return A.prototype.computeIntersection.apply(this,arguments);var t=arguments[0],n=arguments[1],i=arguments[2];if(this.nn=!1,Sn.intersects(n,i,t)&&0===$n.orientationIndex(n,i,t)&&0===$n.orientationIndex(i,n,t))return this.nn=!0,(t.equals(n)||t.equals(i))&&(this.nn=!1),this.Xt=A.POINT_INTERSECTION,null;this.Xt=A.NO_INTERSECTION},t.prototype.normalizeToMinimum=function(A,t,n,i,r){r.x=this.smallestInAbsValue(A.x,t.x,n.x,i.x),r.y=this.smallestInAbsValue(A.y,t.y,n.y,i.y),A.x-=r.x,A.y-=r.y,t.x-=r.x,t.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},t.prototype.safeHCoordinateIntersection=function(A,n,i,r){var e=null;try{e=Qn.intersection(A,n,i,r)}catch(s){if(!(s instanceof jn))throw s;e=t.nearestEndpoint(A,n,i,r)}return e},t.prototype.intersection=function(A,n,i,r){var e=this.intersectionWithNormalization(A,n,i,r);return this.isInSegmentEnvelopes(e)||(e=new Pn(t.nearestEndpoint(A,n,i,r))),null!==this.en&&this.en.makePrecise(e),e},t.prototype.smallestInAbsValue=function(A,t,n,i){var r=A,e=Math.abs(r);return Math.abs(t)<e&&(r=t,e=Math.abs(t)),Math.abs(n)<e&&(r=n,e=Math.abs(n)),Math.abs(i)<e&&(r=i),r},t.prototype.checkDD=function(A,t,n,i,r){var e=Tn.intersection(A,t,n,i),s=this.isInSegmentEnvelopes(e);Nn.out.println("DD in env = "+s+"  --------------------- "+e),r.distance(e)>1e-4&&Nn.out.println("Distance = "+r.distance(e))},t.prototype.intersectionWithNormalization=function(A,t,n,i){var r=new Pn(A),e=new Pn(t),s=new Pn(n),u=new Pn(i),o=new Pn;this.normalizeToEnvCentre(r,e,s,u,o);var h=this.safeHCoordinateIntersection(r,e,s,u);return h.x+=o.x,h.y+=o.y,h},t.prototype.computeCollinearIntersection=function(t,n,i,r){var e=Sn.intersects(t,n,i),s=Sn.intersects(t,n,r),u=Sn.intersects(i,r,t),o=Sn.intersects(i,r,n);return e&&s?(this.An[0]=i,this.An[1]=r,A.COLLINEAR_INTERSECTION):u&&o?(this.An[0]=t,this.An[1]=n,A.COLLINEAR_INTERSECTION):e&&u?(this.An[0]=i,this.An[1]=t,!i.equals(t)||s||o?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):e&&o?(this.An[0]=i,this.An[1]=n,!i.equals(n)||s||u?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):s&&u?(this.An[0]=r,this.An[1]=t,!r.equals(t)||e||o?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):s&&o?(this.An[0]=r,this.An[1]=n,!r.equals(n)||e||u?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):A.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(A,t,n,i,r){var e=A.x<t.x?A.x:t.x,s=A.y<t.y?A.y:t.y,u=A.x>t.x?A.x:t.x,o=A.y>t.y?A.y:t.y,h=n.x<i.x?n.x:i.x,f=n.y<i.y?n.y:i.y,c=n.x>i.x?n.x:i.x,a=n.y>i.y?n.y:i.y,l=((s>f?s:f)+(o<a?o:a))/2;r.x=((e>h?e:h)+(u<c?u:c))/2,r.y=l,A.x-=r.x,A.y-=r.y,t.x-=r.x,t.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},t.prototype.computeIntersect=function(t,n,i,r){if(this.nn=!1,!Sn.intersects(t,n,i,r))return A.NO_INTERSECTION;var e=$n.orientationIndex(t,n,i),s=$n.orientationIndex(t,n,r);if(e>0&&s>0||e<0&&s<0)return A.NO_INTERSECTION;var u=$n.orientationIndex(i,r,t),o=$n.orientationIndex(i,r,n);return u>0&&o>0||u<0&&o<0?A.NO_INTERSECTION:0===e&&0===s&&0===u&&0===o?this.computeCollinearIntersection(t,n,i,r):(0===e||0===s||0===u||0===o?(this.nn=!1,t.equals2D(i)||t.equals2D(r)?this.An[0]=t:n.equals2D(i)||n.equals2D(r)?this.An[0]=n:0===e?this.An[0]=new Pn(i):0===s?this.An[0]=new Pn(r):0===u?this.An[0]=new Pn(t):0===o&&(this.An[0]=new Pn(n))):(this.nn=!0,this.An[0]=this.intersection(t,n,i,r)),A.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(A,t,n,i){var r=A,e=$n.distancePointLine(A,n,i),s=$n.distancePointLine(t,n,i);return s<e&&(e=s,r=t),(s=$n.distancePointLine(n,A,t))<e&&(e=s,r=n),(s=$n.distancePointLine(i,A,t))<e&&(e=s,r=i),r},t}(Hn),Zn=function(){};Zn.prototype.interfaces_=function(){return[]},Zn.prototype.getClass=function(){return Zn},Zn.orientationIndex=function(A,t,n){return Zn.signOfDet2x2(t.x-A.x,t.y-A.y,n.x-t.x,n.y-t.y)},Zn.signOfDet2x2=function(A,t,n,i){var r=null,e=null,s=null;if(r=1,0===A||0===i)return 0===t||0===n?0:t>0?n>0?-r:r:n>0?r:-r;if(0===t||0===n)return i>0?A>0?r:-r:A>0?-r:r;if(t>0?i>0?t<=i||(r=-r,e=A,A=n,n=e,e=t,t=i,i=e):t<=-i?(r=-r,n=-n,i=-i):(e=A,A=-n,n=e,e=t,t=-i,i=e):i>0?-t<=i?(r=-r,A=-A,t=-t):(e=-A,A=n,n=e,e=-t,t=i,i=e):t>=i?(A=-A,t=-t,n=-n,i=-i):(r=-r,e=-A,A=-n,n=e,e=-t,t=-i,i=e),A>0){if(!(n>0))return r;if(!(A<=n))return r}else{if(n>0)return-r;if(!(A>=n))return-r;r=-r,A=-A,n=-n}for(;;){if((i-=(s=Math.floor(n/A))*t)<0)return-r;if(i>t)return r;if(A>(n-=s*A)+n){if(t<i+i)return r}else{if(t>i+i)return-r;n=A-n,i=t-i,r=-r}if(0===i)return 0===n?0:-r;if(0===n)return r;if((t-=(s=Math.floor(A/n))*i)<0)return r;if(t>i)return-r;if(n>(A-=s*n)+A){if(i<t+t)return-r}else{if(i>t+t)return r;A=n-A,t=i-t,r=-r}if(0===t)return 0===A?0:r;if(0===A)return-r}};var Xn=function(){this.sn=null,this.un=0,this.hn=!1;var A=arguments[0];this.sn=A};Xn.prototype.countSegment=function(A,t){if(A.x<this.sn.x&&t.x<this.sn.x)return null;if(this.sn.x===t.x&&this.sn.y===t.y)return this.hn=!0,null;if(A.y===this.sn.y&&t.y===this.sn.y){var n=A.x,i=t.x;return n>i&&(n=t.x,i=A.x),this.sn.x>=n&&this.sn.x<=i&&(this.hn=!0),null}if(A.y>this.sn.y&&t.y<=this.sn.y||t.y>this.sn.y&&A.y<=this.sn.y){var e=A.y-this.sn.y,u=t.y-this.sn.y,o=Zn.signOfDet2x2(A.x-this.sn.x,e,t.x-this.sn.x,u);if(0===o)return this.hn=!0,null;u<e&&(o=-o),o>0&&this.un++}},Xn.prototype.isPointInPolygon=function(){return this.getLocation()!==In.EXTERIOR},Xn.prototype.getLocation=function(){return this.hn?In.BOUNDARY:this.un%2==1?In.INTERIOR:In.EXTERIOR},Xn.prototype.isOnSegment=function(){return this.hn},Xn.prototype.interfaces_=function(){return[]},Xn.prototype.getClass=function(){return Xn},Xn.locatePointInRing=function(){if(arguments[0]instanceof Pn&&bn(arguments[1],Fn)){for(var A=arguments[0],t=arguments[1],n=new Xn(A),i=new Pn,r=new Pn,e=1;e<t.size();e++)if(t.getCoordinate(e,i),t.getCoordinate(e-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof Pn&&arguments[1]instanceof Array){for(var s=arguments[0],u=arguments[1],o=new Xn(s),h=1;h<u.length;h++){var f=u[h],c=u[h-1];if(o.countSegment(f,c),o.isOnSegment())return o.getLocation()}return o.getLocation()}};var $n=function(){},Ai={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};$n.prototype.interfaces_=function(){return[]},$n.prototype.getClass=function(){return $n},$n.orientationIndex=function(A,t,n){return Tn.orientationIndex(A,t,n)},$n.signedArea=function(){if(arguments[0]instanceof Array){var A=arguments[0];if(A.length<3)return 0;for(var t=0,n=A[0].x,i=1;i<A.length-1;i++){var r=A[i].x-n,e=A[i+1].y,s=A[i-1].y;t+=r*(s-e)}return t/2}if(bn(arguments[0],Fn)){var u=arguments[0],o=u.size();if(o<3)return 0;var h=new Pn,f=new Pn,c=new Pn;u.getCoordinate(0,f),u.getCoordinate(1,c);var a=f.x;c.x-=a;for(var v=0,l=1;l<o-1;l++)h.y=f.y,f.x=c.x,f.y=c.y,u.getCoordinate(l+1,c),c.x-=a,v+=f.x*(h.y-c.y);return v/2}},$n.distanceLineLine=function(A,t,n,i){if(A.equals(t))return $n.distancePointLine(A,n,i);if(n.equals(i))return $n.distancePointLine(i,A,t);var r=!1;if(Sn.intersects(A,t,n,i)){var e=(t.x-A.x)*(i.y-n.y)-(t.y-A.y)*(i.x-n.x);if(0===e)r=!0;else{var u=((A.y-n.y)*(t.x-A.x)-(A.x-n.x)*(t.y-A.y))/e,o=((A.y-n.y)*(i.x-n.x)-(A.x-n.x)*(i.y-n.y))/e;(o<0||o>1||u<0||u>1)&&(r=!0)}}else r=!0;return r?zn.min($n.distancePointLine(A,n,i),$n.distancePointLine(t,n,i),$n.distancePointLine(n,A,t),$n.distancePointLine(i,A,t)):0},$n.isPointInRing=function(A,t){return $n.locatePointInRing(A,t)!==In.EXTERIOR},$n.computeLength=function(A){var t=A.size();if(t<=1)return 0;var n=0,i=new Pn;A.getCoordinate(0,i);for(var r=i.x,e=i.y,s=1;s<t;s++){A.getCoordinate(s,i);var u=i.x,o=i.y,h=u-r,f=o-e;n+=Math.sqrt(h*h+f*f),r=u,e=o}return n},$n.isCCW=function(A){var t=A.length-1;if(t<3)throw new hn("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=A[0],i=0,r=1;r<=t;r++){var e=A[r];e.y>n.y&&(n=e,i=r)}var s=i;do{(s-=1)<0&&(s=t)}while(A[s].equals2D(n)&&s!==i);var u=i;do{u=(u+1)%t}while(A[u].equals2D(n)&&u!==i);var o=A[s],h=A[u];if(o.equals2D(n)||h.equals2D(n)||o.equals2D(h))return!1;var f=$n.computeOrientation(o,n,h);return 0===f?o.x>h.x:f>0},$n.locatePointInRing=function(A,t){return Xn.locatePointInRing(A,t)},$n.distancePointLinePerpendicular=function(A,t,n){var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y);return Math.abs(((t.y-A.y)*(n.x-t.x)-(t.x-A.x)*(n.y-t.y))/i)*Math.sqrt(i)},$n.computeOrientation=function(A,t,n){return $n.orientationIndex(A,t,n)},$n.distancePointLine=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];if(0===t.length)throw new hn("Line array must contain at least one vertex");for(var n=A.distance(t[0]),i=0;i<t.length-1;i++){var r=$n.distancePointLine(A,t[i],t[i+1]);r<n&&(n=r)}return n}if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];if(s.x===u.x&&s.y===u.y)return e.distance(s);var o=(u.x-s.x)*(u.x-s.x)+(u.y-s.y)*(u.y-s.y),h=((e.x-s.x)*(u.x-s.x)+(e.y-s.y)*(u.y-s.y))/o;if(h<=0)return e.distance(s);if(h>=1)return e.distance(u);var f=((s.y-e.y)*(u.x-s.x)-(s.x-e.x)*(u.y-s.y))/o;return Math.abs(f)*Math.sqrt(o)}},$n.isOnLine=function(A,t){for(var n=new Jn,i=1;i<t.length;i++){if(n.computeIntersection(A,t[i-1],t[i]),n.hasIntersection())return!0}return!1},Ai.CLOCKWISE.get=function(){return-1},Ai.RIGHT.get=function(){return $n.CLOCKWISE},Ai.COUNTERCLOCKWISE.get=function(){return 1},Ai.LEFT.get=function(){return $n.COUNTERCLOCKWISE},Ai.COLLINEAR.get=function(){return 0},Ai.STRAIGHT.get=function(){return $n.COLLINEAR},Object.defineProperties($n,Ai);var ti=function(){};ti.prototype.filter=function(A){},ti.prototype.interfaces_=function(){return[]},ti.prototype.getClass=function(){return ti};var ni=function(){var A=arguments[0];this.cn=null,this.an=null,this.vn=null,this.ln=null,this.an=A,this.vn=A.getSRID()},ii={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ni.prototype.isGeometryCollection=function(){return this.getSortIndex()===ni.SORTINDEX_GEOMETRYCOLLECTION},ni.prototype.getFactory=function(){return this.an},ni.prototype.getGeometryN=function(A){return this},ni.prototype.getArea=function(){return 0},ni.prototype.isRectangle=function(){return!1},ni.prototype.equals=function(){if(arguments[0]instanceof ni){var A=arguments[0];return null!==A&&this.equalsTopo(A)}if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof ni))return!1;var n=t;return this.equalsExact(n)}},ni.prototype.equalsExact=function(A){return this===A||this.equalsExact(A,0)},ni.prototype.geometryChanged=function(){this.apply(ni.geometryChangedFilter)},ni.prototype.geometryChangedAction=function(){this.cn=null},ni.prototype.equalsNorm=function(A){return null!==A&&this.norm().equalsExact(A.norm())},ni.prototype.getLength=function(){return 0},ni.prototype.getNumGeometries=function(){return 1},ni.prototype.compareTo=function(){if(1===arguments.length){var A=arguments[0],t=A;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(A)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}},ni.prototype.getUserData=function(){return this.ln},ni.prototype.getSRID=function(){return this.vn},ni.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ni.prototype.checkNotGeometryCollection=function(A){if(A.getSortIndex()===ni.SORTINDEX_GEOMETRYCOLLECTION)throw new hn("This method does not support GeometryCollection arguments")},ni.prototype.equal=function(A,t,n){return 0===n?A.equals(t):A.distance(t)<=n},ni.prototype.norm=function(){var A=this.copy();return A.normalize(),A},ni.prototype.getPrecisionModel=function(){return this.an.getPrecisionModel()},ni.prototype.getEnvelopeInternal=function(){return null===this.cn&&(this.cn=this.computeEnvelopeInternal()),new Sn(this.cn)},ni.prototype.setSRID=function(A){this.vn=A},ni.prototype.setUserData=function(A){this.ln=A},ni.prototype.compare=function(A,t){for(var n=A.iterator(),i=t.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),e=i.next(),s=r.compareTo(e);if(0!==s)return s}return n.hasNext()?1:i.hasNext()?-1:0},ni.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ni.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ni.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ni.SORTINDEX_MULTIPOINT||this.getSortIndex()===ni.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ni.SORTINDEX_MULTIPOLYGON},ni.prototype.interfaces_=function(){return[vn,an,wn]},ni.prototype.getClass=function(){return ni},ni.hasNonEmptyElements=function(A){for(var t=0;t<A.length;t++)if(!A[t].isEmpty())return!0;return!1},ni.hasNullElements=function(A){for(var t=0;t<A.length;t++)if(null===A[t])return!0;return!1},ii.serialVersionUID.get=function(){return 0x799ea46522854c00},ii.SORTINDEX_POINT.get=function(){return 0},ii.SORTINDEX_MULTIPOINT.get=function(){return 1},ii.SORTINDEX_LINESTRING.get=function(){return 2},ii.SORTINDEX_LINEARRING.get=function(){return 3},ii.SORTINDEX_MULTILINESTRING.get=function(){return 4},ii.SORTINDEX_POLYGON.get=function(){return 5},ii.SORTINDEX_MULTIPOLYGON.get=function(){return 6},ii.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},ii.geometryChangedFilter.get=function(){return ri},Object.defineProperties(ni,ii);var ri=function(){};ri.interfaces_=function(){return[ti]},ri.filter=function(A){A.geometryChangedAction()};var ei=function(){};ei.prototype.filter=function(A){},ei.prototype.interfaces_=function(){return[]},ei.prototype.getClass=function(){return ei};var si=function(){},ui={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};si.prototype.isInBoundary=function(A){},si.prototype.interfaces_=function(){return[]},si.prototype.getClass=function(){return si},ui.Mod2BoundaryNodeRule.get=function(){return oi},ui.EndPointBoundaryNodeRule.get=function(){return hi},ui.MultiValentEndPointBoundaryNodeRule.get=function(){return fi},ui.MonoValentEndPointBoundaryNodeRule.get=function(){return ci},ui.MOD2_BOUNDARY_RULE.get=function(){return new oi},ui.ENDPOINT_BOUNDARY_RULE.get=function(){return new hi},ui.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new fi},ui.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ci},ui.OGC_SFS_BOUNDARY_RULE.get=function(){return si.MOD2_BOUNDARY_RULE},Object.defineProperties(si,ui);var oi=function(){};oi.prototype.isInBoundary=function(A){return A%2==1},oi.prototype.interfaces_=function(){return[si]},oi.prototype.getClass=function(){return oi};var hi=function(){};hi.prototype.isInBoundary=function(A){return A>0},hi.prototype.interfaces_=function(){return[si]},hi.prototype.getClass=function(){return hi};var fi=function(){};fi.prototype.isInBoundary=function(A){return A>1},fi.prototype.interfaces_=function(){return[si]},fi.prototype.getClass=function(){return fi};var ci=function(){};ci.prototype.isInBoundary=function(A){return 1===A},ci.prototype.interfaces_=function(){return[si]},ci.prototype.getClass=function(){return ci};var ai=function(){};function vi(A){this.message=A||""}ai.prototype.add=function(){},ai.prototype.addAll=function(){},ai.prototype.isEmpty=function(){},ai.prototype.iterator=function(){},ai.prototype.size=function(){},ai.prototype.toArray=function(){},ai.prototype.remove=function(){},(vi.prototype=new Error).name="IndexOutOfBoundsException";var li=function(){};li.prototype.hasNext=function(){},li.prototype.next=function(){},li.prototype.remove=function(){};var wi=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(ai);function Pi(A){this.message=A||""}(Pi.prototype=new Error).name="NoSuchElementException";var gi=function(A){function t(){A.call(this),this.array_=[],arguments[0]instanceof ai&&this.addAll(arguments[0])}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[A,ai]},t.prototype.add=function(A){return 1===arguments.length?this.array_.push(A):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.set=function(A,t){var n=this.array_[A];return this.array_[A]=t,n},t.prototype.iterator=function(){return new Ci(this)},t.prototype.get=function(A){if(A<0||A>=this.size())throw new vi;return this.array_[A]},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},t.prototype.remove=function(A){for(var t=!1,n=0,i=this.array_.length;n<i;n++)if(this.array_[n]===A){this.array_.splice(n,1),t=!0;break}return t},t}(wi),Ci=function(A){function t(t){A.call(this),this.arrayList_=t,this.position_=0}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Pi;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(A){return this.arrayList_.set(this.position_-1,A)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(li),Di=function(A){function t(){if(A.call(this),0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.ensureCapacity(n.length),this.add(n,i)}}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(A){return this.get(A)},t.prototype.addAll=function(){var t=this;if(2===arguments.length){for(var n=arguments[0],i=arguments[1],r=!1,e=n.iterator();e.hasNext();)t.add(e.next(),i),r=!0;return r}return A.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var t=A.prototype.clone.call(this),n=0;n<this.size();n++)t.add(n,this.get(n).copy());return t},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var t=this;if(1===arguments.length){var n=arguments[0];A.prototype.add.call(this,n)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var i=arguments[0],r=arguments[1];return this.add(i,r,!0),!0}if(arguments[0]instanceof Pn&&"boolean"==typeof arguments[1]){var e=arguments[0],s=arguments[1];if(!s&&this.size()>=1){var u=this.get(this.size()-1);if(u.equals2D(e))return null}A.prototype.add.call(this,e)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],h=arguments[1];return this.add(o,h),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var f=arguments[0],c=arguments[1],a=arguments[2];if(a)for(var v=0;v<f.length;v++)t.add(f[v],c);else for(var l=f.length-1;l>=0;l--)t.add(f[l],c);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof Pn){var w=arguments[0],P=arguments[1],g=arguments[2];if(!g){var C=this.size();if(C>0){if(w>0){var D=this.get(w-1);if(D.equals2D(P))return null}if(w<C){var I=this.get(w);if(I.equals2D(P))return null}}}A.prototype.add.call(this,w,P)}}else if(4===arguments.length){var M=arguments[0],b=arguments[1],z=arguments[2],x=arguments[3],d=1;z>x&&(d=-1);for(var y=z;y!==x;y+=d)t.add(M[y],b);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new Pn(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(gi),Ii=function(){},Mi={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Mi.ForwardComparator.get=function(){return bi},Mi.BidirectionalComparator.get=function(){return zi},Mi.coordArrayType.get=function(){return new Array(0).fill(null)},Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii},Ii.isRing=function(A){return!(A.length<4||!A[0].equals2D(A[A.length-1]))},Ii.ptNotInList=function(A,t){for(var n=0;n<A.length;n++){var i=A[n];if(Ii.indexOf(i,t)<0)return i}return null},Ii.scroll=function(A,t){var n=Ii.indexOf(t,A);if(n<0)return null;var i=new Array(A.length).fill(null);Nn.arraycopy(A,n,i,0,A.length-n),Nn.arraycopy(A,0,i,A.length-n,n),Nn.arraycopy(i,0,A,0,A.length)},Ii.equals=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];if(A===t)return!0;if(null===A||null===t)return!1;if(A.length!==t.length)return!1;for(var n=0;n<A.length;n++)if(!A[n].equals(t[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var s=0;s<i.length;s++)if(0!==e.compare(i[s],r[s]))return!1;return!0}},Ii.intersection=function(A,t){for(var n=new Di,i=0;i<A.length;i++)t.intersects(A[i])&&n.add(A[i],!0);return n.toCoordinateArray()},Ii.hasRepeatedPoints=function(A){for(var t=1;t<A.length;t++)if(A[t-1].equals(A[t]))return!0;return!1},Ii.removeRepeatedPoints=function(A){return Ii.hasRepeatedPoints(A)?new Di(A,!1).toCoordinateArray():A},Ii.reverse=function(A){for(var t=A.length-1,n=Math.trunc(t/2),i=0;i<=n;i++){var r=A[i];A[i]=A[t-i],A[t-i]=r}},Ii.removeNull=function(A){for(var t=0,n=0;n<A.length;n++)null!==A[n]&&t++;var i=new Array(t).fill(null);if(0===t)return i;for(var r=0,e=0;e<A.length;e++)null!==A[e]&&(i[r++]=A[e]);return i},Ii.copyDeep=function(){if(1===arguments.length){for(var A=arguments[0],t=new Array(A.length).fill(null),n=0;n<A.length;n++)t[n]=new Pn(A[n]);return t}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],e=arguments[2],s=arguments[3],u=arguments[4],o=0;o<u;o++)e[s+o]=new Pn(i[r+o])},Ii.isEqualReversed=function(A,t){for(var n=0;n<A.length;n++){if(0!==A[n].compareTo(t[A.length-n-1]))return!1}return!0},Ii.envelope=function(A){for(var t=new Sn,n=0;n<A.length;n++)t.expandToInclude(A[n]);return t},Ii.toCoordinateArray=function(A){return A.toArray(Ii.coordArrayType)},Ii.atLeastNCoordinatesOrNothing=function(A,t){return t.length>=A?t:[]},Ii.indexOf=function(A,t){for(var n=0;n<t.length;n++)if(A.equals(t[n]))return n;return-1},Ii.increasingDirection=function(A){for(var t=0;t<Math.trunc(A.length/2);t++){var i=A[t].compareTo(A[A.length-1-t]);if(0!==i)return i}return 1},Ii.compare=function(A,t){for(var n=0;n<A.length&&n<t.length;){var i=A[n].compareTo(t[n]);if(0!==i)return i;n++}return n<t.length?-1:n<A.length?1:0},Ii.minCoordinate=function(A){for(var t=null,n=0;n<A.length;n++)(null===t||t.compareTo(A[n])>0)&&(t=A[n]);return t},Ii.extract=function(A,t,n){t=zn.clamp(t,0,A.length);var i=(n=zn.clamp(n,-1,A.length))-t+1;n<0&&(i=0),t>=A.length&&(i=0),n<t&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var e=0,s=t;s<=n;s++)r[e++]=A[s];return r},Object.defineProperties(Ii,Mi);var bi=function(){};bi.prototype.compare=function(A,t){return Ii.compare(A,t)},bi.prototype.interfaces_=function(){return[ln]},bi.prototype.getClass=function(){return bi};var zi=function(){};zi.prototype.compare=function(A,t){var n=A,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=Ii.compare(n,i);return Ii.isEqualReversed(n,i)?0:r},zi.prototype.OLDcompare=function(A,t){var n=A,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=Ii.increasingDirection(n),e=Ii.increasingDirection(i),s=r>0?0:n.length-1,u=e>0?0:n.length-1,o=0;o<n.length;o++){var h=n[s].compareTo(i[u]);if(0!==h)return h;s+=r,u+=e}return 0},zi.prototype.interfaces_=function(){return[ln]},zi.prototype.getClass=function(){return zi};var xi=function(){};xi.prototype.get=function(){},xi.prototype.put=function(){},xi.prototype.size=function(){},xi.prototype.values=function(){},xi.prototype.entrySet=function(){};var di=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(xi);function yi(A){this.message=A||""}function mi(){}(yi.prototype=new Error).name="OperationNotSupported",(mi.prototype=new ai).contains=function(){};var pi=function(A){function t(){A.call(this),this.array_=[],arguments[0]instanceof ai&&this.addAll(arguments[0])}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.contains=function(A){for(var t=0,n=this.array_.length;t<n;t++)if(this.array_[t]===A)return!0;return!1},t.prototype.add=function(A){return!this.contains(A)&&(this.array_.push(A),!0)},t.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.remove=function(A){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},t.prototype.iterator=function(){return new Li(this)},t}(mi),Li=function(A){function t(t){A.call(this),this.hashSet_=t,this.position_=0}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Pi;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new yi},t}(li);function Ti(A){return null===A?0:A.color}function Oi(A){return null===A?null:A.parent}function Fi(A,t){null!==A&&(A.color=t)}function Ei(A){return null===A?null:A.left}function Ui(A){return null===A?null:A.right}function ji(){this.root_=null,this.size_=0}(ji.prototype=new di).get=function(A){for(var t=this.root_;null!==t;){var n=A.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return t.value;t=t.right}}return null},ji.prototype.put=function(A,t){if(null===this.root_)return this.root_={key:A,value:t,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,(i=A.compareTo(r.key))<0)r=r.left;else{if(!(i>0)){var e=r.value;return r.value=t,e}r=r.right}}while(null!==r);var s={key:A,left:null,right:null,value:t,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null},ji.prototype.fixAfterInsertion=function(A){for(A.color=1;null!=A&&A!==this.root_&&1===A.parent.color;)if(Oi(A)===Ei(Oi(Oi(A)))){var t=Ui(Oi(Oi(A)));1===Ti(t)?(Fi(Oi(A),0),Fi(t,0),Fi(Oi(Oi(A)),1),A=Oi(Oi(A))):(A===Ui(Oi(A))&&(A=Oi(A),this.rotateLeft(A)),Fi(Oi(A),0),Fi(Oi(Oi(A)),1),this.rotateRight(Oi(Oi(A))))}else{var n=Ei(Oi(Oi(A)));1===Ti(n)?(Fi(Oi(A),0),Fi(n,0),Fi(Oi(Oi(A)),1),A=Oi(Oi(A))):(A===Ei(Oi(A))&&(A=Oi(A),this.rotateRight(A)),Fi(Oi(A),0),Fi(Oi(Oi(A)),1),this.rotateLeft(Oi(Oi(A))))}this.root_.color=0},ji.prototype.values=function(){var A=new gi,t=this.getFirstEntry();if(null!==t)for(A.add(t.value);null!==(t=ji.successor(t));)A.add(t.value);return A},ji.prototype.entrySet=function(){var A=new pi,t=this.getFirstEntry();if(null!==t)for(A.add(t);null!==(t=ji.successor(t));)A.add(t);return A},ji.prototype.rotateLeft=function(A){if(null!=A){var t=A.right;A.right=t.left,null!=t.left&&(t.left.parent=A),t.parent=A.parent,null===A.parent?this.root_=t:A.parent.left===A?A.parent.left=t:A.parent.right=t,t.left=A,A.parent=t}},ji.prototype.rotateRight=function(A){if(null!=A){var t=A.left;A.left=t.right,null!=t.right&&(t.right.parent=A),t.parent=A.parent,null===A.parent?this.root_=t:A.parent.right===A?A.parent.right=t:A.parent.left=t,t.right=A,A.parent=t}},ji.prototype.getFirstEntry=function(){var A=this.root_;if(null!=A)for(;null!=A.left;)A=A.left;return A},ji.successor=function(A){if(null===A)return null;if(null!==A.right){for(var t=A.right;null!==t.left;)t=t.left;return t}for(var n=A.parent,i=A;null!==n&&i===n.right;)i=n,n=n.parent;return n},ji.prototype.size=function(){return this.size_};var Ni=function(){};function Qi(){}function Si(){this.array_=[],arguments[0]instanceof ai&&this.addAll(arguments[0])}Ni.prototype.interfaces_=function(){return[]},Ni.prototype.getClass=function(){return Ni},Qi.prototype=new mi,(Si.prototype=new Qi).contains=function(A){for(var t=0,n=this.array_.length;t<n;t++)if(0===this.array_[t].compareTo(A))return!0;return!1},Si.prototype.add=function(A){if(this.contains(A))return!1;for(var t=0,n=this.array_.length;t<n;t++)if(1===this.array_[t].compareTo(A))return this.array_.splice(t,0,A),!0;return this.array_.push(A),!0},Si.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},Si.prototype.remove=function(A){throw new yi},Si.prototype.size=function(){return this.array_.length},Si.prototype.isEmpty=function(){return 0===this.array_.length},Si.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},Si.prototype.iterator=function(){return new Bi(this)};var Bi=function(A){this.treeSet_=A,this.position_=0};Bi.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Pi;return this.treeSet_.array_[this.position_++]},Bi.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Bi.prototype.remove=function(){throw new yi};var Ri=function(){};Ri.sort=function(){var A,t,n,i,r=arguments[0];if(1===arguments.length)i=function(A,t){return A.compareTo(t)},r.sort(i);else if(2===arguments.length)n=arguments[1],i=function(A,t){return n.compare(A,t)},r.sort(i);else if(3===arguments.length){(t=r.slice(arguments[1],arguments[2])).sort();var e=r.slice(0,arguments[1]).concat(t,r.slice(arguments[2],r.length));for(r.splice(0,r.length),A=0;A<e.length;A++)r.push(e[A])}else if(4===arguments.length)for(t=r.slice(arguments[1],arguments[2]),n=arguments[3],i=function(A,t){return n.compare(A,t)},t.sort(i),e=r.slice(0,arguments[1]).concat(t,r.slice(arguments[2],r.length)),r.splice(0,r.length),A=0;A<e.length;A++)r.push(e[A])},Ri.asList=function(A){for(var t=new gi,n=0,i=A.length;n<i;n++)t.add(A[n]);return t};var ki=function(){},Gi={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Gi.P.get=function(){return 0},Gi.L.get=function(){return 1},Gi.A.get=function(){return 2},Gi.FALSE.get=function(){return-1},Gi.TRUE.get=function(){return-2},Gi.DONTCARE.get=function(){return-3},Gi.SYM_FALSE.get=function(){return"F"},Gi.SYM_TRUE.get=function(){return"T"},Gi.SYM_DONTCARE.get=function(){return"*"},Gi.SYM_P.get=function(){return"0"},Gi.SYM_L.get=function(){return"1"},Gi.SYM_A.get=function(){return"2"},ki.prototype.interfaces_=function(){return[]},ki.prototype.getClass=function(){return ki},ki.toDimensionSymbol=function(A){switch(A){case ki.FALSE:return ki.SYM_FALSE;case ki.TRUE:return ki.SYM_TRUE;case ki.DONTCARE:return ki.SYM_DONTCARE;case ki.P:return ki.SYM_P;case ki.L:return ki.SYM_L;case ki.A:return ki.SYM_A}throw new hn("Unknown dimension value: "+A)},ki.toDimensionValue=function(A){switch(mn.toUpperCase(A)){case ki.SYM_FALSE:return ki.FALSE;case ki.SYM_TRUE:return ki.TRUE;case ki.SYM_DONTCARE:return ki.DONTCARE;case ki.SYM_P:return ki.P;case ki.SYM_L:return ki.L;case ki.SYM_A:return ki.A}throw new hn("Unknown dimension symbol: "+A)},Object.defineProperties(ki,Gi);var Yi=function(){};Yi.prototype.filter=function(A){},Yi.prototype.interfaces_=function(){return[]},Yi.prototype.getClass=function(){return Yi};var Wi=function(){};Wi.prototype.filter=function(A,t){},Wi.prototype.isDone=function(){},Wi.prototype.isGeometryChanged=function(){},Wi.prototype.interfaces_=function(){return[]},Wi.prototype.getClass=function(){return Wi};var qi=function(A){function t(t,n){if(A.call(this,n),this.Ht=t||[],A.hasNullElements(this.Ht))throw new hn("geometries must not contain null elements")}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var A=new Sn,t=0;t<this.Ht.length;t++)A.expandToInclude(this.Ht[t].getEnvelopeInternal());return A},t.prototype.getGeometryN=function(A){return this.Ht[A]},t.prototype.getSortIndex=function(){return A.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var A=new Array(this.getNumPoints()).fill(null),t=-1,n=0;n<this.Ht.length;n++)for(var i=this.Ht[n].getCoordinates(),r=0;r<i.length;r++)A[++t]=i[r];return A},t.prototype.getArea=function(){for(var A=0,t=0;t<this.Ht.length;t++)A+=this.Ht[t].getArea();return A},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n;if(this.Ht.length!==r.Ht.length)return!1;for(var e=0;e<this.Ht.length;e++)if(!t.Ht[e].equalsExact(r.Ht[e],i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var A=0;A<this.Ht.length;A++)this.Ht[A].normalize();Ri.sort(this.Ht)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this.Ht[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var A=ki.FALSE,t=0;t<this.Ht.length;t++)A=Math.max(A,this.Ht[t].getBoundaryDimension());return A},t.prototype.getDimension=function(){for(var A=ki.FALSE,t=0;t<this.Ht.length;t++)A=Math.max(A,this.Ht[t].getDimension());return A},t.prototype.getLength=function(){for(var A=0,t=0;t<this.Ht.length;t++)A+=this.Ht[t].getLength();return A},t.prototype.getNumPoints=function(){for(var A=0,t=0;t<this.Ht.length;t++)A+=this.Ht[t].getNumPoints();return A},t.prototype.getNumGeometries=function(){return this.Ht.length},t.prototype.reverse=function(){for(var t=new Array(this.Ht.length).fill(null),n=0;n<this.Ht.length;n++)t[n]=this.Ht[n].reverse();return this.getFactory().createGeometryCollection(t)},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=new Si(Ri.asList(this.Ht)),i=new Si(Ri.asList(t.Ht));return this.compare(n,i)}if(2===arguments.length){for(var r=arguments[0],e=arguments[1],s=r,u=this.getNumGeometries(),o=s.getNumGeometries(),h=0;h<u&&h<o;){var f=A.getGeometryN(h),c=s.getGeometryN(h),a=f.compareToSameClass(c,e);if(0!==a)return a;h++}return h<u?1:h<o?-1:0}},t.prototype.apply=function(){var A=this;if(bn(arguments[0],ei))for(var t=arguments[0],n=0;n<this.Ht.length;n++)A.Ht[n].apply(t);else if(bn(arguments[0],Wi)){var i=arguments[0];if(0===this.Ht.length)return null;for(var r=0;r<this.Ht.length&&(A.Ht[r].apply(i),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(bn(arguments[0],Yi)){var e=arguments[0];e.filter(this);for(var s=0;s<this.Ht.length;s++)A.Ht[s].apply(e)}else if(bn(arguments[0],ti)){var u=arguments[0];u.filter(this);for(var o=0;o<this.Ht.length;o++)A.Ht[o].apply(u)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Kn.shouldNeverReachHere(),null},t.prototype.clone=function(){var t=A.prototype.clone.call(this);t.Ht=new Array(this.Ht.length).fill(null);for(var n=0;n<this.Ht.length;n++)t.Ht[n]=this.Ht[n].clone();return t},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var A=new Array(this.Ht.length).fill(null),n=0;n<A.length;n++)A[n]=this.Ht[n].copy();return new t(A,this.an)},t.prototype.isEmpty=function(){for(var A=0;A<this.Ht.length;A++)if(!this.Ht[A].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(t,n),t}(ni),Vi=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ni.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?ki.FALSE:0},t.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var A=0;A<this.Ht.length;A++)if(!this.Ht[A].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var A=this.Ht.length,t=new Array(A).fill(null),n=0;n<this.Ht.length;n++)t[A-1-n]=this.Ht[n].reverse();return this.getFactory().createMultiLineString(t)},t.prototype.getBoundary=function(){return new Ki(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var A=new Array(this.Ht.length).fill(null),n=0;n<A.length;n++)A[n]=this.Ht[n].copy();return new t(A,this.an)},t.prototype.interfaces_=function(){return[Ni]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(t,n),t}(qi),Ki=function(){if(this.wn=null,this.Pn=null,this.gn=null,this.Cn=null,1===arguments.length){var A=arguments[0],t=si.MOD2_BOUNDARY_RULE;this.wn=A,this.Pn=A.getFactory(),this.gn=t}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.wn=n,this.Pn=n.getFactory(),this.gn=i}};Ki.prototype.boundaryMultiLineString=function(A){if(this.wn.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(A);return 1===t.length?this.Pn.createPoint(t[0]):this.Pn.createMultiPointFromCoords(t)},Ki.prototype.getBoundary=function(){return this.wn instanceof rr?this.boundaryLineString(this.wn):this.wn instanceof Vi?this.boundaryMultiLineString(this.wn):this.wn.getBoundary()},Ki.prototype.boundaryLineString=function(A){return this.wn.isEmpty()?this.getEmptyMultiPoint():A.isClosed()?this.gn.isInBoundary(2)?A.getStartPoint():this.Pn.createMultiPoint():this.Pn.createMultiPoint([A.getStartPoint(),A.getEndPoint()])},Ki.prototype.getEmptyMultiPoint=function(){return this.Pn.createMultiPoint()},Ki.prototype.computeBoundaryCoordinates=function(A){var t=new gi;this.Cn=new ji;for(var n=0;n<A.getNumGeometries();n++){var i=A.getGeometryN(n);0!==i.getNumPoints()&&(this.addEndpoint(i.getCoordinateN(0)),this.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var r=this.Cn.entrySet().iterator();r.hasNext();){var e=r.next(),s=e.getValue().count;this.gn.isInBoundary(s)&&t.add(e.getKey())}return Ii.toCoordinateArray(t)},Ki.prototype.addEndpoint=function(A){var t=this.Cn.get(A);null===t&&(t=new Hi,this.Cn.put(A,t)),t.count++},Ki.prototype.interfaces_=function(){return[]},Ki.prototype.getClass=function(){return Ki},Ki.getBoundary=function(){if(1===arguments.length){var A=arguments[0],t=new Ki(A);return t.getBoundary()}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new Ki(n,i);return r.getBoundary()}};var Hi=function(){this.count=null};function _i(){}function Ji(){}Hi.prototype.interfaces_=function(){return[]},Hi.prototype.getClass=function(){return Hi};var Zi=function(){};function Xi(){}function $i(){}function Ar(){}var tr=function(){},nr={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};tr.prototype.interfaces_=function(){return[]},tr.prototype.getClass=function(){return tr},tr.chars=function(A,t){for(var n=new Array(t).fill(null),i=0;i<t;i++)n[i]=A;return String(n)},tr.getStackTrace=function(){if(1===arguments.length){var A=arguments[0],t=new Xi,n=new _i;return A.printStackTrace(n),t.toString()}if(2===arguments.length){var i=arguments[0],r=arguments[1],e="";new Ji(tr.getStackTrace(i));for(var s=new Ar,u=0;u<r;u++)try{e+=s.readLine()+tr.NEWLINE}catch(A){if(!(A instanceof $i))throw A;Kn.shouldNeverReachHere()}return e}},tr.split=function(A,t){for(var n=t.length,i=new gi,r=""+A,e=r.indexOf(t);e>=0;){var s=r.substring(0,e);i.add(s),e=(r=r.substring(e+n)).indexOf(t)}r.length>0&&i.add(r);for(var u=new Array(i.size()).fill(null),o=0;o<u.length;o++)u[o]=i.get(o);return u},tr.toString=function(){if(1===arguments.length){var A=arguments[0];return tr.SIMPLE_ORDINATE_FORMAT.format(A)}},tr.spaces=function(A){return tr.chars(" ",A)},nr.NEWLINE.get=function(){return Nn.getProperty("line.separator")},nr.SIMPLE_ORDINATE_FORMAT.get=function(){return new Zi},Object.defineProperties(tr,nr);var ir=function(){};ir.prototype.interfaces_=function(){return[]},ir.prototype.getClass=function(){return ir},ir.copyCoord=function(A,t,n,i){for(var r=Math.min(A.getDimension(),n.getDimension()),e=0;e<r;e++)n.setOrdinate(i,e,A.getOrdinate(t,e))},ir.isRing=function(A){var t=A.size();return 0===t||!(t<=3)&&A.getOrdinate(0,Fn.X)===A.getOrdinate(t-1,Fn.X)&&A.getOrdinate(0,Fn.Y)===A.getOrdinate(t-1,Fn.Y)},ir.isEqual=function(A,t){var n=A.size();if(n!==t.size())return!1;for(var i=Math.min(A.getDimension(),t.getDimension()),r=0;r<n;r++)for(var e=0;e<i;e++){var s=A.getOrdinate(r,e),u=t.getOrdinate(r,e);if(!(A.getOrdinate(r,e)===t.getOrdinate(r,e)||fn.isNaN(s)&&fn.isNaN(u)))return!1}return!0},ir.extend=function(A,t,n){var i=A.create(n,t.getDimension()),r=t.size();if(ir.copy(t,0,i,0,r),r>0)for(var e=r;e<n;e++)ir.copy(t,r-1,i,e,1);return i},ir.reverse=function(A){for(var t=A.size()-1,n=Math.trunc(t/2),i=0;i<=n;i++)ir.swap(A,i,t-i)},ir.swap=function(A,t,n){if(t===n)return null;for(var i=0;i<A.getDimension();i++){var r=A.getOrdinate(t,i);A.setOrdinate(t,i,A.getOrdinate(n,i)),A.setOrdinate(n,i,r)}},ir.copy=function(A,t,n,i,r){for(var e=0;e<r;e++)ir.copyCoord(A,t+e,n,i+e)},ir.toString=function(){if(1===arguments.length){var A=arguments[0],t=A.size();if(0===t)return"()";var n=A.getDimension(),i=new dn;i.append("(");for(var r=0;r<t;r++){r>0&&i.append(" ");for(var e=0;e<n;e++)e>0&&i.append(","),i.append(tr.toString(A.getOrdinate(r,e)))}return i.append(")"),i.toString()}},ir.ensureValidRing=function(A,t){var n=t.size();return 0===n?t:n<=3?ir.createClosedRing(A,t,4):t.getOrdinate(0,Fn.X)===t.getOrdinate(n-1,Fn.X)&&t.getOrdinate(0,Fn.Y)===t.getOrdinate(n-1,Fn.Y)?t:ir.createClosedRing(A,t,n+1)},ir.createClosedRing=function(A,t,n){var i=A.create(n,t.getDimension()),r=t.size();ir.copy(t,0,i,0,r);for(var e=r;e<n;e++)ir.copy(t,0,i,e,1);return i};var rr=function(A){function t(t,n){A.call(this,n),this._t=null,this.init(t)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Sn:this._t.expandEnvelope(new Sn)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return A.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._t.toCoordinateArray()},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n;if(this._t.size()!==r._t.size())return!1;for(var e=0;e<this._t.size();e++)if(!t.equal(t._t.getCoordinate(e),r._t.getCoordinate(e),i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var A=0;A<Math.trunc(this._t.size()/2);A++){var t=this._t.size()-1-A;if(!this._t.getCoordinate(A).equals(this._t.getCoordinate(t)))return this._t.getCoordinate(A).compareTo(this._t.getCoordinate(t))>0&&ir.reverse(this._t),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._t.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?ki.FALSE:0},t.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return $n.computeLength(this._t)},t.prototype.getNumPoints=function(){return this._t.size()},t.prototype.reverse=function(){var A=this._t.copy();return ir.reverse(A),this.getFactory().createLineString(A)},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=t,i=0,r=0;i<this._t.size()&&r<n._t.size();){var e=A._t.getCoordinate(i).compareTo(n._t.getCoordinate(r));if(0!==e)return e;i++,r++}return i<this._t.size()?1:r<n._t.size()?-1:0}if(2===arguments.length){var s=arguments[0],u=arguments[1],o=s;return u.compare(this._t,o._t)}},t.prototype.apply=function(){var A=this;if(bn(arguments[0],ei))for(var t=arguments[0],n=0;n<this._t.size();n++)t.filter(A._t.getCoordinate(n));else if(bn(arguments[0],Wi)){var i=arguments[0];if(0===this._t.size())return null;for(var r=0;r<this._t.size()&&(i.filter(A._t,r),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(bn(arguments[0],Yi)){var e=arguments[0];e.filter(this)}else if(bn(arguments[0],ti)){var s=arguments[0];s.filter(this)}},t.prototype.getBoundary=function(){return new Ki(this).getBoundary()},t.prototype.isEquivalentClass=function(A){return A instanceof t},t.prototype.clone=function(){var t=A.prototype.clone.call(this);return t._t=this._t.clone(),t},t.prototype.getCoordinateN=function(A){return this._t.getCoordinate(A)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._t.copy(),this.an)},t.prototype.getCoordinateSequence=function(){return this._t},t.prototype.isEmpty=function(){return 0===this._t.size()},t.prototype.init=function(A){if(null===A&&(A=this.getFactory().getCoordinateSequenceFactory().create([])),1===A.size())throw new hn("Invalid number of points in LineString (found "+A.size()+" - must be 0 or >= 2)");this._t=A},t.prototype.isCoordinate=function(A){for(var t=0;t<this._t.size();t++)if(this._t.getCoordinate(t).equals(A))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(A){return this.getFactory().createPoint(this._t.getCoordinate(A))},t.prototype.interfaces_=function(){return[Ni]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(ni),er=function(){};er.prototype.interfaces_=function(){return[]},er.prototype.getClass=function(){return er};var sr=function(A){function t(t,n){A.call(this,n),this.Kt=t||null,this.init(this.Kt)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Sn;var A=new Sn;return A.expandToInclude(this.Kt.getX(0),this.Kt.getY(0)),A},t.prototype.getSortIndex=function(){return A.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),n))}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return 0!==this.Kt.size()?this.Kt.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return ki.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(1===arguments.length){var A=arguments[0],t=A;return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=n;return i.compare(this.Kt,r.Kt)}},t.prototype.apply=function(){if(bn(arguments[0],ei)){var A=arguments[0];if(this.isEmpty())return null;A.filter(this.getCoordinate())}else if(bn(arguments[0],Wi)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.Kt,0),t.isGeometryChanged()&&this.geometryChanged()}else if(bn(arguments[0],Yi)){var n=arguments[0];n.filter(this)}else if(bn(arguments[0],ti)){var i=arguments[0];i.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var t=A.prototype.clone.call(this);return t.Kt=this.Kt.clone(),t},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this.Kt.copy(),this.an)},t.prototype.getCoordinateSequence=function(){return this.Kt},t.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return 0===this.Kt.size()},t.prototype.init=function(A){null===A&&(A=this.getFactory().getCoordinateSequenceFactory().create([])),Kn.isTrue(A.size()<=1),this.Kt=A},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[er]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(t,n),t}(ni),ur=function(){};ur.prototype.interfaces_=function(){return[]},ur.prototype.getClass=function(){return ur};var or=function(A){function t(t,n,i){if(A.call(this,i),this.Jt=null,this.Zt=null,null===t&&(t=this.getFactory().createLinearRing()),null===n&&(n=[]),A.hasNullElements(n))throw new hn("holes must not contain null elements");if(t.isEmpty()&&A.hasNonEmptyElements(n))throw new hn("shell is empty but holes are not");this.Jt=t,this.Zt=n}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.Jt.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return A.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var A=new Array(this.getNumPoints()).fill(null),t=-1,n=this.Jt.getCoordinates(),i=0;i<n.length;i++)A[++t]=n[i];for(var r=0;r<this.Zt.length;r++)for(var e=this.Zt[r].getCoordinates(),s=0;s<e.length;s++)A[++t]=e[s];return A},t.prototype.getArea=function(){var A=0;A+=Math.abs($n.signedArea(this.Jt.getCoordinateSequence()));for(var t=0;t<this.Zt.length;t++)A-=Math.abs($n.signedArea(this.Zt[t].getCoordinateSequence()));return A},t.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this.Jt)return!1;if(5!==this.Jt.getNumPoints())return!1;for(var A=this.Jt.getCoordinateSequence(),t=this.getEnvelopeInternal(),n=0;n<5;n++){var i=A.getX(n);if(i!==t.getMinX()&&i!==t.getMaxX())return!1;var r=A.getY(n);if(r!==t.getMinY()&&r!==t.getMaxY())return!1}for(var e=A.getX(0),s=A.getY(0),u=1;u<=4;u++){var o=A.getX(u),h=A.getY(u);if(o!==e==(h!==s))return!1;e=o,s=h}return!0},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n,e=this.Jt,s=r.Jt;if(!e.equalsExact(s,i))return!1;if(this.Zt.length!==r.Zt.length)return!1;for(var u=0;u<this.Zt.length;u++)if(!t.Zt[u].equalsExact(r.Zt[u],i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var A=this;if(0===arguments.length){this.normalize(this.Jt,!0);for(var t=0;t<this.Zt.length;t++)A.normalize(A.Zt[t],!1);Ri.sort(this.Zt)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(n.isEmpty())return null;var r=new Array(n.getCoordinates().length-1).fill(null);Nn.arraycopy(n.getCoordinates(),0,r,0,r.length);var e=Ii.minCoordinate(n.getCoordinates());Ii.scroll(r,e),Nn.arraycopy(r,0,n.getCoordinates(),0,r.length),n.getCoordinates()[r.length]=r[0],$n.isCCW(n.getCoordinates())===i&&Ii.reverse(n.getCoordinates())}},t.prototype.getCoordinate=function(){return this.Jt.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this.Zt.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var A=0;A+=this.Jt.getLength();for(var t=0;t<this.Zt.length;t++)A+=this.Zt[t].getLength();return A},t.prototype.getNumPoints=function(){for(var A=this.Jt.getNumPoints(),t=0;t<this.Zt.length;t++)A+=this.Zt[t].getNumPoints();return A},t.prototype.reverse=function(){var A=this.copy();A.Jt=this.Jt.copy().reverse(),A.Zt=new Array(this.Zt.length).fill(null);for(var t=0;t<this.Zt.length;t++)A.Zt[t]=this.Zt[t].copy().reverse();return A},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=this.Jt,i=t.Jt;return n.compareToSameClass(i)}if(2===arguments.length){var r=arguments[0],e=arguments[1],s=r,u=this.Jt,o=s.Jt,h=u.compareToSameClass(o,e);if(0!==h)return h;for(var f=this.getNumInteriorRing(),c=s.getNumInteriorRing(),a=0;a<f&&a<c;){var v=A.getInteriorRingN(a),l=s.getInteriorRingN(a),w=v.compareToSameClass(l,e);if(0!==w)return w;a++}return a<f?1:a<c?-1:0}},t.prototype.apply=function(A){if(bn(A,ei)){this.Jt.apply(A);for(var t=0;t<this.Zt.length;t++)this.Zt[t].apply(A)}else if(bn(A,Wi)){if(this.Jt.apply(A),!A.isDone())for(var n=0;n<this.Zt.length&&(this.Zt[n].apply(A),!A.isDone());n++);A.isGeometryChanged()&&this.geometryChanged()}else if(bn(A,Yi))A.filter(this);else if(bn(A,ti)){A.filter(this),this.Jt.apply(A);for(var i=0;i<this.Zt.length;i++)this.Zt[i].apply(A)}},t.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var A=new Array(this.Zt.length+1).fill(null);A[0]=this.Jt;for(var t=0;t<this.Zt.length;t++)A[t+1]=this.Zt[t];return A.length<=1?this.getFactory().createLinearRing(A[0].getCoordinateSequence()):this.getFactory().createMultiLineString(A)},t.prototype.clone=function(){var t=A.prototype.clone.call(this);t.Jt=this.Jt.clone(),t.Zt=new Array(this.Zt.length).fill(null);for(var n=0;n<this.Zt.length;n++)t.Zt[n]=this.Zt[n].clone();return t},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var A=this.Jt.copy(),n=new Array(this.Zt.length).fill(null),i=0;i<n.length;i++)n[i]=this.Zt[i].copy();return new t(A,n,this.an)},t.prototype.getExteriorRing=function(){return this.Jt},t.prototype.isEmpty=function(){return this.Jt.isEmpty()},t.prototype.getInteriorRingN=function(A){return this.Zt[A]},t.prototype.interfaces_=function(){return[ur]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(ni),hr=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ni.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this.Ht[t].getCoordinate()}return A.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return ki.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var A=new Array(this.Ht.length).fill(null),n=0;n<A.length;n++)A[n]=this.Ht[n].copy();return new t(A,this.an)},t.prototype.interfaces_=function(){return[er]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(t,n),t}(qi),fr=function(A){function t(t,n){t instanceof Pn&&n instanceof yr&&(t=n.getCoordinateSequenceFactory().create(t)),A.call(this,t,n),this.validateConstruction()}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ni.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return ki.FALSE},t.prototype.isClosed=function(){return!!this.isEmpty()||A.prototype.isClosed.call(this)},t.prototype.reverse=function(){var A=this._t.copy();return ir.reverse(A),this.getFactory().createLinearRing(A)},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!A.prototype.isClosed.call(this))throw new hn("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new hn("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._t.copy(),this.an)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(rr),cr=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ni.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var t=new Array(this.Ht.length).fill(null),n=0;n<this.Ht.length;n++)t[n]=this.Ht[n].reverse();return this.getFactory().createMultiPolygon(t)},t.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var A=new gi,t=0;t<this.Ht.length;t++)for(var n=this.Ht[t].getBoundary(),i=0;i<n.getNumGeometries();i++)A.add(n.getGeometryN(i));var r=new Array(A.size()).fill(null);return this.getFactory().createMultiLineString(A.toArray(r))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var A=new Array(this.Ht.length).fill(null),n=0;n<A.length;n++)A[n]=this.Ht[n].copy();return new t(A,this.an)},t.prototype.interfaces_=function(){return[ur]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(qi),ar=function(A){this.an=A||null,this.Dn=!1},vr={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};ar.prototype.setCopyUserData=function(A){this.Dn=A},ar.prototype.edit=function(A,t){if(null===A)return null;var n=this.editInternal(A,t);return this.Dn&&n.setUserData(A.getUserData()),n},ar.prototype.editInternal=function(A,t){return null===this.an&&(this.an=A.getFactory()),A instanceof qi?this.editGeometryCollection(A,t):A instanceof or?this.editPolygon(A,t):A instanceof sr||A instanceof rr?t.edit(A,this.an):(Kn.shouldNeverReachHere("Unsupported Geometry class: "+A.getClass().getName()),null)},ar.prototype.editGeometryCollection=function(A,t){for(var n=t.edit(A,this.an),i=new gi,r=0;r<n.getNumGeometries();r++){var e=this.edit(n.getGeometryN(r),t);null===e||e.isEmpty()||i.add(e)}return n.getClass()===hr?this.an.createMultiPoint(i.toArray([])):n.getClass()===Vi?this.an.createMultiLineString(i.toArray([])):n.getClass()===cr?this.an.createMultiPolygon(i.toArray([])):this.an.createGeometryCollection(i.toArray([]))},ar.prototype.editPolygon=function(A,t){var n=t.edit(A,this.an);if(null===n&&(n=this.an.createPolygon(null)),n.isEmpty())return n;var i=this.edit(n.getExteriorRing(),t);if(null===i||i.isEmpty())return this.an.createPolygon();for(var r=new gi,e=0;e<n.getNumInteriorRing();e++){var s=this.edit(n.getInteriorRingN(e),t);null===s||s.isEmpty()||r.add(s)}return this.an.createPolygon(i,r.toArray([]))},ar.prototype.interfaces_=function(){return[]},ar.prototype.getClass=function(){return ar},ar.GeometryEditorOperation=function(){},vr.NoOpGeometryOperation.get=function(){return lr},vr.CoordinateOperation.get=function(){return wr},vr.CoordinateSequenceOperation.get=function(){return Pr},Object.defineProperties(ar,vr);var lr=function(){};lr.prototype.edit=function(A,t){return A},lr.prototype.interfaces_=function(){return[ar.GeometryEditorOperation]},lr.prototype.getClass=function(){return lr};var wr=function(){};wr.prototype.edit=function(A,t){var n=this.editCoordinates(A.getCoordinates(),A);return null===n?A:A instanceof fr?t.createLinearRing(n):A instanceof rr?t.createLineString(n):A instanceof sr?n.length>0?t.createPoint(n[0]):t.createPoint():A},wr.prototype.interfaces_=function(){return[ar.GeometryEditorOperation]},wr.prototype.getClass=function(){return wr};var Pr=function(){};Pr.prototype.edit=function(A,t){return A instanceof fr?t.createLinearRing(this.edit(A.getCoordinateSequence(),A)):A instanceof rr?t.createLineString(this.edit(A.getCoordinateSequence(),A)):A instanceof sr?t.createPoint(this.edit(A.getCoordinateSequence(),A)):A},Pr.prototype.interfaces_=function(){return[ar.GeometryEditorOperation]},Pr.prototype.getClass=function(){return Pr};var gr=function(){var A=this;if(this.In=3,this.Kt=null,1===arguments.length){if(arguments[0]instanceof Array)this.Kt=arguments[0],this.In=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this.Kt=new Array(t).fill(null);for(var n=0;n<t;n++)A.Kt[n]=new Pn}else if(bn(arguments[0],Fn)){var i=arguments[0];if(null===i)return this.Kt=new Array(0).fill(null),null;this.In=i.getDimension(),this.Kt=new Array(i.size()).fill(null);for(var r=0;r<this.Kt.length;r++)A.Kt[r]=i.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var e=arguments[0],s=arguments[1];this.Kt=e,this.In=s,null===e&&(this.Kt=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],o=arguments[1];this.Kt=new Array(u).fill(null),this.In=o;for(var h=0;h<u;h++)A.Kt[h]=new Pn}},Cr={serialVersionUID:{configurable:!0}};gr.prototype.setOrdinate=function(A,t,n){switch(t){case Fn.X:this.Kt[A].x=n;break;case Fn.Y:this.Kt[A].y=n;break;case Fn.Z:this.Kt[A].z=n;break;default:throw new hn("invalid ordinateIndex")}},gr.prototype.size=function(){return this.Kt.length},gr.prototype.getOrdinate=function(A,t){switch(t){case Fn.X:return this.Kt[A].x;case Fn.Y:return this.Kt[A].y;case Fn.Z:return this.Kt[A].z}return fn.NaN},gr.prototype.getCoordinate=function(){if(1===arguments.length){var A=arguments[0];return this.Kt[A]}if(2===arguments.length){var t=arguments[0],n=arguments[1];n.x=this.Kt[t].x,n.y=this.Kt[t].y,n.z=this.Kt[t].z}},gr.prototype.getCoordinateCopy=function(A){return new Pn(this.Kt[A])},gr.prototype.getDimension=function(){return this.In},gr.prototype.getX=function(A){return this.Kt[A].x},gr.prototype.clone=function(){for(var A=new Array(this.size()).fill(null),t=0;t<this.Kt.length;t++)A[t]=this.Kt[t].clone();return new gr(A,this.In)},gr.prototype.expandEnvelope=function(A){for(var t=0;t<this.Kt.length;t++)A.expandToInclude(this.Kt[t]);return A},gr.prototype.copy=function(){for(var A=new Array(this.size()).fill(null),t=0;t<this.Kt.length;t++)A[t]=this.Kt[t].copy();return new gr(A,this.In)},gr.prototype.toString=function(){if(this.Kt.length>0){var A=new dn(17*this.Kt.length);A.append("("),A.append(this.Kt[0]);for(var t=1;t<this.Kt.length;t++)A.append(", "),A.append(this.Kt[t]);return A.append(")"),A.toString()}return"()"},gr.prototype.getY=function(A){return this.Kt[A].y},gr.prototype.toCoordinateArray=function(){return this.Kt},gr.prototype.interfaces_=function(){return[Fn,wn]},gr.prototype.getClass=function(){return gr},Cr.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(gr,Cr);var Dr=function(){},Ir={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Dr.prototype.readResolve=function(){return Dr.instance()},Dr.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var A=arguments[0];return new gr(A)}if(bn(arguments[0],Fn)){var t=arguments[0];return new gr(t)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new gr(n):new gr(n,i)}},Dr.prototype.interfaces_=function(){return[Dn,wn]},Dr.prototype.getClass=function(){return Dr},Dr.instance=function(){return Dr.instanceObject},Ir.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Ir.instanceObject.get=function(){return new Dr},Object.defineProperties(Dr,Ir);var Mr=function(A){function t(){A.call(this),this.map_=new Map}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.get=function(A){return this.map_.get(A)||null},t.prototype.put=function(A,t){return this.map_.set(A,t),t},t.prototype.values=function(){for(var A=new gi,t=this.map_.values(),n=t.next();!n.done;)A.add(n.value),n=t.next();return A},t.prototype.entrySet=function(){var A=new pi;return this.map_.entries().forEach((function(t){return A.add(t)})),A},t.prototype.size=function(){return this.map_.size()},t}(xi),br=function A(){if(this.Mn=null,this.dA=null,0===arguments.length)this.Mn=A.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof xr){var t=arguments[0];this.Mn=t,t===A.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this.Mn=A.FIXED,this.setScale(n)}else if(arguments[0]instanceof A){var i=arguments[0];this.Mn=i.Mn,this.dA=i.dA}},zr={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};br.prototype.equals=function(A){if(!(A instanceof br))return!1;return this.Mn===A.Mn&&this.dA===A.dA},br.prototype.compareTo=function(A){var t=A,n=this.getMaximumSignificantDigits(),i=t.getMaximumSignificantDigits();return new yn(n).compareTo(new yn(i))},br.prototype.getScale=function(){return this.dA},br.prototype.isFloating=function(){return this.Mn===br.FLOATING||this.Mn===br.FLOATING_SINGLE},br.prototype.getType=function(){return this.Mn},br.prototype.toString=function(){var A="UNKNOWN";return this.Mn===br.FLOATING?A="Floating":this.Mn===br.FLOATING_SINGLE?A="Floating-Single":this.Mn===br.FIXED&&(A="Fixed (Scale="+this.getScale()+")"),A},br.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var A=arguments[0];return fn.isNaN(A)||this.Mn===br.FLOATING_SINGLE?A:this.Mn===br.FIXED?Math.round(A*this.dA)/this.dA:A}if(arguments[0]instanceof Pn){var t=arguments[0];if(this.Mn===br.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}},br.prototype.getMaximumSignificantDigits=function(){var A=16;return this.Mn===br.FLOATING?A=16:this.Mn===br.FLOATING_SINGLE?A=6:this.Mn===br.FIXED&&(A=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),A},br.prototype.setScale=function(A){this.dA=Math.abs(A)},br.prototype.interfaces_=function(){return[wn,an]},br.prototype.getClass=function(){return br},br.mostPrecise=function(A,t){return A.compareTo(t)>=0?A:t},zr.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},zr.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(br,zr);var xr=function A(t){this.bn=t||null,A.nameToTypeMap.put(t,this)},dr={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};xr.prototype.readResolve=function(){return xr.nameToTypeMap.get(this.bn)},xr.prototype.toString=function(){return this.bn},xr.prototype.interfaces_=function(){return[wn]},xr.prototype.getClass=function(){return xr},dr.serialVersionUID.get=function(){return-552860263173159e4},dr.nameToTypeMap.get=function(){return new Mr},Object.defineProperties(xr,dr),br.Type=xr,br.FIXED=new xr("FIXED"),br.FLOATING=new xr("FLOATING"),br.FLOATING_SINGLE=new xr("FLOATING SINGLE");var yr=function A(){this.en=new br,this.vn=0,this.zn=A.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?bn(arguments[0],Dn)?this.zn=arguments[0]:arguments[0]instanceof br&&(this.en=arguments[0]):2===arguments.length?(this.en=arguments[0],this.vn=arguments[1]):3===arguments.length&&(this.en=arguments[0],this.vn=arguments[1],this.zn=arguments[2]))},mr={serialVersionUID:{configurable:!0}};yr.prototype.toGeometry=function(A){return A.isNull()?this.createPoint(null):A.getMinX()===A.getMaxX()&&A.getMinY()===A.getMaxY()?this.createPoint(new Pn(A.getMinX(),A.getMinY())):A.getMinX()===A.getMaxX()||A.getMinY()===A.getMaxY()?this.createLineString([new Pn(A.getMinX(),A.getMinY()),new Pn(A.getMaxX(),A.getMaxY())]):this.createPolygon(this.createLinearRing([new Pn(A.getMinX(),A.getMinY()),new Pn(A.getMinX(),A.getMaxY()),new Pn(A.getMaxX(),A.getMaxY()),new Pn(A.getMaxX(),A.getMinY()),new Pn(A.getMinX(),A.getMinY())]),null)},yr.prototype.createLineString=function(A){return A?A instanceof Array?new rr(this.getCoordinateSequenceFactory().create(A),this):bn(A,Fn)?new rr(A,this):void 0:new rr(this.getCoordinateSequenceFactory().create([]),this)},yr.prototype.createMultiLineString=function(){if(0===arguments.length)return new Vi(null,this);if(1===arguments.length){var A=arguments[0];return new Vi(A,this)}},yr.prototype.buildGeometry=function(A){for(var t=null,n=!1,i=!1,r=A.iterator();r.hasNext();){var e=r.next(),s=e.getClass();null===t&&(t=s),s!==t&&(n=!0),e.isGeometryCollectionOrDerived()&&(i=!0)}if(null===t)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(yr.toGeometryArray(A));var u=A.iterator().next();if(A.size()>1){if(u instanceof or)return this.createMultiPolygon(yr.toPolygonArray(A));if(u instanceof rr)return this.createMultiLineString(yr.toLineStringArray(A));if(u instanceof sr)return this.createMultiPoint(yr.toPointArray(A));Kn.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u},yr.prototype.createMultiPointFromCoords=function(A){return this.createMultiPoint(null!==A?this.getCoordinateSequenceFactory().create(A):null)},yr.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Pn){var A=arguments[0];return this.createPoint(null!==A?this.getCoordinateSequenceFactory().create([A]):null)}if(bn(arguments[0],Fn)){var t=arguments[0];return new sr(t,this)}}},yr.prototype.getCoordinateSequenceFactory=function(){return this.zn},yr.prototype.createPolygon=function(){if(0===arguments.length)return new or(null,null,this);if(1===arguments.length){if(bn(arguments[0],Fn)){var A=arguments[0];return this.createPolygon(this.createLinearRing(A))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof fr){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return new or(i,r,this)}},yr.prototype.getSRID=function(){return this.vn},yr.prototype.createGeometryCollection=function(){if(0===arguments.length)return new qi(null,this);if(1===arguments.length){var A=arguments[0];return new qi(A,this)}},yr.prototype.createGeometry=function(A){return new ar(this).edit(A,{edit:function(){if(2===arguments.length){var A=arguments[0];return this.zn.create(A)}}})},yr.prototype.getPrecisionModel=function(){return this.en},yr.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var A=arguments[0];return this.createLinearRing(null!==A?this.getCoordinateSequenceFactory().create(A):null)}if(bn(arguments[0],Fn)){var t=arguments[0];return new fr(t,this)}}},yr.prototype.createMultiPolygon=function(){if(0===arguments.length)return new cr(null,this);if(1===arguments.length){var A=arguments[0];return new cr(A,this)}},yr.prototype.createMultiPoint=function(){var A=this;if(0===arguments.length)return new hr(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new hr(t,this)}if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(null!==n?this.getCoordinateSequenceFactory().create(n):null)}if(bn(arguments[0],Fn)){var i=arguments[0];if(null===i)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(i.size()).fill(null),e=0;e<i.size();e++){var s=A.getCoordinateSequenceFactory().create(1,i.getDimension());ir.copy(i,e,s,0,1),r[e]=A.createPoint(s)}return this.createMultiPoint(r)}}},yr.prototype.interfaces_=function(){return[wn]},yr.prototype.getClass=function(){return yr},yr.toMultiPolygonArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},yr.toGeometryArray=function(A){if(null===A)return null;var t=new Array(A.size()).fill(null);return A.toArray(t)},yr.getDefaultCoordinateSequenceFactory=function(){return Dr.instance()},yr.toMultiLineStringArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},yr.toLineStringArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},yr.toMultiPointArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},yr.toLinearRingArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},yr.toPointArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},yr.toPolygonArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},yr.createPointFromInternalCoord=function(A,t){return t.getPrecisionModel().makePrecise(A),t.getFactory().createPoint(A)},mr.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(yr,mr);var pr=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Lr=function(A){this.geometryFactory=A||new yr};Lr.prototype.read=function(A){var t,n=(t="string"==typeof A?JSON.parse(A):A).type;if(!Tr[n])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==pr.indexOf(n)?Tr[n].apply(this,[t.coordinates]):Tr[n].apply(this,"GeometryCollection"===n?[t.geometries]:[t])},Lr.prototype.write=function(A){var t=A.getGeometryType();if(!Or[t])throw new Error("Geometry is not supported");return Or[t].apply(this,[A])};var Tr={Feature:function(A){var t={};for(var n in A)t[n]=A[n];if(A.geometry){if(!Tr[A.geometry.type])throw new Error("Unknown GeoJSON type: "+A.type);t.geometry=this.read(A.geometry)}return A.bbox&&(t.bbox=Tr.bbox.apply(this,[A.bbox])),t},FeatureCollection:function(A){var t={};if(A.features){t.features=[];for(var n=0;n<A.features.length;++n)t.features.push(this.read(A.features[n]))}return A.bbox&&(t.bbox=this.parse.bbox.apply(this,[A.bbox])),t},coordinates:function(A){for(var t=[],n=0;n<A.length;++n){var i=A[n];t.push(new Pn(i[0],i[1]))}return t},bbox:function(A){return this.geometryFactory.createLinearRing([new Pn(A[0],A[1]),new Pn(A[2],A[1]),new Pn(A[2],A[3]),new Pn(A[0],A[3]),new Pn(A[0],A[1])])},Point:function(A){var t=new Pn(A[0],A[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(A){for(var t=[],n=0;n<A.length;++n)t.push(Tr.Point.apply(this,[A[n]]));return this.geometryFactory.createMultiPoint(t)},LineString:function(A){var t=Tr.coordinates.apply(this,[A]);return this.geometryFactory.createLineString(t)},MultiLineString:function(A){for(var t=[],n=0;n<A.length;++n)t.push(Tr.LineString.apply(this,[A[n]]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(A){for(var t=Tr.coordinates.apply(this,[A[0]]),n=this.geometryFactory.createLinearRing(t),i=[],r=1;r<A.length;++r){var s=Tr.coordinates.apply(this,[A[r]]),u=this.geometryFactory.createLinearRing(s);i.push(u)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(A){for(var t=[],n=0;n<A.length;++n){t.push(Tr.Polygon.apply(this,[A[n]]))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(A){for(var t=[],n=0;n<A.length;++n){t.push(this.read(A[n]))}return this.geometryFactory.createGeometryCollection(t)}},Or={coordinate:function(A){return[A.x,A.y]},Point:function(A){return{type:"Point",coordinates:Or.coordinate.apply(this,[A.getCoordinate()])}},MultiPoint:function(A){for(var t=[],n=0;n<A.Ht.length;++n){var r=Or.Point.apply(this,[A.Ht[n]]);t.push(r.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(A){for(var t=[],n=A.getCoordinates(),i=0;i<n.length;++i){t.push(Or.coordinate.apply(this,[n[i]]))}return{type:"LineString",coordinates:t}},MultiLineString:function(A){for(var t=[],n=0;n<A.Ht.length;++n){var r=Or.LineString.apply(this,[A.Ht[n]]);t.push(r.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(A){var t=[],n=Or.LineString.apply(this,[A.Jt]);t.push(n.coordinates);for(var i=0;i<A.Zt.length;++i){var e=Or.LineString.apply(this,[A.Zt[i]]);t.push(e.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(A){for(var t=[],n=0;n<A.Ht.length;++n){var r=Or.Polygon.apply(this,[A.Ht[n]]);t.push(r.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(A){for(var t=[],n=0;n<A.Ht.length;++n){var i=A.Ht[n],r=i.getGeometryType();t.push(Or[r].apply(this,[i]))}return{type:"GeometryCollection",geometries:t}}},Fr=function(A){this.geometryFactory=A||new yr,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Lr(this.geometryFactory)};Fr.prototype.read=function(A){var t=this.parser.read(A);return this.precisionModel.getType()===br.FIXED&&this.reducePrecision(t),t},Fr.prototype.reducePrecision=function(A){var t,n;if(A.coordinate)this.precisionModel.makePrecise(A.coordinate);else if(A.points)for(t=0,n=A.points.length;t<n;t++)this.precisionModel.makePrecise(A.points[t]);else if(A.geometries)for(t=0,n=A.geometries.length;t<n;t++)this.reducePrecision(A.geometries[t])};var Er=function(){this.parser=new Lr(this.geometryFactory)};Er.prototype.write=function(A){return this.parser.write(A)};var Ur=function(){},jr={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function Nr(A){this.message=A||""}function Qr(){this.array_=[]}Ur.prototype.interfaces_=function(){return[]},Ur.prototype.getClass=function(){return Ur},Ur.opposite=function(A){return A===Ur.LEFT?Ur.RIGHT:A===Ur.RIGHT?Ur.LEFT:A},jr.ON.get=function(){return 0},jr.LEFT.get=function(){return 1},jr.RIGHT.get=function(){return 2},Object.defineProperties(Ur,jr),(Nr.prototype=new Error).name="EmptyStackException",(Qr.prototype=new wi).add=function(A){return this.array_.push(A),!0},Qr.prototype.get=function(A){if(A<0||A>=this.size())throw new Error;return this.array_[A]},Qr.prototype.push=function(A){return this.array_.push(A),A},Qr.prototype.pop=function(A){if(0===this.array_.length)throw new Nr;return this.array_.pop()},Qr.prototype.peek=function(){if(0===this.array_.length)throw new Nr;return this.array_[this.array_.length-1]},Qr.prototype.empty=function(){return 0===this.array_.length},Qr.prototype.isEmpty=function(){return this.empty()},Qr.prototype.search=function(A){return this.array_.indexOf(A)},Qr.prototype.size=function(){return this.array_.length},Qr.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A};var Sr=function(){this.xn=-1,this.dn=null,this.yn=null,this.mn=null};Sr.prototype.getCoordinate=function(){return this.dn},Sr.prototype.getRightmostSide=function(A,t){var n=this.getRightmostSideOfSegment(A,t);return n<0&&(n=this.getRightmostSideOfSegment(A,t-1)),n<0&&(this.dn=null,this.checkForRightmostCoordinate(A)),n},Sr.prototype.findRightmostEdgeAtVertex=function(){var A=this.yn.getEdge().getCoordinates();Kn.isTrue(this.xn>0&&this.xn<A.length,"rightmost point expected to be interior vertex of edge");var t=A[this.xn-1],n=A[this.xn+1],i=$n.computeOrientation(this.dn,n,t),r=!1;(t.y<this.dn.y&&n.y<this.dn.y&&i===$n.COUNTERCLOCKWISE||t.y>this.dn.y&&n.y>this.dn.y&&i===$n.CLOCKWISE)&&(r=!0),r&&(this.xn=this.xn-1)},Sr.prototype.getRightmostSideOfSegment=function(A,t){var n=A.getEdge().getCoordinates();if(t<0||t+1>=n.length)return-1;if(n[t].y===n[t+1].y)return-1;var i=Ur.LEFT;return n[t].y<n[t+1].y&&(i=Ur.RIGHT),i},Sr.prototype.getEdge=function(){return this.mn},Sr.prototype.checkForRightmostCoordinate=function(A){for(var t=A.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(null===this.dn||t[n].x>this.dn.x)&&(this.yn=A,this.xn=n,this.dn=t[n])},Sr.prototype.findRightmostEdgeAtNode=function(){var A=this.yn.getNode().getEdges();this.yn=A.getRightmostEdge(),this.yn.isForward()||(this.yn=this.yn.getSym(),this.xn=this.yn.getEdge().getCoordinates().length-1)},Sr.prototype.findEdge=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();n.isForward()&&this.checkForRightmostCoordinate(n)}Kn.isTrue(0!==this.xn||this.dn.equals(this.yn.getCoordinate()),"inconsistency in rightmost processing"),0===this.xn?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.mn=this.yn,this.getRightmostSide(this.yn,this.xn)===Ur.LEFT&&(this.mn=this.yn.getSym())},Sr.prototype.interfaces_=function(){return[]},Sr.prototype.getClass=function(){return Sr};var Br=function(A){function t(n,i){A.call(this,t.msgWithCoord(n,i)),this.pt=i?new Pn(i):null,this.name="TopologyException"}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(A,t){return t?A:A+" [ "+t+" ]"},t}(qn),Rr=function(){this.array_=[]};Rr.prototype.addLast=function(A){this.array_.push(A)},Rr.prototype.removeFirst=function(){return this.array_.shift()},Rr.prototype.isEmpty=function(){return 0===this.array_.length};var kr=function(){this.pn=null,this.Ln=new gi,this.Tn=new gi,this.On=null,this.Fn=null,this.pn=new Sr};kr.prototype.clearVisitedEdges=function(){for(var A=this.Ln.iterator();A.hasNext();)A.next().setVisited(!1)},kr.prototype.getRightmostCoordinate=function(){return this.On},kr.prototype.computeNodeDepth=function(A){for(var t=null,n=A.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){t=i;break}}if(null===t)throw new Br("unable to find edge to compute depths at "+A.getCoordinate());A.getEdges().computeDepths(t);for(var r=A.getEdges().iterator();r.hasNext();){var e=r.next();e.setVisited(!0),this.copySymDepths(e)}},kr.prototype.computeDepth=function(A){this.clearVisitedEdges();var t=this.pn.getEdge();t.setEdgeDepths(Ur.RIGHT,A),this.copySymDepths(t),this.computeDepths(t)},kr.prototype.create=function(A){this.addReachable(A),this.pn.findEdge(this.Ln),this.On=this.pn.getCoordinate()},kr.prototype.findResultEdges=function(){for(var A=this.Ln.iterator();A.hasNext();){var t=A.next();t.getDepth(Ur.RIGHT)>=1&&t.getDepth(Ur.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}},kr.prototype.computeDepths=function(A){var t=new pi,n=new Rr,i=A.getNode();for(n.addLast(i),t.add(i),A.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();t.add(r),this.computeNodeDepth(r);for(var e=r.getEdges().iterator();e.hasNext();){var s=e.next().getSym();if(!s.isVisited()){var u=s.getNode();t.contains(u)||(n.addLast(u),t.add(u))}}}},kr.prototype.compareTo=function(A){return this.On.x<A.On.x?-1:this.On.x>A.On.x?1:0},kr.prototype.getEnvelope=function(){if(null===this.Fn){for(var A=new Sn,t=this.Ln.iterator();t.hasNext();)for(var n=t.next().getEdge().getCoordinates(),i=0;i<n.length-1;i++)A.expandToInclude(n[i]);this.Fn=A}return this.Fn},kr.prototype.addReachable=function(A){var t=new Qr;for(t.add(A);!t.empty();){var n=t.pop();this.add(n,t)}},kr.prototype.copySymDepths=function(A){var t=A.getSym();t.setDepth(Ur.LEFT,A.getDepth(Ur.RIGHT)),t.setDepth(Ur.RIGHT,A.getDepth(Ur.LEFT))},kr.prototype.add=function(A,t){A.setVisited(!0),this.Tn.add(A);for(var n=A.getEdges().iterator();n.hasNext();){var i=n.next();this.Ln.add(i);var r=i.getSym().getNode();r.isVisited()||t.push(r)}},kr.prototype.getNodes=function(){return this.Tn},kr.prototype.getDirectedEdges=function(){return this.Ln},kr.prototype.interfaces_=function(){return[an]},kr.prototype.getClass=function(){return kr};var Gr=function A(){var t=this;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[Ur.ON]=i}else if(arguments[0]instanceof A){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var e=0;e<this.location.length;e++)t.location[e]=r.location[e]}}else if(3===arguments.length){var s=arguments[0],u=arguments[1],o=arguments[2];this.init(3),this.location[Ur.ON]=s,this.location[Ur.LEFT]=u,this.location[Ur.RIGHT]=o}};Gr.prototype.setAllLocations=function(A){for(var t=0;t<this.location.length;t++)this.location[t]=A},Gr.prototype.isNull=function(){for(var A=0;A<this.location.length;A++)if(this.location[A]!==In.NONE)return!1;return!0},Gr.prototype.setAllLocationsIfNull=function(A){for(var t=0;t<this.location.length;t++)this.location[t]===In.NONE&&(this.location[t]=A)},Gr.prototype.isLine=function(){return 1===this.location.length},Gr.prototype.merge=function(A){if(A.location.length>this.location.length){var t=new Array(3).fill(null);t[Ur.ON]=this.location[Ur.ON],t[Ur.LEFT]=In.NONE,t[Ur.RIGHT]=In.NONE,this.location=t}for(var n=0;n<this.location.length;n++)this.location[n]===In.NONE&&n<A.location.length&&(this.location[n]=A.location[n])},Gr.prototype.getLocations=function(){return this.location},Gr.prototype.flip=function(){if(this.location.length<=1)return null;var A=this.location[Ur.LEFT];this.location[Ur.LEFT]=this.location[Ur.RIGHT],this.location[Ur.RIGHT]=A},Gr.prototype.toString=function(){var A=new dn;return this.location.length>1&&A.append(In.toLocationSymbol(this.location[Ur.LEFT])),A.append(In.toLocationSymbol(this.location[Ur.ON])),this.location.length>1&&A.append(In.toLocationSymbol(this.location[Ur.RIGHT])),A.toString()},Gr.prototype.setLocations=function(A,t,n){this.location[Ur.ON]=A,this.location[Ur.LEFT]=t,this.location[Ur.RIGHT]=n},Gr.prototype.get=function(A){return A<this.location.length?this.location[A]:In.NONE},Gr.prototype.isArea=function(){return this.location.length>1},Gr.prototype.isAnyNull=function(){for(var A=0;A<this.location.length;A++)if(this.location[A]===In.NONE)return!0;return!1},Gr.prototype.setLocation=function(){if(1===arguments.length){var A=arguments[0];this.setLocation(Ur.ON,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.location[t]=n}},Gr.prototype.init=function(A){this.location=new Array(A).fill(null),this.setAllLocations(In.NONE)},Gr.prototype.isEqualOnSide=function(A,t){return this.location[t]===A.location[t]},Gr.prototype.allPositionsEqual=function(A){for(var t=0;t<this.location.length;t++)if(this.location[t]!==A)return!1;return!0},Gr.prototype.interfaces_=function(){return[]},Gr.prototype.getClass=function(){return Gr};var Yr=function A(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Gr(t),this.elt[1]=new Gr(t)}else if(arguments[0]instanceof A){var n=arguments[0];this.elt[0]=new Gr(n.elt[0]),this.elt[1]=new Gr(n.elt[1])}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.elt[0]=new Gr(In.NONE),this.elt[1]=new Gr(In.NONE),this.elt[i].setLocation(r)}else if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];this.elt[0]=new Gr(e,s,u),this.elt[1]=new Gr(e,s,u)}else if(4===arguments.length){var o=arguments[0],h=arguments[1],f=arguments[2],c=arguments[3];this.elt[0]=new Gr(In.NONE,In.NONE,In.NONE),this.elt[1]=new Gr(In.NONE,In.NONE,In.NONE),this.elt[o].setLocations(h,f,c)}};Yr.prototype.getGeometryCount=function(){var A=0;return this.elt[0].isNull()||A++,this.elt[1].isNull()||A++,A},Yr.prototype.setAllLocations=function(A,t){this.elt[A].setAllLocations(t)},Yr.prototype.isNull=function(A){return this.elt[A].isNull()},Yr.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var A=arguments[0];this.setAllLocationsIfNull(0,A),this.setAllLocationsIfNull(1,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}},Yr.prototype.isLine=function(A){return this.elt[A].isLine()},Yr.prototype.merge=function(A){for(var t=0;t<2;t++)null===this.elt[t]&&null!==A.elt[t]?this.elt[t]=new Gr(A.elt[t]):this.elt[t].merge(A.elt[t])},Yr.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Yr.prototype.getLocation=function(){if(1===arguments.length){var A=arguments[0];return this.elt[A].get(Ur.ON)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}},Yr.prototype.toString=function(){var A=new dn;return null!==this.elt[0]&&(A.append("A:"),A.append(this.elt[0].toString())),null!==this.elt[1]&&(A.append(" B:"),A.append(this.elt[1].toString())),A.toString()},Yr.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var A=arguments[0];return this.elt[A].isArea()}},Yr.prototype.isAnyNull=function(A){return this.elt[A].isAnyNull()},Yr.prototype.setLocation=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];this.elt[A].setLocation(Ur.ON,t)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}},Yr.prototype.isEqualOnSide=function(A,t){return this.elt[0].isEqualOnSide(A.elt[0],t)&&this.elt[1].isEqualOnSide(A.elt[1],t)},Yr.prototype.allPositionsEqual=function(A,t){return this.elt[A].allPositionsEqual(t)},Yr.prototype.toLine=function(A){this.elt[A].isArea()&&(this.elt[A]=new Gr(this.elt[A].location[0]))},Yr.prototype.interfaces_=function(){return[]},Yr.prototype.getClass=function(){return Yr},Yr.toLineLabel=function(A){for(var t=new Yr(In.NONE),n=0;n<2;n++)t.setLocation(n,A.getLocation(n));return t};var Wr=function(){this.En=null,this.Un=-1,this.jn=new gi,this.Nn=new gi,this.Qn=new Yr(In.NONE),this.Sn=null,this.Bn=null,this.Jt=null,this.Zt=new gi,this.Rn=null;var A=arguments[0],t=arguments[1];this.Rn=t,this.computePoints(A),this.computeRing()};Wr.prototype.computeRing=function(){if(null!==this.Sn)return null;for(var A=new Array(this.Nn.size()).fill(null),t=0;t<this.Nn.size();t++)A[t]=this.Nn.get(t);this.Sn=this.Rn.createLinearRing(A),this.Bn=$n.isCCW(this.Sn.getCoordinates())},Wr.prototype.isIsolated=function(){return 1===this.Qn.getGeometryCount()},Wr.prototype.computePoints=function(A){this.En=A;var t=A,n=!0;do{if(null===t)throw new Br("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new Br("Directed Edge visited twice during ring-building at "+t.getCoordinate());this.jn.add(t);var i=t.getLabel();Kn.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(t.getEdge(),t.isForward(),n),n=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this.En)},Wr.prototype.getLinearRing=function(){return this.Sn},Wr.prototype.getCoordinate=function(A){return this.Nn.get(A)},Wr.prototype.computeMaxNodeDegree=function(){this.Un=0;var A=this.En;do{var t=A.getNode().getEdges().getOutgoingDegree(this);t>this.Un&&(this.Un=t),A=this.getNext(A)}while(A!==this.En);this.Un*=2},Wr.prototype.addPoints=function(A,t,n){var i=A.getCoordinates();if(t){var r=1;n&&(r=0);for(var e=r;e<i.length;e++)this.Nn.add(i[e])}else{var s=i.length-2;n&&(s=i.length-1);for(var u=s;u>=0;u--)this.Nn.add(i[u])}},Wr.prototype.isHole=function(){return this.Bn},Wr.prototype.setInResult=function(){var A=this.En;do{A.getEdge().setInResult(!0),A=A.getNext()}while(A!==this.En)},Wr.prototype.containsPoint=function(A){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(A))return!1;if(!$n.isPointInRing(A,t.getCoordinates()))return!1;for(var n=this.Zt.iterator();n.hasNext();)if(n.next().containsPoint(A))return!1;return!0},Wr.prototype.addHole=function(A){this.Zt.add(A)},Wr.prototype.isShell=function(){return null===this.Jt},Wr.prototype.getLabel=function(){return this.Qn},Wr.prototype.getEdges=function(){return this.jn},Wr.prototype.getMaxNodeDegree=function(){return this.Un<0&&this.computeMaxNodeDegree(),this.Un},Wr.prototype.getShell=function(){return this.Jt},Wr.prototype.mergeLabel=function(){if(1===arguments.length){var A=arguments[0];this.mergeLabel(A,0),this.mergeLabel(A,1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1],i=t.getLocation(n,Ur.RIGHT);if(i===In.NONE)return null;if(this.Qn.getLocation(n)===In.NONE)return this.Qn.setLocation(n,i),null}},Wr.prototype.setShell=function(A){this.Jt=A,null!==A&&A.addHole(this)},Wr.prototype.toPolygon=function(A){for(var t=new Array(this.Zt.size()).fill(null),n=0;n<this.Zt.size();n++)t[n]=this.Zt.get(n).getLinearRing();return A.createPolygon(this.getLinearRing(),t)},Wr.prototype.interfaces_=function(){return[]},Wr.prototype.getClass=function(){return Wr};var qr=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.setEdgeRing=function(A,t){A.setMinEdgeRing(t)},t.prototype.getNext=function(A){return A.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Wr),Vr=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.buildMinimalRings=function(){var A=new gi,t=this.En;do{if(null===t.getMinEdgeRing()){var n=new qr(t,this.Rn);A.add(n)}t=t.getNext()}while(t!==this.En);return A},t.prototype.setEdgeRing=function(A,t){A.setEdgeRing(t)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var A=this.En;do{A.getNode().getEdges().linkMinimalDirectedEdges(this),A=A.getNext()}while(A!==this.En)},t.prototype.getNext=function(A){return A.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Wr),Kr=function(){if(this.Qn=null,this.kn=!1,this.Gn=!1,this.Yn=!1,this.Wn=!1,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.Qn=A}};Kr.prototype.setVisited=function(A){this.Wn=A},Kr.prototype.setInResult=function(A){this.kn=A},Kr.prototype.isCovered=function(){return this.Gn},Kr.prototype.isCoveredSet=function(){return this.Yn},Kr.prototype.setLabel=function(A){this.Qn=A},Kr.prototype.getLabel=function(){return this.Qn},Kr.prototype.setCovered=function(A){this.Gn=A,this.Yn=!0},Kr.prototype.updateIM=function(A){Kn.isTrue(this.Qn.getGeometryCount()>=2,"found partial label"),this.computeIM(A)},Kr.prototype.isInResult=function(){return this.kn},Kr.prototype.isVisited=function(){return this.Wn},Kr.prototype.interfaces_=function(){return[]},Kr.prototype.getClass=function(){return Kr};var Hr=function(A){function t(){A.call(this),this.qn=null,this.jn=null;var t=arguments[0],n=arguments[1];this.qn=t,this.jn=n,this.Qn=new Yr(0,In.NONE)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var A=this.getEdges().getEdges().iterator();A.hasNext();)if(A.next().getEdge().isInResult())return!0;return!1},t.prototype.isIsolated=function(){return 1===this.Qn.getGeometryCount()},t.prototype.getCoordinate=function(){return this.qn},t.prototype.print=function(A){A.println("node "+this.qn+" lbl: "+this.Qn)},t.prototype.computeIM=function(A){},t.prototype.computeMergedLocation=function(A,t){var n=In.NONE;if(n=this.Qn.getLocation(t),!A.isNull(t)){var i=A.getLocation(t);n!==In.BOUNDARY&&(n=i)}return n},t.prototype.setLabel=function(){if(2!==arguments.length)return A.prototype.setLabel.apply(this,arguments);var t=arguments[0],n=arguments[1];null===this.Qn?this.Qn=new Yr(t,n):this.Qn.setLocation(t,n)},t.prototype.getEdges=function(){return this.jn},t.prototype.mergeLabel=function(){var A=this;if(arguments[0]instanceof t){var n=arguments[0];this.mergeLabel(n.Qn)}else if(arguments[0]instanceof Yr)for(var i=arguments[0],r=0;r<2;r++){var e=A.computeMergedLocation(i,r),s=A.Qn.getLocation(r);s===In.NONE&&A.Qn.setLocation(r,e)}},t.prototype.add=function(A){this.jn.insert(A),A.setNode(this)},t.prototype.setLabelBoundary=function(A){if(null===this.Qn)return null;var t=In.NONE;null!==this.Qn&&(t=this.Qn.getLocation(A));var n=null;if(t===In.BOUNDARY)n=In.INTERIOR;else n=In.BOUNDARY;this.Qn.setLocation(A,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Kr),_r=function(){this.nodeMap=new ji,this.nodeFact=null;var A=arguments[0];this.nodeFact=A};_r.prototype.find=function(A){return this.nodeMap.get(A)},_r.prototype.addNode=function(){if(arguments[0]instanceof Pn){var A=arguments[0],t=this.nodeMap.get(A);return null===t&&(t=this.nodeFact.createNode(A),this.nodeMap.put(A,t)),t}if(arguments[0]instanceof Hr){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return null===i?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}},_r.prototype.print=function(A){for(var t=this.iterator();t.hasNext();)t.next().print(A)},_r.prototype.iterator=function(){return this.nodeMap.values().iterator()},_r.prototype.values=function(){return this.nodeMap.values()},_r.prototype.getBoundaryNodes=function(A){for(var t=new gi,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(A)===In.BOUNDARY&&t.add(i)}return t},_r.prototype.add=function(A){var t=A.getCoordinate();this.addNode(t).add(A)},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r};var Jr=function(){},Zr={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Jr.prototype.interfaces_=function(){return[]},Jr.prototype.getClass=function(){return Jr},Jr.isNorthern=function(A){return A===Jr.NE||A===Jr.NW},Jr.isOpposite=function(A,t){return A!==t&&2==(A-t+4)%4},Jr.commonHalfPlane=function(A,t){if(A===t)return A;if(2==(A-t+4)%4)return-1;var n=A<t?A:t;return 0===n&&3===(A>t?A:t)?3:n},Jr.isInHalfPlane=function(A,t){return t===Jr.SE?A===Jr.SE||A===Jr.SW:A===t||A===t+1},Jr.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1];if(0===A&&0===t)throw new hn("Cannot compute the quadrant for point ( "+A+", "+t+" )");return A>=0?t>=0?Jr.NE:Jr.SE:t>=0?Jr.NW:Jr.SW}if(arguments[0]instanceof Pn&&arguments[1]instanceof Pn){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new hn("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?Jr.NE:Jr.SE:i.y>=n.y?Jr.NW:Jr.SW}},Zr.NE.get=function(){return 0},Zr.NW.get=function(){return 1},Zr.SW.get=function(){return 2},Zr.SE.get=function(){return 3},Object.defineProperties(Jr,Zr);var Xr=function(){if(this.Vn=null,this.Qn=null,this.Kn=null,this.Hn=null,this._n=null,this.Jn=null,this.Zn=null,this.Xn=null,1===arguments.length){var A=arguments[0];this.Vn=A}else if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=null;this.Vn=t,this.init(n,i),this.Qn=r}else if(4===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=arguments[3];this.Vn=e,this.init(s,u),this.Qn=o}};Xr.prototype.compareDirection=function(A){return this.Jn===A.Jn&&this.Zn===A.Zn?0:this.Xn>A.Xn?1:this.Xn<A.Xn?-1:$n.computeOrientation(A.Hn,A._n,this._n)},Xr.prototype.getDy=function(){return this.Zn},Xr.prototype.getCoordinate=function(){return this.Hn},Xr.prototype.setNode=function(A){this.Kn=A},Xr.prototype.print=function(A){var t=Math.atan2(this.Zn,this.Jn),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);A.print("  "+r+": "+this.Hn+" - "+this._n+" "+this.Xn+":"+t+"   "+this.Qn)},Xr.prototype.compareTo=function(A){return this.compareDirection(A)},Xr.prototype.getDirectedCoordinate=function(){return this._n},Xr.prototype.getDx=function(){return this.Jn},Xr.prototype.getLabel=function(){return this.Qn},Xr.prototype.getEdge=function(){return this.Vn},Xr.prototype.getQuadrant=function(){return this.Xn},Xr.prototype.getNode=function(){return this.Kn},Xr.prototype.toString=function(){var A=Math.atan2(this.Zn,this.Jn),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this.Hn+" - "+this._n+" "+this.Xn+":"+A+"   "+this.Qn},Xr.prototype.computeLabel=function(A){},Xr.prototype.init=function(A,t){this.Hn=A,this._n=t,this.Jn=t.x-A.x,this.Zn=t.y-A.y,this.Xn=Jr.quadrant(this.Jn,this.Zn),Kn.isTrue(!(0===this.Jn&&0===this.Zn),"EdgeEnd with identical endpoints found")},Xr.prototype.interfaces_=function(){return[an]},Xr.prototype.getClass=function(){return Xr};var $r=function(A){function t(){var t=arguments[0],n=arguments[1];if(A.call(this,t),this.$n=null,this.kn=!1,this.Wn=!1,this.Ai=null,this.ti=null,this.ni=null,this.ii=null,this.ri=null,this.ei=[0,-999,-999],this.$n=n,n)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var i=t.getNumPoints()-1;this.init(t.getCoordinate(i),t.getCoordinate(i-1))}this.computeDirectedLabel()}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getNextMin=function(){return this.ni},t.prototype.getDepth=function(A){return this.ei[A]},t.prototype.setVisited=function(A){this.Wn=A},t.prototype.computeDirectedLabel=function(){this.Qn=new Yr(this.Vn.getLabel()),this.$n||this.Qn.flip()},t.prototype.getNext=function(){return this.ti},t.prototype.setDepth=function(A,t){if(-999!==this.ei[A]&&this.ei[A]!==t)throw new Br("assigned depths do not match",this.getCoordinate());this.ei[A]=t},t.prototype.isInteriorAreaEdge=function(){for(var A=!0,t=0;t<2;t++)this.Qn.isArea(t)&&this.Qn.getLocation(t,Ur.LEFT)===In.INTERIOR&&this.Qn.getLocation(t,Ur.RIGHT)===In.INTERIOR||(A=!1);return A},t.prototype.setNextMin=function(A){this.ni=A},t.prototype.print=function(t){A.prototype.print.call(this,t),t.print(" "+this.ei[Ur.LEFT]+"/"+this.ei[Ur.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this.kn&&t.print(" inResult")},t.prototype.setMinEdgeRing=function(A){this.ri=A},t.prototype.isLineEdge=function(){var A=this.Qn.isLine(0)||this.Qn.isLine(1),t=!this.Qn.isArea(0)||this.Qn.allPositionsEqual(0,In.EXTERIOR),n=!this.Qn.isArea(1)||this.Qn.allPositionsEqual(1,In.EXTERIOR);return A&&t&&n},t.prototype.setEdgeRing=function(A){this.ii=A},t.prototype.getMinEdgeRing=function(){return this.ri},t.prototype.getDepthDelta=function(){var A=this.Vn.getDepthDelta();return this.$n||(A=-A),A},t.prototype.setInResult=function(A){this.kn=A},t.prototype.getSym=function(){return this.Ai},t.prototype.isForward=function(){return this.$n},t.prototype.getEdge=function(){return this.Vn},t.prototype.printEdge=function(A){this.print(A),A.print(" "),this.$n?this.Vn.print(A):this.Vn.printReverse(A)},t.prototype.setSym=function(A){this.Ai=A},t.prototype.setVisitedEdge=function(A){this.setVisited(A),this.Ai.setVisited(A)},t.prototype.setEdgeDepths=function(A,t){var n=this.getEdge().getDepthDelta();this.$n||(n=-n);var i=1;A===Ur.LEFT&&(i=-1);var r=Ur.opposite(A),e=t+n*i;this.setDepth(A,t),this.setDepth(r,e)},t.prototype.getEdgeRing=function(){return this.ii},t.prototype.isInResult=function(){return this.kn},t.prototype.setNext=function(A){this.ti=A},t.prototype.isVisited=function(){return this.Wn},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(A,t){return A===In.EXTERIOR&&t===In.INTERIOR?1:A===In.INTERIOR&&t===In.EXTERIOR?-1:0},t}(Xr),Ae=function(){};Ae.prototype.createNode=function(A){return new Hr(A,null)},Ae.prototype.interfaces_=function(){return[]},Ae.prototype.getClass=function(){return Ae};var te=function(){if(this.jn=new gi,this.Tn=null,this.si=new gi,0===arguments.length)this.Tn=new _r(new Ae);else if(1===arguments.length){var A=arguments[0];this.Tn=new _r(A)}};te.prototype.printEdges=function(A){A.println("Edges:");for(var t=0;t<this.jn.size();t++){A.println("edge "+t+":");var n=this.jn.get(t);n.print(A),n.eiList.print(A)}},te.prototype.find=function(A){return this.Tn.find(A)},te.prototype.addNode=function(){if(arguments[0]instanceof Hr){var A=arguments[0];return this.Tn.addNode(A)}if(arguments[0]instanceof Pn){var t=arguments[0];return this.Tn.addNode(t)}},te.prototype.getNodeIterator=function(){return this.Tn.iterator()},te.prototype.linkResultDirectedEdges=function(){for(var A=this.Tn.iterator();A.hasNext();)A.next().getEdges().linkResultDirectedEdges()},te.prototype.debugPrintln=function(A){Nn.out.println(A)},te.prototype.isBoundaryNode=function(A,t){var n=this.Tn.find(t);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(A)===In.BOUNDARY},te.prototype.linkAllDirectedEdges=function(){for(var A=this.Tn.iterator();A.hasNext();)A.next().getEdges().linkAllDirectedEdges()},te.prototype.matchInSameDirection=function(A,t,n,i){return!!A.equals(n)&&$n.computeOrientation(A,t,i)===$n.COLLINEAR&&Jr.quadrant(A,t)===Jr.quadrant(n,i)},te.prototype.getEdgeEnds=function(){return this.si},te.prototype.debugPrint=function(A){Nn.out.print(A)},te.prototype.getEdgeIterator=function(){return this.jn.iterator()},te.prototype.findEdgeInSameDirection=function(A,t){for(var n=0;n<this.jn.size();n++){var i=this.jn.get(n),r=i.getCoordinates();if(this.matchInSameDirection(A,t,r[0],r[1]))return i;if(this.matchInSameDirection(A,t,r[r.length-1],r[r.length-2]))return i}return null},te.prototype.insertEdge=function(A){this.jn.add(A)},te.prototype.findEdgeEnd=function(A){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===A)return n}return null},te.prototype.addEdges=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();this.jn.add(n);var i=new $r(n,!0),r=new $r(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}},te.prototype.add=function(A){this.Tn.add(A),this.si.add(A)},te.prototype.getNodes=function(){return this.Tn.values()},te.prototype.findEdge=function(A,t){for(var n=0;n<this.jn.size();n++){var i=this.jn.get(n),r=i.getCoordinates();if(A.equals(r[0])&&t.equals(r[1]))return i}return null},te.prototype.interfaces_=function(){return[]},te.prototype.getClass=function(){return te},te.linkResultDirectedEdges=function(A){for(var t=A.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()};var ne=function(){this.Rn=null,this.ui=new gi;var A=arguments[0];this.Rn=A};ne.prototype.sortShellsAndHoles=function(A,t,n){for(var i=A.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):t.add(r)}},ne.prototype.computePolygons=function(A){for(var t=new gi,n=A.iterator();n.hasNext();){var i=n.next().toPolygon(this.Rn);t.add(i)}return t},ne.prototype.placeFreeHoles=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();if(null===i.getShell()){var r=this.findEdgeRingContaining(i,A);if(null===r)throw new Br("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(r)}}},ne.prototype.buildMinimalEdgeRings=function(A,t,n){for(var i=new gi,r=A.iterator();r.hasNext();){var e=r.next();if(e.getMaxNodeDegree()>2){e.linkDirectedEdgesForMinimalEdgeRings();var s=e.buildMinimalRings(),u=this.findShell(s);null!==u?(this.placePolygonHoles(u,s),t.add(u)):n.addAll(s)}else i.add(e)}return i},ne.prototype.containsPoint=function(A){for(var t=this.ui.iterator();t.hasNext();)if(t.next().containsPoint(A))return!0;return!1},ne.prototype.buildMaximalEdgeRings=function(A){for(var t=new gi,n=A.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new Vr(i,this.Rn);t.add(r),r.setInResult()}}return t},ne.prototype.placePolygonHoles=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(A)}},ne.prototype.getPolygons=function(){return this.computePolygons(this.ui)},ne.prototype.findEdgeRingContaining=function(A,t){for(var n=A.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),e=null,s=null,u=t.iterator();u.hasNext();){var o=u.next(),h=o.getLinearRing(),f=h.getEnvelopeInternal();null!==e&&(s=e.getLinearRing().getEnvelopeInternal());var c=!1;f.contains(i)&&$n.isPointInRing(r,h.getCoordinates())&&(c=!0),c&&(null===e||s.contains(f))&&(e=o)}return e},ne.prototype.findShell=function(A){for(var t=0,n=null,i=A.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,t++)}return Kn.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n},ne.prototype.add=function(){if(1===arguments.length){var A=arguments[0];this.add(A.getEdgeEnds(),A.getNodes())}else if(2===arguments.length){var t=arguments[0],n=arguments[1];te.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(t),r=new gi,e=this.buildMinimalEdgeRings(i,this.ui,r);this.sortShellsAndHoles(e,this.ui,r),this.placeFreeHoles(this.ui,r)}},ne.prototype.interfaces_=function(){return[]},ne.prototype.getClass=function(){return ne};var ie=function(){};ie.prototype.getBounds=function(){},ie.prototype.interfaces_=function(){return[]},ie.prototype.getClass=function(){return ie};var re=function(){this.oi=null,this.hi=null;var A=arguments[0],t=arguments[1];this.oi=A,this.hi=t};re.prototype.getItem=function(){return this.hi},re.prototype.getBounds=function(){return this.oi},re.prototype.interfaces_=function(){return[ie,wn]},re.prototype.getClass=function(){return re};var ee=function(){this.fi=null,this.ci=null,this.fi=0,this.ci=new gi,this.ci.add(null)};ee.prototype.poll=function(){if(this.isEmpty())return null;var A=this.ci.get(1);return this.ci.set(1,this.ci.get(this.fi)),this.fi-=1,this.reorder(1),A},ee.prototype.size=function(){return this.fi},ee.prototype.reorder=function(A){for(var t=null,n=this.ci.get(A);2*A<=this.fi&&((t=2*A)!==this.fi&&this.ci.get(t+1).compareTo(this.ci.get(t))<0&&t++,this.ci.get(t).compareTo(n)<0);A=t)this.ci.set(A,this.ci.get(t));this.ci.set(A,n)},ee.prototype.clear=function(){this.fi=0,this.ci.clear()},ee.prototype.isEmpty=function(){return 0===this.fi},ee.prototype.add=function(A){this.ci.add(null),this.fi+=1;var t=this.fi;for(this.ci.set(0,A);A.compareTo(this.ci.get(Math.trunc(t/2)))<0;t/=2)this.ci.set(t,this.ci.get(Math.trunc(t/2)));this.ci.set(t,A)},ee.prototype.interfaces_=function(){return[]},ee.prototype.getClass=function(){return ee};var se=function(){};se.prototype.visitItem=function(A){},se.prototype.interfaces_=function(){return[]},se.prototype.getClass=function(){return se};var ue=function(){};ue.prototype.insert=function(A,t){},ue.prototype.remove=function(A,t){},ue.prototype.query=function(){},ue.prototype.interfaces_=function(){return[]},ue.prototype.getClass=function(){return ue};var oe=function(){if(this.ai=new gi,this.oi=null,this.vi=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.vi=A}},he={serialVersionUID:{configurable:!0}};oe.prototype.getLevel=function(){return this.vi},oe.prototype.size=function(){return this.ai.size()},oe.prototype.getChildBoundables=function(){return this.ai},oe.prototype.addChildBoundable=function(A){Kn.isTrue(null===this.oi),this.ai.add(A)},oe.prototype.isEmpty=function(){return this.ai.isEmpty()},oe.prototype.getBounds=function(){return null===this.oi&&(this.oi=this.computeBounds()),this.oi},oe.prototype.interfaces_=function(){return[ie,wn]},oe.prototype.getClass=function(){return oe},he.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(oe,he);var fe=function(){};fe.reverseOrder=function(){return{compare:function(A,t){return t.compareTo(A)}}},fe.min=function(A){return fe.sort(A),A.get(0)},fe.sort=function(A,t){var n=A.toArray();t?Ri.sort(n,t):Ri.sort(n);for(var i=A.iterator(),r=0,e=n.length;r<e;r++)i.next(),i.set(n[r])},fe.singletonList=function(A){var t=new gi;return t.add(A),t};var ce=function(){this.li=null,this.wi=null,this.Pi=null,this.gi=null;var A=arguments[0],t=arguments[1],n=arguments[2];this.li=A,this.wi=t,this.gi=n,this.Pi=this.distance()};ce.prototype.expandToQueue=function(A,t){var n=ce.isComposite(this.li),i=ce.isComposite(this.wi);if(n&&i)return ce.area(this.li)>ce.area(this.wi)?(this.expand(this.li,this.wi,A,t),null):(this.expand(this.wi,this.li,A,t),null);if(n)return this.expand(this.li,this.wi,A,t),null;if(i)return this.expand(this.wi,this.li,A,t),null;throw new hn("neither boundable is composite")},ce.prototype.isLeaves=function(){return!(ce.isComposite(this.li)||ce.isComposite(this.wi))},ce.prototype.compareTo=function(A){return this.Pi<A.Pi?-1:this.Pi>A.Pi?1:0},ce.prototype.expand=function(A,t,n,i){for(var r=A.getChildBoundables().iterator();r.hasNext();){var e=r.next(),s=new ce(e,t,this.gi);s.getDistance()<i&&n.add(s)}},ce.prototype.getBoundable=function(A){return 0===A?this.li:this.wi},ce.prototype.getDistance=function(){return this.Pi},ce.prototype.distance=function(){return this.isLeaves()?this.gi.distance(this.li,this.wi):this.li.getBounds().distance(this.wi.getBounds())},ce.prototype.interfaces_=function(){return[an]},ce.prototype.getClass=function(){return ce},ce.area=function(A){return A.getBounds().getArea()},ce.isComposite=function(A){return A instanceof oe};var ae=function A(){if(this.Ci=null,this.Di=!1,this.Ii=new gi,this.Mi=null,0===arguments.length){var t=A.DEFAULT_NODE_CAPACITY;this.Mi=t}else if(1===arguments.length){var n=arguments[0];Kn.isTrue(n>1,"Node capacity must be greater than 1"),this.Mi=n}},ve={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};ae.prototype.getNodeCapacity=function(){return this.Mi},ae.prototype.lastNode=function(A){return A.get(A.size()-1)},ae.prototype.size=function(){var A=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this.Ci));if(1===arguments.length){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof oe?n+=A.size(r):r instanceof re&&(n+=1)}return n}},ae.prototype.removeItem=function(A,t){for(var n=null,i=A.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof re&&r.getItem()===t&&(n=r)}return null!==n&&(A.getChildBoundables().remove(n),!0)},ae.prototype.itemsTree=function(){var A=this;if(0===arguments.length){this.build();var t=this.itemsTree(this.Ci);return null===t?new gi:t}if(1===arguments.length){for(var n=arguments[0],i=new gi,r=n.getChildBoundables().iterator();r.hasNext();){var e=r.next();if(e instanceof oe){var s=A.itemsTree(e);null!==s&&i.add(s)}else e instanceof re?i.add(e.getItem()):Kn.shouldNeverReachHere()}return i.size()<=0?null:i}},ae.prototype.insert=function(A,t){Kn.isTrue(!this.Di,"Cannot insert items into an STR packed R-tree after it has been built."),this.Ii.add(new re(A,t))},ae.prototype.boundablesAtLevel=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=new gi;return this.boundablesAtLevel(t,this.Ci,n),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];if(Kn.isTrue(i>-2),r.getLevel()===i)return e.add(r),null;for(var s=r.getChildBoundables().iterator();s.hasNext();){var u=s.next();u instanceof oe?A.boundablesAtLevel(i,u,e):(Kn.isTrue(u instanceof re),-1===i&&e.add(u))}return null}},ae.prototype.query=function(){var A=this;if(1===arguments.length){var t=arguments[0];this.build();var n=new gi;return this.isEmpty()||this.getIntersectsOp().intersects(this.Ci.getBounds(),t)&&this.query(t,this.Ci,n),n}if(2===arguments.length){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this.Ci.getBounds(),i)&&this.query(i,this.Ci,r)}else if(3===arguments.length)if(bn(arguments[2],se)&&arguments[0]instanceof Object&&arguments[1]instanceof oe)for(var e=arguments[0],s=arguments[1],u=arguments[2],o=s.getChildBoundables(),h=0;h<o.size();h++){var f=o.get(h);A.getIntersectsOp().intersects(f.getBounds(),e)&&(f instanceof oe?A.query(e,f,u):f instanceof re?u.visitItem(f.getItem()):Kn.shouldNeverReachHere())}else if(bn(arguments[2],wi)&&arguments[0]instanceof Object&&arguments[1]instanceof oe)for(var c=arguments[0],a=arguments[1],v=arguments[2],l=a.getChildBoundables(),w=0;w<l.size();w++){var P=l.get(w);A.getIntersectsOp().intersects(P.getBounds(),c)&&(P instanceof oe?A.query(c,P,v):P instanceof re?v.add(P.getItem()):Kn.shouldNeverReachHere())}},ae.prototype.build=function(){if(this.Di)return null;this.Ci=this.Ii.isEmpty()?this.createNode(0):this.createHigherLevels(this.Ii,-1),this.Ii=null,this.Di=!0},ae.prototype.getRoot=function(){return this.build(),this.Ci},ae.prototype.remove=function(){var A=this;if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this.Ci.getBounds(),t)&&this.remove(t,this.Ci,n)}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=this.removeItem(r,e);if(s)return!0;for(var u=null,o=r.getChildBoundables().iterator();o.hasNext();){var h=o.next();if(A.getIntersectsOp().intersects(h.getBounds(),i)&&h instanceof oe&&(s=A.remove(i,h,e))){u=h;break}}return null!==u&&u.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(u),s}},ae.prototype.createHigherLevels=function(A,t){Kn.isTrue(!A.isEmpty());var n=this.createParentBoundables(A,t+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,t+1)},ae.prototype.depth=function(){var A=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this.Ci));if(1===arguments.length){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof oe){var e=A.depth(r);e>n&&(n=e)}}return n+1}},ae.prototype.createParentBoundables=function(A,t){Kn.isTrue(!A.isEmpty());var n=new gi;n.add(this.createNode(t));var i=new gi(A);fe.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var e=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(e)}return n},ae.prototype.isEmpty=function(){return this.Di?this.Ci.isEmpty():this.Ii.isEmpty()},ae.prototype.interfaces_=function(){return[wn]},ae.prototype.getClass=function(){return ae},ae.compareDoubles=function(A,t){return A>t?1:A<t?-1:0},ve.IntersectsOp.get=function(){return le},ve.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},ve.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(ae,ve);var le=function(){},we=function(){};we.prototype.distance=function(A,t){},we.prototype.interfaces_=function(){return[]},we.prototype.getClass=function(){return we};var Pe=function(A){function t(n){A.call(this,n=n||t.DEFAULT_NODE_CAPACITY)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(A,t){Kn.isTrue(A.length>0);for(var n=new gi,i=0;i<A.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(A[i],t));return n},t.prototype.createNode=function(A){return new ge(A)},t.prototype.size=function(){return 0===arguments.length?A.prototype.size.call(this):A.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(2!==arguments.length)return A.prototype.insert.apply(this,arguments);var t=arguments[0],n=arguments[1];if(t.isNull())return null;A.prototype.insert.call(this,t,n)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(A,t){for(var n=Math.trunc(Math.ceil(A.size()/t)),i=new Array(t).fill(null),r=A.iterator(),e=0;e<t;e++){i[e]=new gi;for(var s=0;r.hasNext()&&s<n;){var u=r.next();i[e].add(u),s++}}return i},t.prototype.query=function(){if(1===arguments.length){var t=arguments[0];return A.prototype.query.call(this,t)}if(2===arguments.length){var n=arguments[0],i=arguments[1];A.prototype.query.call(this,n,i)}else if(3===arguments.length)if(bn(arguments[2],se)&&arguments[0]instanceof Object&&arguments[1]instanceof oe){var r=arguments[0],e=arguments[1],s=arguments[2];A.prototype.query.call(this,r,e,s)}else if(bn(arguments[2],wi)&&arguments[0]instanceof Object&&arguments[1]instanceof oe){var u=arguments[0],o=arguments[1],h=arguments[2];A.prototype.query.call(this,u,o,h)}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(t,n){return A.prototype.createParentBoundables.call(this,t,n)},t.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return A.prototype.remove.call(this,t,n)}return A.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return 0===arguments.length?A.prototype.depth.call(this):A.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(A,n){Kn.isTrue(!A.isEmpty());var i=Math.trunc(Math.ceil(A.size()/this.getNodeCapacity())),r=new gi(A);fe.sort(r,t.xComparator);var e=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(i))));return this.createParentBoundablesFromVerticalSlices(e,n)},t.prototype.nearestNeighbour=function(){if(1===arguments.length){if(bn(arguments[0],we)){var A=arguments[0],n=new ce(this.getRoot(),this.getRoot(),A);return this.nearestNeighbour(n)}if(arguments[0]instanceof ce){var i=arguments[0];return this.nearestNeighbour(i,fn.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof t&&bn(arguments[1],we)){var r=arguments[0],e=arguments[1],s=new ce(this.getRoot(),r.getRoot(),e);return this.nearestNeighbour(s)}if(arguments[0]instanceof ce&&"number"==typeof arguments[1]){var u=arguments[0],o=arguments[1],h=o,f=null,c=new ee;for(c.add(u);!c.isEmpty()&&h>0;){var a=c.poll(),v=a.getDistance();if(v>=h)break;a.isLeaves()?(h=v,f=a):a.expandToQueue(c,h)}return[f.getBoundable(0).getItem(),f.getBoundable(1).getItem()]}}else if(3===arguments.length){var l=arguments[0],w=arguments[1],P=arguments[2],g=new re(l,w),C=new ce(this.getRoot(),g,P);return this.nearestNeighbour(C)[0]}},t.prototype.interfaces_=function(){return[ue,wn]},t.prototype.getClass=function(){return t},t.centreX=function(A){return t.avg(A.getMinX(),A.getMaxX())},t.avg=function(A,t){return(A+t)/2},t.centreY=function(A){return t.avg(A.getMinY(),A.getMaxY())},n.STRtreeNode.get=function(){return ge},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[ln]},compare:function(n,i){return A.compareDoubles(t.centreX(n.getBounds()),t.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[ln]},compare:function(n,i){return A.compareDoubles(t.centreY(n.getBounds()),t.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[A.IntersectsOp]},intersects:function(A,t){return A.intersects(t)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(ae),ge=function(A){function t(){var t=arguments[0];A.call(this,t)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.computeBounds=function(){for(var A=null,t=this.getChildBoundables().iterator();t.hasNext();){var n=t.next();null===A?A=new Sn(n.getBounds()):A.expandToInclude(n.getBounds())}return A},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(oe),Ce=function(){};Ce.prototype.interfaces_=function(){return[]},Ce.prototype.getClass=function(){return Ce},Ce.relativeSign=function(A,t){return A<t?-1:A>t?1:0},Ce.compare=function(A,t,n){if(t.equals2D(n))return 0;var i=Ce.relativeSign(t.x,n.x),r=Ce.relativeSign(t.y,n.y);switch(A){case 0:return Ce.compareValue(i,r);case 1:return Ce.compareValue(r,i);case 2:return Ce.compareValue(r,-i);case 3:return Ce.compareValue(-i,r);case 4:return Ce.compareValue(-i,-r);case 5:return Ce.compareValue(-r,-i);case 6:return Ce.compareValue(-r,i);case 7:return Ce.compareValue(i,-r)}return Kn.shouldNeverReachHere("invalid octant value"),0},Ce.compareValue=function(A,t){return A<0?-1:A>0?1:t<0?-1:t>0?1:0};var De=function(){this.bi=null,this.coord=null,this.segmentIndex=null,this.zi=null,this.xi=null;var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.bi=A,this.coord=new Pn(t),this.segmentIndex=n,this.zi=i,this.xi=!t.equals2D(A.getCoordinate(n))};De.prototype.getCoordinate=function(){return this.coord},De.prototype.print=function(A){A.print(this.coord),A.print(" seg # = "+this.segmentIndex)},De.prototype.compareTo=function(A){var t=A;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:Ce.compare(this.zi,this.coord,t.coord)},De.prototype.isEndPoint=function(A){return 0===this.segmentIndex&&!this.xi||this.segmentIndex===A},De.prototype.isInterior=function(){return this.xi},De.prototype.interfaces_=function(){return[an]},De.prototype.getClass=function(){return De};var Ie=function(){this.di=new ji,this.Vn=null;var A=arguments[0];this.Vn=A};Ie.prototype.getSplitCoordinates=function(){var A=new Di;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next();this.addEdgeCoordinates(n,i,A),n=i}return A.toCoordinateArray()},Ie.prototype.addCollapsedNodes=function(){var A=new gi;this.findCollapsesFromInsertedNodes(A),this.findCollapsesFromExistingVertices(A);for(var t=A.iterator();t.hasNext();){var n=t.next().intValue();this.add(this.Vn.getCoordinate(n),n)}},Ie.prototype.print=function(A){A.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(A)},Ie.prototype.findCollapsesFromExistingVertices=function(A){for(var t=0;t<this.Vn.size()-2;t++){var n=this.Vn.getCoordinate(t),i=this.Vn.getCoordinate(t+2);n.equals2D(i)&&A.add(new yn(t+1))}},Ie.prototype.addEdgeCoordinates=function(A,t,n){var i=this.Vn.getCoordinate(t.segmentIndex),r=t.isInterior()||!t.coord.equals2D(i);n.add(new Pn(A.coord),!1);for(var e=A.segmentIndex+1;e<=t.segmentIndex;e++)n.add(this.Vn.getCoordinate(e));r&&n.add(new Pn(t.coord))},Ie.prototype.iterator=function(){return this.di.values().iterator()},Ie.prototype.addSplitEdges=function(A){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);A.add(r),n=i}},Ie.prototype.findCollapseIndex=function(A,t,n){if(!A.coord.equals2D(t.coord))return!1;var i=t.segmentIndex-A.segmentIndex;return t.isInterior()||i--,1===i&&(n[0]=A.segmentIndex+1,!0)},Ie.prototype.findCollapsesFromInsertedNodes=function(A){for(var t=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,t)&&A.add(new yn(t[0])),i=r}},Ie.prototype.getEdge=function(){return this.Vn},Ie.prototype.addEndpoints=function(){var A=this.Vn.size()-1;this.add(this.Vn.getCoordinate(0),0),this.add(this.Vn.getCoordinate(A),A)},Ie.prototype.createSplitEdge=function(A,t){var n=t.segmentIndex-A.segmentIndex+2,i=this.Vn.getCoordinate(t.segmentIndex),r=t.isInterior()||!t.coord.equals2D(i);r||n--;var e=new Array(n).fill(null),s=0;e[s++]=new Pn(A.coord);for(var u=A.segmentIndex+1;u<=t.segmentIndex;u++)e[s++]=this.Vn.getCoordinate(u);return r&&(e[s]=new Pn(t.coord)),new xe(e,this.Vn.getData())},Ie.prototype.add=function(A,t){var n=new De(this.Vn,A,t,this.Vn.getSegmentOctant(t)),i=this.di.get(n);return null!==i?(Kn.isTrue(i.coord.equals2D(A),"Found equal nodes with different coordinates"),i):(this.di.put(n,n),n)},Ie.prototype.checkSplitEdgesCorrectness=function(A){var t=this.Vn.getCoordinates(),n=A.get(0).getCoordinate(0);if(!n.equals2D(t[0]))throw new qn("bad split edge start point at "+n);var i=A.get(A.size()-1).getCoordinates(),r=i[i.length-1];if(!r.equals2D(t[t.length-1]))throw new qn("bad split edge end point at "+r)},Ie.prototype.interfaces_=function(){return[]},Ie.prototype.getClass=function(){return Ie};var Me=function(){};Me.prototype.interfaces_=function(){return[]},Me.prototype.getClass=function(){return Me},Me.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1];if(0===A&&0===t)throw new hn("Cannot compute the octant for point ( "+A+", "+t+" )");var n=Math.abs(A),i=Math.abs(t);return A>=0?t>=0?n>=i?0:1:n>=i?7:6:t>=0?n>=i?3:2:n>=i?4:5}if(arguments[0]instanceof Pn&&arguments[1]instanceof Pn){var r=arguments[0],e=arguments[1],s=e.x-r.x,u=e.y-r.y;if(0===s&&0===u)throw new hn("Cannot compute the octant for two identical points "+r);return Me.octant(s,u)}};var be=function(){};be.prototype.getCoordinates=function(){},be.prototype.size=function(){},be.prototype.getCoordinate=function(A){},be.prototype.isClosed=function(){},be.prototype.setData=function(A){},be.prototype.getData=function(){},be.prototype.interfaces_=function(){return[]},be.prototype.getClass=function(){return be};var ze=function(){};ze.prototype.addIntersection=function(A,t){},ze.prototype.interfaces_=function(){return[be]},ze.prototype.getClass=function(){return ze};var xe=function(){this.yi=new Ie(this),this.Nn=null,this.mi=null;var A=arguments[0],t=arguments[1];this.Nn=A,this.mi=t};xe.prototype.getCoordinates=function(){return this.Nn},xe.prototype.size=function(){return this.Nn.length},xe.prototype.getCoordinate=function(A){return this.Nn[A]},xe.prototype.isClosed=function(){return this.Nn[0].equals(this.Nn[this.Nn.length-1])},xe.prototype.getSegmentOctant=function(A){return A===this.Nn.length-1?-1:this.safeOctant(this.getCoordinate(A),this.getCoordinate(A+1))},xe.prototype.setData=function(A){this.mi=A},xe.prototype.safeOctant=function(A,t){return A.equals2D(t)?0:Me.octant(A,t)},xe.prototype.getData=function(){return this.mi},xe.prototype.addIntersection=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];this.addIntersectionNode(A,t)}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[3],e=new Pn(n.getIntersection(r));this.addIntersection(e,i)}},xe.prototype.toString=function(){return Wn.toLineString(new gr(this.Nn))},xe.prototype.getNodeList=function(){return this.yi},xe.prototype.addIntersectionNode=function(A,t){var n=t,i=n+1;i<this.Nn.length&&(A.equals2D(this.Nn[i])&&(n=i));return this.yi.add(A,n)},xe.prototype.addIntersections=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++)this.addIntersection(A,t,n,i)},xe.prototype.interfaces_=function(){return[ze]},xe.prototype.getClass=function(){return xe},xe.getNodedSubstrings=function(){if(1===arguments.length){var A=arguments[0],t=new gi;return xe.getNodedSubstrings(A,t),t}if(2===arguments.length)for(var n=arguments[0],i=arguments[1],r=n.iterator();r.hasNext();){var e=r.next();e.getNodeList().addSplitEdges(i)}};var de=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new Pn,this.p1=new Pn;else if(1===arguments.length){var A=arguments[0];this.p0=new Pn(A.p0),this.p1=new Pn(A.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];this.p0=new Pn(t,n),this.p1=new Pn(i,r)}},ye={serialVersionUID:{configurable:!0}};de.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},de.prototype.orientationIndex=function(){if(arguments[0]instanceof de){var A=arguments[0],t=$n.orientationIndex(this.p0,this.p1,A.p0),n=$n.orientationIndex(this.p0,this.p1,A.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}if(arguments[0]instanceof Pn){var i=arguments[0];return $n.orientationIndex(this.p0,this.p1,i)}},de.prototype.toGeometry=function(A){return A.createLineString([this.p0,this.p1])},de.prototype.isVertical=function(){return this.p0.x===this.p1.x},de.prototype.equals=function(A){if(!(A instanceof de))return!1;var t=A;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)},de.prototype.intersection=function(A){var t=new Jn;return t.computeIntersection(this.p0,this.p1,A.p0,A.p1),t.hasIntersection()?t.getIntersection(0):null},de.prototype.project=function(){if(arguments[0]instanceof Pn){var A=arguments[0];if(A.equals(this.p0)||A.equals(this.p1))return new Pn(A);var t=this.projectionFactor(A),n=new Pn;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof de){var i=arguments[0],r=this.projectionFactor(i.p0),e=this.projectionFactor(i.p1);if(r>=1&&e>=1)return null;if(r<=0&&e<=0)return null;var s=this.project(i.p0);r<0&&(s=this.p0),r>1&&(s=this.p1);var u=this.project(i.p1);return e<0&&(u=this.p0),e>1&&(u=this.p1),new de(s,u)}},de.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},de.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},de.prototype.getCoordinate=function(A){return 0===A?this.p0:this.p1},de.prototype.distancePerpendicular=function(A){return $n.distancePointLinePerpendicular(A,this.p0,this.p1)},de.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},de.prototype.midPoint=function(){return de.midPoint(this.p0,this.p1)},de.prototype.projectionFactor=function(A){if(A.equals(this.p0))return 0;if(A.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=t*t+n*n;return i<=0?fn.NaN:((A.x-this.p0.x)*t+(A.y-this.p0.y)*n)/i},de.prototype.closestPoints=function(A){var t=this.intersection(A);if(null!==t)return[t,t];var n=new Array(2).fill(null),i=fn.MAX_VALUE,r=null,e=this.closestPoint(A.p0);i=e.distance(A.p0),n[0]=e,n[1]=A.p0;var s=this.closestPoint(A.p1);(r=s.distance(A.p1))<i&&(i=r,n[0]=s,n[1]=A.p1);var u=A.closestPoint(this.p0);(r=u.distance(this.p0))<i&&(i=r,n[0]=this.p0,n[1]=u);var o=A.closestPoint(this.p1);return(r=o.distance(this.p1))<i&&(i=r,n[0]=this.p1,n[1]=o),n},de.prototype.closestPoint=function(A){var t=this.projectionFactor(A);return t>0&&t<1?this.project(A):this.p0.distance(A)<this.p1.distance(A)?this.p0:this.p1},de.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},de.prototype.getLength=function(){return this.p0.distance(this.p1)},de.prototype.compareTo=function(A){var t=A,n=this.p0.compareTo(t.p0);return 0!==n?n:this.p1.compareTo(t.p1)},de.prototype.reverse=function(){var A=this.p0;this.p0=this.p1,this.p1=A},de.prototype.equalsTopo=function(A){return this.p0.equals(A.p0)&&(this.p1.equals(A.p1)||this.p0.equals(A.p1))&&this.p1.equals(A.p0)},de.prototype.lineIntersection=function(A){try{return Qn.intersection(this.p0,this.p1,A.p0,A.p1)}catch(A){if(!(A instanceof jn))throw A}return null},de.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},de.prototype.pointAlongOffset=function(A,t){var n=this.p0.x+A*(this.p1.x-this.p0.x),i=this.p0.y+A*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,e=this.p1.y-this.p0.y,s=Math.sqrt(r*r+e*e),u=0,o=0;if(0!==t){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");u=t*r/s,o=t*e/s}return new Pn(n-o,i+u)},de.prototype.setCoordinates=function(){if(1===arguments.length){var A=arguments[0];this.setCoordinates(A.p0,A.p1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}},de.prototype.segmentFraction=function(A){var t=this.projectionFactor(A);return t<0?t=0:(t>1||fn.isNaN(t))&&(t=1),t},de.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},de.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},de.prototype.distance=function(){if(arguments[0]instanceof de){var A=arguments[0];return $n.distanceLineLine(this.p0,this.p1,A.p0,A.p1)}if(arguments[0]instanceof Pn){var t=arguments[0];return $n.distancePointLine(t,this.p0,this.p1)}},de.prototype.pointAlong=function(A){var t=new Pn;return t.x=this.p0.x+A*(this.p1.x-this.p0.x),t.y=this.p0.y+A*(this.p1.y-this.p0.y),t},de.prototype.hashCode=function(){var A=fn.doubleToLongBits(this.p0.x);A^=31*fn.doubleToLongBits(this.p0.y);var t=Math.trunc(A)^Math.trunc(A>>32),n=fn.doubleToLongBits(this.p1.x);return n^=31*fn.doubleToLongBits(this.p1.y),t^Math.trunc(n)^Math.trunc(n>>32)},de.prototype.interfaces_=function(){return[an,wn]},de.prototype.getClass=function(){return de},de.midPoint=function(A,t){return new Pn((A.x+t.x)/2,(A.y+t.y)/2)},ye.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(de,ye);var me=function(){this.tempEnv1=new Sn,this.tempEnv2=new Sn,this.pi=new de,this.Li=new de};me.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];A.getLineSegment(t,this.pi),n.getLineSegment(i,this.Li),this.overlap(this.pi,this.Li)}},me.prototype.interfaces_=function(){return[]},me.prototype.getClass=function(){return me};var pe=function(){this.Nn=null,this.Ti=null,this.Oi=null,this.Fn=null,this.Fi=null,this.Ei=null;var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.Nn=A,this.Ti=t,this.Oi=n,this.Fi=i};pe.prototype.getLineSegment=function(A,t){t.p0=this.Nn[A],t.p1=this.Nn[A+1]},pe.prototype.computeSelect=function(A,t,n,i){if(i.tempEnv1.init(this.Nn[t],this.Nn[n]),n-t==1)return i.select(this,t),null;if(!A.intersects(i.tempEnv1))return null;var s=Math.trunc((t+n)/2);t<s&&this.computeSelect(A,t,s,i),s<n&&this.computeSelect(A,s,n,i)},pe.prototype.getCoordinates=function(){for(var A=new Array(this.Oi-this.Ti+1).fill(null),t=0,n=this.Ti;n<=this.Oi;n++)A[t++]=this.Nn[n];return A},pe.prototype.computeOverlaps=function(A,t){this.computeOverlapsInternal(this.Ti,this.Oi,A,A.Ti,A.Oi,t)},pe.prototype.setId=function(A){this.Ei=A},pe.prototype.select=function(A,t){this.computeSelect(A,this.Ti,this.Oi,t)},pe.prototype.getEnvelope=function(){null===this.Fn&&(this.Fn=new Sn(this.Nn[this.Ti],this.Nn[this.Oi]));return this.Fn},pe.prototype.getEndIndex=function(){return this.Oi},pe.prototype.getStartIndex=function(){return this.Ti},pe.prototype.getContext=function(){return this.Fi},pe.prototype.getId=function(){return this.Ei},pe.prototype.computeOverlapsInternal=function(A,t,n,i,r,e){var s=this.Nn[A],u=this.Nn[t],o=n.Nn[i],h=n.Nn[r];if(t-A==1&&r-i==1)return e.overlap(this,A,n,i),null;if(e.tempEnv1.init(s,u),e.tempEnv2.init(o,h),!e.tempEnv1.intersects(e.tempEnv2))return null;var f=Math.trunc((A+t)/2),c=Math.trunc((i+r)/2);A<f&&(i<c&&this.computeOverlapsInternal(A,f,n,i,c,e),c<r&&this.computeOverlapsInternal(A,f,n,c,r,e)),f<t&&(i<c&&this.computeOverlapsInternal(f,t,n,i,c,e),c<r&&this.computeOverlapsInternal(f,t,n,c,r,e))},pe.prototype.interfaces_=function(){return[]},pe.prototype.getClass=function(){return pe};var Le=function(){};Le.prototype.interfaces_=function(){return[]},Le.prototype.getClass=function(){return Le},Le.getChainStartIndices=function(A){var t=0,n=new gi;n.add(new yn(t));do{var i=Le.findChainEnd(A,t);n.add(new yn(i)),t=i}while(t<A.length-1);return Le.toIntArray(n)},Le.findChainEnd=function(A,t){for(var n=t;n<A.length-1&&A[n].equals2D(A[n+1]);)n++;if(n>=A.length-1)return A.length-1;for(var i=Jr.quadrant(A[n],A[n+1]),r=t+1;r<A.length&&(A[r-1].equals2D(A[r])||Jr.quadrant(A[r-1],A[r])===i);)r++;return r-1},Le.getChains=function(){if(1===arguments.length){var A=arguments[0];return Le.getChains(A,null)}if(2===arguments.length){for(var t=arguments[0],n=arguments[1],i=new gi,r=Le.getChainStartIndices(t),e=0;e<r.length-1;e++){var s=new pe(t,r[e],r[e+1],n);i.add(s)}return i}},Le.toIntArray=function(A){for(var t=new Array(A.size()).fill(null),n=0;n<t.length;n++)t[n]=A.get(n).intValue();return t};var Te=function(){};Te.prototype.computeNodes=function(A){},Te.prototype.getNodedSubstrings=function(){},Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te};var Oe=function(){if(this.Ui=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.setSegmentIntersector(A)}};Oe.prototype.setSegmentIntersector=function(A){this.Ui=A},Oe.prototype.interfaces_=function(){return[Te]},Oe.prototype.getClass=function(){return Oe};var Fe=function(A){function t(t){t?A.call(this,t):A.call(this),this.ji=new gi,this.Ni=new Pe,this.Qi=0,this.Si=null,this.Bi=0}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this.ji},t.prototype.getNodedSubstrings=function(){return xe.getNodedSubstrings(this.Si)},t.prototype.getIndex=function(){return this.Ni},t.prototype.add=function(A){for(var t=Le.getChains(A.getCoordinates(),A).iterator();t.hasNext();){var n=t.next();n.setId(this.Qi++),this.Ni.insert(n.getEnvelope(),n),this.ji.add(n)}},t.prototype.computeNodes=function(A){this.Si=A;for(var t=A.iterator();t.hasNext();)this.add(t.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var A=new Ee(this.Ui),t=this.ji.iterator();t.hasNext();)for(var n=t.next(),i=this.Ni.query(n.getEnvelope()).iterator();i.hasNext();){var r=i.next();if(r.getId()>n.getId()&&(n.computeOverlaps(r,A),this.Bi++),this.Ui.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return Ee},Object.defineProperties(t,n),t}(Oe),Ee=function(A){function t(){A.call(this),this.Ri=null;var t=arguments[0];this.Ri=t}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.overlap=function(){if(4!==arguments.length)return A.prototype.overlap.apply(this,arguments);var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3],e=t.getContext(),s=i.getContext();this.Ri.processIntersections(e,n,s,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(me),Ue=function A(){if(this.ki=A.DEFAULT_QUADRANT_SEGMENTS,this.Gi=A.CAP_ROUND,this.Yi=A.JOIN_ROUND,this.Wi=A.DEFAULT_MITRE_LIMIT,this.qi=!1,this.Vi=A.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(e),this.setJoinStyle(s),this.setMitreLimit(u)}},je={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Ue.prototype.getEndCapStyle=function(){return this.Gi},Ue.prototype.isSingleSided=function(){return this.qi},Ue.prototype.setQuadrantSegments=function(A){this.ki=A,0===this.ki&&(this.Yi=Ue.JOIN_BEVEL),this.ki<0&&(this.Yi=Ue.JOIN_MITRE,this.Wi=Math.abs(this.ki)),A<=0&&(this.ki=1),this.Yi!==Ue.JOIN_ROUND&&(this.ki=Ue.DEFAULT_QUADRANT_SEGMENTS)},Ue.prototype.getJoinStyle=function(){return this.Yi},Ue.prototype.setJoinStyle=function(A){this.Yi=A},Ue.prototype.setSimplifyFactor=function(A){this.Vi=A<0?0:A},Ue.prototype.getSimplifyFactor=function(){return this.Vi},Ue.prototype.getQuadrantSegments=function(){return this.ki},Ue.prototype.setEndCapStyle=function(A){this.Gi=A},Ue.prototype.getMitreLimit=function(){return this.Wi},Ue.prototype.setMitreLimit=function(A){this.Wi=A},Ue.prototype.setSingleSided=function(A){this.qi=A},Ue.prototype.interfaces_=function(){return[]},Ue.prototype.getClass=function(){return Ue},Ue.bufferDistanceError=function(A){var t=Math.PI/2/A;return 1-Math.cos(t/2)},je.CAP_ROUND.get=function(){return 1},je.CAP_FLAT.get=function(){return 2},je.CAP_SQUARE.get=function(){return 3},je.JOIN_ROUND.get=function(){return 1},je.JOIN_MITRE.get=function(){return 2},je.JOIN_BEVEL.get=function(){return 3},je.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},je.DEFAULT_MITRE_LIMIT.get=function(){return 5},je.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Ue,je);var Ne=function(A){this.Ki=null,this.Hi=null,this._i=$n.COUNTERCLOCKWISE,this.Ji=A||null},Qe={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ne.prototype.isDeletable=function(A,t,n,i){var r=this.Ji[A],e=this.Ji[t],s=this.Ji[n];return!!this.isConcave(r,e,s)&&!!this.isShallow(r,e,s,i)&&this.isShallowSampled(r,e,A,n,i)},Ne.prototype.deleteShallowConcavities=function(){for(var A=1,t=this.findNextNonDeletedIndex(A),n=this.findNextNonDeletedIndex(t),i=!1;n<this.Ji.length;){var r=!1;this.isDeletable(A,t,n,this.Ki)&&(this.Hi[t]=Ne.DELETE,r=!0,i=!0),t=this.findNextNonDeletedIndex(A=r?n:t),n=this.findNextNonDeletedIndex(t)}return i},Ne.prototype.isShallowConcavity=function(A,t,n,i){return $n.computeOrientation(A,t,n)===this._i&&$n.distancePointLine(t,A,n)<i},Ne.prototype.isShallowSampled=function(A,t,n,i,r){var e=Math.trunc((i-n)/Ne.NUM_PTS_TO_CHECK);e<=0&&(e=1);for(var s=n;s<i;s+=e)if(!this.isShallow(A,t,this.Ji[s],r))return!1;return!0},Ne.prototype.isConcave=function(A,t,n){return $n.computeOrientation(A,t,n)===this._i},Ne.prototype.simplify=function(A){this.Ki=Math.abs(A),A<0&&(this._i=$n.CLOCKWISE),this.Hi=new Array(this.Ji.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()},Ne.prototype.findNextNonDeletedIndex=function(A){for(var t=A+1;t<this.Ji.length&&this.Hi[t]===Ne.DELETE;)t++;return t},Ne.prototype.isShallow=function(A,t,n,i){return $n.distancePointLine(t,A,n)<i},Ne.prototype.collapseLine=function(){for(var A=new Di,t=0;t<this.Ji.length;t++)this.Hi[t]!==Ne.DELETE&&A.add(this.Ji[t]);return A.toCoordinateArray()},Ne.prototype.interfaces_=function(){return[]},Ne.prototype.getClass=function(){return Ne},Ne.simplify=function(A,t){return new Ne(A).simplify(t)},Qe.INIT.get=function(){return 0},Qe.DELETE.get=function(){return 1},Qe.KEEP.get=function(){return 1},Qe.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ne,Qe);var Se=function(){this.Zi=null,this.en=null,this.Xi=0,this.Zi=new gi},Be={COORDINATE_ARRAY_TYPE:{configurable:!0}};Se.prototype.getCoordinates=function(){return this.Zi.toArray(Se.COORDINATE_ARRAY_TYPE)},Se.prototype.setPrecisionModel=function(A){this.en=A},Se.prototype.addPt=function(A){var t=new Pn(A);if(this.en.makePrecise(t),this.isRedundant(t))return null;this.Zi.add(t)},Se.prototype.revere=function(){},Se.prototype.addPts=function(A,t){if(t)for(var n=0;n<A.length;n++)this.addPt(A[n]);else for(var i=A.length-1;i>=0;i--)this.addPt(A[i])},Se.prototype.isRedundant=function(A){if(this.Zi.size()<1)return!1;var t=this.Zi.get(this.Zi.size()-1);return A.distance(t)<this.Xi},Se.prototype.toString=function(){return(new yr).createLineString(this.getCoordinates()).toString()},Se.prototype.closeRing=function(){if(this.Zi.size()<1)return null;var A=new Pn(this.Zi.get(0)),t=this.Zi.get(this.Zi.size()-1);if(A.equals(t))return null;this.Zi.add(A)},Se.prototype.setMinimumVertexDistance=function(A){this.Xi=A},Se.prototype.interfaces_=function(){return[]},Se.prototype.getClass=function(){return Se},Be.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Se,Be);var Re=function(){},ke={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Re.prototype.interfaces_=function(){return[]},Re.prototype.getClass=function(){return Re},Re.toDegrees=function(A){return 180*A/Math.PI},Re.normalize=function(A){for(;A>Math.PI;)A-=Re.PI_TIMES_2;for(;A<=-Math.PI;)A+=Re.PI_TIMES_2;return A},Re.angle=function(){if(1===arguments.length){var A=arguments[0];return Math.atan2(A.y,A.x)}if(2===arguments.length){var t=arguments[0],n=arguments[1],i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)}},Re.isAcute=function(A,t,n){return(A.x-t.x)*(n.x-t.x)+(A.y-t.y)*(n.y-t.y)>0},Re.isObtuse=function(A,t,n){return(A.x-t.x)*(n.x-t.x)+(A.y-t.y)*(n.y-t.y)<0},Re.interiorAngle=function(A,t,n){var i=Re.angle(t,A),r=Re.angle(t,n);return Math.abs(r-i)},Re.normalizePositive=function(A){if(A<0){for(;A<0;)A+=Re.PI_TIMES_2;A>=Re.PI_TIMES_2&&(A=0)}else{for(;A>=Re.PI_TIMES_2;)A-=Re.PI_TIMES_2;A<0&&(A=0)}return A},Re.angleBetween=function(A,t,n){var i=Re.angle(t,A),r=Re.angle(t,n);return Re.diff(i,r)},Re.diff=function(A,t){var n=null;return(n=A<t?t-A:A-t)>Math.PI&&(n=2*Math.PI-n),n},Re.toRadians=function(A){return A*Math.PI/180},Re.getTurn=function(A,t){var n=Math.sin(t-A);return n>0?Re.COUNTERCLOCKWISE:n<0?Re.CLOCKWISE:Re.NONE},Re.angleBetweenOriented=function(A,t,n){var i=Re.angle(t,A),r=Re.angle(t,n)-i;return r<=-Math.PI?r+Re.PI_TIMES_2:r>Math.PI?r-Re.PI_TIMES_2:r},ke.PI_TIMES_2.get=function(){return 2*Math.PI},ke.PI_OVER_2.get=function(){return Math.PI/2},ke.PI_OVER_4.get=function(){return Math.PI/4},ke.COUNTERCLOCKWISE.get=function(){return $n.COUNTERCLOCKWISE},ke.CLOCKWISE.get=function(){return $n.CLOCKWISE},ke.NONE.get=function(){return $n.COLLINEAR},Object.defineProperties(Re,ke);var Ge=function A(){this.$i=0,this.Ar=null,this.tr=1,this.nr=null,this.Pi=0,this.en=null,this.ir=null,this.rr=null,this.er=null,this.sr=null,this.ur=null,this.or=new de,this.hr=new de,this.cr=new de,this.ar=new de,this.vr=0,this.lr=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this.en=t,this.ir=n,this.rr=new Jn,this.Ar=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Ue.JOIN_ROUND&&(this.tr=A.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)},Ye={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Ge.prototype.addNextSegment=function(A,t){if(this.er=this.sr,this.sr=this.ur,this.ur=A,this.or.setCoordinates(this.er,this.sr),this.computeOffsetSegment(this.or,this.vr,this.Pi,this.cr),this.hr.setCoordinates(this.sr,this.ur),this.computeOffsetSegment(this.hr,this.vr,this.Pi,this.ar),this.sr.equals(this.ur))return null;var n=$n.computeOrientation(this.er,this.sr,this.ur),i=n===$n.CLOCKWISE&&this.vr===Ur.LEFT||n===$n.COUNTERCLOCKWISE&&this.vr===Ur.RIGHT;0===n?this.addCollinear(t):i?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)},Ge.prototype.addLineEndCap=function(A,t){var n=new de(A,t),i=new de;this.computeOffsetSegment(n,Ur.LEFT,this.Pi,i);var r=new de;this.computeOffsetSegment(n,Ur.RIGHT,this.Pi,r);var u=Math.atan2(t.y-A.y,t.x-A.x);switch(this.ir.getEndCapStyle()){case Ue.CAP_ROUND:this.nr.addPt(i.p1),this.addFilletArc(t,u+Math.PI/2,u-Math.PI/2,$n.CLOCKWISE,this.Pi),this.nr.addPt(r.p1);break;case Ue.CAP_FLAT:this.nr.addPt(i.p1),this.nr.addPt(r.p1);break;case Ue.CAP_SQUARE:var o=new Pn;o.x=Math.abs(this.Pi)*Math.cos(u),o.y=Math.abs(this.Pi)*Math.sin(u);var h=new Pn(i.p1.x+o.x,i.p1.y+o.y),f=new Pn(r.p1.x+o.x,r.p1.y+o.y);this.nr.addPt(h),this.nr.addPt(f)}},Ge.prototype.getCoordinates=function(){return this.nr.getCoordinates()},Ge.prototype.addMitreJoin=function(A,t,n,i){var r=!0,e=null;try{e=Qn.intersection(t.p0,t.p1,n.p0,n.p1),(i<=0?1:e.distance(A)/Math.abs(i))>this.ir.getMitreLimit()&&(r=!1)}catch(A){if(!(A instanceof jn))throw A;e=new Pn(0,0),r=!1}r?this.nr.addPt(e):this.addLimitedMitreJoin(t,n,i,this.ir.getMitreLimit())},Ge.prototype.addFilletCorner=function(A,t,n,i,r){var u=Math.atan2(t.y-A.y,t.x-A.x),f=Math.atan2(n.y-A.y,n.x-A.x);i===$n.CLOCKWISE?u<=f&&(u+=2*Math.PI):u>=f&&(u-=2*Math.PI),this.nr.addPt(t),this.addFilletArc(A,u,f,i,r),this.nr.addPt(n)},Ge.prototype.addOutsideTurn=function(A,t){if(this.cr.p1.distance(this.ar.p0)<this.Pi*Ge.OFFSET_SEGMENT_SEPARATION_FACTOR)return this.nr.addPt(this.cr.p1),null;this.ir.getJoinStyle()===Ue.JOIN_MITRE?this.addMitreJoin(this.sr,this.cr,this.ar,this.Pi):this.ir.getJoinStyle()===Ue.JOIN_BEVEL?this.addBevelJoin(this.cr,this.ar):(t&&this.nr.addPt(this.cr.p1),this.addFilletCorner(this.sr,this.cr.p1,this.ar.p0,A,this.Pi),this.nr.addPt(this.ar.p0))},Ge.prototype.createSquare=function(A){this.nr.addPt(new Pn(A.x+this.Pi,A.y+this.Pi)),this.nr.addPt(new Pn(A.x+this.Pi,A.y-this.Pi)),this.nr.addPt(new Pn(A.x-this.Pi,A.y-this.Pi)),this.nr.addPt(new Pn(A.x-this.Pi,A.y+this.Pi)),this.nr.closeRing()},Ge.prototype.addSegments=function(A,t){this.nr.addPts(A,t)},Ge.prototype.addFirstSegment=function(){this.nr.addPt(this.ar.p0)},Ge.prototype.addLastSegment=function(){this.nr.addPt(this.ar.p1)},Ge.prototype.initSideSegments=function(A,t,n){this.sr=A,this.ur=t,this.vr=n,this.hr.setCoordinates(A,t),this.computeOffsetSegment(this.hr,n,this.Pi,this.ar)},Ge.prototype.addLimitedMitreJoin=function(A,t,n,i){var r=this.or.p1,e=Re.angle(r,this.or.p0),s=Re.angleBetweenOriented(this.or.p0,r,this.hr.p1)/2,u=Re.normalize(e+s),o=Re.normalize(u+Math.PI),h=i*n,f=n-h*Math.abs(Math.sin(s)),c=r.x+h*Math.cos(o),a=r.y+h*Math.sin(o),v=new Pn(c,a),l=new de(r,v),w=l.pointAlongOffset(1,f),P=l.pointAlongOffset(1,-f);this.vr===Ur.LEFT?(this.nr.addPt(w),this.nr.addPt(P)):(this.nr.addPt(P),this.nr.addPt(w))},Ge.prototype.computeOffsetSegment=function(A,t,n,i){var r=t===Ur.LEFT?1:-1,e=A.p1.x-A.p0.x,s=A.p1.y-A.p0.y,u=Math.sqrt(e*e+s*s),o=r*n*e/u,h=r*n*s/u;i.p0.x=A.p0.x-h,i.p0.y=A.p0.y+o,i.p1.x=A.p1.x-h,i.p1.y=A.p1.y+o},Ge.prototype.addFilletArc=function(A,t,n,i,r){var e=i===$n.CLOCKWISE?-1:1,s=Math.abs(t-n),u=Math.trunc(s/this.Ar+.5);if(u<1)return null;for(var o=s/u,h=0,f=new Pn;h<s;){var c=t+e*h;f.x=A.x+r*Math.cos(c),f.y=A.y+r*Math.sin(c),this.nr.addPt(f),h+=o}},Ge.prototype.addInsideTurn=function(A,t){if(this.rr.computeIntersection(this.cr.p0,this.cr.p1,this.ar.p0,this.ar.p1),this.rr.hasIntersection())this.nr.addPt(this.rr.getIntersection(0));else if(this.lr=!0,this.cr.p1.distance(this.ar.p0)<this.Pi*Ge.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.nr.addPt(this.cr.p1);else{if(this.nr.addPt(this.cr.p1),this.tr>0){var n=new Pn((this.tr*this.cr.p1.x+this.sr.x)/(this.tr+1),(this.tr*this.cr.p1.y+this.sr.y)/(this.tr+1));this.nr.addPt(n);var i=new Pn((this.tr*this.ar.p0.x+this.sr.x)/(this.tr+1),(this.tr*this.ar.p0.y+this.sr.y)/(this.tr+1));this.nr.addPt(i)}else this.nr.addPt(this.sr);this.nr.addPt(this.ar.p0)}},Ge.prototype.createCircle=function(A){var t=new Pn(A.x+this.Pi,A.y);this.nr.addPt(t),this.addFilletArc(A,0,2*Math.PI,-1,this.Pi),this.nr.closeRing()},Ge.prototype.addBevelJoin=function(A,t){this.nr.addPt(A.p1),this.nr.addPt(t.p0)},Ge.prototype.init=function(A){this.Pi=A,this.$i=A*(1-Math.cos(this.Ar/2)),this.nr=new Se,this.nr.setPrecisionModel(this.en),this.nr.setMinimumVertexDistance(A*Ge.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Ge.prototype.addCollinear=function(A){this.rr.computeIntersection(this.er,this.sr,this.sr,this.ur),this.rr.getIntersectionNum()>=2&&(this.ir.getJoinStyle()===Ue.JOIN_BEVEL||this.ir.getJoinStyle()===Ue.JOIN_MITRE?(A&&this.nr.addPt(this.cr.p1),this.nr.addPt(this.ar.p0)):this.addFilletCorner(this.sr,this.cr.p1,this.ar.p0,$n.CLOCKWISE,this.Pi))},Ge.prototype.closeRing=function(){this.nr.closeRing()},Ge.prototype.hasNarrowConcaveAngle=function(){return this.lr},Ge.prototype.interfaces_=function(){return[]},Ge.prototype.getClass=function(){return Ge},Ye.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Ye.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Ye.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Ye.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Ge,Ye);var We=function(){this.Pi=0,this.en=null,this.ir=null;var A=arguments[0],t=arguments[1];this.en=A,this.ir=t};We.prototype.getOffsetCurve=function(A,t){if(this.Pi=t,0===t)return null;var n=t<0,i=Math.abs(t),r=this.getSegGen(i);A.length<=1?this.computePointCurve(A[0],r):this.computeOffsetCurve(A,n,r);var e=r.getCoordinates();return n&&Ii.reverse(e),e},We.prototype.computeSingleSidedBufferCurve=function(A,t,n){var i=this.simplifyTolerance(this.Pi);if(t){n.addSegments(A,!0);var r=Ne.simplify(A,-i),e=r.length-1;n.initSideSegments(r[e],r[e-1],Ur.LEFT),n.addFirstSegment();for(var s=e-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{n.addSegments(A,!1);var u=Ne.simplify(A,i),o=u.length-1;n.initSideSegments(u[0],u[1],Ur.LEFT),n.addFirstSegment();for(var h=2;h<=o;h++)n.addNextSegment(u[h],!0)}n.addLastSegment(),n.closeRing()},We.prototype.computeRingBufferCurve=function(A,t,n){var i=this.simplifyTolerance(this.Pi);t===Ur.RIGHT&&(i=-i);var r=Ne.simplify(A,i),e=r.length-1;n.initSideSegments(r[e-1],r[0],t);for(var s=1;s<=e;s++){n.addNextSegment(r[s],1!==s)}n.closeRing()},We.prototype.computeLineBufferCurve=function(A,t){var n=this.simplifyTolerance(this.Pi),i=Ne.simplify(A,n),r=i.length-1;t.initSideSegments(i[0],i[1],Ur.LEFT);for(var e=2;e<=r;e++)t.addNextSegment(i[e],!0);t.addLastSegment(),t.addLineEndCap(i[r-1],i[r]);var s=Ne.simplify(A,-n),u=s.length-1;t.initSideSegments(s[u],s[u-1],Ur.LEFT);for(var o=u-2;o>=0;o--)t.addNextSegment(s[o],!0);t.addLastSegment(),t.addLineEndCap(s[1],s[0]),t.closeRing()},We.prototype.computePointCurve=function(A,t){switch(this.ir.getEndCapStyle()){case Ue.CAP_ROUND:t.createCircle(A);break;case Ue.CAP_SQUARE:t.createSquare(A)}},We.prototype.getLineCurve=function(A,t){if(this.Pi=t,t<0&&!this.ir.isSingleSided())return null;if(0===t)return null;var n=Math.abs(t),i=this.getSegGen(n);if(A.length<=1)this.computePointCurve(A[0],i);else if(this.ir.isSingleSided()){this.computeSingleSidedBufferCurve(A,t<0,i)}else this.computeLineBufferCurve(A,i);return i.getCoordinates()},We.prototype.getBufferParameters=function(){return this.ir},We.prototype.simplifyTolerance=function(A){return A*this.ir.getSimplifyFactor()},We.prototype.getRingCurve=function(A,t,n){if(this.Pi=n,A.length<=2)return this.getLineCurve(A,n);if(0===n)return We.copyCoordinates(A);var i=this.getSegGen(n);return this.computeRingBufferCurve(A,t,i),i.getCoordinates()},We.prototype.computeOffsetCurve=function(A,t,n){var i=this.simplifyTolerance(this.Pi);if(t){var r=Ne.simplify(A,-i),e=r.length-1;n.initSideSegments(r[e],r[e-1],Ur.LEFT),n.addFirstSegment();for(var s=e-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{var u=Ne.simplify(A,i),o=u.length-1;n.initSideSegments(u[0],u[1],Ur.LEFT),n.addFirstSegment();for(var h=2;h<=o;h++)n.addNextSegment(u[h],!0)}n.addLastSegment()},We.prototype.getSegGen=function(A){return new Ge(this.en,this.ir,A)},We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We},We.copyCoordinates=function(A){for(var t=new Array(A.length).fill(null),n=0;n<t.length;n++)t[n]=new Pn(A[n]);return t};var qe=function(){this.wr=null,this.Pr=new de,this.gr=new $n;var A=arguments[0];this.wr=A},Ve={DepthSegment:{configurable:!0}};qe.prototype.findStabbedSegments=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=new gi,i=this.wr.iterator();i.hasNext();){var r=i.next(),e=r.getEnvelope();t.y<e.getMinY()||t.y>e.getMaxY()||A.findStabbedSegments(t,r.getDirectedEdges(),n)}return n}if(3===arguments.length)if(bn(arguments[2],wi)&&arguments[0]instanceof Pn&&arguments[1]instanceof $r)for(var s=arguments[0],u=arguments[1],o=arguments[2],h=u.getEdge().getCoordinates(),f=0;f<h.length-1;f++){A.Pr.p0=h[f],A.Pr.p1=h[f+1],A.Pr.p0.y>A.Pr.p1.y&&A.Pr.reverse();var c=Math.max(A.Pr.p0.x,A.Pr.p1.x);if(!(c<s.x||A.Pr.isHorizontal()||s.y<A.Pr.p0.y||s.y>A.Pr.p1.y||$n.computeOrientation(A.Pr.p0,A.Pr.p1,s)===$n.RIGHT)){var a=u.getDepth(Ur.LEFT);A.Pr.p0.equals(h[f])||(a=u.getDepth(Ur.RIGHT));var v=new Ke(A.Pr,a);o.add(v)}}else if(bn(arguments[2],wi)&&arguments[0]instanceof Pn&&bn(arguments[1],wi))for(var l=arguments[0],w=arguments[1],P=arguments[2],g=w.iterator();g.hasNext();){var C=g.next();C.isForward()&&A.findStabbedSegments(l,C,P)}},qe.prototype.getDepth=function(A){var t=this.findStabbedSegments(A);return 0===t.size()?0:fe.min(t).Cr},qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe},Ve.DepthSegment.get=function(){return Ke},Object.defineProperties(qe,Ve);var Ke=function(){this.Dr=null,this.Cr=null;var A=arguments[0],t=arguments[1];this.Dr=new de(A),this.Cr=t};Ke.prototype.compareTo=function(A){var t=A;if(this.Dr.minX()>=t.Dr.maxX())return 1;if(this.Dr.maxX()<=t.Dr.minX())return-1;var n=this.Dr.orientationIndex(t.Dr);return 0!==n||0!=(n=-1*t.Dr.orientationIndex(this.Dr))?n:this.Dr.compareTo(t.Dr)},Ke.prototype.compareX=function(A,t){var n=A.p0.compareTo(t.p0);return 0!==n?n:A.p1.compareTo(t.p1)},Ke.prototype.toString=function(){return this.Dr.toString()},Ke.prototype.interfaces_=function(){return[an]},Ke.prototype.getClass=function(){return Ke};var He=function(A,t,n){this.p0=A||null,this.p1=t||null,this.p2=n||null};He.prototype.area=function(){return He.area(this.p0,this.p1,this.p2)},He.prototype.signedArea=function(){return He.signedArea(this.p0,this.p1,this.p2)},He.prototype.interpolateZ=function(A){if(null===A)throw new hn("Supplied point is null.");return He.interpolateZ(A,this.p0,this.p1,this.p2)},He.prototype.longestSideLength=function(){return He.longestSideLength(this.p0,this.p1,this.p2)},He.prototype.isAcute=function(){return He.isAcute(this.p0,this.p1,this.p2)},He.prototype.circumcentre=function(){return He.circumcentre(this.p0,this.p1,this.p2)},He.prototype.area3D=function(){return He.area3D(this.p0,this.p1,this.p2)},He.prototype.centroid=function(){return He.centroid(this.p0,this.p1,this.p2)},He.prototype.inCentre=function(){return He.inCentre(this.p0,this.p1,this.p2)},He.prototype.interfaces_=function(){return[]},He.prototype.getClass=function(){return He},He.area=function(A,t,n){return Math.abs(((n.x-A.x)*(t.y-A.y)-(t.x-A.x)*(n.y-A.y))/2)},He.signedArea=function(A,t,n){return((n.x-A.x)*(t.y-A.y)-(t.x-A.x)*(n.y-A.y))/2},He.det=function(A,t,n,i){return A*i-t*n},He.interpolateZ=function(A,t,n,i){var r=t.x,e=t.y,s=n.x-r,u=i.x-r,o=n.y-e,h=i.y-e,f=s*h-u*o,c=A.x-r,a=A.y-e;return t.z+(h*c-u*a)/f*(n.z-t.z)+(-o*c+s*a)/f*(i.z-t.z)},He.longestSideLength=function(A,t,n){var i=A.distance(t),r=t.distance(n),e=n.distance(A),s=i;return r>s&&(s=r),e>s&&(s=e),s},He.isAcute=function(A,t,n){return!!Re.isAcute(A,t,n)&&!!Re.isAcute(t,n,A)&&!!Re.isAcute(n,A,t)},He.circumcentre=function(A,t,n){var i=n.x,r=n.y,e=A.x-i,s=A.y-r,u=t.x-i,o=t.y-r,h=2*He.det(e,s,u,o),f=He.det(s,e*e+s*s,o,u*u+o*o),c=He.det(e,e*e+s*s,u,u*u+o*o);return new Pn(i-f/h,r+c/h)},He.perpendicularBisector=function(A,t){var n=t.x-A.x,i=t.y-A.y,r=new Qn(A.x+n/2,A.y+i/2,1),e=new Qn(A.x-i+n/2,A.y+n+i/2,1);return new Qn(r,e)},He.angleBisector=function(A,t,n){var i=t.distance(A),r=i/(i+t.distance(n));return new Pn(A.x+r*(n.x-A.x),A.y+r*(n.y-A.y))},He.area3D=function(A,t,n){var i=t.x-A.x,r=t.y-A.y,e=t.z-A.z,s=n.x-A.x,u=n.y-A.y,o=n.z-A.z,h=r*o-e*u,f=e*s-i*o,c=i*u-r*s;return Math.sqrt(h*h+f*f+c*c)/2},He.centroid=function(A,t,n){return new Pn((A.x+t.x+n.x)/3,(A.y+t.y+n.y)/3)},He.inCentre=function(A,t,n){var i=t.distance(n),r=A.distance(n),e=A.distance(t),s=i+r+e;return new Pn((i*A.x+r*t.x+e*n.x)/s,(i*A.y+r*t.y+e*n.y)/s)};var _e=function(){this.Ir=null,this.Pi=null,this.Mr=null,this.br=new gi;var A=arguments[0],t=arguments[1],n=arguments[2];this.Ir=A,this.Pi=t,this.Mr=n};_e.prototype.addPoint=function(A){if(this.Pi<=0)return null;var t=A.getCoordinates(),n=this.Mr.getLineCurve(t,this.Pi);this.addCurve(n,In.EXTERIOR,In.INTERIOR)},_e.prototype.addPolygon=function(A){var t=this.Pi,n=Ur.LEFT;this.Pi<0&&(t=-this.Pi,n=Ur.RIGHT);var i=A.getExteriorRing(),r=Ii.removeRepeatedPoints(i.getCoordinates());if(this.Pi<0&&this.isErodedCompletely(i,this.Pi))return null;if(this.Pi<=0&&r.length<3)return null;this.addPolygonRing(r,t,n,In.EXTERIOR,In.INTERIOR);for(var e=0;e<A.getNumInteriorRing();e++){var s=A.getInteriorRingN(e),u=Ii.removeRepeatedPoints(s.getCoordinates());this.Pi>0&&this.isErodedCompletely(s,-this.Pi)||this.addPolygonRing(u,t,Ur.opposite(n),In.INTERIOR,In.EXTERIOR)}},_e.prototype.isTriangleErodedCompletely=function(A,t){var n=new He(A[0],A[1],A[2]),i=n.inCentre();return $n.distancePointLine(i,n.p0,n.p1)<Math.abs(t)},_e.prototype.addLineString=function(A){if(this.Pi<=0&&!this.Mr.getBufferParameters().isSingleSided())return null;var t=Ii.removeRepeatedPoints(A.getCoordinates()),n=this.Mr.getLineCurve(t,this.Pi);this.addCurve(n,In.EXTERIOR,In.INTERIOR)},_e.prototype.addCurve=function(A,t,n){if(null===A||A.length<2)return null;var i=new xe(A,new Yr(0,In.BOUNDARY,t,n));this.br.add(i)},_e.prototype.getCurves=function(){return this.add(this.Ir),this.br},_e.prototype.addPolygonRing=function(A,t,n,i,r){if(0===t&&A.length<fr.MINIMUM_VALID_SIZE)return null;var e=i,s=r;A.length>=fr.MINIMUM_VALID_SIZE&&$n.isCCW(A)&&(e=r,s=i,n=Ur.opposite(n));var u=this.Mr.getRingCurve(A,n,t);this.addCurve(u,e,s)},_e.prototype.add=function(A){if(A.isEmpty())return null;A instanceof or?this.addPolygon(A):A instanceof rr?this.addLineString(A):A instanceof sr?this.addPoint(A):(A instanceof hr||A instanceof Vi||A instanceof cr||A instanceof qi)&&this.addCollection(A)},_e.prototype.isErodedCompletely=function(A,t){var n=A.getCoordinates();if(n.length<4)return t<0;if(4===n.length)return this.isTriangleErodedCompletely(n,t);var i=A.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return t<0&&2*Math.abs(t)>r},_e.prototype.addCollection=function(A){for(var t=0;t<A.getNumGeometries();t++){var n=A.getGeometryN(t);this.add(n)}},_e.prototype.interfaces_=function(){return[]},_e.prototype.getClass=function(){return _e};var Je=function(){};Je.prototype.locate=function(A){},Je.prototype.interfaces_=function(){return[]},Je.prototype.getClass=function(){return Je};var Ze=function(){this.zr=null,this.xr=null,this.dr=null,this.Ni=null,this.yr=null;var A=arguments[0];this.zr=A,this.xr=!0,this.Ni=0,this.dr=A.getNumGeometries()};Ze.prototype.next=function(){if(this.xr)return this.xr=!1,Ze.isAtomic(this.zr)&&this.Ni++,this.zr;if(null!==this.yr){if(this.yr.hasNext())return this.yr.next();this.yr=null}if(this.Ni>=this.dr)throw new Pi;var A=this.zr.getGeometryN(this.Ni++);return A instanceof qi?(this.yr=new Ze(A),this.yr.next()):A},Ze.prototype.remove=function(){throw new Error(this.getClass().getName())},Ze.prototype.hasNext=function(){if(this.xr)return!0;if(null!==this.yr){if(this.yr.hasNext())return!0;this.yr=null}return!(this.Ni>=this.dr)},Ze.prototype.interfaces_=function(){return[li]},Ze.prototype.getClass=function(){return Ze},Ze.isAtomic=function(A){return!(A instanceof qi)};var Xe=function(){this.wn=null;var A=arguments[0];this.wn=A};Xe.prototype.locate=function(A){return Xe.locate(A,this.wn)},Xe.prototype.interfaces_=function(){return[Je]},Xe.prototype.getClass=function(){return Xe},Xe.isPointInRing=function(A,t){return!!t.getEnvelopeInternal().intersects(A)&&$n.isPointInRing(A,t.getCoordinates())},Xe.containsPointInPolygon=function(A,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!Xe.isPointInRing(A,n))return!1;for(var i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);if(Xe.isPointInRing(A,r))return!1}return!0},Xe.containsPoint=function(A,t){if(t instanceof or)return Xe.containsPointInPolygon(A,t);if(t instanceof qi)for(var n=new Ze(t);n.hasNext();){var i=n.next();if(i!==t&&Xe.containsPoint(A,i))return!0}return!1},Xe.locate=function(A,t){return t.isEmpty()?In.EXTERIOR:Xe.containsPoint(A,t)?In.INTERIOR:In.EXTERIOR};var $e=function(){this.mr=new ji,this.pr=null,this.Lr=[In.NONE,In.NONE]};$e.prototype.getNextCW=function(A){this.getEdges();var t=this.pr.indexOf(A),n=t-1;return 0===t&&(n=this.pr.size()-1),this.pr.get(n)},$e.prototype.propagateSideLabels=function(A){for(var t=In.NONE,n=this.iterator();n.hasNext();){var i=n.next().getLabel();i.isArea(A)&&i.getLocation(A,Ur.LEFT)!==In.NONE&&(t=i.getLocation(A,Ur.LEFT))}if(t===In.NONE)return null;for(var r=t,e=this.iterator();e.hasNext();){var s=e.next(),u=s.getLabel();if(u.getLocation(A,Ur.ON)===In.NONE&&u.setLocation(A,Ur.ON,r),u.isArea(A)){var o=u.getLocation(A,Ur.LEFT),h=u.getLocation(A,Ur.RIGHT);if(h!==In.NONE){if(h!==r)throw new Br("side location conflict",s.getCoordinate());o===In.NONE&&Kn.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),r=o}else Kn.isTrue(u.getLocation(A,Ur.LEFT)===In.NONE,"found single null side"),u.setLocation(A,Ur.RIGHT,r),u.setLocation(A,Ur.LEFT,r)}}},$e.prototype.getCoordinate=function(){var A=this.iterator();return A.hasNext()?A.next().getCoordinate():null},$e.prototype.print=function(A){Nn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(A)},$e.prototype.isAreaLabelsConsistent=function(A){return this.computeEdgeEndLabels(A.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},$e.prototype.checkAreaLabelsConsistent=function(A){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,i=t.get(n).getLabel().getLocation(A,Ur.LEFT);Kn.isTrue(i!==In.NONE,"Found unlabelled area edge");for(var r=i,e=this.iterator();e.hasNext();){var s=e.next().getLabel();Kn.isTrue(s.isArea(A),"Found non-area edge");var u=s.getLocation(A,Ur.LEFT),o=s.getLocation(A,Ur.RIGHT);if(u===o)return!1;if(o!==r)return!1;r=u}return!0},$e.prototype.findIndex=function(A){this.iterator();for(var t=0;t<this.pr.size();t++)if(this.pr.get(t)===A)return t;return-1},$e.prototype.iterator=function(){return this.getEdges().iterator()},$e.prototype.getEdges=function(){return null===this.pr&&(this.pr=new gi(this.mr.values())),this.pr},$e.prototype.getLocation=function(A,t,n){return this.Lr[A]===In.NONE&&(this.Lr[A]=Xe.locate(t,n[A].getGeometry())),this.Lr[A]},$e.prototype.toString=function(){var A=new dn;A.append("EdgeEndStar:   "+this.getCoordinate()),A.append("\n");for(var t=this.iterator();t.hasNext();){var n=t.next();A.append(n),A.append("\n")}return A.toString()},$e.prototype.computeEdgeEndLabels=function(A){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(A)},$e.prototype.computeLabelling=function(A){this.computeEdgeEndLabels(A[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next().getLabel(),r=0;r<2;r++)i.isLine(r)&&i.getLocation(r)===In.BOUNDARY&&(t[r]=!0);for(var e=this.iterator();e.hasNext();)for(var s=e.next(),u=s.getLabel(),o=0;o<2;o++)if(u.isAnyNull(o)){var h=In.NONE;if(t[o])h=In.EXTERIOR;else{var f=s.getCoordinate();h=this.getLocation(o,f,A)}u.setAllLocationsIfNull(o,h)}},$e.prototype.getDegree=function(){return this.mr.size()},$e.prototype.insertEdgeEnd=function(A,t){this.mr.put(A,t),this.pr=null},$e.prototype.interfaces_=function(){return[]},$e.prototype.getClass=function(){return $e};var As=function(A){function t(){A.call(this),this.Tr=null,this.Qn=null,this.Or=1,this.Fr=2}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var A=null,t=null,n=this.Or,i=0;i<this.Tr.size();i++){var r=this.Tr.get(i),e=r.getSym();if(r.getLabel().isArea())switch(null===A&&r.isInResult()&&(A=r),n){case this.Or:if(!e.isInResult())continue;t=e,n=this.Fr;break;case this.Fr:if(!r.isInResult())continue;t.setNext(r),n=this.Or}}if(n===this.Fr){if(null===A)throw new Br("no outgoing dirEdge found",this.getCoordinate());Kn.isTrue(A.isInResult(),"unable to link last incoming dirEdge"),t.setNext(A)}},t.prototype.insert=function(A){this.insertEdgeEnd(A,A)},t.prototype.getRightmostEdge=function(){var A=this.getEdges(),t=A.size();if(t<1)return null;var n=A.get(0);if(1===t)return n;var i=A.get(t-1),r=n.getQuadrant(),e=i.getQuadrant();return Jr.isNorthern(r)&&Jr.isNorthern(e)?n:Jr.isNorthern(r)||Jr.isNorthern(e)?0!==n.getDy()?n:0!==i.getDy()?i:(Kn.shouldNeverReachHere("found two horizontal edges incident on node"),null):i},t.prototype.print=function(A){Nn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();A.print("out "),n.print(A),A.println(),A.print("in "),n.getSym().print(A),A.println()}},t.prototype.getResultAreaEdges=function(){if(null!==this.Tr)return this.Tr;this.Tr=new gi;for(var A=this.iterator();A.hasNext();){var t=A.next();(t.isInResult()||t.getSym().isInResult())&&this.Tr.add(t)}return this.Tr},t.prototype.updateLabelling=function(A){for(var t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.setAllLocationsIfNull(0,A.getLocation(0)),n.setAllLocationsIfNull(1,A.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var A=null,t=null,n=this.pr.size()-1;n>=0;n--){var i=this.pr.get(n),r=i.getSym();null===t&&(t=r),null!==A&&r.setNext(A),A=i}t.setNext(A)},t.prototype.computeDepths=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=this.findIndex(t),i=t.getDepth(Ur.LEFT),r=t.getDepth(Ur.RIGHT),e=this.computeDepths(n+1,this.pr.size(),i),s=this.computeDepths(0,n,e);if(s!==r)throw new Br("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var u=arguments[0],o=arguments[1],h=arguments[2],f=h,c=u;c<o;c++){var a=A.pr.get(c);a.setEdgeDepths(Ur.RIGHT,f),f=a.getDepth(Ur.LEFT)}return f}},t.prototype.mergeSymLabels=function(){for(var A=this.iterator();A.hasNext();){var t=A.next();t.getLabel().merge(t.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(A){for(var t=null,n=null,i=this.Or,r=this.Tr.size()-1;r>=0;r--){var e=this.Tr.get(r),s=e.getSym();switch(null===t&&e.getEdgeRing()===A&&(t=e),i){case this.Or:if(s.getEdgeRing()!==A)continue;n=s,i=this.Fr;break;case this.Fr:if(e.getEdgeRing()!==A)continue;n.setNextMin(e),i=this.Or}}i===this.Fr&&(Kn.isTrue(null!==t,"found null for first outgoing dirEdge"),Kn.isTrue(t.getEdgeRing()===A,"unable to link last incoming dirEdge"),n.setNextMin(t))},t.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var A=0,t=this.iterator();t.hasNext();){var n=t.next();n.isInResult()&&A++}return A}if(1===arguments.length){for(var i=arguments[0],r=0,e=this.iterator();e.hasNext();){var s=e.next();s.getEdgeRing()===i&&r++}return r}},t.prototype.getLabel=function(){return this.Qn},t.prototype.findCoveredLineEdges=function(){for(var A=In.NONE,t=this.iterator();t.hasNext();){var n=t.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){A=In.INTERIOR;break}if(i.isInResult()){A=In.EXTERIOR;break}}}if(A===In.NONE)return null;for(var r=A,e=this.iterator();e.hasNext();){var s=e.next(),u=s.getSym();s.isLineEdge()?s.getEdge().setCovered(r===In.INTERIOR):(s.isInResult()&&(r=In.EXTERIOR),u.isInResult()&&(r=In.INTERIOR))}},t.prototype.computeLabelling=function(t){A.prototype.computeLabelling.call(this,t),this.Qn=new Yr(In.NONE);for(var n=this.iterator();n.hasNext();)for(var i=n.next().getEdge().getLabel(),r=0;r<2;r++){var e=i.getLocation(r);e!==In.INTERIOR&&e!==In.BOUNDARY||this.Qn.setLocation(r,In.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}($e),ts=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.createNode=function(A){return new Hr(A,new As)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ae),ns=function A(){this.Nn=null,this.Er=null;var t=arguments[0];this.Nn=t,this.Er=A.orientation(t)};ns.prototype.compareTo=function(A){return ns.compareOriented(this.Nn,this.Er,A.Nn,A.Er)},ns.prototype.interfaces_=function(){return[an]},ns.prototype.getClass=function(){return ns},ns.orientation=function(A){return 1===Ii.increasingDirection(A)},ns.compareOriented=function(A,t,n,i){for(var r=t?1:-1,e=i?1:-1,s=t?A.length:-1,u=i?n.length:-1,o=t?0:A.length-1,h=i?0:n.length-1;;){var f=A[o].compareTo(n[h]);if(0!==f)return f;var c=(o+=r)===s,a=(h+=e)===u;if(c&&!a)return-1;if(!c&&a)return 1;if(c&&a)return 0}};var is=function(){this.jn=new gi,this.Ur=new ji};is.prototype.print=function(A){A.print("MULTILINESTRING ( ");for(var t=0;t<this.jn.size();t++){var n=this.jn.get(t);t>0&&A.print(","),A.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&A.print(","),A.print(i[r].x+" "+i[r].y);A.println(")")}A.print(")  ")},is.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next())},is.prototype.findEdgeIndex=function(A){for(var t=0;t<this.jn.size();t++)if(this.jn.get(t).equals(A))return t;return-1},is.prototype.iterator=function(){return this.jn.iterator()},is.prototype.getEdges=function(){return this.jn},is.prototype.get=function(A){return this.jn.get(A)},is.prototype.findEqualEdge=function(A){var t=new ns(A.getCoordinates());return this.Ur.get(t)},is.prototype.add=function(A){this.jn.add(A);var t=new ns(A.getCoordinates());this.Ur.put(t,A)},is.prototype.interfaces_=function(){return[]},is.prototype.getClass=function(){return is};var rs=function(){};rs.prototype.processIntersections=function(A,t,n,i){},rs.prototype.isDone=function(){},rs.prototype.interfaces_=function(){return[]},rs.prototype.getClass=function(){return rs};var es=function(){this.jr=!1,this.Nr=!1,this.Qr=!1,this.Sr=!1,this.Br=null,this.rr=null,this.Rr=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var A=arguments[0];this.rr=A};es.prototype.isTrivialIntersection=function(A,t,n,i){if(A===n&&1===this.rr.getIntersectionNum()){if(es.isAdjacentSegments(t,i))return!0;if(A.isClosed()){var r=A.size()-1;if(0===t&&i===r||0===i&&t===r)return!0}}return!1},es.prototype.getProperIntersectionPoint=function(){return this.Br},es.prototype.hasProperInteriorIntersection=function(){return this.Qr},es.prototype.getLineIntersector=function(){return this.rr},es.prototype.hasProperIntersection=function(){return this.Nr},es.prototype.processIntersections=function(A,t,n,i){if(A===n&&t===i)return null;this.numTests++;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.rr.computeIntersection(r,e,s,u),this.rr.hasIntersection()&&(this.numIntersections++,this.rr.isInteriorIntersection()&&(this.numInteriorIntersections++,this.Sr=!0),this.isTrivialIntersection(A,t,n,i)||(this.jr=!0,A.addIntersections(this.rr,t,0),n.addIntersections(this.rr,i,1),this.rr.isProper()&&(this.numProperIntersections++,this.Nr=!0,this.Qr=!0)))},es.prototype.hasIntersection=function(){return this.jr},es.prototype.isDone=function(){return!1},es.prototype.hasInteriorIntersection=function(){return this.Sr},es.prototype.interfaces_=function(){return[rs]},es.prototype.getClass=function(){return es},es.isAdjacentSegments=function(A,t){return 1===Math.abs(A-t)};var ss=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var A=arguments[0],t=arguments[1],n=arguments[2];this.coord=new Pn(A),this.segmentIndex=t,this.dist=n};ss.prototype.getSegmentIndex=function(){return this.segmentIndex},ss.prototype.getCoordinate=function(){return this.coord},ss.prototype.print=function(A){A.print(this.coord),A.print(" seg # = "+this.segmentIndex),A.println(" dist = "+this.dist)},ss.prototype.compareTo=function(A){return this.compare(A.segmentIndex,A.dist)},ss.prototype.isEndPoint=function(A){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===A},ss.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},ss.prototype.getDistance=function(){return this.dist},ss.prototype.compare=function(A,t){return this.segmentIndex<A?-1:this.segmentIndex>A?1:this.dist<t?-1:this.dist>t?1:0},ss.prototype.interfaces_=function(){return[an]},ss.prototype.getClass=function(){return ss};var us=function(){this.di=new ji,this.edge=null;var A=arguments[0];this.edge=A};us.prototype.print=function(A){A.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(A)},us.prototype.iterator=function(){return this.di.values().iterator()},us.prototype.addSplitEdges=function(A){this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);A.add(r),n=i}},us.prototype.addEndpoints=function(){var A=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[A],A,0)},us.prototype.createSplitEdge=function(A,t){var n=t.segmentIndex-A.segmentIndex+2,r=t.dist>0||!t.coord.equals2D(this.edge.pts[t.segmentIndex]);r||n--;var e=new Array(n).fill(null),s=0;e[s++]=new Pn(A.coord);for(var u=A.segmentIndex+1;u<=t.segmentIndex;u++)e[s++]=this.edge.pts[u];return r&&(e[s]=t.coord),new as(e,new Yr(this.edge.Qn))},us.prototype.add=function(A,t,n){var i=new ss(A,t,n),r=this.di.get(i);return null!==r?r:(this.di.put(i,i),i)},us.prototype.isIntersection=function(A){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(A))return!0;return!1},us.prototype.interfaces_=function(){return[]},us.prototype.getClass=function(){return us};var os=function(){};os.prototype.getChainStartIndices=function(A){var t=0,n=new gi;n.add(new yn(t));do{var i=this.findChainEnd(A,t);n.add(new yn(i)),t=i}while(t<A.length-1);return os.toIntArray(n)},os.prototype.findChainEnd=function(A,t){for(var n=Jr.quadrant(A[t],A[t+1]),i=t+1;i<A.length&&Jr.quadrant(A[i-1],A[i])===n;)i++;return i-1},os.prototype.interfaces_=function(){return[]},os.prototype.getClass=function(){return os},os.toIntArray=function(A){for(var t=new Array(A.size()).fill(null),n=0;n<t.length;n++)t[n]=A.get(n).intValue();return t};var hs=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Sn,this.env2=new Sn;var A=arguments[0];this.e=A,this.pts=A.getCoordinates();var t=new os;this.startIndex=t.getChainStartIndices(this.pts)};hs.prototype.getCoordinates=function(){return this.pts},hs.prototype.getMaxX=function(A){var t=this.pts[this.startIndex[A]].x,n=this.pts[this.startIndex[A+1]].x;return t>n?t:n},hs.prototype.getMinX=function(A){var t=this.pts[this.startIndex[A]].x,n=this.pts[this.startIndex[A+1]].x;return t<n?t:n},hs.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[A],this.startIndex[A+1],t,t.startIndex[n],t.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3],o=arguments[4],h=arguments[5],f=this.pts[r],c=this.pts[e],a=s.pts[u],v=s.pts[o];if(e-r==1&&o-u==1)return h.addIntersections(this.e,r,s.e,u),null;if(this.env1.init(f,c),this.env2.init(a,v),!this.env1.intersects(this.env2))return null;var l=Math.trunc((r+e)/2),w=Math.trunc((u+o)/2);r<l&&(u<w&&this.computeIntersectsForChain(r,l,s,u,w,h),w<o&&this.computeIntersectsForChain(r,l,s,w,o,h)),l<e&&(u<w&&this.computeIntersectsForChain(l,e,s,u,w,h),w<o&&this.computeIntersectsForChain(l,e,s,w,o,h))}},hs.prototype.getStartIndexes=function(){return this.startIndex},hs.prototype.computeIntersects=function(A,t){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<A.startIndex.length-1;i++)this.computeIntersectsForChain(n,A,i,t)},hs.prototype.interfaces_=function(){return[]},hs.prototype.getClass=function(){return hs};var fs=function A(){this.ei=Array(2).fill().map((function(){return Array(3)}));for(var t=0;t<2;t++)for(var n=0;n<3;n++)this.ei[t][n]=A.NULL_VALUE},cs={NULL_VALUE:{configurable:!0}};fs.prototype.getDepth=function(A,t){return this.ei[A][t]},fs.prototype.setDepth=function(A,t,n){this.ei[A][t]=n},fs.prototype.isNull=function(){var A=this;if(0===arguments.length){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(A.ei[t][n]!==fs.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this.ei[i][1]===fs.NULL_VALUE}if(2===arguments.length){var r=arguments[0],e=arguments[1];return this.ei[r][e]===fs.NULL_VALUE}},fs.prototype.normalize=function(){for(var A=0;A<2;A++)if(!this.isNull(A)){var t=this.ei[A][1];this.ei[A][2]<t&&(t=this.ei[A][2]),t<0&&(t=0);for(var n=1;n<3;n++){var i=0;this.ei[A][n]>t&&(i=1),this.ei[A][n]=i}}},fs.prototype.getDelta=function(A){return this.ei[A][Ur.RIGHT]-this.ei[A][Ur.LEFT]},fs.prototype.getLocation=function(A,t){return this.ei[A][t]<=0?In.EXTERIOR:In.INTERIOR},fs.prototype.toString=function(){return"A: "+this.ei[0][1]+","+this.ei[0][2]+" B: "+this.ei[1][1]+","+this.ei[1][2]},fs.prototype.add=function(){var A=this;if(1===arguments.length)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);r!==In.EXTERIOR&&r!==In.INTERIOR||(A.isNull(n,i)?A.ei[n][i]=fs.depthAtLocation(r):A.ei[n][i]+=fs.depthAtLocation(r))}else if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];u===In.INTERIOR&&this.ei[e][s]++}},fs.prototype.interfaces_=function(){return[]},fs.prototype.getClass=function(){return fs},fs.depthAtLocation=function(A){return A===In.EXTERIOR?0:A===In.INTERIOR?1:fs.NULL_VALUE},cs.NULL_VALUE.get=function(){return-1},Object.defineProperties(fs,cs);var as=function(A){function t(){if(A.call(this),this.pts=null,this.Fn=null,this.eiList=new us(this),this.bn=null,this.kr=null,this.Gr=!0,this.ei=new fs,this.Yr=0,1===arguments.length){var n=arguments[0];t.call(this,n,null)}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.pts=i,this.Qn=r}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getDepth=function(){return this.ei},t.prototype.getCollapsedEdge=function(){var A=new Array(2).fill(null);return A[0]=this.pts[0],A[1]=this.pts[1],new t(A,Yr.toLineLabel(this.Qn))},t.prototype.isIsolated=function(){return this.Gr},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(A){this.Gr=A},t.prototype.setName=function(A){this.bn=A},t.prototype.equals=function(A){if(!(A instanceof t))return!1;var n=A;if(this.pts.length!==n.pts.length)return!1;for(var i=!0,r=!0,e=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(n.pts[s])||(i=!1),this.pts[s].equals2D(n.pts[--e])||(r=!1),!i&&!r)return!1;return!0},t.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var A=arguments[0];return this.pts[A]}},t.prototype.print=function(A){A.print("edge "+this.bn+": "),A.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&A.print(","),A.print(this.pts[t].x+" "+this.pts[t].y);A.print(")  "+this.Qn+" "+this.Yr)},t.prototype.computeIM=function(A){t.updateIM(this.Qn,A)},t.prototype.isCollapsed=function(){return!!this.Qn.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this.Yr},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(A){A.print("edge "+this.bn+": ");for(var t=this.pts.length-1;t>=0;t--)A.print(this.pts[t]+" ");A.println("")},t.prototype.getMonotoneChainEdge=function(){return null===this.kr&&(this.kr=new hs(this)),this.kr},t.prototype.getEnvelope=function(){if(null===this.Fn){this.Fn=new Sn;for(var A=0;A<this.pts.length;A++)this.Fn.expandToInclude(this.pts[A])}return this.Fn},t.prototype.addIntersection=function(A,t,n,i){var r=new Pn(A.getIntersection(i)),e=t,s=A.getEdgeDistance(n,i),u=e+1;u<this.pts.length&&(r.equals2D(this.pts[u])&&(e=u,s=0));this.eiList.add(r,e,s)},t.prototype.toString=function(){var A=new dn;A.append("edge "+this.bn+": "),A.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&A.append(","),A.append(this.pts[t].x+" "+this.pts[t].y);return A.append(")  "+this.Qn+" "+this.Yr),A.toString()},t.prototype.isPointwiseEqual=function(A){if(this.pts.length!==A.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(A.pts[t]))return!1;return!0},t.prototype.setDepthDelta=function(A){this.Yr=A},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++)this.addIntersection(A,t,n,i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(2!==arguments.length)return A.prototype.updateIM.apply(this,arguments);var t=arguments[0],n=arguments[1];n.setAtLeastIfValid(t.getLocation(0,Ur.ON),t.getLocation(1,Ur.ON),1),t.isArea()&&(n.setAtLeastIfValid(t.getLocation(0,Ur.LEFT),t.getLocation(1,Ur.LEFT),2),n.setAtLeastIfValid(t.getLocation(0,Ur.RIGHT),t.getLocation(1,Ur.RIGHT),2))},t}(Kr),vs=function(A){this.Wr=null,this.qr=null,this.Pn=null,this.Vr=null,this.pr=new is,this.ir=A||null};vs.prototype.setWorkingPrecisionModel=function(A){this.Wr=A},vs.prototype.insertUniqueEdge=function(A){var t=this.pr.findEqualEdge(A);if(null!==t){var n=t.getLabel(),i=A.getLabel();t.isPointwiseEqual(A)||(i=new Yr(A.getLabel())).flip(),n.merge(i);var r=vs.depthDelta(i),e=t.getDepthDelta()+r;t.setDepthDelta(e)}else this.pr.add(A),A.setDepthDelta(vs.depthDelta(A.getLabel()))},vs.prototype.buildSubgraphs=function(A,t){for(var n=new gi,i=A.iterator();i.hasNext();){var r=i.next(),e=r.getRightmostCoordinate(),s=new qe(n).getDepth(e);r.computeDepth(s),r.findResultEdges(),n.add(r),t.add(r.getDirectedEdges(),r.getNodes())}},vs.prototype.createSubgraphs=function(A){for(var t=new gi,n=A.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new kr;r.create(i),t.add(r)}}return fe.sort(t,fe.reverseOrder()),t},vs.prototype.createEmptyResultGeometry=function(){return this.Pn.createPolygon()},vs.prototype.getNoder=function(A){if(null!==this.qr)return this.qr;var t=new Fe,n=new Jn;return n.setPrecisionModel(A),t.setSegmentIntersector(new es(n)),t},vs.prototype.buffer=function(A,t){var n=this.Wr;null===n&&(n=A.getPrecisionModel()),this.Pn=A.getFactory();var i=new We(n,this.ir),r=new _e(A,t,i).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,n),this.Vr=new te(new ts),this.Vr.addEdges(this.pr.getEdges());var e=this.createSubgraphs(this.Vr),s=new ne(this.Pn);this.buildSubgraphs(e,s);var u=s.getPolygons();return u.size()<=0?this.createEmptyResultGeometry():this.Pn.buildGeometry(u)},vs.prototype.computeNodedEdges=function(A,t){var n=this.getNoder(t);n.computeNodes(A);for(var i=n.getNodedSubstrings().iterator();i.hasNext();){var r=i.next(),e=r.getCoordinates();if(2!==e.length||!e[0].equals2D(e[1])){var s=r.getData(),u=new as(r.getCoordinates(),new Yr(s));this.insertUniqueEdge(u)}}},vs.prototype.setNoder=function(A){this.qr=A},vs.prototype.interfaces_=function(){return[]},vs.prototype.getClass=function(){return vs},vs.depthDelta=function(A){var t=A.getLocation(0,Ur.LEFT),n=A.getLocation(0,Ur.RIGHT);return t===In.INTERIOR&&n===In.EXTERIOR?1:t===In.EXTERIOR&&n===In.INTERIOR?-1:0},vs.convertSegStrings=function(A){for(var t=new yr,n=new gi;A.hasNext();){var i=A.next(),r=t.createLineString(i.getCoordinates());n.add(r)}return t.buildGeometry(n)};var ls=function(){if(this.Kr=null,this.Hr=null,this._r=null,this.Jr=null,this.Zr=!1,2===arguments.length){var A=arguments[0],t=arguments[1];this.Kr=A,this.Hr=t,this._r=0,this.Jr=0,this.Zr=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],e=arguments[3];this.Kr=n,this.Hr=i,this._r=r,this.Jr=e,this.Zr=!this.isIntegerPrecision()}};ls.prototype.rescale=function(){var A=this;if(bn(arguments[0],ai))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],e=0;e<r.length;e++)r[e].x=r[e].x/A.Hr+A._r,r[e].y=r[e].y/A.Hr+A.Jr;2===r.length&&r[0].equals2D(r[1])&&Nn.out.println(r)}},ls.prototype.scale=function(){var A=this;if(bn(arguments[0],ai)){for(var t=arguments[0],n=new gi,i=t.iterator();i.hasNext();){var r=i.next();n.add(new xe(A.scale(r.getCoordinates()),r.getData()))}return n}if(arguments[0]instanceof Array){for(var e=arguments[0],s=new Array(e.length).fill(null),u=0;u<e.length;u++)s[u]=new Pn(Math.round((e[u].x-A._r)*A.Hr),Math.round((e[u].y-A.Jr)*A.Hr),e[u].z);var o=Ii.removeRepeatedPoints(s);return o}},ls.prototype.isIntegerPrecision=function(){return 1===this.Hr},ls.prototype.getNodedSubstrings=function(){var A=this.Kr.getNodedSubstrings();return this.Zr&&this.rescale(A),A},ls.prototype.computeNodes=function(A){var t=A;this.Zr&&(t=this.scale(A)),this.Kr.computeNodes(t)},ls.prototype.interfaces_=function(){return[Te]},ls.prototype.getClass=function(){return ls};var ws=function(){this.rr=new Jn,this.Xr=null;var A=arguments[0];this.Xr=A},Ps={fact:{configurable:!0}};ws.prototype.checkEndPtVertexIntersections=function(){var A=this;if(0===arguments.length)for(var t=this.Xr.iterator();t.hasNext();){var n=t.next(),i=n.getCoordinates();A.checkEndPtVertexIntersections(i[0],A.Xr),A.checkEndPtVertexIntersections(i[i.length-1],A.Xr)}else if(2===arguments.length)for(var r=arguments[0],e=arguments[1],s=e.iterator();s.hasNext();)for(var u=s.next(),o=u.getCoordinates(),h=1;h<o.length-1;h++)if(o[h].equals(r))throw new qn("found endpt/interior pt intersection at index "+h+" :pt "+r)},ws.prototype.checkInteriorIntersections=function(){var A=this;if(0===arguments.length)for(var t=this.Xr.iterator();t.hasNext();)for(var n=t.next(),i=this.Xr.iterator();i.hasNext();){var r=i.next();A.checkInteriorIntersections(n,r)}else if(2===arguments.length)for(var e=arguments[0],s=arguments[1],u=e.getCoordinates(),o=s.getCoordinates(),h=0;h<u.length-1;h++)for(var f=0;f<o.length-1;f++)A.checkInteriorIntersections(e,h,s,f);else if(4===arguments.length){var c=arguments[0],a=arguments[1],v=arguments[2],l=arguments[3];if(c===v&&a===l)return null;var w=c.getCoordinates()[a],P=c.getCoordinates()[a+1],g=v.getCoordinates()[l],C=v.getCoordinates()[l+1];if(this.rr.computeIntersection(w,P,g,C),this.rr.hasIntersection()&&(this.rr.isProper()||this.hasInteriorIntersection(this.rr,w,P)||this.hasInteriorIntersection(this.rr,g,C)))throw new qn("found non-noded intersection at "+w+"-"+P+" and "+g+"-"+C)}},ws.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},ws.prototype.checkCollapses=function(){var A=this;if(0===arguments.length)for(var t=this.Xr.iterator();t.hasNext();){var n=t.next();A.checkCollapses(n)}else if(1===arguments.length)for(var i=arguments[0],r=i.getCoordinates(),e=0;e<r.length-2;e++)A.checkCollapse(r[e],r[e+1],r[e+2])},ws.prototype.hasInteriorIntersection=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++){var r=A.getIntersection(i);if(!r.equals(t)&&!r.equals(n))return!0}return!1},ws.prototype.checkCollapse=function(A,t,n){if(A.equals(n))throw new qn("found non-noded collapse at "+ws.fact.createLineString([A,t,n]))},ws.prototype.interfaces_=function(){return[]},ws.prototype.getClass=function(){return ws},Ps.fact.get=function(){return new yr},Object.defineProperties(ws,Ps);var gs=function(){this.rr=null,this.$r=null,this.Ae=null,this.te=null,this.ne=null,this.ie=null,this.Hr=null,this.Yt=null,this.Wt=null,this.qt=null,this.Vt=null,this.re=new Array(4).fill(null),this.ee=null;var A=arguments[0],t=arguments[1],n=arguments[2];if(this.Ae=A,this.$r=A,this.Hr=t,this.rr=n,t<=0)throw new hn("Scale factor must be non-zero");1!==t&&(this.$r=new Pn(this.scale(A.x),this.scale(A.y)),this.ne=new Pn,this.ie=new Pn),this.initCorners(this.$r)},Cs={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};gs.prototype.intersectsScaled=function(A,t){var n=Math.min(A.x,t.x),i=Math.max(A.x,t.x),r=Math.min(A.y,t.y),e=Math.max(A.y,t.y),s=this.Wt<n||this.Yt>i||this.Vt<r||this.qt>e;if(s)return!1;var u=this.intersectsToleranceSquare(A,t);return Kn.isTrue(!(s&&u),"Found bad envelope test"),u},gs.prototype.initCorners=function(A){this.Yt=A.x-.5,this.Wt=A.x+.5,this.qt=A.y-.5,this.Vt=A.y+.5,this.re[0]=new Pn(this.Wt,this.Vt),this.re[1]=new Pn(this.Yt,this.Vt),this.re[2]=new Pn(this.Yt,this.qt),this.re[3]=new Pn(this.Wt,this.qt)},gs.prototype.intersects=function(A,t){return 1===this.Hr?this.intersectsScaled(A,t):(this.copyScaled(A,this.ne),this.copyScaled(t,this.ie),this.intersectsScaled(this.ne,this.ie))},gs.prototype.scale=function(A){return Math.round(A*this.Hr)},gs.prototype.getCoordinate=function(){return this.Ae},gs.prototype.copyScaled=function(A,t){t.x=this.scale(A.x),t.y=this.scale(A.y)},gs.prototype.getSafeEnvelope=function(){if(null===this.ee){var A=gs.SAFE_ENV_EXPANSION_FACTOR/this.Hr;this.ee=new Sn(this.Ae.x-A,this.Ae.x+A,this.Ae.y-A,this.Ae.y+A)}return this.ee},gs.prototype.intersectsPixelClosure=function(A,t){return this.rr.computeIntersection(A,t,this.re[0],this.re[1]),!!(this.rr.hasIntersection()||(this.rr.computeIntersection(A,t,this.re[1],this.re[2]),this.rr.hasIntersection()||(this.rr.computeIntersection(A,t,this.re[2],this.re[3]),this.rr.hasIntersection()||(this.rr.computeIntersection(A,t,this.re[3],this.re[0]),this.rr.hasIntersection()))))},gs.prototype.intersectsToleranceSquare=function(A,t){var n=!1,i=!1;return this.rr.computeIntersection(A,t,this.re[0],this.re[1]),!!(this.rr.isProper()||(this.rr.computeIntersection(A,t,this.re[1],this.re[2]),this.rr.isProper()||(this.rr.hasIntersection()&&(n=!0),this.rr.computeIntersection(A,t,this.re[2],this.re[3]),this.rr.isProper()||(this.rr.hasIntersection()&&(i=!0),this.rr.computeIntersection(A,t,this.re[3],this.re[0]),this.rr.isProper()||n&&i||A.equals(this.$r)||t.equals(this.$r)))))},gs.prototype.addSnappedNode=function(A,t){var n=A.getCoordinate(t),i=A.getCoordinate(t+1);return!!this.intersects(n,i)&&(A.addIntersection(this.getCoordinate(),t),!0)},gs.prototype.interfaces_=function(){return[]},gs.prototype.getClass=function(){return gs},Cs.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(gs,Cs);var Ds=function(){this.tempEnv1=new Sn,this.selectedSegment=new de};Ds.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var A=arguments[0],t=arguments[1];A.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},Ds.prototype.interfaces_=function(){return[]},Ds.prototype.getClass=function(){return Ds};var Is=function(){this.Ni=null;var A=arguments[0];this.Ni=A},Ms={HotPixelSnapAction:{configurable:!0}};Is.prototype.snap=function(){if(1===arguments.length){var A=arguments[0];return this.snap(A,null,-1)}if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=t.getSafeEnvelope(),e=new bs(t,n,i);return this.Ni.query(r,{interfaces_:function(){return[se]},visitItem:function(A){A.select(r,e)}}),e.isNodeAdded()}},Is.prototype.interfaces_=function(){return[]},Is.prototype.getClass=function(){return Is},Ms.HotPixelSnapAction.get=function(){return bs},Object.defineProperties(Is,Ms);var bs=function(A){function t(){A.call(this),this.se=null,this.ue=null,this.oe=null,this.he=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this.se=t,this.ue=n,this.oe=i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isNodeAdded=function(){return this.he},t.prototype.select=function(){if(2!==arguments.length)return A.prototype.select.apply(this,arguments);var t=arguments[0],n=arguments[1],i=t.getContext();if(null!==this.ue&&i===this.ue&&n===this.oe)return null;this.he=this.se.addSnappedNode(i,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ds),zs=function(){this.rr=null,this.fe=null;var A=arguments[0];this.rr=A,this.fe=new gi};zs.prototype.processIntersections=function(A,t,n,i){if(A===n&&t===i)return null;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];if(this.rr.computeIntersection(r,e,s,u),this.rr.hasIntersection()&&this.rr.isInteriorIntersection()){for(var o=0;o<this.rr.getIntersectionNum();o++)this.fe.add(this.rr.getIntersection(o));A.addIntersections(this.rr,t,0),n.addIntersections(this.rr,i,1)}},zs.prototype.isDone=function(){return!1},zs.prototype.getInteriorIntersections=function(){return this.fe},zs.prototype.interfaces_=function(){return[rs]},zs.prototype.getClass=function(){return zs};var xs=function(){this.ce=null,this.rr=null,this.Hr=null,this.Kr=null,this.ae=null,this.Si=null;var A=arguments[0];this.ce=A,this.rr=new Jn,this.rr.setPrecisionModel(A),this.Hr=A.getScale()};xs.prototype.checkCorrectness=function(A){var t=xe.getNodedSubstrings(A),n=new ws(t);try{n.checkValid()}catch(A){if(!(A instanceof Un))throw A;A.printStackTrace()}},xs.prototype.getNodedSubstrings=function(){return xe.getNodedSubstrings(this.Si)},xs.prototype.snapRound=function(A,t){var n=this.findInteriorIntersections(A,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(A)},xs.prototype.findInteriorIntersections=function(A,t){var n=new zs(t);return this.Kr.setSegmentIntersector(n),this.Kr.computeNodes(A),n.getInteriorIntersections()},xs.prototype.computeVertexSnaps=function(){var A=this;if(bn(arguments[0],ai))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.computeVertexSnaps(i)}else if(arguments[0]instanceof xe)for(var r=arguments[0],e=r.getCoordinates(),s=0;s<e.length;s++){var u=new gs(e[s],A.Hr,A.rr),o=A.ae.snap(u,r,s);o&&r.addIntersection(e[s],s)}},xs.prototype.computeNodes=function(A){this.Si=A,this.Kr=new Fe,this.ae=new Is(this.Kr.getIndex()),this.snapRound(A,this.rr)},xs.prototype.computeIntersectionSnaps=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next(),i=new gs(n,this.Hr,this.rr);this.ae.snap(i)}},xs.prototype.interfaces_=function(){return[Te]},xs.prototype.getClass=function(){return xs};var ds=function(){if(this.ve=null,this.Pi=null,this.ir=new Ue,this.we=null,this.Pe=null,1===arguments.length){var A=arguments[0];this.ve=A}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.ve=t,this.ir=n}},ys={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};ds.prototype.bufferFixedPrecision=function(A){var t=new ls(new xs(new br(1)),A.getScale()),n=new vs(this.ir);n.setWorkingPrecisionModel(A),n.setNoder(t),this.we=n.buffer(this.ve,this.Pi)},ds.prototype.bufferReducedPrecision=function(){var A=this;if(0===arguments.length){for(var t=ds.MAX_PRECISION_DIGITS;t>=0;t--){try{A.bufferReducedPrecision(t)}catch(t){if(!(t instanceof Br))throw t;A.Pe=t}if(null!==A.we)return null}throw this.Pe}if(1===arguments.length){var n=arguments[0],i=ds.precisionScaleFactor(this.ve,this.Pi,n),r=new br(i);this.bufferFixedPrecision(r)}},ds.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this.we)return null;var A=this.ve.getFactory().getPrecisionModel();A.getType()===br.FIXED?this.bufferFixedPrecision(A):this.bufferReducedPrecision()},ds.prototype.setQuadrantSegments=function(A){this.ir.setQuadrantSegments(A)},ds.prototype.bufferOriginalPrecision=function(){try{var A=new vs(this.ir);this.we=A.buffer(this.ve,this.Pi)}catch(A){if(!(A instanceof qn))throw A;this.Pe=A}},ds.prototype.getResultGeometry=function(A){return this.Pi=A,this.computeGeometry(),this.we},ds.prototype.setEndCapStyle=function(A){this.ir.setEndCapStyle(A)},ds.prototype.interfaces_=function(){return[]},ds.prototype.getClass=function(){return ds},ds.bufferOp=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new ds(A),i=n.getResultGeometry(t);return i}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ni&&"number"==typeof arguments[1]){var r=arguments[0],e=arguments[1],s=arguments[2],u=new ds(r);u.setQuadrantSegments(s);var o=u.getResultGeometry(e);return o}if(arguments[2]instanceof Ue&&arguments[0]instanceof ni&&"number"==typeof arguments[1]){var h=arguments[0],f=arguments[1],c=arguments[2],a=new ds(h,c),v=a.getResultGeometry(f);return v}}else if(4===arguments.length){var l=arguments[0],w=arguments[1],P=arguments[2],g=arguments[3],C=new ds(l);C.setQuadrantSegments(P),C.setEndCapStyle(g);var D=C.getResultGeometry(w);return D}},ds.precisionScaleFactor=function(A,t,n){var i=A.getEnvelopeInternal(),r=zn.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY()))+2*(t>0?t:0),e=n-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,e)},ys.CAP_ROUND.get=function(){return Ue.CAP_ROUND},ys.CAP_BUTT.get=function(){return Ue.CAP_FLAT},ys.CAP_FLAT.get=function(){return Ue.CAP_FLAT},ys.CAP_SQUARE.get=function(){return Ue.CAP_SQUARE},ys.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(ds,ys);var ms=function(){this.$r=[new Pn,new Pn],this.Pi=fn.NaN,this.Ce=!0};ms.prototype.getCoordinates=function(){return this.$r},ms.prototype.getCoordinate=function(A){return this.$r[A]},ms.prototype.setMinimum=function(){if(1===arguments.length){var A=arguments[0];this.setMinimum(A.$r[0],A.$r[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.Ce)return this.initialize(t,n),null;var i=t.distance(n);i<this.Pi&&this.initialize(t,n,i)}},ms.prototype.initialize=function(){if(0===arguments.length)this.Ce=!0;else if(2===arguments.length){var A=arguments[0],t=arguments[1];this.$r[0].setCoordinate(A),this.$r[1].setCoordinate(t),this.Pi=A.distance(t),this.Ce=!1}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.$r[0].setCoordinate(n),this.$r[1].setCoordinate(i),this.Pi=r,this.Ce=!1}},ms.prototype.getDistance=function(){return this.Pi},ms.prototype.setMaximum=function(){if(1===arguments.length){var A=arguments[0];this.setMaximum(A.$r[0],A.$r[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.Ce)return this.initialize(t,n),null;var i=t.distance(n);i>this.Pi&&this.initialize(t,n,i)}},ms.prototype.interfaces_=function(){return[]},ms.prototype.getClass=function(){return ms};var ps=function(){};ps.prototype.interfaces_=function(){return[]},ps.prototype.getClass=function(){return ps},ps.computeDistance=function(){if(arguments[2]instanceof ms&&arguments[0]instanceof rr&&arguments[1]instanceof Pn)for(var A=arguments[0],t=arguments[1],n=arguments[2],i=A.getCoordinates(),r=new de,e=0;e<i.length-1;e++){r.setCoordinates(i[e],i[e+1]);var s=r.closestPoint(t);n.setMinimum(s,t)}else if(arguments[2]instanceof ms&&arguments[0]instanceof or&&arguments[1]instanceof Pn){var u=arguments[0],o=arguments[1],h=arguments[2];ps.computeDistance(u.getExteriorRing(),o,h);for(var f=0;f<u.getNumInteriorRing();f++)ps.computeDistance(u.getInteriorRingN(f),o,h)}else if(arguments[2]instanceof ms&&arguments[0]instanceof ni&&arguments[1]instanceof Pn){var c=arguments[0],a=arguments[1],v=arguments[2];if(c instanceof rr)ps.computeDistance(c,a,v);else if(c instanceof or)ps.computeDistance(c,a,v);else if(c instanceof qi)for(var l=c,w=0;w<l.getNumGeometries();w++){var P=l.getGeometryN(w);ps.computeDistance(P,a,v)}else v.setMinimum(c.getCoordinate(),a)}else if(arguments[2]instanceof ms&&arguments[0]instanceof de&&arguments[1]instanceof Pn){var g=arguments[0],C=arguments[1],D=arguments[2],I=g.closestPoint(C);D.setMinimum(I,C)}};var Ls=function(A){this.De=new ms,this.Ir=A||null},Ts={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Ls.prototype.computeMaxMidpointDistance=function(A){var t=new Fs(this.Ir);A.apply(t),this.De.setMaximum(t.getMaxPointDistance())},Ls.prototype.computeMaxVertexDistance=function(A){var t=new Os(this.Ir);A.apply(t),this.De.setMaximum(t.getMaxPointDistance())},Ls.prototype.findDistance=function(A){return this.computeMaxVertexDistance(A),this.computeMaxMidpointDistance(A),this.De.getDistance()},Ls.prototype.getDistancePoints=function(){return this.De},Ls.prototype.interfaces_=function(){return[]},Ls.prototype.getClass=function(){return Ls},Ts.MaxPointDistanceFilter.get=function(){return Os},Ts.MaxMidpointDistanceFilter.get=function(){return Fs},Object.defineProperties(Ls,Ts);var Os=function(A){this.De=new ms,this.Ie=new ms,this.wn=A||null};Os.prototype.filter=function(A){this.Ie.initialize(),ps.computeDistance(this.wn,A,this.Ie),this.De.setMaximum(this.Ie)},Os.prototype.getMaxPointDistance=function(){return this.De},Os.prototype.interfaces_=function(){return[ei]},Os.prototype.getClass=function(){return Os};var Fs=function(A){this.De=new ms,this.Ie=new ms,this.wn=A||null};Fs.prototype.filter=function(A,t){if(0===t)return null;var n=A.getCoordinate(t-1),i=A.getCoordinate(t),r=new Pn((n.x+i.x)/2,(n.y+i.y)/2);this.Ie.initialize(),ps.computeDistance(this.wn,r,this.Ie),this.De.setMaximum(this.Ie)},Fs.prototype.isDone=function(){return!1},Fs.prototype.isGeometryChanged=function(){return!1},Fs.prototype.getMaxPointDistance=function(){return this.De},Fs.prototype.interfaces_=function(){return[Wi]},Fs.prototype.getClass=function(){return Fs};var Es=function(A){this.Me=A||null};Es.prototype.filter=function(A){A instanceof or&&this.Me.add(A)},Es.prototype.interfaces_=function(){return[Yi]},Es.prototype.getClass=function(){return Es},Es.getPolygons=function(){if(1===arguments.length){var A=arguments[0];return Es.getPolygons(A,new gi)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t instanceof or?n.add(t):t instanceof qi&&t.apply(new Es(n)),n}};var Us=function(){if(this.xt=null,this.be=!1,1===arguments.length){var A=arguments[0];this.xt=A}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.xt=t,this.be=n}};Us.prototype.filter=function(A){if(this.be&&A instanceof fr){var t=A.getFactory().createLineString(A.getCoordinateSequence());return this.xt.add(t),null}A instanceof rr&&this.xt.add(A)},Us.prototype.setForceToLineString=function(A){this.be=A},Us.prototype.interfaces_=function(){return[ti]},Us.prototype.getClass=function(){return Us},Us.getGeometry=function(){if(1===arguments.length){var A=arguments[0];return A.getFactory().buildGeometry(Us.getLines(A))}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(Us.getLines(t,n))}},Us.getLines=function(){if(1===arguments.length){var A=arguments[0];return Us.getLines(A,!1)}if(2===arguments.length){if(bn(arguments[0],ai)&&bn(arguments[1],ai)){for(var t=arguments[0],n=arguments[1],i=t.iterator();i.hasNext();){var r=i.next();Us.getLines(r,n)}return n}if(arguments[0]instanceof ni&&"boolean"==typeof arguments[1]){var e=arguments[0],s=arguments[1],u=new gi;return e.apply(new Us(u,s)),u}if(arguments[0]instanceof ni&&bn(arguments[1],ai)){var o=arguments[0],h=arguments[1];return o instanceof rr?h.add(o):o.apply(new Us(h)),h}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&bn(arguments[0],ai)&&bn(arguments[1],ai)){for(var f=arguments[0],c=arguments[1],a=arguments[2],v=f.iterator();v.hasNext();){var l=v.next();Us.getLines(l,c,a)}return c}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ni&&bn(arguments[1],ai)){var w=arguments[0],P=arguments[1],g=arguments[2];return w.apply(new Us(P,g)),P}}};var js=function(){if(this.ze=si.OGC_SFS_BOUNDARY_RULE,this.xe=null,this.de=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];if(null===A)throw new hn("Rule must be non-null");this.ze=A}};js.prototype.locateInternal=function(){var A=this;if(arguments[0]instanceof Pn&&arguments[1]instanceof or){var t=arguments[0],n=arguments[1];if(n.isEmpty())return In.EXTERIOR;var i=n.getExteriorRing(),r=this.locateInPolygonRing(t,i);if(r===In.EXTERIOR)return In.EXTERIOR;if(r===In.BOUNDARY)return In.BOUNDARY;for(var e=0;e<n.getNumInteriorRing();e++){var s=n.getInteriorRingN(e),u=A.locateInPolygonRing(t,s);if(u===In.INTERIOR)return In.EXTERIOR;if(u===In.BOUNDARY)return In.BOUNDARY}return In.INTERIOR}if(arguments[0]instanceof Pn&&arguments[1]instanceof rr){var o=arguments[0],h=arguments[1];if(!h.getEnvelopeInternal().intersects(o))return In.EXTERIOR;var f=h.getCoordinates();return h.isClosed()||!o.equals(f[0])&&!o.equals(f[f.length-1])?$n.isOnLine(o,f)?In.INTERIOR:In.EXTERIOR:In.BOUNDARY}if(arguments[0]instanceof Pn&&arguments[1]instanceof sr){var c=arguments[0],a=arguments[1],v=a.getCoordinate();return v.equals2D(c)?In.INTERIOR:In.EXTERIOR}},js.prototype.locateInPolygonRing=function(A,t){return t.getEnvelopeInternal().intersects(A)?$n.locatePointInRing(A,t.getCoordinates()):In.EXTERIOR},js.prototype.intersects=function(A,t){return this.locate(A,t)!==In.EXTERIOR},js.prototype.updateLocationInfo=function(A){A===In.INTERIOR&&(this.xe=!0),A===In.BOUNDARY&&this.de++},js.prototype.computeLocation=function(A,t){if(t instanceof sr&&this.updateLocationInfo(this.locateInternal(A,t)),t instanceof rr)this.updateLocationInfo(this.locateInternal(A,t));else if(t instanceof or)this.updateLocationInfo(this.locateInternal(A,t));else if(t instanceof Vi)for(var n=t,i=0;i<n.getNumGeometries();i++){var r=n.getGeometryN(i);this.updateLocationInfo(this.locateInternal(A,r))}else if(t instanceof cr)for(var e=t,s=0;s<e.getNumGeometries();s++){var u=e.getGeometryN(s);this.updateLocationInfo(this.locateInternal(A,u))}else if(t instanceof qi)for(var o=new Ze(t);o.hasNext();){var h=o.next();h!==t&&this.computeLocation(A,h)}},js.prototype.locate=function(A,t){return t.isEmpty()?In.EXTERIOR:t instanceof rr||t instanceof or?this.locateInternal(A,t):(this.xe=!1,this.de=0,this.computeLocation(A,t),this.ze.isInBoundary(this.de)?In.BOUNDARY:this.de>0||this.xe?In.INTERIOR:In.EXTERIOR)},js.prototype.interfaces_=function(){return[]},js.prototype.getClass=function(){return js};var Ns=function A(){if(this.ye=null,this.me=null,this.$r=null,2===arguments.length){var t=arguments[0],n=arguments[1];A.call(this,t,A.INSIDE_AREA,n)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.ye=i,this.me=r,this.$r=e}},Qs={INSIDE_AREA:{configurable:!0}};Ns.prototype.isInsideArea=function(){return this.me===Ns.INSIDE_AREA},Ns.prototype.getCoordinate=function(){return this.$r},Ns.prototype.getGeometryComponent=function(){return this.ye},Ns.prototype.getSegmentIndex=function(){return this.me},Ns.prototype.interfaces_=function(){return[]},Ns.prototype.getClass=function(){return Ns},Qs.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Ns,Qs);var Ss=function(A){this.Nn=A||null};Ss.prototype.filter=function(A){A instanceof sr&&this.Nn.add(A)},Ss.prototype.interfaces_=function(){return[Yi]},Ss.prototype.getClass=function(){return Ss},Ss.getPoints=function(){if(1===arguments.length){var A=arguments[0];return A instanceof sr?fe.singletonList(A):Ss.getPoints(A,new gi)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t instanceof sr?n.add(t):t instanceof qi&&t.apply(new Ss(n)),n}};var Bs=function(){this.pe=null;var A=arguments[0];this.pe=A};Bs.prototype.filter=function(A){(A instanceof sr||A instanceof rr||A instanceof or)&&this.pe.add(new Ns(A,0,A.getCoordinate()))},Bs.prototype.interfaces_=function(){return[Yi]},Bs.prototype.getClass=function(){return Bs},Bs.getLocations=function(A){var t=new gi;return A.apply(new Bs(t)),t};var Rs=function(){if(this.wn=null,this.Le=0,this.Te=new js,this.Oe=null,this.Fe=fn.MAX_VALUE,2===arguments.length){var A=arguments[0],t=arguments[1];this.wn=[A,t],this.Le=0}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.wn=new Array(2).fill(null),this.wn[0]=n,this.wn[1]=i,this.Le=r}};Rs.prototype.computeContainmentDistance=function(){var A=this;if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this.Fe<=this.Le)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=1-n,e=Es.getPolygons(this.wn[n]);if(e.size()>0){var s=Bs.getLocations(this.wn[r]);if(this.computeContainmentDistance(s,e,i),this.Fe<=this.Le)return this.Oe[r]=i[0],this.Oe[n]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&bn(arguments[0],wi)&&bn(arguments[1],wi)){for(var u=arguments[0],o=arguments[1],h=arguments[2],f=0;f<u.size();f++)for(var c=u.get(f),a=0;a<o.size();a++)if(A.computeContainmentDistance(c,o.get(a),h),A.Fe<=A.Le)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ns&&arguments[1]instanceof or){var v=arguments[0],l=arguments[1],w=arguments[2],P=v.getCoordinate();if(In.EXTERIOR!==this.Te.locate(P,l))return this.Fe=0,w[0]=v,w[1]=new Ns(l,P),null}},Rs.prototype.computeMinDistanceLinesPoints=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e);if(this.computeMinDistance(r,s,n),this.Fe<=this.Le)return null}},Rs.prototype.computeFacetDistance=function(){var A=new Array(2).fill(null),t=Us.getLines(this.wn[0]),n=Us.getLines(this.wn[1]),i=Ss.getPoints(this.wn[0]),r=Ss.getPoints(this.wn[1]);return this.computeMinDistanceLines(t,n,A),this.updateMinDistance(A,!1),this.Fe<=this.Le?null:(A[0]=null,A[1]=null,this.computeMinDistanceLinesPoints(t,r,A),this.updateMinDistance(A,!1),this.Fe<=this.Le?null:(A[0]=null,A[1]=null,this.computeMinDistanceLinesPoints(n,i,A),this.updateMinDistance(A,!0),this.Fe<=this.Le?null:(A[0]=null,A[1]=null,this.computeMinDistancePoints(i,r,A),void this.updateMinDistance(A,!1))))},Rs.prototype.nearestLocations=function(){return this.computeMinDistance(),this.Oe},Rs.prototype.updateMinDistance=function(A,t){if(null===A[0])return null;t?(this.Oe[0]=A[1],this.Oe[1]=A[0]):(this.Oe[0]=A[0],this.Oe[1]=A[1])},Rs.prototype.nearestPoints=function(){return this.computeMinDistance(),[this.Oe[0].getCoordinate(),this.Oe[1].getCoordinate()]},Rs.prototype.computeMinDistance=function(){var A=this;if(0===arguments.length){if(null!==this.Oe)return null;if(this.Oe=new Array(2).fill(null),this.computeContainmentDistance(),this.Fe<=this.Le)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof rr&&arguments[1]instanceof sr){var t=arguments[0],n=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this.Fe)return null;for(var r=t.getCoordinates(),e=n.getCoordinate(),s=0;s<r.length-1;s++){var u=$n.distancePointLine(e,r[s],r[s+1]);if(u<A.Fe){A.Fe=u;var o=new de(r[s],r[s+1]),h=o.closestPoint(e);i[0]=new Ns(t,s,h),i[1]=new Ns(n,0,e)}if(A.Fe<=A.Le)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof rr&&arguments[1]instanceof rr){var f=arguments[0],c=arguments[1],a=arguments[2];if(f.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this.Fe)return null;for(var v=f.getCoordinates(),l=c.getCoordinates(),w=0;w<v.length-1;w++)for(var P=0;P<l.length-1;P++){var g=$n.distanceLineLine(v[w],v[w+1],l[P],l[P+1]);if(g<A.Fe){A.Fe=g;var C=new de(v[w],v[w+1]),D=new de(l[P],l[P+1]),I=C.closestPoints(D);a[0]=new Ns(f,w,I[0]),a[1]=new Ns(c,P,I[1])}if(A.Fe<=A.Le)return null}}},Rs.prototype.computeMinDistancePoints=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e),u=r.getCoordinate().distance(s.getCoordinate());if(u<this.Fe&&(this.Fe=u,n[0]=new Ns(r,0,r.getCoordinate()),n[1]=new Ns(s,0,s.getCoordinate())),this.Fe<=this.Le)return null}},Rs.prototype.distance=function(){if(null===this.wn[0]||null===this.wn[1])throw new hn("null geometries are not supported");return this.wn[0].isEmpty()||this.wn[1].isEmpty()?0:(this.computeMinDistance(),this.Fe)},Rs.prototype.computeMinDistanceLines=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e);if(this.computeMinDistance(r,s,n),this.Fe<=this.Le)return null}},Rs.prototype.interfaces_=function(){return[]},Rs.prototype.getClass=function(){return Rs},Rs.distance=function(A,t){return new Rs(A,t).distance()},Rs.isWithinDistance=function(A,t,n){return new Rs(A,t,n).distance()<=n},Rs.nearestPoints=function(A,t){return new Rs(A,t).nearestPoints()};var ks=function(){this.$r=[new Pn,new Pn],this.Pi=fn.NaN,this.Ce=!0};ks.prototype.getCoordinates=function(){return this.$r},ks.prototype.getCoordinate=function(A){return this.$r[A]},ks.prototype.setMinimum=function(){if(1===arguments.length){var A=arguments[0];this.setMinimum(A.$r[0],A.$r[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.Ce)return this.initialize(t,n),null;var i=t.distance(n);i<this.Pi&&this.initialize(t,n,i)}},ks.prototype.initialize=function(){if(0===arguments.length)this.Ce=!0;else if(2===arguments.length){var A=arguments[0],t=arguments[1];this.$r[0].setCoordinate(A),this.$r[1].setCoordinate(t),this.Pi=A.distance(t),this.Ce=!1}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.$r[0].setCoordinate(n),this.$r[1].setCoordinate(i),this.Pi=r,this.Ce=!1}},ks.prototype.toString=function(){return Wn.toLineString(this.$r[0],this.$r[1])},ks.prototype.getDistance=function(){return this.Pi},ks.prototype.setMaximum=function(){if(1===arguments.length){var A=arguments[0];this.setMaximum(A.$r[0],A.$r[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.Ce)return this.initialize(t,n),null;var i=t.distance(n);i>this.Pi&&this.initialize(t,n,i)}},ks.prototype.interfaces_=function(){return[]},ks.prototype.getClass=function(){return ks};var Gs=function(){};Gs.prototype.interfaces_=function(){return[]},Gs.prototype.getClass=function(){return Gs},Gs.computeDistance=function(){if(arguments[2]instanceof ks&&arguments[0]instanceof rr&&arguments[1]instanceof Pn)for(var A=arguments[0],t=arguments[1],n=arguments[2],i=new de,r=A.getCoordinates(),e=0;e<r.length-1;e++){i.setCoordinates(r[e],r[e+1]);var s=i.closestPoint(t);n.setMinimum(s,t)}else if(arguments[2]instanceof ks&&arguments[0]instanceof or&&arguments[1]instanceof Pn){var u=arguments[0],o=arguments[1],h=arguments[2];Gs.computeDistance(u.getExteriorRing(),o,h);for(var f=0;f<u.getNumInteriorRing();f++)Gs.computeDistance(u.getInteriorRingN(f),o,h)}else if(arguments[2]instanceof ks&&arguments[0]instanceof ni&&arguments[1]instanceof Pn){var c=arguments[0],a=arguments[1],v=arguments[2];if(c instanceof rr)Gs.computeDistance(c,a,v);else if(c instanceof or)Gs.computeDistance(c,a,v);else if(c instanceof qi)for(var l=c,w=0;w<l.getNumGeometries();w++){var P=l.getGeometryN(w);Gs.computeDistance(P,a,v)}else v.setMinimum(c.getCoordinate(),a)}else if(arguments[2]instanceof ks&&arguments[0]instanceof de&&arguments[1]instanceof Pn){var g=arguments[0],C=arguments[1],D=arguments[2],I=g.closestPoint(C);D.setMinimum(I,C)}};var Ys=function(){this.Ee=null,this.Ue=null,this.je=new ks,this.Ne=0;var A=arguments[0],t=arguments[1];this.Ee=A,this.Ue=t},Ws={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Ys.prototype.getCoordinates=function(){return this.je.getCoordinates()},Ys.prototype.setDensifyFraction=function(A){if(A>1||A<=0)throw new hn("Fraction is not in range (0.0 - 1.0]");this.Ne=A},Ys.prototype.compute=function(A,t){this.computeOrientedDistance(A,t,this.je),this.computeOrientedDistance(t,A,this.je)},Ys.prototype.distance=function(){return this.compute(this.Ee,this.Ue),this.je.getDistance()},Ys.prototype.computeOrientedDistance=function(A,t,n){var i=new qs(t);if(A.apply(i),n.setMaximum(i.getMaxPointDistance()),this.Ne>0){var r=new Vs(t,this.Ne);A.apply(r),n.setMaximum(r.getMaxPointDistance())}},Ys.prototype.orientedDistance=function(){return this.computeOrientedDistance(this.Ee,this.Ue,this.je),this.je.getDistance()},Ys.prototype.interfaces_=function(){return[]},Ys.prototype.getClass=function(){return Ys},Ys.distance=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new Ys(A,t);return n.distance()}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=new Ys(i,r);return s.setDensifyFraction(e),s.distance()}},Ws.MaxPointDistanceFilter.get=function(){return qs},Ws.MaxDensifiedByFractionDistanceFilter.get=function(){return Vs},Object.defineProperties(Ys,Ws);var qs=function(){this.De=new ks,this.Ie=new ks,this.Qe=new Gs,this.wn=null;var A=arguments[0];this.wn=A};qs.prototype.filter=function(A){this.Ie.initialize(),Gs.computeDistance(this.wn,A,this.Ie),this.De.setMaximum(this.Ie)},qs.prototype.getMaxPointDistance=function(){return this.De},qs.prototype.interfaces_=function(){return[ei]},qs.prototype.getClass=function(){return qs};var Vs=function(){this.De=new ks,this.Ie=new ks,this.wn=null,this.Se=0;var A=arguments[0],t=arguments[1];this.wn=A,this.Se=Math.trunc(Math.round(1/t))};Vs.prototype.filter=function(A,t){if(0===t)return null;for(var n=A.getCoordinate(t-1),i=A.getCoordinate(t),r=(i.x-n.x)/this.Se,e=(i.y-n.y)/this.Se,s=0;s<this.Se;s++){var h=new Pn(n.x+s*r,n.y+s*e);this.Ie.initialize(),Gs.computeDistance(this.wn,h,this.Ie),this.De.setMaximum(this.Ie)}},Vs.prototype.isDone=function(){return!1},Vs.prototype.isGeometryChanged=function(){return!1},Vs.prototype.getMaxPointDistance=function(){return this.De},Vs.prototype.interfaces_=function(){return[Wi]},Vs.prototype.getClass=function(){return Vs};var Ks=function(A,t,n){this.Be=null,this.Re=null,this.ke=null,this.Ge=null,this.Ye=!0,this.We=null,this.qe=null,this.Ve=null,this.Ke=A||null,this.He=t||null,this.Xt=n||null},Hs={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Ks.prototype.checkMaximumDistance=function(A,t,n){var i=new Ys(t,A);if(i.setDensifyFraction(.25),this.Ge=i.orientedDistance(),this.Ge>n){this.Ye=!1;var r=i.getCoordinates();this.qe=r[1],this.Ve=A.getFactory().createLineString(r),this.We="Distance between buffer curve and input is too large ("+this.Ge+" at "+Wn.toLineString(r[0],r[1])+")"}},Ks.prototype.isValid=function(){var A=Math.abs(this.He),t=Ks.MAX_DISTANCE_DIFF_FRAC*A;return this.Be=A-t,this.Re=A+t,!(!this.Ke.isEmpty()&&!this.Xt.isEmpty())||(this.He>0?this.checkPositiveValid():this.checkNegativeValid(),Ks.VERBOSE&&Nn.out.println("Min Dist= "+this.ke+"  err= "+(1-this.ke/this.He)+"  Max Dist= "+this.Ge+"  err= "+(this.Ge/this.He-1)),this.Ye)},Ks.prototype.checkNegativeValid=function(){if(!(this.Ke instanceof or||this.Ke instanceof cr||this.Ke instanceof qi))return null;var A=this.getPolygonLines(this.Ke);if(this.checkMinimumDistance(A,this.Xt,this.Be),!this.Ye)return null;this.checkMaximumDistance(A,this.Xt,this.Re)},Ks.prototype.getErrorIndicator=function(){return this.Ve},Ks.prototype.checkMinimumDistance=function(A,t,n){var i=new Rs(A,t,n);if(this.ke=i.distance(),this.ke<n){this.Ye=!1;var r=i.nearestPoints();this.qe=i.nearestPoints()[1],this.Ve=A.getFactory().createLineString(r),this.We="Distance between buffer curve and input is too small ("+this.ke+" at "+Wn.toLineString(r[0],r[1])+" )"}},Ks.prototype.checkPositiveValid=function(){var A=this.Xt.getBoundary();if(this.checkMinimumDistance(this.Ke,A,this.Be),!this.Ye)return null;this.checkMaximumDistance(this.Ke,A,this.Re)},Ks.prototype.getErrorLocation=function(){return this.qe},Ks.prototype.getPolygonLines=function(A){for(var t=new gi,n=new Us(t),i=Es.getPolygons(A).iterator();i.hasNext();)i.next().apply(n);return A.getFactory().buildGeometry(t)},Ks.prototype.getErrorMessage=function(){return this.We},Ks.prototype.interfaces_=function(){return[]},Ks.prototype.getClass=function(){return Ks},Hs.VERBOSE.get=function(){return!1},Hs.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Ks,Hs);var _s=function(A,t,n){this.Ye=!0,this._e=null,this.qe=null,this.Ve=null,this.Ke=A||null,this.Pi=t||null,this.Xt=n||null},Js={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};_s.prototype.isValid=function(){return this.checkPolygonal(),this.Ye?(this.checkExpectedEmpty(),this.Ye?(this.checkEnvelope(),this.Ye?(this.checkArea(),this.Ye?(this.checkDistance(),this.Ye):this.Ye):this.Ye):this.Ye):this.Ye},_s.prototype.checkEnvelope=function(){if(this.Pi<0)return null;var A=this.Pi*_s.MAX_ENV_DIFF_FRAC;0===A&&(A=.001);var t=new Sn(this.Ke.getEnvelopeInternal());t.expandBy(this.Pi);var n=new Sn(this.Xt.getEnvelopeInternal());n.expandBy(A),n.contains(t)||(this.Ye=!1,this._e="Buffer envelope is incorrect",this.Ve=this.Ke.getFactory().toGeometry(n)),this.report("Envelope")},_s.prototype.checkDistance=function(){var A=new Ks(this.Ke,this.Pi,this.Xt);A.isValid()||(this.Ye=!1,this._e=A.getErrorMessage(),this.qe=A.getErrorLocation(),this.Ve=A.getErrorIndicator()),this.report("Distance")},_s.prototype.checkArea=function(){var A=this.Ke.getArea(),t=this.Xt.getArea();this.Pi>0&&A>t&&(this.Ye=!1,this._e="Area of positive buffer is smaller than input",this.Ve=this.Xt),this.Pi<0&&A<t&&(this.Ye=!1,this._e="Area of negative buffer is larger than input",this.Ve=this.Xt),this.report("Area")},_s.prototype.checkPolygonal=function(){this.Xt instanceof or||this.Xt instanceof cr||(this.Ye=!1),this._e="Result is not polygonal",this.Ve=this.Xt,this.report("Polygonal")},_s.prototype.getErrorIndicator=function(){return this.Ve},_s.prototype.getErrorLocation=function(){return this.qe},_s.prototype.checkExpectedEmpty=function(){return this.Ke.getDimension()>=2||this.Pi>0?null:(this.Xt.isEmpty()||(this.Ye=!1,this._e="Result is non-empty",this.Ve=this.Xt),void this.report("ExpectedEmpty"))},_s.prototype.report=function(A){if(!_s.VERBOSE)return null;Nn.out.println("Check "+A+": "+(this.Ye?"passed":"FAILED"))},_s.prototype.getErrorMessage=function(){return this._e},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s},_s.isValidMsg=function(A,t,n){var i=new _s(A,t,n);return i.isValid()?null:i.getErrorMessage()},_s.isValid=function(A,t,n){return!!new _s(A,t,n).isValid()},Js.VERBOSE.get=function(){return!1},Js.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(_s,Js);var Zs=function(){this.Nn=null,this.mi=null;var A=arguments[0],t=arguments[1];this.Nn=A,this.mi=t};Zs.prototype.getCoordinates=function(){return this.Nn},Zs.prototype.size=function(){return this.Nn.length},Zs.prototype.getCoordinate=function(A){return this.Nn[A]},Zs.prototype.isClosed=function(){return this.Nn[0].equals(this.Nn[this.Nn.length-1])},Zs.prototype.getSegmentOctant=function(A){return A===this.Nn.length-1?-1:Me.octant(this.getCoordinate(A),this.getCoordinate(A+1))},Zs.prototype.setData=function(A){this.mi=A},Zs.prototype.getData=function(){return this.mi},Zs.prototype.toString=function(){return Wn.toLineString(new gr(this.Nn))},Zs.prototype.interfaces_=function(){return[be]},Zs.prototype.getClass=function(){return Zs};var Xs=function(){this.Je=!1,this.Ze=!1,this.rr=null,this.Xe=null,this.$e=null,this.As=new gi,this.ts=0,this.ns=!0;var A=arguments[0];this.rr=A,this.Xe=null};Xs.prototype.getInteriorIntersection=function(){return this.Xe},Xs.prototype.setCheckEndSegmentsOnly=function(A){this.Ze=A},Xs.prototype.getIntersectionSegments=function(){return this.$e},Xs.prototype.count=function(){return this.ts},Xs.prototype.getIntersections=function(){return this.As},Xs.prototype.setFindAllIntersections=function(A){this.Je=A},Xs.prototype.setKeepIntersections=function(A){this.ns=A},Xs.prototype.processIntersections=function(A,t,n,i){if(!this.Je&&this.hasIntersection())return null;if(A===n&&t===i)return null;if(this.Ze&&!this.isEndSegment(A,t)&&!this.isEndSegment(n,i))return null;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.rr.computeIntersection(r,e,s,u),this.rr.hasIntersection()&&this.rr.isInteriorIntersection()&&(this.$e=new Array(4).fill(null),this.$e[0]=r,this.$e[1]=e,this.$e[2]=s,this.$e[3]=u,this.Xe=this.rr.getIntersection(0),this.ns&&this.As.add(this.Xe),this.ts++)},Xs.prototype.isEndSegment=function(A,t){return 0===t||t>=A.size()-2},Xs.prototype.hasIntersection=function(){return null!==this.Xe},Xs.prototype.isDone=function(){return!this.Je&&null!==this.Xe},Xs.prototype.interfaces_=function(){return[rs]},Xs.prototype.getClass=function(){return Xs},Xs.createAllIntersectionsFinder=function(A){var t=new Xs(A);return t.setFindAllIntersections(!0),t},Xs.createAnyIntersectionFinder=function(A){return new Xs(A)},Xs.createIntersectionCounter=function(A){var t=new Xs(A);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var $s=function(){this.rr=new Jn,this.Xr=null,this.Je=!1,this.Ui=null,this.Ye=!0;var A=arguments[0];this.Xr=A};$s.prototype.execute=function(){if(null!==this.Ui)return null;this.checkInteriorIntersections()},$s.prototype.getIntersections=function(){return this.Ui.getIntersections()},$s.prototype.isValid=function(){return this.execute(),this.Ye},$s.prototype.setFindAllIntersections=function(A){this.Je=A},$s.prototype.checkInteriorIntersections=function(){this.Ye=!0,this.Ui=new Xs(this.rr),this.Ui.setFindAllIntersections(this.Je);var A=new Fe;if(A.setSegmentIntersector(this.Ui),A.computeNodes(this.Xr),this.Ui.hasIntersection())return this.Ye=!1,null},$s.prototype.checkValid=function(){if(this.execute(),!this.Ye)throw new Br(this.getErrorMessage(),this.Ui.getInteriorIntersection())},$s.prototype.getErrorMessage=function(){if(this.Ye)return"no intersections found";var A=this.Ui.getIntersectionSegments();return"found non-noded intersection between "+Wn.toLineString(A[0],A[1])+" and "+Wn.toLineString(A[2],A[3])},$s.prototype.interfaces_=function(){return[]},$s.prototype.getClass=function(){return $s},$s.computeIntersections=function(A){var t=new $s(A);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Au=function A(){this.rs=null;var t=arguments[0];this.rs=new $s(A.toSegmentStrings(t))};Au.prototype.checkValid=function(){this.rs.checkValid()},Au.prototype.interfaces_=function(){return[]},Au.prototype.getClass=function(){return Au},Au.toSegmentStrings=function(A){for(var t=new gi,n=A.iterator();n.hasNext();){var i=n.next();t.add(new Zs(i.getCoordinates(),i))}return t},Au.checkValid=function(A){new Au(A).checkValid()};var tu=function(A){this.es=A};tu.prototype.map=function(A){for(var t=new gi,n=0;n<A.getNumGeometries();n++){var i=this.es.map(A.getGeometryN(n));i.isEmpty()||t.add(i)}return A.getFactory().createGeometryCollection(yr.toGeometryArray(t))},tu.prototype.interfaces_=function(){return[]},tu.prototype.getClass=function(){return tu},tu.map=function(A,t){return new tu(t).map(A)};var nu=function(){this.ss=null,this.Rn=null,this.Te=null,this.us=new gi,this.os=new gi;var A=arguments[0],t=arguments[1],n=arguments[2];this.ss=A,this.Rn=t,this.Te=n};nu.prototype.collectLines=function(A){for(var t=this.ss.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next();this.collectLineEdge(n,A,this.us),this.collectBoundaryTouchEdge(n,A,this.us)}},nu.prototype.labelIsolatedLine=function(A,t){var n=this.Te.locate(A.getCoordinate(),this.ss.getArgGeometry(t));A.getLabel().setLocation(t,n)},nu.prototype.build=function(A){return this.findCoveredLineEdges(),this.collectLines(A),this.buildLines(A),this.os},nu.prototype.collectLineEdge=function(A,t,n){var i=A.getLabel(),r=A.getEdge();A.isLineEdge()&&(A.isVisited()||!Nu.isResultOfOp(i,t)||r.isCovered()||(n.add(r),A.setVisitedEdge(!0)))},nu.prototype.findCoveredLineEdges=function(){for(var A=this.ss.getGraph().getNodes().iterator();A.hasNext();)A.next().getEdges().findCoveredLineEdges();for(var t=this.ss.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next(),i=n.getEdge();if(n.isLineEdge()&&!i.isCoveredSet()){var r=this.ss.isCoveredByA(n.getCoordinate());i.setCovered(r)}}},nu.prototype.labelIsolatedLines=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},nu.prototype.buildLines=function(A){for(var t=this.us.iterator();t.hasNext();){var n=t.next(),i=this.Rn.createLineString(n.getCoordinates());this.os.add(i),n.setInResult(!0)}},nu.prototype.collectBoundaryTouchEdge=function(A,t,n){var i=A.getLabel();return A.isLineEdge()||A.isVisited()||A.isInteriorAreaEdge()||A.getEdge().isInResult()?null:(Kn.isTrue(!(A.isInResult()||A.getSym().isInResult())||!A.getEdge().isInResult()),void(Nu.isResultOfOp(i,t)&&t===Nu.INTERSECTION&&(n.add(A.getEdge()),A.setVisitedEdge(!0))))},nu.prototype.interfaces_=function(){return[]},nu.prototype.getClass=function(){return nu};var iu=function(){this.ss=null,this.Rn=null,this.hs=new gi;var A=arguments[0],t=arguments[1];this.ss=A,this.Rn=t};iu.prototype.filterCoveredNodeToPoint=function(A){var t=A.getCoordinate();if(!this.ss.isCoveredByLA(t)){var n=this.Rn.createPoint(t);this.hs.add(n)}},iu.prototype.extractNonCoveredResultNodes=function(A){for(var t=this.ss.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&A!==Nu.INTERSECTION)){var i=n.getLabel();Nu.isResultOfOp(i,A)&&this.filterCoveredNodeToPoint(n)}}},iu.prototype.build=function(A){return this.extractNonCoveredResultNodes(A),this.hs},iu.prototype.interfaces_=function(){return[]},iu.prototype.getClass=function(){return iu};var ru=function(){this.Ir=null,this.an=null,this.fs=!0,this.cs=!0,this.as=!1,this.vs=!1};ru.prototype.transformPoint=function(A,t){return this.an.createPoint(this.transformCoordinates(A.getCoordinateSequence(),A))},ru.prototype.transformPolygon=function(A,t){var n=!0,i=this.transformLinearRing(A.getExteriorRing(),A);null!==i&&i instanceof fr&&!i.isEmpty()||(n=!1);for(var r=new gi,e=0;e<A.getNumInteriorRing();e++){var s=this.transformLinearRing(A.getInteriorRingN(e),A);null===s||s.isEmpty()||(s instanceof fr||(n=!1),r.add(s))}if(n)return this.an.createPolygon(i,r.toArray([]));var u=new gi;return null!==i&&u.add(i),u.addAll(r),this.an.buildGeometry(u)},ru.prototype.createCoordinateSequence=function(A){return this.an.getCoordinateSequenceFactory().create(A)},ru.prototype.getInputGeometry=function(){return this.Ir},ru.prototype.transformMultiLineString=function(A,t){for(var n=new gi,i=0;i<A.getNumGeometries();i++){var r=this.transformLineString(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.an.buildGeometry(n)},ru.prototype.transformCoordinates=function(A,t){return this.copy(A)},ru.prototype.transformLineString=function(A,t){return this.an.createLineString(this.transformCoordinates(A.getCoordinateSequence(),A))},ru.prototype.transformMultiPoint=function(A,t){for(var n=new gi,i=0;i<A.getNumGeometries();i++){var r=this.transformPoint(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.an.buildGeometry(n)},ru.prototype.transformMultiPolygon=function(A,t){for(var n=new gi,i=0;i<A.getNumGeometries();i++){var r=this.transformPolygon(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.an.buildGeometry(n)},ru.prototype.copy=function(A){return A.copy()},ru.prototype.transformGeometryCollection=function(A,t){for(var n=new gi,i=0;i<A.getNumGeometries();i++){var r=this.transform(A.getGeometryN(i));null!==r&&(this.fs&&r.isEmpty()||n.add(r))}return this.cs?this.an.createGeometryCollection(yr.toGeometryArray(n)):this.an.buildGeometry(n)},ru.prototype.transform=function(A){if(this.Ir=A,this.an=A.getFactory(),A instanceof sr)return this.transformPoint(A,null);if(A instanceof hr)return this.transformMultiPoint(A,null);if(A instanceof fr)return this.transformLinearRing(A,null);if(A instanceof rr)return this.transformLineString(A,null);if(A instanceof Vi)return this.transformMultiLineString(A,null);if(A instanceof or)return this.transformPolygon(A,null);if(A instanceof cr)return this.transformMultiPolygon(A,null);if(A instanceof qi)return this.transformGeometryCollection(A,null);throw new hn("Unknown Geometry subtype: "+A.getClass().getName())},ru.prototype.transformLinearRing=function(A,t){var n=this.transformCoordinates(A.getCoordinateSequence(),A);if(null===n)return this.an.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this.vs?this.an.createLineString(n):this.an.createLinearRing(n)},ru.prototype.interfaces_=function(){return[]},ru.prototype.getClass=function(){return ru};var eu=function A(){if(this.ls=0,this.ws=null,this.Pr=new de,this.Ps=!1,this.gs=!1,arguments[0]instanceof rr&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];A.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];this.ws=i,this.gs=A.isClosed(i),this.ls=r}};eu.prototype.snapVertices=function(A,t){for(var n=this.gs?A.size()-1:A.size(),i=0;i<n;i++){var r=A.get(i),e=this.findSnapForVertex(r,t);null!==e&&(A.set(i,new Pn(e)),0===i&&this.gs&&A.set(A.size()-1,new Pn(e)))}},eu.prototype.findSnapForVertex=function(A,t){for(var n=0;n<t.length;n++){if(A.equals2D(t[n]))return null;if(A.distance(t[n])<this.ls)return t[n]}return null},eu.prototype.snapTo=function(A){var t=new Di(this.ws);return this.snapVertices(t,A),this.snapSegments(t,A),t.toCoordinateArray()},eu.prototype.snapSegments=function(A,t){if(0===t.length)return null;var n=t.length;t[0].equals2D(t[t.length-1])&&(n=t.length-1);for(var i=0;i<n;i++){var r=t[i],e=this.findSegmentIndexToSnap(r,A);e>=0&&A.add(e+1,new Pn(r),!1)}},eu.prototype.findSegmentIndexToSnap=function(A,t){for(var n=fn.MAX_VALUE,i=-1,r=0;r<t.size()-1;r++){if(this.Pr.p0=t.get(r),this.Pr.p1=t.get(r+1),this.Pr.p0.equals2D(A)||this.Pr.p1.equals2D(A)){if(this.Ps)continue;return-1}var e=this.Pr.distance(A);e<this.ls&&e<n&&(n=e,i=r)}return i},eu.prototype.setAllowSnappingToSourceVertices=function(A){this.Ps=A},eu.prototype.interfaces_=function(){return[]},eu.prototype.getClass=function(){return eu},eu.isClosed=function(A){return!(A.length<=1)&&A[0].equals2D(A[A.length-1])};var su=function(A){this.Cs=A||null},uu={SNAP_PRECISION_FACTOR:{configurable:!0}};su.prototype.snapTo=function(A,t){var n=this.extractTargetCoordinates(A);return new ou(t,n).transform(this.Cs)},su.prototype.snapToSelf=function(A,t){var n=this.extractTargetCoordinates(this.Cs),i=new ou(A,n,!0).transform(this.Cs),r=i;return t&&bn(r,ur)&&(r=i.buffer(0)),r},su.prototype.computeSnapTolerance=function(A){return this.computeMinimumSegmentLength(A)/10},su.prototype.extractTargetCoordinates=function(A){for(var t=new Si,n=A.getCoordinates(),i=0;i<n.length;i++)t.add(n[i]);return t.toArray(new Array(0).fill(null))},su.prototype.computeMinimumSegmentLength=function(A){for(var t=fn.MAX_VALUE,n=0;n<A.length-1;n++){var i=A[n].distance(A[n+1]);i<t&&(t=i)}return t},su.prototype.interfaces_=function(){return[]},su.prototype.getClass=function(){return su},su.snap=function(A,t,n){var i=new Array(2).fill(null),r=new su(A);i[0]=r.snapTo(t,n);var e=new su(t);return i[1]=e.snapTo(i[0],n),i},su.computeOverlaySnapTolerance=function(){if(1===arguments.length){var A=arguments[0],t=su.computeSizeBasedSnapTolerance(A),n=A.getPrecisionModel();if(n.getType()===br.FIXED){var i=1/n.getScale()*2/1.415;i>t&&(t=i)}return t}if(2===arguments.length){var r=arguments[0],e=arguments[1];return Math.min(su.computeOverlaySnapTolerance(r),su.computeOverlaySnapTolerance(e))}},su.computeSizeBasedSnapTolerance=function(A){var t=A.getEnvelopeInternal();return Math.min(t.getHeight(),t.getWidth())*su.SNAP_PRECISION_FACTOR},su.snapToSelf=function(A,t,n){return new su(A).snapToSelf(t,n)},uu.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(su,uu);var ou=function(A){function t(t,n,i){A.call(this),this.ls=t||null,this.Ds=n||null,this.Is=void 0!==i&&i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.snapLine=function(A,t){var n=new eu(A,this.ls);return n.setAllowSnappingToSourceVertices(this.Is),n.snapTo(t)},t.prototype.transformCoordinates=function(A,t){var n=A.toCoordinateArray(),i=this.snapLine(n,this.Ds);return this.an.getCoordinateSequenceFactory().create(i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ru),hu=function(){this.Ms=!0,this.bs=53,this.zs=0,this.xs=null};hu.prototype.getCommon=function(){return fn.longBitsToDouble(this.zs)},hu.prototype.add=function(A){var t=fn.doubleToLongBits(A);return this.Ms?(this.zs=t,this.xs=hu.signExpBits(this.zs),this.Ms=!1,null):hu.signExpBits(t)!==this.xs?(this.zs=0,null):(this.bs=hu.numCommonMostSigMantissaBits(this.zs,t),void(this.zs=hu.zeroLowerBits(this.zs,64-(12+this.bs))))},hu.prototype.toString=function(){if(1===arguments.length){var A=arguments[0],t=fn.longBitsToDouble(A),n=fn.toBinaryString(A),i="0000000000000000000000000000000000000000000000000000000000000000"+n,r=i.substring(i.length-64),e=r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]";return e}},hu.prototype.interfaces_=function(){return[]},hu.prototype.getClass=function(){return hu},hu.getBit=function(A,t){return 0!=(A&1<<t)?1:0},hu.signExpBits=function(A){return A>>52},hu.zeroLowerBits=function(A,t){return A&~((1<<t)-1)},hu.numCommonMostSigMantissaBits=function(A,t){for(var n=0,i=52;i>=0;i--){if(hu.getBit(A,i)!==hu.getBit(t,i))return n;n++}return 52};var fu=function(){this.ds=null,this.ys=new au},cu={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};fu.prototype.addCommonBits=function(A){var t=new vu(this.ds);A.apply(t),A.geometryChanged()},fu.prototype.removeCommonBits=function(A){if(0===this.ds.x&&0===this.ds.y)return A;var t=new Pn(this.ds);t.x=-t.x,t.y=-t.y;var n=new vu(t);return A.apply(n),A.geometryChanged(),A},fu.prototype.getCommonCoordinate=function(){return this.ds},fu.prototype.add=function(A){A.apply(this.ys),this.ds=this.ys.getCommonCoordinate()},fu.prototype.interfaces_=function(){return[]},fu.prototype.getClass=function(){return fu},cu.CommonCoordinateFilter.get=function(){return au},cu.Translater.get=function(){return vu},Object.defineProperties(fu,cu);var au=function(){this.ms=new hu,this.ps=new hu};au.prototype.filter=function(A){this.ms.add(A.x),this.ps.add(A.y)},au.prototype.getCommonCoordinate=function(){return new Pn(this.ms.getCommon(),this.ps.getCommon())},au.prototype.interfaces_=function(){return[ei]},au.prototype.getClass=function(){return au};var vu=function(){this.trans=null;var A=arguments[0];this.trans=A};vu.prototype.filter=function(A,t){var n=A.getOrdinate(t,0)+this.trans.x,i=A.getOrdinate(t,1)+this.trans.y;A.setOrdinate(t,0,n),A.setOrdinate(t,1,i)},vu.prototype.isDone=function(){return!1},vu.prototype.isGeometryChanged=function(){return!0},vu.prototype.interfaces_=function(){return[Wi]},vu.prototype.getClass=function(){return vu};var lu=function(A,t){this.wn=new Array(2).fill(null),this.ls=null,this.Ls=null,this.wn[0]=A,this.wn[1]=t,this.computeSnapTolerance()};lu.prototype.selfSnap=function(A){return new su(A).snapTo(A,this.ls)},lu.prototype.removeCommonBits=function(A){this.Ls=new fu,this.Ls.add(A[0]),this.Ls.add(A[1]);var t=new Array(2).fill(null);return t[0]=this.Ls.removeCommonBits(A[0].copy()),t[1]=this.Ls.removeCommonBits(A[1].copy()),t},lu.prototype.prepareResult=function(A){return this.Ls.addCommonBits(A),A},lu.prototype.getResultGeometry=function(A){var t=this.snap(this.wn),n=Nu.overlayOp(t[0],t[1],A);return this.prepareResult(n)},lu.prototype.checkValid=function(A){A.isValid()||Nn.out.println("Snapped geometry is invalid")},lu.prototype.computeSnapTolerance=function(){this.ls=su.computeOverlaySnapTolerance(this.wn[0],this.wn[1])},lu.prototype.snap=function(A){var t=this.removeCommonBits(A);return su.snap(t[0],t[1],this.ls)},lu.prototype.interfaces_=function(){return[]},lu.prototype.getClass=function(){return lu},lu.overlayOp=function(A,t,n){return new lu(A,t).getResultGeometry(n)},lu.union=function(A,t){return lu.overlayOp(A,t,Nu.UNION)},lu.intersection=function(A,t){return lu.overlayOp(A,t,Nu.INTERSECTION)},lu.symDifference=function(A,t){return lu.overlayOp(A,t,Nu.SYMDIFFERENCE)},lu.difference=function(A,t){return lu.overlayOp(A,t,Nu.DIFFERENCE)};var wu=function(A,t){this.wn=new Array(2).fill(null),this.wn[0]=A,this.wn[1]=t};wu.prototype.getResultGeometry=function(A){var t=null,n=!1,i=null;try{t=Nu.overlayOp(this.wn[0],this.wn[1],A),n=!0}catch(A){if(!(A instanceof qn))throw A;i=A}if(!n)try{t=lu.overlayOp(this.wn[0],this.wn[1],A)}catch(A){throw A instanceof qn?i:A}return t},wu.prototype.interfaces_=function(){return[]},wu.prototype.getClass=function(){return wu},wu.overlayOp=function(A,t,n){return new wu(A,t).getResultGeometry(n)},wu.union=function(A,t){return wu.overlayOp(A,t,Nu.UNION)},wu.intersection=function(A,t){return wu.overlayOp(A,t,Nu.INTERSECTION)},wu.symDifference=function(A,t){return wu.overlayOp(A,t,Nu.SYMDIFFERENCE)},wu.difference=function(A,t){return wu.overlayOp(A,t,Nu.DIFFERENCE)};var Pu=function(){this.mce=null,this.chainIndex=null;var A=arguments[0],t=arguments[1];this.mce=A,this.chainIndex=t};Pu.prototype.computeIntersections=function(A,t){this.mce.computeIntersectsForChain(this.chainIndex,A.mce,A.chainIndex,t)},Pu.prototype.interfaces_=function(){return[]},Pu.prototype.getClass=function(){return Pu};var gu=function A(){if(this.Qn=null,this.Ts=null,this.Os=null,this.Fs=null,this.Es=null,this.Us=null,2===arguments.length){var t=arguments[0],n=arguments[1];this.Os=A.DELETE,this.Ts=t,this.Fs=n}else if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.Os=A.INSERT,this.Qn=i,this.Ts=r,this.Us=e}},Cu={INSERT:{configurable:!0},DELETE:{configurable:!0}};gu.prototype.isDelete=function(){return this.Os===gu.DELETE},gu.prototype.setDeleteEventIndex=function(A){this.Es=A},gu.prototype.getObject=function(){return this.Us},gu.prototype.compareTo=function(A){return this.Ts<A.Ts?-1:this.Ts>A.Ts?1:this.Os<A.Os?-1:this.Os>A.Os?1:0},gu.prototype.getInsertEvent=function(){return this.Fs},gu.prototype.isInsert=function(){return this.Os===gu.INSERT},gu.prototype.isSameLabel=function(A){return null!==this.Qn&&this.Qn===A.Qn},gu.prototype.getDeleteEventIndex=function(){return this.Es},gu.prototype.interfaces_=function(){return[an]},gu.prototype.getClass=function(){return gu},Cu.INSERT.get=function(){return 1},Cu.DELETE.get=function(){return 2},Object.defineProperties(gu,Cu);var Du=function(){};Du.prototype.interfaces_=function(){return[]},Du.prototype.getClass=function(){return Du};var Iu=function(){this.jr=!1,this.Nr=!1,this.Qr=!1,this.Br=null,this.rr=null,this.js=null,this.Ns=null,this.Rr=null,this.Qs=0,this.numTests=0,this.Ss=null,this.Bs=!1,this.Rs=!1;var A=arguments[0],t=arguments[1],n=arguments[2];this.rr=A,this.js=t,this.Ns=n};Iu.prototype.isTrivialIntersection=function(A,t,n,i){if(A===n&&1===this.rr.getIntersectionNum()){if(Iu.isAdjacentSegments(t,i))return!0;if(A.isClosed()){var r=A.getNumPoints()-1;if(0===t&&i===r||0===i&&t===r)return!0}}return!1},Iu.prototype.getProperIntersectionPoint=function(){return this.Br},Iu.prototype.setIsDoneIfProperInt=function(A){this.Rs=A},Iu.prototype.hasProperInteriorIntersection=function(){return this.Qr},Iu.prototype.isBoundaryPointInternal=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next().getCoordinate();if(A.isIntersection(i))return!0}return!1},Iu.prototype.hasProperIntersection=function(){return this.Nr},Iu.prototype.hasIntersection=function(){return this.jr},Iu.prototype.isDone=function(){return this.Bs},Iu.prototype.isBoundaryPoint=function(A,t){return!(null===t||!this.isBoundaryPointInternal(A,t[0])&&!this.isBoundaryPointInternal(A,t[1]))},Iu.prototype.setBoundaryNodes=function(A,t){this.Ss=new Array(2).fill(null),this.Ss[0]=A,this.Ss[1]=t},Iu.prototype.addIntersections=function(A,t,n,i){if(A===n&&t===i)return null;this.numTests++;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.rr.computeIntersection(r,e,s,u),this.rr.hasIntersection()&&(this.Ns&&(A.setIsolated(!1),n.setIsolated(!1)),this.Qs++,this.isTrivialIntersection(A,t,n,i)||(this.jr=!0,!this.js&&this.rr.isProper()||(A.addIntersections(this.rr,t,0),n.addIntersections(this.rr,i,1)),this.rr.isProper()&&(this.Br=this.rr.getIntersection(0).copy(),this.Nr=!0,this.Rs&&(this.Bs=!0),this.isBoundaryPoint(this.rr,this.Ss)||(this.Qr=!0))))},Iu.prototype.interfaces_=function(){return[]},Iu.prototype.getClass=function(){return Iu},Iu.isAdjacentSegments=function(A,t){return 1===Math.abs(A-t)};var Mu=function(A){function t(){A.call(this),this.events=new gi,this.nOverlaps=null}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.prepareEvents=function(){fe.sort(this.events);for(var A=0;A<this.events.size();A++){var t=this.events.get(A);t.isDelete()&&t.getInsertEvent().setDeleteEventIndex(A)}},t.prototype.computeIntersections=function(){var A=this;if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var n=0;n<this.events.size();n++){var i=A.events.get(n);if(i.isInsert()&&A.processOverlaps(n,i.getDeleteEventIndex(),i,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Iu&&bn(arguments[0],wi)&&bn(arguments[1],wi)){var r=arguments[0],e=arguments[1],s=arguments[2];this.addEdges(r,r),this.addEdges(e,e),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&bn(arguments[0],wi)&&arguments[1]instanceof Iu){var u=arguments[0],o=arguments[1],h=arguments[2];h?this.addEdges(u,null):this.addEdges(u),this.computeIntersections(o)}},t.prototype.addEdge=function(A,t){for(var n=A.getMonotoneChainEdge(),i=n.getStartIndexes(),r=0;r<i.length-1;r++){var e=new Pu(n,r),s=new gu(t,n.getMinX(r),e);this.events.add(s),this.events.add(new gu(n.getMaxX(r),s))}},t.prototype.processOverlaps=function(A,t,n,i){for(var r=n.getObject(),e=A;e<t;e++){var s=this.events.get(e);if(s.isInsert()){var u=s.getObject();n.isSameLabel(s)||(r.computeIntersections(u,i),this.nOverlaps++)}}},t.prototype.addEdges=function(){var A=this;if(1===arguments.length)for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.addEdge(i,i)}else if(2===arguments.length)for(var r=arguments[0],e=arguments[1],s=r.iterator();s.hasNext();){var u=s.next();A.addEdge(u,e)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Du),bu=function(){this.ks=fn.POSITIVE_INFINITY,this.dr=fn.NEGATIVE_INFINITY},zu={NodeComparator:{configurable:!0}};bu.prototype.getMin=function(){return this.ks},bu.prototype.intersects=function(A,t){return!(this.ks>t||this.dr<A)},bu.prototype.getMax=function(){return this.dr},bu.prototype.toString=function(){return Wn.toLineString(new Pn(this.ks,0),new Pn(this.dr,0))},bu.prototype.interfaces_=function(){return[]},bu.prototype.getClass=function(){return bu},zu.NodeComparator.get=function(){return xu},Object.defineProperties(bu,zu);var xu=function(){};xu.prototype.compare=function(A,t){var r=(A.ks+A.dr)/2,e=(t.ks+t.dr)/2;return r<e?-1:r>e?1:0},xu.prototype.interfaces_=function(){return[ln]},xu.prototype.getClass=function(){return xu};var du=function(A){function t(){A.call(this),this.hi=null;var t=arguments[0],n=arguments[1],i=arguments[2];this.ks=t,this.dr=n,this.hi=i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.query=function(A,t,n){if(!this.intersects(A,t))return null;n.visitItem(this.hi)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(bu),yu=function(A){function t(){A.call(this),this.Gs=null,this.Ys=null;var t=arguments[0],n=arguments[1];this.Gs=t,this.Ys=n,this.buildExtent(this.Gs,this.Ys)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.buildExtent=function(A,t){this.ks=Math.min(A.ks,t.ks),this.dr=Math.max(A.dr,t.dr)},t.prototype.query=function(A,t,n){if(!this.intersects(A,t))return null;null!==this.Gs&&this.Gs.query(A,t,n),null!==this.Ys&&this.Ys.query(A,t,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(bu),mu=function(){this.Ws=new gi,this.Ci=null,this.vi=0};mu.prototype.buildTree=function(){fe.sort(this.Ws,new bu.NodeComparator);for(var A=this.Ws,t=null,n=new gi;;){if(this.buildLevel(A,n),1===n.size())return n.get(0);t=A,A=n,n=t}},mu.prototype.insert=function(A,t,n){if(null!==this.Ci)throw new Error("Index cannot be added to once it has been queried");this.Ws.add(new du(A,t,n))},mu.prototype.query=function(A,t,n){this.init(),this.Ci.query(A,t,n)},mu.prototype.buildRoot=function(){if(null!==this.Ci)return null;this.Ci=this.buildTree()},mu.prototype.printNode=function(A){Nn.out.println(Wn.toLineString(new Pn(A.ks,this.vi),new Pn(A.dr,this.vi)))},mu.prototype.init=function(){if(null!==this.Ci)return null;this.buildRoot()},mu.prototype.buildLevel=function(A,t){this.vi++,t.clear();for(var n=0;n<A.size();n+=2){var i=A.get(n);if(null===(n+1<A.size()?A.get(n):null))t.add(i);else{var r=new yu(A.get(n),A.get(n+1));t.add(r)}}},mu.prototype.interfaces_=function(){return[]},mu.prototype.getClass=function(){return mu};var pu=function(){this.ci=new gi};pu.prototype.visitItem=function(A){this.ci.add(A)},pu.prototype.getItems=function(){return this.ci},pu.prototype.interfaces_=function(){return[se]},pu.prototype.getClass=function(){return pu};var Lu=function(){this.Ni=null;var A=arguments[0];if(!bn(A,ur))throw new hn("Argument must be Polygonal");this.Ni=new Fu(A)},Tu={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Lu.prototype.locate=function(A){var t=new Xn(A),n=new Ou(t);return this.Ni.query(A.y,A.y,n),t.getLocation()},Lu.prototype.interfaces_=function(){return[Je]},Lu.prototype.getClass=function(){return Lu},Tu.SegmentVisitor.get=function(){return Ou},Tu.IntervalIndexedGeometry.get=function(){return Fu},Object.defineProperties(Lu,Tu);var Ou=function(){this.qs=null;var A=arguments[0];this.qs=A};Ou.prototype.visitItem=function(A){var t=A;this.qs.countSegment(t.getCoordinate(0),t.getCoordinate(1))},Ou.prototype.interfaces_=function(){return[se]},Ou.prototype.getClass=function(){return Ou};var Fu=function(){this.Ni=new mu;var A=arguments[0];this.init(A)};Fu.prototype.init=function(A){for(var t=Us.getLines(A).iterator();t.hasNext();){var n=t.next().getCoordinates();this.addLine(n)}},Fu.prototype.addLine=function(A){for(var t=1;t<A.length;t++){var n=new de(A[t-1],A[t]),i=Math.min(n.p0.y,n.p1.y),r=Math.max(n.p0.y,n.p1.y);this.Ni.insert(i,r,n)}},Fu.prototype.query=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new pu;return this.Ni.query(A,t,n),n.getItems()}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.Ni.query(i,r,e)}},Fu.prototype.interfaces_=function(){return[]},Fu.prototype.getClass=function(){return Fu};var Eu=function(A){function t(){if(A.call(this),this.Vs=null,this.Ks=new Mr,this.Hs=null,this._s=!0,this.Js=null,this.Zs=null,this.Xs=!1,this.$s=null,this.Au=null,this.Te=new js,2===arguments.length){var t=arguments[0],n=arguments[1],i=si.OGC_SFS_BOUNDARY_RULE;this.Js=t,this.Vs=n,this.Hs=i,null!==n&&this.add(n)}else if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];this.Js=r,this.Vs=e,this.Hs=s,null!==e&&this.add(e)}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.insertBoundaryPoint=function(A,n){var i=this.Tn.addNode(n).getLabel(),r=1;i.getLocation(A,Ur.ON)===In.BOUNDARY&&r++;var e=t.determineBoundary(this.Hs,r);i.setLocation(A,e)},t.prototype.computeSelfNodes=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];return this.computeSelfNodes(A,t,!1)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],e=new Iu(n,!0,!1);e.setIsDoneIfProperInt(r);var s=this.createEdgeSetIntersector(),u=this.Vs instanceof fr||this.Vs instanceof or||this.Vs instanceof cr,o=i||!u;return s.computeIntersections(this.jn,e,o),this.addSelfIntersectionNodes(this.Js),e}},t.prototype.computeSplitEdges=function(A){for(var t=this.jn.iterator();t.hasNext();)t.next().eiList.addSplitEdges(A)},t.prototype.computeEdgeIntersections=function(A,t,n){var i=new Iu(t,n,!0);return i.setBoundaryNodes(this.getBoundaryNodes(),A.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this.jn,A.jn,i),i},t.prototype.getGeometry=function(){return this.Vs},t.prototype.getBoundaryNodeRule=function(){return this.Hs},t.prototype.hasTooFewPoints=function(){return this.Xs},t.prototype.addPoint=function(){if(arguments[0]instanceof sr){var A=arguments[0],t=A.getCoordinate();this.insertPoint(this.Js,t,In.INTERIOR)}else if(arguments[0]instanceof Pn){var n=arguments[0];this.insertPoint(this.Js,n,In.INTERIOR)}},t.prototype.addPolygon=function(A){this.addPolygonRing(A.getExteriorRing(),In.EXTERIOR,In.INTERIOR);for(var t=0;t<A.getNumInteriorRing();t++){var n=A.getInteriorRingN(t);this.addPolygonRing(n,In.INTERIOR,In.EXTERIOR)}},t.prototype.addEdge=function(A){this.insertEdge(A);var t=A.getCoordinates();this.insertPoint(this.Js,t[0],In.BOUNDARY),this.insertPoint(this.Js,t[t.length-1],In.BOUNDARY)},t.prototype.addLineString=function(A){var t=Ii.removeRepeatedPoints(A.getCoordinates());if(t.length<2)return this.Xs=!0,this.$s=t[0],null;var n=new as(t,new Yr(this.Js,In.INTERIOR));this.Ks.put(A,n),this.insertEdge(n),Kn.isTrue(t.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this.Js,t[0]),this.insertBoundaryPoint(this.Js,t[t.length-1])},t.prototype.getInvalidPoint=function(){return this.$s},t.prototype.getBoundaryPoints=function(){for(var A=this.getBoundaryNodes(),t=new Array(A.size()).fill(null),n=0,i=A.iterator();i.hasNext();){var r=i.next();t[n++]=r.getCoordinate().copy()}return t},t.prototype.getBoundaryNodes=function(){return null===this.Zs&&(this.Zs=this.Tn.getBoundaryNodes(this.Js)),this.Zs},t.prototype.addSelfIntersectionNode=function(A,t,n){if(this.isBoundaryNode(A,t))return null;n===In.BOUNDARY&&this._s?this.insertBoundaryPoint(A,t):this.insertPoint(A,t,n)},t.prototype.addPolygonRing=function(A,t,n){if(A.isEmpty())return null;var i=Ii.removeRepeatedPoints(A.getCoordinates());if(i.length<4)return this.Xs=!0,this.$s=i[0],null;var r=t,e=n;$n.isCCW(i)&&(r=n,e=t);var s=new as(i,new Yr(this.Js,In.BOUNDARY,r,e));this.Ks.put(A,s),this.insertEdge(s),this.insertPoint(this.Js,i[0],In.BOUNDARY)},t.prototype.insertPoint=function(A,t,n){var i=this.Tn.addNode(t),r=i.getLabel();null===r?i.Qn=new Yr(A,n):r.setLocation(A,n)},t.prototype.createEdgeSetIntersector=function(){return new Mu},t.prototype.addSelfIntersectionNodes=function(A){for(var t=this.jn.iterator();t.hasNext();)for(var n=t.next(),i=n.getLabel().getLocation(A),r=n.eiList.iterator();r.hasNext();){var e=r.next();this.addSelfIntersectionNode(A,e.coord,i)}},t.prototype.add=function(){if(1!==arguments.length)return A.prototype.add.apply(this,arguments);var t=arguments[0];if(t.isEmpty())return null;if(t instanceof cr&&(this._s=!1),t instanceof or)this.addPolygon(t);else if(t instanceof rr)this.addLineString(t);else if(t instanceof sr)this.addPoint(t);else if(t instanceof hr)this.addCollection(t);else if(t instanceof Vi)this.addCollection(t);else if(t instanceof cr)this.addCollection(t);else{if(!(t instanceof qi))throw new Error(t.getClass().getName());this.addCollection(t)}},t.prototype.addCollection=function(A){for(var t=0;t<A.getNumGeometries();t++){var n=A.getGeometryN(t);this.add(n)}},t.prototype.locate=function(A){return bn(this.Vs,ur)&&this.Vs.getNumGeometries()>50?(null===this.Au&&(this.Au=new Lu(this.Vs)),this.Au.locate(A)):this.Te.locate(A,this.Vs)},t.prototype.findEdge=function(){if(1===arguments.length){var t=arguments[0];return this.Ks.get(t)}return A.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(A,t){return A.isInBoundary(t)?In.BOUNDARY:In.INTERIOR},t}(te),Uu=function(){if(this.rr=new Jn,this.tu=null,this.nu=null,1===arguments.length){var A=arguments[0];this.setComputationPrecision(A.getPrecisionModel()),this.nu=new Array(1).fill(null),this.nu[0]=new Eu(0,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1],i=si.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this.nu=new Array(2).fill(null),this.nu[0]=new Eu(0,t,i),this.nu[1]=new Eu(1,n,i)}else if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];r.getPrecisionModel().compareTo(e.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(e.getPrecisionModel()),this.nu=new Array(2).fill(null),this.nu[0]=new Eu(0,r,s),this.nu[1]=new Eu(1,e,s)}};Uu.prototype.getArgGeometry=function(A){return this.nu[A].getGeometry()},Uu.prototype.setComputationPrecision=function(A){this.tu=A,this.rr.setPrecisionModel(this.tu)},Uu.prototype.interfaces_=function(){return[]},Uu.prototype.getClass=function(){return Uu};var ju=function(){};ju.prototype.interfaces_=function(){return[]},ju.prototype.getClass=function(){return ju},ju.map=function(){if(arguments[0]instanceof ni&&bn(arguments[1],ju.MapOp)){for(var A=arguments[0],t=arguments[1],n=new gi,i=0;i<A.getNumGeometries();i++){var r=t.map(A.getGeometryN(i));null!==r&&n.add(r)}return A.getFactory().buildGeometry(n)}if(bn(arguments[0],ai)&&bn(arguments[1],ju.MapOp)){for(var e=arguments[0],s=arguments[1],u=new gi,o=e.iterator();o.hasNext();){var h=o.next(),f=s.map(h);null!==f&&u.add(f)}return u}},ju.MapOp=function(){};var Nu=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n),this.Te=new js,this.Pn=null,this.iu=null,this.Vr=null,this.pr=new is,this.ru=new gi,this.os=new gi,this.hs=new gi,this.Vr=new te(new ts),this.Pn=t.getFactory()}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.insertUniqueEdge=function(A){var t=this.pr.findEqualEdge(A);if(null!==t){var n=t.getLabel(),i=A.getLabel();t.isPointwiseEqual(A)||(i=new Yr(A.getLabel())).flip();var r=t.getDepth();r.isNull()&&r.add(n),r.add(i),n.merge(i)}else this.pr.add(A)},t.prototype.getGraph=function(){return this.Vr},t.prototype.cancelDuplicateResultEdges=function(){for(var A=this.Vr.getEdgeEnds().iterator();A.hasNext();){var t=A.next(),n=t.getSym();t.isInResult()&&n.isInResult()&&(t.setInResult(!1),n.setInResult(!1))}},t.prototype.isCoveredByLA=function(A){return!!this.isCovered(A,this.os)||!!this.isCovered(A,this.ru)},t.prototype.computeGeometry=function(A,n,i,r){var e=new gi;return e.addAll(A),e.addAll(n),e.addAll(i),e.isEmpty()?t.createEmptyResult(r,this.nu[0].getGeometry(),this.nu[1].getGeometry(),this.Pn):this.Pn.buildGeometry(e)},t.prototype.mergeSymLabels=function(){for(var A=this.Vr.getNodes().iterator();A.hasNext();)A.next().getEdges().mergeSymLabels()},t.prototype.isCovered=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();if(this.Te.locate(A,i)!==In.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var A=new gi,t=this.pr.iterator();t.hasNext();){var n=t.next();n.isCollapsed()&&(t.remove(),A.add(n.getCollapsedEdge()))}this.pr.addAll(A)},t.prototype.updateNodeLabelling=function(){for(var A=this.Vr.getNodes().iterator();A.hasNext();){var t=A.next(),n=t.getEdges().getLabel();t.getLabel().merge(n)}},t.prototype.getResultGeometry=function(A){return this.computeOverlay(A),this.iu},t.prototype.insertUniqueEdges=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();this.insertUniqueEdge(n)}},t.prototype.computeOverlay=function(A){this.copyPoints(0),this.copyPoints(1),this.nu[0].computeSelfNodes(this.rr,!1),this.nu[1].computeSelfNodes(this.rr,!1),this.nu[0].computeEdgeIntersections(this.nu[1],this.rr,!0);var t=new gi;this.nu[0].computeSplitEdges(t),this.nu[1].computeSplitEdges(t),this.insertUniqueEdges(t),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Au.checkValid(this.pr.getEdges()),this.Vr.addEdges(this.pr.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(A),this.cancelDuplicateResultEdges();var n=new ne(this.Pn);n.add(this.Vr),this.ru=n.getPolygons();var i=new nu(this,this.Pn,this.Te);this.os=i.build(A);var r=new iu(this,this.Pn,this.Te);this.hs=r.build(A),this.iu=this.computeGeometry(this.hs,this.os,this.ru,A)},t.prototype.labelIncompleteNode=function(A,t){var n=this.Te.locate(A.getCoordinate(),this.nu[t].getGeometry());A.getLabel().setLocation(t,n)},t.prototype.copyPoints=function(A){for(var t=this.nu[A].getNodeIterator();t.hasNext();){var n=t.next();this.Vr.addNode(n.getCoordinate()).setLabel(A,n.getLabel().getLocation(A))}},t.prototype.findResultAreaEdges=function(A){for(var n=this.Vr.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea()&&!i.isInteriorAreaEdge()&&t.isResultOfOp(r.getLocation(0,Ur.RIGHT),r.getLocation(1,Ur.RIGHT),A)&&i.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var A=this.pr.iterator();A.hasNext();){var t=A.next(),n=t.getLabel(),i=t.getDepth();if(!i.isNull()){i.normalize();for(var r=0;r<2;r++)n.isNull(r)||!n.isArea()||i.isNull(r)||(0===i.getDelta(r)?n.toLine(r):(Kn.isTrue(!i.isNull(r,Ur.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(r,Ur.LEFT,i.getLocation(r,Ur.LEFT)),Kn.isTrue(!i.isNull(r,Ur.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(r,Ur.RIGHT,i.getLocation(r,Ur.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var A=this.Vr.getNodes().iterator();A.hasNext();)A.next().getEdges().computeLabelling(this.nu);this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var A=this.Vr.getNodes().iterator();A.hasNext();){var t=A.next(),n=t.getLabel();t.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(t,0):this.labelIncompleteNode(t,1)),t.getEdges().updateLabelling(n)}},t.prototype.isCoveredByA=function(A){return!!this.isCovered(A,this.ru)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Uu);Nu.overlayOp=function(A,t,n){return new Nu(A,t).getResultGeometry(n)},Nu.intersection=function(A,t){if(A.isEmpty()||t.isEmpty())return Nu.createEmptyResult(Nu.INTERSECTION,A,t,A.getFactory());if(A.isGeometryCollection()){var n=t;return tu.map(A,{interfaces_:function(){return[ju.MapOp]},map:function(A){return A.intersection(n)}})}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),wu.overlayOp(A,t,Nu.INTERSECTION)},Nu.symDifference=function(A,t){if(A.isEmpty()||t.isEmpty()){if(A.isEmpty()&&t.isEmpty())return Nu.createEmptyResult(Nu.SYMDIFFERENCE,A,t,A.getFactory());if(A.isEmpty())return t.copy();if(t.isEmpty())return A.copy()}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),wu.overlayOp(A,t,Nu.SYMDIFFERENCE)},Nu.resultDimension=function(A,t,n){var i=t.getDimension(),r=n.getDimension(),e=-1;switch(A){case Nu.INTERSECTION:e=Math.min(i,r);break;case Nu.UNION:e=Math.max(i,r);break;case Nu.DIFFERENCE:e=i;break;case Nu.SYMDIFFERENCE:e=Math.max(i,r)}return e},Nu.createEmptyResult=function(A,t,n,i){var r=null;switch(Nu.resultDimension(A,t,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon()}return r},Nu.difference=function(A,t){return A.isEmpty()?Nu.createEmptyResult(Nu.DIFFERENCE,A,t,A.getFactory()):t.isEmpty()?A.copy():(A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),wu.overlayOp(A,t,Nu.DIFFERENCE))},Nu.isResultOfOp=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=A.getLocation(0),i=A.getLocation(1);return Nu.isResultOfOp(n,i,t)}if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];switch(r===In.BOUNDARY&&(r=In.INTERIOR),e===In.BOUNDARY&&(e=In.INTERIOR),s){case Nu.INTERSECTION:return r===In.INTERIOR&&e===In.INTERIOR;case Nu.UNION:return r===In.INTERIOR||e===In.INTERIOR;case Nu.DIFFERENCE:return r===In.INTERIOR&&e!==In.INTERIOR;case Nu.SYMDIFFERENCE:return r===In.INTERIOR&&e!==In.INTERIOR||r!==In.INTERIOR&&e===In.INTERIOR}return!1}},Nu.INTERSECTION=1,Nu.UNION=2,Nu.DIFFERENCE=3,Nu.SYMDIFFERENCE=4;var Qu=function(){this.eu=null,this.su=null,this.uu=null,this.Te=new js,this.Pr=new de;var A=arguments[0],t=arguments[1];this.eu=A,this.su=t,this.uu=this.extractLinework(A)};Qu.prototype.isWithinToleranceOfBoundary=function(A){for(var t=0;t<this.uu.getNumGeometries();t++)for(var n=this.uu.getGeometryN(t).getCoordinateSequence(),i=0;i<n.size()-1;i++)if(n.getCoordinate(i,this.Pr.p0),n.getCoordinate(i+1,this.Pr.p1),this.Pr.distance(A)<=this.su)return!0;return!1},Qu.prototype.getLocation=function(A){return this.isWithinToleranceOfBoundary(A)?In.BOUNDARY:this.Te.locate(A,this.eu)},Qu.prototype.extractLinework=function(A){var t=new Su;A.apply(t);var n=t.getLinework(),i=yr.toLineStringArray(n);return A.getFactory().createMultiLineString(i)},Qu.prototype.interfaces_=function(){return[]},Qu.prototype.getClass=function(){return Qu};var Su=function(){this.uu=null,this.uu=new gi};Su.prototype.getLinework=function(){return this.uu},Su.prototype.filter=function(A){if(A instanceof or){var t=A;this.uu.add(t.getExteriorRing());for(var n=0;n<t.getNumInteriorRing();n++)this.uu.add(t.getInteriorRingN(n))}},Su.prototype.interfaces_=function(){return[Yi]},Su.prototype.getClass=function(){return Su};var Bu=function(){this.eu=null,this.ou=!0,this.hu=!0;var A=arguments[0];this.eu=A};Bu.prototype.extractPoints=function(A,t,n){for(var i=A.getCoordinates(),r=0;r<i.length-1;r++)this.computeOffsetPoints(i[r],i[r+1],t,n)},Bu.prototype.setSidesToGenerate=function(A,t){this.ou=A,this.hu=t},Bu.prototype.getPoints=function(A){for(var t=new gi,n=Us.getLines(this.eu).iterator();n.hasNext();){var i=n.next();this.extractPoints(i,A,t)}return t},Bu.prototype.computeOffsetPoints=function(A,t,n,i){var r=t.x-A.x,e=t.y-A.y,s=Math.sqrt(r*r+e*e),u=n*r/s,o=n*e/s,h=(t.x+A.x)/2,f=(t.y+A.y)/2;if(this.ou){var c=new Pn(h-o,f+u);i.add(c)}if(this.hu){var a=new Pn(h+o,f-u);i.add(a)}},Bu.prototype.interfaces_=function(){return[]},Bu.prototype.getClass=function(){return Bu};var Ru=function A(){this.wn=null,this.fu=null,this.cu=new Array(3).fill(null),this.au=null,this.su=A.TOLERANCE,this.vu=new gi;var t=arguments[0],n=arguments[1],i=arguments[2];this.su=A.computeBoundaryDistanceTolerance(t,n),this.wn=[t,n,i],this.fu=[new Qu(this.wn[0],this.su),new Qu(this.wn[1],this.su),new Qu(this.wn[2],this.su)]},ku={TOLERANCE:{configurable:!0}};Ru.prototype.reportResult=function(A,t,n){Nn.out.println("Overlay result invalid - A:"+In.toLocationSymbol(t[0])+" B:"+In.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+In.toLocationSymbol(t[2]))},Ru.prototype.isValid=function(A){return this.addTestPts(this.wn[0]),this.addTestPts(this.wn[1]),this.checkValid(A)},Ru.prototype.checkValid=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=0;n<this.vu.size();n++){var i=A.vu.get(n);if(!A.checkValid(t,i))return A.au=i,!1}return!0}if(2===arguments.length){var r=arguments[0],e=arguments[1];return this.cu[0]=this.fu[0].getLocation(e),this.cu[1]=this.fu[1].getLocation(e),this.cu[2]=this.fu[2].getLocation(e),!!Ru.hasLocation(this.cu,In.BOUNDARY)||this.isValidResult(r,this.cu)}},Ru.prototype.addTestPts=function(A){var t=new Bu(A);this.vu.addAll(t.getPoints(5*this.su))},Ru.prototype.isValidResult=function(A,t){var n=Nu.isResultOfOp(t[0],t[1],A),i=!(n^t[2]===In.INTERIOR);return i||this.reportResult(A,t,n),i},Ru.prototype.getInvalidLocation=function(){return this.au},Ru.prototype.interfaces_=function(){return[]},Ru.prototype.getClass=function(){return Ru},Ru.hasLocation=function(A,t){for(var n=0;n<3;n++)if(A[n]===t)return!0;return!1},Ru.computeBoundaryDistanceTolerance=function(A,t){return Math.min(su.computeSizeBasedSnapTolerance(A),su.computeSizeBasedSnapTolerance(t))},Ru.isValid=function(A,t,n,i){return new Ru(A,t,i).isValid(n)},ku.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Ru,ku);var Gu=function A(t){this.lu=null,this.wu=!1,this.Pu=null,this.lu=A.extractFactory(t),this.Pu=t};Gu.prototype.extractElements=function(A,t){if(null===A)return null;for(var n=0;n<A.getNumGeometries();n++){var i=A.getGeometryN(n);this.wu&&i.isEmpty()||t.add(i)}},Gu.prototype.combine=function(){for(var A=new gi,t=this.Pu.iterator();t.hasNext();){var n=t.next();this.extractElements(n,A)}return 0===A.size()?null!==this.lu?this.lu.createGeometryCollection(null):null:this.lu.buildGeometry(A)},Gu.prototype.interfaces_=function(){return[]},Gu.prototype.getClass=function(){return Gu},Gu.combine=function(){if(1===arguments.length){var A=arguments[0],t=new Gu(A);return t.combine()}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new Gu(Gu.createList(n,i));return r.combine()}if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=new Gu(Gu.createList(e,s,u));return o.combine()}},Gu.extractFactory=function(A){return A.isEmpty()?null:A.iterator().next().getFactory()},Gu.createList=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new gi;return n.add(A),n.add(t),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=new gi;return s.add(i),s.add(r),s.add(e),s}};var Yu=function(){this.gu=null,this.lu=null;var A=arguments[0];this.gu=A,null===this.gu&&(this.gu=new gi)},Wu={STRTREE_NODE_CAPACITY:{configurable:!0}};Yu.prototype.reduceToGeometries=function(A){for(var t=new gi,n=A.iterator();n.hasNext();){var i=n.next(),r=null;bn(i,wi)?r=this.unionTree(i):i instanceof ni&&(r=i),t.add(r)}return t},Yu.prototype.extractByEnvelope=function(A,t,n){for(var i=new gi,r=0;r<t.getNumGeometries();r++){var e=t.getGeometryN(r);e.getEnvelopeInternal().intersects(A)?i.add(e):n.add(e)}return this.lu.buildGeometry(i)},Yu.prototype.unionOptimized=function(A,t){var n=A.getEnvelopeInternal(),i=t.getEnvelopeInternal();if(!n.intersects(i))return Gu.combine(A,t);if(A.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(A,t);var r=n.intersection(i);return this.unionUsingEnvelopeIntersection(A,t,r)},Yu.prototype.union=function(){if(null===this.gu)throw new Error("union() method cannot be called twice");if(this.gu.isEmpty())return null;this.lu=this.gu.iterator().next().getFactory();for(var A=new Pe(Yu.STRTREE_NODE_CAPACITY),t=this.gu.iterator();t.hasNext();){var n=t.next();A.insert(n.getEnvelopeInternal(),n)}this.gu=null;var i=A.itemsTree();return this.unionTree(i)},Yu.prototype.binaryUnion=function(){if(1===arguments.length){var A=arguments[0];return this.binaryUnion(A,0,A.size())}if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=Yu.getGeometry(t,n);return this.unionSafe(r,null)}if(i-n==2)return this.unionSafe(Yu.getGeometry(t,n),Yu.getGeometry(t,n+1));var e=Math.trunc((i+n)/2),s=this.binaryUnion(t,n,e),u=this.binaryUnion(t,e,i);return this.unionSafe(s,u)}},Yu.prototype.repeatedUnion=function(A){for(var t=null,n=A.iterator();n.hasNext();){var i=n.next();t=null===t?i.copy():t.union(i)}return t},Yu.prototype.unionSafe=function(A,t){return null===A&&null===t?null:null===A?t.copy():null===t?A.copy():this.unionOptimized(A,t)},Yu.prototype.unionActual=function(A,t){return Yu.restrictToPolygons(A.union(t))},Yu.prototype.unionTree=function(A){var t=this.reduceToGeometries(A);return this.binaryUnion(t)},Yu.prototype.unionUsingEnvelopeIntersection=function(A,t,n){var i=new gi,r=this.extractByEnvelope(n,A,i),e=this.extractByEnvelope(n,t,i),s=this.unionActual(r,e);return i.add(s),Gu.combine(i)},Yu.prototype.bufferUnion=function(){if(1===arguments.length){var A=arguments[0],t=A.get(0).getFactory(),n=t.buildGeometry(A),i=n.buffer(0);return i}if(2===arguments.length){var r=arguments[0],e=arguments[1],s=r.getFactory(),u=s.createGeometryCollection([r,e]),o=u.buffer(0);return o}},Yu.prototype.interfaces_=function(){return[]},Yu.prototype.getClass=function(){return Yu},Yu.restrictToPolygons=function(A){if(bn(A,ur))return A;var t=Es.getPolygons(A);return 1===t.size()?t.get(0):A.getFactory().createMultiPolygon(yr.toPolygonArray(t))},Yu.getGeometry=function(A,t){return t>=A.size()?null:A.get(t)},Yu.union=function(A){return new Yu(A).union()},Wu.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Yu,Wu);var qu=function(){};function Vu(){return new Ku}function Ku(){this.reset()}qu.prototype.interfaces_=function(){return[]},qu.prototype.getClass=function(){return qu},qu.union=function(A,t){if(A.isEmpty()||t.isEmpty()){if(A.isEmpty()&&t.isEmpty())return Nu.createEmptyResult(Nu.UNION,A,t,A.getFactory());if(A.isEmpty())return t.copy();if(t.isEmpty())return A.copy()}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),wu.overlayOp(A,t,Nu.UNION)},Ku.prototype={constructor:Ku,reset:function(){this.s=this.t=0},add:function(A){_u(Hu,A,this.t),_u(this,Hu.s,this.s),this.s?this.t+=Hu.t:this.s=Hu.t},valueOf:function(){return this.s}};var Hu=new Ku;function _u(A,t,n){var i=A.s=t+n,r=i-t;A.t=t-(i-r)+(n-r)}var Ju=1e-6,Zu=Math.PI,Xu=Zu/2,$u=Zu/4,Ao=2*Zu,to=180/Zu,no=Zu/180,io=Math.abs,ro=Math.atan,eo=Math.atan2,so=Math.cos,uo=Math.sin,oo=Math.sqrt;function ho(A){return A>1?0:A<-1?Zu:Math.acos(A)}function fo(A){return A>1?Xu:A<-1?-Xu:Math.asin(A)}function co(){}function ao(A,t){A&&Po.hasOwnProperty(A.type)&&Po[A.type](A,t)}var vo,lo,wo={Feature:function(A,t){ao(A.geometry,t)},FeatureCollection:function(A,t){for(var n=A.features,i=-1,r=n.length;++i<r;)ao(n[i].geometry,t)}},Po={Sphere:function(A,t){t.sphere()},Point:function(A,t){t.point((A=A.coordinates)[0],A[1],A[2])},MultiPoint:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)t.point((A=n[i])[0],A[1],A[2])},LineString:function(A,t){go(A.coordinates,t,0)},MultiLineString:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)go(n[i],t,0)},Polygon:function(A,t){Co(A.coordinates,t)},MultiPolygon:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)Co(n[i],t)},GeometryCollection:function(A,t){for(var n=A.geometries,i=-1,r=n.length;++i<r;)ao(n[i],t)}};function go(A,t,n){var i,r=-1,e=A.length-n;for(t.lineStart();++r<e;)t.point((i=A[r])[0],i[1],i[2]);t.lineEnd()}function Co(A,t){var n=-1,i=A.length;for(t.polygonStart();++n<i;)go(A[n],t,1);t.polygonEnd()}function Do(A){return[eo(A[1],A[0]),fo(A[2])]}function Io(A){var t=A[0],n=A[1],i=so(n);return[i*so(t),i*uo(t),uo(n)]}function Mo(A,t){return A[0]*t[0]+A[1]*t[1]+A[2]*t[2]}function bo(A,t){return[A[1]*t[2]-A[2]*t[1],A[2]*t[0]-A[0]*t[2],A[0]*t[1]-A[1]*t[0]]}function zo(A,t){A[0]+=t[0],A[1]+=t[1],A[2]+=t[2]}function xo(A,t){return[A[0]*t,A[1]*t,A[2]*t]}function yo(A){var t=oo(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]/=t,A[1]/=t,A[2]/=t}function mo(A,t){function n(n,i){return n=A(n,i),t(n[0],n[1])}return A.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&A.invert(n[0],n[1])}),n}function po(A,t){return[A>Zu?A-Ao:A<-Zu?A+Ao:A,t]}function Lo(A){return function(t,n){return[(t+=A)>Zu?t-Ao:t<-Zu?t+Ao:t,n]}}function To(A){var t=Lo(A);return t.invert=Lo(-A),t}function Oo(A,t){var n=so(A),i=uo(A),r=so(t),e=uo(t);function s(A,t){var s=so(t),u=so(A)*s,o=uo(A)*s,h=uo(t),f=h*n+u*i;return[eo(o*r-f*e,u*n-h*i),fo(f*r+o*e)]}return s.invert=function(A,t){var s=so(t),u=so(A)*s,o=uo(A)*s,h=uo(t),f=h*r-o*e;return[eo(o*r+h*e,u*n+f*i),fo(f*n-u*i)]},s}function Fo(A,t){(t=Io(t))[0]-=A,yo(t);var n=ho(-t[1]);return((-t[2]<0?-n:n)+Ao-Ju)%Ao}function Eo(){var A,t=[];return{point:function(t,n){A.push([t,n])},lineStart:function(){t.push(A=[])},lineEnd:co,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],A=null,n}}}function Uo(A,t){return io(A[0]-t[0])<Ju&&io(A[1]-t[1])<Ju}function jo(A,t,n,i){this.x=A,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function No(A,t,n,i,r){var e,s,u=[],o=[];if(A.forEach((function(A){if(!((t=A.length-1)<=0)){var t,n,i=A[0],s=A[t];if(Uo(i,s)){for(r.lineStart(),e=0;e<t;++e)r.point((i=A[e])[0],i[1]);r.lineEnd()}else u.push(n=new jo(i,A,null,!0)),o.push(n.o=new jo(i,null,n,!1)),u.push(n=new jo(s,A,null,!1)),o.push(n.o=new jo(s,null,n,!0))}})),u.length){for(o.sort(t),Qo(u),Qo(o),e=0,s=o.length;e<s;++e)o[e].e=n=!n;for(var h,f,c=u[0];;){for(var a=c,v=!0;a.v;)if((a=a.n)===c)return;h=a.z,r.lineStart();do{if(a.v=a.o.v=!0,a.e){if(v)for(e=0,s=h.length;e<s;++e)r.point((f=h[e])[0],f[1]);else i(a.x,a.n.x,1,r);a=a.n}else{if(v)for(e=(h=a.p.z).length-1;e>=0;--e)r.point((f=h[e])[0],f[1]);else i(a.x,a.p.x,-1,r);a=a.p}h=(a=a.o).z,v=!v}while(!a.v);r.lineEnd()}}}function Qo(A){if(t=A.length){for(var t,n,i=0,r=A[0];++i<t;)r.n=n=A[i],n.p=r,r=n;r.n=n=A[0],n.p=r}}function So(A,t){return A<t?-1:A>t?1:A>=t?0:NaN}function Bo(A){for(var t,n,i,r=A.length,e=-1,s=0;++e<r;)s+=A[e].length;for(n=new Array(s);--r>=0;)for(t=(i=A[r]).length;--t>=0;)n[--s]=i[t];return n}function Ro(A,t,n,i){function r(r,e){return A<=r&&r<=n&&t<=e&&e<=i}function e(r,e,u,h){var f=0,c=0;if(null==r||(f=s(r,u))!==(c=s(e,u))||o(r,e)<0^u>0)do{h.point(0===f||3===f?A:n,f>1?i:t)}while((f=(f+u+4)%4)!==c);else h.point(e[0],e[1])}function s(i,r){return io(i[0]-A)<Ju?r>0?0:3:io(i[0]-n)<Ju?r>0?2:1:io(i[1]-t)<Ju?r>0?1:0:r>0?3:2}function u(A,t){return o(A.x,t.x)}function o(A,t){var n=s(A,1),i=s(t,1);return n!==i?n-i:0===n?t[1]-A[1]:1===n?A[0]-t[0]:2===n?A[1]-t[1]:t[0]-A[0]}return function(s){var o,h,f,c,a,v,l,w,P,g,C,D=s,I=Eo(),M={point:b,lineStart:function(){M.point=z,h&&h.push(f=[]),g=!0,P=!1,l=w=NaN},lineEnd:function(){o&&(z(c,a),v&&P&&I.rejoin(),o.push(I.result())),M.point=b,P&&D.lineEnd()},polygonStart:function(){D=I,o=[],h=[],C=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,r=h.length;n<r;++n)for(var e,s,u=h[n],o=1,f=u.length,c=u[0],a=c[0],v=c[1];o<f;++o)e=a,s=v,a=(c=u[o])[0],v=c[1],s<=i?v>i&&(a-e)*(i-s)>(v-s)*(A-e)&&++t:v<=i&&(a-e)*(i-s)<(v-s)*(A-e)&&--t;return t}(),n=C&&t,r=(o=Bo(o)).length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),e(null,null,1,s),s.lineEnd()),r&&No(o,u,t,e,s),s.polygonEnd()),D=s,o=h=f=null}};function b(A,t){r(A,t)&&D.point(A,t)}function z(e,s){var u=r(e,s);if(h&&f.push([e,s]),g)c=e,a=s,v=u,g=!1,u&&(D.lineStart(),D.point(e,s));else if(u&&P)D.point(e,s);else{var o=[l=Math.max(-1e9,Math.min(1e9,l)),w=Math.max(-1e9,Math.min(1e9,w))],I=[e=Math.max(-1e9,Math.min(1e9,e)),s=Math.max(-1e9,Math.min(1e9,s))];!function(A,t,n,i,r,e){var s,u=A[0],o=A[1],h=0,f=1,c=t[0]-u,a=t[1]-o;if(s=n-u,c||!(s>0)){if(s/=c,c<0){if(s<h)return;s<f&&(f=s)}else if(c>0){if(s>f)return;s>h&&(h=s)}if(s=r-u,c||!(s<0)){if(s/=c,c<0){if(s>f)return;s>h&&(h=s)}else if(c>0){if(s<h)return;s<f&&(f=s)}if(s=i-o,a||!(s>0)){if(s/=a,a<0){if(s<h)return;s<f&&(f=s)}else if(a>0){if(s>f)return;s>h&&(h=s)}if(s=e-o,a||!(s<0)){if(s/=a,a<0){if(s>f)return;s>h&&(h=s)}else if(a>0){if(s<h)return;s<f&&(f=s)}return h>0&&(A[0]=u+h*c,A[1]=o+h*a),f<1&&(t[0]=u+f*c,t[1]=o+f*a),!0}}}}}(o,I,A,t,n,i)?u&&(D.lineStart(),D.point(e,s),C=!1):(P||(D.lineStart(),D.point(o[0],o[1])),D.point(I[0],I[1]),u||D.lineEnd(),C=!1)}l=e,w=s,P=u}return M}}Vu(),Vu(),Vu(),po.invert=po,1===(vo=So).length&&(lo=vo,vo=function(A,t){return So(lo(A),t)});var ko=Vu();function Go(A){return A}Vu(),Vu(),Vu();var Yo=1/0,Wo=Yo,qo=-Yo,Vo=qo,Ko={point:function(A,t){A<Yo&&(Yo=A),A>qo&&(qo=A),t<Wo&&(Wo=t),t>Vo&&(Vo=t)},lineStart:co,lineEnd:co,polygonStart:co,polygonEnd:co,result:function(){var A=[[Yo,Wo],[qo,Vo]];return qo=Vo=-(Wo=Yo=1/0),A}};function Ho(A,t,n,i){return function(r,e){var s,u,o,h=t(e),f=r.invert(i[0],i[1]),c=Eo(),a=t(c),v=!1,l={point:w,lineStart:g,lineEnd:C,polygonStart:function(){l.point=D,l.lineStart=I,l.lineEnd=M,u=[],s=[]},polygonEnd:function(){l.point=w,l.lineStart=g,l.lineEnd=C,u=Bo(u);var A=function(A,t){var n=t[0],i=t[1],r=[uo(n),-so(n),0],e=0,s=0;ko.reset();for(var u=0,o=A.length;u<o;++u)if(f=(h=A[u]).length)for(var h,f,c=h[f-1],a=c[0],v=c[1]/2+$u,l=uo(v),w=so(v),P=0;P<f;++P,a=C,l=I,w=M,c=g){var g=h[P],C=g[0],D=g[1]/2+$u,I=uo(D),M=so(D),b=C-a,z=b>=0?1:-1,x=z*b,d=x>Zu,y=l*I;if(ko.add(eo(y*z*uo(x),w*M+y*so(x))),e+=d?b+z*Ao:b,d^a>=n^C>=n){var m=bo(Io(c),Io(g));yo(m);var p=bo(r,m);yo(p);var L=(d^b>=0?-1:1)*fo(p[2]);(i>L||i===L&&(m[0]||m[1]))&&(s+=d^b>=0?1:-1)}}return(e<-Ju||e<Ju&&ko<-Ju)^1&s}(s,f);u.length?(v||(e.polygonStart(),v=!0),No(u,Jo,A,n,e)):A&&(v||(e.polygonStart(),v=!0),e.lineStart(),n(null,null,1,e),e.lineEnd()),v&&(e.polygonEnd(),v=!1),u=s=null},sphere:function(){e.polygonStart(),e.lineStart(),n(null,null,1,e),e.lineEnd(),e.polygonEnd()}};function w(t,n){var i=r(t,n);A(t=i[0],n=i[1])&&e.point(t,n)}function P(A,t){var n=r(A,t);h.point(n[0],n[1])}function g(){l.point=P,h.lineStart()}function C(){l.point=w,h.lineEnd()}function D(A,t){o.push([A,t]);var n=r(A,t);a.point(n[0],n[1])}function I(){a.lineStart(),o=[]}function M(){D(o[0][0],o[0][1]),a.lineEnd();var A,t,n,i,r=a.clean(),h=c.result(),f=h.length;if(o.pop(),s.push(o),o=null,f)if(1&r){if((t=(n=h[0]).length-1)>0){for(v||(e.polygonStart(),v=!0),e.lineStart(),A=0;A<t;++A)e.point((i=n[A])[0],i[1]);e.lineEnd()}}else f>1&&2&r&&h.push(h.pop().concat(h.shift())),u.push(h.filter(_o))}return l}}function _o(A){return A.length>1}function Jo(A,t){return((A=A.x)[0]<0?A[1]-Xu-Ju:Xu-A[1])-((t=t.x)[0]<0?t[1]-Xu-Ju:Xu-t[1])}Vu();var Zo=Ho((function(){return!0}),(function(A){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){A.lineStart(),t=1},point:function(e,s){var u=e>0?Zu:-Zu,o=io(e-n);io(o-Zu)<Ju?(A.point(n,i=(i+s)/2>0?Xu:-Xu),A.point(r,i),A.lineEnd(),A.lineStart(),A.point(u,i),A.point(e,i),t=0):r!==u&&o>=Zu&&(io(n-r)<Ju&&(n-=r*Ju),io(e-u)<Ju&&(e-=u*Ju),i=function(A,t,n,i){var r,e,s=uo(A-n);return io(s)>Ju?ro((uo(t)*(e=so(i))*uo(n)-uo(i)*(r=so(t))*uo(A))/(r*e*s)):(t+i)/2}(n,i,e,s),A.point(r,i),A.lineEnd(),A.lineStart(),A.point(u,i),t=0),A.point(n=e,i=s),r=u},lineEnd:function(){A.lineEnd(),n=i=NaN},clean:function(){return 2-t}}}),(function(A,t,n,i){var r;if(null==A)i.point(-Zu,r=n*Xu),i.point(0,r),i.point(Zu,r),i.point(Zu,0),i.point(Zu,-r),i.point(0,-r),i.point(-Zu,-r),i.point(-Zu,0),i.point(-Zu,r);else if(io(A[0]-t[0])>Ju){var e=A[0]<t[0]?Zu:-Zu;i.point(-e,r=n*e/2),i.point(0,r),i.point(e,r)}else i.point(t[0],t[1])}),[-Zu,-Xu]);function Xo(A,t){var n=so(A),i=n>0,r=io(n)>Ju;function e(A,t){return so(A)*so(t)>n}function s(A,t,i){var r=[1,0,0],e=bo(Io(A),Io(t)),s=Mo(e,e),u=e[0],o=s-u*u;if(!o)return!i&&A;var h=n*s/o,f=-n*u/o,c=bo(r,e),a=xo(r,h);zo(a,xo(e,f));var v=c,l=Mo(a,v),w=Mo(v,v),P=l*l-w*(Mo(a,a)-1);if(!(P<0)){var g=oo(P),C=xo(v,(-l-g)/w);if(zo(C,a),C=Do(C),!i)return C;var D,I=A[0],M=t[0],b=A[1],z=t[1];M<I&&(D=I,I=M,M=D);var x=M-I,d=io(x-Zu)<Ju;if(!d&&z<b&&(D=b,b=z,z=D),d||x<Ju?d?b+z>0^C[1]<(io(C[0]-I)<Ju?b:z):b<=C[1]&&C[1]<=z:x>Zu^(I<=C[0]&&C[0]<=M)){var y=xo(v,(-l+g)/w);return zo(y,a),[C,Do(y)]}}}function u(t,n){var r=i?A:Zu-A,e=0;return t<-r?e|=1:t>r&&(e|=2),n<-r?e|=4:n>r&&(e|=8),e}return Ho(e,(function(A){var t,n,o,h,f;return{lineStart:function(){h=o=!1,f=1},point:function(c,a){var v,l=[c,a],w=e(c,a),P=i?w?0:u(c,a):w?u(c+(c<0?Zu:-Zu),a):0;if(!t&&(h=o=w)&&A.lineStart(),w!==o&&(!(v=s(t,l))||Uo(t,v)||Uo(l,v))&&(l[0]+=Ju,l[1]+=Ju,w=e(l[0],l[1])),w!==o)f=0,w?(A.lineStart(),v=s(l,t),A.point(v[0],v[1])):(v=s(t,l),A.point(v[0],v[1]),A.lineEnd()),t=v;else if(r&&t&&i^w){var g;P&n||!(g=s(l,t,!0))||(f=0,i?(A.lineStart(),A.point(g[0][0],g[0][1]),A.point(g[1][0],g[1][1]),A.lineEnd()):(A.point(g[1][0],g[1][1]),A.lineEnd(),A.lineStart(),A.point(g[0][0],g[0][1])))}!w||t&&Uo(t,l)||A.point(l[0],l[1]),t=l,o=w,n=P},lineEnd:function(){o&&A.lineEnd(),t=null},clean:function(){return f|(h&&o)<<1}}}),(function(n,i,r,e){!function(A,t,n,i,r,e){if(n){var s=so(t),u=uo(t),o=i*n;null==r?(r=t+i*Ao,e=t-o/2):(r=Fo(s,r),e=Fo(s,e),(i>0?r<e:r>e)&&(r+=i*Ao));for(var h,f=r;i>0?f>e:f<e;f-=o)h=Do([s,-u*so(f),-u*uo(f)]),A.point(h[0],h[1])}}(e,A,t,r,n,i)}),i?[0,-A]:[-Zu,A-Zu])}function $o(A){return function(t){var n=new Ah;for(var i in A)n[i]=A[i];return n.stream=t,n}}function Ah(){}function th(A,t,n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],e=A.clipExtent&&A.clipExtent();A.scale(150).translate([0,0]),null!=e&&A.clipExtent(null),function(A,t){A&&wo.hasOwnProperty(A.type)?wo[A.type](A,t):ao(A,t)}(n,A.stream(Ko));var s=Ko.result(),u=Math.min(i/(s[1][0]-s[0][0]),r/(s[1][1]-s[0][1])),o=+t[0][0]+(i-u*(s[1][0]+s[0][0]))/2,h=+t[0][1]+(r-u*(s[1][1]+s[0][1]))/2;return null!=e&&A.clipExtent(e),A.scale(150*u).translate([o,h])}Ah.prototype={constructor:Ah,point:function(A,t){this.stream.point(A,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var nh=so(30*no);function ih(A,t){return+t?function(A,t){function n(i,r,e,s,u,o,h,f,c,a,v,l,w,P){var g=h-i,C=f-r,D=g*g+C*C;if(D>4*t&&w--){var I=s+a,M=u+v,b=o+l,z=oo(I*I+M*M+b*b),x=fo(b/=z),d=io(io(b)-1)<Ju||io(e-c)<Ju?(e+c)/2:eo(M,I),y=A(d,x),m=y[0],p=y[1],L=m-i,T=p-r,O=C*L-g*T;(O*O/D>t||io((g*L+C*T)/D-.5)>.3||s*a+u*v+o*l<nh)&&(n(i,r,e,s,u,o,m,p,d,I/=z,M/=z,b,w,P),P.point(m,p),n(m,p,d,I,M,b,h,f,c,a,v,l,w,P))}}return function(t){var i,r,e,s,u,o,h,f,c,a,v,l,w={point:P,lineStart:g,lineEnd:D,polygonStart:function(){t.polygonStart(),w.lineStart=I},polygonEnd:function(){t.polygonEnd(),w.lineStart=g}};function P(n,i){n=A(n,i),t.point(n[0],n[1])}function g(){f=NaN,w.point=C,t.lineStart()}function C(i,r){var e=Io([i,r]),s=A(i,r);n(f,c,h,a,v,l,f=s[0],c=s[1],h=i,a=e[0],v=e[1],l=e[2],16,t),t.point(f,c)}function D(){w.point=P,t.lineEnd()}function I(){g(),w.point=M,w.lineEnd=b}function M(A,t){C(i=A,t),r=f,e=c,s=a,u=v,o=l,w.point=C}function b(){n(f,c,h,a,v,l,r,e,i,s,u,o,16,t),w.lineEnd=D,D()}return w}}(A,t):function(A){return $o({point:function(t,n){t=A(t,n),this.stream.point(t[0],t[1])}})}(A)}var rh=$o({point:function(A,t){this.stream.point(A*no,t*no)}});function sh(A){return function(t,n){var i=so(t),r=so(n),e=A(i*r);return[e*r*uo(t),e*uo(n)]}}function uh(A){return function(t,n){var i=oo(t*t+n*n),r=A(i),e=uo(r),s=so(r);return[eo(t*e,i*s),fo(i&&n*e/i)]}}sh((function(A){return oo(2/(1+A))})).invert=uh((function(A){return 2*fo(A/2)}));var oh=sh((function(A){return(A=ho(A))&&A/uo(A)}));function hh(){return function(A){return function(A){var t,n,i,r,e,s,u,o,h,f,c=150,a=480,v=250,l=0,w=0,P=0,g=0,C=0,D=null,I=Zo,M=null,b=Go,z=.5,x=ih(m,z);function d(A){return[(A=e(A[0]*no,A[1]*no))[0]*c+n,i-A[1]*c]}function y(A){return(A=e.invert((A[0]-n)/c,(i-A[1])/c))&&[A[0]*to,A[1]*to]}function m(A,r){return[(A=t(A,r))[0]*c+n,i-A[1]*c]}function p(){e=mo(r=function(A,t,n){return(A%=Ao)?t||n?mo(To(A),Oo(t,n)):To(A):t||n?Oo(t,n):po}(P,g,C),t);var A=t(l,w);return n=a-A[0]*c,i=v+A[1]*c,L()}function L(){return h=f=null,d}return d.stream=function(A){return h&&f===A?h:h=rh(I(r,x(b(f=A))))},d.clipAngle=function(A){return arguments.length?(I=+A?Xo(D=A*no,6*no):(D=null,Zo),L()):D*to},d.clipExtent=function(A){return arguments.length?(b=null==A?(M=s=u=o=null,Go):Ro(M=+A[0][0],s=+A[0][1],u=+A[1][0],o=+A[1][1]),L()):null==M?null:[[M,s],[u,o]]},d.scale=function(A){return arguments.length?(c=+A,p()):c},d.translate=function(A){return arguments.length?(a=+A[0],v=+A[1],p()):[a,v]},d.center=function(A){return arguments.length?(l=A[0]%360*no,w=A[1]%360*no,p()):[l*to,w*to]},d.rotate=function(A){return arguments.length?(P=A[0]%360*no,g=A[1]%360*no,C=A.length>2?A[2]%360*no:0,p()):[P*to,g*to,C*to]},d.precision=function(A){return arguments.length?(x=ih(m,z=A*A),L()):oo(z)},d.fitExtent=function(A,t){return th(d,A,t)},d.fitSize=function(A,t){return function(A,t,n){return th(A,[[0,0],t],n)}(d,A,t)},function(){return t=A.apply(this,arguments),d.invert=t.invert&&y,p()}}((function(){return A}))()}(oh).scale(79.4188).clipAngle(179.999)}function fh(A,t){return[A,t]}function ch(A,t,n,i){var r=A.properties||{},e="Feature"===A.type?A.geometry:A;if("GeometryCollection"===e.type){var s=[];return sn(A,(function(A){var r=ch(A,t,n,i);r&&s.push(r)})),Kt(s)}var u=function(A){var t=function(A,t){void 0===t&&(t={});var n=un(A);return qt([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}(A).geometry.coordinates,n=[-t[0],-t[1]];return hh().rotate(n).scale(6371008.8)}(e),o={type:e.type,coordinates:ah(e.coordinates,u)},h=(new Fr).read(o),f=Ht(_t(t,n),"meters"),c=ds.bufferOp(h,f,i);if(!function A(t){return Array.isArray(t[0])?A(t[0]):isNaN(t[0])}((c=(new Er).write(c)).coordinates))return Wt({type:c.type,coordinates:vh(c.coordinates,u)},r)}function ah(A,t){return"object"!=typeof A[0]?t(A):A.map((function(A){return ah(A,t)}))}function vh(A,t){return"object"!=typeof A[0]?t.invert(A):A.map((function(A){return vh(A,t)}))}oh.invert=uh((function(A){return A})),fh.invert=fh;const lh=[.8451,.2588,.4863],wh=[],Ph=[],gh=[];const Dh=[.8,.1,.1];"undefined"!=typeof console&&console.log("@maptalks/analysis v0.81.4"),"undefined"!=typeof window&&(window.maptalksgl=window.maptalksgl||{},window.maptalksgl.transcoders=window.maptalksgl.transcoders||transcoders),exports.AEMarker=class extends K$2{constructor(t,e){super(t,e);const s=t$2.Util.extend({},_t$1,this.options.symbol);this.setSymbol(s);const i=t$2.Util.extend({},xt$1,this.options.symbol.uniforms);this.setUniforms(i)}},exports.B3DMLoader=tn$1,exports.CMPTLoader=An$1,exports.CrossCutAnalysis=class extends yA{constructor(A){super(A),this.type="crosscutAnalysis",this.$=!0}YA(){const A=this.layer.getMap();this.W={};const{extentMap:t,extentInWorld:n}=this.Cu(this.options.cutLine);this.W.extent=n,this.W.extentMap=t,this.W.projMatrix=A.projMatrix,this.W.viewMatrix=A.viewMatrix;const i=new t__namespace.LineString(this.options.cutLine);this.Du=i.getExtent()}getAltitudes(A){const t=Vt(this.options.cutLine);let n=0;for(let A=0;A<this.options.cutLine.length-1;A++)n+=nn(this.options.cutLine[A],this.options.cutLine[A+1]);const i=n/A,r=[],e=[];for(let n=0;n<A;n++){const A=rn(t,i*(n+1));e.push(A.geometry.coordinates)}const s=this.layer.getMap(),o=s.getDevicePixelRatio(),{projViewMatrix:h,projMatrix:f,viewMatrix:c}=this.Iu(e);for(let A=0;A<e.length;A++){const t=this.Mu(e[A],e),v=this.Ft(t.x*o,t.y*o,h,f,c);if(!v)continue;const l=s.pointAtResToAltitude(v[2],s.getGLRes()),w=s.pointAtResToCoordinate(new t__namespace.Point(v[0],v[1]),s.getGLRes());r.push({coordinate:new t__namespace.Coordinate(w.x,w.y,l),distance:i*A})}return r}Cu(A){const t=function(A,t,n){var i=(n=n||{}).units||"kilometers",r=n.steps||8;if(!A)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(r<=0)throw new Error("steps must be greater than 0");var e=[];switch(A.type){case"GeometryCollection":return sn(A,(function(A){var n=ch(A,t,i,r);n&&e.push(n)})),Kt(e);case"FeatureCollection":return en(A,(function(A){var n=ch(A,t,i,r);n&&en(n,(function(A){A&&e.push(A)}))})),Kt(e)}return ch(A,t,i,r)}(Vt(A),.001);return this.q(t.geometry.coordinates[0])}S(t){const n=this.u={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(t),this.bu(t);const i=new N$8(t.regl);this.B=this.B||new Gt(i,n),this.layer.addAnalysis(this)}bu(n){const i=this.layer.getMap();this.pickingFBO=n.canvas.pickingFBO||n.regl.framebuffer(n.canvas.width,n.canvas.height);const r=new N$8(n.regl);this.G=new Am(r,{vert:TA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(A,n){return multiply$5([],n.projViewMatrix,n.modelMatrix)}}]},this.pickingFBO,i)}Iu(){if(this.zu)return this.zu;const A=this.layer.getMap(),{precenter:n,prezoom:i,prepitch:r,prebearing:e}=this.xu();return copy$5(wh,A.projViewMatrix),copy$5(Ph,A.projMatrix),copy$5(gh,A.viewMatrix),A.setZoom(i),A.setCenter(n),A.setPitch(r),A.setBearing(e),this.zu={projViewMatrix:wh,projMatrix:Ph,viewMatrix:gh},this.zu}xu(){const A=this.Du,t=this.layer.getMap(),n=t.getCenter(),i=t.getZoom(),r=t.getPitch(),e=t.getBearing(),s=t.getFitZoom(A);return t.setZoom(s),t.setCenter(A.getCenter()),t.setPitch(0),{precenter:n,prezoom:i,prepitch:r,prebearing:e}}Mu(A){const{precenter:t,prezoom:n,prepitch:i,prebearing:r}=this.xu(),e=this.layer.getMap(),s=e.coordinateToContainerPoint(new t__namespace.Coordinate(A));return e.setZoom(n),e.setCenter(t),e.setPitch(i),e.setBearing(r),s}Ft(A,t,n,i,r,e={}){if(this.$){if(!this.du||0===this.du.length)return null;const A=this.du;A.forEach((A=>{const t=A.getDefines();t.HAS_PICKING_ID=2,A.setDefines(t),A.setUniform("uPickingId",1)})),this.G.render(A,{projViewMatrix:n},!0),this.$=!1}const{point:s}=this.G.pick(A,t,e.tolerance||3,{projViewMatrix:n},{viewMatrix:r,projMatrix:i,returnPoint:!0});return s}update(A,t){if(super.update(A,t),"cutLine"===A){const{extentMap:A,extentInWorld:n}=this.Cu(t);this.W.extent=n,this.W.extentMap=A;const i=new t__namespace.LineString(this.options.cutLine);this.Du=i.getExtent(),this.$=!0,delete this.zu}else this.W[A]=t}renderAnalysis(A){const t={};return this.R.render(this.k,this.K),t.cutLineColor=this.options.cutLineColor||lh,t.crosscutMap=this.B.render(A,this.W),this.du=A,t}getDefines(){return{HAS_CROSSCUT:1}}},exports.CutAnalysis=class extends yA{constructor(A){super(A),this.type="cut"}update(A,t){if("eyePos"===A||"lookPoint"===A){const n=this.layer.getMap();this.W[A]=Z(n,...t)}else this.W[A]=t;super.update(A,t)}reset(){if(this.B){this.B.SA(this.W.position,this.W.rotation,this.W.scale)}}YA(){const A=this.layer.getMap();this.W={},this.W.position=Z(A,...this.options.position),this.W.rotation=this.options.rotation||[0,0,0],this.W.scale=this.options.scale||[1,1,1],this.W.projViewMatrix=A.projViewMatrix}S(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1},i=new N$8(t.regl);i.canvas=t.canvas,i.parentRenderer=t,this.YA(),this.B=new XA(i,n)||this.B;const r=this.layer.getMap();this.B.QA(r,this.W.position,this.W.rotation,this.W.scale),this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={};this.W.map=this.layer.getMap();const{meshesMap:n,invisibleMap:i}=this.B.render(A,this.W);return t.meshesMap=n,t.invisibleMap=i,t}getDefines(){return{HAS_CUT:1}}},exports.EffectLayer=ut$1,exports.EffectLine=class extends K$2{constructor(t,e){super(t,e);const s=t$2.Util.extend({},ft$1,this.options.symbol);this.setSymbol(s);const i=t$2.Util.extend({},dt$1,this.options.symbol.uniforms);this.setUniforms(i),this.setShader("effectline"),this.et="effectmarker"}getEffectType(){return"sequence"}setTexture(t){return this.setUniform("texture",t),this}setHeight(t){return this.setUniform("modelHeight",t),this}setStartOpacity(t){return this.setUniform("startOpacity",t),this}setEndOpacity(t){return this.setUniform("endOpacity",t),this}},exports.EffectLineLayer=pt$1,exports.EffectMarker=K$2,exports.EffectRing=class extends J$2{constructor(t,e){super(t,e);const s=t$2.Util.extend({},gt$1,this.options.symbol.uniforms);this.setUniforms(s),this.setShader("effectring"),this.et="effectring"}},exports.EffectRingLayer=yt$1,exports.ExcavateAnalysis=class extends yA{constructor(A){super(A),this.type="excavate"}Ot(A){const t=this.regl,n=t.texture({width:2,height:2});if(A){const n=new Image;n.src=A,n.onload=function(){this.W.groundTexture=t.texture(n),this.layer.getRenderer().setToRedraw()}.bind(this)}return n}Ft(A,t,n,i={}){if(!this.G)return null;if(this.$){this.G.render(this.Et,{projViewMatrix:n.projViewMatrix},!0),this.$=!1}const{meshId:r,pickingId:e,point:s}=this.G.pick(A,t,i.tolerance||3,{projViewMatrix:n.projViewMatrix},{viewMatrix:n.viewMatrix,projMatrix:n.projMatrix,returnPoint:!0});return{meshId:r,pickingId:e,point:s}}Ut(A,t,n){const i=this.layer.getMap(),r=i.getDevicePixelRatio(),e=this.Ft(A*=r,t*=r,n),s=e&&e.point;return s?i.pointAtResToAltitude(s[2],i.getGLRes()):0}update(A,t){if("boundary"===A){const{extentMap:A,extentInWorld:n,extentPolygon:i}=this.q(t);this.W.extent=n,this.W.extentPolygon=i,this.W.extentMap=A,this.$=!0}else if("textureUrl"===A)this.W.groundTexture=this.Ot(t),this.W.hasTexture=H(t)?1:0;else if("height"===A){const A=this.layer.getMap();this.W.height=A.altitudeToPoint(t||0,A.getGLRes())}else this.W[A]=t;super.update(A,t)}getVolume(){this.$=!0;let A=0;const t=this.layer.getMap(),{extentInContainerMax:n,extentInContainerMin:i,matrix:r}=this.jt(),e=this.Nt();for(let s=i.x;s<n.x;s++)for(let o=n.y;o<i.y;o++){const i=[s+1,o],h=[s,o+1],f=t.containerPointToCoordinate(new t__namespace.Point([s,o])),c=t.containerPointToCoordinate(new t__namespace.Point(i)),a=t.containerPointToCoordinate(new t__namespace.Point(h));e.containsPoint(f)&&(A+=new t__namespace.Polygon([[f.x,f.y],[c.x,c.y],[c.x,a.y],[a.x,a.y]]).getArea()*(this.Ut(s,o,r)-this.options.height||0))}return this.Qt(),A}jt(){const A=this.layer.getMap(),n=this.Nt().getExtent();this.Qt();const i=A.getCenter(),r=A.getZoom(),e=A.getPitch(),s=A.getBearing(),o=A.getFitZoom(n)-1,h=n.getCenter();A.setZoom(o),A.setCenter(h),A.setPitch(0),A.setBearing(0);const f=copy$5([],A.projViewMatrix),c=copy$5([],A.viewMatrix),a=copy$5([],A.projMatrix),v=A.coordinateToContainerPoint(new t__namespace.Coordinate(n.xmin,n.ymin)),l=A.coordinateToContainerPoint(new t__namespace.Coordinate(n.xmax,n.ymax));return A.setZoom(r),A.setCenter(i),A.setPitch(e),A.setBearing(s),{extentInContainerMax:l,extentInContainerMin:v,matrix:{projViewMatrix:f,projMatrix:a,viewMatrix:c}}}Nt(){const A=this.layer.getMap(),t=this.options.boundary,n=A.getLayer("analysis-extent-layer")||new t__namespace.VectorLayer("analysis-extent-layer").addTo(A);return new t__namespace.Polygon(t,{symbol:{polygonOpacity:.2}}).addTo(n)}Qt(){const A=this.layer.getMap().getLayer("analysis-extent-layer");A&&A.remove()}YA(){const A=this.layer.getMap(),{extentMap:t,extentInWorld:n,extentPolygon:i}=this.q(this.options.boundary);this.W={},this.W.height=A.altitudeToPoint(this.options.height||0,A.getGLRes()),this.W.extent=n,this.W.extentPolygon=i,this.W.extentMap=t,this.W.groundTexture=this.Ot(this.options.textureUrl),this.W.hasTexture=H(this.options.textureUrl)?1:0,this.W.projViewMatrix=A.projViewMatrix}S(t){const n=this.u={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA();const i=new N$8(t.regl);this.B=this.B||new Rt(i,n),this.layer.addAnalysis(this),this.St(t),t.setToRedraw()}renderAnalysis(A){const t={};this.R.render(this.k,this.K),this.Bt(A);const n=this.B.render(A,this.W);return this.Et=A,t.excavateMap=n,t}Bt(A){A.forEach((A=>{const t=A.getMaterial(),n=A.getDefines();t.get("baseColorTexture")?n.HAS_MODELTEXTURE=1:t.get("baseColorFactor")&&(n.HAS_BASECOLOR=1),A.setDefines(n)}))}St(n){const i=this.layer.getMap();this.pickingFBO=n.regl.framebuffer(n.canvas.width,n.canvas.height),this.renderer=new N$8(n.regl),this.G=new Am(this.renderer,{vert:TA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(A,n){return multiply$5([],n.projViewMatrix,n.modelMatrix)}}]},this.pickingFBO,i)}getDefines(){return{HAS_EXCAVATE:1}}remove(){super.remove(),this.pickingFBO&&(this.pickingFBO.destroy(),delete this.pickingFBO),this.G&&(this.G.dispose(),delete this.G)}},exports.FillPainter=vn$1,exports.FillPlugin=jo$1,exports.FilterUtil=ur$3,exports.FloodAnalysis=Dt,exports.GLContext=i$2,exports.GLTFLayer=tt$1,exports.GLTFMarker=J$2,exports.GLTFPhongPlugin=qo$1,exports.GLTFStandardPlugin=$o$1,exports.Geo3DTilesLayer=Gr$1,exports.Geo3DTilesUtil=U$3,exports.Geo3DTransform=dt$2,exports.GeoJSONVectorTileLayer=Lt$2,exports.GlowMarker=ct$1,exports.GlowMarkerLayer=lt$1,exports.GroundPainter=xt$5,exports.GroupGLLayer=zi$3,exports.HeatmapPlugin=Bo$1,exports.HeatmapProcess=ce$4,exports.HeightLimitAnalysis=class extends Dt{constructor(A){super(A),this.type="heightLimitAnalysis"}YA(A){super.YA(A);const t=this.layer.getMap();this.W.waterHeight=_(t,this.options.limitHeight),this.W.type=2}update(A,t){if(super.update(A,t),"limitHeight"===A){const A=this.layer.getMap();this.W.waterHeight=A.altitudeToPoint(t||0,A.getGLRes())}}renderAnalysis(A){const t=super.renderAnalysis(A);return t.heightLimitMap=t.floodMap,t.limitColor=this.options.limitColor||Dh,t}getDefines(){return{HAS_HEIGHTLIMIT:1}}},exports.HighlightUtil=ae$4,exports.IconPainter=Xi$1,exports.IconPlugin=No$1,exports.InSightAnalysis=class extends yA{constructor(A){super(A),this.xt=A.lines||[],this.dt=new Qt,this.type="insight"}update(A,t){"lines"===A?this.setLines(t):this.W[A]=t,super.update(A,t)}addLine(A){const{from:t,to:n}=A;t&&n&&this.xt.push(A),this.yt()}removeLine(A){const t=this.xt.indexOf(A);t>-1&&this.xt.splice(t,1),this.yt()}getLines(){return this.xt}setLines(A){this.xt=A,this.yt()}clearLines(){this.xt=[],this.yt()}getIntersetction(){const A=[];if(!this.Lt)return A;const t=this.layer.getMap();for(let n=0;n<this.xt.length;n++){const{from:i,to:r}=this.xt[n];this.dt.setFromPoint(i),this.dt.setToPoint(r);const e=this.dt.test(this.Lt,t);if(e&&e.length){const t={inSightLine:this.xt[n],intersects:[]};e.forEach((A=>{const n=this.Tt(A);n&&t.intersects.push(n)})),A.push(t)}}return A}Tt(A){const t=[],n=this.layer;if(!n)return t;const{mesh:i,coordinates:r}=A,e=this.getExcludeLayers();return n.getLayers().forEach((A=>{const n=A.getId(),s=A.getRenderer();if(e.indexOf(n)<0&&s&&s.getRayCastData&&r.length){const n=s.getRayCastData(i,r[0].indices[0]);n&&t.push({data:n,coordinates:r})}})),t}yt(){this.YA();const A=this.layer.getRenderer();A&&A.setToRedraw()}YA(){const A=this.layer.getMap();this.W={},this.W.lines=this.xt.map((t=>{const{from:n,to:i}=t;return{from:Z(A,...n),to:Z(A,...i)}})),this.W.visibleColor=this.options.visibleColor,this.W.invisibleColor=this.options.invisibleColor,this.W.projViewMatrix=A.projViewMatrix,this.W.horizontalAngle=45,this.W.verticalAngle=45}S(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA();const i=new N$8(t.regl);this.B=this.B||new xt(i,n),this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={};this.Lt=A;const n=this.B.render(A,this.W);return t.insightMap=n,t.insight_visibleColor=this.W.visibleColor||[0,1,0,1],t.insight_invisibleColor=this.W.invisibleColor||[1,0,0,1],t}getDefines(){return{HAS_INSIGHT:1}}},exports.LineGradientPlugin=Do$1,exports.LinePainter=An$2,exports.LinePlugin=Ro$1,exports.LineStringLayer=me$2,exports.LitPlugin=Go$1,exports.MSDJSONLoader=class{constructor(t){this.i=t||{}}load(){const t=this.i.data;let r=this.i.basePath;if("string"==typeof(e=t)||null!==e.constructor&&e.constructor===String){const e=this.i.fetchFunction||fetch,i=this.i.fetchOptions;if(!r){const e=t.lastIndexOf("/");r=e<0?"./":t.substring(0,e)}return e(t,i).then((t=>t.json())).then((t=>(this.s(t,r),this)))}return this.s(t,r||"./"),Promise.resolve(this);var e}getMSDJSON(){return e(this.h)}getMapJSON(){return e(this.t)}getView(){if(!this.t)return null;const{center:t,zoom:r,pitch:e,bearing:i}=this.t;return{center:t,zoom:r,pitch:e,bearing:i}}getLights(){return this.t&&this.t.options.lights}getSceneConfig(){return this.t&&this.t.layers[0].options.sceneConfig}s(r,i){if("./"!==i&&"."!==i){"/"!==i[i.length-1]&&(i+="/"),this.h=r;let t=JSON.stringify(r);t=t.replace(/".\/res/g,'"'+i+"res"),r=JSON.parse(t)}else this.h=e(r);this.t=r||{},this.u=function(r){return r.layers?r.layers.map((r=>r?new t(r):null)):[]}(r.layers[0])}getLayer(t){const r=this.u;if(!r)return null;for(let e=0;e<r.length;e++){const i=r[e];if(i&&t===i.getId())return i}return null}getLayers(){return this.u||[]}},exports.MapboxVectorTileLayer=Dt$2,exports.MaskLayerMixin=fe$4,exports.MaskRendererMixin=pe$4,exports.MultiGLTFMarker=ot$1,exports.NativeLinePainter=Yr$2,exports.NativeLinePlugin=Ho$1,exports.NativePointPainter=$r$2,exports.PackUtil=ta,exports.PhongPainter=ro$1,exports.PhongPlugin=Vo$1,exports.PointLayer=pe$2,exports.PolygonLayer=ge$2,exports.RayCaster=Qt,exports.SYMBOLS_NEED_REBUILD_IN_VECTOR=ua,exports.SYMBOLS_NEED_REBUILD_IN_VT=la,exports.SkylineAnalysis=class extends yA{constructor(A){super(A),this.type="skyline"}YA(){const A=this.layer.getMap();this.W={},this.W.lineColor=this.options.lineColor,this.W.lineWidth=this.options.lineWidth,this.W.projViewMatrix=A.projViewMatrix}S(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(),this.renderer=new N$8(t.regl),this.B=new vt(this.renderer,n)||this.B,this.layer.addAnalysis(this),this.$A=this.At(t.regl)}renderAnalysis(A){this.$A=this.$A||this.At(this.renderer.regl);const t=this.layer.getMap();this.tt(t);const n={};let i=A.concat([this.$A]);return this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.T=this.B.render(i,this.W),n.skylineMap=this.T,n}exportSkylineMap(A){if(!lt||!this.isEnable())return null;A||(A={});const t=this.B.getRenderMeshes(),n=this.exportAnalysisMap(t),i=this.T.width,r=this.T.height,e=new Uint8ClampedArray(n.length);for(let A=0;A<i;A++)for(let t=0;t<r;t++)e[4*(t*i+A)]=n[4*((r-t)*i+A)],e[4*(t*i+A)+1]=n[4*((r-t)*i+A)+1],e[4*(t*i+A)+2]=n[4*((r-t)*i+A)+2],e[4*(t*i+A)+3]=n[4*((r-t)*i+A)+3];lt.width=i,lt.height=r;const s=new ImageData(e,i,r);lt.getContext("2d").putImageData(s,0,0);const u=lt.toDataURL();if(!A.save)return u;{const t=document.createElement("a");t.download=A.filename||"export",t.href=u,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}update(A,t){this.W[A]=t,super.update(A,t)}At(t){const n=new Ut$5;return n.generateBuffers(t),n.data.aTexCoord=new Float32Array(8),new ft$6(n)}tt(A){const t=xt$5.getGroundTransform(this.$A.localTransform,A);this.$A.setLocalTransform(t)}remove(){super.remove(),this.$A&&(this.$A.geometry.dispose(),this.$A.dispose(),delete this.$A)}getDefines(){return{HAS_SKYLINE:1}}},exports.TextPainter=Vr$2,exports.TextPlugin=Lo$1,exports.TransformControl=R$2,exports.TubePlugin=Wo$1,exports.Vector3DLayer=Ut$2,exports.VectorTileLayer=Ct$2,exports.VectorTileLayerRenderer=gt$3,exports.VideoLayer=$$1,exports.VideoSurface=J$1,exports.ViewshedAnalysis=class extends yA{constructor(A){super(A),this.type="viewshed"}update(A,t){if("eyePos"===A||"lookPoint"===A){const n=this.layer.getMap();this.W[A]=Z(n,...t)}else this.W[A]=t;super.update(A,t)}YA(){const A=this.layer.getMap();this.W={},this.W.eyePos=Z(A,...this.options.eyePos),this.W.lookPoint=Z(A,...this.options.lookPoint),this.W.verticalAngle=this.options.verticalAngle,this.W.horizontalAngle=this.options.horizontalAngle,this.W.visibleColor=this.options.visibleColor,this.W.invisibleColor=this.options.invisibleColor,this.W.projViewMatrix=A.projViewMatrix}S(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA();const i=new N$8(t.regl);this.B=new ct(i,n)||this.B,this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={},n=this.B.render(A,this.W);return t.viewshedMap=n,t.viewshed_visibleColor=this.W.visibleColor||[0,1,0,.3],t.viewshed_invisibleColor=this.W.invisibleColor||[1,0,0,.3],t}getDefines(){return{HAS_VIEWSHED:1}}},exports.WaterPlugin=Xo$1,exports.WireframePainter=so$1,exports.WireframePlugin=Uo$1,exports.createREGL=h$1,exports.glMatrix=common,exports.mat2=mat2,exports.mat2d=mat2d,exports.mat3=mat3,exports.mat4=mat4,exports.quat=quat,exports.quat2=quat2,exports.reshader=u$3,exports.transcoders=transcoders,exports.vec2=vec2,exports.vec3=vec3,exports.vec4=vec4,Object.defineProperty(exports,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("@maptalks/gl-layers v0.18.5")}));
//# sourceMappingURL=maptalks-gl-layers.js.map
